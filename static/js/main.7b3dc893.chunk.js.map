{"version":3,"sources":["commons/utils/NotificationsHelper.ts","commons/utils/JsSlangHelper.ts","features/playground/PlaygroundTypes.ts","commons/controlBar/ControlBarClearButton.tsx","commons/controlBar/ControlBarEvalButton.tsx","commons/sideBar/SideBar.tsx","commons/sideContent/SideContent.tsx","commons/workspace/Workspace.tsx","features/sourceRecorder/sourcereel/SourcereelActions.ts","features/eventLogging/index.ts","commons/sideContent/SideContentResultCard.tsx","commons/sideContent/SideContentAutograder.tsx","commons/sideContent/SideContentLeaderboardCard.tsx","commons/sideContent/SideContentContestLeaderboard.tsx","commons/sideContent/SideContentContestEntryCard.tsx","commons/sideContent/SideContentContestVoting.tsx","commons/sideContent/SideContentContestVotingContainer.tsx","commons/sideContent/SideContentToneMatrix.tsx","commons/utils/DateHelper.ts","commons/assessmentWorkspace/AssessmentWorkspaceGradingResult.tsx","commons/assessmentWorkspace/AssessmentWorkspace.tsx","commons/assessmentWorkspace/AssessmentWorkspaceContainer.ts","commons/notificationBadge/NotificationBadgeHelper.ts","commons/notificationBadge/NotificationBadge.tsx","commons/notificationBadge/NotificationBadgeContainer.ts","commons/assessment/AssessmentNotFound.tsx","commons/assessment/Assessment.tsx","commons/assessment/AssessmentContainer.ts","commons/controlBar/ControlBarAutorunButtons.tsx","commons/controlBar/ControlBarExecutionTime.tsx","commons/controlBar/ControlBarSessionButton.tsx","commons/controlBar/ControlBarShareButton.tsx","commons/controlBar/ControlBarStepLimit.tsx","commons/utils/IntroductionHelper.ts","commons/utils/QueryHelper.ts","pages/playground/Playground.tsx","commons/achievement/control/achievementEditor/AchievementTemplate.ts","commons/achievement/control/achievementEditor/AchievementAdder.tsx","commons/achievement/control/common/ItemDeleter.tsx","commons/achievement/control/common/ItemSaver.tsx","commons/achievement/control/achievementEditor/achievementSettings/EditableGoalUuids.tsx","commons/achievement/control/achievementEditor/achievementSettings/EditablePosition.tsx","commons/achievement/control/achievementEditor/achievementSettings/EditablePrerequisiteUuids.tsx","commons/achievement/control/achievementEditor/AchievementSettings.tsx","commons/achievement/control/achievementEditor/AchievementUuidCopier.tsx","commons/achievement/control/achievementEditor/EditableCardTypes.ts","commons/achievement/control/achievementEditor/EditableDate.tsx","commons/achievement/control/achievementEditor/EditableView.tsx","commons/achievement/control/achievementEditor/EditableCard.tsx","commons/achievement/control/AchievementEditor.tsx","commons/achievement/AchievementFilter.tsx","commons/achievement/overview/AchievementMilestone.tsx","commons/achievement/overview/AchievementLevel.tsx","commons/achievement/AchievementOverview.tsx","commons/achievement/card/AchievementDeadline.tsx","commons/achievement/card/AchievementXp.tsx","commons/achievement/AchievementCard.tsx","commons/achievement/AchievementTask.tsx","commons/achievement/AchievementCommentCard.tsx","commons/achievement/view/AchievementViewCompletion.tsx","commons/achievement/view/AchievementViewGoal.tsx","commons/achievement/AchievementView.tsx","commons/achievement/utils/InsertFakeAchievements.ts","pages/achievement/subcomponents/AchievementDashboard.tsx","commons/achievement/control/AchievementPreview.tsx","commons/achievement/control/goalEditor/EditableGoalTypes.ts","commons/achievement/control/goalEditor/GoalTemplate.ts","commons/achievement/control/goalEditor/metaDetails/EditableAssessmentMeta.tsx","features/achievement/ExpressionTypes.ts","commons/achievement/control/goalEditor/metaDetails/EditableBinaryMeta.tsx","commons/achievement/control/goalEditor/EditableDate.tsx","commons/achievement/control/goalEditor/EditableTime.tsx","commons/achievement/control/goalEditor/metaDetails/EditableEventMeta.tsx","commons/achievement/control/goalEditor/metaDetails/EditableManualMeta.tsx","commons/achievement/control/goalEditor/EditableMeta.tsx","commons/achievement/control/goalEditor/EditableGoal.tsx","commons/achievement/control/goalEditor/GoalAdder.tsx","commons/achievement/control/GoalEditor.tsx","pages/achievement/control/AchievementControl.tsx","pages/achievement/control/AchievementControlContainer.ts","pages/achievement/subcomponents/AchievementDashboardContainer.ts","pages/achievement/Achievement.tsx","pages/achievement/AchievementContainer.ts","commons/sideContent/SideContentDataVisualizer.tsx","commons/sideContent/SideContentEnvVisualizer.tsx","commons/sourceRecorder/SourceRecorderControlBar.tsx","commons/sourceRecorder/SourceRecorderDeleteCell.tsx","commons/sourceRecorder/SourceRecorderSelectCell.tsx","commons/sourceRecorder/SourceRecorderShareCell.tsx","commons/sourceRecorder/SourceRecorderTable.tsx","pages/sourcecast/Sourcecast.tsx","pages/sourcecast/SourcecastContainer.ts","pages/academy/adminPanel/subcomponents/AddUserPanel.tsx","pages/academy/adminPanel/subcomponents/assessmentConfigPanel/BooleanCell.tsx","pages/academy/adminPanel/subcomponents/assessmentConfigPanel/DeleteRowCell.tsx","pages/academy/adminPanel/subcomponents/assessmentConfigPanel/NumericCell.tsx","pages/academy/adminPanel/subcomponents/assessmentConfigPanel/AssessmentConfigPanel.tsx","pages/academy/adminPanel/subcomponents/CourseConfigPanel.tsx","pages/academy/adminPanel/subcomponents/userConfigPanel/RolesCell.tsx","pages/academy/adminPanel/subcomponents/userConfigPanel/UserActionsCell.tsx","pages/academy/adminPanel/subcomponents/userConfigPanel/UserConfigPanel.tsx","pages/academy/adminPanel/AdminPanel.tsx","pages/academy/adminPanel/AdminPanelContainer.ts","pages/academy/dashboard/Dashboard.tsx","pages/academy/dashboard/DashboardContainer.ts","features/game/assets/FontAssets.ts","features/game/commons/CommonConstants.ts","features/game/utils/StyleUtils.ts","features/game/commons/CommonTextHover.ts","features/game/utils/TextUtils.ts","features/game/awards/GameAwardsConstants.ts","features/game/awards/GameAwardsHelper.ts","features/game/assets/AssetsTypes.ts","features/game/assets/ImageAssets.ts","features/game/sound/GameSoundTypes.ts","features/game/assets/SoundAssets.ts","features/game/layer/GameLayerTypes.ts","features/game/utils/GameUtils.ts","features/game/effects/FadeEffect.ts","features/game/effects/FlyEffect.ts","features/game/effects/MiniMessage.ts","features/game/dialogue/GameDialogueConstants.ts","features/game/effects/Typewriter.ts","features/game/dialogue/GameDialogueRenderer.ts","features/game/dialogue/GameDialogueHelper.ts","features/game/effects/Notification.ts","features/game/utils/ButtonUtils.ts","features/game/effects/Prompt.ts","features/game/phase/GamePhaseTypes.ts","features/game/scenes/gameManager/GameGlobalAPI.ts","features/game/state/GameStateTypes.ts","features/game/action/GameActionTypes.ts","features/game/location/GameMapTypes.ts","features/game/action/GameActionConditionChecker.ts","features/game/action/GameActionExecuter.ts","features/game/action/GameActionManager.ts","features/game/animations/GameAnimationManager.ts","features/game/utils/SpriteUtils.ts","features/game/awards/GameAwardsManager.ts","features/game/background/GameBackgroundManager.ts","features/game/boundingBoxes/GameBoundingBoxManager.ts","features/game/character/GameCharacterConstants.ts","features/game/character/GameCharacterManager.ts","features/game/dashboard/GameDashboardConstants.ts","features/game/dashboard/GameDashboardTypes.ts","features/game/dashboard/GameDashboardManager.ts","features/game/dialogue/GameDialogueGenerator.ts","features/game/commons/CommonTypes.ts","features/game/utils/StringUtils.ts","features/game/dialogue/GameDialogueSpeakerRenderer.ts","features/game/dialogue/GameDialogueManager.ts","features/game/dialogue/GameDialogueStorageManager.ts","features/game/effects/LoadingScreen.ts","features/game/commons/CommonRadioButton.ts","features/game/scenes/settings/SettingsConstants.ts","features/game/escape/GameEscapeConstants.ts","features/game/escape/GameEscapeManager.ts","features/game/input/GameInputManager.ts","features/game/layer/GameLayerManager.ts","features/game/log/GameLogConstants.ts","features/game/log/GameLogManager.ts","features/game/effects/GlowingObject.ts","features/game/objects/GameObjectManager.ts","features/game/phase/GamePhaseManager.ts","features/game/popUp/GamePopUpConstants.ts","features/game/popUp/GamePopUpManager.ts","features/game/effects/ScrollEffect.ts","features/game/save/GameSaveHelper.ts","features/game/state/GameStateManager.ts","features/game/task/GameTaskLogConstants.ts","features/game/task/GameTaskLogManager.ts","features/game/toolbar/GameToolbarConstants.ts","features/game/toolbar/GameToolbarManager.ts","features/game/commons/CommonBackButton.ts","features/game/mode/explore/GameModeExploreConstants.ts","features/game/mode/explore/GameModeExplore.ts","features/game/mode/GameModeTypes.ts","features/game/mode/menu/GameModeMenuConstants.ts","features/game/mode/menu/GameModeMenu.ts","features/game/mode/move/GameModeMoveConstants.ts","features/game/mode/move/GameModeMove.ts","features/game/mode/sequence/GameModeSequence.ts","features/game/mode/talk/GameModeTalkConstants.ts","features/game/mode/talk/GameModeTalk.ts","features/game/scenes/gameManager/GameManager.ts","features/game/scenes/gameManager/GameManagerHelper.ts","features/game/save/GameSaveManager.ts","features/game/save/GameSaveRequests.ts","features/game/effects/Glitch.ts","features/game/effects/WorkerMessage.ts","features/game/scenes/awardsHall/AwardsHallConstants.ts","features/game/scenes/awardsHall/AwardsHall.ts","features/game/scenes/awardsHall/AwardsHallHelper.ts","features/game/scenes/bindings/BindingsConstants.ts","features/game/scenes/bindings/Bindings.ts","features/game/utils/LoaderUtils.ts","features/game/scenes/chapterSelect/ChapterSelectConstants.ts","features/game/assets/TextAssets.ts","features/game/location/GameMap.ts","features/game/objective/GameObjective.ts","features/game/task/GameTask.ts","features/game/parser/ParserConverter.ts","features/game/parser/ParserValidator.ts","features/game/parser/ConditionParser.ts","features/game/parser/ActionParser.ts","features/game/parser/PromptParser.ts","features/game/parser/CharacterParser.ts","features/game/parser/SpeakerParser.ts","features/game/parser/DialogueParser.ts","features/game/parser/MusicParser.ts","features/game/parser/Parser.ts","features/game/parser/LocationParser.ts","features/game/parser/ObjectParser.ts","features/game/parser/BoundingBoxParser.ts","features/game/parser/TasksParser.ts","features/game/parser/LocationDetailsParser.ts","features/game/location/GameMapHelper.ts","features/game/utils/TxtLoaderUtils.ts","features/game/scenes/chapterSelect/ChapterSelectHelper.ts","features/game/scenes/chapterSelect/ChapterSelect.ts","features/game/scenes/checkpointTransition/CheckpointTransitionConstants.ts","features/game/scenes/checkpointTransition/CheckpointTransition.ts","features/game/scenes/mainMenu/MainMenuConstants.ts","features/game/scenes/mainMenu/MainMenu.ts","features/game/scenes/roomPreview/RoomPreviewConstants.ts","features/game/scenes/roomPreview/RoomPreviewHelper.ts","features/game/scenes/roomPreview/RoomPreview.ts","features/game/scenes/settings/Settings.ts","features/game/sound/GameSoundManager.ts","features/game/chapter/GameChapterMocks.ts","features/game/parser/AwardParser.ts","features/game/parser/RoomPreviewParser.ts","features/game/scenes/entry/Entry.ts","features/game/state/GameUserStateManager.ts","features/game/SourceAcademyGame.ts","features/game/chapter/GameChapterHelpers.ts","pages/academy/game/Game.tsx","commons/AnchorButtonLink.tsx","pages/academy/grading/subcomponents/GradingActionsCell.tsx","pages/academy/grading/subcomponents/GradingStatusCell.tsx","pages/academy/grading/subcomponents/GradingEditor.tsx","pages/academy/grading/subcomponents/GradingEditorContainer.ts","pages/academy/grading/subcomponents/GradingWorkspace.tsx","pages/academy/grading/subcomponents/GradingWorkspaceContainer.ts","pages/academy/grading/subcomponents/GradingXPCell.tsx","pages/academy/grading/Grading.tsx","pages/academy/grading/GradingContainer.ts","pages/academy/groundControl/subcomponents/DefaultChapterSelect.tsx","pages/academy/groundControl/subcomponents/DefaultChapterSelectContainer.ts","pages/academy/groundControl/subcomponents/GroundControlDeleteCell.tsx","pages/academy/groundControl/subcomponents/GroundControlDropzone.tsx","pages/academy/groundControl/subcomponents/GroundControlEditCell.tsx","pages/academy/groundControl/subcomponents/GroundControlPublishCell.tsx","pages/academy/groundControl/GroundControl.tsx","pages/academy/groundControl/GroundControlContainer.ts","pages/academy/sourcereel/subcomponents/SourcereelControlbar.tsx","pages/academy/sourcereel/Sourcereel.tsx","pages/academy/sourcereel/SourcereelContainer.ts","features/storySimulator/StorySimulatorTypes.ts","features/storySimulator/StorySimulatorRequest.ts","features/storySimulator/StorySimulatorService.ts","pages/academy/storySimulator/subcomponents/StorySimulatorAssetFileUploader.tsx","pages/academy/storySimulator/subcomponents/StorySimulatorAssetSelectionHelper.tsx","pages/academy/storySimulator/subcomponents/StorySimulatorAssetViewer.tsx","pages/academy/storySimulator/subcomponents/StorySimulatorAssetSelection.tsx","commons/utils/SortableList.tsx","pages/academy/storySimulator/subcomponents/StorySimulatorChapterEditor.tsx","pages/academy/storySimulator/subcomponents/StorySimulatorChapterSim.tsx","features/storySimulator/scenes/mainMenu/MainMenuConstants.ts","pages/academy/storySimulator/subcomponents/StorySimulatorCheckpointTxtLoader.tsx","pages/academy/storySimulator/subcomponents/StorySimulatorCheckpointSim.tsx","features/storySimulator/assets/ImageAssets.ts","features/storySimulator/scenes/mainMenu/MainMenu.ts","features/storySimulator/background/SSBackgroundManager.ts","features/storySimulator/cursorMode/SSCursorModeTypes.ts","features/storySimulator/boundingBoxes/SSBBoxManager.ts","features/storySimulator/cursorMode/SSCursorModeConstants.ts","features/storySimulator/cursorMode/SSCursorMode.ts","features/storySimulator/logger/SSLogConstants.ts","features/storySimulator/logger/SSLogManagerHelper.ts","features/storySimulator/logger/SSLogManager.ts","features/storySimulator/objects/SSObjectManager.ts","features/storySimulator/transform/SSTransformManagerConstants.ts","features/storySimulator/transform/SSTransformManager.ts","features/storySimulator/scenes/ObjectPlacement/ObjectPlacementConstants.ts","features/storySimulator/scenes/ObjectPlacement/ObjectPlacement.ts","pages/academy/storySimulator/subcomponents/storySimulatorGame.ts","pages/academy/storySimulator/StorySimulator.tsx","pages/academy/xpCalculation/XpCalculation.tsx","pages/academy/Academy.tsx","pages/contributors/subcomponents/ContributorsDetails.tsx","pages/contributors/subcomponents/ContributorsGithubApi.ts","pages/contributors/subcomponents/ContributorsList.tsx","pages/contributors/Contributors.tsx","pages/disabled/Disabled.tsx","pages/githubCallback/GitHubCallback.tsx","pages/login/Login.tsx","commons/XMLParser/XMLParserTypes.ts","commons/XMLParser/XMLParserHelper.ts","commons/editingOverviewCard/EditingOverviewCard.tsx","commons/controlBar/ControlBarToggleEditModeButton.tsx","commons/editingWorkspaceSideContent/EditingWorkspaceSideContentHelper.ts","commons/editingWorkspaceSideContent/EditingWorkspaceSideContentTextAreaContent.tsx","commons/editingWorkspaceSideContent/EditingWorkspaceSideContentAutograderTab.tsx","commons/editingWorkspaceSideContent/EditingWorkspaceSideContentDeploymentTab.tsx","commons/editingWorkspaceSideContent/EditingWorkspaceSideContentGradingTab.tsx","commons/editingWorkspaceSideContent/EditingWorkspaceSideContentManageQuestionTab.tsx","commons/editingWorkspaceSideContent/EditingWorkspaceSideContentMcqQuestionTemplateTab.tsx","commons/editingWorkspaceSideContent/EditingWorkspaceSideContentProgrammingQuestionTemplateTab.tsx","commons/editingWorkspace/EditingWorkspace.tsx","commons/editingWorkspace/EditingWorkspaceContainer.ts","commons/missionCreator/MissionCreator.tsx","commons/missionCreator/MissionCreatorContainer.ts","pages/missionControl/MissionControl.tsx","pages/missionControl/MissionControlContainer.ts","pages/playground/PlaygroundContainer.tsx","pages/welcome/Welcome.tsx","commons/profile/ProfileCard.tsx","commons/profile/Profile.tsx","commons/dropdown/DropdownAbout.tsx","commons/dropdown/DropdownCourses.tsx","commons/dropdown/DropdownCreateCourse.tsx","commons/dropdown/DropdownHelp.tsx","commons/dropdown/DropdownSettings.tsx","commons/dropdown/Dropdown.tsx","commons/navigationBar/subcomponents/AcademyNavigationBar.tsx","commons/navigationBar/subcomponents/NavigationBarMobileSideMenu.tsx","commons/navigationBar/NavigationBar.tsx","commons/application/Application.tsx","commons/application/ApplicationContainer.ts","commons/utils/RegisterServiceWorker.ts","pages/fileSystem/FileSystemProvider.tsx","index.tsx","features/eventLogging/client.ts","commons/ControlButton.tsx","features/academy/AcademyTypes.ts","features/playground/PlaygroundActions.ts","features/sourceRecorder/sourcecast/SourcecastTypes.ts","commons/workspace/WorkspaceActions.ts","commons/application/types/CommonsTypes.ts","commons/controlBar/ControlBarChapterSelect.tsx","commons/controlBar/ControlBarRunButton.tsx","commons/WorkspaceSettingsContext.tsx","features/groundControl/GroundControlTypes.ts","features/persistence/PersistenceTypes.ts","commons/githubAssessments/GitHubMissionDataUtils.ts","features/dashboard/DashboardTypes.ts","commons/application/types/SessionTypes.ts","commons/controlBar/ControlBarPreviousButton.tsx","commons/controlBar/ControlBarQuestionViewButton.tsx","commons/achievement/utils/AchievementInferencer.ts","commons/mobileWorkspace/DraggableRepl.tsx","commons/mobileWorkspace/MobileKeyboard.tsx","commons/mobileWorkspace/mobileSideContent/MobileControlBar.tsx","commons/mobileWorkspace/mobileSideContent/MobileSideContent.tsx","commons/mobileWorkspace/MobileWorkspace.tsx","commons/controlBar/ControlBarReturnToAcademyButton.tsx","commons/controlBar/ControlBarNextButton.tsx","features/envVisualizer/components/Visible.tsx","features/envVisualizer/EnvVisualizerCompactConfig.ts","features/envVisualizer/EnvVisualizerConfig.ts","features/envVisualizer/components/Text.tsx","features/envVisualizer/components/arrows/GenericArrow.tsx","features/envVisualizer/components/arrows/ArrowFromFrame.tsx","features/envVisualizer/components/ArrayEmptyUnit.tsx","features/envVisualizer/components/arrows/ArrowFromFn.tsx","features/envVisualizer/components/values/Value.tsx","features/envVisualizer/components/values/FnValue.tsx","features/envVisualizer/components/values/GlobalFnValue.tsx","features/envVisualizer/components/arrows/ArrowFromArrayUnit.tsx","features/envVisualizer/components/shapes/RoundedRect.tsx","features/envVisualizer/components/ArrayNullUnit.tsx","features/envVisualizer/components/values/PrimitiveValue.tsx","features/envVisualizer/components/ArrayUnit.tsx","features/envVisualizer/components/values/ArrayValue.tsx","features/envVisualizer/components/Frame.tsx","features/envVisualizer/components/Level.tsx","features/envVisualizer/components/ArrayLevel.tsx","features/envVisualizer/components/FrameLevel.tsx","features/envVisualizer/components/Grid.tsx","features/envVisualizer/components/ArrowLane.tsx","features/envVisualizer/components/arrows/ArrowFromText.tsx","features/envVisualizer/components/values/UnassignedValue.tsx","features/envVisualizer/components/Binding.tsx","features/envVisualizer/EnvVisualizerUtils.ts","features/envVisualizer/compactComponents/arrows/GenericArrow.tsx","features/envVisualizer/compactComponents/arrows/ArrowFromFrame.tsx","features/envVisualizer/compactComponents/ArrayEmptyUnit.tsx","features/envVisualizer/compactComponents/arrows/ArrowFromFn.tsx","features/envVisualizer/compactComponents/values/Value.tsx","features/envVisualizer/compactComponents/values/FnValue.tsx","features/envVisualizer/compactComponents/values/GlobalFnValue.tsx","features/envVisualizer/compactComponents/arrows/ArrowFromArrayUnit.tsx","features/envVisualizer/compactComponents/ArrayNullUnit.tsx","features/envVisualizer/compactComponents/Text.tsx","features/envVisualizer/compactComponents/values/PrimitiveValue.tsx","features/envVisualizer/compactComponents/ArrayUnit.tsx","features/envVisualizer/compactComponents/values/ArrayValue.tsx","features/envVisualizer/compactComponents/arrows/ArrowFromText.tsx","features/envVisualizer/compactComponents/values/UnassignedValue.tsx","features/envVisualizer/compactComponents/Binding.tsx","features/envVisualizer/compactComponents/Frame.tsx","features/envVisualizer/compactComponents/Level.tsx","features/envVisualizer/EnvVisualizerLayout.tsx","features/envVisualizer/EnvVisualizer.tsx","commons/utils/Constants.ts","features/groundControl/GroundControlActions.ts","commons/sideContent/SideContentHelper.ts","commons/sideContent/GenericSideContent.tsx","commons/assessment/AssessmentTypes.ts","features/academy/AcademyActions.ts","assets/default_cover_image.jpg","commons/controlBar/ControlBarResetButton.tsx","commons/controlBar/ControlBarSaveButton.tsx","features/sourceRecorder/sourcecast/SourcecastActions.ts","features/dataVisualizer/Config.ts","features/dataVisualizer/list.js","features/dataVisualizer/dataVisualizerUtils.ts","features/dataVisualizer/drawable/ArrowDrawable.tsx","features/dataVisualizer/drawable/BackwardArrowDrawable.tsx","features/dataVisualizer/tree/BaseTreeNode.ts","features/dataVisualizer/tree/AlreadyParsedTreeNode.ts","features/dataVisualizer/tree/DataTreeNode.tsx","features/dataVisualizer/tree/DrawableTreeNode.tsx","features/dataVisualizer/drawable/NullDrawable.tsx","features/dataVisualizer/drawable/ArrayDrawable.tsx","features/dataVisualizer/drawable/FunctionDrawable.tsx","features/dataVisualizer/tree/FunctionTreeNode.tsx","features/dataVisualizer/tree/ArrayTreeNode.tsx","features/dataVisualizer/tree/Tree.tsx","features/dataVisualizer/dataVisualizer.tsx","commons/application/ApplicationTypes.ts","commons/collabEditing/CollabEditingHelper.ts","commons/collabEditing/CollabEditingTypes.ts","commons/collabEditing/CollabEditingActions.ts","commons/sideContent/SideContentTypes.ts","commons/application/actions/CommonsActions.ts","commons/utils/GitHubPersistenceHelper.ts","commons/controlBar/ControlBar.tsx","features/achievement/AchievementTypes.ts","commons/mcqChooser/McqChooser.tsx","commons/repl/Repl.tsx","commons/utils/MemoizeHelper.ts","commons/sideContent/SideContentTestcaseCard.tsx","commons/achievement/AchievementManualEditor.tsx","features/dashboard/DashboardActions.ts","commons/utils/ConsoleOverload.ts","commons/utils/DisplayBufferService.ts","commons/workspace/WorkspaceTypes.ts","commons/achievement/utils/AchievementBackender.ts","commons/sagas/RequestsSaga.ts","commons/utils/CastBackend.ts","commons/utils/Hooks.ts","commons/utils/LocalStorageHelper.ts","features/sourceRecorder/SourceRecorderTypes.ts","commons/application/actions/SessionActions.ts","features/achievement/AchievementConstants.ts","commons/Markdown.tsx","pages/githubAssessments/GitHubClassroom.tsx","pages/githubAssessments/GitHubAssessmentListing.tsx","pages/githubAssessments/GitHubClassroomWelcome.tsx","commons/controlBar/github/ControlBarDisplayMCQButton.tsx","commons/controlBar/github/ControlBarTaskAddButton.tsx","commons/controlBar/github/ControlBarTaskDeleteButton.tsx","commons/githubAssessments/GitHubMissionCreateDialog.tsx","commons/sideContent/githubAssessments/SideContentMarkdownEditor.tsx","commons/sideContent/githubAssessments/SideContentMissionEditor.tsx","commons/sideContent/githubAssessments/SideContentTaskEditor.tsx","commons/sideContent/githubAssessments/SideContentEditableTestcaseCard.tsx","commons/sideContent/githubAssessments/SideContentTestcaseEditor.tsx","pages/githubAssessments/GitHubAssessmentDefaultValues.ts","pages/githubAssessments/GitHubAssessmentWorkspace.tsx","pages/githubAssessments/GitHubAssessmentWorkspaceContainer.tsx","commons/controlBar/github/ControlBarGitHubLoginButton.tsx","commons/navigationBar/subcomponents/GitHubAssessmentsNavigationBar.tsx","commons/utils/HistoryHelper.ts","commons/utils/ParamParseHelper.ts","commons/application/types/InterpreterTypes.ts","commons/application/actions/InterpreterActions.ts","commons/dialogs/ConfirmDialog.tsx","commons/dialogs/PromptDialog.tsx","commons/utils/DialogHelper.tsx","commons/application/types/ExternalTypes.ts","features/github/GitHubUtils.tsx","commons/achievement/utils/DateHelper.ts","features/persistence/PersistenceActions.ts","features/remoteExecution/RemoteExecutionActions.ts","commons/utils/ActionsHelper.ts","features/sourceRecorder/sourcereel/SourcereelTypes.ts","features/academy/AcademyReducer.ts","features/achievement/AchievementReducer.ts","features/dashboard/DashboardReducer.ts","features/playground/PlaygroundReducer.ts","features/sourceRecorder/sourcecast/SourcecastReducer.ts","features/sourceRecorder/sourcereel/SourcereelReducer.ts","commons/workspace/WorkspaceReducer.ts","commons/application/ApplicationReducer.ts","commons/application/reducers/SessionsReducer.ts","commons/application/reducers/RootReducer.ts","commons/mocks/AssessmentMocks.ts","commons/mocks/UserMocks.ts","commons/mocks/GradingMocks.ts","commons/mocks/BackendMocks.ts","commons/achievement/utils/EventHandler.ts","commons/sagas/SafeEffects.ts","commons/sagas/AchievementSaga.ts","commons/utils/AuthHelper.ts","commons/sagas/BackendSaga.ts","commons/gitHubOverlay/GitHubFileNodeData.tsx","commons/gitHubOverlay/GitHubTreeNodeCreator.tsx","commons/gitHubOverlay/FileExplorerDialog.tsx","commons/gitHubOverlay/RepositoryDialog.tsx","commons/sagas/GitHubPersistenceSaga.ts","features/github/GitHubTypes.ts","commons/sagas/LoginSaga.ts","commons/sagas/PersistenceSaga.tsx","commons/sagas/PlaygroundSaga.ts","commons/sagas/RemoteExecutionSaga.ts","commons/sagas/WorkspaceSaga.ts","commons/sagas/MainSaga.ts","pages/localStorage.ts","pages/createStore.ts","features/remoteExecution/RemoteExecutionTypes.ts","commons/ContentDisplay.tsx","features/sourceRecorder/SourceRecorderActions.ts","features/achievement/AchievementActions.ts","commons/sourceRecorder/SourceRecorderEditor.tsx","commons/editor/EditorHotkeys.ts","commons/editor/UseShareAce.tsx","features/fullJS/fullJSHighlight.js","commons/documentation/Documentation.ts","commons/utils/AceHelper.ts","commons/editor/Editor.tsx","commons/editor/EditorContainer.tsx","commons/notificationBadge/NotificationBadgeTypes.ts"],"names":["notification","Toaster","create","position","Position","TOP","showSuccessMessage","message","timeout","key","show","intent","Intent","SUCCESS","showWarningMessage","WARNING","showDangerMessage","DANGER","showMessage","props","dismiss","visualizeEnv","context","EnvVisualizer","drawEnv","err","Error","createContext","externals","externalContext","variant","Variant","DEFAULT","createSlangContext","makeElevatedContext","ProxyFrame","prototype","runtime","environments","head","fakeFrame","proxyGlobalEnv","Proxy","get","target","prop","receiver","proxyEnvs","proxyRuntime","getDifferenceInMethods","elevatedContext","eFrame","frame","difference","keys","getStoreExtraMethodsString","toRemove","unblockKey","join","getRestoreExtraMethodsString","removed","store","map","x","getBlockExtraMethodsString","CHANGE_QUERY_STRING","GENERATE_LZ_STRING","SHORTEN_URL","UPDATE_SHORT_URL","PLAYGROUND_UPDATE_GITHUB_SAVE_INFO","PLAYGROUND_UPDATE_PERSISTENCE_FILE","ControlBarClearButton","handleReplOutputClear","label","icon","IconNames","REMOVE","onClick","ControlBarEvalButton","handleReplEval","isRunning","content","CODE","SideBar","tabs","isExpanded","expandSideBar","collapseSideBar","selectedTabIndex","setSelectedTabIndex","React","useState","length","className","tab","index","classNames","selected","tabIndex","iconName","size","body","SideContent","selectedTabId","renderActiveTabPanelOnly","editorWidth","sideContentHeight","otherProps","GenericSideContent","renderFunction","dynamicTabs","changeTabsCallback","id","onChange","workspaceLocation","tabId","undefined","SideContentType","module","tabProps","title","htmlDisplay","generateIconId","iconSize","disabled","tabBody","tabPanel","panel","renderTab","propsAreEqual","rightResizeOnly","right","bottomResizeOnly","bottom","noResize","Workspace","sideBarResizable","contentContainerDiv","editorDividerDiv","leftParentResizable","maxDividerHeight","sideDividerDiv","contentContainerWidth","useDimensions","lastExpandedSideBarWidth","setLastExpandedSideBarWidth","isSideBarExpanded","setIsSideBarExpanded","FocusStyleManager","onlyShowFocusOnTabs","sideContentIsResizeable","current","clientHeight","toggleSideBarDividerDisplay","event","direction","elementRef","delta","clientWidth","sideBar","updateSize","width","height","toggleEditorDividerDisplay","_a","_b","ref","editorWidthPercentage","toggleDividerDisplay","resizableHeight","rightParentHeight","parentNode","style","display","sideContent","sideContentProps","resizableSideContent","bounds","enable","onResize","onResizeStop","handleSideContentHeightChange","hasUnsavedChanges","ControlBar","controlBarProps","isSideBarRendered","sideBarProps","minWidth","maxWidth","sideBarWidth","defaultSize","sideBarResizableProps","as","editorContainerProps","EditorContainer","McqChooser","mcqProps","createWorkspaceInput","Repl","replProps","deleteSourcecastEntry","action","DELETE_SOURCECAST_ENTRY","recordInit","initData","RECORD_INIT","recordInput","input","RECORD_INPUT","resetInputs","inputs","RESET_INPUTS","timerPause","TIMER_PAUSE","timeNow","Date","now","timerReset","TIMER_RESET","timerResume","timeBefore","TIMER_RESUME","timerStart","TIMER_START","timerStop","TIMER_STOP","questionIdLookup","cadetLoggerUrl","process","REACT_APP_CADET_LOGGER","log","record","questionId","sessionId","Promise","resolve","reject","getDB","then","db","transaction","STORE_NAME","oncomplete","onerror","objectStore","add","initSession","initialState","uuid","type","time","fn","answer","memoize","request","indexedDB","open","onsuccess","evt","result","console","error","onupgradeneeded","createObjectStore","keyPath","autoIncrement","SideContentResultCard","resultType","elevation","Elevation","ONE","toUpperCase","expected","errors","errorType","line","errorExplanation","errorMessage","actual","autograderTooltip","columnHeader","colClass","colTitle","CARET_DOWN","testcasesHeader","resultsHeader","collapseButton","isOpen","toggleFunc","ControlButton","CARET_RIGHT","options","minimal","SideContentAutograder","showsTestcases","setTestcasesShown","showsResults","setResultsShown","testcases","autogradingResults","handleTestcaseEval","testcaseCards","testcase","SideContentTestcaseCard","resultCards","toggleTestcases","toggleResults","placement","PopoverPosition","LEFT","HELP","keepChildrenMounted","SideContentLeaderboardCard","handleContestEntryClick","contestEntry","rank","Classes","INTERACTIVE","submission_id","code","student_name","final_score","contestEntryHeader","SideContentContestLeaderboard","orderedContestEntries","showLeaderboard","setShowLeaderboard","contestEntryCards","useMemo","SideContentContestEntryCard","canSave","isValid","handleVotingSubmissionChange","entryNumber","minScore","maxScore","wrong","value","score","onValueChange","placeholder","min","max","allowNumericCharactersOnly","fill","minorStepSize","SideContentContestVoting","contestEntries","showContestEntries","setShowContestEntries","SideContentContestVotingContainer","handleSave","setIsValid","votingSubmission","setVotingSubmission","useEffect","submissionId","updatedSubmission","vote","noDuplicates","Set","noNull","reduce","submissionHasNoNull","isSubmissionValid","SideContentToneMatrix","$container","shouldComponentUpdate","componentDidMount","window","ToneMatrix","initialise_matrix","this","handleClear","clear_matrix","handleRandomise","randomise_matrix","render","DARK","BUTTON_GROUP","r","beforeNow","dateString","date","moment","isBefore","getPrettyDate","format","AssessmentWorkspaceGradingResult","xp","maxXp","comments","Markdown","simplifiedAutoLink","strikethrough","tasklists","openLinksInNewWindow","graderName","gradedAt","AssessmentWorkspace","showOverlay","setShowOverlay","showResetTemplateOverlay","setShowResetTemplateOverlay","setSessionId","selectedTab","setSelectedTab","assessment","questions","grader","grading","questionOverview","isMobileBreakpoint","useResponsive","dispatch","useDispatch","handleEditorValueChange","fetchAssessment","assessmentId","notAttempted","question","QuestionTypes","programming","solutionTemplate","checkWorkspaceReset","mobileEditor","mobileEditorRun","pushLog","newInput","activeTab","handleEval","autograder","runAllTestcases","evalEditor","data","KeyboardCommand","run","storedAssessmentId","storedQuestionId","editorValue","editorPrepend","editorPostpend","editorTestcases","questionData","prepend","postpend","number","chapter","Chapter","CALC","externalLibrary","library","external","name","voting","handleEditorUpdateBreakpoints","updateCurrentAssessmentId","resetWorkspace","editorTabs","prependValue","postpendValue","highlightedLines","breakpoints","changeExecTime","execTimeMs","defaultWorkspaceManager","execTime","beginClearContext","handleUpdateHasUnsavedChanges","isGraded","_submissionId","NINJA","BRIEFCASE","longSummary","briefing","NEW_LAYERS","contestVoting","CROWN","contestLeaderboard","AIRPLANE","assessmentConfiguration","isManuallyGraded","evalTestcase","push","TICK","symbols","includes","GRID_VIEW","toneMatrix","beforeDynamicTabs","afterDynamicTabs","newTabId","prevTabId","listingPath","courseId","assessmentTypeLink","assessmentWorkspacePath","toString","questionProgress","onClickNext","history","onClickReturn","onClickProgress","deferredNavigate","blockedQuestionId","filter","qn","mcq","solution","acc","stringify","nextButton","ControlBarNextButton","blocking","previousButton","ControlBarPreviousButton","questionView","ControlBarQuestionViewButton","resetButton","ControlBarResetButton","runButton","ControlBarRunButton","handleEditorEval","saveButton","onClickSave","chapterSelect","ControlBarChapterSelect","handleChapterSelect","sourceChapter","sourceVariant","Constants","defaultSourceVariant","editorButtons","flowButtons","description","SpinnerSize","LARGE","overlay","text","closeOverlay","resetTemplateOverlay","ERROR","isCloseButtonShown","onClose","DIALOG_BODY","DIALOG_FOOTER","editorVariant","convertEditorTabStateToProps","editorSessionId","externalLibraryName","handleDeclarationNavigate","cursorPosition","navigateToDeclaration","handleEditorCheck","handlePromptAutocomplete","row","col","callback","promptAutocomplete","isEditorAutorun","newCode","onCursorChange","selection","getCursor","onSelectionChange","range","getRange","isBackwards","isEqual","start","end","handleMCQSubmit","option","handleBrowseHistoryDown","browseReplHistoryDown","handleBrowseHistoryUp","browseReplHistoryUp","handleReplValueChange","newValue","updateReplValue","output","replValue","replButtons","clearButton","clearReplOutput","workspaceProps","heightChange","changeSideContentHeight","mobileWorkspaceProps","mobileSideContentProps","mobileControlBarProps","MobileWorkspace","AssessmentWorkspaceContainer","connect","state","session","assessments","workspaces","activeEditorTabIndex","isDebugging","enableDebugging","currentAssessment","currentQuestion","bindActionCreators","val","updateEditorValue","setEditorBreakpoint","evalRepl","submitAnswer","updateHasUnsavedChanges","filterNotificationsByAssessment","notifications","n","assessment_id","filterNotificationsBySubmission","filterNotificationsByType","assessmentType","assessment_type","makeNotificationMessage","NotificationTypes","new","deadline","autograded","submitted","unsubmitted","graded","new_message","NotificationBadge","notificationFilter","notificationIcon","round","large","disableHover","makeNotificationTag","multiline","onRemove","handleAcknowledgeNotifications","notificationTags","interactionKind","PopoverInteractionKind","HOVER","RIGHT","hoverOpenDelay","hoverCloseDelay","lazy","NotificationBadgeContainer","acknowledgeNotifications","AssessmentNotFound","makeGradingStatus","gradingStatus","tooltip","GradingStatuses","TIME","none","CROSS","DISABLE","PRIMARY","Assessment","params","useParams","betchaAssessment","setBetchaAssessment","showClosedAssessments","setShowClosedAssessments","showOpenedAssessments","setShowOpenedAssessments","showUpcomingAssessments","setShowUpcomingAssessments","toggleClosedAssessments","toggleOpenAssessments","toggleUpcomingAssessments","setBetchaAssessmentNull","sortAssessments","sortBy","a","makeSubmissionButton","overview","status","AssessmentStatuses","attempted","CONFIRM","NONE","makeAssessmentInteractButton","optionalLabel","not_attempted","PLAY","attempting","EDIT","EYE_OPEN","to","defaultQuestionId","makeOverviewCard","renderAttemptButton","renderGradingStatus","showGrade","ratio","String","alt","src","coverImage","defaultCoverImage","makeOverviewCardTitle","shortSummary","CALENDAR","openAt","closeAt","ellipsize","private","assessmentOverviews","assessmentOverviewsUnfiltered","isStudent","ao","stringParamToInt","assessmentWorkspaceProps","FLAME","isOverviewUpcoming","upcomingCards","isOverviewOpened","openedCards","closedCards","upcomingCardsCollapsible","openedCardsCollapsible","closedCardsCollapsible","submissionText","toLowerCase","betchaText","betchaDialog","handleSubmitAssessment","ContentDisplay","loadContentDispatch","handleAssessmentOverviewFetch","AssessmentContainer","role","Role","Student","fetchAssessmentOverviews","submitAssessment","ControlBarAutorunButtons","showRunButton","color","showAutoRunIndicator","AUTOMATIC_UPDATES","showDebuggerPause","pauseDisabled","STOP","handleDebuggerPause","showDebuggerResume","CHEVRON_RIGHT","handleDebuggerResume","showDebuggerReset","handleDebuggerReset","autorunDisabled","checked","handleToggleEditorAutorun","ControlBarExecutionTime","leftIcon","handleChangeExecTime","handleError","ControlBarSessionButtons","constructor","super","inviteInputElem","joinElemValue","handleChange","bind","selectInviteInputText","inviteButtonPopoverContent","readOnly","DUPLICATE","inviteButton","popoverClassName","inheritDarkTheme","GRAPH","createNewSession","handleSetEditorSessionId","joinButtonPopoverContent","onSubmit","preventDefault","checkSessionIdExists","exists","POPOVER_DISMISS","KEY_ENTER","joinButton","LOG_IN","leaveButton","FEED","setState","SOCIAL_MEDIA","iconColor","sharedbConnected","Colors","GREEN3","RED3","focus","select","ControlBarShareButton","shareInputElem","selectShareInputText","toggleButton","keyword","isLoading","shareButtonPopoverContent","queryString","isSicp","defaultValue","shortURL","SMALL","urlShortenerBase","SHARE","handleShortenURL","componentDidUpdate","prevProps","handleGenerateLz","handleUpdateShortURL","currentTarget","ControlBarStepLimit","VERTICAL_BAR_CHART_ASC","stepLimit","handleChangeStepLimit","HOTKEYS_INTRODUCTION","Links","aceHotkeys","sourceHotkeys","generateSourceIntroduction","parseQuery","query","parsed","qs","Object","entries","isArray","keyMap","goGreen","mobileOnlyTabIds","desktopOnlyTabIds","introduction","Playground","isSicpEditor","propsRef","deviceSecret","setDeviceSecret","location","useLocation","useHistory","shouldAddDevice","URLSearchParams","search","replace","pathname","setLastEdit","isGreen","setIsGreen","remoteExecution","hasBreakpoints","setHasBreakpoints","playgroundSourceChapter","usingRemoteExecution","useTypedSelector","remoteExecutionSession","playground","hash","initialEditorValueHash","async","chap","programLz","lz","prgrm","program","decompressFromEncodedURIComponent","sourceLanguages","find","language","Math","exec","handleHash","courseSourceChapter","courseSourceVariant","handlers","onEditorValueChange","onChangeTabs","handleUsingSubst","substVisualizer","checkEditor","autorunButtons","_","pick","handleInterruptEval","beginInterruptExecution","toggleEditorAutorun","beginDebuggerPause","debuggerReset","debuggerResume","isSourceLanguage","evalButton","executionTime","stepperStepLimit","limit","changeStepLimit","sessionButtons","setEditorSessionId","shareButton","generateLzString","s","shortenURL","updateShortURL","playgroundIntroductionTab","HOME","playgroundSourceVariant","mobileTabs","onLoadMethod","editor","firstTime","renderer","on","onChangeMethod","onCursorChangeMethod","onSelectionChangeMethod","numberOfBreakpoints","arrayItem","replDisabled","handleSendReplInputToOutput","sendReplInputToOutput","handleSetSharedbConnected","connected","setSharedbConnected","onLoad","ExternalLibraryName","hidden","inputHidden","disableScrolling","usingSubst","change","viewTemplate","coverImageUrl","completionText","achievementTemplate","isVariableXp","isTask","prerequisiteUuids","goalUuids","cardBackground","cardBackgroundUrl","view","AchievementAdder","allowNewUuid","setNewUuid","inferencer","useContext","AchievementContext","NEW_OBJECT","insertAchievement","ItemDeleter","deleteItem","item","TRASH","showSimpleConfirmDialog","contents","negativeLabel","positiveIntent","positiveLabel","ItemSaver","discardChanges","saveChanges","FLOPPY_DISK","EditableGoalUuids","changeGoalUuids","allGoalUuids","getAllGoalUuids","selectedUuids","isInvalidGoal","getGoal","GoalSelect","MultiSelect","ofType","selectedGoals","availableGoals","without","removeGoal","removeUuid","delete","itemRenderer","goal","handleClick","items","noResults","onItemSelect","selectGoal","selectUuid","selectedItems","tagInputProps","getUuidByText","getUuid","tagRenderer","itemPredicate","resetOnSelect","EditablePosition","changePosition","maxPosition","listTaskUuids","positionOptions","Array","PositionSelect","Select","filterable","EditablePrerequisiteUuids","changePrerequisiteUuids","availableUuids","isInvalidAchievement","getAchievement","PrerequisiteSelect","selectedPrereqs","availablePrereqs","achievement","selectPrereq","getUuidByTitle","AchievementSettings","changeCardBackground","changeIsVariableXp","editableAchievement","setOpen","toggleOpen","WRENCH","padding","AchievmenetUuidCopier","CLIPBOARD","navigator","clipboard","writeText","EditableCardActionType","EditableDate","changeDate","hoverText","prettifyDate","outlined","background","textAlign","timePickerProps","showArrowButtons","EditableView","changeView","WIDGET_HEADER","init","isDirty","reducer","ActionType","SAVE_CHANGES","DISCARD_CHANGES","payload","DELETE_ACHIEVEMENT","CHANGE_CARD_BACKGROUND","CHANGE_DEADLINE","CHANGE_GOAL_UUIDS","CHANGE_POSITION","CHANGE_PREREQUISITE_UUIDS","CHANGE_RELEASE","release","CHANGE_TITLE","CHANGE_VIEW","CHANGE_XP","CHANGE_IS_VARIABLE_XP","EditableCard","isNewAchievement","releaseUuid","removeCard","requestPublish","achievementClone","cloneDeep","useReducer","isNew","setIsNew","modifyAchievement","removeAchievement","TRENDING_UP","AchievementUuidCopier","editableCards","AchievementEditor","newUuid","idx","splice","generateEditableCard","achievementUuid","listSortedAchievementUuids","AchievementFilter","filterState","ownStatus","globalStatus","setGlobalStatus","getFilterColor","AchievementMilestone","studentXp","caFulfillmentLevel","AchievementLevel","showMilestone","setShowMilestone","level","floor","xpPerLevel","progress","progressFrac","onMouseEnter","onMouseLeave","animate","stripes","AchievementOverview","userState","selectedUser","crid","courseRegId","userCrid","FETCH_TOTAL_XP_ADMIN","FETCH_TOTAL_XP","twoDays","getTime","AchievementDeadline","deadlineColor","isExpired","timeFromExpired","DeadlineColors","RED","BLACK","STOPWATCH","prettifyDeadline","stringifyXp","isBonus","AchievementXp","BANK_ACCOUNT","AchievementCard","focusState","isDropdownOpen","shouldRender","toggleDropdown","focusUuid","setFocusUuid","displayDeadline","getDisplayDeadline","displayXp","getDescendantXp","getProgressFrac","getStatus","hasDropdown","getImmediateChildren","onClickCapture","handleGlow","opacity","AchievementStatus","COMPLETED","AchievementTask","filterStatus","taskColor","getAbilityColor","setIsDropdownOpen","isInFilter","FilterStatus","ALL","ACTIVE","isPrerequisite","canRender","prerequisite","shouldRenderPrerequisites","shouldRenderTask","prerequisiteUuid","borderBottom","borderLeft","AchievementCommentCard","showToQuestion","toMission","AchievementViewCompletion","awardedXp","paragraphs","split","para","AchievementViewGoal","goals","targetCount","count","completed","frac","mapGoalToJSX","AchievementView","Number","isNaN","isAdminView","FETCH_ASSESSMENT_OVERVIEWS","FETCH_ASSESSMENT_ADMIN","FETCH_ASSESSMENT","selectedAssessment","selectedAssessmentConfig","config","MOUNTAIN","getAchievementXp","listGoals","descriptionParagraphs","getAbilityGlow","getAbilityBackground","backgroundBlendMode","assessmentCompleted","assessmentOverview","insertFakeAchievements","assessmentConfigs","sortedOverviews","sort","overview1","overview2","diff","assessmentTypes","categorisedUuids","forEach","isReleased","idString","hasAchievement","insertFakeGoalDefinition","achievementUuids","meta","GoalType","ASSESSMENT","assessmentNumber","requiredCompletionFrac","insertFakeAchievement","isPublished","uuids","generateAchievementTasks","taskUuids","taskUuid","Dashboard","getAchievements","getOwnGoals","getGoals","getUserAssessmentOverviews","getUsers","updateGoalProgress","group","achievementAssessmentOverviews","users","userIdState","userAssessmentOverviews","hiddenState","seeHidden","Provider","username","AchievementManualEditor","studio","GLOBE","LOCATE","ENDORSED","listAllSortedAchievementUuids","listSortedReleasedTaskUuids","AchievementPreview","awaitPublish","publishChanges","viewMode","toggleMode","mode","ARROW_LEFT","rightIcon","ARROW_RIGHT","CLOUD_UPLOAD","listSortedTaskUuids","EditableGoalActionType","metaTemplate","BINARY","condition","MANUAL","EVENT","eventNames","EventType","RUN_CODE","observeFrom","observeTo","goalDefinitionTemplate","EditableAssessmentMeta","assessmentMeta","changeMeta","requiredCompletion","rightElement","EventTypes","AND","operands","OR","JoinerSelect","joinerRenderer","joiner","conditionSplitter","len","conditions","i","flat","JSON","EditableBinaryMeta","binaryMeta","joiners","condArray","changeCondition","parse","op","cond","changeConditionArray","deleteCondition","changeJoinerArray","EditableTime","changeTime","prettifyTime","EventSelect","eventRenderer","eventName","EditableEventMeta","eventMeta","changeIndexEventName","changeEventName","values","EditableManualMeta","manualMeta","EditableMeta","TypeSelect","editableMetaDetails","editableGoal","DELETE_GOAL","CHANGE_META","CHANGE_TEXT","EditableGoal","isNewGoal","getGoalDefinition","goalClone","modifyGoalDefinition","removeGoalDefinition","GoalAdder","insertGoalDefinition","editableGoals","GoalEditor","generateEditableGoal","goalUuid","AchievementControl","bulkUpdateAchievements","bulkUpdateGoals","setAwaitPublish","forceUpdate","when","getAllGoals","getAllAchievements","getGoalsToDelete","getAchievementsToDelete","resetToDelete","AchievementControlContainer","AchievementInferencer","achievements","DashboardContainer","assessmentConfigurations","Achievement","toAchievementControl","Admin","Staff","exact","path","component","AchievementDashboard","AchievementContainer","dataVisualizerKeyMap","PREVIOUS_STEP","NEXT_STEP","SideContentDataVisualizer","onPrevButtonClick","currentStep","onNextButtonClick","steps","DataVisualizer","document","getElementById","classList","firstStep","finalStep","dataVisualizerHandlers","configure","ignoreEventsCondition","ignoreRepeatedEventsWhenKeyHeldDown","stopEventPropagationAfterIgnoring","step","justifyContent","alignItems","marginBottom","left","flexDirection","overflowX","elem","margin","marginTop","whiteSpace","RUNNING_TEXT","href","textbookChapter2_2","rel","SideContentEnvVisualizer","handleResize","debounce","newWidth","calculateWidth","newHeight","calculateHeight","updateDimensions","visualization","innerWidth","parseFloat","mobileBreakpoint","innerHeight","addEventListener","redraw","componentWillUnmount","cancel","removeEventListener","textbookChapter3_2","SourceRecorderControlBar","audio","handleSeeked","stopPreviousPlaybackAndApplyFromStart","playbackData","handleAudioLoaded","handleSetSourcecastDuration","duration","applyDeltas","deltas","handleSetCodeDeltasToApply","currentDeltaRevision","applyPlaybackDataFromStart","sleep","ms","setTimeout","currentRevision","currentTime","handleExternalSelect","codeDeltasToApply","deltaWithTime","futureData","handleSetInputToApply","handlePlayerPausing","pause","handleSetIsEditorReadonly","handleSetSourcecastStatus","PlaybackStatus","paused","stopCurrentPlayback","handlePlayerPlaying","play","playing","handlePlayerStopping","handleSetCurrentPlayerTime","currentPlayerProgress","updatePlayerTime","e","playbackStatus","forcedPaused","handlePlayerProgressBarChange","renderLabel","totalTime","sec","currentSourcecastItem","PlayerPlayButton","isDisabled","PlayerPauseButton","PAUSE","audioUrl","onEnded","onLoadedMetadata","onSeeked","onTimeUpdate","preload","stepSize","labelRenderer","SourceRecorderDeleteCell","isDialogOpen","setIsDialogOpen","handleCloseDialog","canOutsideClickClose","DIALOG_FOOTER_ACTIONS","handleDeleteSourcecastEntry","SourceRecorderSelectCell","handleSelect","handleSetSourcecastData","uid","url","PAPERCLIP","SourceRecorderShareCell","protocol","host","shareURL","SourcecastTable","defaultColumnDefs","gridApi","handleFilterChange","changeVal","filterValue","setQuickFilter","onGridReady","api","sizeColumnsToFit","onresize","columnDefs","headerName","field","cellRendererFramework","cellRendererParams","suppressMovable","suppressMenu","cellStyle","hide","valueGetter","getStandardDate","inserted_at","SourcastDeleteCell","sortable","groupFilterEnabled","resizable","loadingDisplay","sourcecastIndex","grid","labelFor","domLayout","defaultColDef","rowData","rowHeight","pagination","paginationPageSize","INTRODUCTION","dataVisualizerTab","dataVisualizer","envVisualizerTab","envVisualizer","Sourcecast","handleQueryParam","newUid","match","sourcecastId","cast","fetchSourcecastIndex","inputToApply","SourceRecorderTable","isEditorReadonly","isPlaying","sourcecastControlbarProps","playerTime","setCurrentPlayerTime","setCodeDeltasToApply","editorReadonly","setIsEditorReadonly","setInputToApply","setSourcecastDuration","currentPlayerTime","playbackDuration","SourcecastContainer","withRouter","sourcecast","externalLibrarySelect","setSourcecastData","setSourcecastStatus","AddUserPanel","setUsers","invalidCsvMsg","setInvalidCsvMsg","useRef","CSVReader","useCSVReader","onGridSizeChanged","suppressCellSelection","suppressMovableColumns","htmlSelectOptions","authProviders","provider","setProvider","onUploadAccepted","results","processed","uniqBy","validateCsvInput","delimiter","skipEmptyLines","getRootProps","acceptedFile","ProgressBar","getRemoveFileProps","inputProps","inline","handleAddNewUsersToCourse","BooleanCell","changeHandler","useCallback","setStateHandler","rowIndex","DeleteRowCell","handleDelete","deleteRowHandler","WARNING_SIGN","NumericCell","clampValueOnBlur","indexOfObject","arr","obj","AssessmentConfigPanel","assessmentConfig","setAssessmentConfig","setAssessmentConfigsToDelete","rowDrag","editable","temp","getDisplayedRowAtIndex","setDataValue","displayInDashboard","earlySubmissionXp","hoursBeforeEarlyXpDecay","deleted","setRowData","onRowDragMove","movingNode","node","overNode","movingData","overData","fromIndex","toIndex","element","moveInArray","onRowDragLeaveOrEnd","setHasChangesAssessmentConfig","rowDragManaged","suppressPaginationPanel","onRowDragLeave","onRowDragEnd","onCellValueChanged","colDef","assessmentConfigId","CourseHelpTextEditorTab","CourseConfigPanel","courseHelpTextSelectedTab","setCourseHelpTextSelectedTab","WRITE","courseName","courseShortName","viewable","enableGame","enableAchievements","enableSourcecast","moduleHelpText","courseConfiguration","writePanel","setCourseConfiguration","previewPanel","helperText","PREVIEW","RolesCell","handleUpdateUserRole","roleOptions","DeleteUserCell","handleDeleteUserFromCourse","UserConfigPanel","userCourseRegistrations","UserActionsCell","exportDataAsCsv","fileName","toISOString","columnKeys","AdminPanel","hasChangesCourseConfig","setHasChangesCourseConfig","hasChangesAssessmentConfig","assessmentConfigsToDelete","handleFetchCourseConfiguration","handleFetchAssessmentConfigs","handleFetchUserCourseRegistrations","courseConfigPanelProps","courseConfig","assessmentConfigPanelProps","deletedElement","userConfigPanelProps","addUserPanelProps","handleUpdateCourseConfig","handleDeleteAssessmentConfig","setAssessmentConfigurations","handleUpdateAssessmentConfigs","fullWidth","AdminPanelContainer","fetchCourseConfig","fetchAssessmentConfigs","fetchAdminPanelCourseRegistrations","updateCourseConfig","updateAssessmentConfigs","deleteAssessmentConfig","updateUserRole","deleteUserCourseRegistration","addNewUsersToCourse","gradingSummary","cols","startCase","rows","handleFetchGradingSummary","dashboard","fetchGroupGradingSummary","FontAssets","zektonFont","pngPath","fntPath","zektonDarkFont","alienCowsFont","alienLeagueFont","pixelFont","assetsFolder","sourceAcademyAssets","fadeDuration","nullFunction","nullInteractionId","nullSequenceNumber","popUpDuration","defaultAssetPath","defaultFontStyle","align","Phaser","GameObjects","BitmapText","ALIGN_CENTER","defaultCursor","screenSize","y","screenCenter","Color","navy","lightBlue","offWhite","white","darkGrey","lightGrey","blue","darkBlue","orange","yellow","red","maroon","black","purple","paleYellow","HexColor","str","parseInt","slice","Direction","calcTableFormatPos","Row","numOfItems","maxXSpace","maxYSpace","numItemLimit","redistributeLast","itemsPerList","numOfLists","ceil","itemNumber","itemIndexInList","listIndex","indexToCoordinate","screenSpace","listSpace","maxItems","partitionSpace","calcListFormatPos","xSpacing","ySpacing","pos","textHoverStyle","fontFamily","fontSize","wordWrap","defaultTextHoverWidth","CommonTextHover","Container","scene","renderTextHover","substring","hoverWidth","Text","cursorOffSet","hoverTextBg","Rectangle","getBounds","setOrigin","setAlpha","setDepth","setVisible","createBitmapText","oriX","oriY","listBannerTextStyle","ALIGN_LEFT","awardTitleStyle","awardKeyStyle","awardDescStyle","lineSpacing","defaultAwardProp","assetKey","assetPath","previewXPos","previewYPos","previewKeyYPos","AwardsConstants","arrow","xOffset","xScale","yScale","itemsPerPage","list","yStart","ySpace","listTextConfig","noPreviewTextConfig","preview","descText","yOffset","rect","dim","keyTagTextConfig","keyTextConfig","explanation","titleTextConfig","getAwardProps","awardKeys","getAwardProp","awardKey","awardProp","SourceAcademyGame","getInstance","getAwardsMapping","AssetType","AnimType","ImageAssets","spaceshipBg","Image","saBanner","shortButton","mediumButton","longButton","topButton","speechBox","speakerBox","defaultLocationImg","locationPreviewFrame","locationPreviewFill","talkOptButton","talkOptCheck","modeMenuBanner","popUpFrame","mediumBox","diamond","cookies","scrollFrame","messageBar","escapeMenuBackground","awardsMenu","awardsBanner","awardsPageChosen","awardsPage","awardsBackground","gear","journal","chapterRepeatButton","chapterContinueButton","StarGold","StarSilver","StarBronze","chapterSelectFrame","chapterSelectBorder","chapterSelectArrow","mainMenuOptBanner","settingBanner","settingOption","verifiedFrame","sourceCrashedPod","squareKeyboardIcon","medKeyboardIcon","musicFadeOutTween","volume","ease","GameSoundType","SoundAssets","buttonHover","soundType","SFX","buttonClick","radioButtonClick","dialogueAdvance","popUpEnter","popUpExit","menuEnter","menuExit","modeEnter","notifEnter","notifExit","radioStatic","galacticHarmony","loop","BGM","Layer","defaultLayerSequence","Background","Selector","Objects","BBox","Character","Speaker","PopUp","Dialogue","SpeakerBox","Effects","Escape","UI","WorkerMessage","limitNumber","toS3Path","courseCoded","startsWith","substr","assetsPrefix","mandatory","object","errorMsg","getState","fadeOut","targets","alpha","fadeIn","fadeAndDestroy","tween","destroy","blackScreen","blink","gameObject","setInterval","tweens","clearInterval","entryTweenProps","exitTweenProps","rightSideEntryTweenProps","rightSideExitTweenProps","messageTextConfig","messageStyle","ALIGN_RIGHT","displayMiniMessage","displayMessagesPromise","container","messageBg","Sprite","setScale","messageText","getLayerManager","addToLayer","setPosition","getSoundManager","playSound","displayMiniMessageHelper","makeMiniMessageDisplayer","DialogueConstants","prompt","xPad","yPad","dialogueRectMargin","speakerTextConfig","textTypeWriterStyle","speakerTextStyle","Typewriter","textStyle","typeWriterInterval","textSprite","typeWriting","charPointer","clearTyping","changeLine","DialogueRenderer","typewriterStyle","typewriter","dialogueBox","blinkingDiamond","gameManager","GameGlobalAPI","getGameManager","setInteractive","useHandCursor","pixelPerfect","dialogueConstants","createTypewriter","drawDiamond","getDialogueContainer","diamondSprite","setDisplaySize","clearBlink","getDialogueBox","off","Input","Events","GAMEOBJECT_POINTER_UP","changeText","notifStyle","notifTextConfig","createButton","textConfig","bitMapTextStyle","onDown","onUp","onHover","onOut","onPointerMove","onHoverEffect","onClickSound","onHoverSound","button","addListener","GAMEOBJECT_POINTER_OVER","GAMEOBJECT_POINTER_OUT","GAMEOBJECT_POINTER_DOWN","GAMEOBJECT_POINTER_MOVE","pointer","localX","localY","PromptConstants","textPad","yInterval","promptOptStyle","promptWithChoices","choices","promptContainer","header","promptHeaderBg","promptBg","buttonPositions","activatePromptContainer","response","GamePhaseType","GameTerminalPhaseType","EscapeMenu","static","instance","setGameManager","gameManagerRef","getCurrLocId","currentLocationId","getLocationAtId","locationId","getStateManager","getGameMap","locationName","changeLocationTo","getLocationModes","addLocationMode","removeLocationMode","hasTriggeredInteraction","triggerStateChangeAction","actionId","triggerInteraction","watchGameItemType","gameItemType","stateObserver","getGameItemsInLocation","addItem","itemId","removeItem","makeObjectGlow","objectId","turnOn","getObjectManager","makeObjectBlink","setObjProperty","newObjProp","renderObjectLayerContainer","renderObjectsLayerContainer","getAllActivatables","getActivatables","getBBoxManager","setBBoxProperty","newBBoxProp","renderBBoxLayerContainer","areAllObjectivesComplete","isObjectiveComplete","areObjectivesComplete","completeObjective","isTaskComplete","areTasksComplete","completeTask","showTask","getAllVisibleTaskData","addCollectible","getUserStateManager","userStateType","isInUserState","clearSeveralLayers","layerTypes","layer","gameObj","showLayer","hideLayer","fadeInLayer","fadeOutLayer","dialogueRenderer","notifText","showNotification","displayNotification","actionIds","getPhaseManager","pushPhase","Sequence","getActionManager","processGameActions","popPhase","dialogueId","getDialogueManager","showDialogue","storeDialogueLine","newLine","newSpeakerDetail","getDialogueStorageManager","storeLine","getDialogueStorage","collectibleId","displayPopUp","getPopupManager","destroyAllPopUps","destroyPopUp","getSaveManager","saveGame","settingsJson","saveSettings","getLoadedUserState","soundKey","playBgMusic","stopAllSound","pauseCurrBgMusic","continueCurrBgMusic","applySoundSettings","userSettings","applyUserSettings","loadSounds","soundAssets","startAnimation","startFrame","frameRate","startImage","getAssetByKey","getAssetKeyFromId","getAnimationManager","displayAnimation","stopAnimation","stopImage","setDefaultCursor","cursor","getInputManager","enableKeyboardInput","active","enableMouseInput","enableSprite","disable","gamePhaseType","swapPhase","isCurrentPhase","renderBackgroundLayerContainer","getBackgroundManager","loadAssessments","createCharacterSprite","characterId","overrideExpression","overridePosition","getCharacterManager","moveCharacter","newLocation","newPosition","updateCharacter","expression","getDialogueById","getDialogueMap","getCharacterById","getCharacterMap","getActionById","getActionMap","getObjectById","getObjectPropMap","getBBoxById","bboxId","getBBoxPropMap","GameStateStorage","UserStateType","GameActionType","GameItemType","ActionConditionChecker","actionConditions","all","checkConditionSatisfied","actionCondition","every","conditional","conditionParams","boolean","UserState","ChecklistState","TasklistState","GameActionExecuter","actionType","actionParams","globalAPI","AddItem","RemoveItem","AddLocationMode","RemoveLocationMode","MoveCharacter","UpdateCharacter","ChangeBackground","StartAnimation","StopAnimation","PreviewLocation","ObtainCollectible","obtainCollectible","CompleteObjective","CompleteTask","ShowTask","ShowDialogue","showDialogueInSamePhase","AddPopup","MakeObjectBlink","MakeObjectGlow","PlayBGM","PlaySFX","ShowObjectLayer","NavigateToAssessment","promptNavigateToAssessment","UpdateAssessmentStatus","updateAssessmentState","Delay","GameActionManager","executeGameAction","processGameAction","isRepeatable","interactionId","checkCanPlayAction","isStateChangeAction","checkAllConditionsSatisfied","GameAnimationManager","game","animationInstanceMap","Map","isSprite","image","createImage","createAnimation","getAnimation","centreX","centreY","img","animType","currLoc","objects","removeAnimation","sprite","frames","anims","generateFrameNumbers","endFrame","first","repeat","set","existing","stop","anim","remove","resize","displayHeight","displayWidth","resizeOverflow","resizeUnderflow","GameAwardsManager","awardsGetter","uiContainer","previewContainer","itemsContainer","activePageNumber","createUIContainer","awardContainer","arrowLeft","nextPage","setRotation","PI","arrowRight","assetKeyCont","rectDim","assetKeyBg","assetKeyTagBg","originX","assetKeyTag","hoverCont","createAssetKeyPreviewCont","setPage","createItemsContainer","setPreview","award","previewAsset","previewRect","previewTitle","previewDesc","previewKey","blackTint","next","currPageNum","newPageNum","MAX_SAFE_INTEGER","getItems","itemPositions","createItemButton","xPos","yPos","pageNum","itemList","itemStartIdx","GameBackgroundManager","currentBackground","renderBackgroundImage","animationManager","asset","GameBoundingBoxManager","bboxes","boundingBoxes","bboxIdsToRender","clear","handleAdd","createBBox","bboxProperty","bboxSprite","isInteractive","clickArea","bboxProp","bbox","handleMutate","from","CharConstants","charWidth","charRect","Left","Middle","Right","CharacterManager","characterSpriteMap","characters","renderCharacterLayerContainer","idsToRender","character","defaultPosition","defaultExpression","expressions","scale","characterXPosition","characterSprite","char","pageBannerTextStyle","DashboardConstants","backButton","page","pageTextConfig","pageArea","DashboardPage","GameDashboardManager","pages","pageManagers","pageMask","pageChosenContainer","pageUIContainers","currPageIndex","createPageMask","addPhaseToMap","shape","Graphics","fillRect","createGeometryMask","pageIndex","currPageUIContainer","newPageUIContainer","setMask","bannerPos","getPageOptPositions","chosenIdx","bannerChosen","dashboardContainer","blackUnderlay","dashboardBg","pageOptButtons","pageOptButtonPositions","createPageOpt","geometryMask","DialogueGenerator","dialogueContent","currPart","currLineNum","dialogueLine","goto","part","GameActionConditionChecker","altPart","updateCurrPart","GamePosition","GameSize","StringUtils","lines","headerAndBodyLines","trim","isHeaderFunction","currHeader","sep","substrings","phrase","splitByChar","trimRight","removeMultiLineComments","removeSingleLineComment","commentChars","removeAfter","commentIndex","indexOf","openCommentChars","closeCommentChars","newLines","commentOpen","l","commentRegions","openIns","findAllInstances","closeIns","activeIndex","openInd","closeInd","region","prevActive","removeCommentRegions","regions","newString","prevEnd","indices","word","charAt","capitalize","num","DialogueSpeakerRenderer","currentSpeakerId","getUsername","getAccountInfo","changeSpeakerTo","showNewSpeaker","drawSpeakerSprite","drawSpeakerBox","speakerId","speakerContainer","createSpeakerBox","speakerPosition","speakerSprite","rectangle","speakerText","DialogueManager","speakerRenderer","dialogueGenerator","getDialogueGenerator","getDialogueRenderer","getSpeakerRenderer","dialogue","playWholeDialogue","showNextLine","speakerDetail","generateNextLine","lineWithName","promptTitle","choice","processGameActionsInSamePhase","GameDialogueStorageManager","dialogueStorage","newDialogue","speaker","getSpeakerName","clearDialogueStorage","storageLine","barX","barWidth","barY","innerBarX","innerBarY","addLoadingScreen","progressBar","progressBox","loadingScreenBg","load","graphics","fillStyle","barHeight","CommonRadioButton","defaultChoiceIdx","radioChoiceConfig","circleDim","checkedDim","outlineThickness","choiceTextConfig","bitmapTextStyle","buttonClickSoundKey","activeChoice","activeChoiceIdx","buttons","getRadioButtons","renderRadioButtons","activate","buttonPos","createRadioButton","Ellipse","setStrokeStyle","choiceText","optionChecked","getValueIdx","getChoices","getChosenChoice","optionTextStyle","optionHeaderTextStyle","applySettingsTextStyle","SettingsConstants","optHeaderTextConfig","opt","xSpace","radioButtonsTextConfig","volContainerOpts","escapeOptButtonStyle","volumeRadioOptTextStyle","optTextStyle","EscapeConstants","escapeOptTextConfig","settings","settingsTextConfig","radioButtons","radioChoiceTextConfig","volOpt","GameEscapeManager","bgmVolumeRadioButtons","sfxVolumeRadioButtons","getSettingsSaveManager","escapeMenuContainer","escapeMenuBg","getSettings","settingsPos","Column","setting","bgmVolume","sfxVolume","sfxVolIdx","findIndex","bgmVolIdx","createSettingsRadioOptions","getOptButtons","createEscapeOptButton","cleanUp","isGameType","GameType","Simulator","applySettings","sfxVol","newSettings","clearListeners","clearAllLayers","activateUI","deactivateUI","GameInputManager","keyboardListeners","eventListeners","mouse","enabled","keyboard","registerKeyboardListener","keyboardListener","addKey","registerEventListener","eventListener","concat","removeAllListeners","GameLayerManager","layers","getLayer","layerType","layerToHide","layerToShow","layerToFadeIn","layerToFadeOut","layerContainer","clearLayerContents","logTextStyle","scrollbarX","LogConstants","logTextConfig","textMaxWidth","logHeight","scrollbarTrack","scrollbarThumb","scrollSpeed","GameLogManager","logContainer","textLog","bitmapText","setMaxWidth","textMinY","scrollbarThumbHeight","scrollbarThumbMaxY","thumbTextScrollRatio","scrollZone","Zone","deltaX","deltaY","deltaZ","GlowingImage","imageGlow","glowClearer","blinkClearer","setBlendMode","BlendModes","ADD","getMapAssets","imageAsset","startGlow","clearGlow","startBlink","getContainer","getClickArea","GameObjectManager","objIdsToRender","createObject","objectProperty","objectProp","GamePhaseManager","phaseMap","inputManager","phaseStack","interruptCheckCallback","interruptTransitionCallback","transitionCallback","None","gameUI","setInterruptCheckCallback","setInterruptCallback","setCallback","prevPhase","pop","executePhaseTransition","getCurrentPhase","newPhase","phase","isCurrentPhaseTerminal","PopUpConstants","Small","Medium","Large","tweenDuration","GamePopUpManager","currPopUp","popUpFrameImg","getAssetKey","popUpImage","setActive","scaleY","scrollEntry","popUp","atPosContainer","scrollExit","objProp","createEmptyGameSaveState","lastCheckpointPlayed","currentLocation","currentPhase","Menu","chapterNewlyCompleted","incompleteTasks","completedTasks","completedObjectives","triggeredInteractions","triggeredStateChangeActions","convertMapToArray","completionMap","_objective","objective","GameStateManager","gameCheckpoint","subscribers","gameMap","checkpointObjective","checkpointTask","updatedLocations","getCharacterAtId","getChapterNewlyCompleted","objectives","tasks","getLocationIds","loadStatesFromSaveManager","getTriggeredStateChangeActions","getTriggeredInteractions","getCompletedObjectives","setObjective","getCompletedTasks","task","setTask","getIncompleteTasks","getSubscriberForItemType","addLocationNotif","removeLocationNotif","hasLocationNotif","has","isCurrentLocation","modes","setItemInMap","getLocations","locId","newExpression","isAllComplete","getObjectiveState","getTaskState","getObjectives","getAllTasks","getAllIncompleteTasks","taskTextStyle","TaskLogConstants","taskTextConfig","checkMark","imageUrl","GameTaskLogManager","taskLogContainer","tasksData","taskListContainer","totalTextHeight","taskTitle","underline","taskDescription","taskListContainerMinY","buttonConfigs","phaseManager","ToolbarConstants","firstButton","GameToolbarManager","toolbarContainer","buttonConfig","createToolbarButton","backTextYPos","backButtonStyle","CommonBackButton","renderBackButton","ExploreModeConstants","normal","hover","GameModeExplore","exploreMenuContainer","enableInteractions","disableInteractions","activatable","explorePointerOut","explorePointerOver","explorePointerUp","GameMode","gameModeToPhase","Move","Explore","Talk","modeButtonStyle","MenuModeConstants","GameModeMenu","getLatestLocationModes","currLocId","latestModesInLoc","talkTopics","modeMenuContainer","modeBanner","getModeButtons","createModeButton","moveButtonStyle","MoveModeConstants","xOffSet","GameModeMove","setTexture","getLatestNavigations","navigation","moveMenuContainer","previewFrame","previewFill","navigations","getMoveButtons","createMoveButton","previewSprite","previewLoc","previewDefault","nav","GameModeSequence","talkButtonStyle","TalkModeConstants","GameModeTalk","getLatestTalkTopics","talkMenuContainer","getTalkTopicButtons","createTalkTopicButton","checkedSprite","dialogueIds","GameManager","Scene","hasTransitioned","stateManager","layerManager","objectManager","characterManager","dialogueManager","actionManager","boundingBoxManager","popUpManager","backgroundManager","escapeManager","collectibleManager","achievementManager","logManager","dialogueStorageManager","toolbarManager","taskLogManager","dashboardManager","getEscapeManager","getCollectibleManager","getAchievementManager","getLogManager","getToolbarManager","getTaskLogManager","getDashboardManager","continueGame","chapterNum","checkpointNum","setCurrentSceneRef","registerGameInfo","getLoadedLocation","startingLoc","GameCharacterManager","GameDialogueManager","GameBBoxManager","getCollectibles","Log","Tasks","Collectibles","Achievements","transitionChecker","checkpointTransition","handleCharacterLayer","preloadLocationsAssets","bindKeyboardTriggers","getSoundAssets","loadImage","spritesheet","startAction","gameLocation","renderToolbarContainer","bgmKey","fastForwardGameActions","getGameStartActions","bringUpUpdateNotif","delay","fadeBlack","blackFade","renderLocation","Keyboard","KeyCodes","ESC","TAB","getCheckpointCompleteActions","GameSaveManager","fullSaveState","getGameSaveState","getLoadedPhase","getChapterNum","getCheckpointNum","getFullSaveState","gameSaveStates","userSaveState","collectibles","recentlyPlayedCheckpoint","largestCompletedChapter","method","headers","createHeaders","accessToken","resp","fetch","backendUrl","json","courseRegistration","gameStates","isEmpty","loadData","getCurrentSceneRef","prevGameState","gameStateManager","gameStateToJson","saveData","completedChapter","getLargestCompletedChapterNum","getChapterSaveState","defaultGlitchStyle","workerALines","workerTLines","WorkerConstants","putWorkerMessage","workerId","showLines","blackOverlay","linesPos","yStartPos","textFrames","baseTextConfig","numOfFrames","maxXDisplacement","maxYDisplacement","random","SCREEN","yoyo","loopDelay","createGlitchBitmapText","AwardsHallConstants","tileDim","maxAwardsPerCol","awardInfo","banner","bannerTextConfig","awardBannerTextStyle","awardNoAssetTitleStyle","awardHoverTitleStyle","awardHoverKeyStyle","awardHoverDescStyle","AwardsHall","backgroundTile","awardsContainer","isScrollLeft","isScrollRight","scrollLim","awardXSpace","achievementLength","collectibleLength","renderBackground","renderAwards","update","newXPos","tilePositionX","TileSprite","banners","bannerCont","createBanner","leftArrow","rightArrow","getAwards","achievementsPos","createAward","collectiblesPos","collectible","awardCont","hoverContainer","awardTitle","awardAssetKey","awardDesc","scrollFrameTop","scrollFrameBot","createAwardsHoverContainer","bannerContainer","bannerBg","bannerText","BindingConstants","keyDescTextConfig","keyStyle","keyDescStyle","Bindings","renderBindings","bindingsContainer","bindings","getBindings","bindingPositions","binding","createBinding","desc","bindingContainer","keyIcon","keyText","keyDesc","textures","once","loadText","cache","chapterIndexStyle","chapterTitleStyle","pageNumberStyle","chapConstants","playButton","indexTextConfig","pageNumberTextConfig","imageRect","originalImageRectWidth","originalImageRectHeight","imageScale","chapComplete","chapPerRow","chapPerCol","chapPerPage","chapGapX","chapGapY","toTxtPath","TextAssets","defaultCheckpoint","awardsMapping","roomPreviewMapping","MockTextAssets","GameMap","mapAssets","locations","dialogues","actions","gameStartActions","checkpointCompleteActions","addSoundAsset","soundAsset","addMapAsset","addLocation","setModesAt","setNavigationFrom","getNavigationFrom","setGameStartActions","setCheckpointCompleteActions","addItemToLocation","setBGMusicAt","GameObjective","totalNumOfObjectives","numOfCompletedObjectives","prevState","addObjective","addObjectives","objState","setObjectives","GameTask","taskDetails","prevDetail","newDetail","visible","addTask","newTask","taskId","addTasks","newTasks","taskState","getTaskDetail","taskDetail","allVisibleTask","stringToSizeMap","small","medium","stringToPositionMap","middle","stringToGameModeMap","talk","explore","move","menu","stringToGameItemMap","stringToActionTypeMap","move_character","update_character","obtain_collectible","complete_objective","complete_task","show_task","add_item","remove_item","change_background","start_animation","stop_animation","show_dialogue","add_mode","remove_mode","add_popup","make_object_glow","make_object_blink","play_bgm","play_sfx","preview_location","show_object_layer","navigate_to_assessment","update_assessment_status","stringToGameStateStorageMap","checklist","tasklist","userstate","stringToUserStateTypeMap","ParserConverter","GameEntityType","ParserValidator","gameItemAsserts","gameEntityAsserts","gameAnimAsserts","gameAnimMaps","Parser","checkpoint","allItemIds","registerId","verifyAssertions","verifyGameItemAssert","verifyGameEntityAsserts","verifyGameAnimAsserts","assertItemType","assertionDetails","assertionDetail","actionAssertionError","assertItemTypes","itemIds","assertEntityType","gameEntityType","bgms","numberOfBgm","sound","sfxs","numberOfSfx","assertAnimType","idFound","attribute","ConditionParser","conditionDetails","hasExclamation","gameStateStorage","condParams","stringToGameStateStorage","validator","stringToUserStateType","ActionParser","fullActionStrings","fullActionString","parseAction","rawActionString","actionString","conditionalsString","gameAction","parseActionContent","actionParamString","repeatable","gameActionType","stringToActionType","actionParamObj","assetCategory","stringToGameItemType","stringToGameMode","stringToPosition","stringToSize","stringToBoolean","generateActionId","PromptParser","splitChoice","rawChoice","splitWithLimit","CharacterParser","characterList","characterDetails","parseCharacterDetails","addToLoc","characterAssetKey","characterAssetPath","SpeakerParser","rawStr","speakerPositionStr","addCharacterExprToMap","charId","charExpression","isInteger","RegExp","test","isGotoLabel","isActionLabel","isSpeaker","isPrompt","isPromptChoice","MusicParser","soundList","musicDetails","musicIndex","actionIdNum","chapterText","checkPointLines","splitToLinesAndRemoveComments","splitToParagraph","parseCheckpointConfig","parseCheckpointParagraphs","locationBody","parseLocationConfig","parseLocationParagraphs","locationConfig","configValues","gameMode","otherLocationId","previewPath","entityHeader","objectList","parseObjectConfig","parseActions","shortPath","objectDetails","objectAssetKey","objectPath","frameHeight","frameWidth","boundingBoxList","boundingBox","parseBBoxConfig","bboxDetails","checkpointConfig","locationDetails","locationDetail","locationAssetKey","locationPath","dialogueText","dialogueDetails","dialogueBody","parseDialogue","parseDialogueContent","toCapitalizedWords","newMap","mapValues","mapByHeader","createDialogueLines","dialogueLines","currIndex","gotoString","rawTitle","rawChoices","parsePrompt","lastLine","nextLine","callGameManagerOnTxtLoad","textAssets","getIsUsingMock","filename","getGameChapters","filenames","defaultCheckpointText","callGameManagerForSim","checkpointFilenames","getSSChapterSimFilenames","createChapter","centreCol","centreRow","getCoorByChapter","chapterContainer","chapterDone","chapterPreview","chapterFrame","chapCompleteRect","chapCompleteText","chapterRepeatHover","chapterContinueHover","chapterRepeat","chapterContinue","chapterIndexText","chapterTitleText","chapterAccessible","ChapterSelect","chaptersContainer","backButtonContainer","pageNumberText","targetPage","preloadChapterAssets","renderChapters","targetX","chapterDetail","createChaptersContainer","numPages","latestChapter","setText","border","scrollPrevPage","scrollNextPage","chapterIndex","reverse","transitionTextStyle","CheckpointConstants","transitionTextConfig","entryTween","exitTween","CheckpointTransition","showTransitionText","loadedGameState","chapterDetails","currChapter","currCheckpoint","isLastCheckpoint","saveChapterComplete","isLastChapter","transitionText","mainMenuStyle","MainMenuConstants","studentRoom","awards","buttonTextConfig","xHide","onFocusTween","outFocusTween","MainMenu","renderOptionButtons","backgroundImg","optionsContainer","getOptionButtons","createOptionButton","tweenOnHover","tweenOffHover","optButton","roomDefaultCode","verifiedStyle","RoomConstants","verifiedText","tag","hoverTagTextConfig","refreshButton","getRoomPreviewCode","roomAssessmentId","roomAssessment","getAssessmentOverviews","getRoomAssessmentId","getStudentRoomCode","getAssessment","mission","progQn","RoomPreview","studentCode","preloadImageMap","preloadSoundMap","preloadSpritesheetMap","verifCont","getVerifCont","getRoomCode","hoverTextFrame","hoverLine","DIFFERENCE","createVerifiedHoverContainer","eval","renderDefaultBackground","loadSpritesheet","roomRefreshHover","loadRoomCode","stopAll","restart","initialiseManagers","moduleContexts","remotePath","file","runInContext","defaultAward","attachVerificationTag","backgroundAsset","getDefaultBackgroundKey","completedAssessmentIds","getAssessments","backgroundMapping","getRoomPreviewMapping","Settings","renderOptions","settingBgImg","optCont","optHeader","getSettingsHeader","optHeaderPos","createOptionHeader","createOptRadioOptions","applySettingsButton","optHeaderCont","headerDiv","headerText","bgmVol","GameSoundManager","soundAssetMap","currBgMusicKey","currBgMusic","getBaseSoundManager","getCurrentScene","getSoundAsset","setVolume","loadSound","loadSoundAssetMap","assetMap","vol","isMounted","fadeOutAndDestroyMusic","isPaused","GameChapterMocks","AwardParser","assetText","assetLines","splitToLines","awardBody","parseAwardParagraphs","awardProperties","RoomPreviewParser","assesmentId","Entry","preloadAssets","loadGameChapters","loadLastSaveState","preloadAwards","loadUserState","preloadRoomPreviewBackgrounds","applyLoadedSettings","awardsMappingTxt","setAwardsMapping","roomPreviewMappingTxt","setRoomPreviewMapping","bitmapFont","GameUserStateManager","loadAchievements","b","Game","goalMapping","isCompleted","newAwardProp","addAwardMapping","gameType","global","accountInfo","soundManager","userStateManager","saveManager","currentSceneRef","ssChapterSimFilenames","isUsingMock","roomCode","gameChapters","setStorySimState","stopAllSounds","setAccountInfo","setAchievements","awardId","setGoals","setStorySimStateSetter","mapping","refreshToken","shouldAutoLogout","shouldRefresh","sortedChapters","fetchGameChapters","toggleUsingMock","setChapterSimStack","debug","physics","default","FIT","parent","fps","ok","Headers","append","isTestStudent","setIsTestStudent","setIsUsingMock","alert","makeAnchorButton","anchorButtonProps","ex","defaultPrevented","metaKey","altKey","ctrlKey","shiftKey","navigate","AnchorButtonLink","GradingActionsCell","isOwnSubmission","studentId","canReautograde","submissionStatus","canUnsubmit","groupLeaderId","handleReautogradeSubmission","handleUnsubmitSubmission","GradingStatusCell","gradedCount","questionCount","gradingEditorButtonClass","mdeToBlueprintIconMap","HEADER","bold","BOLD","italic","ITALIC","STRIKETHROUGH","link","LINK","quote","CITATION","MEDIA","UNGROUP_OBJECTS","NUMBERED_LIST","SQUARE","mdeToBlueprintIconMapping","GradingEditor","xpAdjustmentInput","setXpAdjustmentInput","xpAdjustment","setEditorValue","currentlySaving","setCurrentlySaving","makeInitialState","validateXpBeforeSave","handleSaving","newXpAdjustmentInput","initialXp","checkHasUnsavedChanges","saveButtonOpts","discardButtonOpts","saveAndContinueButtonOpts","totalXp","xpPlaceholder","studentName","handleReautogradeAnswer","valueAsNumber","valueAsString","buttonPosition","majorStepSize","onTabChange","generateMarkdownPreview","markdown","minEditorHeight","maxEditorHeight","minPreviewHeight","getIcon","blueprintIcon","htmlTitle","handleGradingSave","confirm","UPDATED","handleGradingSaveAndContinue","GradingEditorContainer","submitGrading","submitGradingAndContinue","reautogradeAnswer","GradingWorkspace","grade","student","gradingWorkspacePath","handleGradingFetch","storedSubmissionId","handleUpdateCurrentSubmissionId","handleResetWorkspace","handleClearContext","handleRunAllTestcases","GradingWorkspaceContainer","gradings","currentSubmission","shouldInitLibrary","fetchGrading","testcaseId","updateCurrentSubmissionId","unsavedChanges","GradingXPCell","xpBonus","currentXp","Grading","GradingStatus","NotificationBadgeCell","GradingExp","resizeGrid","updatePaginationState","newTotalPages","paginationGetTotalPages","newCurrPage","paginationGetCurrentPage","currPage","maxPages","rowCountString","formatRowCountString","paginationGetRowCount","isBackDisabled","isForwardDisabled","pageSize","totalRows","handleFilterKeypress","applyFilter","handleApplyFilter","handleGroupsFilter","handleFetchGradingOverviews","exportCSV","changePaginationView","paginationGoToFirstPage","paginationGoToPreviousPage","paginationGoToNextPage","paginationGoToLastPage","sortSubmissionsByNotifications","gradingOverviews","subX","subY","suppressSizeToFit","valueFormatter","backgroundColor","GREEN5","RED5","comparator","valueA","valueB","nodeA","nodeB","isInverted","colId","controls","onKeyPress","onBlur","GIT_REPO","CHEVRON_BACKWARD","CHEVRON_LEFT","CHEVRON_FORWARD","EXPORT","onPaginationChanged","GradingContainer","fetchGradingOverviews","unsubmitSubmission","reautogradeSubmission","DefaultChapterSelect","handleUpdateSublanguage","chosenSublang","setSublanguage","setDialogState","handleOpenDialog","handleConfirmDialog","chapterRenderer","lang","displayName","chapterListRenderer","itemsParentRef","renderItem","defaultChoices","defaultLanguages","variantChoices","variantLanguages","ulRef","DefaultChapterSelectComponent","dialog","canEscapeKeyClose","styliseSublanguage","itemListRenderer","DOUBLE_CARET_VERTICAL","DefaultChapterSelectContainer","defaultSourceChapter","changeSublanguage","DeleteCell","handleDeleteAssessment","MaterialDropzone","setFile","isWarningShown","setPromptShown","setForceUpdate","setAssessmentConfigId","handleUploadAssessment","handleConfirmUpload","handleCancelUpload","handleDropAccepted","acceptedFiles","handleDropRejected","rejectedFiles","getInputProps","isFocused","isDragActive","isDragAccept","isDragReject","useDropzone","multiple","onDropAccepted","onDropRejected","handleSwitchOnChange","handleConfirmForceUpdate","handleCancelForceUpdate","confirmationPrompt","TWO","interactive","UPLOAD","DELETE","dateDisplayFormat","EditCell","minDate","maxDate","forOpenDate","currentDateString","currentDate","newDate","setNewDate","handleAssessmentChangeDate","handleUpdateDate","handleDateChange","selectedDate","handleDateError","dateInput","formatDate","onError","parseDate","toDate","timePrecision","closeOnSelection","INFO_SIGN","PublishCell","handlePublishAssessment","handleTogglePublished","GroundControl","columnApi","loadContent","handleFetchCourseConfigs","dateFilterComparator","filterDate","cellValue","cellDate","applyColumnState","toggleDropzone","showDropzone","filterParams","inRangeInclusive","sortingOrder","REFRESH","dropzone","GroundControlContainer","changeDateAssessment","deleteAssessment","uploadAssessment","publishAssessment","SourcereelControlbar","recorder","dialogOpen","updateTimerDuration","getTimerDuration","handleTruncatePlaybackData","truncatedInputs","handleResetInputs","handleRecorderPausing","handleTimerPause","updater","URL","createObjectURL","exportWAV","handleRecorderStarting","Recorder","handleRecordInit","handleTimerStart","handleRecorderResuming","handleTimerResume","resume","handleRecorderResumingFromCurrent","handleRecorderStopping","handleTimerStop","fileDataBlob","handleRecorderResetting","handleTimerReset","handleRecorderSaving","handleSaveSourcecastData","saveTitle","saveDescription","saveUID","handleSaveTitleInputChange","handleSaveDescriptionInputChange","handleSaveUIDInputChange","getPermission","RecorderRecordPauseButton","SNOWFLAKE","handleRecordPause","RecorderPauseButton","RecorderResumeButton","RecorderResumeFromCurrentButton","RecorderStartButton","RecorderStopButton","RecorderResetButton","RecorderSaveButton","LIST_DETAIL_VIEW","KEY","recordingStatus","RecordingStatus","notStarted","recording","finished","Sourcereel","sourcereel","timeElapsedBeforePause","timeResumed","handleRecordInput","isRecording","COMPASS","saveSourcecastData","SourcereelContainer","readonly","StorySimState","sendRequest","route","requestPath","headerConfig","requestDetails","sendAssetRequest","sendStoryRequest","sendAdminStoryRequest","s3AssetFolders","fetchTextAssets","fetchFolder","endsWith","fetchAssetPaths","files","folderName","combinedList","newList","uploadAssetsToS3","fileList","responses","formData","FormData","uploadAssetToS3","fetchChapters","updateChapterRequest","specifyFolderText","AssetFileUploader","setFileList","uploadFolder","setUploadFolder","folderOverwrite","setFolderOverwrite","showfolderOverwrite","setShowFolderOverwrite","handleChangeUploadFolder","innerText","uploadButtonPopoverContent","folder","BOTTOM","loadedFiles","finalFolder","treeMap","nodes","childNodes","assetPathsToTree","assetPaths","iconRenderer","rootFolders","assetObj","helper","parentFolders","secondaryLabel","AssetViewer","memo","displayAssetPath","crossOrigin","toolIcons","filePath","deleteFile","deleteS3File","StorySimulatorAssetSelection","useRequest","currentAsset","setCurrentAsset","assetTree","setAssetTree","StorySimulatorAssetViewer","onNodeClick","nodeData","isSelected","selectedPath","sessionStorage","setItem","SortableItem","SortableElement","SortableList","SortableContainer","ChapterEditor","setValue","setTitle","titleProps","useInput","setImageUrl","imageUrlProps","chosenFiles","setItems","setChosenFiles","onSortEnd","oldIndex","newIndex","arrayMoveImmutable","useSortableList","setIsPublished","openDate","setOpenDate","txtsNotChosen","setTxtsNotChosen","rerender","setRender","textAsset","deleteFileFromChosen","txtFile","prevItemList","addFileToChosen","textFile","labelElement","updatedChapter","inAYear","createChapterIndex","story","deleteChapterRequest","setFullYear","getFullYear","defaultChapter","ChapterSim","chapters","chosenIndex","setChosenIndex","StorySimulatorChapterEditor","mainMenuOptStyle","SSMainMenuConstants","maxOptButtonsRow","gameTxtStorageName","checkpointTxt","loadFileLocally","storageName","reader","FileReader","readAsText","onloadend","CheckpointTxtLoader","s3TxtFiles","chosenFilename","setChosenFilename","uploadButton","chooseS3Txt","createHeadersWithCors","txt","CheckpointSim","mainMenuConstants","simulateCheckpoint","clearSessionStorage","SSImageAssets","storySimBg","invertedButton","blueUnderlay","colorIcon","imageIcon","bboxIcon","handIcon","listIcon","eraseIcon","iconBg","createOptButton","ObjectPlacement","AssetUploader","defaultChapterText","getItem","backgroundUnderlay","SSBackgroundManager","backgroundAssetPath","objectPlacement","getObjectPlacement","initialise","backgroundAssetKey","addAsset","assetKeyOnLoad","backgroundSprite","getBackgroundAssetPath","screenLog","CursorMode","SSBBoxManager","checkpointTitle","bboxBeingDrawn","startingCoordinates","bboxDetailMap","addBBoxListeners","isCursorMode","DrawBBox","createNewBBox","registerBBox","setDraggable","setActiveSelection","getCoordinates","setDataEnabled","generateItemIdNumber","objectDetail","getLoggables","getItemById","resizeWhileBeingDrawn","startX","startY","currentX","currentY","checkpointTxtLog","bboxDetail","bboxDetailArray","toIntString","setAttribute","deleteAll","SSCursorModeConstants","bgSize","inactive","SSCursorMode","defaultCursorMode","DragResizeObj","isModes","currCursorMode","cursorModes","currActiveModeIdx","getCurrCursorMode","setCursorMode","newMode","addCursorMode","isMode","cursorModeContainer","currIdx","modeButton","renderCursorModesContainer","activeMode","modeIcon","removeAll","spacing","loggableStyle","getIdFromShortPath","padWithTab","SSLogManager","detailMapContainer","printCheckpoint","locationAssetPath","checkpointLoggers","loggables","checkpointLogger","showDetailMap","loggable","loggerRectangle","loggerText","formatObjectDetails","setLetterSpacing","hideDetailMap","SSObjectManager","objectDetailMap","renderObject","objectSprite","registerObject","generateItemId","getAssetPath","objectIdNumber","objectDetailArray","itemDetail","TransformConstants","activeSelectMargin","scaleFactor","SSTransformManager","activeSelection","activeSelectRect","trackDraggables","drawActiveSelectRect","bindDeleteKey","dragX","dragY","getCursorManager","setObjAttribute","setBBoxAttribute","resizeActive","enlarge","factor","multiplyDimensions","abs","deselect","BACKSPACE","deleteActiveSelection","getType","deleteObj","deleteBBox","ObjPlacementConstants","transformManager","bboxManager","itemIdNumber","openBracket","closedBracket","createUIButtons","OPEN_BRACKET","CLOSED_BRACKET","isDown","Default","populateCursorModes","loadBackground","loadObject","cursorMode","StorySimulator","storySimState","createStorySimulatorGame","StorySimulatorAssetFileUploader","StorySimulatorChapterSim","XpCalculation","allUserXp","setGridApi","pageState","setPageState","nusNetId","assessmentXp","achievementXp","Controls","LoadingDisplay","Content","fetchAllUserXp","Academy","useRouteMatch","fetchNotifications","staffRoutes","gradingRegExp","assessmentRegExp","CourseSelectingAcademy","routeCourseIdStr","routeCourseId","updateLatestViewedCourse","ELEVATION_4","dot","ContributorsDetails","githubOrg","ignoreRepos","ignoreContributors","ContributorsList","repos","setRepos","contributors","setContributors","repo","contributors_url","fetchRepos","endpoints","endpoint","res","contributor","login","photo","avatar_url","githubPage","html_url","githubName","commits","contributions","fetchContributors","contributorList","array","arrayMapped","Contributors","THREE","Disabled","reason","Failure","children","GitHubCallback","accessCode","githubClientId","clientId","responseObject","GitHubUtils","githubOAuthProxyUrl","access_token","BroadcastChannel","postMessage","close","retrieveAuthTokenUpdatePage","providers","LoginButton","Login","providerId","handleLogin","fetchAuth","LOCK","vertical","capitalizeFirstLetter","retrieveLocalAssessment","localStorage","storeLocalAssessment","storeLocalAssessmentOverview","makeAssessmentOverview","maxXpVal","CONTENT","TASK","rawOverview","$","kind","duedate","coverimage","startdate","reading","READING","WEBSUMMARY","makeAssessment","questionArr","makeQuestions","globalDeployment","makeLibrary","DEPLOYMENT","graderDeployment","GRADERDEPLOYMENT","TEXT","missionPDF","deploymentArr","emptyLibrary","deployment","IMPORT","EXTERNAL","SYMBOL","globals","GLOBAL","IDENTIFIER","VALUE","Function","PROBLEMS","PROBLEM","problem","curId","localMaxXp","maxxp","graderLibrary","makeProgramming","makeMCQ","choicesVal","SNIPPET","SOLUTION","solutionVal","CHOICE","hint","correct","TESTCASES","publicTestcases","PUBLIC","privateTestcases","PRIVATE","PREPEND","POSTPEND","TEMPLATE","makeTestcase","testcasesPrivate","GRADER","graderTemplate","TestcaseTypes","public","download","createElement","encodeURIComponent","appendChild","click","removeChild","exportLibrary","interpreter","assessmentToXml","snippet","publicTests","privateTests","EditingOverviewCard","saveEditOverview","fieldValue","editingOverviewField","updateEditingOverview","handleEditOverview","toggleEditField","toggleOptionsOverlay","showOptionsOverlay","handleExportXml","assessmentStr","overviewStr","builder","Builder","xml","xmlStr","buildObject","exportXml","makeEditingOverviewTextarea","autoFocus","makeEditingOverviewCard","makeEditingOverviewCardTitle","createPlaceholder","makeExportButton","saveCategory","category","optionsOverlay","assessmentTypeSelect","AssessmentTypeSelectComponent","MINIMAL","assessmentTypeRenderer","modifiers","ControlBarToggleEditModeButton","toggleEditMode","editingMode","editMode","getValueFromPath","assignToPath","limitNumberRange","TextAreaContent","isNumberVal","isNumber","isEditing","setIsEditing","setFieldValue","useRawValue","saveEditAssessment","parsedFieldValue","originalVal","processResults","assessmentVal","updateAssessment","handleEditAssessment","filler","fieldVal","AutograderTab","addTestcase","testcaseTemplate","autograderCard","testcasePath","removeTestcase","publicTestPath","privateTestPath","PLUS","DeploymentTab","deploymentTab","deploymentPath","pathToLibrary","symbol","textareaContent","MINUS","handleSymbolDelete","globalValueTextareaContent","handleGlobalDelete","resetLibrary","handleRefreshLibrary","symbolsFragment","externalSelect","handleNewSymbol","globalsFragment","borderSpacing","handleNewGlobal","removeSpaces","pathVal","handleGlobalValueUpdate","altEval","_e","externalLibraries","handleSwitchDeployment","isEmptyLibrary","pathToCopy","isOptionalDeployment","ChapterSelectComponent","iExternals","entry","currentExternal","ExternalSelectComponent","externalRenderer","GradingTab","deepCopy","ManageQuestionTab","showSaveOverlay","setShowSaveOverlay","modifyAssessment","setModifyAssessment","manageQuestionTab","DOCUMENT","confirmSave","makeQuestion","deleteQuestion","CARET_UP","shiftQuestion","FONT","programmingTemplate","mcqTemplate","dir","template","confirmSaveOverlay","q","MCQQuestionTemplateTab","mcqButton","deleteButton","QuestionEditorSelect","questionEditors","CHEVRON_UP","CHEVRON_DOWN","ProgrammingQuestionTemplateTab","activeEditor","setActiveEditor","templateValue","setTemplateValue","templateFocused","setTemplateFocused","focusEditor","unFocusEditor","editorProps","$blockScrolling","Infinity","highlightActiveLine","theme","handleUpdateActiveEditorTab","handleCopyFromEditor","handleCopyToEditor","copyFromEditorButton","copyToEditorButton","editorPanel","menuRenderer","currentEditor","programmingTab","uniq","seen","hasOwnProperty","EditingWorkspace","setAssessment","setEditingMode","setHasUnsavedChanges","originalMaxXp","setOriginalMaxXp","resetWorkspaceValues","getMaxXp","formatedQuestionId","handleUpdateCurrentAssessmentId","globalsVal","symbolsVal","handleUpdateWorkspace","handleSaveXp","curXp","changeXp","updateAssessmentOverview","updateEditAssessmentState","updateAndSaveAssessment","toggleEditingMode","editingWorkspaceButtons","editorTabStateProps","qnType","questionTemplateTab","editorQuestionOverview","editorQuestionTemplate","editorLocalDeployment","editorLocalGraderDeployment","editorGrading","editorAutograder","editorBriefing","editorManageQuestion","editorGlobalDeployment","editorGlobalGraderDeployment","EditingWorkspaceContainer","changeEvent","updateWorkspace","updateActiveEditorTab","MissionCreator","fileReader","handleFileRead","parseString","entireAssessment","assessmentArr","makeEntireAssessment","newAssessment","fileInputText","handleChangeFile","makeMission","overviewTemplate","assessmentTemplate","accept","MissionCreatorContainer","ownProps","MissionControl","editingOverview","setEditingOverview","retrieveLocalAssessmentOverview","assessmentProps","closeDate","MissionControlContainer","mapStateToProps","persistenceUser","googleUser","persistenceFile","githubOctokitObject","githubSaveInfo","mapDispatchToProps","toggleUsingSubst","PlaygroundContainer","Component","Welcome","sourceAcademyDeploymentName","resourcesForLearners","resourcesForEducators","ProfileCard","isInvalidXP","xpDetails","parseColour","getFrac","activeClassName","renderIcon","Profile","fetchTotalXp","isLoaded","setIsLoaded","numClosed","userXp","fullXp","userDetails","den","icons","LIGHTBULB","PREDICTIVE_ANALYSIS","COMPARISON","c","PULSE","summaryCallouts","excluded","toFixed","USER","DrawerSize","DropdownAbout","sourceDocs","textbook","about","DropdownCourses","courses","course","PROPERTIES","DropdownCreateCourse","setCourseConfig","sourceChapterOptions","labelInfo","tagName","handleCreateCourse","DropdownHelp","githubIssues","DropdownSettings","workspaceSettings","setWorkspaceSettings","WorkspaceSettingsContext","EditorBinding","VIM","EMACS","COG","editorBinding","titleCase","wrd","Dropdown","isSettingsOpen","setIsSettingsOpen","isAboutOpen","setIsAboutOpen","isHelpOpen","setIsHelpOpen","isProfileOpen","setIsProfileOpen","isMyCoursesOpen","setIsMyCoursesOpen","isCreateCourseOpen","setIsCreateCourseOpen","toggleSettingsOpen","oldValue","toggleAboutOpen","toggleHelpOpen","toggleProfileOpen","toggleMyCoursesOpen","toggleCreateCourseOpen","profile","myCourses","createCourse","logout","LOG_OUT","handleLogOut","LAB_TEST","CALCULATOR","AcademyNavigationBar","Alignment","BUTTON","SATELLITE","MOBILE_VIDEO","SETTINGS","NavigationBarMobileSideMenu","MUSIC","enableGitHubAssessments","BOOK","matchSourcecastAchievement","matchExceptSourcecastAchievement","NavigationBar","mobileSideMenuOpen","setMobileSideMenuOpen","playgroundOnlyNavbarLeft","MENU","SYMBOL_DIAMOND","paddingBottom","mobileNavbarLeft","handleGitHubLogIn","handleGitHubLogOut","desktopNavbarLeftPopoverContent","desktopLogoButton","isActive","enableDesktopPopoverIn","enableDesktopPopover","desktopNavbarLeft","BOTTOM_RIGHT","commonNavbarRight","HEART","playgroundOnly","loginPath","redirectToLogin","redirectToWelcome","toAcademy","ensureUserAndRouteTo","ensureUserAndRoleAndRouteTo","computeDisabledState","disablePeriods","isAfter","Application","intervalId","setIsDisabled","isMobile","userAgent","isPWA","matchMedia","matches","browserDimensions","useLocalStorageState","workspaceSettingsLocalStorageKey","defaultWorkspaceSettings","isCourseLoaded","fetchUserAndCourse","orientationChangeHandler","documentElement","setProperty","commonPaths","GitHubClassroom","isDisabledEffective","showResearchPrompt","agreedToResearch","updateCourseResearchAgreement","ApplicationContainer","logOut","loginGitHub","logoutGitHub","isLocalhost","Boolean","hostname","registerValidSW","swUrl","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","catch","FileSystemContext","FileSystemProvider","fileSystem","setFileSystem","fs","storeName","BFSRequire","sentryDsn","Sentry","dsn","environment","sourceAcademyEnvironment","sourceAcademyVersion","userId","rootContainer","__REDUX_STORE__","origin","contentType","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker","sync","triggerSyncLogs","cadetLoggerInterval","defaultOptions","iconOnRight","buttonOptions","iconElement","SAVE_CANVAS","CREATE_COURSE","ADD_NEW_USERS_TO_COURSE","changeQueryString","playgroundUpdatePersistenceFile","playgroundUpdateGitHubSaveInfo","repoName","lastSaved","FETCH_SOURCECAST_INDEX","SET_IS_EDITOR_READONLY","UPDATE_SOURCECAST_INDEX","BROWSE_REPL_HISTORY_DOWN","BROWSE_REPL_HISTORY_UP","changeExternalLibrary","newExternal","CHANGE_EXTERNAL_LIBRARY","CHANGE_EXEC_TIME","CHANGE_SIDE_CONTENT_HEIGHT","CHANGE_STEP_LIMIT","CHAPTER_SELECT","PLAYGROUND_EXTERNAL_SELECT","TOGGLE_EDITOR_AUTORUN","BEGIN_CLEAR_CONTEXT","clearReplInput","CLEAR_REPL_INPUT","CLEAR_REPL_OUTPUT","clearReplOutputLast","CLEAR_REPL_OUTPUT_LAST","endClearContext","END_CLEAR_CONTEXT","EVAL_EDITOR","CHECK_EDITOR","EVAL_REPL","EVAL_TESTCASE","EVAL_EDITOR_AND_TESTCASES","activeEditorTabOptions","UPDATE_ACTIVE_EDITOR_TAB","newEditorValue","UPDATE_EDITOR_VALUE","UPDATE_EDITOR_BREAKPOINTS","highlightEditorLine","HIGHLIGHT_LINE","newReplValue","UPDATE_REPL_VALUE","newOutput","SEND_REPL_INPUT_TO_OUTPUT","resetTestcase","RESET_TESTCASE","NAV_DECLARATION","moveCursor","MOVE_CURSOR","workspaceOptions","RESET_WORKSPACE","UPDATE_WORKSPACE","UPDATE_CURRENT_ASSESSMENT_ID","UPDATE_CURRENT_SUBMISSION_ID","UPDATE_HAS_UNSAVED_CHANGES","sublang","CHANGE_SUBLANGUAGE","updateSublanguage","UPDATE_SUBLANGUAGE","column","PROMPT_AUTOCOMPLETE","notifyProgramEvaluated","lastDebuggerResult","NOTIFY_PROGRAM_EVALUATED","TOGGLE_USING_SUBST","addHtmlConsoleError","ADD_HTML_CONSOLE_ERROR","CHANGE_DATE_ASSESSMENT","DELETE_ASSESSMENT","PUBLISH_ASSESSMENT","UPLOAD_ASSESSMENT","PERSISTENCE_OPEN_PICKER","PERSISTENCE_SAVE_FILE_AS","PERSISTENCE_SAVE_FILE","PERSISTENCE_INITIALISE","maximumTasksPerMission","jsonStringify","identity","taskDataPropertyTable","isDefaultValue","fromStringConverter","toStringConverter","starterCode","savedCode","testPrepend","testPostpend","testCases","tests","saveableTests","getMissionData","missionRepoData","octokit","briefingStringPromise","getContentAsString","repoOwner","metadataStringPromise","tasksDataPromise","getContent","owner","promises","questionFolderName","folderContents","folderContentFileNames","filteredProperties","property","stringContent","stringContents","taskData","questionNumber","getTasksData","briefingString","metadataString","missionMetadata","sourceVersion","convertMetadataStringToMissionMetadata","missionBriefing","filepath","contentString","fileInfo","Buffer","convertMissionMetadataToMetadataString","discoverFilesToBeChangedWithMissionRepoData","cachedMissionMetadata","briefingContent","cachedBriefingContent","taskList","cachedTaskList","isTeacherMode","filenameToContentMap","foldersToDelete","taskNumber","propertiesToCheck","propertyName","currentValue","onRepoFileName","cachedValue","savedCodeValue","discoverFilesToBeCreatedWithoutMissionRepoData","convertToMCQQuestionIfMCQText","possibleMCQText","isMCQText","mcqQuestion","maxGrade","trimmedText","onlyQuestionInformation","intermediateObject","studentAnswer","convertIMCQQuestionToMCQText","FETCH_GROUP_GRADING_SUMMARY","UPDATE_GROUP_GRADING_SUMMARY","FETCH_AUTH","FETCH_USER_AND_COURSE","FETCH_COURSE_CONFIG","FETCH_ALL_USER_XP","FETCH_GRADING","FETCH_GRADING_OVERVIEWS","LOGIN","LOGOUT_GOOGLE","LOGIN_GITHUB","LOGOUT_GITHUB","SET_TOKENS","SET_USER","SET_COURSE_CONFIGURATION","SET_COURSE_REGISTRATION","SET_ASSESSMENT_CONFIGURATIONS","SET_ADMIN_PANEL_COURSE_REGISTRATIONS","SET_GOOGLE_USER","SET_GITHUB_ASSESSMENT","SET_GITHUB_OCTOKIT_OBJECT","SET_GITHUB_ACCESS_TOKEN","SUBMIT_ANSWER","SUBMIT_ASSESSMENT","SUBMIT_GRADING","SUBMIT_GRADING_AND_CONTINUE","REAUTOGRADE_SUBMISSION","REAUTOGRADE_ANSWER","REMOVE_GITHUB_OCTOKIT_OBJECT_AND_ACCESS_TOKEN","UNSUBMIT_SUBMISSION","UPDATE_ASSESSMENT_OVERVIEWS","UPDATE_TOTAL_XP","UPDATE_ALL_USER_XP","UPDATE_ASSESSMENT","UPDATE_GRADING_OVERVIEWS","UPDATE_GRADING","FETCH_NOTIFICATIONS","ACKNOWLEDGE_NOTIFICATIONS","UPDATE_NOTIFICATIONS","UPDATE_LATEST_VIEWED_COURSE","UPDATE_COURSE_CONFIG","FETCH_ASSESSMENT_CONFIGS","UPDATE_ASSESSMENT_CONFIGS","DELETE_ASSESSMENT_CONFIG","FETCH_ADMIN_PANEL_COURSE_REGISTRATIONS","UPDATE_USER_ROLE","UPDATE_COURSE_RESEARCH_AGREEMENT","DELETE_USER_COURSE_REGISTRATION","AchievementNode","descendant","parents","nodeList","goalList","textToUuid","titleToUuid","achievementsToDelete","goalsToDelete","invalidGoal","invalidAchievement","constructNodeList","constructGoalList","processNodes","processGoals","getAllReleasedAchievements","UNRELEASED","getAllCompletedAchievements","getAllAchievementUuids","hasGoal","getGoalProgress","getAchievementPositionByUuid","getAchievementsByGoal","v4","normalizePositions","definition","defaultGoalProgress","complete","modifyGoalProgress","generateXp","generateProgressFrac","generateStatus","targetUuid","hasTarget","newPrerequisiteUuids","sanitizeNode","targetIndex","findTargetIndex","taskA","taskB","sortedTask","goalLength","prereqLength","listPrerequisiteGoals","childGoalUuids","childUuid","getTextByUuid","getTitleByUuid","getTotalXp","isImmediateChild","isDescendant","getDescendants","descendantUuid","listAvailablePrerequisiteUuids","generateParentReference","generateDescendant","generateDisplayDeadline","grandchildUuid","descendantDeadlines","childDeadline","currentDeadline","allGoalsCompleted","completion","denom","achievementCompleted","hasReleased","hasUnexpiredDeadline","EXPIRED","anchorUuid","anchorPosition","nonTask","anchorAchievement","misplacedAchievement","DraggableRepl","axis","handle","top","onDrag","MobileKeyboard","isKeyboardShown","setIsKeyoardShown","buttonContent","setButtonContent","keyboardPosition","setKeyboardPosition","selectedIndex","setSelectedIndex","handlePreventDefault","keyboardProps","targetKeyboardInput","navigateLeft","navigateRight","insert","baseClass","layout","buttonTheme","class","preventMouseDownDefault","disableCaretPositioning","onMouseDown","keyboardClass","getElementsByClassName","MobileControlBar","controlBarMenu","MobileSideContent","isIOS","platform","renderedPanels","renderPanel","tabTitle","onOpening","isAndroid","isPortrait","useMediaQuery","orientation","draggableReplPosition","setDraggableReplPosition","isDraggableReplDisabled","setIsDraggableReplDisabled","querySelector","handleHideRepl","setTargetKeyboardInput","clearTargetKeyboardInput","enableMobileKeyboardForEditor","onFocus","handleShowRepl","offset","sideBarTabs","mobileEditorTab","mobileRunTab","inAssessmentWorkspace","handleTabChangeForRepl","enableMobileKeyboardForRepl","ControlBarReturnToAcademyButton","Visible","_x","_y","_width","_height","_isDrawn","createRef","isDrawn","reset","CompactConfig","ShapeDefaultProps","Config","MAX_VALUE","FontFamily","FontSize","fontStyle","FontStyle","fontVariant","FontVariant","isStringIdentifiable","_hoveredWidth","partialStr","fullStr","updatePosition","getPrintableMode","setHoveredCursor","moveToTop","draw","setUnhoveredCursor","widthOf","getTextWidth","truncatedText","Ellipsis","TextMinWidth","hoveredWidth","SA_BLUE","SA_WHITE","Layout","listening","GenericArrow","source","points","_path","unhovered_opacity","ArrowUnhoveredOpacity","hovered_opacity","calculateSteps","getStrokeWidth","ArrowStrokeWidth","setHoveredStyle","strokeWidth","ArrowHoveredStrokeWidth","Frame","setUnhoveredStyle","xa","ya","xb","yb","xc","yc","dx1","dx2","dy1","dy2","r1","sqrt","pow","r2","br","ArrowCornerRadius","stroke","hitStrokeWidth","ArrowHitStrokeWidth","strokeEnabled","pointerWidth","ArrowHeadSize","pointerLength","ArrowFromFrame","FramePaddingX","ArrowLane","getHorizontalLaneAfterSource","getPosition","FrameArrowStrokeWidth","FrameArrowHoveredStrokeWidth","ArrayEmptyUnit","ArrowFromFn","FnRadius","getVerticalLaneBeforeTarget","getHorizontalLaneBeforeTarget","Value","referencedBy","addReference","newReference","FnValue","centerX","tooltipWidth","exportTooltipWidth","radius","innerRadius","FnInnerRadius","fnName","paramsText","bodyText","exportBodyText","exportTooltip","_arrow","enclosingEnvNode","labelRef","getStage","memoizeValue","mainReference","Binding","FrameMarginX","isLastUnit","DataUnitWidth","DataUnitHeight","environmentTree","getTreeNode","getNonEmptyEnv","functionName","getParamsText","getBodyText","envTreeNode","Fragment","TextPaddingX","TextPaddingY","FnTooltipOpacity","GlobalFnValue","globalEnvNode","ArrowFromArrayUnit","emergeFromTopOrBottom","ArrayValue","potentialVerticalLaneX","getVerticalLaneAfterSource","potentialHorizontalLaneY","newX","yDiff","newY","sign","units","RoundedRect","cornerRadius","forwardRef","sceneFunc","upperLeft","lowerLeft","upperRight","lowerRight","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","fillStrokeShape","ArrayNullUnit","arrayUnit","DataHitStrokeWidth","PrimitiveValue","keyString","textWidth","isNull","ArrayUnit","isFirstUnit","isMainReference","u","createValue","DataCornerRadius","addArrow","fillEnabled","emptyUnit","_arrows","parentArray","arrayLevelY","DataMinWidth","unit","arrows","setLevel","arrLevel","ArrowFromText","trackObjects","frameNames","xCoord","yCoord","totalHeight","totalWidth","totalHoveredWidth","parentFrame","offsetY","maxBindingWidth","bindingWidth","ConstantColon","isUnassigned","UnassignedData","isPrimitiveData","prevBinding","exportWidth","descriptors","getOwnPropertyDescriptors","dummyEntries","isDummyKey","actualEnv","GlobalEnvId","currBinding","writable","v","isDummyBinding","FramePaddingY","nextX","cumWidths","maxX","heights","getArrow","FrameMinWidth","maxXCoord","CanvasPaddingX","arrowToParentFrame","FrameCornerRadius","valueOf","CanvasPaddingY","Level","parentLevel","ArrayLevel","_minX","_count","_rowCount","arrays","getNumLanes","addArray","tail","visitedTail","DataUnitPaddingX","positions","arrayMargin","DataUnitPaddingY","curY","setY","minX","FrameLevel","lastXcoord","addFrame","coordinate","maxXcoord","maxYcoord","FrameMarginY","Grid","envTreeNodes","frameLevels","arrayLevels","levels","widths","destroyChildren","cumHeights","currentNode","updatedParent","flatMap","getNextChildren","oldParentCoord","d","m","p","belongsToFrame","arrayLevel","frameLevel","coord","isVertical","lane","ArrowLaneInterval","ArrowNumLanes","verticalLanes","horizontalLanes","arrayLevelLanes","lastXCoordBelow","lastYCoordBelow","TextMargin","UnassignedValue","Symbol","isConstant","keyYOffset","VariableColon","isEnvironment","isEnvTreeNode","isEnvTree","isEmptyEnvironment","env","isFunction","call","isFn","isGlobalFn","isUndefined","isString","isBoolean","reference","isCompactMainReference","font","canvas","getContext","longestLine","accText","currValue","measureText","metrics","fnString","hoveredAttrs","Group","setAttrs","attrs","HoveredColor","unhoveredAttrs","copyOwnPropertyDescriptors","destination","root","defineProperties","deepCopyTree","clone","nextChildren","gc","x1","y1","x2","y2","memoizeCompactValue","compactFrame","createCompactValue","leftSiblingFrame","compactLevel","prevFrame","newFrame","maxHeight","lastFrame","LevelPaddingX","visibleWidth","visibleHeight","stageRef","stageWidth","stageHeight","currentLight","currentDark","currentCompactLight","currentCompactDark","invisiblePaddingVertical","invisiblePaddingHorizontal","scrollContainerRef","envTree","compactValues","removeProgramEnv","removeUnreferencedGlobalFns","initializeGrid","getCompactLayout","lastLevel","compactLevels","compactHeight","CanvasMinHeight","compactWidth","CanvasMinWidth","nonCompactHeight","nonCompactWidth","programEnvNode","resetChildren","referencedGlobalFns","visitedData","findGlobalFnReferences","envNode","findGlobalFnReferencesInData","GlobalFrameDefaultText","currLevel","frontier","prevLevel","CompactLevel","nextFrontier","frontiers","existingValue","CompactUnassignedValue","CompactPrimitiveValue","CompactArrayValue","CompactFnValue","CompactGlobalFnValue","MaxExportWidth","MaxExportHeight","dx","dy","transform","prevLayout","onScroll","handleScrollPosition","scrollLeft","scrollTop","overflow","PRINT_BACKGROUND","alignSelf","borderColor","onMouseUp","toggleCompactLayout","togglePrintableMode","saveButtonText","exportImage","scrollTo","horizontalImages","verticalImages","download_next","toDataURL","mimeType","download_images","printableMode","compactLayout","setVis","setContext","isTrue","defaultTo","REACT_APP_VERSION","REACT_APP_ENVIRONMENT","REACT_APP_DEPLOYMENT_NAME","REACT_APP_SHOW_RESEARCH_PROMPT","REACT_APP_BACKEND_URL","REACT_APP_CADET_LOGGER_INTERVAL","useBackend","REACT_APP_USE_BACKEND","REACT_APP_URL_SHORTENER_BASE","urlShortenerSignature","REACT_APP_URL_SHORTENER_SIGNATURE","moduleBackendUrl","REACT_APP_MODULE_BACKEND_URL","sharedbBackendUrl","REACT_APP_SHAREDB_BACKEND_URL","REACT_APP_PLAYGROUND_ONLY","REACT_APP_ENABLE_GITHUB_ASSESSMENTS","REACT_APP_SENTRY_DSN","googleClientId","REACT_APP_GOOGLE_CLIENT_ID","googleApiKey","REACT_APP_GOOGLE_API_KEY","googleAppId","REACT_APP_GOOGLE_APP_ID","REACT_APP_GITHUB_CLIENT_ID","REACT_APP_GITHUB_OAUTH_PROXY_URL","sicpBackendUrl","REACT_APP_SICPJS_BACKEND_URL","REACT_APP_CA_FULFILLMENT_LEVEL","isDefault","startStr","endStr","maxBrowseIndex","togglePublishTo","currentlyActiveTabsLabel","getModuleTabs","debuggerContext","rawModuleContexts","ReactDOM","setDynamicTabs","allActiveTabs","spawnedTabs","toSpawn","getDynamicTabs","resetAlert","iconId","saveCanvas","REPEAT","ControlButtonSaveButton","updateSourcecastIndex","is_pair","array_test","xs","is_null","is_list","toText","full","dataString","ArrowDrawable","PureComponent","BackwardArrowDrawable","bottomY","leftX","topY","TreeNode","AlreadyParsedTreeNode","actualNode","DataTreeNode","DrawableTreeNode","_drawable","drawableX","drawableY","drawable","NullDrawable","ArrayDrawable","createChildText","nodeValue","isEmptyList","textValue","textToDisplay","displaySpecialContent","child","FunctionDrawable","FunctionTreeNode","createDrawable","parentX","parentY","ArrayTreeNode","arrayProps","arrayDrawable","Tree","rootNode","_rootNode","getNodeById","tree","nodeCount","constructNode","structure","alreadyDrawnNode","visitedStructures","treeNodes","constructTree","func","constructFunction","constructData","TreeDrawer","drawables","nodeWidths","minY","konvaText","Konva","drawNode","getNodeWidth","getNodeHeight","offsetX","drawnNode","arrowProps","childNode","childY","childNodeWidth","childrenWidths","childrenWidth","nodeWidth","nodeLabel","nodeToLabelMap","setSteps","structures","_instance","addStep","dataNode","createDrawing","treeDrawer","fromSourceStructure","leftMargin","topMargin","empty","ApplicationEnvironment","variantDisplay","defaultAcademy","gameCanvas","defaultApplication","Production","defaultDashboard","defaultAchievement","defaultPlayground","defaultEditorValue","createDefaultWorkspace","replHistory","browseIndex","records","originalValue","sicp","githubAssessment","defaultSession","gameState","completed_quests","playStory","defaultState","academy","application","protocolMap","getSessionUrl","ws","initial","SET_EDITOR_SESSION_ID","SET_SHAREDB_CONNECTED","generateOctokitInstance","authToken","Octokit","auth","baseUrl","info","warn","agent","editorControl","flowControl","editingWorkspaceControl","ADD_EVENT","BULK_UPDATE_ACHIEVEMENTS","BULK_UPDATE_GOALS","HANDLE_EVENT","GET_ACHIEVEMENTS","GET_GOALS","GET_OWN_GOALS","GET_USER_ASSESSMENT_OVERVIEWS","GET_USERS","REMOVE_ACHIEVEMENT","REMOVE_GOAL","SAVE_ACHIEVEMENTS","SAVE_GOALS","SAVE_USER_ASSESSMENT_OVERVIEWS","SAVE_USERS","UPDATE_GOAL_PROGRESS","UPDATE_OWN_GOAL_PROGRESS","onButtonClickFactory","hintElement","getButtonIntent","currentOption","chosenOption","correctOptionSelected","ESCAPE_CHARACTERS","restoreEscapeCharacters","original","toReplace","replaceAll","Output","consoleLogs","parseError","cards","nextProps","extraClasses","isEvaluated","secret","opaque","handleRunTestcase","goalRenderer","goalPredicate","UserSelect","userRenderer","user","userPredicate","updateGoalProcessed","user1","user2","localeCompare","manualAchievements","changeGoal","changeSelectedUser","changeCount","viewHidden","changeViewHidden","updateGroupGradingSummary","consoleOverloads","bufferCallback","args","DisplayBufferService","buffer","dump","bufferCopy","resetBuffer","handleWorkspaceChange","attachConsole","defaultConsole","overload","newWorkspace","hasWorkspace","EVAL_SILENT","frontendifyAchievementGoal","postAuth","redirectUri","client_id","redirect_uri","tokens","refresh_token","getUser","getLatestCourseRegistrationAndConfiguration","putLatestViewedCourse","noHeaderAccept","putCourseResearchAgreement","postCreateCourse","getCourseConfig","frontendifyAchievementItem","studentCourseRegId","getAllUsers","backendifyAchievementItem","backendifyGoalDefinition","updateOwnGoalProgress","computeGradingStatus","getAllUserXp","back","password","postAnswer","postAssessment","getGradingOverviews","gradingOverview","assessmentName","groupName","getGrading","gradingQuestion","lib","postGrading","postReautogradeSubmission","postReautogradeAnswer","postUnsubmit","getNotifications","assessment_title","postAcknowledgeNotifications","ids","notificationIds","getSourcecastIndex","postSourcecast","noContentType","getGradingSummary","putCourseConfig","getAssessmentConfigs","putAssessmentConfigs","overrideCourseId","removeAssessmentConfig","getUserCourseRegistrations","putNewUsers","putUserRole","removeUserCourseRegistration","fetchDevices","getDeviceWSEndpoint","device","opts","fetchOpts","newTokens","postRefresh","setTokens","newOpts","statusText","handleResponseError","respText","numGraded","numQuestions","requestFn","fetchedValue","localStorageValue","readLocalStorage","setLocalStorage","useSelector","setWidth","setHeight","resizeObserver","ResizeObserver","observer","contentRect","htmlElement","observe","disconnect","SAVE_SOURCECAST_DATA","SET_CURRENT_PLAYER_TIME","SET_CODE_DELTAS_TO_APPLY","SET_INPUT_TO_APPLY","SET_SOURCECAST_DATA","SET_SOURCECAST_PLAYBACK_DURATION","SET_SOURCECAST_PLAYBACK_STATUS","fetchAssessmentAdmin","fetchTotalXpAdmin","filterToGroup","logoutGoogle","setUser","setCourseRegistration","setAdminPanelCourseRegistrations","courseRegistrations","setGoogleUser","setGitHubAssessment","setGitHubOctokitObject","setGitHubAccessToken","removeGitHubOctokitObjectAndAccessToken","updateAssessmentOverviews","overviews","updateTotalXp","updateAllUserXp","updateGradingOverviews","updateGrading","withFilter","updateNotifications","FilterColors","achievementAssets","backgroundUrl","boxShadow","BLUE","WHITE","converter","Converter","tables","dangerouslySetInnerHTML","__html","makeHtml","selectedCourse","setAssessmentTypeOverviews","userLogin","getAuthenticated","orgLogin","userRepos","listForAuthenticatedUser","per_page","courseInfoRepo","courseInfo","types","published","prefixLogin","repoPrefix","missionRepo","acceptLink","createdAt","created_at","webSummary","dateOfCreation","dueDate","setCourses","setSelectedCourse","assessmentTypeOverviews","typeName","orgs","org","fetchCourses","changeCourseHandler","refreshAssessmentOverviews","redirectToAssessments","GitHubAssessmentWorkspaceContainer","filteredAssessments","GitHubAssessmentListing","createAssessmentButton","ownerSlashName","toDateString","hasDueDate","isOverdue","assessmentNotAccepted","buttonText","convertAssessmentOverviewToCard","GitHubClassroomWelcome","ControlBarDisplayMCQButton","mcqDisplayed","behaviour","displayTextInEditor","displayMCQInEditor","ControlBarTaskAddButton","numberOfTasks","addNewQuestion","ControlBarTaskDeleteButton","deleteCurrentQuestion","GitHubMissionCreateDialog","repositoryName","setrepositoryName","DIALOG_HEADER","filesToCreate","resolveDialog","SideContentMarkdownEditor","editorModeOn","setEditorModeOn","allowEdits","contains","setContent","growVertically","SideContentMissionEditor","changedProperty","newMetadata","assign","setMissionMetadata","setMissionMetadataWrapper","SideContentTaskEditor","taskIndex","currentTaskNumber","taskDescriptions","setTaskDescriptions","indexOutOfRange","taskBriefing","taskBriefingSetter","newDescription","newTaskDescriptions","SideContentEditableTestcaseCard","setTestcaseProgram","setTestcaseExpectedResult","deleteTestcase","testProgram","expectedAnswer","createEditor","SideContentTestcaseEditor","showsTestPrepend","setTestPrependShown","showsTestPostpend","setTestPostpendShown","setTaskTestcases","setTestPrepend","setTestPostpend","setTestcaseProgramSetterCreator","newProgram","newTestcases","setTestcaseExpectedResultSetterCreator","newExpectedResult","convertToTestcaseCard","createTestCaseButton","toggleTestPrepend","toggleTestPostpend","defaultMissionBriefing","defaultStarterCode","defaultMissionMetadata","defaultTask","defaultMCQQuestion","GitHubAssessmentWorkspace","getGitHubOctokitInstance","setCachedMissionMetadata","hasUnsavedChangesToMetadata","setHasUnsavedChangesToMetadata","setBriefingContent","setCachedBriefingContent","hasUnsavedChangesToBriefing","setHasUnsavedChangesToBriefing","setCachedTaskList","setTaskList","hasUnsavedChangesToTasks","setHasUnsavedChangesToTasks","summary","setSummary","setCurrentTaskNumber","setIsTeacherMode","setIsLoading","currentTaskIsMCQ","setCurrentTaskIsMCQ","setDisplayMCQInEditor","setMCQQuestion","setMissionRepoData","showBriefingOverlay","setShowBriefingOverlay","changeStateDueToChangedTaskNumber","newTaskNumber","currentTaskList","actualTaskIndex","setBriefingContentWrapper","newBriefingContent","newMissionMetadata","setTaskListWrapper","newTaskList","setDisplayMCQInEditorWrapper","shouldDisplayMCQ","computedHasUnsavedChanges","setUpWithAssessmentOverview","authenticatedUser","missionData","setUpWithoutAssessmentOverview","briefingOverlay","editCode","editedTaskList","resetToTemplate","originalCode","conductSave","changedFile","newFileContent","githubEmail","commitMessage","typedMissionRepoData","saveType","checkIfFileCanBeSavedAndGetSaveType","performOverwritingSave","performCreatingSave","conductDelete","performFolderDeletion","saveWithMissionRepoData","changedFiles","authUser","email","saveWithoutMissionRepoData","dialogResults","promisifyDialog","createForAuthenticatedUser","fileToCreate","fileContent","onClickReset","shouldProceedToChangeTask","onClickPrevious","activeTaskList","nextElement","newTestPrepend","newTestPostpend","BUILD","deleteAtIndex","addTaskButton","deleteTaskButton","showMCQButton","choiceId","newMCQQuestion","MissionEditor","ControlBarGitHubLoginButton","loginButton","GIT_BRANCH","onClickLogOut","onClickLogIn","GitHubAssessmentsNavigationBar","leftElement","createBrowserHistory","BEGIN_INTERRUPT_EXECUTION","END_INTERRUPT_EXECUTION","EVAL_INTERPRETER_ERROR","EVAL_INTERPRETER_SUCCESS","EVAL_TESTCASE_FAILURE","EVAL_TESTCASE_SUCCESS","HANDLE_CONSOLE_LOG","BEGIN_DEBUG_PAUSE","END_DEBUG_PAUSE","DEBUG_RESUME","DEBUG_RESET","handleConsoleLog","logString","evalInterpreterSuccess","evalTestcaseSuccess","evalTestcaseFailure","evalInterpreterError","stdout","endInterruptExecution","endDebuggerPause","ConfirmDialog","onResponse","largeButtons","escapeResponse","escapeHandler","PromptDialog","enterResponse","validationFunction","inputRef","returnResponse","buttonResponse","disableOnInvalid","handleEnter","keyCode","handleValidate","onKeyDown","DialogHelper","dialogOnClose","containerElement","dialogHelper","singleton","closeDialog","DialogComponent","propFn","finally","showConfirmDialog","showSimplePromptDialog","libEntries","SOUNDS","exchangeAccessCode","backendLink","messageBody","octokitObject","checkIfFileCanBeOpened","canBeSaved","checkIfUserAgreesToOverwriteEditorData","checkIfUserAgreesToPerformOverwritingSave","openFileInEditor","contentEncoded","sha","createOrUpdateFileContents","committer","author","isWithinTimeRange","fromTime","toTime","getHours","getMinutes","leftBound","rightBound","weeksAway","daysAway","hoursAway","prettifiedDeadline","persistenceOpenPicker","persistenceSaveFile","persistenceSaveFileAs","persistenceInitialise","remoteExecFetchDevices","REMOTE_EXEC_FETCH_DEVICES","remoteExecUpdateDevices","devices","REMOTE_EXEC_UPDATE_DEVICES","remoteExecUpdateSession","REMOTE_EXEC_UPDATE_SESSION","remoteExecConnect","workspace","REMOTE_EXEC_CONNECT","remoteExecDisconnect","REMOTE_EXEC_DISCONNECT","remoteExecRun","REMOTE_EXEC_RUN","remoteExecReplInput","REMOTE_EXEC_REPL_INPUT","AchievementActions","CommonsActions","CollabEditingActions","DashboardActions","InterpreterActions","PlaygroundActions","SessionActions","WorkspaceActions","GroundControlActions","AcademyActions","PersistenceActions","RemoteExecutionActions","AcademyReducer","AchievementReducer","DashboardReducer","PlaygroundReducer","SourcecastReducer","SourcereelReducer","WorkspaceReducer","lastOutput","sourcecastState","sourcereelState","newRecords","lastRecords","lastIndex","newReplHistoryRecords","updatedLastOutput","playgroundWorkspace","execType","executionMethod","newOutputEntry","updatedEditorTabs","newCursorPosition","ApplicationReducer","SessionsReducer","githubAccessToken","newAssessments","newGradings","remoteExecutionDevices","createRootReducer","combineReducers","mockAssessmentConfigurations","mockAssessmentOverviews","mockLibrary","mockAssessmentQuestions","mockClosedAssessmentQuestions","errorLine","mockAssessments","mockFetchRole","mockUser","mockCourseRegistrations","mockAdminPanelCourseRegistrations","mockCourseConfigurations","mockNotifications","mockGradingOverviews","mockGrading","mockGradingSummary","avenger","ungradedMissions","submittedMissions","ungradedQuests","submittedQuests","mockBackendSaga","takeEvery","put","mockGetUserAndCourse","sublanguage","newQuestions","newOverviews","permittedRoles","mockFetchGradingOverview","mockFetchGrading","sendGrade","newGrading","notificationsToAcknowledge","newNotifications","goalIncludesEvents","j","handleUncaughtError","isIterator","throw","safeTakeEvery","pattern","worker","wrappedWorker","safeTakeLatest","takeLatest","selectTokens","AchievementSaga","saveAchievements","saveGoals","saveUsers","loggedEvents","timeoutSet","handleEvent","backendAchievements","backendGoals","updatedGoals","events","wasCompleted","incompleteAchievements","incrementCount","saveUserAssessmentOverviews","computeRedirectUri","ep","port","handleReautogradeResponse","BackendSaga","payloadProviderId","searchParams","getClientId","redirectUrl","all_users_xp","updatedAssessmentConfigs","resp1","groupOverviews","GitHubFileNodeData","childrenRetrieved","fileType","GitHubTreeNodeCreator","fileIndex","currentRepoName","getChildNodes","githubLoginID","childFiles","childFile","createNode","octokitFileData","FileExplorerDialog","repoFiles","setRepoFiles","setFilePath","setCommitMessage","getFirstLayerRepoFileNodes","setFirstLayerRepoFiles","handleClose","treeNode","_nodePath","originallySelected","newRepoFiles","cloneWithCallbacks","newFilePath","onNodeCollapse","onNodeExpand","ELEVATION_0","pickerType","editorContent","treeNodeToEdit","allNodesCallback","specificNodeCallback","newTreeNodes","clonedNode","newChildNodes","RepositoryDialog","setRepoName","selectedValue","githubLoginSaga","githubOauthLoginLink","windowName","windowSpecs","onmessage","receivedMessage","githubLogoutSaga","githubOpenFile","paginate","promisifiedDialog","githubSaveFile","githubLoginId","githubSaveFileAs","promisifiedFileExplorer","GitHubPersistenceSaga","LoginSaga","updateLoginHref","epUrl","computeEndpointUrl","DISCOVERY_DOCS","UPLOAD_PATH","MIME_SOURCE","startInitialisation","initialisationPromise","gapi","client","apiKey","discoveryDocs","scope","auth2","getAuthInstance","currentUser","listen","handleUserChanged","isSignedIn","getBasicProfile","getEmail","ensureInitialised","ensureInitialisedAndAuthorised","signIn","pickFile","pickFolders","showFolders","showFiles","google","picker","DocsView","ViewId","DOCS","FOLDERS","rootFolder","setParent","setOwnedByMe","setIncludeFolders","setSelectFolderEnabled","setMode","DocsViewMode","LIST","PickerBuilder","enableFeature","Feature","NAV_HIDDEN","addView","setOAuthToken","getAuthResponse","setAppId","setDeveloperKey","Response","ACTION","Action","PICKED","parentId","docs","picked","CANCEL","build","createFile","appProperties","createMultipartBody","uploadType","updateFile","contentsMime","metaJson","boundary","generateBoundary","persistenceSaga","toastKey","drive","fileId","fields","pickedDir","saveToDir","pickedFile","newFile","PlaygroundSaga","updateQueryString","hasTimedOut","race","shortenURLRequest","shorturl","newQueryString","compressToEncodedURIComponent","ext","signature","k","dummyLocation","ALPHANUMERIC","generateClientNonce","remoteExecutionSaga","updatedDevice","connection","oldClient","SlingClient","clientNamePrefix","deviceId","thingName","websocketEndpoint","currentSession","dispatchAction","peripheralData","peripherals","pickBy","lastUpdated","speed","ExceptionError","deviceType","deviceTypesById","deviceLibraryName","internalFunctions","connectPromise","reconnect","take","sendStop","WorkspaceSaga","editorCode","clearContext","dumpDisplayBuffer","addEvent","evalCode","break","RUN_TESTCASE","runTestCase","newChapter","newVariant","oldVariant","oldChapter","externalSymbols","newExternalLibraryName","oldExternalLibraryName","moduleParams","runes","phaser","takeLeading","updateInspector","loc","exploded","msg","blockExtraMethods","blockKey","toUnblock","restorer","restoreExtraMethods","interrupted","scheduler","originalMaxExecTime","throwInfiniteLoops","interrupt","InterruptedError","evalTestCode","toBeBlocked","storeValues","nullifier","useSubst","oldErrors","MainSaga","fork","PersistenceSaga","RemoteExecutionSaga","sagaMiddleware","createSagaMiddleware","middleware","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","serialize","maxAge","compose","initialStore","loadedStore","playgroundEditorValue","playgroundIsEditorAutorun","playgroundExternalLibrary","loadStore","serializedState","decompressed","decompressFromUTF16","loadStoredState","enhancers","applyMiddleware","createdStore","_createStore","subscribe","throttle","stateToBeSaved","serialized","compressToUTF16","saveState","createStore","deviceTypes","languageChapter","EV3","SourcecastEditor","ShareAce","AceEditor","getMarkers","markerProps","lineNum","startRow","startCol","endRow","endCol","handleGutterClick","domEvent","clientX","getBoundingClientRect","getDocumentPosition","getLine","getBreakpoints","clearBreakpoint","setBreakpoint","$breakpoints","handleAnnotationChange","annotations","getAnnotations","anno","setAnnotations","handleEvaluate","clearSelection","moveCursorToPosition","showCursor","scrollCursorIntoView","getCursorPosition","getSession","editorCursorPositionToBeApplied","getDocument","applyDelta","setRange","WS","commands","bindKey","win","mac","markers","setOptions","keyBindings","evaluate","refactor","highlightScope","typeInferenceDisplay","useShareAce","inProps","outProps","reactAceRef","sharedbAce","WsUrl","pluginWsUrl","namespace","interval","connections","unlisten","HighlightRulesSelector_native","_SourceHighlightRules","acequire","exports","oop","DocCommentHighlightRules","TextHighlightRules","identifierRegex","SourceHighlightRules","keywordMapper","createKeywordMapper","escapedRegex","$rules","no_regex","getStartRule","token","regex","defaultToken","regex_character_class","function_arguments","qqstring","consumeLineEnd","qstring","noES6","unshift","onMatch","stack","nextState","shift","jsx","JSX","embedRules","getEndRule","normalizeRules","tagRegex","jsxTag","jsxJsRule","include","jsxAttributes","currentState","stateName","getTagRule","caseInsensitive","inherits","ace","externalLibrariesDocumentation","shortenCaption","MAX_CAPTION_LENGTH","mapExternalLibraryName","SourceDocumentation","ext_lib","caption","docHTML","names","builtinDocumentation","builtins","chapterDoc","Documentation","getModeString","EventT","EditorBase","handleEditorUpdateBreakpointsRef","handlePromptAutocompleteRef","define","modules","Mode","ModeSelector","selectMode","makeHandleAnnotationChange","setCompleters","getCompletions","prefix","keyHandlers","aceEditorProps","lineNums","enableBasicAutocompletion","enableLiveAutocompletion","keyboardHandler","hooks","hook","hooksOnChange","eventT","currFn","Editor","editorTab","createEditorTab","createSourcecastEditorTab","createNormalEditorTab"],"mappings":"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ACEymI,MAAO,CAAC,OAAQ,OAAQ,eAAgB,OAAQ,gBAChDC,MAAO,iCACP1mI,KAAM,sBAER,CACEymI,MAAO,UACPC,MAAO,sBAET,CACED,MAAO,UACPC,MAAO,sFACP1mI,KAAM,SAER,CACEymI,MAAO,CAAC,oBACRC,MAAO,UAET,CACED,MAAON,EACPO,MAAOT,GAET,CACEQ,MAAO,oBACPC,MAAO,aACP1mI,KAAM,YAER,CACEymI,MAAO,eACPC,MAAO,MAET,CACED,MAAO,mBACPC,MAAO,yEACP1mI,KAAM,SAER,CACEymI,MAAO,uBACPC,MAAO,UACP1mI,KAAM,SAER,CACEymI,MAAO,eACPC,MAAO,SACP1mI,KAAM,SAER,CACEymI,MAAO,eACPC,MAAO,UAET,CACED,MAAO,UACPC,MAAO,WAGX9sD,SAAU,CACR,CACE6sD,MAAO,OACPC,MAAO,QAET,CACED,MAAO,CACL,eACA,uBACA,uBACA,OACA,mBACA,OACA,eACA,OACA,uBACA,OACA,gBAEFC,MACE,IACAT,EACA,UACAA,EACA,yDACFjmI,KAAM,sBAER,CACEymI,MAAO,uBACPC,MAAO,cAET,CACED,MAAO,oBACPC,MACE,qvDAEJ,CACED,MAAO,wBACPC,MACE,+lBAEJ,CACED,MAAO,mBACPC,MACE,y2DAEJ,CACED,MAAO,aACPC,MAAOT,GAET,CACES,MAAO,GACPD,MAAO,QACPzmI,KAAM,aAGVhsD,MAAO,CACL+xL,EAAyBS,aAAa,aACtC19L,EAAS,SACT,CACE29L,MAAO,gBACPC,MAAO,MACP1mI,KAAM,SAER,CACEymI,MAAO,OACPC,MAAO,UACP1mI,KAAM,SAER,CACEymI,MAAO,QACPC,MAAO,GACP1mI,KAAM,aAGV0mI,MAAO,CACL,CACED,MAAO,0BACPC,MAAO,6CAET,CACED,MAAO,gBACPC,MAAO,cACP1mI,KAAM,YAER,CACEymI,MAAO,UACPC,MAAO,iDAET,CACED,MAAO,2BACPC,MAAO,iDAET,CACED,MAAO,8BACPC,MAAO,MAET,CACED,MAAO,2BACPC,MAAO,QACP1mI,KAAM,yBAER,C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","file":"static/js/main.7b3dc893.chunk.js","sourcesContent":["import { Intent, IToastProps, Position, Toaster } from '@blueprintjs/core';\n\nconst notification = Toaster.create({\n  position: Position.TOP\n});\n\nexport const showSuccessMessage = (\n  message: string | JSX.Element,\n  timeout: number = 2000,\n  key?: string\n) =>\n  notification.show(\n    {\n      intent: Intent.SUCCESS,\n      message,\n      timeout\n    },\n    key\n  );\n\nexport const showWarningMessage = (\n  message: string | JSX.Element,\n  timeout: number = 2000,\n  key?: string\n) =>\n  notification.show(\n    {\n      intent: Intent.WARNING,\n      message,\n      timeout\n    },\n    key\n  );\n\nexport const showDangerMessage = (\n  message: string | JSX.Element,\n  timeout: number = 2000,\n  key?: string\n) =>\n  notification.show(\n    {\n      intent: Intent.DANGER,\n      message,\n      timeout\n    },\n    key\n  );\n\nexport const showMessage = (props: IToastProps, key?: string) => notification.show(props, key);\n\nexport const dismiss = (key: string) => notification.dismiss(key);\n","/* tslint:disable: ban-types*/\nimport createSlangContext from 'c-slang/dist/createContext';\nimport { Context, Value, Variant } from 'c-slang/dist/types';\nimport { stringify } from 'c-slang/dist/utils/stringify';\nimport { difference, keys } from 'lodash';\nimport EnvVisualizer from 'src/features/envVisualizer/EnvVisualizer';\n\nimport DataVisualizer from '../../features/dataVisualizer/dataVisualizer';\nimport { Data } from '../../features/dataVisualizer/dataVisualizerTypes';\nimport DisplayBufferService from './DisplayBufferService';\n\n/**\n * This file contains wrappers for certain functions\n * in the @source-academy/slang module.\n *\n * Use this file especially when attempting to create a slang Context.\n */\n\n/**\n * Function that takes a value and displays it in the interpreter.\n * It uses the c-slang stringify to convert values into a \"nicer\"\n * output. e.g. [1, 2, 3] displays as [1, 2, 3].\n * An action is dispatched using the redux store reference\n * within the global window object.\n *\n * @param value the value to be displayed\n * @param workspaceLocation used to determine\n *   which REPL the value shows up in.\n */\nfunction display(value: Value, str: string, workspaceLocation: any) {\n  display((str === undefined ? '' : str + ' ') + stringify(value), '', workspaceLocation);\n  return value;\n}\n\n/**\n * Function that takes a value and displays it in the interpreter.\n * The value is displayed however full JS would convert it to a string.\n * e.g. [1, 2, 3] would be displayed as 1,2,3.\n * An action is dispatched using the redux store reference\n * within the global window object.\n *\n * @param value the value to be displayed\n * @param workspaceLocation used to determine\n *   which REPL the value shows up in.\n */\nfunction rawDisplay(value: Value, str: string, workspaceLocation: any) {\n  const output = (str === undefined ? '' : str + ' ') + String(value);\n  DisplayBufferService.push(output, workspaceLocation);\n\n  return value;\n}\n\n/**\n * A function to prompt the user using a popup.\n * The function is not called 'prompt' to prevent shadowing.\n *\n * @param value the value to be displayed as a prompt\n */\nfunction cadetPrompt(value: any) {\n  return prompt(value);\n}\n\n/**\n * A function to alert the user using the browser's alert()\n * function.\n *\n * @param value the value to alert the user with\n */\nfunction cadetAlert(value: any) {\n  alert(stringify(value));\n}\n\n/**\n * A dummy function to pass into createContext.\n * An actual implementation will have to be added\n * with the data visualizer implementation. See #187\n *\n * @param args the data to be visualized.\n */\nfunction visualizeData(...args: Data[]) {\n  try {\n    // Pass in args[0] since args is in the form; [(Array of drawables), \"playground\"]\n    DataVisualizer.drawData(args[0]);\n\n    // If there is only one arg, just print out the first arg in REPL, instead of [first arg]\n    return args[0].length === 1 ? args[0][0] : args[0];\n  } catch (err) {\n    console.log(err);\n    throw new Error('Data visualizer is not enabled');\n  }\n}\n\nexport function visualizeEnv({ context }: { context: Context }) {\n  try {\n    EnvVisualizer.drawEnv(context);\n  } catch (err) {\n    throw new Error('Env visualizer is not enabled');\n  }\n}\n\n// export function highlightClean() {\n//   if ((window as any).Inspector) {\n//     (window as any).Inspector.highlightClean();\n//   } else {\n//     throw new Error('Inspector not loaded');\n//   }\n// }\n\n// export function highlightLine(line: number) {\n//   if ((window as any).Inspector) {\n//     (window as any).Inspector.highlightLine(line);\n//   } else {\n//     throw new Error('Inspector not loaded');\n//   }\n// }\n\nexport const externalBuiltIns = {\n  display,\n  rawDisplay,\n  prompt: cadetPrompt,\n  alert: cadetAlert,\n  visualiseList: visualizeData\n};\n\n/**\n * A wrapper around c-slang's createContext. This\n * provides the original function with the required\n * externalBuiltIns, such as display and prompt.\n */\nexport function createContext<T>(\n  externals: string[],\n  externalContext: T,\n  variant: Variant = Variant.DEFAULT\n) {\n  return createSlangContext<T>(variant, externals, externalContext);\n}\n\n\n// Given a Context, returns a privileged Context that when referenced,\n// intercepts reads from the underlying Context and returns desired values\nexport function makeElevatedContext(context: Context) {\n  function ProxyFrame() {}\n  ProxyFrame.prototype = context.runtime.environments[0].head;\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  const fakeFrame: { [key: string]: any } = new ProxyFrame();\n  // Explanation: Proxy doesn't work for defineProperty in use-strict.\n  // The c-slang will defineProperty on loadStandardLibraries\n  // Creating a raw JS object and setting prototype will allow defineProperty on the child\n  // while reflection should work on parent.\n\n  const proxyGlobalEnv = new Proxy(context.runtime.environments[0], {\n    get(target, prop: string | symbol, receiver) {\n      if (prop === 'head') {\n        return fakeFrame;\n      }\n      return target[prop];\n    }\n  });\n\n  const proxyEnvs = new Proxy(context.runtime.environments, {\n    get(target, prop, receiver) {\n      if (prop === '0') {\n        return proxyGlobalEnv;\n      }\n      return target[prop];\n    }\n  });\n\n  const proxyRuntime = new Proxy(context.runtime, {\n    get(target, prop, receiver) {\n      if (prop === 'environments') {\n        return proxyEnvs;\n      }\n      return target[prop];\n    }\n  });\n\n  const elevatedContext = new Proxy(context, {\n    get(target, prop, receiver) {\n      switch (prop) {\n        case 'chapter':\n          return 4;\n        case 'runtime':\n          return proxyRuntime;\n        default:\n          return target[prop];\n      }\n    }\n  });\n\n  return elevatedContext;\n}\n\nexport function getDifferenceInMethods(elevatedContext: Context, context: Context) {\n  const eFrame = elevatedContext.runtime.environments[0].head;\n  const frame = context.runtime.environments[0].head;\n  return difference(keys(eFrame), keys(frame));\n}\n\nexport function getStoreExtraMethodsString(toRemove: string[], unblockKey: string) {\n  return `const _____${unblockKey} = [${toRemove.join(', ')}];`;\n}\n\nexport function getRestoreExtraMethodsString(removed: string[], unblockKey: string) {\n  const store = `_____${unblockKey}`;\n  return removed\n    .map((x, key) => (x === 'makeUndefinedErrorFunction' ? '' : `const ${x} = ${store}[${key}];`))\n    .join('\\n');\n}\n\nexport function getBlockExtraMethodsString(toRemove: string[]) {\n  return toRemove\n    .map(x =>\n      x === 'makeUndefinedErrorFunction' ? '' : `const ${x} = makeUndefinedErrorFunction('${x}');`\n    )\n    .join('\\n');\n}\n","import { PersistenceFile } from '../persistence/PersistenceTypes';\n\nexport const CHANGE_QUERY_STRING = 'CHANGE_QUERY_STRING';\nexport const GENERATE_LZ_STRING = 'GENERATE_LZ_STRING';\nexport const SHORTEN_URL = 'SHORTEN_URL';\nexport const UPDATE_SHORT_URL = 'UPDATE_SHORT_URL';\nexport const PLAYGROUND_UPDATE_GITHUB_SAVE_INFO = 'PLAYGROUND_UPDATE_GITHUB_SAVE_INFO';\nexport const PLAYGROUND_UPDATE_PERSISTENCE_FILE = 'PLAYGROUND_UPDATE_PERSISTENCE_FILE';\n\nexport type PlaygroundState = {\n  readonly queryString?: string;\n  readonly shortURL?: string;\n  readonly persistenceFile?: PersistenceFile;\n  readonly githubSaveInfo: { repoName: string; filePath: string };\n};\n","import { IconNames } from '@blueprintjs/icons';\nimport React from 'react';\n\nimport ControlButton from '../ControlButton';\n\ntype ControlBarClearButtonProps = {\n  handleReplOutputClear: () => void;\n};\n\nexport const ControlBarClearButton: React.FC<ControlBarClearButtonProps> = ({\n  handleReplOutputClear\n}) => {\n  return <ControlButton label=\"Clear\" icon={IconNames.REMOVE} onClick={handleReplOutputClear} />;\n};\n","import { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport React from 'react';\n\nimport ControlButton from '../ControlButton';\n\ntype ControlBarEvalButtonProps = {\n  handleReplEval: () => void;\n  isRunning: boolean;\n};\n\nexport const ControlBarEvalButton: React.FC<ControlBarEvalButtonProps> = ({\n  handleReplEval,\n  isRunning\n}) => {\n  return isRunning ? null : (\n    <Tooltip2 content=\"...or press shift-enter in the REPL\">\n      <ControlButton label=\"Eval\" icon={IconNames.CODE} onClick={handleReplEval} />\n    </Tooltip2>\n  );\n};\n","import { Card, Icon, IconName } from '@blueprintjs/core';\nimport classNames from 'classnames';\nimport React from 'react';\n\nimport { SideContentType } from '../sideContent/SideContentTypes';\n\n/**\n * @property label The displayed name of the tab.\n * @property body The element to be rendered inside the sidebar tab.\n * @property iconName The name of the displayed icon.\n * @property id The ID of the tab when displayed as a side content on the mobile view.\n *              Omit if the tab should only be shown in the sidebar on the desktop view.\n */\nexport type SideBarTab = {\n  label: string;\n  body: JSX.Element;\n  iconName: IconName;\n  id?: SideContentType;\n};\n\nexport type SideBarProps = {\n  tabs: SideBarTab[];\n  isExpanded: boolean;\n  expandSideBar: () => void;\n  collapseSideBar: () => void;\n};\n\nconst SideBar: React.FC<SideBarProps> = (props: SideBarProps) => {\n  const { tabs, isExpanded, expandSideBar, collapseSideBar } = props;\n\n  const [selectedTabIndex, setSelectedTabIndex] = React.useState<number>(0);\n\n  const handleTabSelection = (tabIndex: number) => {\n    if (selectedTabIndex === tabIndex) {\n      if (isExpanded) {\n        collapseSideBar();\n      } else {\n        expandSideBar();\n      }\n      return;\n    }\n    setSelectedTabIndex(tabIndex);\n    expandSideBar();\n  };\n\n  // Do not render the sidebar if there are no tabs.\n  if (tabs.length === 0) {\n    return <div className=\"sidebar-container\" />;\n  }\n\n  return (\n    <div className=\"sidebar-container\">\n      <div className=\"tab-container\">\n        {tabs.map((tab, index) => (\n          <Card\n            key={index}\n            className={classNames('tab', { selected: isExpanded && selectedTabIndex === index })}\n            onClick={() => handleTabSelection(index)}\n          >\n            <Icon className=\"tab-icon\" icon={tab.iconName} size={14} />\n            {tab.label}\n          </Card>\n        ))}\n      </div>\n      {selectedTabIndex !== null && <Card className=\"panel\">{tabs[selectedTabIndex].body}</Card>}\n    </div>\n  );\n};\n\nexport default SideBar;\n","import { Card, Icon, Tab, TabProps, Tabs } from '@blueprintjs/core';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport * as React from 'react';\n\nimport { propsAreEqual } from '../utils/MemoizeHelper';\nimport { assertType } from '../utils/TypeHelper';\nimport { WorkspaceLocation } from '../workspace/WorkspaceTypes';\nimport GenericSideContent, { generateIconId, GenericSideContentProps } from './GenericSideContent';\nimport { SideContentTab, SideContentType } from './SideContentTypes';\n\n/**\n * @property onChange A function that is called whenever the\n * active tab is changed by the user.\n *\n * @property tabs An array of SideContentTabs.\n *  The tabs will be rendered in order of the array.\n *  If this array is empty, no tabs will be rendered.\n *\n * @property renderActiveTabPanelOnly Set this property to\n * true to enable unmounting of tab panels whenever tabs are\n * switched. If it is left undefined, the value will default\n * to false, and the tab panels will all be loaded with the\n * mounting of the SideContent component. Switching tabs\n * will merely hide them from view.\n */\nexport type SideContentProps = Omit<GenericSideContentProps, 'renderFunction'> & StateProps;\n\ntype StateProps = {\n  selectedTabId?: SideContentType; // Optional due to uncontrolled tab component in EditingWorkspace\n  renderActiveTabPanelOnly?: boolean;\n  editorWidth?: string;\n  sideContentHeight?: number;\n};\n\n/**\n * Adds 'side-content-tab-alert' style to newly spawned module tabs or HTML Display tab\n */\nconst generateClassName = (id: string | undefined) =>\n  id === SideContentType.module || id === SideContentType.htmlDisplay\n    ? 'side-content-tooltip side-content-tab-alert'\n    : 'side-content-tooltip';\n\nconst renderTab = (\n  tab: SideContentTab,\n  workspaceLocation?: WorkspaceLocation,\n  editorWidth?: string,\n  sideContentHeight?: number\n) => {\n  const iconSize = 20;\n  const tabId = tab.id === undefined || tab.id === SideContentType.module ? tab.label : tab.id;\n  const tabTitle = (\n    <Tooltip2 content={tab.label}>\n      <div className={generateClassName(tab.id)} id={generateIconId(tabId)}>\n        <Icon icon={tab.iconName} iconSize={iconSize} />\n      </div>\n    </Tooltip2>\n  );\n  const tabProps = assertType<TabProps>()({\n    id: tabId,\n    title: tabTitle,\n    disabled: tab.disabled,\n    className: 'side-content-tab'\n  });\n\n  if (!tab.body) {\n    return <Tab key={tabId} {...tabProps} />;\n  }\n\n  const tabBody: JSX.Element = workspaceLocation\n    ? {\n        ...tab.body,\n        props: {\n          ...tab.body.props,\n          workspaceLocation,\n          editorWidth,\n          sideContentHeight\n        }\n      }\n    : tab.body;\n  const tabPanel: JSX.Element = <div className=\"side-content-text\">{tabBody}</div>;\n\n  return <Tab key={tabId} {...tabProps} panel={tabPanel} />;\n};\n\nconst SideContent: React.FC<SideContentProps> = React.memo(\n  ({ selectedTabId, renderActiveTabPanelOnly, editorWidth, sideContentHeight, ...otherProps }) => {\n    return (\n      <GenericSideContent\n        {...otherProps}\n        renderFunction={(dynamicTabs, changeTabsCallback) => (\n          <div className=\"side-content\">\n            <Card>\n              <div className=\"side-content-tabs\">\n                <Tabs\n                  id=\"side-content-tabs\"\n                  onChange={changeTabsCallback}\n                  renderActiveTabPanelOnly={renderActiveTabPanelOnly}\n                  selectedTabId={selectedTabId}\n                >\n                  {dynamicTabs.map(tab =>\n                    renderTab(tab, otherProps.workspaceLocation, editorWidth, sideContentHeight)\n                  )}\n                </Tabs>\n              </div>\n            </Card>\n          </div>\n        )}\n      />\n    );\n  },\n  propsAreEqual\n);\n\nexport default SideContent;\n","import { FocusStyleManager } from '@blueprintjs/core';\nimport { Enable, NumberSize, Resizable, ResizableProps, ResizeCallback } from 're-resizable';\nimport { Direction } from 're-resizable/lib/resizer';\nimport * as React from 'react';\nimport { Prompt } from 'react-router';\n\nimport ControlBar, { ControlBarProps } from '../controlBar/ControlBar';\nimport EditorContainer, { EditorContainerProps } from '../editor/EditorContainer';\nimport McqChooser, { McqChooserProps } from '../mcqChooser/McqChooser';\nimport Repl, { ReplProps } from '../repl/Repl';\nimport SideBar, { SideBarTab } from '../sideBar/SideBar';\nimport SideContent, { SideContentProps } from '../sideContent/SideContent';\nimport { useDimensions } from '../utils/Hooks';\n\nexport type WorkspaceProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleSideContentHeightChange: (height: number) => void;\n};\n\ntype StateProps = {\n  // Either editorProps or mcqProps must be provided\n  controlBarProps: ControlBarProps;\n  editorContainerProps?: EditorContainerProps;\n  hasUnsavedChanges?: boolean;\n  mcqProps?: McqChooserProps;\n  replProps: ReplProps;\n  sideBarProps: {\n    tabs: SideBarTab[];\n  };\n  sideContentHeight?: number;\n  sideContentProps: SideContentProps;\n  sideContentIsResizeable?: boolean;\n};\n\nconst Workspace: React.FC<WorkspaceProps> = props => {\n  const sideBarResizable = React.useRef<Resizable | null>(null);\n  const contentContainerDiv = React.useRef<HTMLDivElement | null>(null);\n  const editorDividerDiv = React.useRef<HTMLDivElement | null>(null);\n  const leftParentResizable = React.useRef<Resizable | null>(null);\n  const maxDividerHeight = React.useRef<number | null>(null);\n  const sideDividerDiv = React.useRef<HTMLDivElement | null>(null);\n  const [contentContainerWidth] = useDimensions(contentContainerDiv);\n  const [lastExpandedSideBarWidth, setLastExpandedSideBarWidth] = React.useState<number>(200);\n  const [isSideBarExpanded, setIsSideBarExpanded] = React.useState<boolean>(false);\n\n  const sideBarCollapsedWidth = 40;\n\n  const expandSideBar = () => {\n    setIsSideBarExpanded(true);\n    const sideBar = sideBarResizable.current;\n    if (sideBar === null) {\n      throw Error('Reference to SideBar not found when expanding.');\n    }\n    sideBar.updateSize({ width: lastExpandedSideBarWidth, height: '100%' });\n  };\n\n  const collapseSideBar = () => {\n    setIsSideBarExpanded(false);\n    const sideBar = sideBarResizable.current;\n    if (sideBar === null) {\n      throw Error('Reference to SideBar not found when collapsing.');\n    }\n    sideBar.updateSize({ width: sideBarCollapsedWidth, height: '100%' });\n  };\n\n  FocusStyleManager.onlyShowFocusOnTabs();\n\n  React.useEffect(() => {\n    if (props.sideContentIsResizeable && maxDividerHeight.current === null) {\n      maxDividerHeight.current = sideDividerDiv.current!.clientHeight;\n    }\n  });\n\n  const sideBarResizableProps = () => {\n    const onResizeStop: ResizeCallback = (\n      event: MouseEvent | TouchEvent,\n      direction: Direction,\n      elementRef: HTMLElement,\n      delta: NumberSize\n    ) => {\n      const sideBarWidth = elementRef.clientWidth;\n      if (sideBarWidth !== sideBarCollapsedWidth) {\n        setLastExpandedSideBarWidth(sideBarWidth);\n      }\n    };\n    const isSideBarRendered = props.sideBarProps.tabs.length !== 0;\n    const minWidth = isSideBarRendered ? sideBarCollapsedWidth : 'auto';\n    return {\n      enable: isSideBarRendered ? rightResizeOnly : noResize,\n      minWidth,\n      maxWidth: '50%',\n      onResize: toggleSideBarDividerDisplay,\n      onResizeStop,\n      ref: sideBarResizable,\n      defaultSize: { width: minWidth, height: '100%' }\n    } as ResizableProps;\n  };\n\n  const editorResizableProps = () => {\n    return {\n      className: 'resize-editor left-parent',\n      enable: rightResizeOnly,\n      minWidth: 0,\n      onResize: toggleEditorDividerDisplay,\n      ref: leftParentResizable,\n      defaultSize: { width: '50%', height: '100%' },\n      as: undefined as any // re-resizable bug - wrong typedef\n    } as ResizableProps;\n  };\n\n  const sideContentResizableProps = () => {\n    const onResizeStop: ResizeCallback = (_a, _b, ref) =>\n      props.handleSideContentHeightChange(ref.clientHeight);\n    return {\n      bounds: 'parent',\n      className: 'resize-side-content',\n      enable: bottomResizeOnly,\n      onResize: toggleDividerDisplay,\n      onResizeStop\n    } as ResizableProps;\n  };\n\n  const toggleSideBarDividerDisplay: ResizeCallback = (\n    event: MouseEvent | TouchEvent,\n    direction: Direction,\n    elementRef: HTMLElement,\n    delta: NumberSize\n  ) => {\n    const minWidthThreshold = 100;\n    const sideBarWidth = elementRef.clientWidth;\n    if (sideBarWidth < minWidthThreshold) {\n      const sideBar = sideBarResizable.current;\n      if (sideBar === null) {\n        throw Error('Reference to SideBar not found when resizing.');\n      }\n      sideBar.updateSize({ width: 40, height: '100%' });\n      setIsSideBarExpanded(false);\n    } else {\n      setIsSideBarExpanded(true);\n    }\n  };\n\n  /**\n   * Snaps the left-parent resizable to 100% or 0% when percentage width goes\n   * above 95% or below 5% respectively. Also changes the editor divider width\n   * in the case of < 5%.\n   */\n  const toggleEditorDividerDisplay: ResizeCallback = (_a, _b, ref) => {\n    const leftThreshold = 5;\n    const rightThreshold = 95;\n    const editorWidthPercentage =\n      ((ref as HTMLDivElement).clientWidth / contentContainerWidth) * 100;\n    // update resizable size\n    if (editorWidthPercentage > rightThreshold) {\n      leftParentResizable.current!.updateSize({ width: '100%', height: '100%' });\n    } else if (editorWidthPercentage < leftThreshold) {\n      leftParentResizable.current!.updateSize({ width: '0%', height: '100%' });\n    }\n  };\n\n  /**\n   * Hides the side-content-divider div when side-content is resized downwards\n   * so that it's bottom border snaps flush with editor's bottom border\n   */\n  const toggleDividerDisplay: ResizeCallback = (_a, _b, ref) => {\n    maxDividerHeight.current =\n      sideDividerDiv.current!.clientHeight > maxDividerHeight.current!\n        ? sideDividerDiv.current!.clientHeight\n        : maxDividerHeight.current;\n    const resizableHeight = (ref as HTMLDivElement).clientHeight;\n    const rightParentHeight = (ref.parentNode as HTMLDivElement).clientHeight;\n    if (resizableHeight + maxDividerHeight.current! + 2 > rightParentHeight) {\n      sideDividerDiv.current!.style.display = 'none';\n    } else {\n      sideDividerDiv.current!.style.display = 'initial';\n    }\n  };\n\n  /**\n   * Pre-condition: `props.editorProps`\n   * XOR `props.mcq` are defined.\n   */\n  const createWorkspaceInput = (props: WorkspaceProps) => {\n    if (props.editorContainerProps) {\n      return <EditorContainer {...props.editorContainerProps} />;\n    } else {\n      return <McqChooser {...props.mcqProps!} />;\n    }\n  };\n\n  const sideContent = <SideContent {...props.sideContentProps} />;\n  const resizableSideContent = (\n    <Resizable {...sideContentResizableProps()}>\n      {sideContent}\n      <div className=\"side-content-divider\" ref={sideDividerDiv} />\n    </Resizable>\n  );\n\n  return (\n    <div className=\"workspace\">\n      {props.hasUnsavedChanges ? (\n        <Prompt\n          message={'You have changes that may not be saved. Are you sure you want to leave?'}\n        />\n      ) : null}\n      <ControlBar {...props.controlBarProps} />\n      <div className=\"workspace-parent\">\n        <Resizable {...sideBarResizableProps()}>\n          <SideBar\n            {...props.sideBarProps}\n            isExpanded={isSideBarExpanded}\n            expandSideBar={expandSideBar}\n            collapseSideBar={collapseSideBar}\n          />\n        </Resizable>\n        <div className=\"row content-parent\" ref={contentContainerDiv}>\n          <div className=\"editor-divider\" ref={editorDividerDiv} />\n          <Resizable {...editorResizableProps()}>{createWorkspaceInput(props)}</Resizable>\n          <div className=\"right-parent\">\n            {props.sideContentIsResizeable === undefined || props.sideContentIsResizeable\n              ? resizableSideContent\n              : sideContent}\n            <Repl {...props.replProps} />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst rightResizeOnly: Enable = { right: true };\nconst bottomResizeOnly: Enable = { bottom: true };\nconst noResize: Enable = {};\n\nexport default Workspace;\n","import { action } from 'typesafe-actions';\n\nimport { WorkspaceLocation } from '../../../commons/workspace/WorkspaceTypes';\nimport { Input, PlaybackData } from '../SourceRecorderTypes';\nimport {\n  DELETE_SOURCECAST_ENTRY,\n  RECORD_INIT,\n  RECORD_INPUT,\n  RESET_INPUTS,\n  TIMER_PAUSE,\n  TIMER_RESET,\n  TIMER_RESUME,\n  TIMER_START,\n  TIMER_STOP\n} from './SourcereelTypes';\n\nexport const deleteSourcecastEntry = (id: number, workspaceLocation: WorkspaceLocation) =>\n  action(DELETE_SOURCECAST_ENTRY, {\n    id,\n    workspaceLocation\n  });\n\nexport const recordInit = (initData: PlaybackData['init'], workspaceLocation: WorkspaceLocation) =>\n  action(RECORD_INIT, {\n    initData,\n    workspaceLocation\n  });\n\nexport const recordInput = (input: Input, workspaceLocation: WorkspaceLocation) =>\n  action(RECORD_INPUT, {\n    input,\n    workspaceLocation\n  });\n\nexport const resetInputs = (inputs: Input[], workspaceLocation: WorkspaceLocation) =>\n  action(RESET_INPUTS, {\n    inputs,\n    workspaceLocation\n  });\n\nexport const timerPause = (workspaceLocation: WorkspaceLocation) =>\n  action(TIMER_PAUSE, {\n    timeNow: Date.now(),\n    workspaceLocation\n  });\n\nexport const timerReset = (workspaceLocation: WorkspaceLocation) =>\n  action(TIMER_RESET, {\n    workspaceLocation\n  });\n\nexport const timerResume = (timeBefore: number, workspaceLocation: WorkspaceLocation) =>\n  action(TIMER_RESUME, {\n    timeBefore,\n    timeNow: Date.now(),\n    workspaceLocation\n  });\n\nexport const timerStart = (workspaceLocation: WorkspaceLocation) =>\n  action(TIMER_START, {\n    timeNow: Date.now(),\n    workspaceLocation\n  });\n\nexport const timerStop = (workspaceLocation: WorkspaceLocation) =>\n  action(TIMER_STOP, {\n    timeNow: Date.now(),\n    workspaceLocation\n  });\n","import { Chapter } from 'c-slang/dist/types';\nimport { v4 as uuid } from 'uuid';\n\nimport { ExternalLibraryName } from '../../commons/application/types/ExternalTypes';\nimport { Input as RecorderInput } from '../sourceRecorder/SourceRecorderTypes';\n\nexport const playgroundQuestionId: number = -1;\n\ntype PlaybackInitial = {\n  chapter: Chapter;\n  externalLibrary?: ExternalLibraryName;\n  editorValue: string;\n};\n\ntype PlaybackInitialTagged = PlaybackInitial & {\n  type: 'init';\n  time: number;\n};\n\ntype Input = RecorderInput | PlaybackInitialTagged;\n\nconst questionIdLookup: { [id: string]: string } = {};\n\n// ------------------- EXTERNAL API -------------------\n\nconst cadetLoggerUrl = process.env.REACT_APP_CADET_LOGGER;\nexport function log(id: string, input: Input) {\n  if (process.env.NODE_ENV === 'test' || !cadetLoggerUrl) {\n    return;\n  } // This is set statically\n  saveRecord({\n    ...input,\n    questionId: questionIdLookup[id],\n    sessionId: id\n  });\n}\n\n// Creates a session, then logs it.\nexport function initSession(questionId: string, initialState: PlaybackInitial): string {\n  const id = uuid();\n  questionIdLookup[id] = questionId;\n  log(id, {\n    ...initialState,\n    type: 'init',\n    time: Date.now()\n  });\n  return id;\n}\n\n// ------------------- INDEXEDDB API -------------------\ntype LogRecord = Input & {\n  sessionId: string;\n  questionId: string;\n  time: number;\n};\n\n// Yes, past tense. For when it is inside the log.\nexport type LoggedRecord = LogRecord & { id: number };\n\nconst VERSION = 1;\nconst DB_NAME = 'evtlogs';\nconst STORE_NAME = 'logs';\nconst getDB = memoize((): Promise<IDBDatabase> => {\n  return new Promise((resolve, reject) => {\n    // Make a request\n    const request = indexedDB.open(DB_NAME, VERSION);\n    // hook the onsuccess\n    request.onsuccess = evt => {\n      resolve(request.result);\n    };\n\n    request.onerror = evt => {\n      console.error('Failed to get db', evt);\n      reject(request.error);\n    };\n\n    // Set it up if necessary (on upgrade)\n    request.onupgradeneeded = evt => {\n      // Create the database here\n      const db: IDBDatabase = (evt?.target as any).result; // Bug with the types...\n      db.createObjectStore(STORE_NAME, {\n        keyPath: 'id', // Entry id, only used to figure out the last transfered value\n        autoIncrement: true\n      });\n    };\n  });\n});\n\nfunction saveRecord(record: LogRecord) {\n  return new Promise((resolve, reject) => {\n    getDB().then(db => {\n      const transaction = db.transaction([STORE_NAME], 'readwrite');\n      transaction.oncomplete = resolve;\n      transaction.onerror = reject;\n\n      const objectStore = transaction.objectStore(STORE_NAME);\n      /*const request = */ objectStore.add(record);\n      // Can actually check for request success.\n    });\n  });\n}\n\n// Retrieving and uploading records\n// This forces it to be singleton,\n// preventing multiple uploads without a lock.\n\nexport function getRecords(): Promise<LoggedRecord[]> {\n  return new Promise((resolve, reject) => {\n    getDB().then(db => {\n      const transaction = db.transaction([STORE_NAME], 'readwrite');\n      const objectStore = transaction.objectStore(STORE_NAME);\n      objectStore.getAll().onsuccess = function (evt) {\n        const result = (evt?.target as any).result;\n        resolve(result);\n      };\n    });\n  });\n}\n\nexport function deleteRecordsUpto(id: number) {\n  return new Promise((resolve, reject) => {\n    getDB().then(db => {\n      const transaction = db.transaction([STORE_NAME], 'readwrite');\n      const range = IDBKeyRange.bound(0, id, false, false);\n      const objectStore = transaction.objectStore(STORE_NAME);\n      objectStore.delete(range);\n      transaction.oncomplete = resolve;\n      transaction.onerror = reject;\n    });\n  });\n}\n\n// Importing lodash for this is apparently a bad idea.\n// This saves 70kb. Out of 72kb.\nfunction memoize<T>(fn: () => T) {\n  let answer: T | null = null;\n  return () => {\n    if (!answer) {\n      answer = fn();\n      return answer;\n    } else {\n      return answer;\n    }\n  };\n}\n","import { Card, Elevation, Pre } from '@blueprintjs/core';\nimport classNames from 'classnames';\nimport * as React from 'react';\n\nimport { AutogradingError, AutogradingResult } from '../assessment/AssessmentTypes';\n\ntype SideContentResultCardProps = StateProps;\n\ntype StateProps = {\n  index: number;\n  result: AutogradingResult;\n};\n\nconst buildErrorString = (errors: AutogradingError[]) =>\n  errors\n    .map(error => {\n      switch (error.errorType) {\n        case 'timeout':\n          return '[TIMEOUT] Submission exceeded time limit for this test case.';\n        case 'syntax':\n          return `[SYNTAX] Line ${error.line}: ${error.errorExplanation}`;\n        case 'runtime':\n          return `[RUNTIME] Line ${error.line}: ${error.errorExplanation}`;\n        case 'systemError':\n          return `[SYSTEM] ${error.errorMessage}`;\n        default:\n          return `[UNKNOWN] Autograder error: type ${error.errorType}`;\n      }\n    })\n    .join('\\n\\n');\n\nconst SideContentResultCard: React.FunctionComponent<SideContentResultCardProps> = props => {\n  const { index, result } = props;\n\n  return (\n    <div className={classNames('ResultCard', result.resultType === 'pass' ? 'correct' : 'wrong')}>\n      <Card elevation={Elevation.ONE}>\n        <div className=\"result-data\">\n          <div className=\"result-idx\">{index + 1}</div>\n          <div className=\"result-status\">{result.resultType.toUpperCase()}</div>\n        </div>\n        <Pre className=\"result-expected\">{result.expected!}</Pre>\n        <Pre className=\"result-actual\">\n          {result.resultType === 'error' ? buildErrorString(result.errors!) : result.actual!}\n        </Pre>\n      </Card>\n    </div>\n  );\n};\n\nexport default SideContentResultCard;\n","import { Button, Collapse, Icon, PopoverPosition } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport * as React from 'react';\n\nimport { AutogradingResult, Testcase } from '../assessment/AssessmentTypes';\nimport ControlButton from '../ControlButton';\nimport { WorkspaceLocation } from '../workspace/WorkspaceTypes';\nimport SideContentResultCard from './SideContentResultCard';\nimport SideContentTestcaseCard from './SideContentTestcaseCard';\n\nexport type SideContentAutograderProps = DispatchProps & StateProps & OwnProps;\n\ntype DispatchProps = {\n  handleTestcaseEval: (testcaseId: number) => void;\n};\n\ntype StateProps = {\n  autogradingResults: AutogradingResult[];\n  testcases: Testcase[];\n};\n\ntype OwnProps = {\n  /**\n   * We need to know the workspace location to hide 'opaque' testcases\n   * in AssessmentsWorkspace, but show them in GradingWorkspace.\n   */\n  workspaceLocation: WorkspaceLocation;\n};\n\nconst SideContentAutograder: React.FunctionComponent<SideContentAutograderProps> = props => {\n  const [showsTestcases, setTestcasesShown] = React.useState<boolean>(true);\n  const [showsResults, setResultsShown] = React.useState<boolean>(true);\n\n  const { testcases, autogradingResults, handleTestcaseEval, workspaceLocation } = props;\n\n  const testcaseCards = React.useMemo(\n    () =>\n      testcases.length > 0 ? (\n        <div className=\"testcaseCards\">\n          {testcasesHeader}\n          {testcases.map((testcase, index) => (\n            <SideContentTestcaseCard\n              key={index}\n              index={index}\n              testcase={testcase}\n              handleTestcaseEval={handleTestcaseEval}\n              workspaceLocation={workspaceLocation}\n            />\n          ))}\n        </div>\n      ) : (\n        <div className=\"noResults\">There are no testcases provided for this question.</div>\n      ),\n    [testcases, handleTestcaseEval, workspaceLocation]\n  );\n\n  const resultCards = React.useMemo(\n    () =>\n      autogradingResults.length > 0 ? (\n        <div>\n          {resultsHeader}\n          {autogradingResults.map((result, index) => (\n            <SideContentResultCard key={index} index={index} result={result} />\n          ))}\n        </div>\n      ) : (\n        <div className=\"noResults\">There are no results to show.</div>\n      ),\n    [autogradingResults]\n  );\n\n  const toggleTestcases = React.useCallback(() => {\n    setTestcasesShown(!showsTestcases);\n  }, [showsTestcases]);\n\n  const toggleResults = React.useCallback(() => setResultsShown(!showsResults), [showsResults]);\n\n  return (\n    <div className=\"Autograder\">\n      <Button\n        className=\"collapse-button\"\n        icon={showsTestcases ? IconNames.CARET_DOWN : IconNames.CARET_RIGHT}\n        minimal={true}\n        onClick={toggleTestcases}\n      >\n        <span>Testcases</span>\n        <Tooltip2 content={autograderTooltip} placement={PopoverPosition.LEFT}>\n          <Icon icon={IconNames.HELP} />\n        </Tooltip2>\n      </Button>\n      <Collapse isOpen={showsTestcases} keepChildrenMounted={true}>\n        {testcaseCards}\n      </Collapse>\n      {collapseButton('Autograder Results', showsResults, toggleResults)}\n      <Collapse isOpen={showsResults} keepChildrenMounted={true}>\n        {resultCards}\n      </Collapse>\n    </div>\n  );\n};\n\nconst autograderTooltip = (\n  <div className=\"autograder-help-tooltip\">\n    <p>Click on each testcase below to execute it with the program in the editor.</p>\n    <p>\n      To execute all testcases at once, evaluate the program in the editor with this tab active.\n    </p>\n    <p>A green or red background indicates a passed or failed testcase respectively.</p>\n    <p>Private testcases (only visible to staff when grading) have a grey background.</p>\n  </div>\n);\n\nconst columnHeader = (colClass: string, colTitle: string) => (\n  <div className={colClass}>\n    {colTitle}\n    <Icon icon={IconNames.CARET_DOWN} />\n  </div>\n);\n\nconst testcasesHeader = (\n  <div className=\"testcases-header\">\n    {columnHeader('header-fn', 'Testcase')}\n    {columnHeader('header-expected', 'Expected result')}\n    {columnHeader('header-actual', 'Actual result')}\n  </div>\n);\n\nconst resultsHeader = (\n  <div className=\"results-header\">\n    <div className=\"header-data\">\n      {columnHeader('header-sn', 'S/N')}\n      {columnHeader('header-status', 'Testcase status')}\n    </div>\n    {columnHeader('header-expected', 'Expected result')}\n    {columnHeader('header-actual', 'Actual result')}\n  </div>\n);\n\nconst collapseButton = (label: string, isOpen: boolean, toggleFunc: () => void) => (\n  <ControlButton\n    label={label}\n    icon={isOpen ? IconNames.CARET_DOWN : IconNames.CARET_RIGHT}\n    onClick={toggleFunc}\n    options={{ className: 'collapse-button', minimal: true }}\n  />\n);\n\nexport default SideContentAutograder;\n","import { Card, Classes, Elevation, Pre } from '@blueprintjs/core';\nimport classNames from 'classnames';\nimport React from 'react';\n\nimport { ContestEntry } from '../assessment/AssessmentTypes';\n\ntype SideContentLeaderboardCardProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleContestEntryClick: (submissionId: number, answer: string) => void;\n};\n\ntype StateProps = {\n  contestEntry: ContestEntry;\n  rank: number;\n};\n\nconst SideContentLeaderboardCard: React.FunctionComponent<\n  SideContentLeaderboardCardProps\n> = props => {\n  const { handleContestEntryClick, contestEntry, rank } = props;\n\n  return (\n    <div className={classNames('LeaderboardCard')}>\n      <Card\n        className={Classes.INTERACTIVE}\n        elevation={Elevation.ONE}\n        onClick={() =>\n          handleContestEntryClick(contestEntry.submission_id, contestEntry.answer.code ?? '')\n        }\n      >\n        <Pre className=\"contestentry-entryid\">{contestEntry.student_name}</Pre>\n        <Pre className=\"contestentry-rank\">{rank}</Pre>\n        <Pre className=\"contestentry-score\">{contestEntry.final_score}</Pre>\n      </Card>\n    </div>\n  );\n};\n\nexport default SideContentLeaderboardCard;\n","import { Button, Collapse, Icon } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport React, { useMemo, useState } from 'react';\n\nimport { ContestEntry } from '../assessment/AssessmentTypes';\nimport SideContentLeaderboardCard from './SideContentLeaderboardCard';\n\nexport type SideContentContestLeaderboardProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleContestEntryClick: (submissionId: number, answer: string) => void;\n};\n\ntype StateProps = {\n  orderedContestEntries: ContestEntry[];\n};\n\n/*\nContest Leaderboard inner components\n*/\nconst columnHeader = (colClass: string, colTitle: string) => (\n  <div className={colClass}>\n    {colTitle}\n    <Icon icon={IconNames.CARET_DOWN} />\n  </div>\n);\n\nconst contestEntryHeader = (\n  <div className=\"leaderboard-header\">\n    {columnHeader('header-entryid', 'Student Name')}\n    {columnHeader('header-entryrank', 'Rank')}\n    {columnHeader('header-score', 'Score')}\n  </div>\n);\n\nconst contestLeaderboardTooltipContent = 'View the top-rated contest entries!';\n\n/**\n * Renders the contest leaderboard entries as a SideContentTab for Contest Voting questions.\n * Note that the prop is named 'orderedContestEntries' as the responsibility to sort\n * in desc score order is left to the backend.\n *\n * @param props {orderedContestEntries: an ordered list by desc score of leaderboard entries to display,\n *  handleContestEntryClick: displays contest entry answer in assessment workspace editor}\n */\nconst SideContentContestLeaderboard: React.FunctionComponent<\n  SideContentContestLeaderboardProps\n> = props => {\n  const { orderedContestEntries, handleContestEntryClick } = props;\n  const [showLeaderboard, setShowLeaderboard] = useState<boolean>(true);\n\n  const contestEntryCards = useMemo(\n    () => (\n      <div>\n        {contestEntryHeader}\n        {orderedContestEntries.length > 0 ? (\n          orderedContestEntries.map((contestEntry: ContestEntry, index: number) => (\n            <SideContentLeaderboardCard\n              key={contestEntry.submission_id}\n              handleContestEntryClick={handleContestEntryClick}\n              contestEntry={contestEntry}\n              rank={index + 1}\n            />\n          ))\n        ) : (\n          <div className=\"noResults\">There are no eligible contest leaderboard entries found.</div>\n        )}\n      </div>\n    ),\n    [handleContestEntryClick, orderedContestEntries]\n  );\n\n  return (\n    <div className=\"ContestLeaderboard\">\n      <Button\n        className=\"collapse-button\"\n        icon={showLeaderboard ? IconNames.CARET_DOWN : IconNames.CARET_RIGHT}\n        minimal={true}\n        onClick={() => setShowLeaderboard(!showLeaderboard)}\n      >\n        <span>Contest Leaderboard</span>\n        <Tooltip2 content={contestLeaderboardTooltipContent}>\n          <Icon icon={IconNames.HELP} />\n        </Tooltip2>\n      </Button>\n      <Collapse isOpen={showLeaderboard} keepChildrenMounted>\n        {contestEntryCards}\n      </Collapse>\n    </div>\n  );\n};\n\nexport default SideContentContestLeaderboard;\n","import { Card, Classes, Elevation, NumericInput, Pre } from '@blueprintjs/core';\nimport classNames from 'classnames';\nimport React from 'react';\n\nimport { ContestEntry } from '../assessment/AssessmentTypes';\n\ntype SideContentConstestEntryCardProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleContestEntryClick: (submissionId: number, answer: string) => void;\n};\n\ntype StateProps = {\n  handleVotingSubmissionChange: (entryId: number, rank: number) => void;\n  canSave: boolean;\n  isValid: boolean;\n  contestEntry: ContestEntry;\n  entryNumber: number;\n  minScore: number;\n  maxScore: number;\n};\n\n/**\n * Pure Contest Entry Card to to provide numeric input box for contest entry voting.\n * @param props functions for handling input and contest entry details tied to contest entry card.\n * @returns card which provides numeric input to vote for contest entry.\n */\nconst SideContentContestEntryCard: React.FunctionComponent<\n  SideContentConstestEntryCardProps\n> = props => {\n  const {\n    canSave,\n    isValid,\n    handleContestEntryClick,\n    handleVotingSubmissionChange,\n    contestEntry,\n    entryNumber,\n    minScore,\n    maxScore\n  } = props;\n\n  return (\n    <div className={classNames('ContestEntryCard', { wrong: !isValid })}>\n      <Card\n        className={Classes.INTERACTIVE}\n        elevation={Elevation.ONE}\n        onClick={() =>\n          handleContestEntryClick(contestEntry.submission_id, contestEntry.answer.code ?? '')\n        }\n      >\n        <Pre className=\"contestentry-entryid\">{entryNumber}</Pre>\n        <Pre className=\"contestentry-rank\">\n          <NumericInput\n            disabled={!canSave}\n            value={contestEntry.score}\n            onValueChange={(score: number) =>\n              handleVotingSubmissionChange(contestEntry.submission_id, score)\n            }\n            placeholder={`Enter score for entry ${entryNumber}`}\n            min={minScore}\n            max={maxScore}\n            allowNumericCharactersOnly\n            fill\n            minorStepSize={null} // limits input to integers\n          />\n        </Pre>\n      </Card>\n    </div>\n  );\n};\n\nexport default SideContentContestEntryCard;\n","import { Button, Collapse, Icon } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport React, { useMemo, useState } from 'react';\n\nimport { ContestEntry } from '../assessment/AssessmentTypes';\nimport SideContentContestEntryCard from './SideContentContestEntryCard';\n\nexport type SideContentContestVotingProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleContestEntryClick: (submissionId: number, answer: string) => void;\n};\n\ntype StateProps = {\n  canSave: boolean;\n  isValid: boolean;\n  handleVotingSubmissionChange: (entryId: number, score: number) => void;\n  contestEntries: ContestEntry[];\n  minScore: number;\n  maxScore: number;\n};\n\n/*\nContest voting inner components\n*/\nconst columnHeader = (colClass: string, colTitle: string) => (\n  <div className={colClass}>\n    {colTitle}\n    <Icon icon={IconNames.CARET_DOWN} />\n  </div>\n);\n\nconst contestEntryHeader = (\n  <div className=\"contestentries-header\">\n    {columnHeader('header-entryid', 'Entry Id')}\n    {columnHeader('header-entryrank', 'Score')}\n  </div>\n);\n\n/**\n * Main contest voting tab\n * @param props contestEntries for student to vote for : ContestEntry[],\n * and behaviour for onClick: entryId => void\n */\nconst SideContentContestVoting: React.FunctionComponent<SideContentContestVotingProps> = props => {\n  const {\n    contestEntries,\n    canSave,\n    isValid,\n    handleContestEntryClick,\n    handleVotingSubmissionChange,\n    maxScore,\n    minScore\n  } = props;\n  const [showContestEntries, setShowContestEntries] = useState<boolean>(true);\n\n  const contestEntryCards = useMemo(\n    () => (\n      <div>\n        {contestEntryHeader}\n        {contestEntries.length > 0 ? (\n          contestEntries.map((contestEntry: ContestEntry, index) => (\n            <SideContentContestEntryCard\n              isValid={isValid}\n              canSave={canSave}\n              entryNumber={index + 1}\n              key={contestEntry.submission_id}\n              handleContestEntryClick={handleContestEntryClick}\n              handleVotingSubmissionChange={handleVotingSubmissionChange}\n              contestEntry={contestEntry}\n              minScore={minScore}\n              maxScore={maxScore}\n            />\n          ))\n        ) : (\n          <div className=\"noResults\">There are no eligible entries for voting found.</div>\n        )}\n      </div>\n    ),\n    // determines when to re-render\n    [\n      isValid,\n      canSave,\n      contestEntries,\n      handleContestEntryClick,\n      handleVotingSubmissionChange,\n      maxScore,\n      minScore\n    ]\n  );\n\n  return (\n    <div className=\"ContestEntryVoting\">\n      <Button\n        className=\"collapse-button\"\n        icon={showContestEntries ? IconNames.CARET_DOWN : IconNames.CARET_RIGHT}\n        minimal={true}\n        onClick={() => setShowContestEntries(!showContestEntries)}\n      >\n        <span>Contest Voting</span>\n        <Tooltip2\n          content={\n            <span>\n              Score your favourite contest entries from {minScore} (worst) to {maxScore} (best)!\n            </span>\n          }\n        >\n          <Icon icon={IconNames.HELP} />\n        </Tooltip2>\n      </Button>\n      <Collapse isOpen={showContestEntries} keepChildrenMounted>\n        {contestEntryCards}\n      </Collapse>\n    </div>\n  );\n};\n\nexport default SideContentContestVoting;\n","import React, { useEffect, useState } from 'react';\nimport { showWarningMessage } from 'src/commons/utils/NotificationsHelper';\n\nimport { ContestEntry } from '../assessment/AssessmentTypes';\nimport SideContentContestVoting from './SideContentContestVoting';\n\nexport type SideContentContestVotingContainerProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleContestEntryClick: (submissionId: number, answer: string) => void;\n  handleSave: (votingSubmission: ContestEntry[]) => void;\n};\n\ntype StateProps = {\n  canSave: boolean;\n  contestEntries: ContestEntry[];\n};\n\n/**\n * Container to separate behaviour concerns from rendering concerns\n * Stores component-level voting ranking state\n */\nconst SideContentContestVotingContainer: React.FunctionComponent<\n  SideContentContestVotingContainerProps\n> = props => {\n  const { canSave, contestEntries, handleSave, handleContestEntryClick } = props;\n  const [isValid, setIsValid] = useState<boolean>(true);\n  const [votingSubmission, setVotingSubmission] = useState<ContestEntry[]>([]);\n  const minScore = 11 - contestEntries.length;\n  const maxScore = 10;\n\n  useEffect(() => {\n    setVotingSubmission(contestEntries);\n  }, [contestEntries]);\n\n  /**\n   * Validates input value and clamps the value within the min-max range [1, number of entries].\n   * @param votingSubmission voting scores by user for each contest entry.\n   * @returns boolean value for whether the scores are within the min-max range.\n   */\n  const isSubmissionValid = (votingSubmission: ContestEntry[]) => {\n    return votingSubmission.reduce((isValid, vote) => {\n      const score = vote.score!;\n      return isValid && score >= minScore && score <= maxScore;\n    }, true);\n  };\n\n  const submissionHasNoNull = (votingSubmission: ContestEntry[]) => {\n    return votingSubmission.reduce((noNull, vote) => {\n      return noNull && vote.score !== undefined && vote.score !== null;\n    }, true);\n  };\n\n  const handleVotingSubmissionChange = (submissionId: number, score: number): void => {\n    // update the votes\n    const updatedSubmission = votingSubmission.map(vote =>\n      vote.submission_id === submissionId ? { ...vote, score: score } : vote\n    );\n    setVotingSubmission(updatedSubmission);\n    const noDuplicates =\n      new Set(updatedSubmission.map(vote => vote.score)).size === updatedSubmission.length;\n    // validate that scores are unique\n    const noNull = submissionHasNoNull(updatedSubmission);\n    if (noDuplicates && noNull && isSubmissionValid(updatedSubmission)) {\n      handleSave(updatedSubmission);\n\n      setIsValid(true);\n    } else if (noDuplicates && noNull) {\n      showWarningMessage(\n        `Vote rankings invalid. Please input scores between ${minScore} - ${maxScore}.`\n      );\n      setIsValid(false);\n    } else if (!noDuplicates && noNull) {\n      showWarningMessage('Vote scores are not unique. Please input unique rankings.');\n      setIsValid(false);\n    } else {\n      setIsValid(false);\n    }\n  };\n\n  return (\n    <SideContentContestVoting\n      isValid={isValid}\n      canSave={canSave}\n      handleContestEntryClick={handleContestEntryClick}\n      handleVotingSubmissionChange={handleVotingSubmissionChange}\n      contestEntries={votingSubmission}\n      minScore={minScore}\n      maxScore={maxScore}\n    />\n  );\n};\n\nexport default SideContentContestVotingContainer;\n","import { Button, Classes } from '@blueprintjs/core';\nimport classNames from 'classnames';\nimport * as React from 'react';\n\nclass SideContentToneMatrix extends React.Component<{}, {}> {\n  private $container: HTMLElement | null = null;\n\n  public shouldComponentUpdate() {\n    return false;\n  }\n\n  public componentDidMount() {\n    if ((window as any).ToneMatrix) {\n      (window as any).ToneMatrix.initialise_matrix(this.$container!);\n    }\n  }\n\n  public handleClear() {\n    (window as any).ToneMatrix.clear_matrix();\n  }\n\n  public handleRandomise() {\n    (window as any).ToneMatrix.randomise_matrix();\n  }\n\n  public render() {\n    return (\n      <div className=\"sa-tone-matrix\">\n        <div className=\"row\">\n          <div className={classNames('controls', 'col-xs-12', Classes.DARK, Classes.BUTTON_GROUP)}>\n            <Button id=\"clear-matrix\" onClick={this.handleClear}>\n              Clear\n            </Button>\n            <Button id=\"randomise-matrix\" onClick={this.handleRandomise}>\n              Randomise\n            </Button>\n          </div>\n        </div>\n        <div className=\"row\">\n          <div className=\"col-xs-12\" ref={r => (this.$container = r)} />\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default SideContentToneMatrix;\n","import moment from 'moment';\n\n/**\n * Checks if a date is before or at the current time.\n *\n * @param {string} d an ISO 8601 compliant date string\n *   e.g 2018-07-06T10:20:09.961Z\n * @returns {boolean} true if the date specified by the paramter\n *   is before the time of execution of this function.\n */\nexport const beforeNow = (dateString: string): boolean => {\n  const date = moment(dateString);\n  const now = moment();\n  return date.isBefore(now);\n};\n\n/**\n * Return a string representation of a date that is\n * nice to look at. To be used for displaying the date,\n * e.g when showing the assessment overview.\n *\n * @param {string} d an ISO 8601 compliant date string\n *   e.g 2018-07-06T10:20:09.961Z\n * @returns {string} A user-friendly readable date string,\n *   e.g 7th June, 20:09\n */\nexport const getPrettyDate = (dateString: string): string => {\n  const date = moment(dateString);\n  const prettyDate = date.format('Do MMMM, HH:mm');\n  return prettyDate;\n};\n\nexport const getStandardDateTime = (dateString: string): string => {\n  const date = moment(dateString);\n  const prettyDate = date.format('MMMM Do YYYY, HH:mm');\n  return prettyDate;\n};\n\nexport const getStandardDate = (dateString: string): string => {\n  const date = moment(dateString);\n  const prettyDate = date.format('MMMM Do YYYY');\n  return prettyDate;\n};\n","import { Divider, HTMLTable, Text } from '@blueprintjs/core';\nimport React from 'react';\n\nimport Markdown from '../Markdown';\nimport { getPrettyDate } from '../utils/DateHelper';\n\ntype AssessmentWorkspaceGradingResultProps = StateProps;\n\ntype StateProps = {\n  graderName: string;\n  gradedAt: string;\n  xp: number;\n  maxXp: number;\n  comments?: string;\n};\n\nconst AssessmentWorkspaceGradingResult: React.FC<AssessmentWorkspaceGradingResultProps> = props => (\n  <div className=\"GradingResult\">\n    <div className=\"grading-result-table\">\n      <HTMLTable>\n        <tbody>\n          <tr>\n            <th>XP:</th>\n            <td>\n              <Text>\n                {props.xp} / {props.maxXp}\n              </Text>\n            </td>\n          </tr>\n\n          <tr>\n            <th>Comments:</th>\n            <td>{!props.comments && <Text>None</Text>}</td>\n          </tr>\n        </tbody>\n      </HTMLTable>\n\n      {props.comments && (\n        <HTMLTable>\n          <tbody>\n            <tr>\n              <td>\n                <Divider />\n                <Markdown\n                  content={props.comments}\n                  simplifiedAutoLink={true}\n                  strikethrough={true}\n                  tasklists={true}\n                  openLinksInNewWindow={true}\n                />\n                <Divider />\n              </td>\n            </tr>\n          </tbody>\n        </HTMLTable>\n      )}\n\n      <br />\n\n      <div className=\"grading-result-info\">\n        <Text>\n          Graded by <b>{props.graderName}</b> on {getPrettyDate(props.gradedAt)}\n        </Text>\n      </div>\n    </div>\n  </div>\n);\n\nexport default AssessmentWorkspaceGradingResult;\n","import {\n  Button,\n  ButtonGroup,\n  Card,\n  Classes,\n  Dialog,\n  Intent,\n  NonIdealState,\n  Spinner,\n  SpinnerSize\n} from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport { stringify } from 'c-slang/dist/utils/stringify';\nimport classNames from 'classnames';\nimport { isEqual } from 'lodash';\nimport * as React from 'react';\nimport { useDispatch } from 'react-redux';\n\nimport { initSession, log } from '../../features/eventLogging';\nimport {\n  CodeDelta,\n  Input,\n  KeyboardCommand,\n  SelectionRange\n} from '../../features/sourceRecorder/SourceRecorderTypes';\nimport { fetchAssessment } from '../application/actions/SessionActions';\nimport { defaultWorkspaceManager, InterpreterOutput } from '../application/ApplicationTypes';\nimport {\n  Assessment,\n  AssessmentConfiguration,\n  AutogradingResult,\n  ContestEntry,\n  IContestVotingQuestion,\n  IMCQQuestion,\n  IProgrammingQuestion,\n  Question,\n  QuestionTypes,\n  Testcase\n} from '../assessment/AssessmentTypes';\nimport { ControlBarProps } from '../controlBar/ControlBar';\nimport { ControlBarChapterSelect } from '../controlBar/ControlBarChapterSelect';\nimport { ControlBarClearButton } from '../controlBar/ControlBarClearButton';\nimport { ControlBarEvalButton } from '../controlBar/ControlBarEvalButton';\nimport { ControlBarNextButton } from '../controlBar/ControlBarNextButton';\nimport { ControlBarPreviousButton } from '../controlBar/ControlBarPreviousButton';\nimport { ControlBarQuestionViewButton } from '../controlBar/ControlBarQuestionViewButton';\nimport { ControlBarResetButton } from '../controlBar/ControlBarResetButton';\nimport { ControlBarRunButton } from '../controlBar/ControlBarRunButton';\nimport { ControlButtonSaveButton } from '../controlBar/ControlBarSaveButton';\nimport ControlButton from '../ControlButton';\nimport {\n  convertEditorTabStateToProps,\n  NormalEditorContainerProps\n} from '../editor/EditorContainer';\nimport { Position } from '../editor/EditorTypes';\nimport Markdown from '../Markdown';\nimport { MobileSideContentProps } from '../mobileWorkspace/mobileSideContent/MobileSideContent';\nimport MobileWorkspace, { MobileWorkspaceProps } from '../mobileWorkspace/MobileWorkspace';\nimport { SideContentProps } from '../sideContent/SideContent';\nimport SideContentAutograder from '../sideContent/SideContentAutograder';\nimport SideContentContestLeaderboard from '../sideContent/SideContentContestLeaderboard';\nimport SideContentContestVotingContainer from '../sideContent/SideContentContestVotingContainer';\nimport SideContentToneMatrix from '../sideContent/SideContentToneMatrix';\nimport { SideContentTab, SideContentType } from '../sideContent/SideContentTypes';\nimport Constants from '../utils/Constants';\nimport { history } from '../utils/HistoryHelper';\nimport { useResponsive } from '../utils/Hooks';\nimport { showWarningMessage } from '../utils/NotificationsHelper';\nimport { assessmentTypeLink } from '../utils/ParamParseHelper';\nimport Workspace, { WorkspaceProps } from '../workspace/Workspace';\nimport {\n  beginClearContext,\n  browseReplHistoryDown,\n  browseReplHistoryUp,\n  changeExecTime,\n  changeSideContentHeight,\n  clearReplOutput,\n  evalEditor,\n  evalTestcase,\n  navigateToDeclaration,\n  promptAutocomplete,\n  resetWorkspace,\n  runAllTestcases,\n  updateCurrentAssessmentId,\n  updateReplValue\n} from '../workspace/WorkspaceActions';\nimport { EditorTabState, WorkspaceLocation } from '../workspace/WorkspaceTypes';\nimport AssessmentWorkspaceGradingResult from './AssessmentWorkspaceGradingResult';\nexport type AssessmentWorkspaceProps = DispatchProps & StateProps & OwnProps;\n\nexport type DispatchProps = {\n  handleEditorValueChange: (val: string) => void;\n  handleEditorUpdateBreakpoints: (breakpoints: string[]) => void;\n  handleReplEval: () => void;\n  handleSave: (id: number, answer: number | string | ContestEntry[]) => void;\n  handleUpdateHasUnsavedChanges: (hasUnsavedChanges: boolean) => void;\n};\n\nexport type OwnProps = {\n  assessmentId: number;\n  questionId: number;\n  notAttempted: boolean;\n  canSave: boolean;\n  assessmentConfiguration: AssessmentConfiguration;\n};\n\nexport type StateProps = {\n  assessment?: Assessment;\n  autogradingResults: AutogradingResult[];\n  activeEditorTabIndex: number | null;\n  editorTabs: EditorTabState[];\n  editorTestcases: Testcase[];\n  hasUnsavedChanges: boolean;\n  isRunning: boolean;\n  isDebugging: boolean;\n  enableDebugging: boolean;\n  output: InterpreterOutput[];\n  replValue: string;\n  sideContentHeight?: number;\n  storedAssessmentId?: number;\n  storedQuestionId?: number;\n  courseId?: number;\n};\n\nconst workspaceLocation: WorkspaceLocation = 'assessment';\n\nconst AssessmentWorkspace: React.FC<AssessmentWorkspaceProps> = props => {\n  const [showOverlay, setShowOverlay] = React.useState(false);\n  const [showResetTemplateOverlay, setShowResetTemplateOverlay] = React.useState(false);\n  const [sessionId, setSessionId] = React.useState('');\n  const [selectedTab, setSelectedTab] = React.useState(\n    props.assessment?.questions[props.questionId].grader !== undefined\n      ? SideContentType.grading\n      : SideContentType.questionOverview\n  );\n  const { isMobileBreakpoint } = useResponsive();\n\n  const dispatch = useDispatch();\n\n  React.useEffect(() => {\n    props.handleEditorValueChange('');\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  /**\n   * After mounting (either an older copy of the assessment\n   * or a loading screen), try to fetch a newer assessment,\n   * and show the briefing.\n   */\n  React.useEffect(() => {\n    dispatch(fetchAssessment(props.assessmentId));\n\n    if (props.questionId === 0 && props.notAttempted) {\n      setShowOverlay(true);\n    }\n    if (!props.assessment) {\n      return;\n    }\n    // ------------- PLEASE NOTE, EVERYTHING BELOW THIS SEEMS TO BE UNUSED -------------\n    // checkWorkspaceReset does exactly the same thing.\n    let questionId = props.questionId;\n    if (props.questionId >= props.assessment.questions.length) {\n      questionId = props.assessment.questions.length - 1;\n    }\n\n    const question: Question = props.assessment.questions[questionId];\n\n    let answer = '';\n    if (question.type === QuestionTypes.programming) {\n      if (question.answer) {\n        answer = (question as IProgrammingQuestion).answer as string;\n      } else {\n        answer = (question as IProgrammingQuestion).solutionTemplate;\n      }\n    }\n\n    props.handleEditorValueChange(answer);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  /**\n   * Once there is an update (due to the assessment being fetched), check\n   * if a workspace reset is needed.\n   */\n  React.useEffect(() => {\n    checkWorkspaceReset();\n  });\n\n  /**\n   * Handles toggling of relevant SideContentTabs when mobile breakpoint it hit\n   */\n  React.useEffect(() => {\n    if (\n      !isMobileBreakpoint &&\n      (selectedTab === SideContentType.mobileEditor ||\n        selectedTab === SideContentType.mobileEditorRun)\n    ) {\n      setSelectedTab(SideContentType.questionOverview);\n    }\n  }, [isMobileBreakpoint, props, selectedTab]);\n\n  /* ==================\n     onChange handlers\n     ================== */\n  const pushLog = (newInput: Input) => {\n    log(sessionId, newInput);\n  };\n\n  const onChangeMethod = (newCode: string, delta: CodeDelta) => {\n    if (props.handleUpdateHasUnsavedChanges) {\n      props.handleUpdateHasUnsavedChanges(true);\n    }\n\n    props.handleEditorValueChange(newCode);\n\n    const input: Input = {\n      time: Date.now(),\n      type: 'codeDelta',\n      data: delta\n    };\n\n    pushLog(input);\n  };\n\n  const onCursorChangeMethod = (selection: any) => {\n    const input: Input = {\n      time: Date.now(),\n      type: 'cursorPositionChange',\n      data: selection.getCursor()\n    };\n\n    pushLog(input);\n  };\n\n  const onSelectionChangeMethod = (selection: any) => {\n    const range: SelectionRange = selection.getRange();\n    const isBackwards: boolean = selection.isBackwards();\n    if (!isEqual(range.start, range.end)) {\n      const input: Input = {\n        time: Date.now(),\n        type: 'selectionRangeData',\n        data: { range, isBackwards }\n      };\n\n      pushLog(input);\n    }\n  };\n\n  /**\n   * handleEval used in both the Run button, and during 'shift-enter' in AceEditor\n   *\n   * However, AceEditor only binds commands on mount (https://github.com/securingsincity/react-ace/issues/684)\n   * Thus, we use a mutable ref to overcome the stale closure problem\n   */\n  const activeTab = React.useRef(selectedTab);\n  activeTab.current = selectedTab;\n  const handleEval = () => {\n    // Run testcases when the autograder tab is selected\n    if (activeTab.current === SideContentType.autograder) {\n      dispatch(runAllTestcases(workspaceLocation));\n    } else {\n      dispatch(evalEditor(workspaceLocation));\n    }\n\n    const input: Input = {\n      time: Date.now(),\n      type: 'keyboardCommand',\n      data: KeyboardCommand.run\n    };\n\n    pushLog(input);\n  };\n\n  /* ================\n     Helper Functions\n     ================ */\n  /**\n   * Checks if there is a need to reset the workspace, then executes\n   * a dispatch (in the props) if needed.\n   */\n  const checkWorkspaceReset = () => {\n    /* Don't reset workspace if assessment not fetched yet. */\n    if (props.assessment === undefined) {\n      return;\n    }\n\n    /* Reset assessment if it has changed.*/\n    const assessmentId = props.assessmentId;\n    const questionId = props.questionId;\n\n    if (props.storedAssessmentId === assessmentId && props.storedQuestionId === questionId) {\n      return;\n    }\n\n    const question = props.assessment.questions[questionId];\n\n    let autogradingResults: AutogradingResult[] = [];\n    let editorValue: string = '';\n    let editorPrepend: string = '';\n    let editorPostpend: string = '';\n    let editorTestcases: Testcase[] = [];\n\n    if (question.type === QuestionTypes.programming) {\n      const questionData = question as IProgrammingQuestion;\n      autogradingResults = questionData.autogradingResults;\n      editorPrepend = questionData.prepend;\n      editorPostpend = questionData.postpend;\n      editorTestcases = questionData.testcases;\n\n      editorValue = questionData.answer as string;\n      if (!editorValue) {\n        editorValue = questionData.solutionTemplate!;\n      }\n\n      // Initialize session once the editorValue is known.\n      if (!sessionId) {\n        setSessionId(\n          initSession(`${(props.assessment as any).number}/${props.questionId}`, {\n            chapter: Chapter.CALC,\n            externalLibrary: question?.library?.external?.name || 'NONE',\n            editorValue\n          })\n        );\n      }\n    }\n\n    if (question.type === QuestionTypes.voting) {\n      const questionData = question as IContestVotingQuestion;\n      editorPrepend = questionData.prepend;\n      editorPostpend = questionData.postpend;\n    }\n\n    props.handleEditorUpdateBreakpoints([]);\n    dispatch(updateCurrentAssessmentId(assessmentId, questionId));\n    dispatch(\n      resetWorkspace(workspaceLocation, {\n        autogradingResults,\n        // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n        editorTabs: [\n          {\n            value: editorValue,\n            prependValue: editorPrepend,\n            postpendValue: editorPostpend,\n            highlightedLines: [],\n            breakpoints: []\n          }\n        ],\n        editorTestcases\n      })\n    );\n    dispatch(\n      changeExecTime(\n        question.library.execTimeMs ?? defaultWorkspaceManager.assessment.execTime,\n        workspaceLocation\n      )\n    );\n    dispatch(beginClearContext(workspaceLocation, question.library, true));\n    props.handleUpdateHasUnsavedChanges(false);\n    if (editorValue) {\n      props.handleEditorValueChange(editorValue);\n    }\n  };\n\n  /**\n   * sideContentProps() will only be called when props.assessment is not undefined\n   * (see 'Rendering Logic' below), thus it is okay to use props.assessment!\n   */\n  const sideContentProps: (p: AssessmentWorkspaceProps, q: number) => SideContentProps = (\n    props: AssessmentWorkspaceProps,\n    questionId: number\n  ) => {\n    const isGraded = props.assessment!.questions[questionId].grader !== undefined;\n    const isContestVoting = props.assessment!.questions[questionId]?.type === 'voting';\n    const handleContestEntryClick = (_submissionId: number, answer: string) => {\n      props.handleEditorValueChange(answer);\n    };\n\n    const tabs: SideContentTab[] = isContestVoting\n      ? [\n          {\n            label: `Question ${questionId + 1}`,\n            iconName: IconNames.NINJA,\n            body: <Markdown content={props.assessment!.questions[questionId].content} />,\n            id: SideContentType.questionOverview\n          },\n          {\n            label: `Contest Voting Briefing`,\n            iconName: IconNames.BRIEFCASE,\n            body: <Markdown content={props.assessment!.longSummary} />,\n            id: SideContentType.briefing\n          },\n          {\n            label: 'Contest Voting',\n            iconName: IconNames.NEW_LAYERS,\n            body: (\n              <SideContentContestVotingContainer\n                canSave={props.canSave}\n                handleSave={votingSubmission =>\n                  props.handleSave(\n                    (props.assessment?.questions[questionId] as IContestVotingQuestion).id,\n                    votingSubmission\n                  )\n                }\n                handleContestEntryClick={handleContestEntryClick}\n                contestEntries={\n                  (props.assessment?.questions[questionId] as IContestVotingQuestion)\n                    ?.contestEntries ?? []\n                }\n              />\n            ),\n            id: SideContentType.contestVoting\n          },\n          {\n            label: 'Contest Leaderboard',\n            iconName: IconNames.CROWN,\n            body: (\n              <SideContentContestLeaderboard\n                handleContestEntryClick={handleContestEntryClick}\n                orderedContestEntries={\n                  (props.assessment?.questions[questionId] as IContestVotingQuestion)\n                    ?.contestLeaderboard ?? []\n                }\n              />\n            ),\n            id: SideContentType.contestLeaderboard\n          }\n        ]\n      : [\n          {\n            label: `Question ${questionId + 1}`,\n            iconName: IconNames.NINJA,\n            body: (\n              <Markdown\n                className=\"sidecontent-overview\"\n                content={props.assessment!.questions[questionId].content}\n              />\n            ),\n            id: SideContentType.questionOverview\n          },\n          {\n            label: `Briefing`,\n            iconName: IconNames.BRIEFCASE,\n            body: (\n              <Markdown className=\"sidecontent-overview\" content={props.assessment!.longSummary} />\n            ),\n            id: SideContentType.briefing\n          },\n          {\n            label: `Autograder`,\n            iconName: IconNames.AIRPLANE,\n            body: (\n              <SideContentAutograder\n                testcases={props.editorTestcases}\n                autogradingResults={\n                  // Display autograding results if assessment has been graded by an avenger, OR does not need to be manually graded\n                  isGraded || !props.assessmentConfiguration.isManuallyGraded\n                    ? props.autogradingResults\n                    : []\n                }\n                handleTestcaseEval={id => dispatch(evalTestcase(workspaceLocation, id))}\n                workspaceLocation=\"assessment\"\n              />\n            ),\n            id: SideContentType.autograder\n          }\n        ];\n\n    if (isGraded) {\n      tabs.push({\n        label: `Report Card`,\n        iconName: IconNames.TICK,\n        body: (\n          <AssessmentWorkspaceGradingResult\n            graderName={props.assessment!.questions[questionId].grader!.name}\n            gradedAt={props.assessment!.questions[questionId].gradedAt!}\n            xp={props.assessment!.questions[questionId].xp}\n            maxXp={props.assessment!.questions[questionId].maxXp}\n            comments={props.assessment!.questions[questionId].comments}\n          />\n        ),\n        id: SideContentType.grading\n      });\n    }\n\n    const externalLibrary = props.assessment!.questions[questionId].library.external;\n    const functionsAttached = externalLibrary.symbols;\n    if (functionsAttached.includes('get_matrix')) {\n      tabs.push({\n        label: `Tone Matrix`,\n        iconName: IconNames.GRID_VIEW,\n        body: <SideContentToneMatrix />,\n        id: SideContentType.toneMatrix\n      });\n    }\n\n    const onChangeTabs = (\n      newTabId: SideContentType,\n      prevTabId: SideContentType,\n      event: React.MouseEvent<HTMLElement>\n    ) => {\n      if (newTabId === prevTabId) {\n        return;\n      }\n      setSelectedTab(newTabId);\n    };\n\n    return {\n      selectedTabId: selectedTab,\n      tabs: {\n        beforeDynamicTabs: tabs,\n        afterDynamicTabs: []\n      },\n      onChange: onChangeTabs,\n      workspaceLocation: 'assessment'\n    };\n  };\n\n  /**\n   * controlBarProps() will only be called when props.assessment is not undefined\n   * (see 'Rendering Logic' below), thus it is okay to use props.assessment!\n   */\n  const controlBarProps: (q: number) => ControlBarProps = (questionId: number) => {\n    const listingPath = `/courses/${props.courseId}/${assessmentTypeLink(props.assessment!.type)}`;\n    const assessmentWorkspacePath = listingPath + `/${props.assessment!.id.toString()}`;\n    const questionProgress: [number, number] = [questionId + 1, props.assessment!.questions.length];\n\n    const onClickPrevious = () => {\n      history.push(assessmentWorkspacePath + `/${(questionId - 1).toString()}`);\n      setSelectedTab(SideContentType.questionOverview);\n    };\n    const onClickNext = () => {\n      history.push(assessmentWorkspacePath + `/${(questionId + 1).toString()}`);\n      setSelectedTab(SideContentType.questionOverview);\n    };\n    const onClickReturn = () => history.push(listingPath);\n\n    /**\n     * Returns a nullary function that defers the navigation of the browser window, until the\n     * student's answer passes some checks - presently only used for assessments types with blocking = true\n     * (previously used for the 'Path' assessment type in SA Knight)\n     */\n    const onClickProgress = (deferredNavigate: () => void) => {\n      return () => {\n        // Perform question blocking - determine the highest question number previously accessed\n        // by counting the number of questions that have a non-null answer\n        const blockedQuestionId =\n          props.assessment!.questions.filter(qn => qn.answer !== null).length - 1;\n\n        // If the current question does not block the next question, proceed as usual\n        if (questionId < blockedQuestionId) {\n          return deferredNavigate();\n        }\n        // Else evaluate its correctness - proceed iff the answer to the current question is correct\n        const question: Question = props.assessment!.questions[questionId];\n        if (question.type === QuestionTypes.mcq) {\n          // Note that 0 is a falsy value!\n          if (question.answer === null) {\n            return showWarningMessage('Please select an option!', 750);\n          }\n          // If the question is 'blocking', but there is no MCQ solution provided (i.e. assessment uploader's\n          // mistake), allow the student to proceed after selecting an option\n          if ((question as IMCQQuestion).solution === undefined) {\n            return deferredNavigate();\n          }\n          if (question.answer !== (question as IMCQQuestion).solution) {\n            return showWarningMessage('Your MCQ solution is incorrect!', 750);\n          }\n        } else if (question.type === QuestionTypes.programming) {\n          const isCorrect = props.editorTestcases.reduce((acc, testcase) => {\n            return acc && stringify(testcase.result) === testcase.answer;\n          }, true);\n          if (!isCorrect) {\n            return showWarningMessage('Your solution has not passed all testcases!', 750);\n          }\n        }\n        return deferredNavigate();\n      };\n    };\n\n    // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n    const onClickSave = () =>\n      props.handleSave(props.assessment!.questions[questionId].id, props.editorTabs[0].value);\n\n    const onClickResetTemplate = () => {\n      setShowResetTemplateOverlay(true);\n    };\n\n    const nextButton = (\n      <ControlBarNextButton\n        onClickNext={\n          props.assessment!.questions[questionId].blocking\n            ? onClickProgress(onClickNext)\n            : onClickNext\n        }\n        onClickReturn={\n          props.assessment!.questions[questionId].blocking\n            ? onClickProgress(onClickReturn)\n            : onClickReturn\n        }\n        questionProgress={questionProgress}\n        key=\"next_question\"\n      />\n    );\n\n    const previousButton = (\n      <ControlBarPreviousButton\n        onClick={onClickPrevious}\n        questionProgress={questionProgress}\n        key=\"previous_question\"\n      />\n    );\n\n    const questionView = (\n      <ControlBarQuestionViewButton questionProgress={questionProgress} key=\"question_view\" />\n    );\n\n    const resetButton =\n      props.assessment!.questions[questionId].type !== QuestionTypes.mcq ? (\n        <ControlBarResetButton onClick={onClickResetTemplate} key=\"reset_template\" />\n      ) : null;\n\n    const runButton = <ControlBarRunButton handleEditorEval={handleEval} key=\"run\" />;\n\n    const saveButton =\n      props.canSave &&\n      props.assessment!.questions[questionId].type === QuestionTypes.programming ? (\n        <ControlButtonSaveButton\n          hasUnsavedChanges={props.hasUnsavedChanges}\n          onClickSave={onClickSave}\n          key=\"save\"\n        />\n      ) : null;\n\n    const handleChapterSelect = () => {};\n\n    const chapterSelect = (\n      <ControlBarChapterSelect\n        handleChapterSelect={handleChapterSelect}\n        sourceChapter={Chapter.CALC}\n        sourceVariant={\n          props.assessment!.questions[questionId].library.variant ?? Constants.defaultSourceVariant\n        }\n        disabled={true}\n        key=\"chapter\"\n      />\n    );\n\n    return {\n      editorButtons: !isMobileBreakpoint\n        ? [runButton, saveButton, resetButton, chapterSelect]\n        : [saveButton, resetButton],\n      flowButtons: [previousButton, questionView, nextButton]\n    };\n  };\n\n  const mobileSideContentProps: (q: number) => MobileSideContentProps = (questionId: number) => {\n    const onChangeTabs = (\n      newTabId: SideContentType,\n      prevTabId: SideContentType,\n      event: React.MouseEvent<HTMLElement>\n    ) => {\n      if (newTabId === prevTabId) {\n        return;\n      }\n\n      // Do nothing when clicking the mobile 'Run' tab while on the autograder tab.\n      if (\n        !(prevTabId === SideContentType.autograder && newTabId === SideContentType.mobileEditorRun)\n      ) {\n        setSelectedTab(newTabId);\n      }\n    };\n\n    return {\n      mobileControlBarProps: {\n        ...controlBarProps(questionId)\n      },\n      ...sideContentProps(props, questionId),\n      onChange: onChangeTabs,\n      selectedTabId: selectedTab,\n      handleEditorEval: handleEval\n    };\n  };\n\n  const replButtons = () => {\n    const clearButton = (\n      <ControlBarClearButton\n        handleReplOutputClear={() => dispatch(clearReplOutput(workspaceLocation))}\n        key=\"clear_repl\"\n      />\n    );\n\n    const evalButton = (\n      <ControlBarEvalButton\n        handleReplEval={props.handleReplEval}\n        isRunning={props.isRunning}\n        key=\"eval_repl\"\n      />\n    );\n\n    return [evalButton, clearButton];\n  };\n\n  /* ===============\n     Rendering Logic\n     =============== */\n  if (props.assessment === undefined || props.assessment.questions.length === 0) {\n    return (\n      <NonIdealState\n        className={classNames('WorkspaceParent', Classes.DARK)}\n        description=\"Getting mission ready...\"\n        icon={<Spinner size={SpinnerSize.LARGE} />}\n      />\n    );\n  }\n\n  const overlay = (\n    <Dialog className=\"assessment-briefing\" isOpen={showOverlay}>\n      <Card>\n        <Markdown content={props.assessment.longSummary} />\n        <Button\n          className=\"assessment-briefing-button\"\n          onClick={() => setShowOverlay(false)}\n          text=\"Continue\"\n        />\n      </Card>\n    </Dialog>\n  );\n\n  const closeOverlay = () => setShowResetTemplateOverlay(false);\n  const resetTemplateOverlay = (\n    <Dialog\n      className=\"assessment-reset\"\n      icon={IconNames.ERROR}\n      isCloseButtonShown={true}\n      isOpen={showResetTemplateOverlay}\n      onClose={closeOverlay}\n      title=\"Confirmation: Reset editor?\"\n    >\n      <div className={Classes.DIALOG_BODY}>\n        <Markdown content=\"Are you sure you want to reset the template?\" />\n        <Markdown content=\"*Note this will not affect the saved copy of your program, unless you save over it.*\" />\n      </div>\n      <div className={Classes.DIALOG_FOOTER}>\n        <ButtonGroup>\n          <ControlButton label=\"Cancel\" onClick={closeOverlay} options={{ minimal: false }} />\n          <ControlButton\n            label=\"Confirm\"\n            onClick={() => {\n              closeOverlay();\n              props.handleEditorValueChange(\n                (props.assessment!.questions[questionId] as IProgrammingQuestion).solutionTemplate\n              );\n              props.handleUpdateHasUnsavedChanges(true);\n            }}\n            options={{ minimal: false, intent: Intent.DANGER }}\n          />\n        </ButtonGroup>\n      </div>\n    </Dialog>\n  );\n\n  /* If questionId is out of bounds, set it to the max. */\n  const questionId =\n    props.questionId >= props.assessment.questions.length\n      ? props.assessment.questions.length - 1\n      : props.questionId;\n  const question: Question = props.assessment.questions[questionId];\n  const editorContainerProps: NormalEditorContainerProps | undefined =\n    question.type === QuestionTypes.programming || question.type === QuestionTypes.voting\n      ? {\n          editorVariant: 'normal',\n          editorTabs: props.editorTabs.map(convertEditorTabStateToProps),\n          editorSessionId: '',\n          sourceChapter: Chapter.CALC,\n          sourceVariant: question.library.variant ?? Variant.DEFAULT,\n          externalLibraryName: question.library.external.name || 'NONE',\n          handleDeclarationNavigate: (cursorPosition: Position) =>\n            dispatch(navigateToDeclaration(workspaceLocation, cursorPosition)),\n          handleEditorEval: handleEval,\n          handleEditorCheck: () => {},\n          handleEditorValueChange: props.handleEditorValueChange,\n          handleUpdateHasUnsavedChanges: props.handleUpdateHasUnsavedChanges,\n          handleEditorUpdateBreakpoints: props.handleEditorUpdateBreakpoints,\n          handlePromptAutocomplete: (row: number, col: number, callback: any) =>\n            dispatch(promptAutocomplete(workspaceLocation, row, col, callback)),\n          isEditorAutorun: false,\n          onChange: onChangeMethod,\n          onCursorChange: onCursorChangeMethod,\n          onSelectionChange: onSelectionChangeMethod\n        }\n      : undefined;\n  const mcqProps = {\n    mcq: question as IMCQQuestion,\n    handleMCQSubmit: (option: number) =>\n      props.handleSave(props.assessment!.questions[questionId].id, option)\n  };\n  const replProps = {\n    handleBrowseHistoryDown: () => dispatch(browseReplHistoryDown(workspaceLocation)),\n    handleBrowseHistoryUp: () => dispatch(browseReplHistoryUp(workspaceLocation)),\n    handleReplEval: props.handleReplEval,\n    handleReplValueChange: (newValue: string) =>\n      dispatch(updateReplValue(newValue, workspaceLocation)),\n    output: props.output,\n    replValue: props.replValue,\n    sourceChapter: Chapter.CALC,\n    sourceVariant: question.library.variant ?? Variant.DEFAULT,\n    externalLibrary: question?.library?.external?.name || 'NONE',\n    replButtons: replButtons()\n  };\n  const sideBarProps = {\n    tabs: []\n  };\n  const workspaceProps: WorkspaceProps = {\n    controlBarProps: controlBarProps(questionId),\n    editorContainerProps: editorContainerProps,\n    handleSideContentHeightChange: (heightChange: number) =>\n      dispatch(changeSideContentHeight(heightChange, workspaceLocation)),\n    hasUnsavedChanges: props.hasUnsavedChanges,\n    mcqProps: mcqProps,\n    sideBarProps: sideBarProps,\n    sideContentHeight: props.sideContentHeight,\n    sideContentProps: sideContentProps(props, questionId),\n    replProps: replProps\n  };\n  const mobileWorkspaceProps: MobileWorkspaceProps = {\n    editorContainerProps: editorContainerProps,\n    hasUnsavedChanges: props.hasUnsavedChanges,\n    mcqProps: mcqProps,\n    replProps: replProps,\n    sideBarProps: sideBarProps,\n    mobileSideContentProps: mobileSideContentProps(questionId)\n  };\n\n  return (\n    <div className={classNames('WorkspaceParent', Classes.DARK)}>\n      {overlay}\n      {resetTemplateOverlay}\n      {!isMobileBreakpoint ? (\n        <Workspace {...workspaceProps} />\n      ) : (\n        <MobileWorkspace {...mobileWorkspaceProps} />\n      )}\n    </div>\n  );\n};\n\nexport default AssessmentWorkspace;\n","import { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport { submitAnswer } from '../application/actions/SessionActions';\nimport { OverallState } from '../application/ApplicationTypes';\nimport {\n  evalRepl,\n  setEditorBreakpoint,\n  updateEditorValue,\n  updateHasUnsavedChanges\n} from '../workspace/WorkspaceActions';\nimport { WorkspaceLocation } from '../workspace/WorkspaceTypes';\nimport AssessmentWorkspace, { DispatchProps, OwnProps, StateProps } from './AssessmentWorkspace';\n\nconst mapStateToProps: MapStateToProps<StateProps, OwnProps, OverallState> = (state, props) => {\n  return {\n    courseId: state.session.courseId,\n    assessment: state.session.assessments.get(props.assessmentId),\n    autogradingResults: state.workspaces.assessment.autogradingResults,\n    activeEditorTabIndex: state.workspaces.assessment.activeEditorTabIndex,\n    editorTabs: state.workspaces.assessment.editorTabs,\n    editorTestcases: state.workspaces.assessment.editorTestcases,\n    hasUnsavedChanges: state.workspaces.assessment.hasUnsavedChanges,\n    isRunning: state.workspaces.assessment.isRunning,\n    isDebugging: state.workspaces.assessment.isDebugging,\n    enableDebugging: state.workspaces.assessment.enableDebugging,\n    output: state.workspaces.assessment.output,\n    replValue: state.workspaces.assessment.replValue,\n    sideContentHeight: state.workspaces.assessment.sideContentHeight,\n    storedAssessmentId: state.workspaces.assessment.currentAssessment,\n    storedQuestionId: state.workspaces.assessment.currentQuestion\n  };\n};\n\nconst workspaceLocation: WorkspaceLocation = 'assessment';\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleEditorValueChange: (val: string) => updateEditorValue(val, workspaceLocation),\n      handleEditorUpdateBreakpoints: (breakpoints: string[]) =>\n        setEditorBreakpoint(breakpoints, workspaceLocation),\n      handleReplEval: () => evalRepl(workspaceLocation),\n      handleSave: submitAnswer,\n      handleUpdateHasUnsavedChanges: (hasUnsavedChanges: boolean) =>\n        updateHasUnsavedChanges(workspaceLocation, hasUnsavedChanges)\n    },\n    dispatch\n  );\n\nconst AssessmentWorkspaceContainer = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(AssessmentWorkspace);\n\nexport default AssessmentWorkspaceContainer;\n","import { AssessmentType } from '../assessment/AssessmentTypes';\nimport { Notification, NotificationFilterFunction } from './NotificationBadgeTypes';\n\n/**\n * @return A function that takes in an array of notification and filters it by assessment id.\n */\nexport function filterNotificationsByAssessment(assessmentId: number): NotificationFilterFunction {\n  return (notifications: Notification[]) =>\n    notifications.filter(n => !n.submission_id && n.assessment_id === assessmentId);\n}\n\n/**\n * @return A function that takes in an array of notification and filters it by submission id.\n */\nexport function filterNotificationsBySubmission(submissionId: number): NotificationFilterFunction {\n  return (notifications: Notification[]) =>\n    notifications.filter(n => n.submission_id === submissionId);\n}\n\n/**\n * Notifications will be filtered to one of the Assessment types of the currently selected\n * course, or the Grading type.\n *\n * Notifications with a submission id belongs to the Grading type.\n *\n * @return A function that takes in an array of notification and filters it by the type of notification.\n */\nexport function filterNotificationsByType(\n  assessmentType: AssessmentType\n): NotificationFilterFunction {\n  return (notifications: Notification[]) =>\n    notifications.filter(n => {\n      if (assessmentType === 'Grading') {\n        return n.submission_id !== undefined;\n      }\n      return !n.submission_id && assessmentType === n.assessment_type;\n    });\n}\n\n/**\n * @return A function that takes in an array of notification and filters it by notification id.\n */\nexport function filterNotificationsById(id: number): NotificationFilterFunction {\n  return (notifications: Notification[]) => notifications.filter(n => n.id === id);\n}\n","import { Intent, PopoverInteractionKind, Position, Tag } from '@blueprintjs/core';\nimport { Popover2 } from '@blueprintjs/popover2';\nimport * as React from 'react';\n\nimport { filterNotificationsById } from './NotificationBadgeHelper';\nimport {\n  Notification,\n  NotificationFilterFunction,\n  NotificationType,\n  NotificationTypes\n} from './NotificationBadgeTypes';\n\ntype NotificationBadgeProps = DispatchProps & StateProps & OwnProps;\n\nexport type DispatchProps = {\n  handleAcknowledgeNotifications: (withFilter?: NotificationFilterFunction) => void;\n};\n\ntype OwnProps = {\n  className?: string;\n  disableHover?: boolean; // Set to true to disable popover content\n  large?: boolean; // Set to true to use large style\n  notificationFilter?: (notifications: Notification[]) => Notification[];\n};\n\nexport type StateProps = {\n  notifications: Notification[];\n};\n\nconst NotificationBadge: React.SFC<NotificationBadgeProps> = props => {\n  const notifications = props.notificationFilter\n    ? props.notificationFilter(props.notifications)\n    : props.notifications;\n\n  if (!notifications.length) {\n    return null;\n  }\n\n  const notificationIcon = (\n    <Tag intent={Intent.DANGER} round={true} large={props.large}>\n      {notifications.length}\n    </Tag>\n  );\n\n  if (!props.disableHover) {\n    const makeNotificationTag = (notification: Notification) => {\n      const onRemove = () =>\n        props.handleAcknowledgeNotifications(filterNotificationsById(notification.id));\n\n      return (\n        <Tag\n          className=\"row badge-tag\"\n          key={`${notification.id}`}\n          minimal={true}\n          multiline={true}\n          onRemove={onRemove}\n        >\n          {makeNotificationMessage(notification.type)}\n        </Tag>\n      );\n    };\n\n    const notificationTags = <div className=\"col\">{notifications.map(makeNotificationTag)}</div>;\n\n    return (\n      <Popover2\n        className={props.className}\n        content={notificationTags}\n        interactionKind={PopoverInteractionKind.HOVER}\n        placement={Position.RIGHT}\n        hoverOpenDelay={50}\n        hoverCloseDelay={50}\n        lazy={true}\n      >\n        {notificationIcon}\n      </Popover2>\n    );\n  }\n\n  return notificationIcon;\n};\n\nconst makeNotificationMessage = (type: NotificationType) => {\n  switch (type) {\n    case NotificationTypes.new:\n      return 'This assessment is new.';\n    case NotificationTypes.deadline:\n      return 'This assessment is closing soon.';\n    case NotificationTypes.autograded:\n      return 'This assessment has been autograded.';\n    case NotificationTypes.submitted:\n      return 'This submission is new.';\n    case NotificationTypes.unsubmitted:\n      return 'This assessment has been unsubmitted.';\n    case NotificationTypes.graded:\n      return 'This assessment has been manually graded.';\n    case NotificationTypes.new_message:\n      return 'There are new messages.';\n    default:\n      return 'Unknown notification';\n  }\n};\n\nexport default NotificationBadge;\n","import { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport { acknowledgeNotifications } from '../application/actions/SessionActions';\nimport { OverallState } from '../application/ApplicationTypes';\nimport NotificationBadge, { DispatchProps, StateProps } from './NotificationBadge';\n\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => ({\n  notifications: state.session.notifications\n});\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleAcknowledgeNotifications: acknowledgeNotifications\n    },\n    dispatch\n  );\n\nconst NotificationBadgeContainer = connect(mapStateToProps, mapDispatchToProps)(NotificationBadge);\n\nexport default NotificationBadgeContainer;\n","import { Classes, NonIdealState } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport classNames from 'classnames';\n\nconst AssessmentNotFound: React.FC = () => (\n  <div className={classNames('NoPage', Classes.DARK)}>\n    <NonIdealState\n      icon={IconNames.ERROR}\n      title=\"Assessment Not Found\"\n      description=\"Please check the top right dropdown menu to see if you are in the right course.\"\n    />\n  </div>\n);\n\nexport default AssessmentNotFound;\n","import {\n  Button,\n  ButtonGroup,\n  Card,\n  Classes,\n  Collapse,\n  Dialog,\n  Elevation,\n  H4,\n  H6,\n  Icon,\n  IconName,\n  Intent,\n  NonIdealState,\n  Position,\n  Spinner,\n  Text\n} from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { sortBy } from 'lodash';\nimport * as React from 'react';\nimport { useParams } from 'react-router';\nimport { NavLink } from 'react-router-dom';\n\nimport defaultCoverImage from '../../assets/default_cover_image.jpg';\nimport { OwnProps as AssessmentWorkspaceOwnProps } from '../assessmentWorkspace/AssessmentWorkspace';\nimport AssessmentWorkspaceContainer from '../assessmentWorkspace/AssessmentWorkspaceContainer';\nimport ContentDisplay from '../ContentDisplay';\nimport ControlButton from '../ControlButton';\nimport Markdown from '../Markdown';\nimport NotificationBadge from '../notificationBadge/NotificationBadgeContainer';\nimport { filterNotificationsByAssessment } from '../notificationBadge/NotificationBadgeHelper';\nimport { NotificationFilterFunction } from '../notificationBadge/NotificationBadgeTypes';\nimport Constants from '../utils/Constants';\nimport { beforeNow, getPrettyDate } from '../utils/DateHelper';\nimport { useResponsive } from '../utils/Hooks';\nimport { assessmentTypeLink, stringParamToInt } from '../utils/ParamParseHelper';\nimport AssessmentNotFound from './AssessmentNotFound';\nimport {\n  AssessmentConfiguration,\n  AssessmentOverview,\n  AssessmentStatuses,\n  AssessmentWorkspaceParams,\n  GradingStatuses\n} from './AssessmentTypes';\n\nexport type AssessmentProps = DispatchProps & OwnProps & StateProps;\n\nexport type DispatchProps = {\n  handleAcknowledgeNotifications: (withFilter?: NotificationFilterFunction) => void;\n  handleAssessmentOverviewFetch: () => void;\n  handleSubmitAssessment: (id: number) => void;\n};\n\nexport type OwnProps = {\n  assessmentConfiguration: AssessmentConfiguration;\n};\n\nexport type StateProps = {\n  assessmentOverviews?: AssessmentOverview[];\n  isStudent: boolean;\n  courseId?: number;\n};\n\nconst Assessment: React.FC<AssessmentProps> = props => {\n  const params = useParams<AssessmentWorkspaceParams>();\n  const { isMobileBreakpoint } = useResponsive();\n  const [betchaAssessment, setBetchaAssessment] = React.useState<AssessmentOverview | null>(null);\n  const [showClosedAssessments, setShowClosedAssessments] = React.useState<boolean>(false);\n  const [showOpenedAssessments, setShowOpenedAssessments] = React.useState<boolean>(true);\n  const [showUpcomingAssessments, setShowUpcomingAssessments] = React.useState<boolean>(true);\n\n  const toggleClosedAssessments = () => setShowClosedAssessments(!showClosedAssessments);\n  const toggleOpenAssessments = () => setShowOpenedAssessments(!showOpenedAssessments);\n  const toggleUpcomingAssessments = () => setShowUpcomingAssessments(!showUpcomingAssessments);\n  const setBetchaAssessmentNull = () => setBetchaAssessment(null);\n  const submitAssessment = () => {\n    if (betchaAssessment) {\n      props.handleSubmitAssessment(betchaAssessment.id);\n      setBetchaAssessmentNull();\n    }\n  };\n\n  const sortAssessments = (assessments: AssessmentOverview[]) => sortBy(assessments, [a => -a.id]);\n\n  const makeSubmissionButton = (overview: AssessmentOverview, index: number) => (\n    <Button\n      disabled={overview.status !== AssessmentStatuses.attempted}\n      icon={IconNames.CONFIRM}\n      intent={overview.status === AssessmentStatuses.attempted ? Intent.DANGER : Intent.NONE}\n      minimal={true}\n      // intentional: each listing renders its own version of onClick\n      // tslint:disable-next-line:jsx-no-lambda\n      onClick={() => setBetchaAssessment(overview)}\n    >\n      <span className=\"custom-hidden-xxxs\">Finalize</span>\n      <span className=\"custom-hidden-xxs\"> Submission</span>\n    </Button>\n  );\n\n  const makeAssessmentInteractButton = (overview: AssessmentOverview) => {\n    let icon: IconName;\n    let label: string;\n    let optionalLabel: string = '';\n\n    switch (overview.status) {\n      case AssessmentStatuses.not_attempted:\n        icon = IconNames.PLAY;\n        label = 'Attempt';\n        break;\n      case AssessmentStatuses.attempting:\n        icon = IconNames.PLAY;\n        label = 'Continue';\n        optionalLabel = ' Attempt';\n        break;\n      case AssessmentStatuses.attempted:\n        icon = IconNames.EDIT;\n        label = 'Review';\n        optionalLabel = ' Attempt';\n        break;\n      case AssessmentStatuses.submitted:\n        icon = IconNames.EYE_OPEN;\n        label = 'Review';\n        optionalLabel = ' Submission';\n        break;\n      default:\n        // If we reach this case, backend data did not fit IAssessmentOverview\n        icon = IconNames.PLAY;\n        label = 'Review';\n        break;\n    }\n    return (\n      <NavLink\n        to={`/courses/${props.courseId}/${assessmentTypeLink(\n          overview.type\n        )}/${overview.id.toString()}/${Constants.defaultQuestionId}`}\n      >\n        <Button\n          icon={icon}\n          minimal={true}\n          onClick={() =>\n            props.handleAcknowledgeNotifications(filterNotificationsByAssessment(overview.id))\n          }\n        >\n          <span className=\"custom-hidden-xxxs\">{label}</span>\n          <span className=\"custom-hidden-xxs\">{optionalLabel}</span>\n        </Button>\n      </NavLink>\n    );\n  };\n\n  /**\n   * Create a series of cards to display IAssessmentOverviews.\n   * @param {AssessmentOverview} overview the assessment overview to display\n   * @param {number} index a unique number for this card (required for sequential rendering).\n   *   See {@link https://reactjs.org/docs/lists-and-keys.html#keys}\n   * @param renderAttemptButton will only render the attempt button if true, regardless\n   *   of attempt status.\n   * @param notifications the notifications to be passed in.\n   */\n  const makeOverviewCard = (\n    overview: AssessmentOverview,\n    index: number,\n    renderAttemptButton: boolean,\n    renderGradingStatus: boolean\n  ) => {\n    const showGrade =\n      overview.gradingStatus === 'graded' || !props.assessmentConfiguration.isManuallyGraded;\n    const ratio = isMobileBreakpoint ? 5 : 3;\n    return (\n      <div key={index}>\n        <Card className=\"row listing\" elevation={Elevation.ONE}>\n          <div className={`col-xs-${String(ratio)} listing-picture`}>\n            <NotificationBadge\n              className=\"badge\"\n              notificationFilter={filterNotificationsByAssessment(overview.id)}\n              large={true}\n            />\n            <img\n              alt=\"Assessment\"\n              className={`cover-image-${overview.status}`}\n              src={overview.coverImage ? overview.coverImage : defaultCoverImage}\n            />\n          </div>\n          <div className={`col-xs-${String(12 - ratio)} listing-text`}>\n            {makeOverviewCardTitle(overview, index, renderGradingStatus)}\n            <div className=\"listing-xp\">\n              <H6>\n                {showGrade ? `XP: ${overview.xp} / ${overview.maxXp}` : `Max XP: ${overview.maxXp}`}\n              </H6>\n            </div>\n            <div className=\"listing-description\">\n              <Markdown content={overview.shortSummary} />\n            </div>\n            <div className=\"listing-footer\">\n              <div>\n                <Text className=\"listing-due-date\">\n                  <Icon className=\"listing-due-icon\" iconSize={12} icon={IconNames.CALENDAR} />\n                  {`${beforeNow(overview.openAt) ? 'Opened' : 'Opens'}: ${getPrettyDate(\n                    overview.openAt\n                  )}`}\n                </Text>\n                {beforeNow(overview.openAt) && (\n                  <Text className=\"listing-due-date\">\n                    <Icon className=\"listing-due-icon\" iconSize={12} icon={IconNames.TIME} />\n                    {`Due: ${getPrettyDate(overview.closeAt)}`}\n                  </Text>\n                )}\n              </div>\n              <div className=\"listing-button\">\n                {renderAttemptButton ? makeAssessmentInteractButton(overview) : null}\n              </div>\n            </div>\n          </div>\n        </Card>\n      </div>\n    );\n  };\n\n  const makeOverviewCardTitle = (\n    overview: AssessmentOverview,\n    index: number,\n    renderGradingStatus: boolean\n  ) => (\n    <div className=\"listing-header\">\n      <Text ellipsize={true}>\n        <H4 className=\"listing-title\">\n          {overview.title}\n          {overview.private ? (\n            <Tooltip2\n              className=\"listing-title-tooltip\"\n              content=\"This assessment is password-protected.\"\n            >\n              <Icon icon=\"lock\" />\n            </Tooltip2>\n          ) : null}\n          {renderGradingStatus ? makeGradingStatus(overview.gradingStatus) : null}\n        </H4>\n      </Text>\n      <div className=\"listing-button\">{makeSubmissionButton(overview, index)}</div>\n    </div>\n  );\n\n  // Rendering Logic\n  const { assessmentOverviews: assessmentOverviewsUnfiltered, isStudent } = props;\n  const assessmentOverviews = React.useMemo(\n    () =>\n      assessmentOverviewsUnfiltered?.filter(ao => ao.type === props.assessmentConfiguration.type),\n    [assessmentOverviewsUnfiltered, props.assessmentConfiguration.type]\n  );\n  const assessmentId: number | null = stringParamToInt(params.assessmentId);\n  const questionId: number = stringParamToInt(params.questionId) || Constants.defaultQuestionId;\n\n  // If there is an assessment to render, create a workspace. The assessment\n  // overviews must still be loaded for this, to send the due date.\n  if (assessmentId !== null && assessmentOverviews !== undefined) {\n    const overview = assessmentOverviews.filter(a => a.id === assessmentId)[0];\n    if (!overview) {\n      return <AssessmentNotFound />;\n    }\n    const assessmentWorkspaceProps: AssessmentWorkspaceOwnProps = {\n      assessmentId,\n      questionId,\n      notAttempted: overview.status === AssessmentStatuses.not_attempted,\n      canSave:\n        !props.isStudent ||\n        (overview.status !== AssessmentStatuses.submitted && !beforeNow(overview.closeAt)),\n      assessmentConfiguration: props.assessmentConfiguration\n    };\n    return <AssessmentWorkspaceContainer {...assessmentWorkspaceProps} />;\n  }\n\n  // Otherwise, render a list of assOwnProps\n  let display: JSX.Element;\n  if (assessmentOverviews === undefined) {\n    display = <NonIdealState description=\"Fetching assessment...\" icon={<Spinner />} />;\n  } else if (assessmentOverviews.length === 0) {\n    display = <NonIdealState title=\"There are no assessments.\" icon={IconNames.FLAME} />;\n  } else {\n    /** Upcoming assessments, that are not released yet. */\n    const isOverviewUpcoming = (overview: AssessmentOverview) =>\n      !beforeNow(overview.closeAt) && !beforeNow(overview.openAt);\n\n    const upcomingCards = sortAssessments(assessmentOverviews.filter(isOverviewUpcoming)).map(\n      (overview, index) => makeOverviewCard(overview, index, !isStudent, false)\n    );\n\n    /** Opened assessments, that are released and can be attempted. */\n    const isOverviewOpened = (overview: AssessmentOverview) =>\n      !beforeNow(overview.closeAt) &&\n      beforeNow(overview.openAt) &&\n      overview.status !== AssessmentStatuses.submitted;\n    const openedCards = sortAssessments(\n      assessmentOverviews.filter(overview => isOverviewOpened(overview))\n    ).map((overview, index) => makeOverviewCard(overview, index, true, false));\n\n    /** Closed assessments, that are past the due date or cannot be attempted further. */\n    const closedCards = sortAssessments(\n      assessmentOverviews.filter(\n        overview => !isOverviewOpened(overview) && !isOverviewUpcoming(overview)\n      )\n    ).map((overview, index) => makeOverviewCard(overview, index, true, true));\n\n    /** Render cards */\n    const upcomingCardsCollapsible = (\n      <>\n        {collapseButton('Upcoming', showUpcomingAssessments, toggleUpcomingAssessments)}\n        <Collapse isOpen={showUpcomingAssessments}>{upcomingCards}</Collapse>\n      </>\n    );\n\n    const openedCardsCollapsible = (\n      <>\n        {collapseButton('Open', showOpenedAssessments, toggleOpenAssessments)}\n        <Collapse isOpen={showOpenedAssessments}>{openedCards}</Collapse>\n      </>\n    );\n\n    const closedCardsCollapsible = (\n      <>\n        {collapseButton('Closed', showClosedAssessments, toggleClosedAssessments)}\n        <Collapse isOpen={showClosedAssessments}>{closedCards}</Collapse>\n      </>\n    );\n\n    display = (\n      <>\n        {upcomingCards.length > 0 ? upcomingCardsCollapsible : null}\n        {openedCards.length > 0 ? openedCardsCollapsible : null}\n        {closedCards.length > 0 ? closedCardsCollapsible : null}\n      </>\n    );\n  }\n\n  // Define the betcha dialog (in each card's menu)\n  const submissionText = betchaAssessment ? (\n    <p>\n      You are about to finalise your submission for the {betchaAssessment.type.toLowerCase()}{' '}\n      <i>&quot;{betchaAssessment.title}&quot;</i>.\n    </p>\n  ) : (\n    <p>You are about to finalise your submission.</p>\n  );\n  const betchaText = (\n    <>\n      {submissionText}\n      <p>\n        Finalising your submission early grants you additional XP, but{' '}\n        <span className=\"warning\">this action is irreversible.</span>\n      </p>\n    </>\n  );\n  const betchaDialog = (\n    <Dialog\n      className=\"betcha-dialog\"\n      icon={IconNames.ERROR}\n      isCloseButtonShown={true}\n      isOpen={betchaAssessment !== null}\n      onClose={setBetchaAssessmentNull}\n      title=\"Finalise submission?\"\n    >\n      <div className={Classes.DIALOG_BODY}>\n        <Text>{betchaText}</Text>\n      </div>\n      <div className={Classes.DIALOG_FOOTER}>\n        <ButtonGroup>\n          <ControlButton\n            label=\"Cancel\"\n            onClick={setBetchaAssessmentNull}\n            options={{ minimal: false }}\n          />\n          <ControlButton\n            label=\"Finalise\"\n            onClick={submitAssessment}\n            options={{ minimal: false, intent: Intent.DANGER }}\n          />\n        </ButtonGroup>\n      </div>\n    </Dialog>\n  );\n\n  // Finally, render the ContentDisplay.\n  return (\n    <div className=\"Assessment\">\n      <ContentDisplay display={display} loadContentDispatch={props.handleAssessmentOverviewFetch} />\n      {betchaDialog}\n    </div>\n  );\n};\n\nconst makeGradingStatus = (gradingStatus: string) => {\n  let iconName: IconName;\n  let intent: Intent;\n  let tooltip: string;\n\n  switch (gradingStatus) {\n    case GradingStatuses.graded:\n      iconName = IconNames.TICK;\n      intent = Intent.SUCCESS;\n      tooltip = 'Fully graded';\n      break;\n    case GradingStatuses.grading:\n      iconName = IconNames.TIME;\n      intent = Intent.WARNING;\n      tooltip = 'Grading in progress';\n      break;\n    case GradingStatuses.none:\n      iconName = IconNames.CROSS;\n      intent = Intent.DANGER;\n      tooltip = 'Not graded yet';\n      break;\n    default:\n      // Shows default icon if this assessment is ungraded\n      iconName = IconNames.DISABLE;\n      intent = Intent.PRIMARY;\n      tooltip = `Not applicable`;\n      break;\n  }\n\n  return (\n    <Tooltip2 className=\"listing-title-tooltip\" content={tooltip} placement={Position.RIGHT}>\n      <Icon icon={iconName} intent={intent} />\n    </Tooltip2>\n  );\n};\n\nconst collapseButton = (label: string, isOpen: boolean, toggleFunc: () => void) => (\n  <ControlButton\n    label={label}\n    icon={isOpen ? IconNames.CARET_DOWN : IconNames.CARET_RIGHT}\n    onClick={toggleFunc}\n    options={{ minimal: true, className: 'collapse-button' }}\n  />\n);\n\nexport default Assessment;\n","import { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport {\n  acknowledgeNotifications,\n  fetchAssessmentOverviews,\n  submitAssessment\n} from '../application/actions/SessionActions';\nimport { OverallState, Role } from '../application/ApplicationTypes';\nimport Assessment, { DispatchProps, OwnProps, StateProps } from './Assessment';\n\nconst mapStateToProps: MapStateToProps<StateProps, OwnProps, OverallState> = (state, props) => ({\n  assessmentOverviews: state.session.assessmentOverviews,\n  isStudent: state.session.role ? state.session.role === Role.Student : true,\n  courseId: state.session.courseId\n});\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleAcknowledgeNotifications: acknowledgeNotifications,\n      handleAssessmentOverviewFetch: fetchAssessmentOverviews,\n      handleSubmitAssessment: submitAssessment\n    },\n    dispatch\n  );\n\nconst AssessmentContainer = connect(mapStateToProps, mapDispatchToProps)(Assessment);\n\nexport default AssessmentContainer;\n","import { Switch } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport React from 'react';\n\nimport ControlButton from '../ControlButton';\nimport { useResponsive } from '../utils/Hooks';\nimport { ControlBarRunButton } from './ControlBarRunButton';\n\ntype ControlBarAutorunButtonProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleDebuggerPause: () => void;\n  handleDebuggerReset: () => void;\n  handleDebuggerResume: () => void;\n  handleEditorEval: () => void;\n  handleInterruptEval: () => void;\n  handleToggleEditorAutorun?: () => void;\n};\n\ntype StateProps = {\n  isDebugging: boolean;\n  isEditorAutorun?: boolean;\n  isRunning: boolean;\n  key: string;\n  autorunDisabled?: boolean;\n  pauseDisabled?: boolean;\n  sourceChapter?: number;\n};\n\nexport const ControlBarAutorunButtons: React.FC<ControlBarAutorunButtonProps> = props => {\n  const showRunButton = !props.isDebugging && (\n    <ControlBarRunButton\n      handleEditorEval={props.handleEditorEval}\n      // Neon Green: #39FF14\n      color={props.isRunning ? '#39FF14' : undefined}\n      className={props.isRunning ? 'WaitingCursor' : undefined}\n      key=\"run\"\n    />\n  );\n\n  const showAutoRunIndicator = props.isEditorAutorun && (\n    <ControlButton label=\"Auto\" icon={IconNames.AUTOMATIC_UPDATES} />\n  );\n\n  // stop button does not do anything due to the blocking nature of eval methods (e.g. runInContext)\n  // to prevent \"flickering\", we will just disable Stop Button for now\n  const showStopButton = false && (\n    <ControlButton label=\"Stop\" icon={IconNames.STOP} onClick={props.handleInterruptEval} />\n  );\n\n  const showDebuggerPause = !props.pauseDisabled && props.isRunning && !props.isDebugging && (\n    <ControlButton label=\"Pause\" icon={IconNames.STOP} onClick={props.handleDebuggerPause} />\n  );\n\n  const showDebuggerResume = !props.isRunning && props.isDebugging && (\n    <ControlButton\n      label=\"Resume\"\n      icon={IconNames.CHEVRON_RIGHT}\n      onClick={props.handleDebuggerResume}\n    />\n  );\n\n  const showDebuggerReset = (label: string) =>\n    props.isDebugging && (\n      <ControlButton label={label} icon={IconNames.STOP} onClick={props.handleDebuggerReset} />\n    );\n\n  const { isMobileBreakpoint } = useResponsive();\n\n  return isMobileBreakpoint ? (\n    <>\n      {showStopButton}\n      {showDebuggerPause}\n      {showDebuggerResume}\n      {showDebuggerReset('Stop')}\n    </>\n  ) : (\n    <>\n      {!props.autorunDisabled && (\n        <div className=\"Switch\">\n          <Switch\n            label=\"\"\n            checked={props.isEditorAutorun}\n            onChange={props.handleToggleEditorAutorun}\n          />\n        </div>\n      )}\n      {showAutoRunIndicator || showStopButton || showRunButton}\n      {showDebuggerPause}\n      {showDebuggerResume}\n      {showDebuggerReset('Stop Debugger')}\n    </>\n  );\n};\n","import { NumericInput, Position } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport React from 'react';\n\ntype ControlBarExecutionTimeProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleChangeExecTime?: (execTime: number) => void;\n};\n\ntype StateProps = {\n  execTime?: number;\n  key: string;\n};\n\nexport const ControlBarExecutionTime: React.FC<ControlBarExecutionTimeProps> = props => {\n  return (\n    <Tooltip2 content=\"Execution Time\" placement={Position.TOP}>\n      <NumericInput\n        leftIcon={IconNames.TIME}\n        style={{ width: 80 }}\n        min={1000}\n        value={props.execTime}\n        onValueChange={props.handleChangeExecTime}\n      />\n    </Tooltip2>\n  );\n};\n","import { Classes, Colors, Menu } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Popover2 } from '@blueprintjs/popover2';\nimport * as React from 'react';\nimport * as CopyToClipboard from 'react-copy-to-clipboard';\n\nimport { checkSessionIdExists, createNewSession } from '../collabEditing/CollabEditingHelper';\nimport ControlButton from '../ControlButton';\nimport { showWarningMessage } from '../utils/NotificationsHelper';\n\ntype ControlBarSessionButtonsProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleSetEditorSessionId?: (editorSessionId: string) => void;\n};\n\ntype StateProps = {\n  editorSessionId?: string;\n  editorValue: string;\n  sharedbConnected?: boolean;\n  key: string;\n};\n\ntype State = {\n  joinElemValue: string;\n};\n\nfunction handleError(error: any) {\n  showWarningMessage(`Could not connect: ${(error && error.message) || error || 'Unknown error'}`);\n}\n\nexport class ControlBarSessionButtons extends React.PureComponent<\n  ControlBarSessionButtonsProps,\n  State\n> {\n  private inviteInputElem: React.RefObject<HTMLInputElement>;\n\n  constructor(props: ControlBarSessionButtonsProps) {\n    super(props);\n    this.state = { joinElemValue: '' };\n\n    this.handleChange = this.handleChange.bind(this);\n    this.inviteInputElem = React.createRef();\n    this.selectInviteInputText = this.selectInviteInputText.bind(this);\n  }\n\n  public render() {\n    const handleStartInvite = () => {\n      // FIXME this handler should be a Saga action or at least in a controller\n      if (this.props.editorSessionId === '') {\n        createNewSession(this.props.editorValue || '').then(sessionId => {\n          this.props.handleSetEditorSessionId!(sessionId);\n        }, handleError);\n      }\n    };\n\n    const inviteButtonPopoverContent = (\n      <>\n        <input value={this.props.editorSessionId} readOnly={true} ref={this.inviteInputElem} />\n        <CopyToClipboard text={'' + this.props.editorSessionId}>\n          <ControlButton icon={IconNames.DUPLICATE} onClick={this.selectInviteInputText} />\n        </CopyToClipboard>\n      </>\n    );\n\n    const inviteButton = (\n      <Popover2\n        popoverClassName=\"Popover-share\"\n        inheritDarkTheme={false}\n        content={inviteButtonPopoverContent}\n      >\n        <ControlButton label=\"Invite\" icon={IconNames.GRAPH} onClick={handleStartInvite} />\n      </Popover2>\n    );\n\n    const handleStartJoining = (event: React.FormEvent<HTMLFormElement>) => {\n      event.preventDefault();\n      // FIXME this handler should be a Saga action or at least in a controller\n      checkSessionIdExists(this.state.joinElemValue).then(\n        exists => {\n          if (exists) {\n            this.props.handleSetEditorSessionId!(this.state!.joinElemValue);\n          } else {\n            this.props.handleSetEditorSessionId!('');\n            showWarningMessage('Could not find a session with that ID.');\n          }\n        },\n        error => {\n          this.props.handleSetEditorSessionId!('');\n          handleError(error);\n        }\n      );\n    };\n\n    const joinButtonPopoverContent = (\n      // TODO: this form should use Blueprint\n      <form onSubmit={handleStartJoining}>\n        <input type=\"text\" value={this.state.joinElemValue} onChange={this.handleChange} />\n        <span className={Classes.POPOVER_DISMISS}>\n          <ControlButton icon={IconNames.KEY_ENTER} options={{ type: 'submit' }} />\n        </span>\n      </form>\n    );\n\n    const joinButton = (\n      <Popover2\n        popoverClassName=\"Popover-share\"\n        inheritDarkTheme={false}\n        content={joinButtonPopoverContent}\n      >\n        <ControlButton label=\"Join\" icon={IconNames.LOG_IN} />\n      </Popover2>\n    );\n\n    const leaveButton = (\n      <ControlButton\n        label=\"Leave\"\n        icon={IconNames.FEED}\n        onClick={() => {\n          // FIXME: this handler should be a Saga action or at least in a controller\n          this.props.handleSetEditorSessionId!('');\n          this.setState({ joinElemValue: '' });\n        }}\n      />\n    );\n\n    return (\n      <Popover2\n        content={\n          <Menu large={true}>\n            {inviteButton}\n            {this.props.editorSessionId === '' ? joinButton : leaveButton}\n          </Menu>\n        }\n      >\n        <ControlButton\n          label=\"Session\"\n          icon={IconNames.SOCIAL_MEDIA}\n          options={{\n            iconColor:\n              this.props.editorSessionId === ''\n                ? undefined\n                : this.props.sharedbConnected\n                ? Colors.GREEN3\n                : Colors.RED3\n          }}\n        />\n      </Popover2>\n    );\n  }\n\n  private selectInviteInputText() {\n    if (this.inviteInputElem.current !== null) {\n      this.inviteInputElem.current.focus();\n      this.inviteInputElem.current.select();\n    }\n  }\n\n  private handleChange(event: React.ChangeEvent<HTMLInputElement>) {\n    this.setState({ joinElemValue: event.target.value });\n  }\n}\n","import { NonIdealState, Position, Spinner, SpinnerSize, Text } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Popover2, Tooltip2 } from '@blueprintjs/popover2';\nimport * as React from 'react';\nimport * as CopyToClipboard from 'react-copy-to-clipboard';\n\nimport ControlButton from '../ControlButton';\nimport Constants from '../utils/Constants';\n\ntype ControlBarShareButtonProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleGenerateLz?: () => void;\n  handleShortenURL: (s: string) => void;\n  handleUpdateShortURL: (s: string) => void;\n};\n\ntype StateProps = {\n  queryString?: string;\n  shortURL?: string;\n  key: string;\n  isSicp?: boolean;\n};\n\ntype State = {\n  keyword: string;\n  isLoading: boolean;\n};\n\nexport class ControlBarShareButton extends React.PureComponent<ControlBarShareButtonProps, State> {\n  private shareInputElem: React.RefObject<HTMLInputElement>;\n\n  constructor(props: ControlBarShareButtonProps) {\n    super(props);\n    this.selectShareInputText = this.selectShareInputText.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n    this.toggleButton = this.toggleButton.bind(this);\n    this.shareInputElem = React.createRef();\n    this.state = { keyword: '', isLoading: false };\n  }\n\n  public render() {\n    const shareButtonPopoverContent =\n      this.props.queryString === undefined ? (\n        <Text>\n          Share your programs! Type something into the editor (left), then click on this button\n          again.\n        </Text>\n      ) : this.props.isSicp ? (\n        <div>\n          <input defaultValue={this.props.queryString!} readOnly={true} ref={this.shareInputElem} />\n          <Tooltip2 content=\"Copy link to clipboard\">\n            <CopyToClipboard text={this.props.queryString!}>\n              <ControlButton icon={IconNames.DUPLICATE} onClick={this.selectShareInputText} />\n            </CopyToClipboard>\n          </Tooltip2>\n        </div>\n      ) : (\n        <>\n          {!this.props.shortURL || this.props.shortURL === 'ERROR' ? (\n            !this.state.isLoading || this.props.shortURL === 'ERROR' ? (\n              <div>\n                {Constants.urlShortenerBase}&nbsp;\n                <input\n                  placeholder={'custom string (optional)'}\n                  onChange={this.handleChange}\n                  style={{ width: 175 }}\n                />\n                <ControlButton\n                  label=\"Get Link\"\n                  icon={IconNames.SHARE}\n                  onClick={() => {\n                    this.props.handleShortenURL(this.state.keyword);\n                    this.setState({ isLoading: true });\n                  }}\n                />\n              </div>\n            ) : (\n              <div>\n                <NonIdealState\n                  description=\"Generating Shareable Link...\"\n                  icon={<Spinner size={SpinnerSize.SMALL} />}\n                />\n              </div>\n            )\n          ) : (\n            <div key={this.props.shortURL}>\n              <input defaultValue={this.props.shortURL} readOnly={true} ref={this.shareInputElem} />\n              <Tooltip2 content=\"Copy link to clipboard\">\n                <CopyToClipboard text={this.props.shortURL}>\n                  <ControlButton icon={IconNames.DUPLICATE} onClick={this.selectShareInputText} />\n                </CopyToClipboard>\n              </Tooltip2>\n            </div>\n          )}\n        </>\n      );\n\n    return (\n      <Popover2\n        popoverClassName=\"Popover-share\"\n        inheritDarkTheme={false}\n        content={shareButtonPopoverContent}\n      >\n        <Tooltip2 content=\"Get shareable link\" placement={Position.TOP}>\n          <ControlButton label=\"Share\" icon={IconNames.SHARE} onClick={() => this.toggleButton()} />\n        </Tooltip2>\n      </Popover2>\n    );\n  }\n\n  public componentDidUpdate(prevProps: ControlBarShareButtonProps) {\n    if (this.props.shortURL !== prevProps.shortURL) {\n      this.setState({ keyword: '', isLoading: false });\n    }\n  }\n\n  private toggleButton() {\n    if (this.props.handleGenerateLz) {\n      this.props.handleGenerateLz();\n    }\n\n    // reset state\n    this.props.handleUpdateShortURL('');\n    this.setState({ keyword: '', isLoading: false });\n  }\n\n  private handleChange(event: React.FormEvent<HTMLInputElement>) {\n    this.setState({ keyword: event.currentTarget.value });\n  }\n\n  private selectShareInputText() {\n    if (this.shareInputElem.current !== null) {\n      this.shareInputElem.current.focus();\n      this.shareInputElem.current.select();\n    }\n  }\n}\n","import { NumericInput, Position } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport React from 'react';\n\ntype ControlBarStepLimitProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleChangeStepLimit?: (stepLimit: number) => void;\n};\n\ntype StateProps = {\n  stepLimit?: number;\n  key: string;\n};\n\nexport const ControlBarStepLimit: React.FC<ControlBarStepLimitProps> = props => {\n  return (\n    <Tooltip2 content=\"Step Limit\" placement={Position.TOP}>\n      <NumericInput\n        leftIcon={IconNames.VERTICAL_BAR_CHART_ASC}\n        style={{ width: 80 }}\n        min={500}\n        max={5000}\n        value={props.stepLimit}\n        onValueChange={props.handleChangeStepLimit}\n      />\n    </Tooltip2>\n  );\n};\n","import { Chapter, Variant } from 'c-slang/dist/types';\n\nimport { Links } from './Constants';\n\nconst MAIN_INTRODUCTION = `\nThis is a C language interpreter, which supports Syntax Check, Type Check, Memory Management, Heap Visualization (_printHeap_), Pointer Arithmetic, etc. Enjoy!\\n\nNOT SUPPORTED: preprocessor directives, struct, function pointers, array declaration (use _malloc_ instead)\n`;\n\nconst HOTKEYS_INTRODUCTION = `\nTips:\n  1. Call _printEnv()_ to display what is accessable in the current environment\n  2. The editor on the left supports [_Ace keyboard shortcuts_](${Links.aceHotkeys}) \n    and [_Source Academy keyboard shortcuts_](${Links.sourceHotkeys}).\n\nDeveloper: Cao Peng, Contact: e0376984@u.nus.edu\n`;\n\n\nconst generateIntroductionText = (sourceChapter: Chapter, sourceVariant: Variant) => {\n  return (\n    MAIN_INTRODUCTION +  HOTKEYS_INTRODUCTION\n  );\n};\n\nexport const generateSourceIntroduction = (sourceChapter: Chapter, sourceVariant: Variant) => {\n  return generateIntroductionText(sourceChapter, sourceVariant);\n};\n","import * as qs from 'query-string';\nimport { isArray } from 'util';\n\nexport interface IParsedQuery {\n  [key: string]: string | undefined;\n}\n\n/**\n * Parse a query string into an object.\n *\n * This is a wrapper for query-string that disables array and null parsing (so\n * the object has only strings).\n */\nexport function parseQuery(query: string): IParsedQuery {\n  const parsed = qs.parse(query);\n  for (const [key, val] of Object.entries(parsed)) {\n    if (isArray(val)) {\n      parsed[key] = val.join(',');\n    } else if (val === null) {\n      delete parsed[key];\n    }\n  }\n\n  return parsed as IParsedQuery;\n}\n","import { Classes } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Octokit } from '@octokit/rest';\nimport { Ace } from 'ace-builds';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport classNames from 'classnames';\nimport _, { isEqual } from 'lodash';\nimport { decompressFromEncodedURIComponent } from 'lz-string';\nimport * as React from 'react';\nimport { HotKeys } from 'react-hotkeys';\nimport { useDispatch } from 'react-redux';\nimport { RouteComponentProps, useHistory, useLocation } from 'react-router';\nimport {\n  beginDebuggerPause,\n  beginInterruptExecution,\n  debuggerReset,\n  debuggerResume\n} from 'src/commons/application/actions/InterpreterActions';\nimport {\n  setEditorSessionId,\n  setSharedbConnected\n} from 'src/commons/collabEditing/CollabEditingActions';\nimport { useResponsive, useTypedSelector } from 'src/commons/utils/Hooks';\nimport {\n  browseReplHistoryDown,\n  browseReplHistoryUp,\n  changeSideContentHeight,\n  changeStepLimit,\n  checkEditor,\n  evalEditor,\n  navigateToDeclaration,\n  promptAutocomplete,\n  sendReplInputToOutput,\n  toggleEditorAutorun,\n  updateReplValue\n} from 'src/commons/workspace/WorkspaceActions';\nimport { WorkspaceLocation } from 'src/commons/workspace/WorkspaceTypes';\nimport {\n  generateLzString,\n  shortenURL,\n  updateShortURL\n} from 'src/features/playground/PlaygroundActions';\n\nimport {\n  InterpreterOutput,\n  isSourceLanguage,\n  sourceLanguages\n} from '../../commons/application/ApplicationTypes';\nimport { ExternalLibraryName } from '../../commons/application/types/ExternalTypes';\nimport { ControlBarAutorunButtons } from '../../commons/controlBar/ControlBarAutorunButtons';\nimport { ControlBarClearButton } from '../../commons/controlBar/ControlBarClearButton';\nimport { ControlBarEvalButton } from '../../commons/controlBar/ControlBarEvalButton';\nimport { ControlBarExecutionTime } from '../../commons/controlBar/ControlBarExecutionTime';\nimport { ControlBarSessionButtons } from '../../commons/controlBar/ControlBarSessionButton';\nimport { ControlBarShareButton } from '../../commons/controlBar/ControlBarShareButton';\nimport { ControlBarStepLimit } from '../../commons/controlBar/ControlBarStepLimit';\nimport {\n  convertEditorTabStateToProps,\n  NormalEditorContainerProps\n} from '../../commons/editor/EditorContainer';\nimport { Position } from '../../commons/editor/EditorTypes';\nimport Markdown from '../../commons/Markdown';\nimport MobileWorkspace, {\n  MobileWorkspaceProps\n} from '../../commons/mobileWorkspace/MobileWorkspace';\nimport { SideContentTab, SideContentType } from '../../commons/sideContent/SideContentTypes';\nimport { Links } from '../../commons/utils/Constants';\nimport { generateSourceIntroduction } from '../../commons/utils/IntroductionHelper';\nimport { stringParamToInt } from '../../commons/utils/ParamParseHelper';\nimport { parseQuery } from '../../commons/utils/QueryHelper';\nimport Workspace, { WorkspaceProps } from '../../commons/workspace/Workspace';\nimport { EditorTabState } from '../../commons/workspace/WorkspaceTypes';\nimport { initSession, log } from '../../features/eventLogging';\nimport { GitHubSaveInfo } from '../../features/github/GitHubTypes';\nimport { PersistenceFile } from '../../features/persistence/PersistenceTypes';\nimport {\n  CodeDelta,\n  Input,\n  SelectionRange\n} from '../../features/sourceRecorder/SourceRecorderTypes';\n\nexport type PlaygroundProps = OwnProps &\n  DispatchProps &\n  StateProps &\n  RouteComponentProps<{}> & {\n    workspaceLocation?: WorkspaceLocation;\n  };\n\nexport type OwnProps = {\n  isSicpEditor?: boolean;\n  initialEditorValueHash?: string;\n  prependLength?: number;\n  handleCloseEditor?: () => void;\n};\n\nexport type DispatchProps = {\n  handleChangeExecTime: (execTime: number) => void;\n  handleChapterSelect: (chapter: Chapter, variant: Variant) => void;\n  handleEditorValueChange: (val: string) => void;\n  handleEditorUpdateBreakpoints: (breakpoints: string[]) => void;\n  handleReplEval: () => void;\n  handleReplOutputClear: () => void;\n  handleUsingSubst: (usingSubst: boolean) => void;\n};\n\nexport type StateProps = {\n  activeEditorTabIndex: number | null;\n  editorTabs: EditorTabState[];\n  editorSessionId: string;\n  execTime: number;\n  isEditorAutorun: boolean;\n  isRunning: boolean;\n  isDebugging: boolean;\n  enableDebugging: boolean;\n  output: InterpreterOutput[];\n  queryString?: string;\n  shortURL?: string;\n  replValue: string;\n  sideContentHeight?: number;\n  playgroundSourceChapter: number;\n  playgroundSourceVariant: Variant;\n  courseSourceChapter?: number;\n  courseSourceVariant?: Variant;\n  stepLimit: number;\n  sharedbConnected: boolean;\n  usingSubst: boolean;\n  persistenceUser: string | undefined;\n  persistenceFile: PersistenceFile | undefined;\n  githubOctokitObject: { octokit: Octokit | undefined };\n  githubSaveInfo: GitHubSaveInfo;\n};\n\nconst keyMap = { goGreen: 'h u l k' };\n\nexport async function handleHash(hash: string, props: PlaygroundProps) {\n  const qs = parseQuery(hash);\n\n  const chapter = stringParamToInt(qs.chap) || undefined;\n  const programLz = qs.lz ?? qs.prgrm;\n  const program = programLz && decompressFromEncodedURIComponent(programLz);\n  if (program) {\n    props.handleEditorValueChange(program);\n  }\n  const variant: Variant =\n    sourceLanguages.find(\n      language => language.chapter === chapter && language.variant === qs.variant\n    )?.variant ?? Variant.DEFAULT;\n  if (chapter) {\n    props.handleChapterSelect(chapter, variant);\n  }\n\n  const execTime = Math.max(stringParamToInt(qs.exec || '1000') || 1000, 1000);\n  if (execTime) {\n    props.handleChangeExecTime(execTime);\n  }\n}\n\nconst Playground: React.FC<PlaygroundProps> = ({ workspaceLocation = 'playground', ...props }) => {\n  const { isSicpEditor } = props;\n  const { isMobileBreakpoint } = useResponsive();\n  const propsRef = React.useRef(props);\n  propsRef.current = props;\n\n  const dispatch = useDispatch();\n\n  const [deviceSecret, setDeviceSecret] = React.useState<string | undefined>();\n  const location = useLocation();\n  const history = useHistory();\n  const searchParams = new URLSearchParams(location.search);\n  const shouldAddDevice = searchParams.get('add_device');\n\n  // Hide search query from URL to maintain an illusion of security. The device secret\n  // is still exposed via the 'Referer' header when requesting external content (e.g. Google API fonts)\n  if (shouldAddDevice && !deviceSecret) {\n    setDeviceSecret(shouldAddDevice);\n    history.replace(location.pathname);\n  }\n\n  const [, setLastEdit] = React.useState(new Date());\n  const [isGreen, setIsGreen] = React.useState(false);\n  const [selectedTab, setSelectedTab] = React.useState(\n    shouldAddDevice ? SideContentType.remoteExecution : SideContentType.introduction\n  );\n  const [hasBreakpoints, setHasBreakpoints] = React.useState(false);\n  const [sessionId, setSessionId] = React.useState(() =>\n    initSession('playground', {\n      // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n      editorValue: propsRef.current.editorTabs[0].value,\n      chapter: propsRef.current.playgroundSourceChapter\n    })\n  );\n\n\n  const usingRemoteExecution =\n    useTypedSelector(state => !!state.session.remoteExecutionSession) && !isSicpEditor;\n  // this is still used by remote execution (EV3)\n  // specifically, for the editor Ctrl+B to work\n  const externalLibraryName = useTypedSelector(\n    state => state.workspaces.playground.externalLibrary\n  );\n\n  React.useEffect(() => {\n    // When the editor session Id changes, then treat it as a new session.\n    setSessionId(\n      initSession('playground', {\n        // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n        editorValue: propsRef.current.editorTabs[0].value,\n        chapter: propsRef.current.playgroundSourceChapter\n      })\n    );\n  }, [props.editorSessionId]);\n\n  const hash = isSicpEditor ? props.initialEditorValueHash : props.location.hash;\n\n  React.useEffect(() => {\n    if (!hash) {\n      // If not a accessing via shared link, use the Source chapter and variant in the current course\n      if (props.courseSourceChapter && props.courseSourceVariant) {\n        propsRef.current.handleChapterSelect(props.courseSourceChapter, props.courseSourceVariant);\n      }\n      return;\n    }\n    handleHash(hash, propsRef.current);\n  }, [hash, props.courseSourceChapter, props.courseSourceVariant]);\n\n  /**\n   * Handles toggling of relevant SideContentTabs when mobile breakpoint it hit\n   */\n  React.useEffect(() => {\n    if (isMobileBreakpoint && desktopOnlyTabIds.includes(selectedTab)) {\n      setSelectedTab(SideContentType.mobileEditor);\n    } else if (!isMobileBreakpoint && mobileOnlyTabIds.includes(selectedTab)) {\n      setSelectedTab(SideContentType.introduction);\n    }\n  }, [isMobileBreakpoint, selectedTab]);\n\n  const handlers = React.useMemo(\n    () => ({\n      goGreen: () => setIsGreen(!isGreen)\n    }),\n    [isGreen]\n  );\n\n  const onEditorValueChange = React.useCallback(val => {\n    setLastEdit(new Date());\n    propsRef.current.handleEditorValueChange(val);\n  }, []);\n\n  const onChangeTabs = React.useCallback(\n    (\n      newTabId: SideContentType,\n      prevTabId: SideContentType,\n      event: React.MouseEvent<HTMLElement>\n    ) => {\n      if (newTabId === prevTabId) {\n        return;\n      }\n\n      const { handleUsingSubst, handleReplOutputClear, playgroundSourceChapter } = propsRef.current;\n\n      /**\n       * Do nothing when clicking the mobile 'Run' tab while on the stepper tab.\n       */\n      if (\n        !(\n          prevTabId === SideContentType.substVisualizer &&\n          newTabId === SideContentType.mobileEditorRun\n        )\n      ) {\n        if (playgroundSourceChapter <= 2 && newTabId === SideContentType.substVisualizer) {\n          handleUsingSubst(true);\n        }\n\n        if (prevTabId === SideContentType.substVisualizer && !hasBreakpoints) {\n          handleReplOutputClear();\n          handleUsingSubst(false);\n        }\n\n        setSelectedTab(newTabId);\n      }\n    },\n    [hasBreakpoints]\n  );\n\n\n  const pushLog = React.useCallback(\n    (newInput: Input) => {\n      log(sessionId, newInput);\n    },\n    [sessionId]\n  );\n\n  const handleEditorEval = React.useCallback(\n    () => dispatch(evalEditor(workspaceLocation)),\n    [dispatch, workspaceLocation]\n  );\n\n  const handleEditorCheck = React.useCallback(\n    () => dispatch(checkEditor(workspaceLocation)),\n    [dispatch, workspaceLocation]\n  );\n\n  const autorunButtons = React.useMemo(() => {\n    return (\n      <ControlBarAutorunButtons\n        {..._.pick(props, 'isDebugging', 'isEditorAutorun', 'isRunning')}\n        handleInterruptEval={() => dispatch(beginInterruptExecution(workspaceLocation))}\n        handleToggleEditorAutorun={() => dispatch(toggleEditorAutorun(workspaceLocation))}\n        handleEditorEval={handleEditorEval}\n        handleDebuggerPause={() => dispatch(beginDebuggerPause(workspaceLocation))}\n        handleDebuggerReset={() => dispatch(debuggerReset(workspaceLocation))}\n        handleDebuggerResume={() => dispatch(debuggerResume(workspaceLocation))}\n        key=\"autorun\"\n        autorunDisabled={usingRemoteExecution}\n        sourceChapter={props.playgroundSourceChapter}\n        // Disable pause for non-Source languages since they cannot be paused\n        pauseDisabled={usingRemoteExecution || !isSourceLanguage(props.playgroundSourceChapter)}\n      />\n    );\n  }, [dispatch, handleEditorEval, props, usingRemoteExecution, workspaceLocation]);\n\n  const clearButton = React.useMemo(\n    () =>\n      selectedTab === SideContentType.substVisualizer ? null : (\n        <ControlBarClearButton\n          handleReplOutputClear={props.handleReplOutputClear}\n          key=\"clear_repl\"\n        />\n      ),\n    [props.handleReplOutputClear, selectedTab]\n  );\n\n  const evalButton = React.useMemo(\n    () =>\n      selectedTab === SideContentType.substVisualizer ? null : (\n        <ControlBarEvalButton\n          handleReplEval={props.handleReplEval}\n          isRunning={props.isRunning}\n          key=\"eval_repl\"\n        />\n      ),\n    [props.handleReplEval, props.isRunning, selectedTab]\n  );\n\n\n\n\n  const executionTime = React.useMemo(\n    () => (\n      <ControlBarExecutionTime\n        execTime={props.execTime}\n        handleChangeExecTime={props.handleChangeExecTime}\n        key=\"execution_time\"\n      />\n    ),\n    [props.execTime, props.handleChangeExecTime]\n  );\n\n  const stepperStepLimit = React.useMemo(\n    () => (\n      <ControlBarStepLimit\n        stepLimit={props.stepLimit}\n        handleChangeStepLimit={limit => dispatch(changeStepLimit(limit, workspaceLocation))}\n        key=\"step_limit\"\n      />\n    ),\n    [dispatch, props.stepLimit, workspaceLocation]\n  );\n\n  const { handleEditorValueChange } = props;\n\n  // No point memoing this, it uses props.editorValue\n  const sessionButtons = (\n    <ControlBarSessionButtons\n      editorSessionId={props.editorSessionId}\n      // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n      editorValue={props.editorTabs[0].value}\n      handleSetEditorSessionId={id => dispatch(setEditorSessionId(workspaceLocation, id))}\n      sharedbConnected={props.sharedbConnected}\n      key=\"session\"\n    />\n  );\n\n  const shareButton = React.useMemo(() => {\n    const queryString = isSicpEditor\n      ? Links.playground + '#' + props.initialEditorValueHash\n      : props.queryString;\n    return (\n      <ControlBarShareButton\n        handleGenerateLz={() => dispatch(generateLzString())}\n        handleShortenURL={s => dispatch(shortenURL(s))}\n        handleUpdateShortURL={s => dispatch(updateShortURL(s))}\n        queryString={queryString}\n        shortURL={props.shortURL}\n        isSicp={isSicpEditor}\n        key=\"share\"\n      />\n    );\n  }, [dispatch, isSicpEditor, props.initialEditorValueHash, props.queryString, props.shortURL]);\n\n  const playgroundIntroductionTab: SideContentTab = React.useMemo(\n    () => ({\n      label: 'Introduction',\n      iconName: IconNames.HOME,\n      body: (\n        <Markdown\n          content={generateSourceIntroduction(\n            props.playgroundSourceChapter,\n            props.playgroundSourceVariant\n          )}\n          openLinksInNewWindow={true}\n        />\n      ),\n      id: SideContentType.introduction\n    }),\n    [props.playgroundSourceChapter, props.playgroundSourceVariant]\n  );\n\n  const tabs = React.useMemo(() => {\n    const tabs: SideContentTab[] = [playgroundIntroductionTab];\n\n\n\n    return tabs;\n  }, [playgroundIntroductionTab]);\n\n  // Remove Intro and Remote Execution tabs for mobile\n  const mobileTabs = [...tabs].filter(({ id }) => !(id && desktopOnlyTabIds.includes(id)));\n\n  const onLoadMethod = React.useCallback(\n    (editor: Ace.Editor) => {\n      let firstTime = true\n      const firstTimeHandleEditorCheck = () => {\n        if (firstTime) {\n          handleEditorCheck()\n          firstTime = false\n        }\n      }\n      editor.renderer.on('afterRender', firstTimeHandleEditorCheck);\n    },\n    [handleEditorCheck]\n  );\n\n  const onChangeMethod = React.useCallback(\n    (newCode: string, delta: CodeDelta) => {\n      handleEditorValueChange(newCode);\n\n      const input: Input = {\n        time: Date.now(),\n        type: 'codeDelta',\n        data: delta\n      };\n\n      pushLog(input);\n    },\n    [handleEditorValueChange, pushLog]\n  );\n\n  const onCursorChangeMethod = React.useCallback(\n    (selection: any) => {\n      const input: Input = {\n        time: Date.now(),\n        type: 'cursorPositionChange',\n        data: selection.getCursor()\n      };\n\n      pushLog(input);\n    },\n    [pushLog]\n  );\n\n  const onSelectionChangeMethod = React.useCallback(\n    (selection: any) => {\n      const range: SelectionRange = selection.getRange();\n      const isBackwards: boolean = selection.isBackwards();\n      if (!isEqual(range.start, range.end)) {\n        const input: Input = {\n          time: Date.now(),\n          type: 'selectionRangeData',\n          data: { range, isBackwards }\n        };\n\n        pushLog(input);\n      }\n    },\n    [pushLog]\n  );\n\n  const handleEditorUpdateBreakpoints = React.useCallback(\n    (breakpoints: string[]) => {\n      // get rid of holes in array\n      const numberOfBreakpoints = breakpoints.filter(arrayItem => !!arrayItem).length;\n      if (numberOfBreakpoints > 0) {\n        setHasBreakpoints(true);\n        if (propsRef.current.playgroundSourceChapter <= 2) {\n          /**\n           * There are breakpoints set on Source Chapter 2, so we set the\n           * Redux state for the editor to evaluate to the substituter\n           */\n\n          propsRef.current.handleUsingSubst(true);\n        }\n      }\n      if (numberOfBreakpoints === 0) {\n        setHasBreakpoints(false);\n\n        if (selectedTab !== SideContentType.substVisualizer) {\n          propsRef.current.handleReplOutputClear();\n          propsRef.current.handleUsingSubst(false);\n        }\n      }\n      propsRef.current.handleEditorUpdateBreakpoints(breakpoints);\n    },\n    [selectedTab]\n  );\n\n  const replDisabled = usingRemoteExecution;\n\n  const editorContainerProps: NormalEditorContainerProps = {\n    ..._.pick(props, 'editorSessionId', 'isEditorAutorun'),\n    editorVariant: 'normal',\n    editorTabs: props.editorTabs.map(convertEditorTabStateToProps),\n    handleDeclarationNavigate: (cursorPosition: Position) =>\n      dispatch(navigateToDeclaration(workspaceLocation, cursorPosition)),\n    handleEditorEval,\n    handleEditorCheck,\n    handlePromptAutocomplete: (row: number, col: number, callback: any) =>\n      dispatch(promptAutocomplete(workspaceLocation, row, col, callback)),\n    handleSendReplInputToOutput: (code: string) =>\n      dispatch(sendReplInputToOutput(code, workspaceLocation)),\n    handleSetSharedbConnected: (connected: boolean) =>\n      dispatch(setSharedbConnected(workspaceLocation, connected)),\n    onChange: onChangeMethod,\n    onCursorChange: onCursorChangeMethod,\n    onSelectionChange: onSelectionChangeMethod,\n    onLoad: onLoadMethod,\n    sourceChapter: props.playgroundSourceChapter,\n    externalLibraryName,\n    sourceVariant: props.playgroundSourceVariant,\n    handleEditorValueChange: onEditorValueChange,\n    handleEditorUpdateBreakpoints: handleEditorUpdateBreakpoints\n  };\n\n  const replProps = {\n    ..._.pick(props, 'output', 'replValue', 'handleReplEval', 'usingSubst'),\n    handleBrowseHistoryDown: () => dispatch(browseReplHistoryDown(workspaceLocation)),\n    handleBrowseHistoryUp: () => dispatch(browseReplHistoryUp(workspaceLocation)),\n    handleReplValueChange: (newValue: string) =>\n      dispatch(updateReplValue(newValue, workspaceLocation)),\n    sourceChapter: props.playgroundSourceChapter,\n    sourceVariant: props.playgroundSourceVariant,\n    externalLibrary: ExternalLibraryName.NONE, // temporary placeholder as we phase out libraries\n    hidden: selectedTab === SideContentType.substVisualizer,\n    inputHidden: replDisabled,\n    replButtons: [replDisabled ? null : evalButton, clearButton],\n    disableScrolling: isSicpEditor\n  };\n\n  const sideBarProps = {\n    tabs: [\n      // TODO: Re-enable on master once the feature is production-ready.\n      // {\n      //   label: 'Files',\n      //   body: <FileSystemView basePath=\"/playground\" />,\n      //   iconName: IconNames.FOLDER_CLOSE,\n      //   id: SideContentType.files\n      // }\n    ]\n  };\n\n  const workspaceProps: WorkspaceProps = {\n    controlBarProps: {\n      editorButtons: [\n        autorunButtons,\n        usingRemoteExecution || !isSourceLanguage(props.playgroundSourceChapter)\n          ? null\n          : props.usingSubst\n          ? stepperStepLimit\n          : executionTime\n      ]\n    },\n    editorContainerProps: editorContainerProps,\n    handleSideContentHeightChange: change =>\n      dispatch(changeSideContentHeight(change, workspaceLocation)),\n    replProps: replProps,\n    sideBarProps: sideBarProps,\n    sideContentHeight: props.sideContentHeight,\n    sideContentProps: {\n      selectedTabId: selectedTab,\n      onChange: onChangeTabs,\n      tabs: {\n        beforeDynamicTabs: tabs,\n        afterDynamicTabs: []\n      },\n      workspaceLocation: isSicpEditor ? 'sicp' : 'playground',\n      sideContentHeight: props.sideContentHeight\n    },\n    sideContentIsResizeable: selectedTab !== SideContentType.substVisualizer\n  };\n\n  const mobileWorkspaceProps: MobileWorkspaceProps = {\n    editorContainerProps: editorContainerProps,\n    replProps: replProps,\n    sideBarProps: sideBarProps,\n    mobileSideContentProps: {\n      mobileControlBarProps: {\n        editorButtons: [\n          autorunButtons,\n          shareButton,\n          isSicpEditor ? null : sessionButtons,\n        ]\n      },\n      selectedTabId: selectedTab,\n      onChange: onChangeTabs,\n      tabs: {\n        beforeDynamicTabs: mobileTabs,\n        afterDynamicTabs: []\n      },\n      workspaceLocation: isSicpEditor ? 'sicp' : 'playground'\n    }\n  };\n\n  return isMobileBreakpoint ? (\n    <div className={classNames('Playground', Classes.DARK, isGreen ? 'GreenScreen' : undefined)}>\n      <MobileWorkspace {...mobileWorkspaceProps} />\n    </div>\n  ) : (\n    <HotKeys\n      className={classNames('Playground', Classes.DARK, isGreen ? 'GreenScreen' : undefined)}\n      keyMap={keyMap}\n      handlers={handlers}\n    >\n      <Workspace {...workspaceProps} />\n    </HotKeys>\n  );\n};\n\nconst mobileOnlyTabIds: readonly SideContentType[] = [\n  SideContentType.mobileEditor,\n  SideContentType.mobileEditorRun\n];\nconst desktopOnlyTabIds: readonly SideContentType[] = [SideContentType.introduction];\n\n\nexport default Playground;\n","import {\n  cardBackgroundUrl,\n  coverImageUrl\n} from '../../../../features/achievement/AchievementConstants';\nimport {\n  AchievementItem,\n  AchievementView\n} from '../../../../features/achievement/AchievementTypes';\n\nexport const viewTemplate: AchievementView = {\n  coverImage: `${coverImageUrl}/default.png`,\n  description: '',\n  completionText: ''\n};\n\nexport const achievementTemplate: AchievementItem = {\n  uuid: '',\n  title: 'Achievement Title Here',\n  xp: 0,\n  isVariableXp: false,\n  isTask: false,\n  position: 0,\n  prerequisiteUuids: [],\n  goalUuids: [],\n  cardBackground: `${cardBackgroundUrl}/default.png`,\n  view: viewTemplate\n};\n","import { Button } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { useContext } from 'react';\nimport { AchievementContext } from 'src/features/achievement/AchievementConstants';\n\nimport { achievementTemplate } from './AchievementTemplate';\n\ntype AchievementAdderProps = {\n  allowNewUuid: boolean;\n  setNewUuid: (uuid: string) => void;\n};\n\nfunction AchievementAdder(props: AchievementAdderProps) {\n  const { allowNewUuid, setNewUuid } = props;\n\n  const inferencer = useContext(AchievementContext);\n\n  const addAchievement = () => setNewUuid(inferencer.insertAchievement(achievementTemplate));\n\n  return (\n    <Button\n      className=\"command-button\"\n      disabled={!allowNewUuid}\n      icon={IconNames.NEW_OBJECT}\n      onClick={addAchievement}\n      text=\"Create Achievement\"\n    />\n  );\n}\n\nexport default AchievementAdder;\n","import { Button } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { showSimpleConfirmDialog } from 'src/commons/utils/DialogHelper';\n\ntype ItemDeleterProps = {\n  deleteItem: () => void;\n  item: string;\n};\n\nfunction ItemDeleter(props: ItemDeleterProps) {\n  const { deleteItem, item } = props;\n\n  const confirmDelete = async () => {\n    const confirm = await showSimpleConfirmDialog({\n      contents: `Are you sure you want to delete '${item}' ?`,\n      negativeLabel: 'No',\n      positiveIntent: 'danger',\n      positiveLabel: 'Yes, delete'\n    });\n    if (confirm) {\n      deleteItem();\n    }\n  };\n\n  return (\n    <Tooltip2 content=\"Delete\">\n      <Button icon={IconNames.TRASH} intent=\"danger\" onClick={confirmDelete} />\n    </Tooltip2>\n  );\n}\n\nexport default ItemDeleter;\n","import { Button } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { showSuccessMessage, showWarningMessage } from 'src/commons/utils/NotificationsHelper';\n\ntype ItemSaverProps = {\n  discardChanges: () => void;\n  saveChanges: () => void;\n};\n\nfunction ItemSaver(props: ItemSaverProps) {\n  const { discardChanges, saveChanges } = props;\n\n  const handleSaveChanges = () => {\n    saveChanges();\n    showSuccessMessage('Saved changes locally');\n  };\n\n  const handleDiscardChanges = () => {\n    discardChanges();\n    showWarningMessage('Discarded changes');\n  };\n\n  return (\n    <>\n      <Tooltip2 content=\"Save Changes\">\n        <Button icon={IconNames.FLOPPY_DISK} intent=\"primary\" onClick={handleSaveChanges} />\n      </Tooltip2>\n\n      <Tooltip2 content=\"Discard Changes\">\n        <Button icon={IconNames.CROSS} intent=\"danger\" onClick={handleDiscardChanges} />\n      </Tooltip2>\n    </>\n  );\n}\n\nexport default ItemSaver;\n","import { MenuItem } from '@blueprintjs/core';\nimport { ItemPredicate, ItemRenderer, MultiSelect } from '@blueprintjs/select';\nimport { without } from 'lodash';\nimport { useContext } from 'react';\nimport { AchievementContext } from 'src/features/achievement/AchievementConstants';\nimport { AchievementGoal } from 'src/features/achievement/AchievementTypes';\n\ntype EditableGoalUuidsProps = {\n  changeGoalUuids: (goalUuids: string[]) => void;\n  goalUuids: string[];\n};\n\nfunction EditableGoalUuids(props: EditableGoalUuidsProps) {\n  const { changeGoalUuids, goalUuids } = props;\n\n  const inferencer = useContext(AchievementContext);\n  const allGoalUuids = inferencer.getAllGoalUuids();\n  const selectedUuids = goalUuids.filter(\n    uuid => !inferencer.isInvalidGoal(inferencer.getGoal(uuid))\n  );\n\n  const getUuid = (text: string) => inferencer.getUuidByText(text);\n\n  const GoalSelect = MultiSelect.ofType<AchievementGoal>();\n  const goalRenderer: ItemRenderer<AchievementGoal> = (goal, { handleClick }) => (\n    <MenuItem key={goal.uuid} onClick={handleClick} text={goal.text} />\n  );\n  const goalPredicate: ItemPredicate<AchievementGoal> = (query, item) =>\n    item.text.toLowerCase().includes(query.toLowerCase());\n\n  const selectedGoals = new Set(selectedUuids);\n  const availableGoals = new Set(without(allGoalUuids, ...goalUuids));\n\n  const selectGoal = (selectUuid: string) => {\n    selectedGoals.add(selectUuid);\n    availableGoals.delete(selectUuid);\n    changeGoalUuids([...selectedGoals]);\n  };\n\n  const removeGoal = (removeUuid?: string) => {\n    if (removeGoal === undefined) return;\n\n    selectedGoals.delete(removeUuid!);\n    availableGoals.add(removeUuid!);\n    changeGoalUuids([...selectedGoals]);\n  };\n\n  return (\n    <GoalSelect\n      itemRenderer={goalRenderer}\n      items={[...availableGoals].map(uuid => inferencer.getGoal(uuid))}\n      noResults={<MenuItem disabled={true} text=\"No available goal\" />}\n      onItemSelect={goal => selectGoal(goal.uuid)}\n      selectedItems={[...selectedGoals].map(uuid => inferencer.getGoal(uuid))}\n      tagInputProps={{ onRemove: text => removeGoal(getUuid(text!.toString())) }}\n      tagRenderer={goal => goal.text}\n      itemPredicate={goalPredicate}\n      resetOnSelect={true}\n    />\n  );\n}\n\nexport default EditableGoalUuids;\n","import { Button, MenuItem } from '@blueprintjs/core';\nimport { ItemRenderer, Select } from '@blueprintjs/select';\nimport { useContext } from 'react';\nimport { AchievementContext } from 'src/features/achievement/AchievementConstants';\n\ntype EditablePositionProps = {\n  changePosition: (position: number) => void;\n  position: number;\n};\n\nfunction EditablePosition(props: EditablePositionProps) {\n  const { changePosition, position } = props;\n\n  const inferencer = useContext(AchievementContext);\n  const maxPosition = inferencer.listTaskUuids().length + 1;\n  const positionOptions = [...Array(maxPosition + 1).keys()]; // [0..maxPosition + 1]\n\n  const PositionSelect = Select.ofType<number>();\n  const positionRenderer: ItemRenderer<number> = (position, { handleClick }) => (\n    <MenuItem key={position} onClick={handleClick} text={position} />\n  );\n\n  return (\n    <PositionSelect\n      filterable={false}\n      itemRenderer={positionRenderer}\n      items={positionOptions}\n      onItemSelect={changePosition}\n    >\n      <Button text={position} />\n    </PositionSelect>\n  );\n}\n\nexport default EditablePosition;\n","import { MenuItem } from '@blueprintjs/core';\nimport { ItemPredicate, ItemRenderer, MultiSelect } from '@blueprintjs/select';\nimport { without } from 'lodash';\nimport { useContext } from 'react';\nimport { AchievementContext } from 'src/features/achievement/AchievementConstants';\nimport { AchievementItem } from 'src/features/achievement/AchievementTypes';\n\ntype EditablePrerequisiteUuidsProps = {\n  changePrerequisiteUuids: (prerequisiteUuids: string[]) => void;\n  uuid: string;\n  prerequisiteUuids: string[];\n};\n\nfunction EditablePrerequisiteUuids(props: EditablePrerequisiteUuidsProps) {\n  const { changePrerequisiteUuids, uuid, prerequisiteUuids } = props;\n\n  const enablePrerequisites = false;\n\n  const inferencer = useContext(AchievementContext);\n  const availableUuids: string[] = enablePrerequisites\n    ? inferencer.listAvailablePrerequisiteUuids(uuid)\n    : [];\n  const selectedUuids = prerequisiteUuids.filter(\n    uuid => !inferencer.isInvalidAchievement(inferencer.getAchievement(uuid))\n  );\n\n  const getUuid = (title: string) => inferencer.getUuidByTitle(title);\n\n  const PrerequisiteSelect = MultiSelect.ofType<AchievementItem>();\n  const prerequisiteRenderer: ItemRenderer<AchievementItem> = (achievement, { handleClick }) => (\n    <MenuItem key={achievement.uuid} onClick={handleClick} text={achievement.title} />\n  );\n  const prerequisitePredicate: ItemPredicate<AchievementItem> = (query, item) =>\n    item.title.toLowerCase().includes(query.toLowerCase());\n\n  const selectedPrereqs = new Set(selectedUuids);\n  const availablePrereqs = new Set(without(availableUuids, ...selectedUuids));\n\n  const selectPrereq = (selectUuid: string) => {\n    selectedPrereqs.add(selectUuid);\n    availablePrereqs.delete(selectUuid);\n    changePrerequisiteUuids([...selectedPrereqs]);\n  };\n\n  const removePrereq = (removeUuid?: string) => {\n    if (removeUuid === undefined) return;\n\n    selectedPrereqs.delete(removeUuid);\n    availablePrereqs.add(removeUuid);\n    changePrerequisiteUuids([...selectedPrereqs]);\n  };\n\n  return (\n    <PrerequisiteSelect\n      itemRenderer={prerequisiteRenderer}\n      items={[...availablePrereqs].map(uuid => inferencer.getAchievement(uuid))}\n      noResults={<MenuItem disabled={true} text=\"No available achievement\" />}\n      onItemSelect={achievement => selectPrereq(achievement.uuid)}\n      selectedItems={[...selectedPrereqs].map(uuid => inferencer.getAchievement(uuid))}\n      tagInputProps={{ onRemove: title => removePrereq(getUuid(title!.toString())) }}\n      tagRenderer={achievement => achievement.title}\n      itemPredicate={prerequisitePredicate}\n      resetOnSelect={true}\n    />\n  );\n}\n\nexport default EditablePrerequisiteUuids;\n","import { Button, Checkbox, Dialog, EditableText } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { useState } from 'react';\nimport { AchievementItem } from 'src/features/achievement/AchievementTypes';\n\nimport EditableGoalUuids from './achievementSettings/EditableGoalUuids';\nimport EditablePosition from './achievementSettings/EditablePosition';\nimport EditablePrerequisiteUuids from './achievementSettings/EditablePrerequisiteUuids';\n\ntype AchievementSettingsProps = {\n  changeCardBackground: (cardBackground: string) => void;\n  changeGoalUuids: (goalUuids: string[]) => void;\n  changePosition: (position: number) => void;\n  changePrerequisiteUuids: (prerequisiteUuids: string[]) => void;\n  changeIsVariableXp: () => void;\n  editableAchievement: AchievementItem;\n};\n\nfunction AchievementSettings(props: AchievementSettingsProps) {\n  const {\n    changeCardBackground,\n    changeGoalUuids,\n    changePosition,\n    changePrerequisiteUuids,\n    changeIsVariableXp,\n    editableAchievement\n  } = props;\n  const { uuid, cardBackground, goalUuids, position, prerequisiteUuids, isVariableXp } =\n    editableAchievement;\n\n  const [isOpen, setOpen] = useState<boolean>(false);\n  const toggleOpen = () => setOpen(!isOpen);\n\n  return (\n    <>\n      <Tooltip2 content=\"More Settings\">\n        <Button icon={IconNames.WRENCH} onClick={toggleOpen} />\n      </Tooltip2>\n\n      <Dialog title=\"More Settings\" icon={IconNames.WRENCH} isOpen={isOpen} onClose={toggleOpen}>\n        <div style={{ padding: '0 0.5em' }}>\n          <h3>Card Background</h3>\n          <EditableText\n            multiline={true}\n            onChange={changeCardBackground}\n            placeholder=\"Enter card background URL here\"\n            value={cardBackground}\n          />\n          <h3>Position</h3>\n          <p>Note: Select position 0 to hide achievement</p>\n          <EditablePosition changePosition={changePosition} position={position} />\n          <h3>Prerequisites</h3>\n          <EditablePrerequisiteUuids\n            changePrerequisiteUuids={changePrerequisiteUuids}\n            uuid={uuid}\n            prerequisiteUuids={prerequisiteUuids}\n          />\n          <h3>Goals</h3>\n          <EditableGoalUuids changeGoalUuids={changeGoalUuids} goalUuids={goalUuids} />\n\n          <h3>Variable XP</h3>\n          <Checkbox\n            label={\"The rewarded XP will be equal to the sum of 'count' of goals\"}\n            checked={isVariableXp}\n            onChange={changeIsVariableXp}\n          />\n        </div>\n      </Dialog>\n    </>\n  );\n}\n\nexport default AchievementSettings;\n","import { Button } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { showSuccessMessage } from 'src/commons/utils/NotificationsHelper';\n\ntype AchievementUuidCopierProps = {\n  uuid: string;\n};\n\nfunction AchievmenetUuidCopier(props: AchievementUuidCopierProps) {\n  const { uuid } = props;\n\n  const hoverText = 'Click to copy achievement UUID';\n  const copy = () => {\n    navigator.clipboard.writeText(uuid);\n    showSuccessMessage('UUID copied to clipboard');\n  };\n\n  return (\n    <>\n      <Tooltip2 content={hoverText}>\n        <Button icon={IconNames.CLIPBOARD} onClick={copy} />\n      </Tooltip2>\n    </>\n  );\n}\n\nexport default AchievmenetUuidCopier;\n","import { AchievementItem, AchievementView } from 'src/features/achievement/AchievementTypes';\n\nexport enum EditableCardActionType {\n  CHANGE_CARD_BACKGROUND = 'CHANGE_CARD_BACKGROUND',\n  CHANGE_DEADLINE = 'CHANGE_DEADLINE',\n  CHANGE_GOAL_UUIDS = 'CHANGE_GOAL_UUIDS',\n  CHANGE_POSITION = 'CHANGE_POSITION',\n  CHANGE_PREREQUISITE_UUIDS = 'CHANGE_PREREQUISITE_UUIDS',\n  CHANGE_RELEASE = 'CHANGE_RELEASE',\n  CHANGE_TITLE = 'CHANGE_TITLE',\n  CHANGE_IS_VARIABLE_XP = 'CHANGE_VARIABLE_XP',\n  CHANGE_VIEW = 'CHANGE_VIEW',\n  CHANGE_XP = 'CHANGE_XP',\n  DELETE_ACHIEVEMENT = 'DELETE_ACHIEVEMENT',\n  DISCARD_CHANGES = 'DISCARD_CHANGES',\n  SAVE_CHANGES = 'SAVE_CHANGES'\n}\n\nexport type EditableCardAction =\n  | {\n      type: EditableCardActionType.CHANGE_CARD_BACKGROUND;\n      payload: string;\n    }\n  | {\n      type: EditableCardActionType.CHANGE_DEADLINE;\n      payload: Date | undefined;\n    }\n  | {\n      type: EditableCardActionType.CHANGE_GOAL_UUIDS;\n      payload: string[];\n    }\n  | {\n      type: EditableCardActionType.CHANGE_POSITION;\n      payload: number;\n    }\n  | {\n      type: EditableCardActionType.CHANGE_PREREQUISITE_UUIDS;\n      payload: string[];\n    }\n  | {\n      type: EditableCardActionType.CHANGE_RELEASE;\n      payload: Date | undefined;\n    }\n  | {\n      type: EditableCardActionType.CHANGE_TITLE;\n      payload: string;\n    }\n  | {\n      type: EditableCardActionType.CHANGE_IS_VARIABLE_XP;\n    }\n  | {\n      type: EditableCardActionType.CHANGE_VIEW;\n      payload: AchievementView;\n    }\n  | {\n      type: EditableCardActionType.CHANGE_XP;\n      payload: number;\n    }\n  | {\n      type: EditableCardActionType.DELETE_ACHIEVEMENT;\n    }\n  | {\n      type: EditableCardActionType.DISCARD_CHANGES;\n      payload: AchievementItem;\n    }\n  | {\n      type: EditableCardActionType.SAVE_CHANGES;\n    };\n\nexport type EditableCardState = {\n  editableAchievement: AchievementItem;\n  isDirty: boolean;\n};\n","import { Button, Dialog } from '@blueprintjs/core';\nimport { DatePicker } from '@blueprintjs/datetime';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { useState } from 'react';\nimport { prettifyDate } from 'src/commons/achievement/utils/DateHelper';\n\ntype EditableDateProps = {\n  type: string;\n  date?: Date;\n  changeDate: (date?: Date) => void;\n};\n\nfunction EditableDate(props: EditableDateProps) {\n  const { type, date, changeDate } = props;\n\n  const [isOpen, setOpen] = useState<boolean>(false);\n  const toggleOpen = () => setOpen(!isOpen);\n\n  const hoverText = date === undefined ? `No ${type}` : `${prettifyDate(date)}`;\n\n  return (\n    <>\n      <Tooltip2 content={hoverText}>\n        <Button minimal={true} onClick={toggleOpen} outlined={true}>{`${type}`}</Button>\n      </Tooltip2>\n      <Dialog\n        isCloseButtonShown={false}\n        isOpen={isOpen}\n        onClose={toggleOpen}\n        style={{\n          background: '#fff',\n          maxWidth: 'max-content',\n          padding: '0.25em',\n          textAlign: 'center'\n        }}\n        title={`${type}`}\n      >\n        <DatePicker\n          onChange={changeDate}\n          timePickerProps={{ showArrowButtons: true }}\n          value={date}\n        />\n        <Button onClick={() => changeDate(undefined)} text={`Remove ${type}`} />\n      </Dialog>\n    </>\n  );\n}\n\nexport default EditableDate;\n","import { Button, Dialog, EditableText } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { useState } from 'react';\nimport { AchievementView } from 'src/features/achievement/AchievementTypes';\ntype EditableViewProps = {\n  changeView: (view: AchievementView) => void;\n  view: AchievementView;\n};\n\nfunction EditableView(props: EditableViewProps) {\n  const { changeView, view } = props;\n  const { coverImage, description, completionText } = view;\n\n  const [isOpen, setOpen] = useState<boolean>(false);\n  const toggleOpen = () => setOpen(!isOpen);\n\n  const changeCoverImage = (coverImage: string) => changeView({ ...view, coverImage });\n\n  const changeDescription = (description: string) =>\n    changeView({ ...view, description: description });\n\n  const changeCompletionText = (completionText: string) =>\n    changeView({ ...view, completionText: completionText });\n\n  return (\n    <>\n      <Tooltip2 content=\"Edit View\">\n        <Button icon={IconNames.WIDGET_HEADER} onClick={toggleOpen} />\n      </Tooltip2>\n\n      <Dialog title=\"Edit View\" icon={IconNames.WIDGET_HEADER} isOpen={isOpen} onClose={toggleOpen}>\n        <div style={{ padding: '0 0.5em' }}>\n          <h3>Cover Image</h3>\n          <EditableText\n            multiline={true}\n            onChange={changeCoverImage}\n            placeholder=\"Enter cover image URL here\"\n            value={coverImage}\n          />\n          <h3>Description</h3>\n          <EditableText\n            multiline={true}\n            onChange={changeDescription}\n            placeholder=\"Enter description here\"\n            value={description}\n          />\n          <h3>Completion Text</h3>\n          <EditableText\n            multiline={true}\n            onChange={changeCompletionText}\n            placeholder=\"Enter completion text here\"\n            value={completionText}\n          />\n        </div>\n      </Dialog>\n    </>\n  );\n}\n\nexport default EditableView;\n","import { EditableText, NumericInput } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { cloneDeep } from 'lodash';\nimport { useContext, useMemo, useReducer, useState } from 'react';\n\nimport { AchievementContext } from '../../../../features/achievement/AchievementConstants';\nimport {\n  AchievementItem,\n  AchievementView\n} from '../../../../features/achievement/AchievementTypes';\nimport ItemDeleter from '../common/ItemDeleter';\nimport ItemSaver from '../common/ItemSaver';\nimport AchievementSettings from './AchievementSettings';\nimport AchievementUuidCopier from './AchievementUuidCopier';\nimport {\n  EditableCardAction as Action,\n  EditableCardActionType as ActionType,\n  EditableCardState as State\n} from './EditableCardTypes';\nimport EditableDate from './EditableDate';\nimport EditableView from './EditableView';\n\ntype EditableCardProps = {\n  uuid: string;\n  isNewAchievement: boolean;\n  releaseUuid: () => void;\n  removeCard: (uuid: string) => void;\n  requestPublish: () => void;\n};\n\nconst init = (achievement: AchievementItem): State => {\n  return {\n    editableAchievement: achievement,\n    isDirty: false\n  };\n};\n\nconst reducer = (state: State, action: Action) => {\n  switch (action.type) {\n    case ActionType.SAVE_CHANGES:\n      return {\n        ...state,\n        isDirty: false\n      };\n    case ActionType.DISCARD_CHANGES:\n      return init(action.payload);\n    case ActionType.DELETE_ACHIEVEMENT:\n      return {\n        ...state,\n        isDirty: false\n      };\n    case ActionType.CHANGE_CARD_BACKGROUND:\n      return {\n        editableAchievement: {\n          ...state.editableAchievement,\n          cardBackground: action.payload\n        },\n        isDirty: true\n      };\n    case ActionType.CHANGE_DEADLINE:\n      return {\n        editableAchievement: {\n          ...state.editableAchievement,\n          deadline: action.payload\n        },\n        isDirty: true\n      };\n    case ActionType.CHANGE_GOAL_UUIDS:\n      return {\n        editableAchievement: {\n          ...state.editableAchievement,\n          goalUuids: action.payload\n        },\n        isDirty: true\n      };\n    case ActionType.CHANGE_POSITION:\n      return {\n        editableAchievement: {\n          ...state.editableAchievement,\n          isTask: action.payload !== 0,\n          position: action.payload\n        },\n        isDirty: true\n      };\n    case ActionType.CHANGE_PREREQUISITE_UUIDS:\n      return {\n        editableAchievement: {\n          ...state.editableAchievement,\n          prerequisiteUuids: action.payload\n        },\n        isDirty: true\n      };\n    case ActionType.CHANGE_RELEASE:\n      return {\n        editableAchievement: {\n          ...state.editableAchievement,\n          release: action.payload\n        },\n        isDirty: true\n      };\n    case ActionType.CHANGE_TITLE:\n      return {\n        editableAchievement: {\n          ...state.editableAchievement,\n          title: action.payload\n        },\n        isDirty: true\n      };\n    case ActionType.CHANGE_VIEW:\n      return {\n        editableAchievement: {\n          ...state.editableAchievement,\n          view: action.payload\n        },\n        isDirty: true\n      };\n    case ActionType.CHANGE_XP:\n      return {\n        editableAchievement: {\n          ...state.editableAchievement,\n          xp: action.payload\n        },\n        isDirty: true\n      };\n    case ActionType.CHANGE_IS_VARIABLE_XP:\n      return {\n        editableAchievement: {\n          ...state.editableAchievement,\n          isVariableXp: !state.editableAchievement.isVariableXp\n        },\n        isDirty: true\n      };\n    default:\n      return state;\n  }\n};\n\nfunction EditableCard(props: EditableCardProps) {\n  const { uuid, isNewAchievement, releaseUuid, removeCard, requestPublish } = props;\n\n  const inferencer = useContext(AchievementContext);\n  const achievement = inferencer.getAchievement(uuid);\n  const achievementClone = useMemo(() => cloneDeep(achievement), [achievement]);\n\n  const [state, dispatch] = useReducer(reducer, achievementClone, init);\n  const [isNew, setIsNew] = useState<boolean>(isNewAchievement);\n  const { editableAchievement, isDirty } = state;\n  const { cardBackground, deadline, release, title, view, xp } = editableAchievement;\n\n  const saveChanges = () => {\n    dispatch({ type: ActionType.SAVE_CHANGES });\n    inferencer.modifyAchievement(editableAchievement);\n    if (isNew) {\n      releaseUuid();\n      setIsNew(false);\n    }\n    requestPublish();\n  };\n\n  const discardChanges = () =>\n    dispatch({ type: ActionType.DISCARD_CHANGES, payload: achievementClone });\n\n  const deleteAchievement = () => {\n    dispatch({ type: ActionType.DELETE_ACHIEVEMENT });\n    inferencer.removeAchievement(uuid);\n    if (isNew) {\n      releaseUuid();\n      setIsNew(false);\n    }\n    removeCard(uuid);\n    requestPublish();\n  };\n\n  const changeCardBackground = (cardBackground: string) =>\n    dispatch({ type: ActionType.CHANGE_CARD_BACKGROUND, payload: cardBackground });\n\n  const changeDeadline = (deadline?: Date) =>\n    dispatch({ type: ActionType.CHANGE_DEADLINE, payload: deadline });\n\n  const changeGoalUuids = (goalUuids: string[]) => {\n    dispatch({ type: ActionType.CHANGE_GOAL_UUIDS, payload: goalUuids });\n  };\n\n  const changePosition = (position: number) =>\n    dispatch({ type: ActionType.CHANGE_POSITION, payload: position });\n\n  const changePrerequisiteUuids = (prerequisiteUuids: string[]) =>\n    dispatch({ type: ActionType.CHANGE_PREREQUISITE_UUIDS, payload: prerequisiteUuids });\n\n  const changeRelease = (release?: Date) =>\n    dispatch({ type: ActionType.CHANGE_RELEASE, payload: release });\n\n  const changeTitle = (title: string) =>\n    dispatch({ type: ActionType.CHANGE_TITLE, payload: title });\n\n  const changeView = (view: AchievementView) =>\n    dispatch({ type: ActionType.CHANGE_VIEW, payload: view });\n\n  const changeXp = (xp: number) => dispatch({ type: ActionType.CHANGE_XP, payload: xp });\n\n  const changeIsVariableXp = () => dispatch({ type: ActionType.CHANGE_IS_VARIABLE_XP });\n\n  return (\n    <li\n      className=\"editable-card\"\n      style={{\n        background: `url(${cardBackground}) center/cover`\n      }}\n    >\n      <div className=\"action-button\">\n        {isDirty ? (\n          <ItemSaver discardChanges={discardChanges} saveChanges={saveChanges} />\n        ) : (\n          <ItemDeleter deleteItem={deleteAchievement} item={title} />\n        )}\n      </div>\n\n      <div className=\"content\">\n        <h3 className=\"title\">\n          <EditableText onChange={changeTitle} placeholder=\"Enter your title here\" value={title} />\n        </h3>\n        <div className=\"xp\">\n          <Tooltip2 content=\"XP\">\n            <NumericInput\n              value={xp}\n              min={0}\n              allowNumericCharactersOnly={true}\n              leftIcon={IconNames.TRENDING_UP}\n              placeholder=\"XP\"\n              onValueChange={changeXp}\n            />\n          </Tooltip2>\n        </div>\n        <div className=\"details\">\n          <EditableDate changeDate={changeRelease} date={release} type=\"Release\" />\n          <EditableDate changeDate={changeDeadline} date={deadline} type=\"Deadline\" />\n          <AchievementUuidCopier uuid={uuid} />\n        </div>\n      </div>\n\n      <div className=\"content-button\">\n        <EditableView changeView={changeView} view={view} />\n        <AchievementSettings\n          changeCardBackground={changeCardBackground}\n          changeGoalUuids={changeGoalUuids}\n          changePosition={changePosition}\n          changePrerequisiteUuids={changePrerequisiteUuids}\n          changeIsVariableXp={changeIsVariableXp}\n          editableAchievement={editableAchievement}\n        />\n      </div>\n    </li>\n  );\n}\n\nexport default EditableCard;\n","import { useContext, useState } from 'react';\nimport { AchievementContext } from 'src/features/achievement/AchievementConstants';\n\nimport AchievementAdder from './achievementEditor/AchievementAdder';\nimport EditableCard from './achievementEditor/EditableCard';\n\ntype AchievementEditorProps = {\n  requestPublish: () => void;\n};\n\nlet editableCards: JSX.Element[] = [];\n\nfunction AchievementEditor(props: AchievementEditorProps) {\n  const { requestPublish } = props;\n\n  const inferencer = useContext(AchievementContext);\n\n  /**\n   * newUuid helps us to ensure that only ONE achievement is added at any point of time.\n   *\n   * By default,  the newUuid is an empty string, which means currently no new achievement\n   * is being added and the admin is able to add a new achievement.\n   *\n   * Conversely, if the newUuid is not an empty string, this means currently an achievement\n   * is being added to the system and the admin is not allowed to add two achievements\n   * at one go. The newUuid holds the newly created achievement uuid until the new achievement\n   * is added into the inferencer.\n   */\n  const [newUuid, setNewUuid] = useState<string>('');\n  const allowNewUuid = newUuid === '';\n  const releaseUuid = () => setNewUuid('');\n\n  const removeCard = (uuid: string) => {\n    let idx = 0;\n    while (editableCards[idx].key !== uuid && idx < editableCards.length) {\n      idx++;\n    }\n    editableCards.splice(idx, 1);\n  };\n\n  const generateEditableCard = (achievementUuid: string, isNewAchievement: boolean) => (\n    <EditableCard\n      key={achievementUuid}\n      uuid={achievementUuid}\n      isNewAchievement={isNewAchievement}\n      releaseUuid={releaseUuid}\n      removeCard={removeCard}\n      requestPublish={requestPublish}\n    />\n  );\n\n  // load preexisting achievements from the inferencer\n  if (editableCards.length === 0) {\n    editableCards = inferencer\n      .listSortedAchievementUuids()\n      .map(uuid => generateEditableCard(uuid, false));\n  }\n\n  const addNewAchievement = (uuid: string) => {\n    setNewUuid(uuid);\n    // keep the new achievement on top by swapping it with the first achievement\n    editableCards[editableCards.length] = editableCards[0];\n    editableCards[0] = generateEditableCard(uuid, true);\n  };\n\n  return (\n    <div className=\"achievement-editor\">\n      <div className=\"command\">\n        <AchievementAdder allowNewUuid={allowNewUuid} setNewUuid={addNewAchievement} />\n      </div>\n      <ul className=\"achievement-container\">{editableCards}</ul>\n    </div>\n  );\n}\n\nexport default AchievementEditor;\n","import { Icon, IconName } from '@blueprintjs/core';\n\nimport { getFilterColor } from '../../features/achievement/AchievementConstants';\nimport { FilterStatus } from '../../features/achievement/AchievementTypes';\n\ntype AchievementFilterProps = {\n  filterState: [FilterStatus, any];\n  icon: IconName;\n  ownStatus: FilterStatus;\n};\n\nfunction AchievementFilter(props: AchievementFilterProps) {\n  const { filterState, icon, ownStatus } = props;\n\n  const [globalStatus, setGlobalStatus] = filterState;\n\n  return (\n    <div\n      className=\"filter\"\n      onClick={() => setGlobalStatus(ownStatus)}\n      style={{ color: getFilterColor(globalStatus, ownStatus) }}\n    >\n      <Icon icon={icon} iconSize={30} />\n      <p>{ownStatus}</p>\n    </div>\n  );\n}\n\nexport default AchievementFilter;\n","import Constants from '../../utils/Constants';\n\ntype AchievementMilestoneProps = {\n  studentXp: number;\n};\n\n// 36k XP = Level 37\nfunction AchievementMilestone(props: AchievementMilestoneProps) {\n  const { studentXp } = props;\n\n  return (\n    <div className=\"milestone\">\n      <h3>Your Total XP</h3>\n      <div className=\"user-xp\">{studentXp} XP</div>\n\n      <h3>CA Achievement Level</h3>\n      <div className=\"details\">\n        <div className=\"level-badge\">\n          <span className=\"level-icon\" />\n          <p>{Constants.caFulfillmentLevel}</p>\n        </div>\n        <p className=\"description\">Complete CS1101S CA Component</p>\n      </div>\n      <div className=\"details\">\n        <div className=\"level-badge\">\n          <span className=\"level-icon\" />\n          <p>{Constants.caFulfillmentLevel}+</p>\n        </div>\n        <p className=\"description\">Counts towards CS1010R</p>\n      </div>\n      <div className=\"footer\">\n        <p>Full CA level of {Constants.caFulfillmentLevel} is subjected to change.</p>\n      </div>\n    </div>\n  );\n}\n\nexport default AchievementMilestone;\n","import { ProgressBar } from '@blueprintjs/core';\nimport { useState } from 'react';\n\nimport { xpPerLevel } from '../../../features/achievement/AchievementConstants';\nimport Constants from '../../utils/Constants';\nimport AchievementMilestone from './AchievementMilestone';\n\ntype AchievementLevelProps = {\n  studentXp: number;\n};\n\nfunction AchievementLevel(props: AchievementLevelProps) {\n  const { studentXp } = props;\n\n  const [showMilestone, setShowMilestone] = useState<boolean>(false);\n  const displayMilestone = () => setShowMilestone(true);\n  const hideMilestone = () => setShowMilestone(false);\n\n  // start at level 1\n  const level = Math.floor(studentXp / xpPerLevel) + 1;\n  const progress = studentXp % xpPerLevel;\n  const progressFrac = progress / xpPerLevel;\n\n  return (\n    <div className=\"level\" onMouseEnter={displayMilestone} onMouseLeave={hideMilestone}>\n      <div className=\"level-badge\">\n        <span className=\"level-icon\" />\n        <p>{`Level ${level}`}</p>\n      </div>\n      <span className=\"level-progress\">\n        <ProgressBar\n          animate={false}\n          className=\"progress-bar\"\n          stripes={false}\n          value={progressFrac}\n        />\n        <p>\n          {progress} / {xpPerLevel} XP\n        </p>\n      </span>\n      {Constants.caFulfillmentLevel !== 0 && showMilestone && (\n        <AchievementMilestone studentXp={studentXp} />\n      )}\n    </div>\n  );\n}\n\nexport default AchievementLevel;\n","import { useEffect } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { AchievementUser } from 'src/features/achievement/AchievementTypes';\n\nimport { FETCH_TOTAL_XP, FETCH_TOTAL_XP_ADMIN } from '../application/types/SessionTypes';\nimport { useTypedSelector } from '../utils/Hooks';\nimport AchievementLevel from './overview/AchievementLevel';\n\ntype AchievementOverviewProps = {\n  name: string;\n  userState: [AchievementUser | undefined, any];\n};\n\nfunction AchievementOverview(props: AchievementOverviewProps) {\n  const { name, userState } = props;\n  const [selectedUser] = userState;\n  const crid = selectedUser?.courseRegId;\n  const userCrid = useTypedSelector(store => store.session.courseRegId);\n\n  const dispatch = useDispatch();\n  useEffect(() => {\n    // If user is student, fetch assessment details from assessment route instead, as seen below\n    if (crid && crid !== userCrid) {\n      dispatch({ type: FETCH_TOTAL_XP_ADMIN, payload: crid });\n    } else {\n      dispatch({ type: FETCH_TOTAL_XP });\n    }\n  }, [crid, userCrid, dispatch]);\n\n  const studentXp = useTypedSelector(store => store.session.xp);\n\n  return (\n    <div className=\"achievement-overview\">\n      <AchievementLevel studentXp={studentXp} />\n      <h3>{name}</h3>\n    </div>\n  );\n}\n\nexport default AchievementOverview;\n","import { Icon } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\n\nimport { DeadlineColors } from '../../../features/achievement/AchievementConstants';\nimport { isExpired, prettifyDeadline, timeFromExpired } from '../utils/DateHelper';\n\ntype AchievementDeadlineProps = {\n  deadline?: Date;\n};\n\nconst twoDays = new Date(0, 0, 2).getTime() - new Date(0, 0, 0).getTime();\n\nfunction AchievementDeadline(props: AchievementDeadlineProps) {\n  const { deadline } = props;\n\n  // red deadline color for core achievements that are expiring in less than 2 days\n  const deadlineColor =\n    deadline !== undefined && !isExpired(deadline) && timeFromExpired(deadline) <= twoDays\n      ? DeadlineColors.RED\n      : DeadlineColors.BLACK;\n\n  return (\n    <div className=\"deadline\">\n      <Icon color={deadlineColor} icon={IconNames.STOPWATCH} />\n      <p style={{ color: deadlineColor }}>{prettifyDeadline(deadline)}</p>\n    </div>\n  );\n}\n\nexport default AchievementDeadline;\n","import { Icon } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\n\ntype AchievementXpProps = {\n  isBonus: boolean;\n  xp: number;\n};\n\nconst stringifyXp = (xp: number, isBonus: boolean) => {\n  return (isBonus ? 'Total ' : '') + xp + ' XP';\n};\n\nfunction AchievementXp(props: AchievementXpProps) {\n  const { isBonus, xp } = props;\n\n  return (\n    <div className=\"xp\">\n      {xp !== 0 && (\n        <>\n          <Icon icon={IconNames.BANK_ACCOUNT} />\n          <p>{stringifyXp(xp, isBonus)}</p>\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default AchievementXp;\n","import { Icon, Intent, ProgressBar } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { useContext } from 'react';\nimport { AchievementContext, handleGlow } from 'src/features/achievement/AchievementConstants';\n\nimport { AchievementStatus } from '../../features/achievement/AchievementTypes';\nimport AchievementDeadline from './card/AchievementDeadline';\nimport AchievementXp from './card/AchievementXp';\n\ntype AchievementCardProps = {\n  uuid: string;\n  focusState: [string, any];\n  isDropdownOpen?: boolean;\n  shouldRender: boolean;\n  toggleDropdown?: () => void;\n};\n\nfunction AchievementCard(props: AchievementCardProps) {\n  const { uuid, focusState, isDropdownOpen, shouldRender, toggleDropdown } = props;\n\n  const inferencer = useContext(AchievementContext);\n\n  const [focusUuid, setFocusUuid] = focusState;\n\n  const { cardBackground, title } = inferencer.getAchievement(uuid);\n  const displayDeadline = inferencer.getDisplayDeadline(uuid);\n  const displayXp = inferencer.getDescendantXp(uuid);\n  const progressFrac = inferencer.getProgressFrac(uuid);\n  const status = inferencer.getStatus(uuid);\n\n  // Only task card with prerequisites has dropdown button\n  const hasDropdown =\n    isDropdownOpen !== undefined && inferencer.getImmediateChildren(uuid).size !== 0;\n\n  return (\n    <div\n      className=\"achievement-card\"\n      onClick={() => setFocusUuid(uuid)}\n      onClickCapture={toggleDropdown}\n      style={{\n        ...handleGlow(uuid, focusUuid),\n        opacity: shouldRender ? '100%' : '20%',\n        background: `url(${cardBackground}) center/cover`\n      }}\n    >\n      <div className=\"dropdown-button\">\n        {hasDropdown && (\n          <Icon icon={isDropdownOpen ? IconNames.CARET_DOWN : IconNames.CARET_RIGHT} />\n        )}\n      </div>\n\n      <div className=\"content\">\n        <div className=\"heading\">\n          <h3>{title.toUpperCase()}</h3>\n          {status === AchievementStatus.COMPLETED && (\n            <Icon icon={IconNames.CONFIRM} intent={Intent.SUCCESS} style={{ padding: '1em' }} />\n          )}\n        </div>\n\n        <div className=\"details\">\n          <AchievementDeadline deadline={displayDeadline} />\n          <AchievementXp isBonus={hasDropdown} xp={displayXp} />\n        </div>\n\n        <ProgressBar\n          animate={false}\n          className=\"progress\"\n          intent={progressFrac === 1 ? 'success' : 'primary'}\n          stripes={false}\n          value={progressFrac}\n        />\n      </div>\n    </div>\n  );\n}\n\nexport default AchievementCard;\n","import { Collapse } from '@blueprintjs/core';\nimport React, { useContext, useState } from 'react';\n\nimport {\n  AchievementContext,\n  getAbilityColor\n} from '../../features/achievement/AchievementConstants';\nimport { AchievementStatus, FilterStatus } from '../../features/achievement/AchievementTypes';\nimport AchievementCard from './AchievementCard';\n\ntype AchievementTaskProps = {\n  uuid: string;\n  filterStatus: FilterStatus;\n  focusState: [string, any];\n};\n\nconst AchievementTask: React.FC<AchievementTaskProps> = ({ uuid, filterStatus, focusState }) => {\n  const inferencer = useContext(AchievementContext);\n  const prerequisiteUuids = [...inferencer.getImmediateChildren(uuid)];\n  const taskColor = getAbilityColor();\n\n  const [isDropdownOpen, setIsDropdownOpen] = useState<boolean>(false);\n  const toggleDropdown = () => setIsDropdownOpen(!isDropdownOpen);\n\n  /**\n   * Checks whether the AchievementItem (can be a task or prereq) should be rendered\n   * based on the achievement dashboard filterStatus.\n   */\n  const isInFilter = (uuid: string): boolean => {\n    const status = inferencer.getStatus(uuid);\n\n    switch (filterStatus) {\n      case FilterStatus.ALL:\n        return true;\n      case FilterStatus.ACTIVE:\n        return status === AchievementStatus.ACTIVE;\n      case FilterStatus.COMPLETED:\n        return status === AchievementStatus.COMPLETED;\n      default:\n        return false;\n    }\n  };\n\n  /**\n   * Checks whether the AchievementItem (can be a task or prereq) should be rendered\n   * based on the achievement dashboard filterStatus and whether it is a prereq.\n   */\n  const shouldRender = (uuid: string): boolean => {\n    const isPrerequisite = inferencer.isPrerequisite(uuid);\n\n    return !isPrerequisite && isInFilter(uuid);\n  };\n\n  /**\n   * Checks whether the AchievementItem has any prerequisite that\n   * should be rendered based on the achievement dashboard filterStatus.\n   *\n   * If there is at least 1 prerequisite that needs to be rendered,\n   * the whole AchievementTask will be rendered together.\n   */\n  const shouldRenderPrerequisites = (uuid: string) => {\n    const children = [...inferencer.getImmediateChildren(uuid)];\n    return children.reduce((canRender, prerequisite) => {\n      return canRender || isInFilter(prerequisite);\n    }, false);\n  };\n\n  /**\n   * If the main achievement or any of the prerequisites need to be rendered,\n   * the whole achievement task will be rendered\n   */\n  const shouldRenderTask = (uuid: string) => shouldRender(uuid) || shouldRenderPrerequisites(uuid);\n\n  return (\n    <>\n      {shouldRenderTask(uuid) && (\n        <li className=\"task\">\n          <AchievementCard\n            uuid={uuid}\n            focusState={focusState}\n            isDropdownOpen={isDropdownOpen}\n            shouldRender={isInFilter(uuid)}\n            toggleDropdown={toggleDropdown}\n          />\n          <Collapse isOpen={isDropdownOpen} keepChildrenMounted={true}>\n            <div className=\"prerequisite-container\">\n              {prerequisiteUuids.map(prerequisiteUuid => (\n                <div className=\"prerequisite\" key={prerequisiteUuid}>\n                  <div\n                    className=\"dropdown-lines\"\n                    style={{\n                      borderBottom: `1px solid ${taskColor}`,\n                      borderLeft: `1px solid ${taskColor}`\n                    }}\n                  ></div>\n                  <AchievementCard\n                    uuid={prerequisiteUuid}\n                    focusState={focusState}\n                    shouldRender={isInFilter(prerequisiteUuid)}\n                  />\n                </div>\n              ))}\n            </div>\n          </Collapse>\n        </li>\n      )}\n    </>\n  );\n};\n\nexport default AchievementTask;\n","import { useMemo } from 'react';\n\nimport { Assessment } from '../assessment/AssessmentTypes';\nimport { history } from '../utils/HistoryHelper';\nimport { useTypedSelector } from '../utils/Hooks';\nimport { showWarningMessage } from '../utils/NotificationsHelper';\nimport { assessmentTypeLink } from '../utils/ParamParseHelper';\n\nconst AchievementCommentCard = ({\n  assessment,\n  showToQuestion\n}: {\n  assessment: Assessment;\n  showToQuestion: boolean;\n}) => {\n  const courseId = useTypedSelector(store => store.session.courseId);\n  const toMission = useMemo(\n    () => (questionId: number) => {\n      if (!courseId) {\n        showWarningMessage('Course ID not found');\n        return;\n      }\n\n      const listingPath = `/courses/${courseId}/${assessmentTypeLink(assessment?.type)}`;\n      const assessmentWorkspacePath = listingPath + `/${assessment?.id.toString()}`;\n      history.push(assessmentWorkspacePath + `/${questionId}`);\n    },\n    [assessment?.id, assessment?.type, courseId]\n  );\n\n  return (\n    <div>\n      <h1 className=\"assessment-feedback\">Feedback</h1>\n      <div className=\"feedback-list\">\n        {assessment &&\n          assessment.questions.map((question, index) => (\n            <div className=\"assessment-comments\" key={index}>\n              <span>\n                <h2 className=\"question-header\">{'Q' + (index + 1)}</h2>\n              </span>\n\n              <div className=\"box-comment\">\n                <p>{question.comments === null ? 'No Comments' : question.comments}</p>\n                <p className=\"xp\">{'XP: ' + question.xp + '/' + question.maxXp}</p>\n              </div>\n\n              {showToQuestion && (\n                <button className=\"to-assessment-button\" onClick={() => toMission(index)}>\n                  {'To Question'}\n                </button>\n              )}\n            </div>\n          ))}\n      </div>\n    </div>\n  );\n};\n\nexport default AchievementCommentCard;\n","type AchievementViewCompletionProps = {\n  awardedXp: number;\n  completionText: string;\n};\n\nfunction AchievementViewCompletion(props: AchievementViewCompletionProps) {\n  const { awardedXp, completionText } = props;\n\n  const paragraphs = completionText ? completionText.split('\\n') : [''];\n\n  return (\n    <div className=\"completion\">\n      {awardedXp > 0 && <h1>{`AWARDED ${awardedXp}XP`}</h1>}\n      {paragraphs.map((para, idx) => (\n        <p key={idx}>\n          {para}\n          <br />\n        </p>\n      ))}\n    </div>\n  );\n}\n\nexport default AchievementViewCompletion;\n","import { ProgressBar } from '@blueprintjs/core';\n\nimport { AchievementGoal } from '../../../features/achievement/AchievementTypes';\n\ntype AchievementViewGoalProps = {\n  goals: AchievementGoal[];\n};\n\n/**\n * Maps an array of goalUuid to Goal component\n *\n * @param goal an array of goalUuid\n */\nconst mapGoalToJSX = (goal: AchievementGoal) => {\n  const { uuid, text, targetCount, count, completed } = goal;\n  const frac = Math.min(targetCount === 0 ? 0 : count / targetCount, 1);\n  return (\n    <div className=\"goal\" key={uuid}>\n      <div className=\"goal-badge\">\n        <span className=\"goal-icon\" />\n        <p>\n          {count} / {targetCount}\n        </p>\n      </div>\n      <div className=\"goal-progress\">\n        <p>{text}</p>\n        <ProgressBar\n          animate={false}\n          className=\"progress\"\n          intent={completed ? 'success' : undefined}\n          stripes={false}\n          value={frac}\n        />\n      </div>\n    </div>\n  );\n};\n\nfunction AchievementViewGoal(props: AchievementViewGoalProps) {\n  const { goals } = props;\n\n  return (\n    <>\n      <h1 className=\"progress-header\">Progress</h1>\n      {goals.map(goal => mapGoalToJSX(goal))}\n    </>\n  );\n}\n\nexport default AchievementViewGoal;\n","import { Icon } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { useContext, useEffect } from 'react';\nimport { useDispatch } from 'react-redux';\n\nimport {\n  AchievementContext,\n  getAbilityBackground,\n  getAbilityGlow\n} from '../../features/achievement/AchievementConstants';\nimport { AchievementStatus, AchievementUser } from '../../features/achievement/AchievementTypes';\nimport { FETCH_ASSESSMENT, FETCH_ASSESSMENT_ADMIN } from '../application/types/SessionTypes';\nimport { FETCH_ASSESSMENT_OVERVIEWS } from '../assessment/AssessmentTypes';\nimport { Assessment } from '../assessment/AssessmentTypes';\nimport { useTypedSelector } from '../utils/Hooks';\nimport AchievementCommentCard from './AchievementCommentCard';\nimport { prettifyDate } from './utils/DateHelper';\nimport AchievementViewCompletion from './view/AchievementViewCompletion';\nimport AchievementViewGoal from './view/AchievementViewGoal';\n\ntype AchievementViewProps = {\n  focusUuid: string;\n  assessments?: Map<number, Assessment>;\n  userState?: [AchievementUser | undefined, any];\n};\n\nfunction AchievementView({ focusUuid, userState }: AchievementViewProps) {\n  const assessmentId = !Number.isNaN(+focusUuid) && +focusUuid !== 0 ? +focusUuid : undefined;\n  let courseRegId: number | undefined;\n\n  if (userState) {\n    const [selectedUser] = userState!;\n    courseRegId = selectedUser?.courseRegId;\n  }\n  const userCrid = useTypedSelector(store => store.session.courseRegId);\n  const isAdminView: boolean = courseRegId !== undefined && courseRegId !== userCrid;\n\n  const dispatch = useDispatch();\n  useEffect(() => {\n    dispatch({ type: FETCH_ASSESSMENT_OVERVIEWS });\n    if (!assessmentId) {\n      return;\n    }\n    if (isAdminView) {\n      // Fetch selected user's assessment from admin route\n      dispatch({ type: FETCH_ASSESSMENT_ADMIN, payload: { assessmentId, courseRegId } });\n    } else {\n      // If user is student, fetch assessment details from assessment route instead, as seen below\n      dispatch({ type: FETCH_ASSESSMENT, payload: assessmentId });\n    }\n  }, [dispatch, assessmentId, courseRegId, isAdminView]);\n\n  const inferencer = useContext(AchievementContext);\n  const assessments = useTypedSelector(store => store.session.assessments);\n  const selectedAssessment: Assessment | undefined = assessments.get(assessmentId!);\n  const allAssessmentConfigs = useTypedSelector(store => store.session.assessmentOverviews) ?? [];\n  const selectedAssessmentConfig = allAssessmentConfigs.find(config => config.id === assessmentId);\n\n  if (focusUuid === '') {\n    return (\n      <div className=\"no-view\">\n        <Icon icon={IconNames.MOUNTAIN} iconSize={60} />\n        <h2>Select an achievement</h2>\n      </div>\n    );\n  }\n  const achievement = inferencer.getAchievement(focusUuid);\n  const { deadline, title, view } = achievement;\n  const { coverImage, completionText, description } = view;\n  const awardedXp = inferencer.getAchievementXp(focusUuid);\n  const goals = inferencer.listGoals(focusUuid);\n  const status = inferencer.getStatus(focusUuid);\n\n  const descriptionParagraphs = description ? description.split('\\n') : [''];\n\n  return (\n    <div className=\"view\" style={{ ...getAbilityGlow(), ...getAbilityBackground() }}>\n      <div\n        className=\"cover\"\n        style={{\n          background: `rgba(0, 0, 0, 0.5) url(${coverImage}) center/cover`,\n          backgroundBlendMode: `darken`\n        }}\n      >\n        <h1>{title.toUpperCase()}</h1>\n        {deadline && <p>{`Deadline: ${prettifyDate(deadline)}`}</p>}\n        <span className=\"description\">\n          {descriptionParagraphs.map((para, idx) => (\n            <p key={idx}>\n              {para}\n              <br />\n            </p>\n          ))}\n        </span>\n      </div>\n\n      {status === AchievementStatus.COMPLETED &&\n        selectedAssessment &&\n        selectedAssessmentConfig &&\n        selectedAssessmentConfig.isManuallyGraded && (\n          // TODO: showToQuestion is currently used to disable the goto question button for admins,\n          // as it has not been integrated with the grading view yet\n          <AchievementCommentCard assessment={selectedAssessment} showToQuestion={!isAdminView} />\n        )}\n\n      {goals.length > 0 && (\n        <>\n          <AchievementViewGoal goals={goals} />\n          {status === AchievementStatus.COMPLETED && (\n            <>\n              <hr />\n              <AchievementViewCompletion awardedXp={awardedXp} completionText={completionText} />\n            </>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default AchievementView;\n","import moment from 'moment';\n\nimport {\n  cardBackgroundUrl,\n  coverImageUrl\n} from '../../../features/achievement/AchievementConstants';\nimport { GoalType } from '../../../features/achievement/AchievementTypes';\nimport { AssessmentConfiguration, AssessmentOverview } from '../../assessment/AssessmentTypes';\nimport AchievementInferencer from './AchievementInferencer';\nimport { isExpired, isReleased } from './DateHelper';\n\nfunction assessmentCompleted(assessmentOverview: AssessmentOverview): boolean {\n  return (\n    assessmentOverview.gradingStatus === 'graded' ||\n    (!assessmentOverview.isManuallyGraded && assessmentOverview.status === 'submitted')\n  );\n}\n\nfunction insertFakeAchievements(\n  assessmentOverviews: AssessmentOverview[],\n  assessmentConfigs: AssessmentConfiguration[],\n  inferencer: AchievementInferencer\n) {\n  const sortedOverviews = [...assessmentOverviews].sort((overview1, overview2) =>\n    moment(overview1.closeAt).diff(moment(overview2.closeAt))\n  );\n  const length = assessmentOverviews.length;\n\n  const assessmentTypes = assessmentConfigs.map(config => config.type);\n\n  const categorisedUuids: string[][] = assessmentTypes.map(_ => []);\n\n  sortedOverviews.forEach((assessmentOverview, idx) => {\n    // Reduce clutter for achievements that cannot be earned at that point\n    if (\n      !isReleased(new Date(assessmentOverview.openAt)) ||\n      (isExpired(new Date(assessmentOverview.closeAt)) && assessmentOverview.status !== 'submitted')\n    ) {\n      return;\n    }\n    const idString = assessmentOverview.id.toString();\n\n    if (!inferencer.hasAchievement(idString)) {\n      // Goal for assessment submission\n      inferencer.insertFakeGoalDefinition(\n        {\n          uuid: idString + '0',\n          text: `Submitted ${assessmentOverview.title}`,\n          achievementUuids: [idString],\n          meta: {\n            type: GoalType.ASSESSMENT,\n            assessmentNumber: assessmentOverview.id,\n            requiredCompletionFrac: 0\n          }\n        },\n        assessmentOverview.status === 'submitted'\n      );\n\n      // goal for assessment grading\n      if (assessmentOverview.isManuallyGraded) {\n        inferencer.insertFakeGoalDefinition(\n          {\n            uuid: idString + '1',\n            text: `Graded ${assessmentOverview.title}`,\n            achievementUuids: [idString],\n            meta: {\n              type: GoalType.ASSESSMENT,\n              assessmentNumber: assessmentOverview.id,\n              requiredCompletionFrac: 0\n            }\n          },\n          assessmentOverview.gradingStatus === 'graded'\n        );\n      }\n\n      inferencer.insertFakeAchievement({\n        uuid: idString,\n        title: assessmentOverview.title,\n        xp: assessmentCompleted(assessmentOverview)\n          ? assessmentOverview.xp\n          : assessmentOverview.maxXp,\n        isVariableXp: false,\n        deadline: new Date(assessmentOverview.closeAt),\n        release: new Date(assessmentOverview.openAt),\n        isTask:\n          assessmentOverview.isPublished === undefined ? false : assessmentOverview.isPublished,\n        position: idx - length - 100, // assessment closest to expiring on top\n        prerequisiteUuids: [],\n        goalUuids: !assessmentOverview.isManuallyGraded\n          ? [idString + '0']\n          : [idString + '0', idString + '1'], // need to create a mock completed goal to reference to be considered complete\n        cardBackground: `${cardBackgroundUrl}/default.png`,\n        view: {\n          coverImage: assessmentOverview.coverImage,\n          description: assessmentOverview.shortSummary,\n          completionText: `XP: ${assessmentOverview.xp} / ${assessmentOverview.maxXp}`\n        }\n      });\n\n      // if completed, add the uuid into the appropriate array\n      if (assessmentCompleted(assessmentOverview)) {\n        assessmentTypes.forEach((type, idx) => {\n          if (type === assessmentOverview.type) {\n            categorisedUuids[idx].push(idString);\n          }\n        });\n      }\n    }\n  });\n\n  // the dropdowns appear below the incomplete assessments, in the order missions, quests, path, contests\n  // will not appear if there are no completed assessments of that type\n  categorisedUuids.forEach((uuids, idx) => {\n    const assessmentType = assessmentTypes[idx];\n    uuids.length > 0 &&\n      inferencer.insertFakeAchievement({\n        uuid: assessmentType,\n        title: 'Completed ' + assessmentType,\n        xp: 0,\n        isVariableXp: false,\n        deadline: undefined,\n        release: undefined,\n        isTask: true,\n        position: -1 - idx, // negative number to ensure that they stay on top\n        prerequisiteUuids: uuids,\n        goalUuids: [],\n        cardBackground: `${cardBackgroundUrl}/default.png`,\n        view: {\n          coverImage: `${coverImageUrl}/default.png`,\n          description: 'Your completed ' + assessmentType + ' are listed here!',\n          completionText: ''\n        }\n      });\n  });\n}\n\nexport default insertFakeAchievements;\n","import { IconNames } from '@blueprintjs/icons';\nimport { useEffect, useState } from 'react';\nimport { Role } from 'src/commons/application/ApplicationTypes';\nimport {\n  AssessmentConfiguration,\n  AssessmentOverview\n} from 'src/commons/assessment/AssessmentTypes';\n\nimport AchievementFilter from '../../../commons/achievement/AchievementFilter';\nimport AchievementManualEditor from '../../../commons/achievement/AchievementManualEditor';\nimport AchievementOverview from '../../../commons/achievement/AchievementOverview';\nimport AchievementTask from '../../../commons/achievement/AchievementTask';\nimport AchievementView from '../../../commons/achievement/AchievementView';\nimport AchievementInferencer from '../../../commons/achievement/utils/AchievementInferencer';\nimport insertFakeAchievements from '../../../commons/achievement/utils/InsertFakeAchievements';\nimport { AchievementContext } from '../../../features/achievement/AchievementConstants';\nimport {\n  AchievementUser,\n  FilterStatus,\n  GoalProgress\n} from '../../../features/achievement/AchievementTypes';\n\nexport type DispatchProps = {\n  fetchAssessmentOverviews: () => void;\n  getAchievements: () => void;\n  getGoals: (studentCourseRegId: number) => void;\n  getOwnGoals: () => void;\n  getUserAssessmentOverviews: (studentCourseRegId: number) => void;\n  getUsers: () => void;\n  updateGoalProgress: (studentCourseRegId: number, progress: GoalProgress) => void;\n};\n\nexport type StateProps = {\n  group: string | null;\n  inferencer: AchievementInferencer;\n  id?: number;\n  name?: string;\n  role?: Role;\n  assessmentConfigs?: AssessmentConfiguration[];\n  assessmentOverviews?: AssessmentOverview[];\n  achievementAssessmentOverviews: AssessmentOverview[];\n  users: AchievementUser[];\n};\n\n/**\n * Generates <AchievementTask /> components\n *\n * @param taskUuids an array of achievementUuid\n * @param filterStatus the dashboard filter status\n * @param focusState the focused achievement state\n */\nexport const generateAchievementTasks = (\n  taskUuids: string[],\n  filterStatus: FilterStatus,\n  focusState: [string, any]\n) =>\n  taskUuids.map(taskUuid => (\n    <AchievementTask\n      key={taskUuid}\n      uuid={taskUuid}\n      filterStatus={filterStatus}\n      focusState={focusState}\n    />\n  ));\n\nfunction Dashboard(props: DispatchProps & StateProps) {\n  const {\n    getAchievements,\n    getOwnGoals,\n    getGoals,\n    getUserAssessmentOverviews,\n    getUsers,\n    updateGoalProgress,\n    fetchAssessmentOverviews,\n    group,\n    inferencer,\n    name,\n    role,\n    assessmentConfigs,\n    assessmentOverviews,\n    achievementAssessmentOverviews,\n    users\n  } = props;\n\n  // default nothing selected\n  const userIdState = useState<AchievementUser | undefined>(undefined);\n  const [selectedUser] = userIdState;\n\n  /**\n   * Fetch the latest achievements and goals from backend when the page is rendered\n   */\n  useEffect(() => {\n    selectedUser ? getGoals(selectedUser.courseRegId) : getOwnGoals();\n\n    selectedUser\n      ? getUserAssessmentOverviews(selectedUser.courseRegId)\n      : fetchAssessmentOverviews();\n\n    getAchievements();\n  }, [\n    selectedUser,\n    getAchievements,\n    getGoals,\n    getOwnGoals,\n    getUserAssessmentOverviews,\n    fetchAssessmentOverviews\n  ]);\n\n  const userAssessmentOverviews = selectedUser\n    ? achievementAssessmentOverviews\n    : assessmentOverviews;\n\n  // Inserts assessment achievements for each assessment retrieved\n  // Note that assessmentConfigs is updated when the page loads (see Application.tsx)\n  userAssessmentOverviews &&\n    assessmentConfigs &&\n    insertFakeAchievements(userAssessmentOverviews, assessmentConfigs, inferencer);\n\n  const filterState = useState<FilterStatus>(FilterStatus.ALL);\n  const [filterStatus] = filterState;\n\n  /**\n   * Marks the achievement uuid that is currently on focus (selected)\n   * If an achievement is focused, the cards glow and dashboard displays the AchievementView\n   */\n  const focusState = useState<string>('');\n  const [focusUuid, setFocusUuid] = focusState;\n\n  const hiddenState = useState<boolean>(false);\n  const [seeHidden] = hiddenState;\n\n  // Resets AchievementView when the selected user changes\n  useEffect(() => {\n    setFocusUuid('');\n  }, [selectedUser, setFocusUuid]);\n\n  return (\n    <AchievementContext.Provider value={inferencer}>\n      <div className=\"AchievementDashboard\">\n        <AchievementOverview\n          name={selectedUser ? selectedUser.name || selectedUser.username : name || 'User'}\n          userState={userIdState}\n        />\n        {role && role !== Role.Student && (\n          <AchievementManualEditor\n            userState={userIdState}\n            hiddenState={hiddenState}\n            studio={group || 'Staff'}\n            users={users}\n            getUsers={getUsers}\n            updateGoalProgress={updateGoalProgress}\n          />\n        )}\n\n        <div className=\"achievement-main\">\n          <div className=\"filter-container\">\n            <AchievementFilter\n              filterState={filterState}\n              icon={IconNames.GLOBE}\n              ownStatus={FilterStatus.ALL}\n            />\n            <AchievementFilter\n              filterState={filterState}\n              icon={IconNames.LOCATE}\n              ownStatus={FilterStatus.ACTIVE}\n            />\n            <AchievementFilter\n              filterState={filterState}\n              icon={IconNames.ENDORSED}\n              ownStatus={FilterStatus.COMPLETED}\n            />\n          </div>\n\n          <ul className=\"task-container\">\n            {generateAchievementTasks(\n              role === Role.Student || !seeHidden\n                ? inferencer.listSortedReleasedTaskUuids()\n                : inferencer.listAllSortedAchievementUuids(),\n              filterStatus,\n              focusState\n            )}\n          </ul>\n\n          <div className=\"view-container\">\n            <AchievementView focusUuid={focusUuid} userState={userIdState} />\n          </div>\n        </div>\n      </div>\n    </AchievementContext.Provider>\n  );\n}\n\nexport default Dashboard;\n","import { Button } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { useContext, useReducer, useState } from 'react';\nimport { AchievementContext } from 'src/features/achievement/AchievementConstants';\nimport { FilterStatus } from 'src/features/achievement/AchievementTypes';\nimport { generateAchievementTasks } from 'src/pages/achievement/subcomponents/AchievementDashboard';\n\nimport AchievementView from '../AchievementView';\n\ntype AchievementPreviewProps = {\n  awaitPublish: boolean;\n  publishChanges: () => void;\n};\n\nfunction AchievementPreview(props: AchievementPreviewProps) {\n  const { awaitPublish, publishChanges } = props;\n\n  const inferencer = useContext(AchievementContext);\n\n  // Show AchievementView when viewMode is true, otherwise show AchievementTask\n  const [viewMode, toggleMode] = useReducer(mode => !mode, false);\n\n  /**\n   * Marks the achievement uuid that is currently on focus (selected)\n   * If an achievement is focused, the cards glow and dashboard displays the AchievementView\n   */\n  const focusState = useState<string>('');\n  const [focusUuid] = focusState;\n\n  return (\n    <div className=\"achievement-preview\">\n      <div className=\"command\">\n        <Button\n          className=\"command-button\"\n          icon={viewMode && IconNames.ARROW_LEFT}\n          rightIcon={!viewMode && IconNames.ARROW_RIGHT}\n          text={viewMode ? 'Task' : 'View'}\n          onClick={toggleMode}\n        />\n        {awaitPublish && (\n          <Button\n            className=\"command-button\"\n            icon={IconNames.CLOUD_UPLOAD}\n            intent=\"primary\"\n            text=\"Publish Changes\"\n            onClick={publishChanges}\n          />\n        )}\n      </div>\n      {viewMode ? (\n        <div className=\"preview-container\">\n          <AchievementView focusUuid={focusUuid} />\n        </div>\n      ) : (\n        <ul className=\"preview-container\">\n          {generateAchievementTasks(inferencer.listSortedTaskUuids(), FilterStatus.ALL, focusState)}\n        </ul>\n      )}\n    </div>\n  );\n}\n\nexport default AchievementPreview;\n","import { GoalDefinition, GoalMeta } from 'src/features/achievement/AchievementTypes';\n\nexport enum EditableGoalActionType {\n  CHANGE_META = 'CHANGE_META',\n  CHANGE_TEXT = 'CHANGE_TEXT',\n  DELETE_GOAL = 'DELETE_GOAL',\n  DISCARD_CHANGES = 'DISCARD_CHANGES',\n  SAVE_CHANGES = 'SAVE_CHANGES'\n}\n\nexport type EditableGoalAction =\n  | {\n      type: EditableGoalActionType.CHANGE_META;\n      payload: GoalMeta;\n    }\n  | {\n      type: EditableGoalActionType.CHANGE_TEXT;\n      payload: string;\n    }\n  | {\n      type: EditableGoalActionType.DELETE_GOAL;\n    }\n  | {\n      type: EditableGoalActionType.DISCARD_CHANGES;\n      payload: GoalDefinition;\n    }\n  | {\n      type: EditableGoalActionType.SAVE_CHANGES;\n    };\n\nexport type EditableGoalState = {\n  editableGoal: GoalDefinition;\n  isDirty: boolean;\n};\n","import {\n  AchievementGoal,\n  EventType,\n  GoalDefinition,\n  GoalMeta,\n  GoalProgress,\n  GoalType\n} from 'src/features/achievement/AchievementTypes';\n\nexport const metaTemplate = (type: GoalType): GoalMeta => {\n  switch (type) {\n    case GoalType.ASSESSMENT:\n      return {\n        type: GoalType.ASSESSMENT,\n        assessmentNumber: 0,\n        requiredCompletionFrac: 0\n      };\n    case GoalType.BINARY:\n      return {\n        type: GoalType.BINARY,\n        condition: false,\n        targetCount: 1\n      };\n    case GoalType.MANUAL:\n      return {\n        type: GoalType.MANUAL,\n        targetCount: 1\n      };\n    case GoalType.EVENT:\n      return {\n        type: GoalType.EVENT,\n        eventNames: [EventType.RUN_CODE],\n        targetCount: 1,\n        release: undefined,\n        deadline: undefined,\n        observeFrom: undefined,\n        observeTo: undefined\n      };\n  }\n};\n\nexport const goalDefinitionTemplate: GoalDefinition = {\n  uuid: '',\n  text: 'Goal Text Here',\n  achievementUuids: [],\n  meta: metaTemplate(GoalType.MANUAL)\n};\n\nconst goalProgressTemplate: GoalProgress = {\n  uuid: '',\n  count: 0,\n  targetCount: 1,\n  completed: false\n};\n\nexport const goalTemplate: AchievementGoal = {\n  ...goalDefinitionTemplate,\n  ...goalProgressTemplate\n};\n","import { NumericInput } from '@blueprintjs/core';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { AssessmentMeta, GoalMeta } from 'src/features/achievement/AchievementTypes';\n\ntype EditableAssessmentMetaProps = {\n  assessmentMeta: AssessmentMeta;\n  changeMeta: (meta: GoalMeta) => void;\n};\n\nfunction EditableAssessmentMeta(props: EditableAssessmentMetaProps) {\n  const { assessmentMeta, changeMeta } = props;\n  const { assessmentNumber, requiredCompletionFrac } = assessmentMeta;\n\n  const changeAssessmentNumber = (assessmentNumber: number) =>\n    changeMeta({ ...assessmentMeta, assessmentNumber: assessmentNumber });\n\n  const changeRequiredCompletion = (requiredCompletion: number) => {\n    const requiredCompletionFrac = requiredCompletion / 100;\n    changeMeta({ ...assessmentMeta, requiredCompletionFrac: requiredCompletionFrac });\n  };\n\n  return (\n    <>\n      <Tooltip2 content=\"Assessment Number\">\n        <NumericInput\n          allowNumericCharactersOnly={true}\n          onValueChange={changeAssessmentNumber}\n          placeholder=\"Enter assessment number here\"\n          value={assessmentNumber}\n        />\n      </Tooltip2>\n      <Tooltip2 content=\"Required Completion Percentage\">\n        <NumericInput\n          allowNumericCharactersOnly={true}\n          max={100}\n          min={0}\n          onValueChange={changeRequiredCompletion}\n          placeholder=\"Enter required completion percentage here\"\n          rightElement={<p>%</p>}\n          value={requiredCompletionFrac * 100}\n        />\n      </Tooltip2>\n    </>\n  );\n}\n\nexport default EditableAssessmentMeta;\n","export type BooleanExpression = AndExpression | OrExpression | Conditional | false;\n\ninterface AndExpression {\n  type: 'AND';\n  operands: BooleanExpression[];\n}\n\ninterface OrExpression {\n  type: 'OR';\n  operands: BooleanExpression[];\n}\n\ntype Conditional =\n  | AchievementConditional\n  | AssessmentGradingConditional\n  | AssessmentSubmissionConditional\n  | GenericConditional;\n\nexport enum EventTypes {\n  ACHIEVEMENT = 'achievement',\n  ASSESSMENT_GRADING = 'assessment-grading',\n  ASSESSMENT_SUBMISSION = 'assessment-submission'\n}\n\ninterface ConditionalBase {\n  event: EventTypes;\n}\n\ninterface GenericConditional extends ConditionalBase {\n  condition?: (evt: any) => boolean;\n  restriction?: string;\n}\n\ninterface AchievementConditional extends ConditionalBase {\n  event: EventTypes.ACHIEVEMENT;\n  restriction: string;\n}\n\ninterface AssessmentGradingConditional extends ConditionalBase {\n  event: EventTypes.ASSESSMENT_GRADING;\n  restriction: string;\n}\n\ninterface AssessmentSubmissionConditional extends ConditionalBase {\n  event: EventTypes.ASSESSMENT_SUBMISSION;\n  restriction: string;\n}\n\nexport function AND(...operands: BooleanExpression[]): BooleanExpression {\n  return {\n    type: 'AND',\n    operands\n  };\n}\n\nexport function OR(...operands: BooleanExpression[]): BooleanExpression {\n  return {\n    type: 'OR',\n    operands\n  };\n}\n","import { Button, EditableText, MenuItem, NumericInput } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { ItemRenderer, Select } from '@blueprintjs/select';\nimport { BinaryMeta, GoalMeta } from 'src/features/achievement/AchievementTypes';\nimport { AND, BooleanExpression, OR } from 'src/features/achievement/ExpressionTypes';\n\n/**\n * Possible extension: event should be a select of type EventTypes (import from ExpressionTypes)\n * This is very much possible, but the possible false value in BooleanExpression really prevents it\n * Why is this even a possible boolean expression? why would anyone ever use false?\n */\n\ntype EditableBinaryMetaProps = {\n  binaryMeta: BinaryMeta;\n  changeMeta: (meta: GoalMeta) => void;\n};\n\ntype Joiner = 'AND' | 'OR';\nconst JoinerSelect = Select.ofType<Joiner>();\nconst joinerRenderer: ItemRenderer<Joiner> = (joiner, { handleClick }) => (\n  <MenuItem key={joiner} onClick={handleClick} text={joiner} />\n);\n\n// Takes the current condition, splits it into an array of strings\nconst conditionSplitter = (condition: BooleanExpression): string[] => {\n  // only OR or AND Expressions have type property\n  if (typeof condition === 'object' && 'type' in condition) {\n    const { type, operands } = condition;\n    const len = operands.length;\n    const conditions = [];\n    // make conditions [cond1, joiner, cond2, joiner, ..., condn]\n    for (let i = 0; i < len; i++) {\n      conditions.push(conditionSplitter(operands[i]));\n      if (i !== len - 1) {\n        conditions.push(type);\n      }\n    }\n    // each recursive call flattens itself, so max depth is always 1\n    return conditions.flat();\n  } else {\n    return [JSON.stringify(condition)];\n  }\n};\n\nfunction EditableBinaryMeta(props: EditableBinaryMetaProps) {\n  const { binaryMeta, changeMeta } = props;\n  const { condition, targetCount } = binaryMeta;\n\n  const joiners: string[] = [];\n  const conditions: string[] = [];\n  const condArray: string[] = conditionSplitter(condition);\n  for (let i = 0; i < condArray.length; i++) {\n    if (i % 2 === 0) {\n      conditions[conditions.length] = condArray[i];\n    } else {\n      joiners[joiners.length] = condArray[i];\n    }\n  }\n\n  // Joins the conditions array, and changes the goalMeta\n  const changeCondition = () => {\n    // find the first joiner, join the left and right\n    // repeat until no more joiners left\n    let condition = JSON.parse(conditions[0]);\n    for (let i = 1; i < conditions.length; i++) {\n      if (joiners[i - 1] === 'AND') {\n        condition = AND(condition, JSON.parse(conditions[i]));\n      } else {\n        condition = OR(condition, JSON.parse(conditions[i]));\n      }\n    }\n    changeMeta({ ...binaryMeta, condition: condition });\n  };\n\n  const changeTargetCount = (targetCount: number) =>\n    changeMeta({ ...binaryMeta, targetCount: targetCount });\n\n  // Adds the and/or, adds the condition to be edited\n  const addCondition = () => {\n    joiners.push('AND');\n    conditions.push('{\"event\":\"\", \"restriction\":\"\"}');\n    changeCondition();\n  };\n\n  const changeConditionArray = (cond: string, idx: number) => {\n    conditions[idx] = cond;\n    changeCondition();\n  };\n\n  const changeJoinerArray = (joiner: Joiner, idx: number) => {\n    joiners[idx] = joiner;\n    changeCondition();\n  };\n\n  const deleteCondition = (idx: number) => {\n    for (let i = idx; i < conditions.length - 1; i++) {\n      // bring everything forward\n      conditions[i] = conditions[i + 1];\n      joiners[i] = joiners[i + 1];\n    }\n    conditions.length = conditions.length - 1;\n    joiners.length = joiners.length - 1;\n    changeCondition();\n  };\n\n  // Generates the components for editing conditions\n  const generateConditions = () => {\n    return condArray.map((op: string, idx: number) => (\n      <div key={idx}>\n        {\n          // even idx is condition, odd is joiner\n          idx % 2 === 0 ? (\n            // the text to change the condition\n            <>\n              <Tooltip2 content=\"Condition\">\n                <EditableText\n                  onChange={value => changeConditionArray(value, idx / 2)}\n                  multiline={true}\n                  placeholder=\"Enter condition here\"\n                  value={op}\n                />\n              </Tooltip2>\n              {\n                // should only be deleteable if not the only condition\n                conditions.length > 1 && (\n                  <Tooltip2 content=\"Delete Condition\">\n                    <Button intent=\"danger\" icon=\"trash\" onClick={() => deleteCondition(idx)} />\n                  </Tooltip2>\n                )\n              }\n            </>\n          ) : (\n            // the button to choose the joiner to use\n            <Tooltip2 content=\"And/Or\">\n              <JoinerSelect\n                filterable={false}\n                itemRenderer={joinerRenderer}\n                items={['AND', 'OR']}\n                onItemSelect={value => changeJoinerArray(value, (idx - 1) / 2)}\n              >\n                <Button minimal={true} outlined={true} text={op} />\n              </JoinerSelect>\n            </Tooltip2>\n          )\n        }\n      </div>\n    ));\n  };\n\n  return (\n    <>\n      <Tooltip2 content=\"Target Count\">\n        <NumericInput\n          allowNumericCharactersOnly={true}\n          leftIcon={IconNames.BANK_ACCOUNT}\n          min={0}\n          onValueChange={changeTargetCount}\n          placeholder=\"Enter target count here\"\n          value={targetCount}\n        />\n      </Tooltip2>\n      {generateConditions()}\n      <br />\n      <Button minimal={true} outlined={true} text=\"Add Condition\" onClick={addCondition} />\n    </>\n  );\n}\n\nexport default EditableBinaryMeta;\n","import { Button, Dialog } from '@blueprintjs/core';\nimport { DatePicker } from '@blueprintjs/datetime';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { useState } from 'react';\nimport { prettifyDate } from 'src/commons/achievement/utils/DateHelper';\n\ntype EditableDateProps = {\n  type: string;\n  date?: Date;\n  changeDate: (date?: Date) => void;\n};\n\nfunction EditableDate(props: EditableDateProps) {\n  const { type, date, changeDate } = props;\n\n  const [isOpen, setOpen] = useState<boolean>(false);\n  const toggleOpen = () => setOpen(!isOpen);\n\n  const hoverText = date === undefined ? `No ${type}` : `${prettifyDate(date)}`;\n\n  return (\n    <>\n      <Tooltip2 content={hoverText}>\n        <Button minimal={true} onClick={toggleOpen} outlined={true}>{`${type}`}</Button>\n      </Tooltip2>\n      <Dialog\n        isCloseButtonShown={false}\n        isOpen={isOpen}\n        onClose={toggleOpen}\n        style={{\n          background: '#fff',\n          maxWidth: 'max-content',\n          padding: '0.25em',\n          textAlign: 'center'\n        }}\n        title={`${type}`}\n      >\n        <DatePicker\n          onChange={changeDate}\n          timePickerProps={{ showArrowButtons: true }}\n          value={date}\n        />\n        <Button onClick={() => changeDate(undefined)} text={`Remove ${type}`} />\n      </Dialog>\n    </>\n  );\n}\n\nexport default EditableDate;\n","import { Button, Dialog } from '@blueprintjs/core';\nimport { TimePicker } from '@blueprintjs/datetime';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { useState } from 'react';\nimport { prettifyTime } from 'src/commons/achievement/utils/DateHelper';\n\ntype EditableTimeProps = {\n  type: string;\n  time?: Date;\n  changeTime: (time?: Date) => void;\n};\n\nfunction EditableTime(props: EditableTimeProps) {\n  const { type, time, changeTime } = props;\n\n  const [isOpen, setOpen] = useState<boolean>(false);\n  const toggleOpen = () => setOpen(!isOpen);\n\n  const hoverText = time === undefined ? `No ${type}` : `${prettifyTime(time)}`;\n\n  return (\n    <>\n      <Tooltip2 content={hoverText}>\n        <Button minimal={true} onClick={toggleOpen} outlined={true}>{`${type}`}</Button>\n      </Tooltip2>\n      <Dialog\n        isCloseButtonShown={false}\n        isOpen={isOpen}\n        onClose={toggleOpen}\n        style={{\n          background: '#fff',\n          maxWidth: 'max-content',\n          padding: '0.25em',\n          textAlign: 'center'\n        }}\n        title={`${type}`}\n      >\n        <TimePicker onChange={changeTime} showArrowButtons={true} value={time} />\n        <Button onClick={() => changeTime(undefined)} text={`Remove ${type}`} />\n      </Dialog>\n    </>\n  );\n}\n\nexport default EditableTime;\n","import { Button, MenuItem, NumericInput } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { ItemRenderer, Select } from '@blueprintjs/select';\nimport { EventMeta, EventType, GoalMeta } from 'src/features/achievement/AchievementTypes';\n\nimport EditableDate from '../EditableDate';\nimport EditableTime from '../EditableTime';\n\ntype EditableEventMetaProps = {\n  changeMeta: (meta: GoalMeta) => void;\n  eventMeta: EventMeta;\n};\n\nconst EventSelect = Select.ofType<EventType>();\nconst eventRenderer: ItemRenderer<EventType> = (eventName, { handleClick }) => (\n  <MenuItem key={eventName} onClick={handleClick} text={eventName} />\n);\n\nfunction EditableEventMeta(props: EditableEventMetaProps) {\n  const { changeMeta, eventMeta } = props;\n  const { eventNames, targetCount, release, deadline, observeFrom, observeTo } = eventMeta;\n\n  const changeTargetCount = (targetCount: number) =>\n    changeMeta({ ...eventMeta, targetCount: targetCount });\n\n  const changeEventName = (eventName: EventType, index: number) => {\n    if (eventName === EventType.NONE) {\n      changeMeta({ ...eventMeta, eventNames: eventNames.filter((_, idx) => idx !== index) });\n    } else {\n      eventNames[index] = eventName;\n      changeMeta({ ...eventMeta, eventNames: eventNames });\n    }\n  };\n\n  const changeRelease = (release?: Date) => {\n    changeMeta({ ...eventMeta, release: release });\n  };\n\n  const changeDeadline = (deadline?: Date) => {\n    changeMeta({ ...eventMeta, deadline: deadline });\n  };\n\n  const changeObserveFrom = (observeFrom?: Date) => {\n    changeMeta({ ...eventMeta, observeFrom: observeFrom });\n  };\n\n  const changeObserveTo = (observeTo?: Date) => {\n    changeMeta({ ...eventMeta, observeTo: observeTo });\n  };\n\n  const changeIndexEventName = (index: number) => (eventName: EventType) =>\n    changeEventName(eventName, index);\n\n  const generateEventNames = () => {\n    return eventNames.map((eventName, index) => (\n      <Tooltip2 content={'Change event type ' + index} key={index}>\n        <EventSelect\n          filterable={false}\n          items={Object.values(EventType)}\n          itemRenderer={eventRenderer}\n          onItemSelect={changeIndexEventName(index)}\n        >\n          <Button outlined={true} text={eventName} />\n        </EventSelect>\n      </Tooltip2>\n    ));\n  };\n\n  const addEvent = () => {\n    eventNames[eventNames.length] = EventType.RUN_CODE;\n    changeMeta({ ...eventMeta, eventNames: eventNames });\n  };\n\n  return (\n    <>\n      {generateEventNames()}\n      <Tooltip2 content=\"Add Event\">\n        <Button outlined={true} text={'Add Event'} onClick={addEvent} />\n      </Tooltip2>\n      <Tooltip2 content=\"Target Count\">\n        <NumericInput\n          allowNumericCharactersOnly={true}\n          leftIcon={IconNames.LOCATE}\n          min={0}\n          onValueChange={changeTargetCount}\n          placeholder=\"Enter target count here\"\n          value={targetCount}\n        />\n      </Tooltip2>\n      <br />\n      <EditableDate type=\"Release\" date={release} changeDate={changeRelease} />\n      <EditableDate type=\"Deadline\" date={deadline} changeDate={changeDeadline} />\n      <EditableTime type=\"Observe From\" time={observeFrom} changeTime={changeObserveFrom} />\n      <EditableTime type=\"Observe To\" time={observeTo} changeTime={changeObserveTo} />\n    </>\n  );\n}\n\nexport default EditableEventMeta;\n","import { NumericInput } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { GoalMeta, ManualMeta } from 'src/features/achievement/AchievementTypes';\n\ntype EditableManualMetaProps = {\n  changeMeta: (meta: GoalMeta) => void;\n  manualMeta: ManualMeta;\n};\n\nfunction EditableManualMeta(props: EditableManualMetaProps) {\n  const { changeMeta, manualMeta } = props;\n  const { targetCount } = manualMeta;\n\n  const changeTargetCount = (targetCount: number) =>\n    changeMeta({ ...manualMeta, targetCount: targetCount });\n\n  return (\n    <Tooltip2 content=\"Target Count\">\n      <NumericInput\n        allowNumericCharactersOnly={true}\n        leftIcon={IconNames.BANK_ACCOUNT}\n        min={0}\n        onValueChange={changeTargetCount}\n        placeholder=\"Enter target count here\"\n        value={targetCount}\n      />\n    </Tooltip2>\n  );\n}\n\nexport default EditableManualMeta;\n","import { Button, MenuItem } from '@blueprintjs/core';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { ItemRenderer, Select } from '@blueprintjs/select';\nimport {\n  AssessmentMeta,\n  BinaryMeta,\n  EventMeta,\n  GoalMeta,\n  GoalType,\n  ManualMeta\n} from 'src/features/achievement/AchievementTypes';\n\nimport { metaTemplate } from './GoalTemplate';\nimport EditableAssessmentMeta from './metaDetails/EditableAssessmentMeta';\nimport EditableBinaryMeta from './metaDetails/EditableBinaryMeta';\nimport EditableEventMeta from './metaDetails/EditableEventMeta';\nimport EditableManualMeta from './metaDetails/EditableManualMeta';\n\ntype EditableMetaProps = {\n  changeMeta: (meta: GoalMeta) => void;\n  meta: GoalMeta;\n};\n\nfunction EditableMeta(props: EditableMetaProps) {\n  const { changeMeta, meta } = props;\n  const { type } = meta;\n\n  const TypeSelect = Select.ofType<GoalType>();\n  const typeRenderer: ItemRenderer<GoalType> = (type, { handleClick }) => (\n    <MenuItem key={type} onClick={handleClick} text={type} />\n  );\n\n  const changeType = (type: GoalType) => changeMeta(metaTemplate(type));\n\n  const editableMetaDetails = (type: GoalType) => {\n    switch (type) {\n      case GoalType.ASSESSMENT:\n        return (\n          <EditableAssessmentMeta assessmentMeta={meta as AssessmentMeta} changeMeta={changeMeta} />\n        );\n      case GoalType.BINARY:\n        return <EditableBinaryMeta binaryMeta={meta as BinaryMeta} changeMeta={changeMeta} />;\n      case GoalType.MANUAL:\n        return <EditableManualMeta changeMeta={changeMeta} manualMeta={meta as ManualMeta} />;\n      case GoalType.EVENT:\n        return <EditableEventMeta eventMeta={meta as EventMeta} changeMeta={changeMeta} />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <>\n      <Tooltip2 content=\"Change Goal Type\">\n        <TypeSelect\n          filterable={false}\n          itemRenderer={typeRenderer}\n          items={Object.values(GoalType)}\n          onItemSelect={changeType}\n        >\n          <Button minimal={true} outlined={true} text={type} />\n        </TypeSelect>\n      </Tooltip2>\n      {editableMetaDetails(type)}\n    </>\n  );\n}\n\nexport default EditableMeta;\n","import { EditableText } from '@blueprintjs/core';\nimport { cloneDeep } from 'lodash';\nimport { useContext, useMemo, useReducer, useState } from 'react';\nimport { AchievementContext } from 'src/features/achievement/AchievementConstants';\nimport { GoalDefinition, GoalMeta } from 'src/features/achievement/AchievementTypes';\n\nimport ItemDeleter from '../common/ItemDeleter';\nimport ItemSaver from '../common/ItemSaver';\nimport {\n  EditableGoalAction as Action,\n  EditableGoalActionType as ActionType,\n  EditableGoalState as State\n} from './EditableGoalTypes';\nimport EditableMeta from './EditableMeta';\n\ntype EditableGoalProps = {\n  uuid: string;\n  isNewGoal: boolean;\n  releaseUuid: () => void;\n  removeCard: (uuid: string) => void;\n  requestPublish: () => void;\n};\n\nconst init = (goal: GoalDefinition): State => {\n  return {\n    editableGoal: goal,\n    isDirty: false\n  };\n};\n\nconst reducer = (state: State, action: Action) => {\n  switch (action.type) {\n    case ActionType.SAVE_CHANGES:\n      return {\n        ...state,\n        isDirty: false\n      };\n    case ActionType.DISCARD_CHANGES:\n      return init(action.payload);\n    case ActionType.DELETE_GOAL:\n      return {\n        ...state,\n        isDirty: false\n      };\n    case ActionType.CHANGE_META:\n      return {\n        editableGoal: {\n          ...state.editableGoal,\n          meta: action.payload\n        },\n        isDirty: true\n      };\n    case ActionType.CHANGE_TEXT:\n      return {\n        editableGoal: {\n          ...state.editableGoal,\n          text: action.payload\n        },\n        isDirty: true\n      };\n    default:\n      return state;\n  }\n};\n\nfunction EditableGoal(props: EditableGoalProps) {\n  const { uuid, isNewGoal, releaseUuid, removeCard, requestPublish } = props;\n\n  const inferencer = useContext(AchievementContext);\n  const goal = inferencer.getGoalDefinition(uuid);\n  const goalClone = useMemo(() => cloneDeep(goal), [goal]);\n\n  const [state, dispatch] = useReducer(reducer, goalClone, init);\n  const [isNew, setIsNew] = useState<boolean>(isNewGoal);\n  const { editableGoal, isDirty } = state;\n  const { meta, text } = editableGoal;\n\n  const saveChanges = () => {\n    dispatch({ type: ActionType.SAVE_CHANGES });\n    inferencer.modifyGoalDefinition(editableGoal);\n    if (isNew) {\n      releaseUuid();\n      setIsNew(false);\n    }\n    requestPublish();\n  };\n\n  const discardChanges = () => dispatch({ type: ActionType.DISCARD_CHANGES, payload: goalClone });\n\n  const deleteGoal = () => {\n    dispatch({ type: ActionType.DELETE_GOAL });\n    inferencer.removeGoalDefinition(uuid);\n    if (isNew) {\n      releaseUuid();\n      setIsNew(false);\n    }\n    removeCard(uuid);\n    requestPublish();\n  };\n\n  const changeMeta = (meta: GoalMeta) => dispatch({ type: ActionType.CHANGE_META, payload: meta });\n\n  const changeText = (text: string) => dispatch({ type: ActionType.CHANGE_TEXT, payload: text });\n\n  return (\n    <li className=\"editable-goal\" id={uuid}>\n      <div className=\"action-button\">\n        {isDirty ? (\n          <ItemSaver discardChanges={discardChanges} saveChanges={saveChanges} />\n        ) : (\n          <ItemDeleter deleteItem={deleteGoal} item={text} />\n        )}\n      </div>\n      <h3>\n        <EditableText onChange={changeText} placeholder=\"Enter goal text here\" value={text} />\n      </h3>\n      <div className=\"meta\">\n        <EditableMeta changeMeta={changeMeta} meta={meta} />\n      </div>\n    </li>\n  );\n}\n\nexport default EditableGoal;\n","import { Button } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { useContext } from 'react';\nimport { AchievementContext } from 'src/features/achievement/AchievementConstants';\n\nimport { goalDefinitionTemplate } from './GoalTemplate';\n\ntype GoalAdderProps = {\n  allowNewUuid: boolean;\n  setNewUuid: (uuid: string) => void;\n};\n\nfunction GoalAdder(props: GoalAdderProps) {\n  const { allowNewUuid, setNewUuid } = props;\n\n  const inferencer = useContext(AchievementContext);\n\n  const addGoal = () => setNewUuid(inferencer.insertGoalDefinition(goalDefinitionTemplate));\n\n  return (\n    <Button\n      className=\"command-button\"\n      disabled={!allowNewUuid}\n      icon={IconNames.NEW_OBJECT}\n      onClick={addGoal}\n      text=\"Create Goal\"\n    />\n  );\n}\n\nexport default GoalAdder;\n","import { useContext, useState } from 'react';\nimport { AchievementContext } from 'src/features/achievement/AchievementConstants';\n\nimport EditableGoal from './goalEditor/EditableGoal';\nimport GoalAdder from './goalEditor/GoalAdder';\n\ntype GoalEditorProps = {\n  requestPublish: () => void;\n};\n\nlet editableGoals: JSX.Element[] = [];\n\nfunction GoalEditor(props: GoalEditorProps) {\n  const { requestPublish } = props;\n\n  const inferencer = useContext(AchievementContext);\n\n  /**\n   * newUuid helps us to ensure that only ONE goal is added at any point of time.\n   *\n   * By default,  the newUuid is an empty string, which means currently no new goal\n   * is being added and the admin is able to add a new goal.\n   *\n   * Conversely, if the newUuid is not an empty string, this means currently a goal\n   * is being added to the system and the admin is not allowed to add two goals\n   * at one go. The newUuid holds the newly created goal uuid until the new goal\n   * is added into the inferencer.\n   */\n  const [newUuid, setNewUuid] = useState<string>('');\n  const allowNewUuid = newUuid === '';\n  const releaseUuid = () => setNewUuid('');\n\n  const removeCard = (uuid: string) => {\n    let idx = 0;\n    while (editableGoals[idx].key !== uuid && idx < editableGoals.length) {\n      idx++;\n    }\n    editableGoals.splice(idx, 1);\n  };\n\n  const generateEditableGoal = (goalUuid: string, isNewGoal: boolean) => (\n    <EditableGoal\n      key={goalUuid}\n      uuid={goalUuid}\n      isNewGoal={isNewGoal}\n      releaseUuid={releaseUuid}\n      requestPublish={requestPublish}\n      removeCard={removeCard}\n    />\n  );\n\n  // load preexisting goals from the inferencer\n  if (editableGoals.length === 0) {\n    editableGoals = inferencer.getAllGoalUuids().map(uuid => generateEditableGoal(uuid, false));\n  }\n\n  const addNewGoal = (uuid: string) => {\n    setNewUuid(uuid);\n    // keep the new goal on top by swapping it with the first element\n    editableGoals[editableGoals.length] = editableGoals[0];\n    editableGoals[0] = generateEditableGoal(uuid, true);\n  };\n\n  return (\n    <div className=\"goal-editor\">\n      <div className=\"command\">\n        <GoalAdder allowNewUuid={allowNewUuid} setNewUuid={addNewGoal} />\n      </div>\n      <ul className=\"goal-container\">{editableGoals}</ul>\n    </div>\n  );\n}\n\nexport default GoalEditor;\n","import { useEffect, useReducer, useState } from 'react';\nimport { Prompt } from 'react-router';\n\nimport AchievementEditor from '../../../commons/achievement/control/AchievementEditor';\nimport AchievementPreview from '../../../commons/achievement/control/AchievementPreview';\nimport GoalEditor from '../../../commons/achievement/control/GoalEditor';\nimport AchievementInferencer from '../../../commons/achievement/utils/AchievementInferencer';\nimport { AchievementContext } from '../../../features/achievement/AchievementConstants';\nimport { AchievementItem, GoalDefinition } from '../../../features/achievement/AchievementTypes';\n\nexport type DispatchProps = {\n  bulkUpdateAchievements: (achievements: AchievementItem[]) => void;\n  bulkUpdateGoals: (goals: GoalDefinition[]) => void;\n  getAchievements: () => void;\n  getOwnGoals: () => void;\n  removeAchievement: (uuid: string) => void;\n  removeGoal: (uuid: string) => void;\n};\n\nexport type StateProps = {\n  inferencer: AchievementInferencer;\n};\n\nfunction AchievementControl(props: DispatchProps & StateProps) {\n  const {\n    bulkUpdateAchievements,\n    bulkUpdateGoals,\n    getAchievements,\n    getOwnGoals,\n    removeAchievement,\n    removeGoal,\n    inferencer\n  } = props;\n\n  /**\n   * Fetch the latest achievements and goals from backend when the page is rendered\n   */\n  useEffect(() => {\n    getAchievements();\n    getOwnGoals();\n  }, [getAchievements, getOwnGoals]);\n\n  /**\n   * Monitors changes that are awaiting publish\n   */\n  const [awaitPublish, setAwaitPublish] = useState<boolean>(false);\n  const publishChanges = () => {\n    // NOTE: Goals and achievements must exist in the backend before the association can be built\n    bulkUpdateGoals(inferencer.getAllGoals());\n    bulkUpdateAchievements(inferencer.getAllAchievements());\n    inferencer.getGoalsToDelete().forEach(removeGoal);\n    inferencer.getAchievementsToDelete().forEach(removeAchievement);\n    inferencer.resetToDelete();\n    setAwaitPublish(false);\n  };\n  const requestPublish = () => {\n    setAwaitPublish(true);\n    forceUpdate();\n  };\n\n  /**\n   * Allows editor components to trigger a page re-render whenever the inferencer is modified\n   * so that the AchievementPreview displays the latest local changes\n   *\n   * NOTE: Although the inferencer is passed to the value prop of AchievementContext.Provider,\n   * changes to the inferencer does not trigger a re-render in all AchievementContext.Consumer\n   * as expected because Context uses reference identity to determine when to re-render. When\n   * the editor components update the inferencer by calling inferencer.modifyAchievement(...)\n   * or inferencer.modifyGoalDefinition(...), the Context does not register the changes hence\n   * a forceUpdate() hook is needed.\n   *\n   * See: https://reactjs.org/docs/context.html#caveats\n   */\n  const [, forceUpdate] = useReducer(x => x + 1, 0);\n\n  return (\n    <AchievementContext.Provider value={inferencer}>\n      <Prompt\n        message=\"You have unpublished changes. Are you sure you want to leave?\"\n        when={awaitPublish}\n      />\n\n      <div className=\"AchievementControl\">\n        <AchievementPreview awaitPublish={awaitPublish} publishChanges={publishChanges} />\n\n        <AchievementEditor requestPublish={requestPublish} />\n\n        <GoalEditor requestPublish={requestPublish} />\n      </div>\n    </AchievementContext.Provider>\n  );\n}\n\nexport default AchievementControl;\n","import { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport AchievementInferencer from '../../../commons/achievement/utils/AchievementInferencer';\nimport { OverallState } from '../../../commons/application/ApplicationTypes';\nimport {\n  bulkUpdateAchievements,\n  bulkUpdateGoals,\n  getAchievements,\n  getOwnGoals,\n  removeAchievement,\n  removeGoal\n} from '../../../features/achievement/AchievementActions';\nimport AchievementControl, { DispatchProps, StateProps } from './AchievementControl';\n\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => ({\n  inferencer: new AchievementInferencer(state.achievement.achievements, state.achievement.goals)\n});\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      bulkUpdateAchievements,\n      bulkUpdateGoals,\n      getAchievements,\n      getOwnGoals,\n      removeAchievement,\n      removeGoal\n    },\n    dispatch\n  );\n\nconst AchievementControlContainer = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(AchievementControl);\n\nexport default AchievementControlContainer;\n","import { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport AchievementInferencer from '../../../commons/achievement/utils/AchievementInferencer';\nimport { fetchAssessmentOverviews } from '../../../commons/application/actions/SessionActions';\nimport { OverallState } from '../../../commons/application/ApplicationTypes';\nimport {\n  getAchievements,\n  getGoals,\n  getOwnGoals,\n  getUserAssessmentOverviews,\n  getUsers,\n  updateGoalProgress\n} from '../../../features/achievement/AchievementActions';\nimport Dashboard, { DispatchProps, StateProps } from './AchievementDashboard';\n\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => ({\n  group: state.session.group,\n  inferencer: new AchievementInferencer(state.achievement.achievements, state.achievement.goals),\n  name: state.session.name,\n  role: state.session.role,\n  assessmentOverviews: state.session.assessmentOverviews,\n  achievementAssessmentOverviews: state.achievement.assessmentOverviews,\n  users: state.achievement.users,\n  assessmentConfigs: state.session.assessmentConfigurations\n});\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      fetchAssessmentOverviews,\n      getAchievements,\n      getGoals,\n      getOwnGoals,\n      getUserAssessmentOverviews,\n      getUsers,\n      updateGoalProgress\n    },\n    dispatch\n  );\n\nconst DashboardContainer = connect(mapStateToProps, mapDispatchToProps)(Dashboard);\n\nexport default DashboardContainer;\n","import { Route, Switch } from 'react-router';\n\nimport { Role } from '../../commons/application/ApplicationTypes';\nimport Playground from '../playground/Playground';\nimport AchievementControl from './control/AchievementControlContainer';\nimport AchievementDashboard from './subcomponents/AchievementDashboardContainer';\n\nexport type DispatchProps = {};\n\nexport type StateProps = {\n  role: Role;\n};\n\nexport type AchievementProps = DispatchProps & StateProps;\n\nfunction Achievement(props: AchievementProps) {\n  const { role } = props;\n\n  const toAchievementControl =\n    role === Role.Admin || role === Role.Staff ? AchievementControl : Playground;\n\n  return (\n    <Switch>\n      <Route\n        exact={true}\n        path=\"/courses/:courseId/achievements\"\n        component={AchievementDashboard}\n      ></Route>\n      <Route\n        path=\"/courses/:courseId/achievements/control\"\n        component={toAchievementControl}\n      ></Route>\n      <Route component={Playground} />\n    </Switch>\n  );\n}\n\nexport default Achievement;\n","import { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport { OverallState } from '../../commons/application/ApplicationTypes';\nimport Achievement, { DispatchProps, StateProps } from './Achievement';\n\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => ({\n  role: state.session.role!\n});\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators({}, dispatch);\n\nconst AchievementContainer = connect(mapStateToProps, mapDispatchToProps)(Achievement);\n\nexport default AchievementContainer;\n","import { Button, Card, Classes } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport { configure, GlobalHotKeys } from 'react-hotkeys';\n\nimport DataVisualizer from '../../features/dataVisualizer/dataVisualizer';\nimport { Step } from '../../features/dataVisualizer/dataVisualizerTypes';\nimport { Links } from '../utils/Constants';\n\ntype State = {\n  steps: Step[];\n  currentStep: number;\n};\n\nconst dataVisualizerKeyMap = {\n  PREVIOUS_STEP: 'left',\n  NEXT_STEP: 'right'\n};\n\n/**\n * This class is responsible for the visualization of data structures via the\n * data_data function in Source. It adds a listener to the DataVisualizer singleton\n * which updates the steps list via setState whenever new steps are added.\n */\nclass SideContentDataVisualizer extends React.Component<{}, State> {\n  constructor(props: any) {\n    super(props);\n    this.state = { steps: [], currentStep: 0 };\n    DataVisualizer.init(steps => {\n      if (this.state.steps.length > 0) {\n        //  Blink icon\n        const icon = document.getElementById('data_visualizer-icon');\n        icon?.classList.add('side-content-tab-alert');\n      }\n      this.setState({ steps, currentStep: 0 });\n    });\n  }\n\n  public render() {\n    const firstStep: () => boolean = () => this.state.currentStep === 0;\n    const finalStep: () => boolean = () =>\n      !this.state.steps || this.state.currentStep === this.state.steps.length - 1;\n\n    const dataVisualizerHandlers = {\n      PREVIOUS_STEP: this.onPrevButtonClick,\n      NEXT_STEP: this.onNextButtonClick\n    };\n\n    configure({\n      ignoreEventsCondition: event => {\n        return (\n          (event.key === 'ArrowLeft' && firstStep()) || (event.key === 'ArrowRight' && finalStep())\n        );\n      },\n      ignoreRepeatedEventsWhenKeyHeldDown: false,\n      stopEventPropagationAfterIgnoring: false\n    });\n\n    const step: Step | undefined = this.state.steps[this.state.currentStep];\n\n    return (\n      <GlobalHotKeys keyMap={dataVisualizerKeyMap} handlers={dataVisualizerHandlers}>\n        <div className={classNames('sa-data-visualizer', Classes.DARK)}>\n          {this.state.steps.length > 1 ? (\n            <div\n              style={{\n                position: 'relative',\n                display: 'flex',\n                justifyContent: 'center',\n                alignItems: 'center',\n                marginBottom: 10\n              }}\n            >\n              <Button\n                style={{\n                  position: 'absolute',\n                  left: 0\n                }}\n                large={true}\n                outlined={true}\n                icon={IconNames.ARROW_LEFT}\n                onClick={this.onPrevButtonClick}\n                disabled={firstStep()}\n              >\n                Previous\n              </Button>\n              <h3 className=\"bp4-text-large\">\n                Call {this.state.currentStep + 1}/{this.state.steps.length}\n              </h3>\n              <Button\n                style={{\n                  position: 'absolute',\n                  right: 0\n                }}\n                large={true}\n                outlined={true}\n                icon={IconNames.ARROW_RIGHT}\n                onClick={this.onNextButtonClick}\n                disabled={finalStep()}\n              >\n                Next\n              </Button>\n            </div>\n          ) : null}\n          {this.state.steps.length > 0 ? (\n            <div\n              key={step.length} // To ensure the style refreshes if the step length changes\n              style={{\n                display: 'flex',\n                flexDirection: 'row',\n                overflowX: 'auto'\n              }}\n            >\n              {step?.map((elem, i) => (\n                <div key={i} style={{ margin: step.length > 1 ? 0 : '0 auto' }}>\n                  {' '}\n                  {/* To center element when there is only one */}\n                  <Card style={{ background: '#1a2530', padding: 10 }}>\n                    {step.length > 1 && (\n                      <h5\n                        className=\"bp4-heading bp4-monospace-text\"\n                        style={{ marginTop: 0, marginBottom: 20, whiteSpace: 'nowrap' }}\n                      >\n                        Structure {i + 1}\n                      </h5>\n                    )}\n                    {elem}\n                  </Card>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <p id=\"data-visualizer-default-text\" className={Classes.RUNNING_TEXT}>\n              The data visualizer helps you to visualize data structures.\n              {this.state.steps}\n              <br />\n              <br />\n              It is activated by calling the function{' '}\n              <code>\n                draw_data(x<sub>1</sub>, x<sub>2</sub>, ... x<sub>n</sub>)\n              </code>\n              , where{' '}\n              <code>\n                x<sub>k</sub>\n              </code>{' '}\n              would be the{' '}\n              <code>\n                k<sup>th</sup>\n              </code>{' '}\n              data structure that you want to visualize and <code>n</code> is the number of\n              structures.\n              <br />\n              <br />\n              The data visualizer uses box-and-pointer diagrams, as introduced in{' '}\n              <a href={Links.textbookChapter2_2} rel=\"noopener noreferrer\" target=\"_blank\">\n                <i>\n                  Structure and Interpretation of Computer Programs, JavaScript Edition, Chapter 2,\n                  Section 2\n                </i>\n              </a>\n              .\n            </p>\n          )}\n        </div>\n      </GlobalHotKeys>\n    );\n  }\n\n  private onPrevButtonClick = () => {\n    this.setState(state => {\n      return { currentStep: state.currentStep - 1 };\n    });\n  };\n\n  private onNextButtonClick = () => {\n    this.setState(state => {\n      return { currentStep: state.currentStep + 1 };\n    });\n  };\n}\n\nexport default SideContentDataVisualizer;\n","import { Classes } from '@blueprintjs/core';\nimport { debounce } from 'lodash';\nimport * as React from 'react';\nimport EnvVisualizer from 'src/features/envVisualizer/EnvVisualizer';\n\nimport Constants, { Links } from '../utils/Constants';\n\ntype State = {\n  visualization: React.ReactNode;\n  height: number;\n  width: number;\n};\n\nclass SideContentEnvVisualizer extends React.Component<\n  { editorWidth?: string; sideContentHeight?: number },\n  State\n> {\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      visualization: null,\n      width: this.calculateWidth(props.editorWidth),\n      height: this.calculateHeight(props.sideContentHeight)\n    };\n    EnvVisualizer.init(\n      visualization => this.setState({ visualization }),\n      this.state.width,\n      this.state.height\n    );\n  }\n\n  private calculateWidth(editorWidth?: string) {\n    const horizontalPadding = 50;\n    const maxWidth = 5000; // limit for visible diagram width for huge screens\n    let width;\n    if (editorWidth === undefined) {\n      width = window.innerWidth - horizontalPadding;\n    } else {\n      width = Math.min(\n        maxWidth,\n        (window.innerWidth * (100 - parseFloat(editorWidth))) / 100 - horizontalPadding\n      );\n    }\n    return Math.min(width, maxWidth);\n  }\n\n  private calculateHeight(sideContentHeight?: number) {\n    const verticalPadding = 150;\n    const maxHeight = 5000; // limit for visible diagram height for huge screens\n    let height;\n    if (window.innerWidth < Constants.mobileBreakpoint) {\n      // mobile mode\n      height = window.innerHeight - verticalPadding;\n    } else if (sideContentHeight === undefined) {\n      height = window.innerHeight - verticalPadding;\n    } else {\n      height = sideContentHeight - verticalPadding;\n    }\n    return Math.min(height, maxHeight);\n  }\n\n  handleResize = debounce(() => {\n    const newWidth = this.calculateWidth(this.props.editorWidth);\n    const newHeight = this.calculateHeight(this.props.sideContentHeight);\n    if (newWidth !== this.state.width || newHeight !== this.state.height) {\n      this.setState({\n        height: newHeight,\n        width: newWidth\n      });\n      EnvVisualizer.updateDimensions(newWidth, newHeight);\n    }\n  }, 300);\n\n  componentDidMount() {\n    this.handleResize();\n    window.addEventListener('resize', this.handleResize);\n    EnvVisualizer.redraw();\n  }\n  componentWillUnmount() {\n    this.handleResize.cancel();\n    window.removeEventListener('resize', this.handleResize);\n  }\n\n  componentDidUpdate(prevProps: { editorWidth?: string; sideContentHeight?: number }) {\n    if (\n      prevProps.sideContentHeight !== this.props.sideContentHeight ||\n      prevProps.editorWidth !== this.props.editorWidth\n    ) {\n      this.handleResize();\n    }\n  }\n\n  public render() {\n    return (\n      <div className={Classes.DARK}>\n        {this.state.visualization || (\n          <p id=\"env-visualizer-default-text\" className={Classes.RUNNING_TEXT}>\n            The environment model visualizer generates environment model diagrams following a\n            notation introduced in{' '}\n            <a href={Links.textbookChapter3_2} rel=\"noopener noreferrer\" target=\"_blank\">\n              <i>\n                Structure and Interpretation of Computer Programs, JavaScript Edition, Chapter 3,\n                Section 2\n              </i>\n            </a>\n            .\n            <br />\n            <br />\n            It is activated by setting breakpoints before you run the program. You can set a\n            breakpoint by clicking on the gutter of the editor (where all the line numbers are, on\n            the left). When the program runs into a breakpoint, the visualizer displays the state of\n            the environments before the statement is evaluated, which starts in the line in which\n            you set the breakpoint. Every breakpoint must be at the beginning of a statement.\n          </p>\n        )}\n      </div>\n    );\n  }\n}\n\nexport default SideContentEnvVisualizer;\n","import { ButtonGroup, Slider } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Chapter } from 'c-slang/dist/types';\nimport * as React from 'react';\n\nimport {\n  CodeDelta,\n  Input,\n  PlaybackData,\n  PlaybackStatus,\n  SourcecastData\n} from '../../features/sourceRecorder/SourceRecorderTypes';\nimport { ExternalLibraryName } from '../application/types/ExternalTypes';\nimport ControlButton from '../ControlButton';\nimport { SideContentType } from '../sideContent/SideContentTypes';\n\nexport type SourceRecorderControlBarProps = DispatchProps & StateProps & OwnProps;\n\ntype DispatchProps = {\n  handleEditorValueChange: (newCode: string) => void;\n  handleSetCurrentPlayerTime: (playTime: number) => void;\n  handleSetCodeDeltasToApply: (deltas: CodeDelta[]) => void;\n  handleSetIsEditorReadonly: (isEditorReadonly: boolean) => void;\n  handleSetInputToApply: (inputToApply: Input) => void;\n  handleSetSourcecastDuration: (duration: number) => void;\n  handleSetSourcecastStatus: (playbackStatus: PlaybackStatus) => void;\n  handleChapterSelect: (chapter: Chapter) => void;\n  handleExternalSelect: (name: ExternalLibraryName) => void;\n  handlePromptAutocomplete: (row: number, col: number, callback: any) => void;\n};\n\ntype StateProps = {\n  audioUrl: string;\n  currentPlayerTime: number;\n  duration: number;\n  playbackData: PlaybackData;\n  playbackStatus: PlaybackStatus;\n};\n\ntype OwnProps = {\n  /**\n   * setSelectedTab is optional since it is only used in Sourcecast and not Sourcereel\n   * due to the addition of the MobileWorkspace to Sourcecast.\n   */\n  setSelectedTab?: (newTab: SideContentType) => void;\n};\n\ntype State = {\n  currentDeltaRevision: number;\n  currentPlayerProgress: number;\n  currentSourcecastItem: SourcecastData | null;\n  duration: number;\n};\n\nclass SourceRecorderControlBar extends React.PureComponent<SourceRecorderControlBarProps, State> {\n  private audio: React.RefObject<HTMLAudioElement>;\n\n  constructor(props: SourceRecorderControlBarProps) {\n    super(props);\n    this.audio = React.createRef();\n    this.state = {\n      currentDeltaRevision: 0,\n      currentPlayerProgress: 0,\n      currentSourcecastItem: null,\n      duration: 0\n    };\n  }\n\n  public render() {\n    const PlayerPlayButton = (\n      <ControlButton\n        label=\"Play\"\n        icon={IconNames.PLAY}\n        onClick={this.handlePlayerPlaying}\n        isDisabled={!this.props.duration}\n      />\n    );\n    const PlayerPauseButton = (\n      <ControlButton label=\"Pause\" icon={IconNames.PAUSE} onClick={this.handlePlayerPausing} />\n    );\n    return (\n      <div className=\"SourcecastControlBar\">\n        <audio\n          src={this.props.audioUrl}\n          ref={this.audio}\n          onEnded={this.handlePlayerStopping}\n          onLoadedMetadata={this.handleAudioLoaded}\n          onSeeked={this.handleSeeked}\n          onTimeUpdate={this.updatePlayerTime}\n          preload=\"metadata\"\n          // controls={true}\n        />\n        <br />\n        <div className=\"PlayerControl\">\n          <ButtonGroup className=\"PlayerControlButton\">\n            {this.props.playbackStatus === PlaybackStatus.paused && PlayerPlayButton}\n            {this.props.playbackStatus === PlaybackStatus.playing && PlayerPauseButton}\n          </ButtonGroup>\n          <div className=\"Slider\">\n            <Slider\n              min={0}\n              max={1}\n              stepSize={0.0001}\n              onChange={this.handlePlayerProgressBarChange}\n              value={this.state.currentPlayerProgress}\n              labelRenderer={this.renderLabel}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  private handleSeeked = () => {\n    // FIXME: loop in applyPlaybackDataFromStart keeps running if seeked from paused mode\n    this.stopPreviousPlaybackAndApplyFromStart(this.props.playbackData);\n  };\n\n  private handleAudioLoaded = () => {\n    this.props.handleSetSourcecastDuration(this.audio.current!.duration);\n  };\n\n  private applyDeltas = (deltas: CodeDelta[]) => {\n    this.props.handleSetCodeDeltasToApply(deltas);\n  };\n\n  private stopPreviousPlaybackAndApplyFromStart = (playbackData: PlaybackData) => {\n    this.setState(\n      {\n        currentDeltaRevision: this.state.currentDeltaRevision + 1\n      },\n      () => this.applyPlaybackDataFromStart(playbackData)\n    );\n  };\n\n  private applyPlaybackDataFromStart = async (playbackData: PlaybackData) => {\n    const sleep = (ms: number) => new Promise(r => setTimeout(r, ms));\n    const currentRevision = this.state.currentDeltaRevision;\n    let currentTime = this.audio.current!.currentTime * 1000;\n    this.props.handleEditorValueChange(playbackData.init.editorValue);\n    this.props.handleExternalSelect(playbackData.init.externalLibrary);\n    this.props.handleChapterSelect(playbackData.init.chapter);\n    const codeDeltasToApply = playbackData.inputs\n      .filter(\n        deltaWithTime => deltaWithTime.time <= currentTime && deltaWithTime.type === 'codeDelta'\n      )\n      .map(deltaWithTime => deltaWithTime.data as CodeDelta);\n    this.applyDeltas(codeDeltasToApply);\n\n    const futureData = playbackData.inputs.filter(\n      deltaWithTime => deltaWithTime.time > currentTime\n    );\n    const len = futureData.length;\n    let i = 0;\n    while (i < len && this.state.currentDeltaRevision === currentRevision) {\n      currentTime = this.audio.current!.currentTime * 1000;\n      if (futureData[i].time < currentTime) {\n        this.props.handleSetInputToApply(futureData[i]);\n        i++;\n        continue;\n      }\n      await sleep(20);\n    }\n  };\n\n  private stopCurrentPlayback() {\n    this.setState({\n      currentDeltaRevision: this.state.currentDeltaRevision + 1\n    });\n  }\n\n  private handlePlayerPausing = () => {\n    const audio = this.audio.current;\n    audio!.pause();\n    this.props.handleSetIsEditorReadonly(false);\n    this.props.handleSetSourcecastStatus(PlaybackStatus.paused);\n    this.stopCurrentPlayback();\n  };\n\n  private handlePlayerPlaying = () => {\n    const audio = this.audio.current;\n    audio!.play();\n    this.props.handleSetIsEditorReadonly(true);\n    this.props.handleSetSourcecastStatus(PlaybackStatus.playing);\n    this.stopPreviousPlaybackAndApplyFromStart(this.props.playbackData);\n    if (this.props.setSelectedTab) {\n      this.props.setSelectedTab(SideContentType.mobileEditor);\n    }\n  };\n\n  private handlePlayerStopping = () => {\n    this.props.handleSetIsEditorReadonly(false);\n    this.props.handleSetSourcecastStatus(PlaybackStatus.paused);\n    this.props.handleSetCurrentPlayerTime(0);\n    this.setState({\n      currentPlayerProgress: 0\n    });\n  };\n\n  private updatePlayerTime: React.ReactEventHandler<HTMLAudioElement> = e => {\n    const { currentTime }: { currentTime: number } = e.target as HTMLMediaElement;\n    this.props.handleSetCurrentPlayerTime(currentTime);\n    this.setState({\n      currentPlayerProgress: currentTime / this.props.duration\n    });\n\n    // listening on forcedPaused status\n    if (this.props.playbackStatus === PlaybackStatus.forcedPaused) {\n      this.handlePlayerPausing();\n    }\n  };\n\n  private handlePlayerProgressBarChange = (value: number) => {\n    if (this.audio.current) {\n      const currentTime = this.props.duration * value;\n      this.audio.current.currentTime = currentTime;\n      this.props.handleSetCurrentPlayerTime(currentTime);\n      this.setState({\n        currentPlayerProgress: value\n      });\n    }\n  };\n\n  private renderLabel = (value: number) => {\n    if (this.props.duration) {\n      const totalTime = this.props.duration * value;\n      const min = Math.floor(totalTime / 60);\n      const sec = Math.floor(totalTime - min * 60);\n      const minString = min < 10 ? '0' + min : min;\n      const secString = sec < 10 ? '0' + sec : sec;\n      return minString + ':' + secString;\n    } else {\n      return '00:00';\n    }\n  };\n}\n\nexport default SourceRecorderControlBar;\n","import { Classes, Dialog } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport React, { useState } from 'react';\n\nimport { SourcecastData } from '../../features/sourceRecorder/SourceRecorderTypes';\nimport ControlButton from '../ControlButton';\n\ntype SourceRecorderDeleteCellProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleDeleteSourcecastEntry: (id: number) => void;\n};\n\ntype StateProps = {\n  data: SourcecastData;\n};\n\nconst SourceRecorderDeleteCell: React.FC<SourceRecorderDeleteCellProps> = props => {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n\n  const handleCloseDialog = () => setIsDialogOpen(false);\n  const handleOpenDialog = () => setIsDialogOpen(true);\n  const handleDelete = () => {\n    const { data } = props;\n    props.handleDeleteSourcecastEntry(data.id);\n  };\n\n  return (\n    <div>\n      <ControlButton icon={IconNames.TRASH} onClick={handleOpenDialog} />\n      <Dialog\n        icon=\"info-sign\"\n        isOpen={isDialogOpen}\n        onClose={handleCloseDialog}\n        title=\"Delete Sourcecast\"\n        canOutsideClickClose={true}\n      >\n        <div className={Classes.DIALOG_BODY}>\n          <p>Are you sure to delete this sourcecast entry?</p>\n        </div>\n        <div className={Classes.DIALOG_FOOTER}>\n          <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n            <ControlButton label=\"Confirm Delete\" icon={IconNames.TRASH} onClick={handleDelete} />\n            <ControlButton label=\"Cancel\" icon={IconNames.CROSS} onClick={handleCloseDialog} />\n          </div>\n        </div>\n      </Dialog>\n    </div>\n  );\n};\n\nexport default SourceRecorderDeleteCell;\n","import { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport * as React from 'react';\n\nimport { PlaybackData, SourcecastData } from '../../features/sourceRecorder/SourceRecorderTypes';\nimport ControlButton from '../ControlButton';\n\ntype SourceRecorderSelectCellProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleSetSourcecastData: (\n    title: string,\n    description: string,\n    uid: string,\n    audioUrl: string,\n    playbackData: PlaybackData\n  ) => void;\n};\n\ntype StateProps = {\n  data: SourcecastData;\n};\n\nclass SourceRecorderSelectCell extends React.Component<SourceRecorderSelectCellProps, {}> {\n  public constructor(props: SourceRecorderSelectCellProps) {\n    super(props);\n  }\n\n  public render() {\n    return (\n      <Tooltip2 content=\"Load Sourcecast Recording\">\n        <ControlButton\n          label={`${this.props.data.title}`}\n          icon={IconNames.PAPERCLIP}\n          onClick={this.handleSelect}\n        />\n      </Tooltip2>\n    );\n  }\n\n  private handleSelect = () => {\n    const { data } = this.props;\n    this.props.handleSetSourcecastData(\n      data.title,\n      data.description,\n      data.uid,\n      data.url,\n      JSON.parse(data.playbackData)\n    );\n  };\n}\n\nexport default SourceRecorderSelectCell;\n","import { IconNames } from '@blueprintjs/icons';\nimport { Popover2, Tooltip2 } from '@blueprintjs/popover2';\nimport * as React from 'react';\nimport * as CopyToClipboard from 'react-copy-to-clipboard';\n\nimport { SourcecastData } from '../../features/sourceRecorder/SourceRecorderTypes';\nimport ControlButton from '../ControlButton';\n\ntype SourceRecorderShareCellProps = StateProps;\n\ntype StateProps = {\n  data: SourcecastData;\n  courseId?: number;\n};\n\ntype State = {\n  shareURL: string;\n};\n\nclass SourceRecorderShareCell extends React.Component<SourceRecorderShareCellProps, State> {\n  private shareInputElem: React.RefObject<HTMLInputElement>;\n\n  public constructor(props: SourceRecorderShareCellProps) {\n    super(props);\n    this.shareInputElem = React.createRef();\n    this.selectShareInputText = this.selectShareInputText.bind(this);\n    const url = `${window.location.protocol}//${window.location.host}/courses/${props.courseId}/sourcecast/${props.data.uid}`;\n    this.state = {\n      shareURL: url\n    };\n  }\n\n  public render() {\n    const shareButtonPopoverContent = (\n      <div key={this.state.shareURL}>\n        <input defaultValue={this.state.shareURL} readOnly={true} ref={this.shareInputElem} />\n        <Tooltip2 content=\"Copy link to clipboard\">\n          <CopyToClipboard text={this.state.shareURL}>\n            <ControlButton icon={IconNames.DUPLICATE} onClick={this.selectShareInputText} />\n          </CopyToClipboard>\n        </Tooltip2>\n      </div>\n    );\n\n    return (\n      <Popover2\n        popoverClassName=\"Popover-share\"\n        inheritDarkTheme={false}\n        content={shareButtonPopoverContent}\n      >\n        <Tooltip2 content=\"Get shareable link\">\n          <ControlButton icon={IconNames.SHARE} />\n        </Tooltip2>\n      </Popover2>\n    );\n  }\n\n  private selectShareInputText() {\n    if (this.shareInputElem.current !== null) {\n      this.shareInputElem.current.focus();\n      this.shareInputElem.current.select();\n    }\n  }\n}\n\nexport default SourceRecorderShareCell;\n","import 'ag-grid-community/dist/styles/ag-grid.css';\n\nimport {\n  Divider,\n  FormGroup,\n  InputGroup,\n  NonIdealState,\n  Spinner,\n  SpinnerSize\n} from '@blueprintjs/core';\nimport { ColDef, GridApi, GridReadyEvent } from 'ag-grid-community';\nimport { AgGridReact } from 'ag-grid-react';\nimport { sortBy } from 'lodash';\nimport * as React from 'react';\n\nimport { PlaybackData, SourcecastData } from '../../features/sourceRecorder/SourceRecorderTypes';\nimport { getStandardDate } from '../utils/DateHelper';\nimport SourcastDeleteCell from './SourceRecorderDeleteCell';\nimport SourceRecorderSelectCell from './SourceRecorderSelectCell';\nimport SourceRecorderShareCell from './SourceRecorderShareCell';\n\ntype SourceRecorderTableProps = OwnProps;\n\ntype OwnProps = {\n  handleDeleteSourcecastEntry?: (id: number) => void;\n  handleSetSourcecastData?: (\n    title: string,\n    description: string,\n    uid: string,\n    audioUrl: string,\n    playbackData: PlaybackData\n  ) => void;\n  sourcecastIndex: SourcecastData[] | null;\n  courseId?: number;\n};\n\n/**\n * Column Definitions are defined within the state, so that data\n * can be manipulated easier. See constructor for an example.\n */\ntype State = {\n  columnDefs: ColDef[];\n  filterValue: string;\n  groupFilterEnabled: boolean;\n};\n\nclass SourcecastTable extends React.Component<SourceRecorderTableProps, State> {\n  private defaultColumnDefs: ColDef;\n  private gridApi?: GridApi;\n\n  public constructor(props: SourceRecorderTableProps) {\n    super(props);\n\n    this.state = {\n      columnDefs: [\n        {\n          headerName: 'Title',\n          field: 'title',\n          cellRendererFramework: SourceRecorderSelectCell,\n          cellRendererParams: {\n            handleSetSourcecastData: this.props.handleSetSourcecastData\n          },\n          minWidth: 200,\n          suppressMovable: true,\n          suppressMenu: true,\n          cellStyle: {\n            'text-align': 'left'\n          },\n          hide: !this.props.handleSetSourcecastData\n        },\n        {\n          headerName: 'Title',\n          field: 'title',\n          minWidth: 100,\n          suppressMovable: true,\n          suppressMenu: true,\n          hide: !!this.props.handleSetSourcecastData\n        },\n        {\n          headerName: 'Uploader',\n          field: 'uploader.name',\n          minWidth: 150,\n          suppressMovable: true,\n          suppressMenu: true,\n          cellStyle: {\n            'text-align': 'center'\n          }\n        },\n        {\n          headerName: 'Date',\n          valueGetter: params => getStandardDate(params.data.inserted_at),\n          minWidth: 150,\n          suppressMovable: true,\n          suppressMenu: true\n        },\n        {\n          headerName: 'Share',\n          field: 'uid',\n          cellRendererFramework: SourceRecorderShareCell,\n          cellRendererParams: {\n            courseId: this.props.courseId\n          },\n          minWidth: 80,\n          suppressMovable: true,\n          suppressMenu: true\n        },\n        {\n          headerName: 'Delete',\n          field: '',\n          cellRendererFramework: SourcastDeleteCell,\n          cellRendererParams: {\n            handleDeleteSourcecastEntry: this.props.handleDeleteSourcecastEntry\n          },\n          minWidth: 100,\n          maxWidth: 100,\n          sortable: false,\n          suppressMovable: true,\n          suppressMenu: true,\n          cellStyle: {\n            'text-align': 'center'\n          },\n          hide: !this.props.handleDeleteSourcecastEntry\n        },\n        { headerName: 'description', field: 'description', hide: true },\n        { headerName: 'inserted_at', field: 'inserted_at', hide: true },\n        { headerName: 'updated_at', field: 'updated_at', hide: true },\n        { headerName: 'audio', field: 'audio', hide: true },\n        { headerName: 'playbackData', field: 'playbackData', hide: true },\n        { headerName: 'url', field: 'url', hide: true }\n      ],\n      filterValue: '',\n      groupFilterEnabled: false\n    };\n\n    this.defaultColumnDefs = {\n      filter: true,\n      resizable: true,\n      sortable: true\n    };\n  }\n\n  public render() {\n    /* Display either a loading screen or a table with overviews. */\n    const loadingDisplay = (\n      <NonIdealState\n        className=\"Sourcecast\"\n        description=\"Fetching sourcecast index...\"\n        icon={<Spinner size={SpinnerSize.LARGE} />}\n      />\n    );\n    const data = sortBy(this.props.sourcecastIndex, [(a: SourcecastData) => -a.id]);\n\n    const grid = (\n      <div className=\"SourcecastContainer\">\n        <br />\n        <div>\n          <FormGroup label=\"\" labelFor=\"text-input\">\n            <InputGroup\n              id=\"searchBar\"\n              large={false}\n              leftIcon=\"search\"\n              placeholder=\"Search\"\n              value={this.state.filterValue}\n              onChange={this.handleFilterChange}\n            />\n          </FormGroup>\n        </div>\n        <Divider />\n        <div className=\"SourcecastTable\">\n          <div className=\"ag-grid-parent\">\n            <AgGridReact\n              domLayout={'autoHeight'}\n              columnDefs={this.state.columnDefs}\n              defaultColDef={this.defaultColumnDefs}\n              onGridReady={this.onGridReady}\n              rowData={data}\n              rowHeight={30}\n              pagination={false}\n              paginationPageSize={50}\n            />\n          </div>\n        </div>\n        <br />\n      </div>\n    );\n    return <div>{this.props.sourcecastIndex === undefined ? loadingDisplay : grid}</div>;\n  }\n\n  private handleFilterChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const changeVal = event.target.value;\n    this.setState({ filterValue: changeVal });\n\n    if (this.gridApi) {\n      this.gridApi.setQuickFilter(changeVal);\n    }\n  };\n\n  private onGridReady = (params: GridReadyEvent) => {\n    this.gridApi = params.api;\n    this.gridApi.sizeColumnsToFit();\n    window.onresize = () => this.gridApi!.sizeColumnsToFit();\n  };\n}\n\nexport default SourcecastTable;\n","import { Classes, Pre } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { RouteComponentProps } from 'react-router';\nimport {\n  beginDebuggerPause,\n  beginInterruptExecution,\n  debuggerReset,\n  debuggerResume\n} from 'src/commons/application/actions/InterpreterActions';\nimport { useResponsive } from 'src/commons/utils/Hooks';\nimport {\n  browseReplHistoryDown,\n  browseReplHistoryUp,\n  changeSideContentHeight,\n  clearReplOutput,\n  navigateToDeclaration,\n  promptAutocomplete,\n  setEditorBreakpoint,\n  setIsEditorReadonly,\n  toggleEditorAutorun,\n  updateReplValue\n} from 'src/commons/workspace/WorkspaceActions';\nimport { WorkspaceLocation } from 'src/commons/workspace/WorkspaceTypes';\nimport { fetchSourcecastIndex } from 'src/features/sourceRecorder/sourcecast/SourcecastActions';\nimport {\n  setCodeDeltasToApply,\n  setCurrentPlayerTime,\n  setInputToApply,\n  setSourcecastDuration\n} from 'src/features/sourceRecorder/SourceRecorderActions';\n\nimport { InterpreterOutput } from '../../commons/application/ApplicationTypes';\nimport { ExternalLibraryName } from '../../commons/application/types/ExternalTypes';\nimport { ControlBarAutorunButtons } from '../../commons/controlBar/ControlBarAutorunButtons';\nimport { ControlBarChapterSelect } from '../../commons/controlBar/ControlBarChapterSelect';\nimport { ControlBarClearButton } from '../../commons/controlBar/ControlBarClearButton';\nimport { ControlBarEvalButton } from '../../commons/controlBar/ControlBarEvalButton';\nimport {\n  convertEditorTabStateToProps,\n  SourcecastEditorContainerProps\n} from '../../commons/editor/EditorContainer';\nimport MobileWorkspace, {\n  MobileWorkspaceProps\n} from '../../commons/mobileWorkspace/MobileWorkspace';\nimport SideContentDataVisualizer from '../../commons/sideContent/SideContentDataVisualizer';\nimport SideContentEnvVisualizer from '../../commons/sideContent/SideContentEnvVisualizer';\nimport { SideContentTab, SideContentType } from '../../commons/sideContent/SideContentTypes';\nimport SourceRecorderControlBar, {\n  SourceRecorderControlBarProps\n} from '../../commons/sourceRecorder/SourceRecorderControlBar';\nimport SourceRecorderTable from '../../commons/sourceRecorder/SourceRecorderTable';\nimport Workspace, { WorkspaceProps } from '../../commons/workspace/Workspace';\nimport { EditorTabState } from '../../commons/workspace/WorkspaceTypes';\nimport {\n  CodeDelta,\n  Input,\n  PlaybackData,\n  PlaybackStatus,\n  SourcecastData\n} from '../../features/sourceRecorder/SourceRecorderTypes';\n\nexport type SourcecastProps = DispatchProps &\n  StateProps &\n  RouteComponentProps<{ sourcecastId: string }>;\n\nexport type DispatchProps = {\n  handleChapterSelect: (chapter: Chapter) => void;\n  handleEditorEval: () => void;\n  handleEditorValueChange: (val: string) => void;\n  handleExternalSelect: (externalLibraryName: ExternalLibraryName) => void;\n  handleReplEval: () => void;\n  handleSetSourcecastData: (\n    title: string,\n    description: string,\n    uid: string,\n    audioUrl: string,\n    playbackData: PlaybackData\n  ) => void;\n  handleSetSourcecastStatus: (PlaybackStatus: PlaybackStatus) => void;\n};\n\nexport type StateProps = {\n  audioUrl: string;\n  currentPlayerTime: number;\n  codeDeltasToApply: CodeDelta[] | null;\n  title: string | null;\n  description: string | null;\n  activeEditorTabIndex: number | null;\n  editorTabs: EditorTabState[];\n  externalLibraryName: ExternalLibraryName;\n  isEditorAutorun: boolean;\n  isEditorReadonly: boolean;\n  inputToApply: Input | null;\n  isRunning: boolean;\n  isDebugging: boolean;\n  enableDebugging: boolean;\n  output: InterpreterOutput[];\n  playbackDuration: number;\n  playbackData: PlaybackData;\n  playbackStatus: PlaybackStatus;\n  replValue: string;\n  sideContentHeight?: number;\n  sourcecastIndex: SourcecastData[] | null;\n  sourceChapter: Chapter;\n  sourceVariant: Variant;\n  uid: string | null;\n  courseId?: number;\n};\n\nconst workspaceLocation: WorkspaceLocation = 'sourcecast';\n\nconst Sourcecast: React.FC<SourcecastProps> = props => {\n  const { isMobileBreakpoint } = useResponsive();\n\n  const dispatch = useDispatch();\n\n  /**\n   * The default selected tab for the Sourcecast workspace is the introduction tab,\n   * which contains the ag-grid table of available Sourcecasts. This is intentional\n   * to avoid an ag-grid console warning. For more info, see issue #1152 in frontend.\n   */\n  const [selectedTab, setSelectedTab] = React.useState(SideContentType.introduction);\n\n  const handleQueryParam = React.useCallback(() => {\n    const newUid = props.match.params.sourcecastId;\n    if (newUid && newUid !== props.uid && props.sourcecastIndex) {\n      const cast = props.sourcecastIndex.find(data => data.uid === newUid);\n      if (cast) {\n        props.handleSetSourcecastData(\n          cast.title,\n          cast.description,\n          cast.uid,\n          cast.url,\n          JSON.parse(cast.playbackData)\n        );\n      }\n    }\n  }, [props]);\n\n  React.useEffect(() => {\n    dispatch(fetchSourcecastIndex(workspaceLocation));\n    // This effect should only fire once on component mount\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  React.useEffect(() => {\n    handleQueryParam();\n\n    const { inputToApply } = props;\n\n    if (!inputToApply) {\n      return;\n    }\n\n    switch (inputToApply.type) {\n      case 'activeTabChange':\n        setSelectedTab(inputToApply.data);\n        break;\n      case 'chapterSelect':\n        props.handleChapterSelect(inputToApply.data);\n        break;\n      case 'externalLibrarySelect':\n        props.handleExternalSelect(inputToApply.data);\n        break;\n      case 'forcePause':\n        props.handleSetSourcecastStatus(PlaybackStatus.forcedPaused);\n        break;\n    }\n    // This effect should only fire when props.inputToApply changes\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [handleQueryParam, props.inputToApply]);\n\n  /**\n   * Handles toggling of relevant SideContentTabs when exiting the mobile breakpoint\n   */\n  React.useEffect(() => {\n    if (\n      !isMobileBreakpoint &&\n      (selectedTab === SideContentType.mobileEditor ||\n        selectedTab === SideContentType.mobileEditorRun)\n    ) {\n      setSelectedTab(SideContentType.introduction);\n    }\n  }, [isMobileBreakpoint, props, selectedTab]);\n\n  const autorunButtons = (\n    <ControlBarAutorunButtons\n      handleDebuggerPause={() => dispatch(beginDebuggerPause(workspaceLocation))}\n      handleDebuggerReset={() => dispatch(debuggerReset(workspaceLocation))}\n      handleDebuggerResume={() => dispatch(debuggerResume(workspaceLocation))}\n      handleEditorEval={props.handleEditorEval}\n      handleInterruptEval={() => dispatch(beginInterruptExecution(workspaceLocation))}\n      handleToggleEditorAutorun={() => dispatch(toggleEditorAutorun(workspaceLocation))}\n      isDebugging={props.isDebugging}\n      isEditorAutorun={props.isEditorAutorun}\n      isRunning={props.isRunning}\n      key=\"autorun\"\n    />\n  );\n\n  const chapterSelectHandler = ({ chapter }: { chapter: Chapter }, e: any) =>\n    props.handleChapterSelect(chapter);\n\n  const chapterSelect = (\n    <ControlBarChapterSelect\n      handleChapterSelect={chapterSelectHandler}\n      sourceChapter={props.sourceChapter}\n      sourceVariant={props.sourceVariant}\n      key=\"chapter\"\n    />\n  );\n\n  const clearButton = (\n    <ControlBarClearButton\n      handleReplOutputClear={() => dispatch(clearReplOutput(workspaceLocation))}\n      key=\"clear_repl\"\n    />\n  );\n\n  const evalButton = (\n    <ControlBarEvalButton\n      handleReplEval={props.handleReplEval}\n      isRunning={props.isRunning}\n      key=\"eval_repl\"\n    />\n  );\n\n  const tabs: SideContentTab[] = [\n    {\n      label: 'Sourcecast Table',\n      iconName: IconNames.HOME,\n      body: (\n        <div>\n          <span className=\"Multi-line\">\n            <Pre>\n              {props.title\n                ? 'Title: ' + props.title + '\\nDescription: ' + props.description\n                : INTRODUCTION}\n            </Pre>\n          </span>\n          <SourceRecorderTable\n            handleSetSourcecastData={props.handleSetSourcecastData}\n            sourcecastIndex={props.sourcecastIndex}\n            courseId={props.courseId}\n          />\n        </div>\n      ),\n      id: SideContentType.introduction\n    },\n    dataVisualizerTab,\n    envVisualizerTab\n  ];\n\n  const onChangeTabs = (\n    newTabId: SideContentType,\n    prevTabId: SideContentType,\n    event: React.MouseEvent<HTMLElement>\n  ) => {\n    if (newTabId === prevTabId) {\n      return;\n    }\n    setSelectedTab(newTabId);\n  };\n\n  const editorContainerProps: SourcecastEditorContainerProps = {\n    editorVariant: 'sourcecast',\n    editorTabs: props.editorTabs.map(convertEditorTabStateToProps),\n    codeDeltasToApply: props.codeDeltasToApply,\n    isEditorReadonly: props.isEditorReadonly,\n    editorSessionId: '',\n    handleDeclarationNavigate: cursorPosition =>\n      dispatch(navigateToDeclaration(workspaceLocation, cursorPosition)),\n    handleEditorEval: props.handleEditorEval,\n    handleEditorValueChange: props.handleEditorValueChange,\n    isEditorAutorun: props.isEditorAutorun,\n    inputToApply: props.inputToApply,\n    isPlaying: props.playbackStatus === PlaybackStatus.playing,\n    handleEditorUpdateBreakpoints: breakpoints =>\n      dispatch(setEditorBreakpoint(breakpoints, workspaceLocation))\n  };\n\n  const replProps = {\n    output: props.output,\n    replValue: props.replValue,\n    handleBrowseHistoryDown: () => dispatch(browseReplHistoryDown(workspaceLocation)),\n    handleBrowseHistoryUp: () => dispatch(browseReplHistoryUp(workspaceLocation)),\n    handleReplEval: props.handleReplEval,\n    handleReplValueChange: (newValue: string) =>\n      dispatch(updateReplValue(newValue, workspaceLocation)),\n    sourceChapter: props.sourceChapter,\n    sourceVariant: props.sourceVariant,\n    externalLibrary: props.externalLibraryName,\n    replButtons: [evalButton, clearButton]\n  };\n\n  const sideBarProps = {\n    tabs: []\n  };\n\n  const workspaceProps: WorkspaceProps = {\n    controlBarProps: {\n      editorButtons: [autorunButtons, chapterSelect]\n    },\n    editorContainerProps: editorContainerProps,\n    handleSideContentHeightChange: change =>\n      dispatch(changeSideContentHeight(change, workspaceLocation)),\n    replProps: replProps,\n    sideBarProps: sideBarProps,\n    sideContentHeight: props.sideContentHeight,\n    sideContentProps: {\n      selectedTabId: selectedTab,\n      onChange: onChangeTabs,\n      tabs: {\n        beforeDynamicTabs: tabs,\n        afterDynamicTabs: []\n      },\n      workspaceLocation: 'sourcecast',\n      sideContentHeight: props.sideContentHeight\n    }\n  };\n  const mobileWorkspaceProps: MobileWorkspaceProps = {\n    editorContainerProps: editorContainerProps,\n    replProps: replProps,\n    sideBarProps: sideBarProps,\n    mobileSideContentProps: {\n      mobileControlBarProps: {\n        editorButtons: [autorunButtons, chapterSelect]\n      },\n      selectedTabId: selectedTab,\n      onChange: onChangeTabs,\n      tabs: {\n        beforeDynamicTabs: tabs,\n        afterDynamicTabs: []\n      },\n      workspaceLocation: 'sourcecast'\n    }\n  };\n\n  const sourcecastControlbarProps: SourceRecorderControlBarProps = {\n    handleEditorValueChange: props.handleEditorValueChange,\n    handlePromptAutocomplete: (row, col, callback) =>\n      dispatch(promptAutocomplete(workspaceLocation, row, col, callback)),\n    handleSetCurrentPlayerTime: (playerTime: number) =>\n      dispatch(setCurrentPlayerTime(playerTime, workspaceLocation)),\n    handleSetCodeDeltasToApply: (deltas: CodeDelta[]) =>\n      dispatch(setCodeDeltasToApply(deltas, workspaceLocation)),\n    handleSetIsEditorReadonly: (editorReadonly: boolean) =>\n      dispatch(setIsEditorReadonly(workspaceLocation, editorReadonly)),\n    handleSetInputToApply: inputToApply =>\n      dispatch(setInputToApply(inputToApply, workspaceLocation)),\n    handleSetSourcecastDuration: (duration: number) =>\n      dispatch(setSourcecastDuration(duration, workspaceLocation)),\n    handleSetSourcecastStatus: props.handleSetSourcecastStatus,\n    audioUrl: props.audioUrl,\n    currentPlayerTime: props.currentPlayerTime,\n    duration: props.playbackDuration,\n    playbackData: props.playbackData,\n    playbackStatus: props.playbackStatus,\n    handleChapterSelect: props.handleChapterSelect,\n    handleExternalSelect: props.handleExternalSelect,\n    setSelectedTab: setSelectedTab\n  };\n\n  return (\n    <div className={classNames('Sourcecast', Classes.DARK)}>\n      <SourceRecorderControlBar {...sourcecastControlbarProps} />\n      {isMobileBreakpoint ? (\n        <MobileWorkspace {...mobileWorkspaceProps} />\n      ) : (\n        <Workspace {...workspaceProps} />\n      )}\n    </div>\n  );\n};\n\nconst INTRODUCTION = 'Welcome to Sourcecast!';\n\nconst dataVisualizerTab: SideContentTab = {\n  label: 'Data Visualizer',\n  iconName: IconNames.EYE_OPEN,\n  body: <SideContentDataVisualizer />,\n  id: SideContentType.dataVisualizer\n};\n\nconst envVisualizerTab: SideContentTab = {\n  label: 'Env Visualizer',\n  iconName: IconNames.GLOBE,\n  body: <SideContentEnvVisualizer />,\n  id: SideContentType.envVisualizer\n};\n\nexport default Sourcecast;\n","import { Chapter, Variant } from 'c-slang/dist/types';\nimport { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { withRouter } from 'react-router';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport { OverallState } from '../../commons/application/ApplicationTypes';\nimport { ExternalLibraryName } from '../../commons/application/types/ExternalTypes';\nimport {\n  chapterSelect,\n  evalEditor,\n  evalRepl,\n  externalLibrarySelect,\n  updateEditorValue\n} from '../../commons/workspace/WorkspaceActions';\nimport { WorkspaceLocation } from '../../commons/workspace/WorkspaceTypes';\nimport {\n  setSourcecastData,\n  setSourcecastStatus\n} from '../../features/sourceRecorder/SourceRecorderActions';\nimport { PlaybackData, PlaybackStatus } from '../../features/sourceRecorder/SourceRecorderTypes';\nimport Sourcecast, { DispatchProps, StateProps } from './Sourcecast';\n\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => ({\n  audioUrl: state.workspaces.sourcecast.audioUrl,\n  currentPlayerTime: state.workspaces.sourcecast.currentPlayerTime,\n  codeDeltasToApply: state.workspaces.sourcecast.codeDeltasToApply,\n  title: state.workspaces.sourcecast.title,\n  description: state.workspaces.sourcecast.description,\n  activeEditorTabIndex: state.workspaces.sourcecast.activeEditorTabIndex,\n  editorTabs: state.workspaces.sourcecast.editorTabs,\n  externalLibraryName: state.workspaces.sourcecast.externalLibrary,\n  isEditorAutorun: state.workspaces.sourcecast.isEditorAutorun,\n  isEditorReadonly: state.workspaces.sourcecast.isEditorReadonly,\n  inputToApply: state.workspaces.sourcecast.inputToApply,\n  isRunning: state.workspaces.sourcecast.isRunning,\n  isDebugging: state.workspaces.sourcecast.isDebugging,\n  enableDebugging: state.workspaces.sourcecast.enableDebugging,\n  output: state.workspaces.sourcecast.output,\n  playbackDuration: state.workspaces.sourcecast.playbackDuration,\n  playbackData: state.workspaces.sourcecast.playbackData,\n  playbackStatus: state.workspaces.sourcecast.playbackStatus,\n  replValue: state.workspaces.sourcecast.replValue,\n  sideContentHeight: state.workspaces.sourcecast.sideContentHeight,\n  sourcecastIndex: state.workspaces.sourcecast.sourcecastIndex,\n  sourceChapter: Chapter.CALC,\n  sourceVariant: state.workspaces.sourcecast.context.variant,\n  uid: state.workspaces.sourcecast.uid,\n  courseId: state.session.courseId\n});\n\nconst location: WorkspaceLocation = 'sourcecast';\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleChapterSelect: (chapter: Chapter) => chapterSelect(chapter, Variant.DEFAULT, location),\n      handleEditorEval: () => evalEditor(location),\n      handleEditorValueChange: (val: string) => updateEditorValue(val, location),\n      handleExternalSelect: (externalLibraryName: ExternalLibraryName) =>\n        externalLibrarySelect(externalLibraryName, location),\n      handleReplEval: () => evalRepl(location),\n      handleSetSourcecastData: (\n        title: string,\n        description: string,\n        uid: string,\n        audioUrl: string,\n        playbackData: PlaybackData\n      ) => setSourcecastData(title, description, uid, audioUrl, playbackData, location),\n      handleSetSourcecastStatus: (playbackStatus: PlaybackStatus) =>\n        setSourcecastStatus(playbackStatus, location)\n    },\n    dispatch\n  );\n\nconst SourcecastContainer = withRouter(connect(mapStateToProps, mapDispatchToProps)(Sourcecast));\n\nexport default SourcecastContainer;\n","import {\n  Button,\n  Callout,\n  FileInput,\n  FormGroup,\n  H2,\n  H4,\n  HTMLSelect,\n  Icon,\n  Intent,\n  Position\n} from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Popover2 } from '@blueprintjs/popover2';\nimport { GridApi, GridReadyEvent } from 'ag-grid-community';\nimport { AgGridReact } from 'ag-grid-react';\nimport { uniqBy } from 'lodash';\nimport React from 'react';\nimport { useCSVReader } from 'react-papaparse';\nimport { Role } from 'src/commons/application/ApplicationTypes';\n\nimport Constants from '../../../../commons/utils/Constants';\n\nexport type AddUserPanelProps = OwnProps;\n\ntype OwnProps = {\n  handleAddNewUsersToCourse: (users: UsernameRoleGroup[], provider: string) => void;\n};\n\nexport type UsernameRoleGroup = {\n  username: string;\n  role: Role;\n  group?: string;\n};\n\nconst AddUserPanel: React.FC<AddUserPanelProps> = props => {\n  const [users, setUsers] = React.useState<UsernameRoleGroup[]>([]);\n  const [invalidCsvMsg, setInvalidCsvMsg] = React.useState<string | JSX.Element>('');\n  const gridApi = React.useRef<GridApi>();\n  const { CSVReader } = useCSVReader();\n\n  const columnDefs = [\n    {\n      headerName: 'Username',\n      field: 'username'\n    },\n    {\n      headerName: 'Role',\n      field: 'role'\n    },\n    {\n      headerName: 'Group',\n      field: 'group'\n    }\n  ];\n\n  const defaultColumnDefs = {\n    filter: true,\n    resizable: true,\n    sortable: true\n  };\n\n  const onGridReady = (params: GridReadyEvent) => {\n    gridApi.current = params.api;\n  };\n\n  const grid = (\n    <div className=\"Grid ag-grid-parent ag-theme-balham\">\n      <AgGridReact\n        domLayout={'autoHeight'}\n        columnDefs={columnDefs}\n        defaultColDef={defaultColumnDefs}\n        onGridReady={onGridReady}\n        onGridSizeChanged={() => gridApi.current?.sizeColumnsToFit()}\n        rowData={users}\n        rowHeight={36}\n        suppressCellSelection={true}\n        suppressMovableColumns={true}\n        pagination\n      />\n    </div>\n  );\n\n  const htmlSelectOptions = [...Constants.authProviders.entries()].map(([id, _]) => id);\n  const [provider, setProvider] = React.useState(htmlSelectOptions[0]);\n\n  const validateCsvInput = (results: any) => {\n    const { data, errors }: { data: string[][]; errors: any[] } = results;\n\n    // react-papaparse upload errors\n    if (!!errors.length) {\n      setInvalidCsvMsg(\n        'Error detected while uploading the CSV file! Please recheck the file and try again.'\n      );\n      return;\n    }\n\n    /**\n     * Begin CSV validation.\n     *\n     * Terminate early if validation errors are encountered, and do not add to existing\n     * valid uploaded entries in the table\n     */\n    const processed: UsernameRoleGroup[] = [...users];\n\n    if (data.length + users.length > 1000) {\n      setInvalidCsvMsg('Please limit each upload to 1000 entries!');\n      return;\n    }\n\n    for (let i = 0; i < data.length; i++) {\n      // Incorrect number of columns\n      if (!(data[i].length === 2 || data[i].length === 3)) {\n        setInvalidCsvMsg(\n          <>\n            <div>\n              Invalid format (line {i})! Please ensure that the username and role is specified for\n              each row entry!\n            </div>\n            <br />\n            <div>\n              Format: <i>username,role</i> <b>OR</b> <i>username,role,group</i>\n            </div>\n            <br />\n            <div>(please hover over the question mark above for more details)</div>\n          </>\n        );\n        return;\n      }\n      // Invalid role specified\n      if (!Object.values(Role).includes(data[i][1] as Role)) {\n        setInvalidCsvMsg(\n          `Invalid role (line ${i})! Please ensure that the second column of each entry contains one of the following: 'admin, staff, student'`\n        );\n        return;\n      }\n    }\n\n    data.forEach(e => {\n      processed.push({\n        username: e[0],\n        role: e[1] as Role,\n        group: e[2]\n      });\n    });\n\n    // Check for duplicate usernames in data\n    if (uniqBy(processed, val => val.username).length !== processed.length) {\n      setInvalidCsvMsg('There are duplicate usernames in the uploaded CSV(s)!');\n      return;\n    }\n\n    // No validation errors\n    setUsers(processed);\n    setInvalidCsvMsg('');\n  };\n\n  const submitHandler = () => {\n    props.handleAddNewUsersToCourse(users, provider);\n    setUsers([]);\n    setProvider(htmlSelectOptions[0]);\n  };\n\n  return (\n    <div className=\"add-users\">\n      <H2>Add Users</H2>\n      {grid}\n      <H4>Upload a CSV file to mass insert or update users in your course.</H4>\n      <div className=\"upload-container\">\n        <div>\n          <div className=\"upload-settings\">\n            <div className=\"file-input\">\n              <CSVReader\n                onUploadAccepted={(results: any) => validateCsvInput(results)}\n                config={{\n                  delimiter: ',',\n                  skipEmptyLines: true\n                }}\n              >\n                {({ getRootProps, acceptedFile, ProgressBar, getRemoveFileProps }: any) => (\n                  <>\n                    <FileInput text=\"Upload CSV\" inputProps={getRootProps()} />\n                    <Popover2\n                      content={\n                        <div>\n                          <p>\n                            <u>CSV Format</u>: &nbsp;\n                            <b>\n                              <i>username,role</i>\n                            </b>\n                            &nbsp;&nbsp;OR&nbsp;&nbsp;\n                            <b>\n                              <i>username,role,group</i>\n                            </b>\n                          </p>\n                          <p>\n                            <b>\n                              <i>username</i>\n                            </b>\n                            : the username of the learner in the corresponding authentication\n                            provider\n                          </p>\n                          <p>\n                            <b>\n                              <i>role</i>\n                            </b>\n                            : the role of the learner in this course{' '}\n                            <i>(admin | staff | student)</i>\n                          </p>\n                          <p>\n                            <b>\n                              <i>group (optional)</i>\n                            </b>\n                            : the group name that the learner belongs to in this course\n                          </p>\n                          <p>\n                            <i>\n                              (*Note that staff or admin will automatically be assigned as group\n                              leader and each group\n                            </i>\n                          </p>\n                          <p>\n                            <i>\n                              can only have one leader. If there are duplicates the latest entry\n                              will take effect)\n                            </i>\n                          </p>\n\n                          <p>&nbsp;</p>\n                          <p>\n                            <u>Examples:</u>\n                          </p>\n                          <p>\n                            <i>\n                              (Luminus): &nbsp;e1234567,student &nbsp;&nbsp;\n                              e1234567,student,Group1\n                            </i>\n                          </p>\n                          <p>\n                            <i>\n                              (Google): &nbsp;learner@gmail.com,staff &nbsp;&nbsp;\n                              learner@gmail.com,staff,Group1\n                            </i>\n                          </p>\n                          <p>\n                            <i>\n                              (GitHub): &nbsp;ghusername,admin &nbsp;&nbsp; ghusername,admin,Group1\n                            </i>\n                          </p>\n                        </div>\n                      }\n                      interactionKind=\"hover\"\n                      position={Position.TOP}\n                      popoverClassName=\"file-input-popover\"\n                    >\n                      <Icon icon={IconNames.HELP} className=\"file-input-icon\" />\n                    </Popover2>\n                  </>\n                )}\n              </CSVReader>\n            </div>\n\n            <FormGroup\n              className=\"html-select\"\n              label={\n                <div className=\"html-select-label\">\n                  <div>Authentication Provider</div>\n                  <Popover2\n                    content=\"The authentication provider your learners will use to log in with\"\n                    interactionKind=\"hover-target\"\n                    position={Position.TOP}\n                    popoverClassName=\"html-select-popover\"\n                  >\n                    <Icon icon={IconNames.HELP} className=\"html-select-label-icon\" />\n                  </Popover2>\n                </div>\n              }\n              inline\n            >\n              <HTMLSelect\n                options={htmlSelectOptions}\n                value={provider}\n                onChange={e => setProvider(e.target.value)}\n              />\n            </FormGroup>\n          </div>\n          {invalidCsvMsg && (\n            <Callout intent={Intent.DANGER} title=\"Invalid CSV file provided!\">\n              {invalidCsvMsg}\n            </Callout>\n          )}\n        </div>\n      </div>\n      <Button\n        className=\"add-button\"\n        text=\"Add Users\"\n        intent={users.length === 0 ? Intent.NONE : Intent.WARNING}\n        onClick={submitHandler}\n      />\n    </div>\n  );\n};\n\nexport default AddUserPanel;\n","import { Switch } from '@blueprintjs/core';\nimport React from 'react';\nimport { KeysOfType } from 'src/commons/utils/TypeHelper';\n\nimport { AssessmentConfiguration } from '../../../../../commons/assessment/AssessmentTypes';\n\ntype BooleanCellProps = OwnProps;\n\ntype OwnProps = {\n  data: AssessmentConfiguration;\n  field: KeysOfType<AssessmentConfiguration, boolean>;\n  rowIndex: number;\n  setStateHandler: (index: number, value: boolean) => void;\n};\n\nconst BooleanCell: React.FC<BooleanCellProps> = props => {\n  const { data } = props;\n  const checked = data[props.field];\n\n  const changeHandler = React.useCallback(() => {\n    props.setStateHandler(props.rowIndex, !checked);\n  }, [props, checked]);\n\n  return <Switch checked={checked} onChange={changeHandler} />;\n};\n\nexport default BooleanCell;\n","import { Button, Classes, Dialog, Intent } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport React from 'react';\nimport { AssessmentConfiguration } from 'src/commons/assessment/AssessmentTypes';\nimport ControlButton from 'src/commons/ControlButton';\n\ntype DeleteRowCellProps = OwnProps;\n\ntype OwnProps = {\n  data: AssessmentConfiguration;\n  rowIndex: number;\n  deleteRowHandler: (index: number) => void;\n};\n\nconst DeleteRowCell: React.FC<DeleteRowCellProps> = props => {\n  const [isDialogOpen, setIsDialogOpen] = React.useState<boolean>(false);\n\n  const clickHandler = () => {\n    setIsDialogOpen(true);\n  };\n  const handleDelete = React.useCallback(() => {\n    props.deleteRowHandler(props.rowIndex);\n    setIsDialogOpen(false);\n  }, [props]);\n\n  return (\n    <>\n      <Button icon={IconNames.CROSS} onClick={clickHandler} />\n      <Dialog\n        icon={IconNames.WARNING_SIGN}\n        isOpen={isDialogOpen}\n        onClose={() => setIsDialogOpen(false)}\n        title=\"Warning\"\n      >\n        <div className={Classes.DIALOG_BODY}>\n          <p>\n            Are you sure you want to <b>delete</b> the assessment type <i>{props.data.type}</i>?\n          </p>\n          <p>\n            <b>\n              All related assessments, submissions and answers will be deleted as well upon clicking\n              the main save button.\n            </b>\n          </p>\n        </div>\n        <div className={Classes.DIALOG_FOOTER}>\n          <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n            <ControlButton\n              label=\"Cancel\"\n              icon={IconNames.CROSS}\n              onClick={() => setIsDialogOpen(false)}\n              options={{ minimal: false }}\n            />\n            <ControlButton\n              label=\"Ok\"\n              icon={IconNames.TICK}\n              onClick={handleDelete}\n              options={{ minimal: false, intent: Intent.WARNING }}\n            />\n          </div>\n        </div>\n      </Dialog>\n    </>\n  );\n};\nexport default DeleteRowCell;\n","import { NumericInput } from '@blueprintjs/core';\nimport React from 'react';\nimport { AssessmentConfiguration } from 'src/commons/assessment/AssessmentTypes';\nimport { KeysOfType } from 'src/commons/utils/TypeHelper';\n\ntype NumericCellProps = OwnProps;\n\ntype OwnProps = {\n  data: AssessmentConfiguration;\n  field: KeysOfType<AssessmentConfiguration, number>;\n  rowIndex: number;\n  setStateHandler: (index: number, value: number) => void;\n};\n\nconst NumericCell: React.FC<NumericCellProps> = props => {\n  const { data } = props;\n\n  const changeHandler = React.useCallback(\n    (value: number) => {\n      props.setStateHandler(props.rowIndex, value);\n    },\n    [props]\n  );\n\n  return (\n    <NumericInput\n      value={data[props.field]}\n      min={0}\n      clampValueOnBlur\n      onValueChange={changeHandler}\n    />\n  );\n};\nexport default NumericCell;\n","import { Button, H2 } from '@blueprintjs/core';\nimport { CellValueChangedEvent, GridApi, GridReadyEvent, RowDragEvent } from 'ag-grid-community';\nimport { AgGridReact } from 'ag-grid-react';\nimport { isEqual } from 'lodash';\nimport React from 'react';\nimport { showWarningMessage } from 'src/commons/utils/NotificationsHelper';\n\nimport { AssessmentConfiguration } from '../../../../../commons/assessment/AssessmentTypes';\nimport BooleanCell from './BooleanCell';\nimport DeleteRowCell from './DeleteRowCell';\nimport NumericCell from './NumericCell';\n\nexport type AssessmentConfigPanelProps = OwnProps;\n\ntype OwnProps = {\n  assessmentConfig: React.MutableRefObject<AssessmentConfiguration[]>;\n  setAssessmentConfig: (assessmentConfig: AssessmentConfiguration[]) => void;\n  setAssessmentConfigsToDelete: (assessmentConfig: AssessmentConfiguration) => void;\n  setHasChangesAssessmentConfig: (val: boolean) => void;\n};\n\nconst AssessmentConfigPanel: React.FC<AssessmentConfigPanelProps> = props => {\n  const { assessmentConfig, setAssessmentConfig, setAssessmentConfigsToDelete } = props;\n  const gridApi = React.useRef<GridApi>();\n\n  const setIsManuallyGraded = (index: number, value: boolean) => {\n    const temp = [...assessmentConfig.current];\n    temp[index] = {\n      ...temp[index],\n      isManuallyGraded: value\n    };\n    setAssessmentConfig(temp);\n    gridApi.current?.getDisplayedRowAtIndex(index)?.setDataValue('isManuallyGraded', value);\n  };\n\n  const setDisplayInDashboard = (index: number, value: boolean) => {\n    const temp = [...assessmentConfig.current];\n    temp[index] = {\n      ...temp[index],\n      displayInDashboard: value\n    };\n    setAssessmentConfig(temp);\n    gridApi.current?.getDisplayedRowAtIndex(index)?.setDataValue('displayInDashboard', value);\n  };\n\n  const setEarlyXp = (index: number, value: number) => {\n    const temp = [...assessmentConfig.current];\n    temp[index] = {\n      ...temp[index],\n      earlySubmissionXp: value\n    };\n    setAssessmentConfig(temp);\n    gridApi.current?.getDisplayedRowAtIndex(index)?.setDataValue('earlySubmissionXp', value);\n  };\n\n  const setHoursBeforeDecay = (index: number, value: number) => {\n    const temp = [...assessmentConfig.current];\n    temp[index] = {\n      ...temp[index],\n      hoursBeforeEarlyXpDecay: value\n    };\n    setAssessmentConfig(temp);\n    gridApi.current?.getDisplayedRowAtIndex(index)?.setDataValue('hoursBeforeEarlyXpDecay', value);\n  };\n\n  const addRowHandler = () => {\n    if (assessmentConfig.current.length >= 8) {\n      showWarningMessage('You can have at most 8 assessment types!');\n      return;\n    }\n\n    const temp = [...assessmentConfig.current];\n    temp.push({\n      assessmentConfigId: -1,\n      type: 'untitled',\n      isManuallyGraded: true,\n      displayInDashboard: true,\n      hoursBeforeEarlyXpDecay: 0,\n      earlySubmissionXp: 0\n    });\n    setAssessmentConfig(temp);\n    gridApi.current?.setRowData(temp);\n  };\n\n  const deleteRowHandler = (index: number) => {\n    if (assessmentConfig.current.length <= 1) {\n      showWarningMessage('You must have at least 1 assessment type!');\n      return;\n    }\n\n    const temp = [...assessmentConfig.current];\n    const deleted = temp.splice(index, 1);\n    gridApi.current?.setRowData(temp);\n    setAssessmentConfig(temp);\n    setAssessmentConfigsToDelete(deleted[0]);\n  };\n\n  const columnDefs = [\n    {\n      headerName: 'Assessment Type',\n      field: 'type',\n      rowDrag: true,\n      editable: true\n    },\n    {\n      headerName: 'Is Manually Graded',\n      field: 'isManuallyGraded',\n      cellRendererFramework: BooleanCell,\n      cellRendererParams: {\n        setStateHandler: setIsManuallyGraded,\n        field: 'isManuallyGraded'\n      }\n    },\n    {\n      headerName: 'Display in Dashboard',\n      field: 'displayInDashboard',\n      cellRendererFramework: BooleanCell,\n      cellRendererParams: {\n        setStateHandler: setDisplayInDashboard,\n        field: 'displayInDashboard'\n      }\n    },\n    {\n      headerName: 'Max Bonus XP',\n      field: 'earlySubmissionXp',\n      cellRendererFramework: NumericCell,\n      cellRendererParams: {\n        setStateHandler: setEarlyXp,\n        field: 'earlySubmissionXp'\n      }\n    },\n    {\n      headerName: 'Early Hours Before Decay',\n      field: 'hoursBeforeEarlyXpDecay',\n      cellRendererFramework: NumericCell,\n      cellRendererParams: {\n        setStateHandler: setHoursBeforeDecay,\n        field: 'hoursBeforeEarlyXpDecay'\n      }\n    },\n    {\n      headerName: 'Delete Row',\n      field: 'placeholderToPreventColumnRerender',\n      cellRendererFramework: DeleteRowCell,\n      cellRendererParams: {\n        deleteRowHandler: deleteRowHandler\n      },\n      maxWidth: 120,\n      resizable: false\n    }\n  ];\n\n  const defaultColumnDefs = {\n    filter: false,\n    resizable: true,\n    sortable: false\n  };\n\n  // Tracks the movement of rows in our local React state while dragging\n  const onRowDragMove = React.useCallback(\n    (event: RowDragEvent) => {\n      const movingNode = event.node;\n      const overNode = event.overNode;\n      const rowNeedsToMove = movingNode !== overNode;\n      if (rowNeedsToMove) {\n        const movingData = movingNode.data;\n        const overData = overNode?.data;\n        const fromIndex = indexOfObject(assessmentConfig.current, movingData);\n        const toIndex = indexOfObject(assessmentConfig.current, overData);\n\n        const temp = [...assessmentConfig.current];\n        moveInArray(temp, fromIndex, toIndex);\n        assessmentConfig.current = temp;\n      }\n    },\n    [assessmentConfig]\n  );\n\n  // Updates the data passed into ag-grid (this is necessary to update the rowIndex in our custom\n  // cellRendererFramework)\n  const onRowDragLeaveOrEnd = (event: RowDragEvent) => {\n    gridApi.current?.setRowData(assessmentConfig.current);\n    props.setHasChangesAssessmentConfig(true);\n  };\n\n  // Updates our local React state whenever there are changes to the Assessment Type column\n  const onCellValueChanged = (event: CellValueChangedEvent) => {\n    if (event.colDef.field === 'type') {\n      const temp = [...assessmentConfig.current];\n      temp[event.rowIndex!] = {\n        ...temp[event.rowIndex!],\n        type: event.value\n      };\n      assessmentConfig.current = temp;\n      props.setHasChangesAssessmentConfig(true);\n    }\n  };\n\n  const onGridReady = (params: GridReadyEvent) => {\n    gridApi.current = params.api;\n    params.api.sizeColumnsToFit();\n  };\n\n  const grid = (\n    <div className=\"Grid ag-grid-parent ag-theme-balham\">\n      <AgGridReact\n        domLayout={'autoHeight'}\n        columnDefs={columnDefs}\n        defaultColDef={defaultColumnDefs}\n        onGridReady={onGridReady}\n        onGridSizeChanged={() => gridApi.current?.sizeColumnsToFit()}\n        rowData={props.assessmentConfig.current}\n        rowHeight={36}\n        rowDragManaged={true}\n        suppressCellSelection={true}\n        suppressMovableColumns={true}\n        suppressPaginationPanel={true}\n        onRowDragMove={onRowDragMove}\n        onRowDragLeave={onRowDragLeaveOrEnd}\n        onRowDragEnd={onRowDragLeaveOrEnd}\n        onCellValueChanged={onCellValueChanged}\n      />\n    </div>\n  );\n\n  return (\n    <div className=\"assessment-configuration\">\n      <div className=\"assessment-configuration-header-container\">\n        <H2>Assessment Configuration</H2>\n        <Button text=\"Add Row\" onClick={addRowHandler} className=\"add-row-button\" />\n      </div>\n      {grid}\n    </div>\n  );\n};\n\nfunction moveInArray(arr: any[], fromIndex: number, toIndex: number): void {\n  const element = arr[fromIndex];\n  arr.splice(fromIndex, 1);\n  arr.splice(toIndex, 0, element);\n}\n\nfunction indexOfObject(arr: any[], obj: any): number {\n  for (let i = 0; i < arr.length; i++) {\n    if (isEqual(arr[i], obj)) {\n      return i;\n    }\n  }\n  return -1;\n}\n\nexport default AssessmentConfigPanel;\n","import {\n  Divider,\n  FormGroup,\n  H2,\n  H3,\n  InputGroup,\n  Switch,\n  Tab,\n  Tabs,\n  TextArea\n} from '@blueprintjs/core';\nimport * as React from 'react';\nimport { useResponsive } from 'src/commons/utils/Hooks';\n\nimport { UpdateCourseConfiguration } from '../../../../commons/application/types/SessionTypes';\nimport Markdown from '../../../../commons/Markdown';\n\nexport type CourseConfigPanelProps = OwnProps;\n\ntype OwnProps = {\n  courseConfiguration: UpdateCourseConfiguration;\n  setCourseConfiguration: (courseConfiguration: UpdateCourseConfiguration) => void;\n};\n\nexport enum CourseHelpTextEditorTab {\n  WRITE = 'WRITE',\n  PREVIEW = 'PREVIEW'\n}\n\nconst CourseConfigPanel: React.FC<CourseConfigPanelProps> = props => {\n  const { isMobileBreakpoint } = useResponsive();\n  const [courseHelpTextSelectedTab, setCourseHelpTextSelectedTab] =\n    React.useState<CourseHelpTextEditorTab>(CourseHelpTextEditorTab.WRITE);\n\n  const {\n    courseName,\n    courseShortName,\n    viewable,\n    enableGame,\n    enableAchievements,\n    enableSourcecast,\n    moduleHelpText\n  } = props.courseConfiguration;\n\n  const writePanel = (\n    <TextArea\n      id=\"moduleHelpText\"\n      className=\"input-textarea\"\n      fill={true}\n      value={moduleHelpText || ''}\n      onChange={e =>\n        props.setCourseConfiguration({\n          ...props.courseConfiguration,\n          moduleHelpText: e.target.value\n        })\n      }\n    />\n  );\n\n  const previewPanel = (\n    <div className=\"input-markdown\">\n      <Markdown content={moduleHelpText || ''} openLinksInNewWindow />\n    </div>\n  );\n\n  const onChangeTabs = React.useCallback(\n    (\n      newTabId: CourseHelpTextEditorTab,\n      prevTabId: CourseHelpTextEditorTab,\n      event: React.MouseEvent<HTMLElement>\n    ) => {\n      if (newTabId === prevTabId) {\n        return;\n      }\n      setCourseHelpTextSelectedTab(newTabId);\n    },\n    [setCourseHelpTextSelectedTab]\n  );\n\n  return (\n    <div className=\"course-configuration\">\n      <H2>{courseName}</H2>\n      <H3>{courseShortName}</H3>\n      <div className=\"inputs\">\n        <div className=\"text\">\n          <FormGroup\n            helperText=\"Please enter the course name that will be used for course selection.\"\n            inline={true}\n            label=\"Course Name\"\n            labelFor=\"courseName\"\n          >\n            <InputGroup\n              id=\"courseName\"\n              defaultValue={courseName}\n              onChange={e =>\n                props.setCourseConfiguration({\n                  ...props.courseConfiguration,\n                  courseName: e.target.value\n                })\n              }\n            />\n          </FormGroup>\n          <FormGroup\n            helperText=\"Please enter the course short name. This will be displayed on the top left.\"\n            inline={true}\n            label=\"Course Short Name\"\n            labelFor=\"courseShortName\"\n          >\n            <InputGroup\n              id=\"courseShortName\"\n              defaultValue={courseShortName}\n              onChange={e =>\n                props.setCourseConfiguration({\n                  ...props.courseConfiguration,\n                  courseShortName: e.target.value\n                })\n              }\n            />\n          </FormGroup>\n          <FormGroup\n            helperText=\"Please enter the module help text that will be used in the course help dialog.\"\n            inline={true}\n            label=\"Module Help Text\"\n            labelFor=\"moduleHelpText\"\n          >\n            <Tabs\n              selectedTabId={courseHelpTextSelectedTab}\n              onChange={onChangeTabs}\n              className=\"module-help-text-tabs\"\n            >\n              <Tab id={CourseHelpTextEditorTab.WRITE} title=\"Write\" />\n              <Tab id={CourseHelpTextEditorTab.PREVIEW} title=\"Preview\" />\n            </Tabs>\n            {courseHelpTextSelectedTab === CourseHelpTextEditorTab.WRITE && writePanel}\n            {courseHelpTextSelectedTab === CourseHelpTextEditorTab.PREVIEW && previewPanel}\n          </FormGroup>\n        </div>\n        {!isMobileBreakpoint && <Divider />}\n        <div className=\"booleans\">\n          <Switch\n            checked={viewable}\n            label=\"Viewable\"\n            onChange={e =>\n              props.setCourseConfiguration({\n                ...props.courseConfiguration,\n                viewable: (e.target as HTMLInputElement).checked\n              })\n            }\n          />\n          <Switch\n            checked={enableGame}\n            label=\"Enable Game\"\n            onChange={e =>\n              props.setCourseConfiguration({\n                ...props.courseConfiguration,\n                enableGame: (e.target as HTMLInputElement).checked\n              })\n            }\n          />\n          <Switch\n            checked={enableAchievements}\n            label=\"Enable Achievements\"\n            onChange={e =>\n              props.setCourseConfiguration({\n                ...props.courseConfiguration,\n                enableAchievements: (e.target as HTMLInputElement).checked\n              })\n            }\n          />\n          <Switch\n            checked={enableSourcecast}\n            label=\"Enable Sourcecast\"\n            onChange={e =>\n              props.setCourseConfiguration({\n                ...props.courseConfiguration,\n                enableSourcecast: (e.target as HTMLInputElement).checked\n              })\n            }\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default CourseConfigPanel;\n","import { HTMLSelect, Position } from '@blueprintjs/core';\nimport { Popover2 } from '@blueprintjs/popover2';\nimport React from 'react';\nimport { Role } from 'src/commons/application/ApplicationTypes';\nimport { AdminPanelCourseRegistration } from 'src/commons/application/types/SessionTypes';\n\ntype RolesCellProps = OwnProps;\n\ntype OwnProps = {\n  data: AdminPanelCourseRegistration;\n  rowIndex: number;\n  courseRegId: number;\n  handleUpdateUserRole: (courseRegId: number, role: Role) => void;\n};\n\nconst RolesCell: React.FC<RolesCellProps> = props => {\n  const { data } = props;\n\n  const changeHandler = React.useCallback(\n    (e: React.ChangeEvent<HTMLSelectElement>) => {\n      props.handleUpdateUserRole(data.courseRegId, e.target.value as Role);\n    },\n    [data, props]\n  );\n\n  const roleOptions = [\n    {\n      label: 'Student',\n      value: Role.Student\n    },\n    {\n      label: 'Staff',\n      value: Role.Staff\n    },\n    {\n      label: 'Admin',\n      value: Role.Admin\n    }\n  ];\n  return (\n    <Popover2\n      content=\"You cannot downgrade yourself from an admin role!\"\n      interactionKind=\"click\"\n      position={Position.TOP}\n      disabled={props.courseRegId !== data.courseRegId}\n    >\n      <HTMLSelect\n        options={roleOptions}\n        onChange={changeHandler}\n        fill\n        minimal\n        style={{ textAlign: 'center' }}\n        value={data.role}\n        disabled={props.courseRegId === data.courseRegId}\n      />\n    </Popover2>\n  );\n};\n\nexport default RolesCell;\n","import { Button, Classes, Dialog, Intent, Position } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Popover2 } from '@blueprintjs/popover2';\nimport React from 'react';\nimport { Role } from 'src/commons/application/ApplicationTypes';\nimport { AdminPanelCourseRegistration } from 'src/commons/application/types/SessionTypes';\nimport ControlButton from 'src/commons/ControlButton';\nimport { showWarningMessage } from 'src/commons/utils/NotificationsHelper';\n\ntype DeleteUserCellProps = OwnProps;\n\ntype OwnProps = {\n  data: AdminPanelCourseRegistration;\n  rowIndex: number;\n  handleDeleteUserFromCourse: (courseRegId: number) => void;\n};\n\nconst DeleteUserCell: React.FC<DeleteUserCellProps> = props => {\n  const [isDialogOpen, setIsDialogOpen] = React.useState<boolean>(false);\n\n  const clickHandler = () => {\n    if (props.data.role === Role.Admin) {\n      showWarningMessage('You cannot delete an admin user!');\n      return;\n    }\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = React.useCallback(() => {\n    props.handleDeleteUserFromCourse(props.data.courseRegId);\n    setIsDialogOpen(false);\n  }, [props]);\n\n  return (\n    <>\n      <Popover2\n        content=\"You cannot delete an admin!\"\n        interactionKind=\"click\"\n        position={Position.TOP}\n        disabled={props.data.role !== Role.Admin}\n      >\n        <Button\n          text=\"Delete User\"\n          icon={IconNames.CROSS}\n          onClick={clickHandler}\n          disabled={props.data.role === Role.Admin}\n        />\n      </Popover2>\n      <Dialog\n        icon={IconNames.WARNING_SIGN}\n        isOpen={isDialogOpen}\n        onClose={() => setIsDialogOpen(false)}\n        title=\"Deleting User From Course\"\n        canOutsideClickClose\n      >\n        <div className={Classes.DIALOG_BODY}>\n          <p>\n            Are you sure you want to <b>delete</b> the user{' '}\n            <i>\n              {props.data.name} ({props.data.username})\n            </i>\n            ?\n          </p>\n          <p>\n            <b>All their assessment answers will be deleted as well.</b>\n          </p>\n        </div>\n        <div className={Classes.DIALOG_FOOTER}>\n          <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n            <ControlButton\n              label=\"Cancel\"\n              icon={IconNames.CROSS}\n              onClick={() => setIsDialogOpen(false)}\n              options={{ minimal: false }}\n            />\n            <ControlButton\n              label=\"Confirm\"\n              icon={IconNames.TRASH}\n              onClick={handleDelete}\n              options={{ minimal: false, intent: Intent.DANGER }}\n            />\n          </div>\n        </div>\n      </Dialog>\n    </>\n  );\n};\n\nexport default DeleteUserCell;\n","import { Button, H2 } from '@blueprintjs/core';\nimport { ColDef, GridApi, GridReadyEvent } from 'ag-grid-community';\nimport { AgGridReact } from 'ag-grid-react';\nimport React from 'react';\nimport { Role } from 'src/commons/application/ApplicationTypes';\nimport { AdminPanelCourseRegistration } from 'src/commons/application/types/SessionTypes';\n\nimport RolesCell from './RolesCell';\nimport UserActionsCell from './UserActionsCell';\n\nexport type UserConfigPanelProps = OwnProps;\n\ntype OwnProps = {\n  courseRegId?: number;\n  userCourseRegistrations?: AdminPanelCourseRegistration[];\n  handleUpdateUserRole: (courseRegId: number, role: Role) => void;\n  handleDeleteUserFromCourse: (courseRegId: number) => void;\n};\n\n/**\n * Only admins can access this panel.\n * - Admins cannot be deleted\n * - An admin cannot downgrade himself to a non-admin role (only\n *   other admins can do so, to prevent a scenario where there are\n *   no admins left in a course)\n */\nconst UserConfigPanel: React.FC<UserConfigPanelProps> = props => {\n  const gridApi = React.useRef<GridApi>();\n\n  const userCourseRegistrations = props.userCourseRegistrations?.map(e =>\n    !e.name ? { ...e, name: '(user has yet to log in)' } : e\n  );\n\n  const columnDefs: ColDef[] = [\n    {\n      headerName: 'Name',\n      field: 'name',\n      sort: 'asc'\n    },\n    {\n      headerName: 'Username',\n      field: 'username'\n    },\n    {\n      headerName: 'Group',\n      field: 'group'\n    },\n    {\n      headerName: 'Role',\n      field: 'role',\n      cellRendererFramework: RolesCell,\n      cellRendererParams: {\n        courseRegId: props.courseRegId,\n        handleUpdateUserRole: props.handleUpdateUserRole\n      },\n      width: 110\n    },\n    {\n      headerName: 'Actions',\n      field: 'actions',\n      cellRendererFramework: UserActionsCell,\n      cellRendererParams: {\n        handleDeleteUserFromCourse: props.handleDeleteUserFromCourse\n      },\n      width: 120,\n      filter: false,\n      resizable: false\n    }\n  ];\n\n  const defaultColumnDefs = {\n    filter: true,\n    resizable: true,\n    sortable: true\n  };\n\n  const onGridReady = (params: GridReadyEvent) => {\n    gridApi.current = params.api;\n  };\n\n  const grid = (\n    <div className=\"Grid ag-grid-parent ag-theme-balham\">\n      <AgGridReact\n        domLayout={'autoHeight'}\n        columnDefs={columnDefs}\n        defaultColDef={defaultColumnDefs}\n        onGridReady={onGridReady}\n        onGridSizeChanged={() => gridApi.current?.sizeColumnsToFit()}\n        rowData={userCourseRegistrations}\n        rowHeight={36}\n        suppressCellSelection={true}\n        suppressMovableColumns={true}\n        pagination\n      />\n    </div>\n  );\n\n  return (\n    <div className=\"users-configuration\">\n      <div className=\"users-header-container\">\n        <H2>Users</H2>\n        <Button\n          text=\"Export as CSV\"\n          className=\"export-csv-button\"\n          onClick={() => {\n            if (gridApi.current) {\n              gridApi.current.exportDataAsCsv({\n                fileName: `SA Users (${new Date().toISOString()}).csv`,\n                columnKeys: ['name', 'username', 'group', 'role']\n              });\n            }\n          }}\n        />\n      </div>\n      {grid}\n    </div>\n  );\n};\n\nexport default UserConfigPanel;\n","import 'ag-grid-community/dist/styles/ag-theme-balham.css';\nimport 'ag-grid-community/dist/styles/ag-grid.css';\n\nimport { Button, Divider, H1, Intent, Tab, Tabs } from '@blueprintjs/core';\nimport { cloneDeep } from 'lodash';\nimport React from 'react';\nimport { Role } from 'src/commons/application/ApplicationTypes';\n\nimport {\n  AdminPanelCourseRegistration,\n  UpdateCourseConfiguration\n} from '../../../commons/application/types/SessionTypes';\nimport { AssessmentConfiguration } from '../../../commons/assessment/AssessmentTypes';\nimport ContentDisplay from '../../../commons/ContentDisplay';\nimport AddUserPanel, { UsernameRoleGroup } from './subcomponents/AddUserPanel';\nimport AssessmentConfigPanel from './subcomponents/assessmentConfigPanel/AssessmentConfigPanel';\nimport CourseConfigPanel from './subcomponents/CourseConfigPanel';\nimport UserConfigPanel from './subcomponents/userConfigPanel/UserConfigPanel';\n\nexport type AdminPanelProps = DispatchProps & StateProps;\n\nexport type DispatchProps = {\n  handleFetchCourseConfiguration: () => void;\n  handleFetchAssessmentConfigs: () => void;\n  handleFetchUserCourseRegistrations: () => void;\n  handleUpdateCourseConfig: (courseConfiguration: UpdateCourseConfiguration) => void;\n  handleUpdateAssessmentConfigs: (assessmentConfigs: AssessmentConfiguration[]) => void;\n  setAssessmentConfigurations: (assessmentConfigs: AssessmentConfiguration[]) => void;\n  handleDeleteAssessmentConfig: (assessmentConfig: AssessmentConfiguration) => void;\n  handleUpdateUserRole: (courseRegId: number, role: Role) => void;\n  handleDeleteUserFromCourse: (courseRegId: number) => void;\n  handleAddNewUsersToCourse: (users: UsernameRoleGroup[], provider: string) => void;\n};\n\nexport type StateProps = {\n  courseRegId?: number;\n  courseName?: string;\n  courseShortName?: string;\n  viewable?: boolean;\n  enableGame?: boolean;\n  enableAchievements?: boolean;\n  enableSourcecast?: boolean;\n  moduleHelpText?: string;\n  assessmentConfigurations?: AssessmentConfiguration[];\n  userCourseRegistrations?: AdminPanelCourseRegistration[];\n};\n\nconst AdminPanel: React.FC<AdminPanelProps> = props => {\n  const [hasChangesCourseConfig, setHasChangesCourseConfig] = React.useState(false);\n  const [hasChangesAssessmentConfig, setHasChangesAssessmentConfig] = React.useState(false);\n\n  const [courseConfiguration, setCourseConfiguration] = React.useState<UpdateCourseConfiguration>({\n    courseName: '',\n    courseShortName: '',\n    viewable: true,\n    enableGame: true,\n    enableAchievements: true,\n    enableSourcecast: true,\n    moduleHelpText: ''\n  });\n\n  /**\n   * Mutable ref to track the assessment configuration form state instead of useState. This is\n   * because ag-grid does not update the cellRendererParams whenever there is an update in rowData,\n   * leading to a stale closure problem where the handlers in AssessmentConfigPanel capture the old\n   * value of assessmentConfig.\n   *\n   * Also, useState causes a flicker in ag-grid during rerenders. Thus we use this mutable ref and\n   * ag-grid's API to update cell values instead.\n   */\n  const assessmentConfig = React.useRef(props.assessmentConfigurations);\n\n  // Tracks the assessment configurations to be deleted in the backend when the save button is clicked\n  const [assessmentConfigsToDelete, setAssessmentConfigsToDelete] = React.useState<\n    AssessmentConfiguration[]\n  >([]);\n\n  React.useEffect(() => {\n    props.handleFetchCourseConfiguration();\n    props.handleFetchAssessmentConfigs();\n    props.handleFetchUserCourseRegistrations();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // After updated configs have been loaded from the backend, put them into local React state\n  React.useEffect(() => {\n    setCourseConfiguration({\n      courseName: props.courseName,\n      courseShortName: props.courseShortName,\n      viewable: props.viewable,\n      enableGame: props.enableGame,\n      enableAchievements: props.enableAchievements,\n      enableSourcecast: props.enableSourcecast,\n      moduleHelpText: props.moduleHelpText\n    });\n\n    // IMPT: To prevent mutation of props\n    assessmentConfig.current = cloneDeep(props.assessmentConfigurations);\n  }, [props]);\n\n  const courseConfigPanelProps = {\n    courseConfiguration: courseConfiguration,\n    setCourseConfiguration: (courseConfig: UpdateCourseConfiguration) => {\n      setCourseConfiguration(courseConfig);\n      setHasChangesCourseConfig(true);\n    }\n  };\n\n  const assessmentConfigPanelProps = React.useMemo(() => {\n    return {\n      // Would have been loaded by the useEffect above\n      assessmentConfig: assessmentConfig as React.MutableRefObject<AssessmentConfiguration[]>,\n      setAssessmentConfig: (val: AssessmentConfiguration[]) => {\n        assessmentConfig.current = val;\n        setHasChangesAssessmentConfig(true);\n      },\n      setAssessmentConfigsToDelete: (deletedElement: AssessmentConfiguration) => {\n        // If it is not a newly created row that is yet to be persisted in the backend\n        if (deletedElement.assessmentConfigId !== -1) {\n          const temp = [...assessmentConfigsToDelete];\n          temp.push(deletedElement);\n          setAssessmentConfigsToDelete(temp);\n        }\n      },\n      setHasChangesAssessmentConfig: setHasChangesAssessmentConfig\n    };\n  }, [assessmentConfigsToDelete]);\n\n  const userConfigPanelProps = {\n    courseRegId: props.courseRegId,\n    userCourseRegistrations: props.userCourseRegistrations,\n    handleUpdateUserRole: props.handleUpdateUserRole,\n    handleDeleteUserFromCourse: props.handleDeleteUserFromCourse\n  };\n\n  const addUserPanelProps = {\n    handleAddNewUsersToCourse: props.handleAddNewUsersToCourse\n  };\n\n  // Handler to submit changes to Course Configration and Assessment Configuration to the backend.\n  // Changes made to users are handled separately.\n  const submitHandler = () => {\n    if (hasChangesCourseConfig) {\n      props.handleUpdateCourseConfig(courseConfiguration);\n      setHasChangesCourseConfig(false);\n    }\n    if (assessmentConfigsToDelete.length > 0) {\n      assessmentConfigsToDelete.forEach(assessmentConfig => {\n        props.handleDeleteAssessmentConfig(assessmentConfig);\n      });\n      setAssessmentConfigsToDelete([]);\n    }\n    if (hasChangesAssessmentConfig) {\n      // Reset the store first so that old props do not propagate down and cause a flicker\n      props.setAssessmentConfigurations([]);\n\n      // assessmentConfig.current will exist after the first load\n      props.handleUpdateAssessmentConfigs(assessmentConfig.current!);\n      setHasChangesAssessmentConfig(false);\n    }\n  };\n\n  const data = (\n    <div className=\"admin-panel\">\n      <H1>Admin Panel</H1>\n      {/* renderActiveTabPanelOnly to handle large courses with many entries in ag-grid */}\n      <Tabs id=\"admin-panel\" renderActiveTabPanelOnly>\n        <Tab\n          id=\"configuration\"\n          title=\"Configuration\"\n          panel={\n            <>\n              <CourseConfigPanel {...courseConfigPanelProps} />\n              <Divider />\n              <AssessmentConfigPanel {...assessmentConfigPanelProps} />\n              <Button\n                text=\"Save\"\n                style={{ marginTop: '15px' }}\n                intent={\n                  hasChangesCourseConfig || hasChangesAssessmentConfig\n                    ? Intent.WARNING\n                    : Intent.NONE\n                }\n                onClick={submitHandler}\n              />\n            </>\n          }\n        />\n        <Tab id=\"users\" title=\"Users\" panel={<UserConfigPanel {...userConfigPanelProps} />} />\n        <Tab id=\"add-users\" title=\"Add Users\" panel={<AddUserPanel {...addUserPanelProps} />} />\n      </Tabs>\n    </div>\n  );\n\n  return <ContentDisplay loadContentDispatch={() => {}} display={data} fullWidth={false} />;\n};\n\nexport default AdminPanel;\n","import { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\nimport { addNewUsersToCourse } from 'src/features/academy/AcademyActions';\n\nimport {\n  deleteAssessmentConfig,\n  deleteUserCourseRegistration,\n  fetchAdminPanelCourseRegistrations,\n  fetchAssessmentConfigs,\n  fetchCourseConfig,\n  setAssessmentConfigurations,\n  updateAssessmentConfigs,\n  updateCourseConfig,\n  updateUserRole\n} from '../../../commons/application/actions/SessionActions';\nimport { OverallState } from '../../../commons/application/ApplicationTypes';\nimport AdminPanel, { DispatchProps, StateProps } from './AdminPanel';\n\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => ({\n  courseRegId: state.session.courseRegId,\n  courseName: state.session.courseName,\n  courseShortName: state.session.courseShortName,\n  viewable: state.session.viewable,\n  enableGame: state.session.enableGame,\n  enableAchievements: state.session.enableAchievements,\n  enableSourcecast: state.session.enableSourcecast,\n  moduleHelpText: state.session.moduleHelpText,\n  assessmentConfigurations: state.session.assessmentConfigurations,\n  userCourseRegistrations: state.session.userCourseRegistrations\n});\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleFetchCourseConfiguration: fetchCourseConfig,\n      handleFetchAssessmentConfigs: fetchAssessmentConfigs,\n      handleFetchUserCourseRegistrations: fetchAdminPanelCourseRegistrations,\n      handleUpdateCourseConfig: updateCourseConfig,\n      handleUpdateAssessmentConfigs: updateAssessmentConfigs,\n      setAssessmentConfigurations: setAssessmentConfigurations,\n      handleDeleteAssessmentConfig: deleteAssessmentConfig,\n      handleUpdateUserRole: updateUserRole,\n      handleDeleteUserFromCourse: deleteUserCourseRegistration,\n      handleAddNewUsersToCourse: addNewUsersToCourse\n    },\n    dispatch\n  );\n\nconst AdminPanelContainer = connect(mapStateToProps, mapDispatchToProps)(AdminPanel);\n\nexport default AdminPanelContainer;\n","import 'ag-grid-community/dist/styles/ag-grid.css';\nimport 'ag-grid-community/dist/styles/ag-theme-balham.css';\n\nimport { ColDef, GridApi, GridReadyEvent } from 'ag-grid-community';\nimport { AgGridReact } from 'ag-grid-react';\nimport { startCase } from 'lodash';\nimport * as React from 'react';\n\nimport ContentDisplay from '../../../commons/ContentDisplay';\nimport { GradingSummary } from '../../../features/dashboard/DashboardTypes';\n\ntype DashboardProps = DispatchProps & StateProps;\n\nexport type DispatchProps = {\n  handleFetchGradingSummary: () => void;\n};\n\nexport type StateProps = {\n  gradingSummary: GradingSummary;\n};\n\nconst defaultColumnDefs: ColDef = {\n  filter: true,\n  resizable: true,\n  sortable: true\n};\n\nconst Dashboard: React.FC<DashboardProps> = props => {\n  let gridApi: GridApi | undefined;\n\n  const onGridReady = (params: GridReadyEvent) => {\n    gridApi = params.api;\n  };\n\n  const resizeGrid = () => {\n    if (gridApi) {\n      gridApi.sizeColumnsToFit();\n    }\n  };\n\n  const columnDefs = props.gradingSummary.cols.map(e => {\n    return {\n      headerName: startCase(e),\n      field: e\n    };\n  });\n\n  const content = (\n    <div className=\"Dashboard\">\n      <div className=\"Grid ag-grid-parent ag-theme-balham\">\n        <AgGridReact\n          domLayout={'autoHeight'}\n          columnDefs={columnDefs}\n          defaultColDef={defaultColumnDefs}\n          onGridReady={onGridReady}\n          onGridSizeChanged={resizeGrid}\n          rowData={props.gradingSummary.rows}\n          rowHeight={30}\n          suppressCellSelection={true}\n          suppressMovableColumns={true}\n        />\n      </div>\n    </div>\n  );\n\n  return (\n    <div>\n      <ContentDisplay display={content} loadContentDispatch={props.handleFetchGradingSummary} />\n    </div>\n  );\n};\n\nexport default Dashboard;\n","import { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport { OverallState } from '../../../commons/application/ApplicationTypes';\nimport { fetchGroupGradingSummary } from '../../../features/dashboard/DashboardActions';\nimport Dashboard, { DispatchProps, StateProps } from './Dashboard';\n\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => ({\n  gradingSummary: state.dashboard.gradingSummary\n});\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleFetchGradingSummary: fetchGroupGradingSummary\n    },\n    dispatch\n  );\n\nconst DashboardContainer = connect(mapStateToProps, mapDispatchToProps)(Dashboard);\n\nexport default DashboardContainer;\n","import { AssetMap, FontAsset } from './AssetsTypes';\n\nconst FontAssets: AssetMap<FontAsset> = {\n  zektonFont: {\n    key: 'zekton',\n    pngPath: '../../assets/zekton.png',\n    fntPath: '../../assets/zekton.fnt'\n  },\n  zektonDarkFont: {\n    key: 'zektonDark',\n    pngPath: '../../assets/zekton_dark.png',\n    fntPath: '../../assets/zekton.fnt'\n  },\n  alienCowsFont: {\n    key: 'alienAndCows',\n    pngPath: '../../assets/alien_and_cows.png',\n    fntPath: '../../assets/alien_and_cows.fnt'\n  },\n  alienLeagueFont: {\n    key: 'alienLeague',\n    pngPath: '../../assets/alien_league.png',\n    fntPath: '../../assets/alien_league.fnt'\n  },\n  pixelFont: {\n    key: 'pixel',\n    pngPath: '../../assets/pixel.png',\n    fntPath: '../../assets/pixel.fnt'\n  }\n};\n\nexport default FontAssets;\n","import { Links } from 'src/commons/utils/Constants';\n\nimport FontAssets from '../assets/FontAssets';\n\nexport const Constants = {\n  assetsFolder: Links.sourceAcademyAssets,\n  fadeDuration: 600,\n  nullFunction: () => {},\n  nullInteractionId: '',\n  nullSequenceNumber: -1,\n  popUpDuration: 1000,\n  defaultAssetPath: '/ui/wristDeviceButton.png',\n  defaultFontStyle: {\n    key: FontAssets.zektonFont.key,\n    size: 30,\n    align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n  },\n  defaultCursor: ''\n};\n\nexport const screenSize = {\n  x: 1920,\n  y: 1080\n};\n\nexport const screenCenter = {\n  x: screenSize.x / 2,\n  y: screenSize.y / 2\n};\n","import * as _ from 'lodash';\n\nimport { screenSize } from '../commons/CommonConstants';\n\nexport const Color = {\n  navy: '#03092c',\n  lightBlue: '#ece1fb',\n  offWhite: '#bbc1c9',\n  white: '#ffffff',\n  darkGrey: '#333333',\n  lightGrey: '#555555',\n  blue: '#1133ff',\n  darkBlue: '#0d2440',\n  orange: '#ff9933',\n  yellow: '#ffee33',\n  red: '0#ff0000',\n  maroon: '#142B2E',\n  black: '#000000',\n  purple: '#dd33dd',\n  paleYellow: '#f6ffbd'\n};\n\nconst hex = (str: string) => parseInt(str.slice(1), 16);\nexport const HexColor = _.mapValues(Color, hex);\n\ntype TableFormatPosConfig = {\n  direction?: Direction;\n  numOfItems: number;\n  maxXSpace?: number;\n  maxYSpace?: number;\n  numItemLimit?: number;\n  redistributeLast?: boolean;\n};\n\nexport enum Direction {\n  Row = 'Row',\n  Column = 'Column'\n}\n\n/**\n * Calculate x,y positions using a table format: mimic table-like\n * positions, with rows and columns.\n *\n * The positions will be ordered from LEFT to RIGHT before\n * moving to the next row i.e. row-wise.\n *\n * @param numOfItems total number of items\n * @param maxXSpace maximum X space to be used, optional\n * @param maxYSpace maximum Y space to be used, optional\n * @param numItemLimit maximum number of item at a given row, optional\n * @param redistributeLast if true, items at the last row will have their location\n *                         calculated based on the number of items at the last row, optional\n * @returns {Array<[number, number]>} array of positions, in the format of\n *                                 [[xPos0, yPos0], [xPos1, yPos1]...]\n */\nexport function calcTableFormatPos({\n  direction = Direction.Row,\n  numOfItems,\n  maxXSpace = screenSize.x,\n  maxYSpace = screenSize.y,\n  numItemLimit = 0,\n  redistributeLast = true\n}: TableFormatPosConfig): Array<[number, number]> {\n  let itemsPerList = numItemLimit || numOfItems;\n  const numOfLists = Math.ceil(numOfItems / itemsPerList);\n\n  return _.times(numOfItems, itemNumber => {\n    const itemIndexInList = itemNumber % itemsPerList;\n    const listIndex = Math.floor(itemNumber / itemsPerList);\n\n    if (redistributeLast && listIndex === numOfLists - 1) {\n      itemsPerList = numOfItems % numOfLists || itemsPerList;\n    }\n\n    return direction === Direction.Row\n      ? [\n          indexToCoordinate(screenSize.x, maxXSpace, itemIndexInList, itemsPerList),\n          indexToCoordinate(screenSize.y, maxYSpace, listIndex, numOfLists)\n        ]\n      : [\n          indexToCoordinate(screenSize.x, maxXSpace, listIndex, numOfLists),\n          indexToCoordinate(screenSize.y, maxYSpace, itemIndexInList, itemsPerList)\n        ];\n  });\n}\n\nfunction indexToCoordinate(\n  screenSpace: number,\n  listSpace: number,\n  index: number,\n  maxItems: number\n) {\n  const partitionSpace = listSpace / maxItems;\n  return (screenSpace - listSpace + partitionSpace) / 2 + partitionSpace * index;\n}\n\ntype ListFormatPos = {\n  numOfItems: number;\n  xSpacing: number;\n  ySpacing: number;\n};\n\n/**\n * Calculate x,y positions using a list format: mimic list-like\n * positions, ordered sequentially.\n *\n * Each item will be offset by xSpaing and ySpacing.\n *\n * The first item will start at [0, 0] (top left) position.\n *\n * @param numOfItems total number of items\n * @param xSpacing horizontal spacing between items\n * @param ySpacing vertical spacing between items\n * @returns {Array<[number, number]>} array of positions, in the format of\n *                                 [[xPos0, yPos0], [xPos1, yPos1]...]\n */\nexport function calcListFormatPos({ numOfItems, xSpacing = 30, ySpacing = 30 }: ListFormatPos) {\n  const pos = new Array<[number, number]>();\n\n  for (let i = 0; i < numOfItems; i++) {\n    pos.push([i * xSpacing, i * ySpacing]);\n  }\n\n  return pos;\n}\n","import { Color, HexColor } from '../utils/StyleUtils';\n\nconst textPad = 10;\nconst defaultTextHoverWidth = 300;\nconst cursorOffSet = 20;\n\nconst textHoverStyle = {\n  fontFamily: 'Verdana',\n  fontSize: '15px',\n  fill: Color.lightBlue,\n  align: 'left',\n  wordWrap: { width: defaultTextHoverWidth - textPad }\n};\n\n/**\n * A container that can be used as simple text hover.\n * Its visibility is set to false by default.\n * The container only consists of a simple rectangle with text on top.\n *\n * The container still needs to be attached to an object.\n * i.e. on GAMEOBJECT_POINTER_OVER => hoverContainer.setVisibility(true)\n *      on GAMEOBJECT_POINTER_OUT => hoverContainer.setVisibility(false)\n *      on GAMEOBJECT_POINTER_MOVE => hoverContainer.x = pointer.x;\n *                                    hoverContainer.y = pointer.y;\n */\nclass CommonTextHover extends Phaser.GameObjects.Container {\n  /**\n   * @param scene scene for the container to attach to\n   * @param x x position of the container\n   * @param y y position of the container\n   * @param text message to be displayed\n   * @param maxWidth the maximum width of the text before the text wraps\n   */\n  constructor(\n    scene: Phaser.Scene,\n    x: number,\n    y: number,\n    text: string,\n    maxWidth: number = defaultTextHoverWidth\n  ) {\n    super(scene, x, y);\n    this.renderTextHover(text, maxWidth);\n  }\n\n  private renderTextHover(text: string, maxWidth: number) {\n    const fontSize = parseInt(\n      textHoverStyle.fontSize.substring(0, textHoverStyle.fontSize.length - 2)\n    );\n    const width = text.length * fontSize * 0.75;\n    const hoverWidth = Math.min(width, maxWidth);\n    const hoverText = new Phaser.GameObjects.Text(\n      this.scene,\n      cursorOffSet + textPad,\n      textPad,\n      text,\n      {\n        ...textHoverStyle,\n        wordWrap: { width: hoverWidth - textPad }\n      }\n    );\n    const hoverTextBg = new Phaser.GameObjects.Rectangle(\n      this.scene,\n      cursorOffSet,\n      0,\n      hoverWidth,\n      hoverText.getBounds().bottom + textPad,\n      HexColor.darkBlue\n    )\n      .setOrigin(0.0, 0.0)\n      .setAlpha(0.8);\n\n    this.add([hoverTextBg, hoverText]);\n    this.setDepth(1); // Render hover text over other objects\n    this.setVisible(false);\n  }\n}\n\nexport default CommonTextHover;\n","import { BitmapFontStyle, TextConfig } from '../commons/CommonTypes';\n\n/**\n * Create bitmap text with the given style.\n *\n * @param scene scene to be attached to\n * @param text message to be shon\n * @param x x coordinate in worldspace\n * @param y y coordinate in worldspace\n * @param style style to be applied to the bitmap text\n * @returns {Phaser.GameObjects.BitmapText}\n */\nexport const createBitmapText = (\n  scene: Phaser.Scene,\n  text: string,\n  { x, y, oriX, oriY }: TextConfig,\n  style: BitmapFontStyle\n) => {\n  return new Phaser.GameObjects.BitmapText(\n    scene,\n    x,\n    y,\n    style.key,\n    text,\n    style.size,\n    style.align\n  ).setOrigin(oriX, oriY);\n};\n","import FontAssets from '../assets/FontAssets';\nimport { Constants, screenSize } from '../commons/CommonConstants';\nimport { BitmapFontStyle } from '../commons/CommonTypes';\nimport { Color } from '../utils/StyleUtils';\nimport { AwardProperty } from './GameAwardsTypes';\n\nexport const listBannerTextStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 25,\n  align: Phaser.GameObjects.BitmapText.ALIGN_LEFT\n};\n\nexport const awardTitleStyle: BitmapFontStyle = {\n  key: FontAssets.alienLeagueFont.key,\n  size: 50,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nexport const awardKeyStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 18,\n  align: Phaser.GameObjects.BitmapText.ALIGN_LEFT\n};\n\nexport const awardDescStyle = {\n  fontFamily: 'Verdana',\n  fontSize: '18px',\n  fill: Color.lightBlue,\n  align: 'center',\n  lineSpacing: 10,\n  wordWrap: { width: 500 }\n};\n\nexport const defaultAwardProp: AwardProperty = {\n  id: 'default-award',\n  assetKey: Constants.nullInteractionId,\n  assetPath: Constants.nullInteractionId,\n  title: Constants.nullInteractionId,\n  description: 'There is no asset associated with this award.',\n  completed: false\n};\n\nexport const awardExplanation =\n  \"Asset key can be used to include the asset into your room by using 'create_award' function.\";\n\nconst previewXPos = -screenSize.x * 0.3;\nconst previewYPos = -screenSize.y * 0.05;\nconst previewKeyYPos = previewYPos + 275;\nconst previewDim = 430;\n\nconst AwardsConstants = {\n  arrow: { x: screenSize.x * 0.08, y: screenSize.y * 0.34, xOffset: 80, xScale: 0.4, yScale: 0.3 },\n  itemsPerPage: 7,\n  list: { yStart: -screenSize.y * 0.31, ySpace: 100 },\n  listTextConfig: { x: -screenSize.x * 0.09, y: 0, oriX: 0.0, oriY: 0.55 },\n  noPreviewTextConfig: { x: previewXPos, y: -40, oriX: 0.5, oriY: 0.5 },\n  preview: {\n    descText: { yOffset: 320 },\n    rect: { dim: previewDim, x: previewXPos, y: previewYPos, xOffset: 30, yOffset: 15 },\n    key: { x: previewXPos, y: previewKeyYPos, width: previewDim, height: 35 },\n    keyTagTextConfig: { x: previewXPos - 205, y: previewKeyYPos, oriX: 0.0, oriY: 0.5 },\n    keyTextConfig: { x: previewXPos - 90, y: previewKeyYPos, oriX: 0.0, oriY: 0.5 },\n    explanation: { x: previewXPos - 150, y: previewYPos + 200 },\n    titleTextConfig: { x: previewXPos + 20, y: previewYPos - 275, oriX: 0.5, oriY: 0.5 }\n  }\n};\n\nexport default AwardsConstants;\n","import CommonTextHover from '../commons/CommonTextHover';\nimport { ItemId } from '../commons/CommonTypes';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { HexColor } from '../utils/StyleUtils';\nimport { createBitmapText } from '../utils/TextUtils';\nimport AwardsConstants, {\n  awardExplanation,\n  awardKeyStyle,\n  defaultAwardProp\n} from './GameAwardsConstants';\nimport { AwardProperty } from './GameAwardsTypes';\n\n/**\n * Get corresponding award properties of the given award keys.\n * Keys that do not have any associated award mapping will be automatically\n * associated with a default award property.\n *\n * @param awardKeys award keys\n */\nexport const getAwardProps = (awardKeys: ItemId[]): AwardProperty[] => {\n  return awardKeys.map(key => getAwardProp(key));\n};\n\n/**\n * Get corresponding award property of the given award key.\n * If no property is tied to the given award key, most likely\n * it is because there is no asset is associated with it within the game.\n *\n * In the case there is no property is associated with the key,\n * we return the default award property instead.\n *\n * @param awardKey award key\n */\nexport const getAwardProp = (awardKey: ItemId): AwardProperty => {\n  const awardProp = SourceAcademyGame.getInstance().getAwardsMapping().get(awardKey);\n  return awardProp ? awardProp : { ...defaultAwardProp, title: awardKey };\n};\n\n/**\n * Create a UI bar, labeled as 'asset key' on the side. To be used\n * within Awards Menu UI container. On hover on the label,\n * will pop up a hover text explanation on the use of the asset key.\n *\n * @param scene scene to attach to\n */\nexport function createAssetKeyPreviewCont(scene: Phaser.Scene) {\n  const assetKeyCont = new Phaser.GameObjects.Container(\n    scene,\n    AwardsConstants.preview.rect.xOffset,\n    AwardsConstants.preview.rect.yOffset\n  );\n  const rectDim = AwardsConstants.preview.key;\n\n  // Create asset key bar and text\n  const assetKeyBg = new Phaser.GameObjects.Rectangle(\n    scene,\n    rectDim.x,\n    rectDim.y,\n    rectDim.width,\n    rectDim.height,\n    HexColor.lightBlue,\n    0.1\n  );\n  const assetKeyTagBg = new Phaser.GameObjects.Rectangle(\n    scene,\n    rectDim.x - rectDim.width * assetKeyBg.originX * 0.75,\n    rectDim.y,\n    rectDim.width / 4,\n    rectDim.height,\n    HexColor.lightBlue,\n    0.2\n  );\n  const assetKeyTag = createBitmapText(\n    scene,\n    'asset key',\n    AwardsConstants.preview.keyTagTextConfig,\n    awardKeyStyle\n  );\n\n  // Create explanation pop-up\n  const hoverCont = new CommonTextHover(\n    scene,\n    AwardsConstants.preview.explanation.x,\n    AwardsConstants.preview.explanation.y,\n    awardExplanation\n  );\n\n  // Attach\n  assetKeyTagBg.setInteractive();\n  assetKeyTagBg.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER, () =>\n    hoverCont.setVisible(true)\n  );\n  assetKeyTagBg.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT, () =>\n    hoverCont.setVisible(false)\n  );\n\n  assetKeyCont.add([assetKeyBg, assetKeyTagBg, assetKeyTag, hoverCont]);\n  return assetKeyCont;\n}\n","import { AssetKey, AssetPath } from '../commons/CommonTypes';\nimport { GameSoundType } from '../sound/GameSoundTypes';\n\nexport type AssetMap<T> = {\n  [name: string]: T;\n};\n\nexport type ImageAsset = {\n  type: AssetType;\n  key: AssetKey;\n  path: AssetPath;\n  config?: ImageConfig;\n};\n\nexport type ImageConfig = {\n  frameWidth: number;\n  frameHeight: number;\n  centreX: number;\n  centreY: number;\n  endFrame?: number;\n  start?: number;\n  frameRate?: number;\n  animType?: AnimType;\n};\n\nexport enum AssetType {\n  Image = 'Image',\n  Sprite = 'Sprite'\n}\n\nexport enum AnimType {\n  Background = 'Background',\n  Object = 'Object'\n}\n\nexport type SoundAsset = {\n  key: string;\n  path: string;\n  config: Phaser.Types.Sound.SoundConfig;\n  soundType: GameSoundType;\n};\n\nexport type FontAsset = {\n  key: string;\n  pngPath: string;\n  fntPath: string;\n};\n\nexport type TextAsset = {\n  key: string;\n  path: string;\n};\n","import { AssetMap, AssetType, ImageAsset } from './AssetsTypes';\n\nconst ImageAssets: AssetMap<ImageAsset> = {\n  // Commons Asset\n  spaceshipBg: {\n    type: AssetType.Image,\n    key: 'spaceship-bg',\n    path: '/locations/spaceshipBackground.png'\n  },\n  saBanner: { type: AssetType.Image, key: 'sa-banner', path: '/ui/sourceAcadBannerOneLine.png' },\n  shortButton: { type: AssetType.Image, key: 'short-button', path: '/ui/shortButton.png' },\n  mediumButton: { type: AssetType.Image, key: 'med-button', path: '/ui/mediumButton.png' },\n  longButton: { type: AssetType.Image, key: 'long-button', path: '/ui/longButton.png' },\n  topButton: { type: AssetType.Image, key: 'top-button', path: '/ui/topButton.png' },\n  speechBox: { type: AssetType.Image, key: 'speechBox', path: '/ui/speechbox.png' },\n  speakerBox: { type: AssetType.Image, key: 'speakerBox', path: '/ui/speakerBox.png' },\n  defaultLocationImg: {\n    type: AssetType.Image,\n    key: 'loc-default',\n    path: '/ui/defaultLocation.jpg'\n  },\n  locationPreviewFrame: {\n    type: AssetType.Image,\n    key: 'loc-preview-frame',\n    path: '/ui/locationPreviewFrame.png'\n  },\n  locationPreviewFill: {\n    type: AssetType.Image,\n    key: 'loc-preview-fill',\n    path: '/ui/locationPreviewFill.png'\n  },\n  talkOptButton: { type: AssetType.Image, key: 'talk-opt-button', path: '/ui/talkOptButton.png' },\n  talkOptCheck: { type: AssetType.Image, key: 'talk-opt-check', path: '/ui/talkOptCheck.png' },\n  modeMenuBanner: { type: AssetType.Image, key: 'mode-banner', path: '/ui/modeMenuBanner.png' },\n  popUpFrame: { type: AssetType.Image, key: 'pop-up-frame', path: '/ui/popUpFrame.png' },\n  mediumBox: { type: AssetType.Image, key: 'medium-box', path: '/ui/mediumBox.png' },\n  diamond: { type: AssetType.Image, key: 'diamond', path: '/ui/zircon.png' },\n  arrow: { type: AssetType.Image, key: 'arrow', path: '/ui/arrow.png' },\n  cookies: { type: AssetType.Image, key: 'cookies', path: '/images/cookies.png' },\n  scrollFrame: { type: AssetType.Image, key: 'scroll-frame', path: '/ui/scrollFrame.png' },\n  messageBar: { type: AssetType.Image, key: 'message-bar', path: '/ui/messageBg.png' },\n\n  // Escape Menu\n  escapeMenuBackground: { type: AssetType.Image, key: 'escape-bg', path: '/ui/escapeMenu.png' },\n\n  // Awards Menu\n  awardsMenu: { type: AssetType.Image, key: 'award-bg', path: '/ui/collectiblesBg.png' },\n  awardsBanner: { type: AssetType.Image, key: 'award-banner', path: '/ui/awardsBanner.png' },\n  awardsPageChosen: {\n    type: AssetType.Image,\n    key: 'award-pg-chosen',\n    path: '/ui/collectiblesPageOptChosen.png'\n  },\n  awardsPage: { type: AssetType.Image, key: 'award-pg-opt', path: '/ui/collectiblesPageOpt.png' },\n\n  // Awards Hall\n  awardsBackground: { type: AssetType.Image, key: 'award-hall-bg', path: '/ui/awardsHall.png' },\n\n  // Toolbar\n  gear: { type: AssetType.Image, key: 'gear', path: '/ui/settings.png' },\n  journal: { type: AssetType.Image, key: 'journal', path: '/ui/journal.png' },\n\n  // Chapter Select\n  chapterRepeatButton: {\n    type: AssetType.Image,\n    key: 'chapter-repeat',\n    path: '/ui/chapterRepeat.png'\n  },\n  chapterContinueButton: {\n    type: AssetType.Image,\n    key: 'chapter-continue',\n    path: '/ui/chapterContinue.png'\n  },\n  StarGold: {\n    type: AssetType.Image,\n    key: 'StarGold',\n    path: '/ui/StarGold.png'\n  },\n  StarSilver: {\n    type: AssetType.Image,\n    key: 'StarSilver',\n    path: '/ui/StarSilver.png'\n  },\n  StarBronze: {\n    type: AssetType.Image,\n    key: 'StarBronze',\n    path: '/ui/StarBronze.png'\n  },\n  chapterSelectFrame: {\n    type: AssetType.Image,\n    key: 'chapter-select-frame',\n    path: '/ui/chapterSelectionFrame.png'\n  },\n  chapterSelectBorder: {\n    type: AssetType.Image,\n    key: 'chapter-select-border',\n    path: '/ui/chapterSelectionBorder.png'\n  },\n  chapterSelectArrow: {\n    type: AssetType.Image,\n    key: 'chapter-select-arrow',\n    path: '/ui/chapSelectArrow.png'\n  },\n\n  // Main Menu\n  mainMenuOptBanner: { type: AssetType.Image, key: 'menu-option', path: '/ui/menuOption.png' },\n\n  // Settings\n  settingBanner: { type: AssetType.Image, key: 'settings-bg', path: '/ui/settingsBg.png' },\n  settingOption: { type: AssetType.Image, key: 'settings-opt', path: '/ui/settingsOption.png' },\n\n  // Room Preview\n  verifiedFrame: { type: AssetType.Image, key: 'verified-frame', path: '/ui/verifiedFrame.png' },\n  sourceCrashedPod: {\n    type: AssetType.Image,\n    key: 'source-crashed-pod',\n    path: '/locations/sourceCrashedPod.png'\n  },\n\n  // Bindings\n  squareKeyboardIcon: {\n    type: AssetType.Image,\n    key: 'keyboard-key-square',\n    path: '/ui/keyboardKeyIcon.png'\n  },\n  medKeyboardIcon: { type: AssetType.Image, key: 'keyboard-key-medium', path: '/ui/TabIcon.png' }\n};\n\nexport default ImageAssets;\n","export const bgMusicFadeDuration = 1000;\n\nexport const musicFadeOutTween = {\n  volume: 0,\n  ease: 'Power2'\n};\n\nexport enum GameSoundType {\n  SFX,\n  BGM\n}\n","import { GameSoundType } from '../sound/GameSoundTypes';\nimport { AssetMap, SoundAsset } from './AssetsTypes';\n\nconst SoundAssets: AssetMap<SoundAsset> = {\n  // SFX\n  buttonHover: {\n    key: 'btn-hover',\n    path: '/sfx/buttonHover.mp3',\n    config: { volume: 0.1 },\n    soundType: GameSoundType.SFX\n  },\n  buttonClick: {\n    key: 'btn-click',\n    path: '/sfx/buttonClick.mp3',\n    config: { volume: 0.1 },\n    soundType: GameSoundType.SFX\n  },\n  radioButtonClick: {\n    key: 'radio-btn-click',\n    path: '/sfx/radioButtonClick.mp3',\n    config: { volume: 0.15 },\n    soundType: GameSoundType.SFX\n  },\n  dialogueAdvance: {\n    key: 'dialogue-advance',\n    path: '/sfx/dialogueAdvance.mp3',\n    config: { volume: 0.3 },\n    soundType: GameSoundType.SFX\n  },\n  popUpEnter: {\n    key: 'pop-up-enter',\n    path: '/sfx/popUpEnter.mp3',\n    config: { volume: 0.35 },\n    soundType: GameSoundType.SFX\n  },\n  popUpExit: {\n    key: 'pop-up-exit',\n    path: '/sfx/popUpExit.mp3',\n    config: { volume: 0.35 },\n    soundType: GameSoundType.SFX\n  },\n  menuEnter: {\n    key: 'menu-enter',\n    path: '/sfx/menuEnter.mp3',\n    config: { volume: 0.5 },\n    soundType: GameSoundType.SFX\n  },\n  menuExit: {\n    key: 'menu-exit',\n    path: '/sfx/menuExit.mp3',\n    config: { volume: 0.5 },\n    soundType: GameSoundType.SFX\n  },\n  modeEnter: {\n    key: 'mode-enter',\n    path: '/sfx/modeEnter.mp3',\n    config: { volume: 0.1 },\n    soundType: GameSoundType.SFX\n  },\n  notifEnter: {\n    key: 'notif-enter',\n    path: '/sfx/notifEnter.mp3',\n    config: { volume: 0.25 },\n    soundType: GameSoundType.SFX\n  },\n  notifExit: {\n    key: 'notif-exit',\n    path: '/sfx/notifExit.mp3',\n    config: { volume: 0.25 },\n    soundType: GameSoundType.SFX\n  },\n  radioStatic: {\n    key: 'radio-static',\n    path: '/sfx/radioStatic.mp3',\n    config: { volume: 0.1 },\n    soundType: GameSoundType.SFX\n  },\n\n  // BGM\n  galacticHarmony: {\n    key: 'galactic-harmony',\n    path: '/bgm/GalacticHarmony.mp3',\n    config: { volume: 0.25, loop: true },\n    soundType: GameSoundType.BGM\n  }\n};\n\nexport default SoundAssets;\n","export enum Layer {\n  Effects,\n  Background,\n  Character,\n  Speaker,\n  PopUp,\n  Dialogue,\n  SpeakerBox,\n  UI,\n  Objects,\n  BBox,\n  Escape,\n  Selector,\n  Dashboard,\n  WorkerMessage\n}\n\n// Back to Front\nexport const defaultLayerSequence = [\n  Layer.Background,\n  Layer.Selector,\n  Layer.Objects,\n  Layer.BBox,\n  Layer.Character,\n  Layer.Speaker,\n  Layer.PopUp,\n  Layer.Dialogue,\n  Layer.SpeakerBox,\n  Layer.Effects,\n  Layer.Dashboard,\n  Layer.Escape,\n  Layer.UI,\n  Layer.WorkerMessage\n];\n","import { store } from 'src/pages/createStore';\n\nimport { Constants } from '../commons/CommonConstants';\n\n/**\n * When called with await in an async function,\n * e.g. \"await sleep(5000)\", this line delays\n * the next line by that number of milliseconds.\n *\n * @param ms number of milliseconds to delay next line.\n * @returns {Promise} promise which resolves in ms milliseconds.\n */\nexport function sleep(ms: number) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/**\n * Creates a Map with the same keys, but the values\n * are mapped using a specified function\n *\n * Example:\n * mapValues(Map([[\"a\", 1], [\"b\", 2], [\"c\", 3]]), (value, key) => 2 * value + key)\n * returns Map([[\"a\", \"2a\"], [\"b\", \"4b\"], [\"c\", \"6c\"]])\n *\n * @param map the Map that you'd like to iterate over\n * @param fn the binary function that produces the new\n *           value of the map using (value, key) as input\n * @returns {Map<K, R>} new Map with mapped values\n */\nexport function mapValues<K, V, R>(map: Map<K, V>, fn: (value: V, key?: K) => R): Map<K, R> {\n  const newMap = new Map<K, R>();\n  map.forEach((value: V, key: K) => {\n    const result: R = fn(value, key);\n    newMap.set(key, result);\n  });\n  return newMap;\n}\n\n/**\n * Caps a number to min and max boundary inclusive.\n *\n * @param value the number's value\n * @param min the minimum value of the number\n * @param max the maximum value of the number\n *\n * @returns {number} number which is capped based on boundaries\n */\nexport function limitNumber(value: number, min: number, max: number) {\n  return Math.min(Math.max(value, min), max);\n}\n\n/**\n * Appends the s3 file path to a short path name\n *\n * @param filename the short path of a filename\n * @param courseCoded true iff file is course-specific\n * @returns {string} new path to file including full s3 link\n */\nexport function toS3Path(fileName: string, courseCoded = false) {\n  if (fileName.startsWith('/')) {\n    fileName = fileName.substr(1);\n  }\n  return Constants.assetsFolder + (courseCoded ? assetsPrefix() + fileName : fileName);\n}\n\n/**\n * Throws an error when the property is not found.\n *\n * @param object the property that you would like to get\n * @returns {object} the object if it is found.\n * @throws {Error} if object is undefined\n */\nexport function mandatory<T>(object: T, errorMsg?: string) {\n  if (object === undefined) {\n    throw new Error(errorMsg || 'Object not found');\n  }\n  return (object as T)!;\n}\n\n/**\n * Returns the last element in the array\n *\n * @param array array you want to access\n * @returns the final element of the array\n */\nexport function lastElement<T>(array: T[]): T {\n  if (array.length === 0) {\n    throw new Error('Array is empty');\n  }\n  return array[array.length - 1];\n}\n\nexport const courseId = () => store.getState().session.courseId;\nexport const assetsPrefix = () => store.getState().session.assetsPrefix || '';\n","import { Constants, screenCenter, screenSize } from '../commons/CommonConstants';\nimport { IBaseScene } from '../commons/CommonTypes';\nimport { Layer } from '../layer/GameLayerTypes';\nimport { sleep } from '../utils/GameUtils';\nimport { HexColor } from '../utils/StyleUtils';\n\n/**\n * Generates a tween configuration for making objects fade out of scene.\n *\n * @param targets - an array of game objects that you want to fade out\n * @param duration - the duration of the fade animation\n * @returns {Phaser.Types.Tweens.TweenDataConfig} - the tween config for the fadeout animation\n */\nexport const fadeOut = (\n  targets: Phaser.GameObjects.GameObject[],\n  duration = Constants.fadeDuration\n) => ({\n  alpha: 0,\n  targets,\n  duration,\n  ease: 'Power2'\n});\n\n/**\n * Generates a tween configuration for making objects fade into scene.\n * Make sure the alpha of object is set to zero first.\n *\n * @param targets - an array of game objects that you want to fade in\n * @param duration - the duration of the fade animation\n * @returns {Phaser.Types.Tweens.TweenDataConfig} - the tween config for the fadein animation\n */\nexport const fadeIn = (\n  targets: Phaser.GameObjects.GameObject[],\n  duration = Constants.fadeDuration\n) => ({\n  alpha: 1,\n  targets,\n  duration,\n  ease: 'Power2'\n});\n\n/**\n * @typedef {FadeProps} - props to specify additional properties/configuration for a fade animation\n * @prop fadeDuration - how long to fade in and out\n */\ntype FadeProps = {\n  fadeDuration?: number;\n};\n\n/**\n * Function that makes a game object fade out, and after the animation,\n * removes the game object from the scene.\n *\n * @param scene - scene where this should happen\n * @param object - the game object that should fade out and be destroyed\n * @param fadeProps - additional properties/configuration describing the fade animation\n */\nexport function fadeAndDestroy(\n  scene: Phaser.Scene,\n  object: Phaser.GameObjects.GameObject | null,\n  { fadeDuration }: FadeProps = {}\n) {\n  if (!object) return;\n  scene.add.tween(fadeOut([object], fadeDuration || Constants.fadeDuration));\n  setTimeout(() => object.destroy(), fadeDuration || Constants.fadeDuration);\n}\n\n/**\n * A black screen that can be used in fade effects\n *\n * @param scene - the scene to add this screen to\n */\nexport function blackScreen(scene: Phaser.Scene) {\n  return new Phaser.GameObjects.Rectangle(\n    scene,\n    screenCenter.x,\n    screenCenter.y,\n    screenSize.x,\n    screenSize.y,\n    0\n  );\n}\n\n/**\n * A white screen that can be used in fade effects\n *\n * @param scene - the scene to add this screen to\n */\nexport function whiteScreen(scene: Phaser.Scene) {\n  return new Phaser.GameObjects.Rectangle(\n    scene,\n    screenCenter.x,\n    screenCenter.y,\n    screenSize.x,\n    screenSize.y,\n    HexColor.white\n  );\n}\n\n/**\n * Transitions two scenes using a black screen\n *\n * @param scene - the scene to add this screen to\n * @param fadeDuration - how long is the fading in and out of the scenes\n * @param delay - how long does the black screen remains on screen\n * @param callback - the function that is called during the transition\n */\nexport const blackFade = async (\n  scene: IBaseScene,\n  fadeDuration: number,\n  delay: number,\n  callback: any\n) => {\n  const fadeBlack = blackScreen(scene);\n  scene.getLayerManager().addToLayer(Layer.Effects, fadeBlack);\n\n  fadeBlack.setAlpha(0);\n  scene.tweens.add(fadeIn([fadeBlack], fadeDuration));\n  await sleep(fadeDuration);\n\n  await callback();\n  await sleep(delay);\n\n  fadeBlack.setAlpha(1);\n  scene.tweens.add(fadeOut([fadeBlack], fadeDuration));\n  await sleep(fadeDuration);\n\n  fadeBlack.destroy();\n};\n\n/**\n * Makes a game object object blink through fade ins and fade outs\n *\n * @param scene - the scene where you want to add this object to\n * @param gameObject - the gameObject which you want to add blinking effect on\n * @returns {() => void} - clearBlink is a function. When called, it stops the blinking.\n */\nexport function blink(\n  scene: Phaser.Scene,\n  gameObject: Phaser.GameObjects.Image | Phaser.GameObjects.Container\n) {\n  let i = 0;\n  const blink = setInterval(() => {\n    if (i % 2 !== 0) {\n      gameObject.setAlpha(0);\n      scene.tweens.add(fadeIn([gameObject], 250));\n    } else {\n      gameObject.setAlpha(1);\n      scene.tweens.add(fadeOut([gameObject], 250));\n    }\n    i++;\n  }, 500);\n  function clearBlink() {\n    i = 0;\n    clearInterval(blink);\n  }\n  return clearBlink;\n}\n","import { screenSize } from '../commons/CommonConstants';\n\n/**\n * A tween config that makes the object fly in\n * from the top of screen into the middle of the screen\n */\nexport const entryTweenProps = {\n  y: 0,\n  duration: 300,\n  ease: 'Power2'\n};\n\n/**\n * Makes the object fly out from the middle of the screen\n * to the top of the screen\n */\nexport const exitTweenProps = {\n  y: -screenSize.y,\n  duration: 250,\n  ease: 'Power2'\n};\n\n/**\n * A tween config that makes the object fly in\n * from the left of screen into the middle of the screen\n */\nexport const leftSideEntryTweenProps = {\n  x: 0,\n  duration: 350,\n  ease: 'Power2'\n};\n\n/**\n * Makes the object fly out from the middle of the screen\n * to the left of the screen\n */\nexport const leftSideExitTweenProps = {\n  x: -screenSize.x,\n  duration: 350,\n  ease: 'Power2'\n};\n\n/**\n * A tween config that makes the object fly in\n * from the right of screen into the middle of the screen\n */\nexport const rightSideEntryTweenProps = {\n  x: 0,\n  duration: 500,\n  ease: 'Power2'\n};\n\n/**\n * Makes the object fly out from the middle of the screen\n * to the right of the screen\n */\nexport const rightSideExitTweenProps = {\n  x: screenSize.x,\n  duration: 500,\n  ease: 'Power2'\n};\n","import FontAssets from '../assets/FontAssets';\nimport ImageAssets from '../assets/ImageAssets';\nimport SoundAssets from '../assets/SoundAssets';\nimport { Constants, screenSize } from '../commons/CommonConstants';\nimport { BitmapFontStyle, IBaseScene } from '../commons/CommonTypes';\nimport { Layer } from '../layer/GameLayerTypes';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { sleep } from '../utils/GameUtils';\nimport { createBitmapText } from '../utils/TextUtils';\nimport { fadeAndDestroy } from './FadeEffect';\nimport { rightSideEntryTweenProps, rightSideExitTweenProps } from './FlyEffect';\n\nconst messageDuration = 3000;\nconst messageTextConfig = { x: 1900, y: 100, oriX: 1.0, oriY: 0.5 };\nconst messageStyle: BitmapFontStyle = {\n  key: FontAssets.zektonDarkFont.key,\n  size: 24,\n  align: Phaser.GameObjects.BitmapText.ALIGN_RIGHT\n};\n\n/**\n * Generates a closure containing a promise chain of message displaying calls\n * and a function to enqueue more messages to show.\n *\n * @returns a function to display a message\n */\nconst makeMiniMessageDisplayer = () => {\n  let displayMessagesPromise = Promise.resolve();\n  const displayMiniMessage = (scene: IBaseScene, text: string) => {\n    displayMessagesPromise = displayMessagesPromise.then(() =>\n      displayMiniMessageHelper(scene, text)\n    );\n  };\n  return displayMiniMessage;\n};\n\n/**\n * A function to display a message on the top right side of the screen.\n * The message will be tweened to enter from the right side of the screen,\n * displayed for a duration, before tweened out. The message will not be\n * shown immediately if there is another message currently being displayed\n * and/or other messages are waiting to be displayed\n *\n * @param scene scene to attach this message to\n * @param text text to be written\n */\nexport const displayMiniMessage = makeMiniMessageDisplayer();\n\n/**\n * A function to display a message on the top right side of the screen.\n * The message will be tweened to enter from the right side of the screen,\n * displayed for a duration, before tweened out.\n *\n * @param scene scene to attach this message to\n * @param text text to be written\n */\nasync function displayMiniMessageHelper(scene: IBaseScene, text: string) {\n  const container = new Phaser.GameObjects.Container(scene, 0, 0);\n  const messageBg = new Phaser.GameObjects.Sprite(\n    scene,\n    screenSize.x,\n    100,\n    ImageAssets.messageBar.key\n  );\n  messageBg.setScale(-1.5, 0.8);\n  const messageText = createBitmapText(scene, text, messageTextConfig, messageStyle);\n\n  container.add([messageBg, messageText]);\n  scene.getLayerManager().addToLayer(Layer.Effects, container);\n  container.setPosition(screenSize.x, 0);\n  container.setAlpha(0);\n\n  SourceAcademyGame.getInstance().getSoundManager().playSound(SoundAssets.notifEnter.key);\n  scene.add.tween({\n    targets: container,\n    alpha: 1,\n    ...rightSideEntryTweenProps\n  });\n\n  await sleep(rightSideEntryTweenProps.duration + messageDuration);\n\n  SourceAcademyGame.getInstance().getSoundManager().playSound(SoundAssets.notifExit.key);\n  scene.add.tween({\n    targets: container,\n    alpha: 1,\n    ...rightSideExitTweenProps\n  });\n\n  await sleep(rightSideExitTweenProps.duration);\n  fadeAndDestroy(scene, container, { fadeDuration: Constants.fadeDuration });\n}\n","import FontAssets from '../assets/FontAssets';\nimport { screenSize } from '../commons/CommonConstants';\nimport { BitmapFontStyle } from '../commons/CommonTypes';\nimport { Color } from '../utils/StyleUtils';\n\nconst dialogueRectMargin = 10;\n\nconst DialogueConstants = {\n  prompt: { x: 30, y: 60, xPad: 30, yPad: 10 },\n  rect: {\n    x: dialogueRectMargin,\n    y: 760,\n    width: screenSize.x - dialogueRectMargin * 2\n  },\n  text: { xPad: 100, yPad: 70 },\n  speakerTextConfig: { x: 320, y: 745, oriX: 0.5, oriY: 0.5 }\n};\n\nexport const textTypeWriterStyle = {\n  fontFamily: 'Verdana',\n  fontSize: '30px',\n  fill: Color.lightBlue,\n  align: 'left',\n  lineSpacing: 10,\n  wordWrap: {\n    width:\n      DialogueConstants.rect.width - DialogueConstants.text.xPad * 2 - DialogueConstants.rect.x * 2\n  }\n};\n\nexport const speakerTextStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 36,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nexport default DialogueConstants;\n","/**\n * @typedef {TypewriterProps} - properties describing a typewriter\n *\n * @prop {number} x - x coordinate of the left edge of the typewriter\n * @prop {number} y - y coordinate of the top edge of the typewriter\n * @prop {Phaser.Types.GameObjects.Text.TextStyle} textStyle\n *       the text config to specify the text propertoes of the typewriter text\n * @prop {number} typeWriterInterval - how long is the interval between\n *                                     each letter's appearance\n */\ntype TypewriterProps = {\n  x?: number;\n  y?: number;\n  textStyle?: Phaser.Types.GameObjects.Text.TextStyle;\n  typeWriterInterval?: number;\n};\n\n/**\n * Text sprite manager to produce typewriter effect\n *\n * @param scene - scene to add the typewriter sprite\n * @param typeWriterProps - properties to describe the appearance and animation of the typewriter\n */\nexport function Typewriter(\n  scene: Phaser.Scene,\n  { x = 0, y = 0, textStyle = {}, typeWriterInterval = 1 }: TypewriterProps\n) {\n  const textSprite = new Phaser.GameObjects.Text(scene, x, y, '', textStyle);\n\n  let line = '';\n  let charPointer = 0;\n  let typeWriting: NodeJS.Timeout;\n\n  const clearTyping = () => {\n    typeWriting && clearInterval(typeWriting);\n  };\n\n  /* Reset line and type out */\n  const changeLine = (message: string) => {\n    if (!message) return;\n    line = message;\n\n    textSprite.text = '';\n    charPointer = 0;\n\n    clearTyping();\n    typeWriting = setInterval(() => {\n      textSprite.text += line[charPointer++];\n      if (charPointer === line.length) {\n        clearInterval(typeWriting);\n      }\n    }, typeWriterInterval);\n  };\n\n  return { container: textSprite, changeLine, clearTyping };\n}\n\nexport default Typewriter;\n","import ImageAssets from '../assets/ImageAssets';\nimport { screenSize } from '../commons/CommonConstants';\nimport { blink, fadeAndDestroy } from '../effects/FadeEffect';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport dialogueConstants from './GameDialogueConstants';\nimport { createDialogueBox, createTypewriter } from './GameDialogueHelper';\n\n/**\n * Class that manages the appearance of the dialogue box, which includes\n * the box itself, the text animations as well as the blinking diamond click prompt\n */\nclass DialogueRenderer {\n  private typewriter: any;\n  private dialogueBox: Phaser.GameObjects.Image;\n  private blinkingDiamond: any;\n\n  /**\n   * @param typewriterStyle the style of the typewriter you want to use\n   */\n  constructor(typewriterStyle: Phaser.Types.GameObjects.Text.TextStyle) {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    this.dialogueBox = createDialogueBox(gameManager).setInteractive({\n      useHandCursor: true,\n      pixelPerfect: true\n    });\n    this.typewriter = createTypewriter(gameManager, typewriterStyle);\n    this.blinkingDiamond = this.drawDiamond(gameManager);\n  }\n\n  /**\n   * @returns {Phaser.GameObjects.Container} returns the entire dialogueBox container\n   * which can be added to the scene\n   */\n  public getDialogueContainer() {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    const container = new Phaser.GameObjects.Container(gameManager, 0, 0);\n    container.add([this.dialogueBox, this.blinkingDiamond.container, this.typewriter.container]);\n    return container;\n  }\n\n  private drawDiamond(scene: Phaser.Scene) {\n    const diamondSprite = new Phaser.GameObjects.Image(\n      scene,\n      screenSize.x - dialogueConstants.prompt.x - dialogueConstants.prompt.xPad,\n      screenSize.y - dialogueConstants.prompt.y - dialogueConstants.prompt.yPad,\n      ImageAssets.diamond.key\n    ).setDisplaySize(dialogueConstants.prompt.x, dialogueConstants.prompt.y);\n\n    return { container: diamondSprite, clearBlink: blink(scene, diamondSprite) };\n  }\n\n  /**\n   * Obtains the green dialogue box\n   */\n  public getDialogueBox() {\n    return this.dialogueBox;\n  }\n\n  /**\n   * Destroyer for the dialogue box elements and interactivity\n   */\n  public destroy() {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    this.typewriter.clearTyping();\n    this.blinkingDiamond.clearBlink();\n    this.getDialogueBox().off(Phaser.Input.Events.GAMEOBJECT_POINTER_UP);\n    fadeAndDestroy(gameManager, this.getDialogueContainer());\n  }\n\n  /**\n   * Change the text written in the box\n   */\n  public changeText(message: string) {\n    this.typewriter.changeLine(message);\n  }\n}\n\nexport default DialogueRenderer;\n","import ImageAssets from '../assets/ImageAssets';\nimport { screenCenter } from '../commons/CommonConstants';\nimport Typewriter from '../effects/Typewriter';\nimport dialogueConstants from './GameDialogueConstants';\n\n/**\n * Helper function to render the green box shown in every dialogue/ notification popup\n */\nexport function createDialogueBox(scene: Phaser.Scene) {\n  const dialogueBox = new Phaser.GameObjects.Image(\n    scene,\n    screenCenter.x,\n    screenCenter.y,\n    ImageAssets.speechBox.key\n  ).setAlpha(0.9);\n  return dialogueBox;\n}\n\n/**\n * Helper function to to generate the typewriter effect used by the dialogue renderer\n * @param scene the scene on which to place the typewriter effect\n * @param style the style of the typewriter\n */\nexport function createTypewriter(\n  scene: Phaser.Scene,\n  style: Phaser.Types.GameObjects.Text.TextStyle\n) {\n  const typewriter = Typewriter(scene, {\n    x: dialogueConstants.rect.x + dialogueConstants.text.xPad,\n    y: dialogueConstants.rect.y + dialogueConstants.text.yPad,\n    textStyle: style\n  });\n  return typewriter;\n}\n","import { Layer } from 'src/features/game/layer/GameLayerTypes';\n\nimport FontAssets from '../assets/FontAssets';\nimport SoundAssets from '../assets/SoundAssets';\nimport { Constants, screenCenter } from '../commons/CommonConstants';\nimport { BitmapFontStyle, IBaseScene } from '../commons/CommonTypes';\nimport dialogueConstants from '../dialogue/GameDialogueConstants';\nimport DialogueRenderer from '../dialogue/GameDialogueRenderer';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { sleep } from '../utils/GameUtils';\nimport { createBitmapText } from '../utils/TextUtils';\nimport { fadeAndDestroy, fadeIn } from './FadeEffect';\n\nconst notifStyle: BitmapFontStyle = {\n  key: FontAssets.alienLeagueFont.key,\n  size: 100,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nconst notifTextConfig = {\n  x: screenCenter.x,\n  y: dialogueConstants.rect.y + notifStyle.size * 2,\n  oriX: 0.5,\n  oriY: 0.9\n};\n\n/**\n * A function to display a notifications such as location-change notification\n *\n * @param scene scene to attach this message to\n * @param message - the string you want to display\n * @returns {Promise} - a promise that resolves when notification is clicked\n */\nexport async function displayNotification(scene: IBaseScene, message: string): Promise<void> {\n  const dialogueRenderer = new DialogueRenderer({});\n  const container = dialogueRenderer.getDialogueContainer();\n\n  scene.getLayerManager().addToLayer(Layer.Effects, container);\n  scene.getLayerManager().fadeInLayer(Layer.Effects);\n\n  const notifText = createBitmapText(scene, message, notifTextConfig, notifStyle).setAlpha(0);\n  container.add(notifText);\n\n  SourceAcademyGame.getInstance().getSoundManager().playSound(SoundAssets.notifEnter.key);\n  scene.add.tween(fadeIn([notifText], Constants.fadeDuration * 2));\n\n  // Wait for fade in to finish\n  await sleep(Constants.fadeDuration * 2);\n\n  const showNotification = new Promise<void>(resolve => {\n    dialogueRenderer.getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP, () => {\n      SourceAcademyGame.getInstance().getSoundManager().playSound(SoundAssets.notifExit.key);\n      fadeAndDestroy(scene, notifText, { fadeDuration: Constants.fadeDuration / 4 });\n      dialogueRenderer.destroy();\n      resolve();\n    });\n  });\n\n  await showNotification;\n}\n","import SoundAssets from '../assets/SoundAssets';\nimport { Constants } from '../commons/CommonConstants';\nimport { AssetKey, BitmapFontStyle, TextConfig } from '../commons/CommonTypes';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { createBitmapText } from './TextUtils';\n\ntype ButtonConfig = {\n  assetKey: AssetKey;\n  message?: string;\n  textConfig?: TextConfig;\n  bitMapTextStyle?: BitmapFontStyle;\n  onDown?: () => void;\n  onUp?: () => void;\n  onHover?: () => void;\n  onOut?: () => void;\n  onPointerMove?: (pointer: Phaser.Input.Pointer, localX: number, localY: number) => void;\n  onHoverEffect?: boolean;\n  onClickSound?: AssetKey;\n  onHoverSound?: AssetKey;\n};\n\nconst onHoverAlpha = 1.0;\nconst offHoverAlpha = 0.9;\n\n/**\n * Create a button with basic functionalities.\n *\n * Functionalities include:\n * 1. Attached onDown, onUp, onHover, onOut listeners\n * 2. Text writing\n * 3. onHover and onOut alpha changes\n * 4. onClick and onHover sound effect\n *\n * @param scene scene to be attached to\n * @param assetKey asset key to be used as button image\n * @param message text to be written on the button, optional\n * @param textConfig config to apply to the text, optional\n * @param bitMapTextStyle bitMapText style to be used, optional\n * @param onDown callback to execute on onDown event, optional\n * @param onUp callback to execute on onUp event, optional\n * @param onHover callback to execute on onHover event, optional\n * @param onOut callback to execute on onOut event, optional\n * @param onPointerMove callback to execute on onPointerMove, optional\n * @param onHoverEffect if true, button will include onHover and onOut alpha changes, optional\n * @param onClickSound sound key to play when button is clicked, executed onUp, optional\n * @param onHoverSound sound key to play when button is hovered, optional\n * @param soundManager required for sound to be played, optional\n * @returns {Phaser.GameObjects.Container} button container\n */\nexport function createButton(\n  scene: Phaser.Scene,\n  {\n    assetKey,\n    message = '',\n    textConfig = { x: 0, y: 0, oriX: 0, oriY: 0 },\n    bitMapTextStyle = Constants.defaultFontStyle,\n    onDown = Constants.nullFunction,\n    onUp = Constants.nullFunction,\n    onHover = Constants.nullFunction,\n    onOut = Constants.nullFunction,\n    onPointerMove = Constants.nullFunction,\n    onHoverEffect = true,\n    onClickSound = SoundAssets.buttonClick.key,\n    onHoverSound = SoundAssets.buttonHover.key\n  }: ButtonConfig\n): Phaser.GameObjects.Container {\n  const container = new Phaser.GameObjects.Container(scene, 0, 0);\n\n  // Set up button functionality\n  const button = new Phaser.GameObjects.Sprite(scene, 0, 0, assetKey);\n  button.setInteractive({ pixelPerfect: true, useHandCursor: true });\n  button.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP, () => {\n    SourceAcademyGame.getInstance().getSoundManager().playSound(onClickSound);\n    onUp();\n  });\n  button.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER, () => {\n    SourceAcademyGame.getInstance().getSoundManager().playSound(onHoverSound);\n    if (onHoverEffect) container.setAlpha(onHoverAlpha);\n    onHover();\n  });\n  button.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT, () => {\n    if (onHoverEffect) container.setAlpha(offHoverAlpha);\n    onOut();\n  });\n  button.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN, () => {\n    onDown();\n  });\n  button.addListener(\n    Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,\n    (pointer: Phaser.Input.Pointer, localX: number, localY: number) => {\n      onPointerMove(pointer, localX, localY);\n    }\n  );\n\n  // Set up text\n  const text = createBitmapText(scene, message, textConfig, bitMapTextStyle);\n\n  container.add([button, text]);\n  if (onHoverEffect) container.setAlpha(offHoverAlpha);\n\n  return container;\n}\n","import FontAssets from '../assets/FontAssets';\nimport ImageAssets from '../assets/ImageAssets';\nimport SoundAssets from '../assets/SoundAssets';\nimport { Constants, screenSize } from '../commons/CommonConstants';\nimport { BitmapFontStyle } from '../commons/CommonTypes';\nimport { Layer } from '../layer/GameLayerTypes';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { createButton } from '../utils/ButtonUtils';\nimport { sleep } from '../utils/GameUtils';\nimport { calcListFormatPos, Color, HexColor } from '../utils/StyleUtils';\nimport { fadeAndDestroy } from './FadeEffect';\nimport { rightSideEntryTweenProps, rightSideExitTweenProps } from './FlyEffect';\n\nconst PromptConstants = {\n  textPad: 20,\n  textConfig: { x: 15, y: -15, oriX: 0.5, oriY: 0.5 },\n  y: 100,\n  width: 450,\n  yInterval: 100\n};\n\nconst textStyle = {\n  fontFamily: 'Verdana',\n  fontSize: '20px',\n  fill: Color.offWhite,\n  align: 'right',\n  lineSpacing: 10,\n  wordWrap: { width: PromptConstants.width - PromptConstants.textPad * 2 }\n};\n\nconst promptOptStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 25,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\n/**\n * Display a UI that asks users to choose which option they like\n *\n * @param scene - which scene to add this prompt in\n * @param text - question you want to ask\n * @param choices - an array of choices to show\n * @returns {Promise<number>} which choice index the user has chosen\n */\nexport async function promptWithChoices(\n  scene: Phaser.Scene,\n  text: string,\n  choices: string[]\n): Promise<number> {\n  const promptContainer = new Phaser.GameObjects.Container(scene, 0, 0);\n\n  const header = new Phaser.GameObjects.Text(\n    scene,\n    screenSize.x - PromptConstants.textPad,\n    PromptConstants.y,\n    text,\n    textStyle\n  ).setOrigin(1.0, 0.0);\n  const promptHeaderBg = new Phaser.GameObjects.Rectangle(\n    scene,\n    screenSize.x,\n    PromptConstants.y - PromptConstants.textPad,\n    PromptConstants.width,\n    header.getBounds().bottom * 0.5 + PromptConstants.textPad,\n    HexColor.darkBlue,\n    0.8\n  ).setOrigin(1.0, 0.0);\n  const promptBg = new Phaser.GameObjects.Rectangle(\n    scene,\n    screenSize.x,\n    PromptConstants.y - PromptConstants.textPad,\n    PromptConstants.width,\n    promptHeaderBg.getBounds().bottom * 0.5 + (choices.length + 0.5) * PromptConstants.yInterval,\n    HexColor.lightBlue,\n    0.2\n  ).setOrigin(1.0, 0.0);\n\n  promptContainer.add([promptBg, promptHeaderBg, header]);\n\n  const buttonPositions = calcListFormatPos({\n    numOfItems: choices.length,\n    xSpacing: 0,\n    ySpacing: PromptConstants.yInterval\n  });\n\n  GameGlobalAPI.getInstance().addToLayer(Layer.UI, promptContainer);\n\n  const activatePromptContainer: Promise<number> = new Promise(resolve => {\n    promptContainer.add(\n      choices.map((response, index) =>\n        createButton(scene, {\n          assetKey: ImageAssets.mediumButton.key,\n          message: response,\n          textConfig: PromptConstants.textConfig,\n          bitMapTextStyle: promptOptStyle,\n          onUp: () => {\n            promptContainer.destroy();\n            resolve(index);\n          }\n        }).setPosition(\n          screenSize.x - PromptConstants.width / 2,\n          buttonPositions[index][1] + promptHeaderBg.getBounds().bottom + 75\n        )\n      )\n    );\n  });\n\n  // Animate in\n  promptContainer.setPosition(screenSize.x, 0);\n  SourceAcademyGame.getInstance().getSoundManager().playSound(SoundAssets.notifEnter.key);\n  scene.add.tween({\n    targets: promptContainer,\n    alpha: 1,\n    ...rightSideEntryTweenProps\n  });\n  await sleep(rightSideEntryTweenProps.duration);\n\n  const response = await activatePromptContainer;\n\n  // Animate out\n  SourceAcademyGame.getInstance().getSoundManager().playSound(SoundAssets.notifExit.key);\n  scene.add.tween({\n    targets: promptContainer,\n    alpha: 1,\n    ...rightSideExitTweenProps\n  });\n\n  await sleep(rightSideExitTweenProps.duration);\n  fadeAndDestroy(scene, promptContainer, { fadeDuration: Constants.fadeDuration });\n\n  return response;\n}\n","export enum GamePhaseType {\n  Move = 'Move',\n  Explore = 'Explore',\n  Talk = 'Talk',\n  Menu = 'Menu',\n  EscapeMenu = 'EscapeMenu',\n  None = 'None',\n  Sequence = 'Sequence',\n  Dashboard = 'Dashboard'\n}\n\n/**\n * A terminal phase should only ever be the top-most phase in the phase stack.\n * In particular, this means the phase stack should only have at most one\n * terminal phase on it at any point. A terminal phase should be popped from\n * the stack before another phase is pushed on.\n */\nexport enum GameTerminalPhaseType {\n  EscapeMenu = GamePhaseType.EscapeMenu,\n  Dashboard = GamePhaseType.Dashboard\n}\n","import { GameAction } from '../../action/GameActionTypes';\nimport { SoundAsset } from '../../assets/AssetsTypes';\nimport { getAwardProp } from '../../awards/GameAwardsHelper';\nimport { BBoxProperty } from '../../boundingBoxes/GameBoundingBoxTypes';\nimport { Character, SpeakerDetail } from '../../character/GameCharacterTypes';\nimport { GamePosition, GameSize, ItemId } from '../../commons/CommonTypes';\nimport { AssetKey } from '../../commons/CommonTypes';\nimport { Dialogue } from '../../dialogue/GameDialogueTypes';\nimport { displayMiniMessage } from '../../effects/MiniMessage';\nimport { displayNotification } from '../../effects/Notification';\nimport { promptWithChoices } from '../../effects/Prompt';\nimport { Layer } from '../../layer/GameLayerTypes';\nimport { AnyId, GameItemType, GameLocation, LocationId } from '../../location/GameMapTypes';\nimport { GameMode } from '../../mode/GameModeTypes';\nimport { ObjectProperty } from '../../objects/GameObjectTypes';\nimport { GamePhaseType } from '../../phase/GamePhaseTypes';\nimport { SettingsJson } from '../../save/GameSaveTypes';\nimport SourceAcademyGame from '../../SourceAcademyGame';\nimport { StateObserver, UserStateType } from '../../state/GameStateTypes';\nimport { TaskDetail } from '../../task/GameTaskTypes';\nimport { courseId, mandatory } from '../../utils/GameUtils';\nimport GameManager from './GameManager';\n\n/**\n * This class exposes all the public API's of managers\n * in the Game Manager scene.\n *\n * It allows managers to access services globally\n * through GameGlobalAPI.getInstance().function() without\n * having to keep a reference to the gameManager.\n */\nclass GameGlobalAPI {\n  private gameManager: GameManager | undefined;\n\n  static instance: GameGlobalAPI;\n\n  private constructor() {\n    this.gameManager = undefined;\n  }\n\n  static getInstance() {\n    if (!GameGlobalAPI.instance) {\n      GameGlobalAPI.instance = new GameGlobalAPI();\n    }\n    return GameGlobalAPI.instance;\n  }\n\n  /////////////////////\n  //   Game Manager  //\n  /////////////////////\n\n  public getGameManager = () => mandatory(this.gameManager);\n\n  public setGameManager(gameManagerRef: GameManager): void {\n    this.gameManager = gameManagerRef;\n  }\n\n  public getCurrLocId(): LocationId {\n    return this.getGameManager().currentLocationId;\n  }\n\n  public getLocationAtId(locationId: LocationId): GameLocation {\n    return this.getGameManager().getStateManager().getGameMap().getLocationAtId(locationId);\n  }\n\n  public async changeLocationTo(locationName: string) {\n    await this.getGameManager().changeLocationTo(locationName);\n  }\n\n  /////////////////////\n  //    Game Mode    //\n  /////////////////////\n\n  public getLocationModes(locationId: LocationId): GameMode[] {\n    return this.getGameManager().getStateManager().getLocationModes(locationId);\n  }\n\n  public addLocationMode(locationId: LocationId, mode: GameMode): void {\n    this.getGameManager().getStateManager().addLocationMode(locationId, mode);\n  }\n\n  public removeLocationMode(locationId: LocationId, mode: GameMode): void {\n    this.getGameManager().getStateManager().removeLocationMode(locationId, mode);\n  }\n\n  /////////////////////\n  //   Interaction   //\n  /////////////////////\n\n  public hasTriggeredInteraction(id: string): boolean | undefined {\n    return this.getGameManager().getStateManager().hasTriggeredInteraction(id);\n  }\n\n  public triggerStateChangeAction(actionId: ItemId): void {\n    this.getGameManager().getStateManager().triggerStateChangeAction(actionId);\n  }\n\n  public triggerInteraction(id: string): void {\n    this.getGameManager().getStateManager().triggerInteraction(id);\n  }\n\n  /////////////////////\n  //    Game Items   //\n  /////////////////////\n\n  public watchGameItemType(gameItemType: GameItemType, stateObserver: StateObserver) {\n    this.getGameManager().getStateManager().watchGameItemType(gameItemType, stateObserver);\n  }\n\n  public getGameMap() {\n    return this.getGameManager().getStateManager().getGameMap();\n  }\n\n  public getGameItemsInLocation(gameItemType: GameItemType, locationId: LocationId): ItemId[] {\n    return this.getGameManager().getStateManager().getGameItemsInLocation(gameItemType, locationId);\n  }\n\n  public addItem(gameItemType: GameItemType, locationId: LocationId, itemId: ItemId): void {\n    this.getGameManager().getStateManager().addItem(gameItemType, locationId, itemId);\n  }\n\n  public removeItem(gameItemType: GameItemType, locationId: LocationId, itemId: ItemId): void {\n    return this.getGameManager().getStateManager().removeItem(gameItemType, locationId, itemId);\n  }\n\n  /////////////////////\n  //  Game Objects   //\n  /////////////////////\n\n  public makeObjectGlow(objectId: ItemId, turnOn: boolean) {\n    this.getGameManager().getObjectManager().makeObjectGlow(objectId, turnOn);\n  }\n\n  public makeObjectBlink(objectId: ItemId, turnOn: boolean) {\n    this.getGameManager().getObjectManager().makeObjectBlink(objectId, turnOn);\n  }\n\n  public setObjProperty(id: ItemId, newObjProp: ObjectProperty) {\n    this.getGameManager().getStateManager().setObjProperty(id, newObjProp);\n  }\n\n  public renderObjectLayerContainer(locationId: LocationId) {\n    this.getGameManager().getObjectManager().renderObjectsLayerContainer(locationId);\n  }\n\n  public getAllActivatables() {\n    return [\n      ...this.getGameManager().getObjectManager().getActivatables(),\n      ...this.getGameManager().getBBoxManager().getActivatables()\n    ];\n  }\n\n  /////////////////////\n  //    Game BBox    //\n  /////////////////////\n\n  public setBBoxProperty(id: ItemId, newBBoxProp: BBoxProperty) {\n    this.getGameManager().getStateManager().setBBoxProperty(id, newBBoxProp);\n  }\n\n  public renderBBoxLayerContainer(locationId: LocationId) {\n    this.getGameManager().getBBoxManager().renderBBoxLayerContainer(locationId);\n  }\n\n  /////////////////////\n  //  Game Objective //\n  /////////////////////\n\n  public areAllObjectivesComplete(): boolean {\n    return this.getGameManager().getStateManager().areAllObjectivesComplete();\n  }\n\n  public isObjectiveComplete(key: string): boolean {\n    return this.getGameManager().getStateManager().isObjectiveComplete(key);\n  }\n\n  public areObjectivesComplete(keys: string[]): boolean {\n    return this.getGameManager().getStateManager().areObjectivesComplete(keys);\n  }\n\n  public completeObjective(key: string): void {\n    this.getGameManager().getStateManager().completeObjective(key);\n  }\n\n  /////////////////////\n  //  Game Task      //\n  /////////////////////\n\n  public isTaskComplete(key: string): boolean {\n    return this.getGameManager().getStateManager().isTaskComplete(key);\n  }\n\n  public areTasksComplete(keys: string[]): boolean {\n    return this.getGameManager().getStateManager().areTasksComplete(keys);\n  }\n\n  public completeTask(key: string): void {\n    this.getGameManager().getStateManager().completeTask(key);\n    displayMiniMessage(this.getGameManager(), 'Task completed!');\n  }\n\n  public showTask(key: string): void {\n    this.getGameManager().getStateManager().showTask(key);\n    displayMiniMessage(this.getGameManager(), 'New task added');\n  }\n\n  public getAllVisibleTaskData(): Array<[TaskDetail, boolean]> {\n    return this.getGameManager().getStateManager().getAllVisibleTaskData();\n  }\n\n  /////////////////////\n  //   User State    //\n  /////////////////////\n\n  public addCollectible(id: string): void {\n    SourceAcademyGame.getInstance().getUserStateManager().addCollectible(id);\n  }\n\n  public async isInUserState(userStateType: UserStateType, id: string): Promise<boolean> {\n    return SourceAcademyGame.getInstance().getUserStateManager().isInUserState(userStateType, id);\n  }\n\n  /////////////////////\n  //   Game Layer    //\n  /////////////////////\n\n  public clearSeveralLayers(layerTypes: Layer[]) {\n    this.getGameManager().getLayerManager().clearSeveralLayers(layerTypes);\n  }\n\n  public addToLayer(layer: Layer, gameObj: Phaser.GameObjects.GameObject) {\n    this.getGameManager().getLayerManager().addToLayer(layer, gameObj);\n  }\n\n  public showLayer(layer: Layer) {\n    this.getGameManager().getLayerManager().showLayer(layer);\n  }\n\n  public hideLayer(layer: Layer) {\n    this.getGameManager().getLayerManager().hideLayer(layer);\n  }\n\n  public async fadeInLayer(layer: Layer, fadeDuration?: number) {\n    await this.getGameManager().getLayerManager().fadeInLayer(layer, fadeDuration);\n  }\n\n  public async fadeOutLayer(layer: Layer, fadeDuration?: number) {\n    await this.getGameManager().getLayerManager().fadeOutLayer(layer, fadeDuration);\n  }\n  /////////////////////\n  //  Location Notif //\n  /////////////////////\n\n  public async bringUpUpdateNotif(message: string) {\n    await displayNotification(this.getGameManager(), message);\n  }\n\n  /////////////////////\n  //   Story Action  //\n  /////////////////////\n\n  public async processGameActions(actionIds: ItemId[] | undefined) {\n    await this.getGameManager().getPhaseManager().pushPhase(GamePhaseType.Sequence);\n    await this.getGameManager().getActionManager().processGameActions(actionIds);\n    await this.getGameManager().getPhaseManager().popPhase();\n  }\n\n  public async processGameActionsInSamePhase(actionIds: ItemId[] | undefined) {\n    await this.getGameManager().getActionManager().processGameActions(actionIds);\n  }\n\n  /////////////////////\n  //   Dialogue      //\n  /////////////////////\n\n  public async showDialogue(dialogueId: ItemId) {\n    await this.getGameManager().getPhaseManager().pushPhase(GamePhaseType.Sequence);\n    await this.getGameManager().getDialogueManager().showDialogue(dialogueId);\n    await this.getGameManager().getPhaseManager().popPhase();\n  }\n\n  public async showDialogueInSamePhase(dialogueId: ItemId) {\n    await this.getGameManager().getDialogueManager().showDialogue(dialogueId);\n  }\n\n  /////////////////////\n  //   Storage      //\n  /////////////////////\n\n  public storeDialogueLine(newLine: string, newSpeakerDetail?: SpeakerDetail | null) {\n    this.getGameManager().getDialogueStorageManager().storeLine(newLine, newSpeakerDetail);\n  }\n\n  public getDialogueStorage() {\n    return this.getGameManager().getDialogueStorageManager().getDialogueStorage();\n  }\n\n  /////////////////////\n  //   Collectible   //\n  /////////////////////\n\n  public async obtainCollectible(collectibleId: string) {\n    displayMiniMessage(this.getGameManager(), `Obtained ${getAwardProp(collectibleId).title}`);\n    SourceAcademyGame.getInstance().getUserStateManager().addCollectible(collectibleId);\n  }\n\n  /////////////////////\n  //     Pop Up      //\n  /////////////////////\n\n  public displayPopUp(itemId: ItemId, position: GamePosition, duration?: number, size?: GameSize) {\n    this.getGameManager().getPopupManager().displayPopUp(itemId, position, duration, size);\n  }\n\n  public destroyAllPopUps() {\n    this.getGameManager().getPopupManager().destroyAllPopUps();\n  }\n\n  public async destroyPopUp(position: GamePosition) {\n    this.getGameManager().getPopupManager().destroyPopUp(position);\n  }\n\n  /////////////////////\n  //    Save Game    //\n  /////////////////////\n\n  public async saveGame() {\n    await this.getGameManager().getSaveManager().saveGame();\n  }\n\n  public async saveSettings(settingsJson: SettingsJson) {\n    await this.getGameManager().getSaveManager().saveSettings(settingsJson);\n  }\n\n  public getLoadedUserState() {\n    return this.getGameManager().getSaveManager().getLoadedUserState();\n  }\n\n  /////////////////////\n  //      Sound      //\n  /////////////////////\n\n  public getSoundManager() {\n    return SourceAcademyGame.getInstance().getSoundManager();\n  }\n\n  public playSound(soundKey: AssetKey) {\n    SourceAcademyGame.getInstance().getSoundManager().playSound(soundKey);\n  }\n\n  public playBgMusic(soundKey: AssetKey) {\n    SourceAcademyGame.getInstance().getSoundManager().playBgMusic(soundKey);\n  }\n\n  public async stopAllSound() {\n    SourceAcademyGame.getInstance().getSoundManager().stopAllSound();\n  }\n\n  public pauseCurrBgMusic() {\n    SourceAcademyGame.getInstance().getSoundManager().pauseCurrBgMusic();\n  }\n\n  public continueCurrBgMusic() {\n    SourceAcademyGame.getInstance().getSoundManager().continueCurrBgMusic();\n  }\n\n  public applySoundSettings(userSettings: SettingsJson) {\n    SourceAcademyGame.getInstance().getSoundManager().applyUserSettings(userSettings);\n  }\n\n  public loadSounds(soundAssets: SoundAsset[]) {\n    SourceAcademyGame.getInstance().getSoundManager().loadSounds(soundAssets);\n  }\n\n  /////////////////////\n  //    Animations   //\n  /////////////////////\n\n  public startAnimation(id: AnyId, startFrame: number, frameRate: number) {\n    const startImage = this.getAssetByKey(this.getGameMap().getAssetKeyFromId(id));\n    this.getGameManager().getAnimationManager().displayAnimation(startImage, startFrame, frameRate);\n  }\n\n  public stopAnimation(id: AnyId) {\n    const stopImage = this.getAssetByKey(this.getGameMap().getAssetKeyFromId(id));\n    this.getGameManager().getAnimationManager().stopAnimation(stopImage);\n  }\n\n  /////////////////////\n  //      Input      //\n  /////////////////////\n\n  public setDefaultCursor(cursor: string) {\n    this.getGameManager().getInputManager().setDefaultCursor(cursor);\n  }\n\n  public enableKeyboardInput(active: boolean) {\n    this.getGameManager().getInputManager().enableKeyboardInput(active);\n  }\n\n  public enableMouseInput(active: boolean) {\n    this.getGameManager().getInputManager().enableMouseInput(active);\n  }\n\n  public enableSprite(gameObject: Phaser.GameObjects.GameObject, active: boolean) {\n    active\n      ? this.getGameManager().input.enable(gameObject)\n      : this.getGameManager().input.disable(gameObject);\n  }\n\n  /////////////////////\n  //      Phases     //\n  /////////////////////\n\n  public async popPhase() {\n    await this.getGameManager().getPhaseManager().popPhase();\n  }\n\n  public async pushPhase(gamePhaseType: GamePhaseType) {\n    await this.getGameManager().getPhaseManager().pushPhase(gamePhaseType);\n  }\n\n  public async swapPhase(gamePhaseType: GamePhaseType) {\n    await this.getGameManager().getPhaseManager().swapPhase(gamePhaseType);\n  }\n\n  public isCurrentPhase(gamePhaseType: GamePhaseType) {\n    return this.getGameManager().getPhaseManager().isCurrentPhase(gamePhaseType);\n  }\n\n  /////////////////////\n  //   Background    //\n  /////////////////////\n\n  public renderBackgroundLayerContainer(locationId: LocationId) {\n    this.getGameManager().getBackgroundManager().renderBackgroundLayerContainer(locationId);\n  }\n\n  /////////////////////\n  //    Assessment   //\n  /////////////////////\n\n  public async promptNavigateToAssessment(assessmentId: number) {\n    const response = await promptWithChoices(\n      GameGlobalAPI.getInstance().getGameManager(),\n      `Are you ready for the challenge?`,\n      ['Yes', 'No']\n    );\n    if (response === 0) {\n      window.open(`/courses/${courseId()}/missions/${assessmentId}/0`, 'blank');\n      window.focus();\n    }\n  }\n\n  public async updateAssessmentState() {\n    await SourceAcademyGame.getInstance().getUserStateManager().loadAssessments();\n  }\n\n  /////////////////////\n  //   Characters    //\n  /////////////////////\n\n  public createCharacterSprite(\n    characterId: ItemId,\n    overrideExpression?: string,\n    overridePosition?: GamePosition\n  ) {\n    return this.getGameManager()\n      .getCharacterManager()\n      .createCharacterSprite(characterId, overrideExpression, overridePosition);\n  }\n\n  public moveCharacter(id: ItemId, newLocation: LocationId, newPosition: GamePosition) {\n    this.getGameManager().getStateManager().moveCharacter(id, newLocation, newPosition);\n  }\n\n  public updateCharacter(id: ItemId, expression: string) {\n    this.getGameManager().getStateManager().updateCharacter(id, expression);\n  }\n\n  /////////////////////\n  //  Item retrieval //\n  /////////////////////\n\n  public getDialogueById(dialogueId: ItemId): Dialogue {\n    return mandatory(this.getGameMap().getDialogueMap().get(dialogueId));\n  }\n\n  public getCharacterById(characterId: ItemId): Character {\n    return mandatory(this.getGameMap().getCharacterMap().get(characterId));\n  }\n\n  public getActionById(actionId: ItemId): GameAction {\n    return mandatory(this.getGameMap().getActionMap().get(actionId));\n  }\n\n  public getObjectById(objectId: ItemId): ObjectProperty {\n    return mandatory(this.getGameMap().getObjectPropMap().get(objectId));\n  }\n\n  public getBBoxById(bboxId: ItemId): BBoxProperty {\n    return mandatory(this.getGameMap().getBBoxPropMap().get(bboxId));\n  }\n  public getAssetByKey(assetKey: AssetKey) {\n    return this.getGameMap().getAssetByKey(assetKey);\n  }\n}\n\nexport default GameGlobalAPI;\n","import { ItemId } from '../commons/CommonTypes';\n\nexport enum GameStateStorage {\n  UserState = 'UserState',\n  ChecklistState = 'ChecklistState',\n  TasklistState = 'TasklistState'\n}\n\n/**\n * Type of user state list.\n */\nexport enum UserStateType {\n  collectibles = 'collectibles',\n  assessments = 'assessments',\n  achievements = 'achievements'\n}\n\n/**\n * State observer is a renderer that can reflect the changes\n * to the current scene\n */\nexport interface StateObserver {\n  handleAdd: (itemId: ItemId) => boolean;\n  handleDelete: (itemId: ItemId) => boolean;\n  handleMutate: (itemId: ItemId) => boolean;\n}\n","import { ItemId, TrackInteraction } from '../commons/CommonTypes';\nimport { GameStateStorage } from '../state/GameStateTypes';\n\nexport enum GameActionType {\n  MoveCharacter = 'MoveCharacter',\n  UpdateCharacter = 'UpdateCharacter',\n  ObtainCollectible = 'ObtainCollectible',\n  CompleteObjective = 'CompleteObjective',\n  CompleteTask = 'CompleteTask',\n  ShowTask = 'ShowTask',\n  PreviewLocation = 'PreviewLocation',\n  AddItem = 'AddItem',\n  RemoveItem = 'RemoveItem',\n  ShowDialogue = 'ShowDialogue',\n  ChangeBackground = 'ChangeBackground',\n  StartAnimation = 'StartAnimation',\n  StopAnimation = 'StopAnimation',\n  RemoveLocationMode = 'RemoveLocationMode',\n  AddLocationMode = 'AddLocationMode',\n  AddPopup = 'AddPopup',\n  MakeObjectBlink = 'MakeObjectBlink',\n  MakeObjectGlow = 'MakeObjectGlow',\n  PlayBGM = 'PlayBGM',\n  PlaySFX = 'PlaySFX',\n  ShowObjectLayer = 'ShowObjectLayer',\n  NavigateToAssessment = 'NavigateToAssessment',\n  UpdateAssessmentStatus = 'UpdateAssessmentStatus',\n  Delay = 'Delay'\n}\n\n/**\n * Interface for entities which can contain actions, including locations, objects, etc.\n */\nexport interface IGameActionable {\n  actionIds?: ItemId[];\n}\n/**\n * Condition object which encapsulates data about an action condition,\n * which is the condition that needs to be satisfied before an action\n * can be played\n *\n * @prop {GameStateStorage} state - the game state which needs to be checked to determine the truthiness of the condition\n * @prop {any} conditionParams - an object encapsulating more information about the condition,\n *                               such as itemId that needs to be checked for existence to satisfy the condition\n * @prop {boolean} boolean - whether the condition needs to match \"true\" or \"false\" before it is satisfied\n */\nexport type ActionCondition = {\n  state: GameStateStorage;\n  conditionParams: any;\n  boolean: boolean;\n};\n\n/**\n * Action object which encapsulates data about an action,\n * that can be performed.\n *\n * See Command Pattern/Redux actions.\n *\n * @prop {GameActionType} actionType - the type of action that will be performed\n * @prop {any} actionParams - an object containing information about the parameters of the action such as which entity ID to perform this action on\n * @prop {Array<ActionCondition>} actionConditions - a list of conditions that need to be satisfied in order for the action to be executed\n * @prop {isRepeatable} boolean - whether or not the action can be performed again when it is triggerd.\n */\nexport type GameAction = TrackInteraction & {\n  actionType: GameActionType;\n  actionParams: any;\n  actionConditions: ActionCondition[];\n  isRepeatable: boolean;\n};\n","import { IGameActionable } from '../action/GameActionTypes';\nimport { AssetKey, ItemId } from '../commons/CommonTypes';\nimport { GameMode } from '../mode/GameModeTypes';\n\n/**\n * @typedef {string} LocationId - id that identifies a location\n */\nexport type LocationId = string;\n\n/**\n * @typedef {LocationId | ItemId} AnyId - a general id type for a location or any object id\n */\nexport type AnyId = LocationId | ItemId;\n\n/**\n * @typedef {GameLocation} - encapsulates data about a location in a GameMap\n * @prop {ItemId[]} actionIds - ids of all actions that play when that location is visited\n * @prop {LocationId} id - the id to indentify that location\n * @prop {string} name - the name of the location as shown in the Move Menu\n * @prop {AssetKey} assetKey - the asset key for the background image of the location\n * @prop {Set<GameMode>} modes - the game modes that are available in the location\n * @prop {Set<ItemId>} talkTopics - the dialogue id of topics that players can talk about in Talk menu of that location\n * @prop {Set<ItemId>} objects - the object id of objects rendered in the location\n * @prop {Set<ItemId>} boundingBoxes - the id of the bounding boxes (invisible rectangles) in that location\n * @prop {AssetKey} bgmKey - the asset key of background musicbeing played in that location\n */\nexport type GameLocation = IGameActionable & {\n  id: LocationId;\n  name: string;\n  assetKey: AssetKey;\n  previewKey: AssetKey | null;\n  modes: Set<GameMode>;\n  navigation: Set<LocationId>;\n  talkTopics: Set<ItemId>;\n  objects: Set<ItemId>;\n  boundingBoxes: Set<ItemId>;\n  bgmKey: AssetKey;\n  characters: Set<ItemId>;\n};\n\nexport enum GameItemType {\n  navigation = 'navigation',\n  locations = 'locations',\n  talkTopics = 'talkTopics',\n  dialogues = 'dialogues',\n  objects = 'objects',\n  boundingBoxes = 'boundingBoxes',\n  characters = 'characters',\n  actions = 'actions',\n  bgmKey = 'bgmKey',\n  collectibles = 'collectibles'\n}\n","import GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport { GameStateStorage } from '../state/GameStateTypes';\nimport { ActionCondition } from './GameActionTypes';\n\n/**\n * This class checks for whether if-conditions are satisfied,\n * to determine whether or not game actions will be played out.\n */\nexport default class ActionConditionChecker {\n  /**\n   * Checks whether all action conditions are met\n   * @param actionConditions Array of action conditions\n   * @returns {Promise<boolean>} True if all conditions are met\n   */\n  public static async checkAllConditionsSatisfied(actionConditions: ActionCondition[]) {\n    const allConditions = await Promise.all(\n      actionConditions.map(\n        async actionCondition => await this.checkConditionSatisfied(actionCondition)\n      )\n    );\n    return allConditions.every(condition => condition === true);\n  }\n\n  /**\n   * Checks whether one action conditions is met\n   * Also stubs the user state\n   *\n   * @param conditional The action condition\n   * @returns {boolean} True if condition is met\n   */\n  public static async checkConditionSatisfied(conditional: ActionCondition) {\n    const { state, conditionParams, boolean } = conditional;\n    switch (state) {\n      case GameStateStorage.UserState:\n        return (\n          (await GameGlobalAPI.getInstance().isInUserState(\n            conditionParams.userStateType,\n            conditionParams.id\n          )) === boolean\n        );\n      case GameStateStorage.ChecklistState:\n        return GameGlobalAPI.getInstance().isObjectiveComplete(conditionParams.id) === boolean;\n      case GameStateStorage.TasklistState:\n        return GameGlobalAPI.getInstance().isTaskComplete(conditionParams.id) === boolean;\n      default:\n        return true;\n    }\n  }\n}\n","import { Layer } from '../layer/GameLayerTypes';\nimport { GamePhaseType } from '../phase/GamePhaseTypes';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { sleep } from '../utils/GameUtils';\nimport { GameActionType } from './GameActionTypes';\n\n/**\n * This class executes game actions by calling the right functions\n * from global API\n */\nexport default class GameActionExecuter {\n  /**\n   * Executes the game action based on given type and parameters\n   * @param actionType the type of action that will be executed\n   * @param actionParams an object containing all the parameters\n   */\n  public static async executeGameAction(actionType: GameActionType, actionParams: any) {\n    const globalAPI = GameGlobalAPI.getInstance();\n\n    switch (actionType) {\n      case GameActionType.AddItem:\n        globalAPI.addItem(actionParams.gameItemType, actionParams.locationId, actionParams.id);\n        return;\n      case GameActionType.RemoveItem:\n        globalAPI.removeItem(actionParams.gameItemType, actionParams.locationId, actionParams.id);\n        return;\n      case GameActionType.AddLocationMode:\n        globalAPI.addLocationMode(actionParams.locationId, actionParams.mode);\n        return;\n      case GameActionType.RemoveLocationMode:\n        globalAPI.removeLocationMode(actionParams.locationId, actionParams.mode);\n        return;\n      case GameActionType.MoveCharacter:\n        globalAPI.moveCharacter(actionParams.id, actionParams.locationId, actionParams.position);\n        return;\n      case GameActionType.UpdateCharacter:\n        globalAPI.updateCharacter(actionParams.id, actionParams.expression);\n        return;\n      case GameActionType.ChangeBackground:\n        globalAPI.renderBackgroundLayerContainer(actionParams.id);\n        return;\n      case GameActionType.StartAnimation:\n        globalAPI.startAnimation(actionParams.id, actionParams.startFrame, actionParams.frameRate);\n        return;\n      case GameActionType.StopAnimation:\n        globalAPI.stopAnimation(actionParams.id);\n        return;\n      case GameActionType.PreviewLocation:\n        globalAPI.renderBackgroundLayerContainer(actionParams.id);\n        globalAPI.renderObjectLayerContainer(actionParams.id);\n        globalAPI.renderBBoxLayerContainer(actionParams.id);\n        return;\n      case GameActionType.ObtainCollectible:\n        globalAPI.obtainCollectible(actionParams.id);\n        return;\n      case GameActionType.CompleteObjective:\n        globalAPI.completeObjective(actionParams.id);\n        return;\n      case GameActionType.CompleteTask:\n        globalAPI.completeTask(actionParams.id);\n        return;\n      case GameActionType.ShowTask:\n        globalAPI.showTask(actionParams.id);\n        return;\n      case GameActionType.ShowDialogue:\n        if (globalAPI.isCurrentPhase(GamePhaseType.Sequence)) {\n          await globalAPI.showDialogueInSamePhase(actionParams.id);\n        } else {\n          await globalAPI.showDialogue(actionParams.id);\n        }\n        return;\n      case GameActionType.AddPopup:\n        await globalAPI.displayPopUp(\n          actionParams.id,\n          actionParams.position,\n          actionParams.duration,\n          actionParams.size\n        );\n        return;\n      case GameActionType.MakeObjectBlink:\n        await globalAPI.makeObjectBlink(actionParams.id, actionParams.turnOn);\n        return;\n      case GameActionType.MakeObjectGlow:\n        await globalAPI.makeObjectGlow(actionParams.id, actionParams.turnOn);\n        return;\n      case GameActionType.PlayBGM:\n        SourceAcademyGame.getInstance().getSoundManager().playBgMusic(actionParams.id);\n        return;\n      case GameActionType.PlaySFX:\n        await SourceAcademyGame.getInstance().getSoundManager().playSound(actionParams.id);\n        return;\n      case GameActionType.ShowObjectLayer:\n        actionParams.show ? globalAPI.showLayer(Layer.Objects) : globalAPI.hideLayer(Layer.Objects);\n        return;\n      case GameActionType.NavigateToAssessment:\n        await globalAPI.promptNavigateToAssessment(actionParams.assessmentId);\n        return;\n      case GameActionType.UpdateAssessmentStatus:\n        await globalAPI.updateAssessmentState();\n        return;\n      case GameActionType.Delay:\n        await sleep(actionParams.duration);\n        return;\n      default:\n        return;\n    }\n  }\n\n  /**\n   * Determines if action is state change action type\n   * State-change actions are replayed at the start of every game\n   * They are actions that modify that game map's original state\n   *\n   * @param actionType - the type of action\n   */\n  public static isStateChangeAction(actionType: GameActionType) {\n    switch (actionType) {\n      case GameActionType.AddItem:\n      case GameActionType.RemoveItem:\n      case GameActionType.AddLocationMode:\n      case GameActionType.RemoveLocationMode:\n      case GameActionType.MoveCharacter:\n      case GameActionType.UpdateCharacter:\n        return true;\n      case GameActionType.NavigateToAssessment:\n      case GameActionType.UpdateAssessmentStatus:\n      case GameActionType.PreviewLocation:\n      case GameActionType.ChangeBackground:\n      case GameActionType.StartAnimation:\n      case GameActionType.StopAnimation:\n      case GameActionType.ObtainCollectible:\n      case GameActionType.CompleteObjective:\n      case GameActionType.CompleteTask:\n      case GameActionType.ShowTask:\n      case GameActionType.ShowDialogue:\n      case GameActionType.AddPopup:\n      case GameActionType.MakeObjectBlink:\n      case GameActionType.MakeObjectGlow:\n      case GameActionType.PlayBGM:\n      case GameActionType.PlaySFX:\n      case GameActionType.ShowObjectLayer:\n      case GameActionType.Delay:\n        return false;\n    }\n  }\n}\n","import { ItemId } from '../commons/CommonTypes';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport ActionConditionChecker from './GameActionConditionChecker';\nimport GameActionExecuter from './GameActionExecuter';\nimport { ActionCondition } from './GameActionTypes';\n\n/**\n * This class manages all game actions, and is called whenever\n * entities need to perform actions.\n */\nexport default class GameActionManager {\n  /**\n   * Executes an array of state-change actions\n   * to bring game state same as last player's progress\n   *\n   * @param actionIds ids of the actions\n   */\n  public async fastForwardGameActions(actionIds?: ItemId[]): Promise<void> {\n    if (!actionIds) return;\n    for (const actionId of actionIds) {\n      const { actionType, actionParams } = GameGlobalAPI.getInstance().getActionById(actionId);\n      await GameActionExecuter.executeGameAction(actionType, actionParams);\n    }\n  }\n\n  /**\n   * Process an array of actions, denoted by their IDs.\n   *\n   * NOTE: Saves the game after all the actions are executed.\n   *\n   * @param actionIds ids of the actions\n   */\n  public async processGameActions(actionIds?: ItemId[]): Promise<void> {\n    if (!actionIds) return;\n    for (const actionId of actionIds) {\n      await this.processGameAction(actionId);\n    }\n    await GameGlobalAPI.getInstance().saveGame();\n  }\n\n  /**\n   * Process an action, denoted by its ID.\n   *\n   * @param actionId id of the action\n   */\n  public async processGameAction(actionId: ItemId) {\n    const { actionType, actionParams, actionConditions, isRepeatable, interactionId } =\n      GameGlobalAPI.getInstance().getActionById(actionId);\n\n    if (await this.checkCanPlayAction(isRepeatable, interactionId, actionConditions)) {\n      await GameActionExecuter.executeGameAction(actionType, actionParams);\n      if (GameActionExecuter.isStateChangeAction(actionType)) {\n        GameGlobalAPI.getInstance().triggerStateChangeAction(actionId);\n      }\n      GameGlobalAPI.getInstance().triggerInteraction(actionId);\n    }\n  }\n\n  /**\n   * Check whether an action is playable.\n   *\n   * An action is playable if:\n   *  - Has not been triggered & has all of its condition fulfilled\n   *  - Has been triggered, but repeatable & & has all of its condition fulfilled\n   *\n   * @param isRepeatable whether the action is repeatable\n   * @param interactionId id of the interaction\n   * @param actionConditions condition to be fulfilled to play the action\n   */\n  private async checkCanPlayAction(\n    isRepeatable: boolean,\n    interactionId: string,\n    actionConditions: ActionCondition[]\n  ) {\n    return (\n      (isRepeatable || !GameGlobalAPI.getInstance().hasTriggeredInteraction(interactionId)) &&\n      (await ActionConditionChecker.checkAllConditionsSatisfied(actionConditions))\n    );\n  }\n}\n","import { AnimType, AssetType, ImageAsset } from '../assets/AssetsTypes';\nimport { AssetKey } from '../commons/CommonTypes';\nimport { GameItemType } from '../location/GameMapTypes';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport { mandatory } from '../utils/GameUtils';\n\n/**\n * Manager for game animations.\n * Creates Animation instances and stores them in the a\n */\nexport default class GameAnimationManager {\n  private game = GameGlobalAPI.getInstance().getGameManager();\n  private animationInstanceMap = new Map<AssetKey, Phaser.GameObjects.Sprite>();\n\n  /**\n   * Create an image (Phaser Image or Sprite).\n   *\n   * @param assetKey asset key of the image to\n   * create\n   * @param image image asset corresponding to\n   * the image to create\n   * @returns the instantiated image\n   */\n  public createImage(\n    image: ImageAsset,\n    assetKey: AssetKey\n  ): Phaser.GameObjects.Image | Phaser.GameObjects.Sprite {\n    switch (image.type) {\n      case AssetType.Sprite:\n        this.createAnimation(image, image.config?.start || 0, image.config?.frameRate || 20);\n        return this.getAnimation(image);\n        break;\n      case AssetType.Image:\n        return new Phaser.GameObjects.Image(\n          this.game,\n          image?.config?.centreX || 0,\n          image?.config?.centreY || 0,\n          assetKey\n        );\n        break;\n    }\n  }\n\n  /**\n   * Calls on the game manager for the given\n   * animation type (Object or Background) to\n   * add the given animation to the scene.\n   *\n   * @param image image corresponding to the\n   * animation to display\n   * @param startFrame the frame to start playing\n   * the animation from\n   * @param frameRate frame rate to play the animation\n   * at\n   */\n  public displayAnimation(image: ImageAsset, startFrame: number, frameRate: number) {\n    const img = GameGlobalAPI.getInstance().getAssetByKey(image.path);\n    // Update image config\n    if (img && img.config) {\n      img.config.start = startFrame;\n      img.config.frameRate = frameRate;\n    }\n\n    switch (img.config?.animType) {\n      case AnimType.Object:\n        const currLoc = GameGlobalAPI.getInstance().getCurrLocId();\n        GameGlobalAPI.getInstance().addItem(GameItemType.objects, currLoc, image.key);\n        break;\n      case AnimType.Background:\n        GameGlobalAPI.getInstance().renderBackgroundLayerContainer(image.key);\n        break;\n    }\n  }\n\n  /**\n   * Create a new Sprite object and store a\n   * reference to the instance.\n   *\n   * @param image image corresponding to a sprite\n   * @param startFrame the frame to start playing\n   * the animation from\n   * @param frameRate frame rate to play the animation\n   * at\n   */\n  private createAnimation(image: ImageAsset, startFrame: number, frameRate: number) {\n    if (this.isSprite(image)) {\n      this.removeAnimation(image);\n      const sprite = new Phaser.GameObjects.Sprite(\n        this.game,\n        image.config?.centreX || 0,\n        image.config?.centreY || 0,\n        image.path\n      );\n      const config = {\n        key: image.path,\n        frames: this.game.anims.generateFrameNumbers(image.path, {\n          start: startFrame,\n          end: image.config?.endFrame || 0,\n          first: 0\n        }),\n        frameRate: frameRate,\n        repeat: -1\n      };\n      this.game.anims.create(config);\n      this.animationInstanceMap.set(image.key, sprite);\n    }\n  }\n\n  /**\n   * Play an instantiated sprite.\n   *\n   * @param image image asset corresponding\n   * to the sprite to play\n   */\n  public startAnimation(image: ImageAsset) {\n    if (this.isSprite(image)) {\n      const sprite = this.getAnimation(image);\n      sprite.play(image.path, false);\n      this.game.add.existing(sprite);\n    }\n  }\n\n  /**\n   * Stop playing an instantiated sprite.\n   *\n   * @param image image asset corresponding\n   * to the sprite to stop playing\n   */\n  public stopAnimation(image: ImageAsset) {\n    const sprite = this.animationInstanceMap.get(image.key);\n    if (this.isSprite(image) && sprite && sprite.anims) {\n      sprite.anims.stop();\n    }\n  }\n\n  /**\n   * Destroys and deletes sprite instance corresponding\n   * to the the given image asset from the animation\n   * instance map.\n   *\n   * @param image image asset corresponding to the Sprite\n   * instance to be deleted\n   */\n  public removeAnimation(image: ImageAsset) {\n    const anim = this.animationInstanceMap.get(image.key);\n    if (anim) {\n      this.game.anims.remove(image.path);\n      anim.destroy();\n      this.animationInstanceMap.delete(image.key);\n    }\n  }\n\n  /**\n   * Get the Phaser animation instance corresponding\n   * to the given image asset.\n   *\n   * @param image image asset corresponding to the Sprite\n   * instance to be retrieved\n   * @returns Instantiated Phaser Sprite object corresponding\n   * to given image\n   */\n  public getAnimation(image: ImageAsset): Phaser.GameObjects.Sprite {\n    return mandatory(this.animationInstanceMap.get(image.key), `Image: ${image.path} not found`);\n  }\n\n  /**\n   * Checks whether given image is a sprite\n   *\n   * @param image\n   * @returns true iff image is a sprite\n   */\n  private isSprite = (image: ImageAsset) => image.type === AssetType.Sprite;\n}\n","/**\n * Resize a displayed object to given width and height\n * if both dimensions are specified.\n *\n * If either one of width or height is zero/undefined,\n * then only the given dimension will be used to scale the image\n * proportionally according to aspect-ratio\n *\n * @param obj object to be resized\n * @param width desired width of object\n * @param height desired height of object\n */\nexport function resize(\n  obj: Phaser.GameObjects.Image | Phaser.GameObjects.Rectangle,\n  width: number,\n  height?: number\n) {\n  const ratio = obj.displayHeight / obj.displayWidth;\n  if (!width) {\n    obj.displayWidth = height! / ratio;\n    obj.displayHeight = height!;\n  } else {\n    obj.displayWidth = width;\n    obj.displayHeight = height || width * ratio;\n  }\n}\n\n/**\n * Resize the obj display size such that the shorter side fits\n * the width/height i.e. the other dimension will overflow.\n *\n * @param obj obj to be resized\n * @param width width\n * @param height height\n */\nexport function resizeOverflow(\n  obj: Phaser.GameObjects.Image | Phaser.GameObjects.Rectangle,\n  width: number,\n  height: number\n) {\n  if (obj.displayWidth > obj.displayHeight) {\n    resize(obj, 0, height);\n  } else {\n    resize(obj, width);\n  }\n}\n\n/**\n * Resize the obj display size such that the longer side fits\n * the width/height i.e. the other dimension will underflow.\n *\n * @param obj obj to be resized\n * @param width width\n * @param height height\n */\nexport function resizeUnderflow(\n  obj: Phaser.GameObjects.Image | Phaser.GameObjects.Rectangle,\n  width: number,\n  height: number\n) {\n  if (obj.displayWidth > obj.displayHeight) {\n    resize(obj, width);\n  } else {\n    resize(obj, 0, height);\n  }\n}\n\n/**\n * Multiplies sprite dimension by factor\n *\n * @param obj obj to be resized\n * @param factor number of times to multiply the object's width and height by.\n */\nexport function multiplyDimensions(\n  obj: Phaser.GameObjects.Image | Phaser.GameObjects.Rectangle,\n  factor: number\n) {\n  obj.displayWidth *= factor;\n  obj.displayHeight *= factor;\n}\n","import ImageAssets from '../assets/ImageAssets';\nimport { Constants } from '../commons/CommonConstants';\nimport { IBaseScene } from '../commons/CommonTypes';\nimport { DashboardPageManager } from '../dashboard/GameDashboardTypes';\nimport { createButton } from '../utils/ButtonUtils';\nimport { limitNumber } from '../utils/GameUtils';\nimport { resizeUnderflow } from '../utils/SpriteUtils';\nimport { calcListFormatPos } from '../utils/StyleUtils';\nimport { createBitmapText } from '../utils/TextUtils';\nimport AwardsConstants, {\n  awardDescStyle,\n  awardKeyStyle,\n  awardTitleStyle,\n  listBannerTextStyle\n} from './GameAwardsConstants';\nimport { createAssetKeyPreviewCont, getAwardProps } from './GameAwardsHelper';\nimport { AwardProperty } from './GameAwardsTypes';\n\n/**\n * Manager for an award page on the dashboard (either collectibles or achievements).\n */\nclass GameAwardsManager implements DashboardPageManager {\n  private scene: IBaseScene;\n  private awardsGetter: () => string[]; // The function for retrieving the award keys\n\n  private uiContainer: Phaser.GameObjects.Container | undefined;\n  private previewContainer: Phaser.GameObjects.Container | undefined;\n  private itemsContainer: Phaser.GameObjects.Container | undefined;\n  private activePageNumber: number;\n\n  constructor(scene: IBaseScene, awardsGetter: () => string[]) {\n    this.scene = scene;\n    this.awardsGetter = awardsGetter;\n    this.activePageNumber = 0;\n  }\n\n  /**\n   * Create the container that encapsulate the 'Award Menu' UI.\n   */\n  public createUIContainer() {\n    const awardContainer = new Phaser.GameObjects.Container(this.scene, 0, 0);\n    this.uiContainer = awardContainer;\n\n    // Add page arrows\n    const arrowLeft = createButton(this.scene, {\n      assetKey: ImageAssets.arrow.key,\n      onUp: () => this.nextPage(false)\n    })\n      .setScale(AwardsConstants.arrow.yScale, AwardsConstants.arrow.yScale)\n      .setRotation((-90 * Math.PI) / 180)\n      .setPosition(\n        AwardsConstants.arrow.x - AwardsConstants.arrow.xOffset,\n        AwardsConstants.arrow.y\n      );\n\n    const arrowRight = createButton(this.scene, {\n      assetKey: ImageAssets.arrow.key,\n      onUp: () => this.nextPage(true)\n    })\n      .setScale(AwardsConstants.arrow.xScale, AwardsConstants.arrow.yScale)\n      .setRotation((90 * Math.PI) / 180)\n      .setPosition(\n        AwardsConstants.arrow.x + AwardsConstants.arrow.xOffset,\n        AwardsConstants.arrow.y\n      );\n    awardContainer.add([arrowLeft, arrowRight]);\n\n    // Add preview frame\n    const frame = new Phaser.GameObjects.Sprite(\n      this.scene,\n      AwardsConstants.preview.rect.x,\n      AwardsConstants.preview.rect.y,\n      ImageAssets.popUpFrame.key\n    ).setScale(1.2);\n    awardContainer.add(frame);\n\n    // Add asset key container\n    awardContainer.add(createAssetKeyPreviewCont(this.scene));\n\n    // Set initial page\n    this.setPage();\n\n    return awardContainer;\n  }\n\n  /**\n   * Change the current page in view to a new page.\n   *\n   * Internally, destroy and replace the containers to reflect\n   * the new page.\n   */\n  private setPage() {\n    if (this.uiContainer) {\n      if (this.itemsContainer) this.itemsContainer.destroy();\n\n      // Update\n      this.itemsContainer = this.createItemsContainer();\n      this.uiContainer.add(this.itemsContainer);\n\n      // Set default preview\n      this.setPreview();\n    }\n  }\n\n  /**\n   * Set the preview of the award; shown on the left side of the menu.\n   *\n   * The preview include the title of achievement, object asset, asset key,\n   * as well as asset description.\n   *\n   * @param award award to preview\n   */\n  private setPreview(award?: AwardProperty) {\n    if (this.uiContainer) {\n      if (this.previewContainer) this.previewContainer.destroy();\n      if (!award) return;\n\n      this.previewContainer = new Phaser.GameObjects.Container(\n        this.scene,\n        AwardsConstants.preview.rect.xOffset,\n        AwardsConstants.preview.rect.yOffset\n      );\n\n      // Preview image\n      let previewAsset;\n      if (award.assetKey === Constants.nullInteractionId) {\n        // No asset is associated with the award\n        previewAsset = createBitmapText(\n          this.scene,\n          'No preview available',\n          AwardsConstants.noPreviewTextConfig,\n          awardKeyStyle\n        );\n      } else {\n        const previewRect = AwardsConstants.preview.rect;\n        previewAsset = new Phaser.GameObjects.Sprite(this.scene, 0, 0, award.assetKey);\n        resizeUnderflow(previewAsset, previewRect.dim, previewRect.dim);\n        previewAsset.setPosition(previewRect.x, previewRect.y);\n      }\n\n      // Preview title\n      const previewTitle = createBitmapText(\n        this.scene,\n        award.title,\n        AwardsConstants.preview.titleTextConfig,\n        awardTitleStyle\n      );\n\n      // Preview description\n      const previewDesc = new Phaser.GameObjects.Text(\n        this.scene,\n        AwardsConstants.preview.rect.x,\n        AwardsConstants.preview.rect.y + AwardsConstants.preview.descText.yOffset,\n        award.description,\n        awardDescStyle\n      ).setOrigin(0.5, 0.0);\n\n      // Preview asset key, use only empty string if award is not completed\n      const assetKey = award.completed === false ? '' : award.assetKey;\n      const previewKey = createBitmapText(\n        this.scene,\n        assetKey,\n        AwardsConstants.preview.keyTextConfig,\n        awardKeyStyle\n      );\n\n      // Black tint to overlay the asset if award is not completed\n      const blackTint = new Phaser.GameObjects.Rectangle(\n        this.scene,\n        AwardsConstants.preview.rect.x,\n        AwardsConstants.preview.rect.y,\n        AwardsConstants.preview.rect.dim,\n        AwardsConstants.preview.rect.dim,\n        0\n      ).setAlpha(award.completed ? 0 : 0.8);\n\n      this.previewContainer.add([previewAsset, blackTint, previewTitle, previewDesc, previewKey]);\n      this.uiContainer.add(this.previewContainer);\n    }\n  }\n\n  /**\n   * Flip the page.\n   *\n   * The minimum page number is 0, which represent the\n   * start of the list.\n   *\n   * This method is only able to flip forward (increment the page number)\n   * if there is still items to be shown on the list after what is\n   * shown currently.\n   *\n   * @param next if next is set to true, page number will be incremented\n   *             by one; else it will be decremented by one.\n   */\n  private nextPage(next: boolean) {\n    const currPageNum = this.activePageNumber;\n    const newPageNum = limitNumber(\n      next ? currPageNum + 1 : currPageNum - 1,\n      0,\n      Number.MAX_SAFE_INTEGER\n    );\n    const itemLength = this.getItems(newPageNum).length;\n\n    if (itemLength > 0) {\n      this.activePageNumber = newPageNum;\n      this.setPage();\n    }\n  }\n\n  /**\n   * Create a container that represent the list of objects\n   * to be selected on the screen.\n   */\n  private createItemsContainer() {\n    const itemsContainer = new Phaser.GameObjects.Container(this.scene, 0, 0);\n\n    // Use the previously active page number of the page\n    const items = this.getItems(this.activePageNumber);\n    const itemPositions = calcListFormatPos({\n      numOfItems: items.length,\n      xSpacing: 0,\n      ySpacing: AwardsConstants.list.ySpace\n    });\n\n    // Populate container with all the item buttons\n    itemsContainer.add(\n      items.map((awardProp, index) =>\n        this.createItemButton(\n          awardProp.title,\n          itemPositions[index][0],\n          itemPositions[index][1] + AwardsConstants.list.yStart,\n          () => this.setPreview(awardProp),\n          awardProp.completed !== false\n        )\n      )\n    );\n    return itemsContainer;\n  }\n\n  /**\n   * Format the button information to a UI container, complete with\n   * styling and functionality. This button represent the object selection\n   * button.\n   *\n   * @param obj name of object to be displayed on the button\n   * @param xPos x position of the button\n   * @param yPos y position of the button\n   * @param callback callback to be executed on click\n   */\n  private createItemButton(\n    obj: string,\n    xPos: number,\n    yPos: number,\n    callback: any,\n    completed: boolean\n  ) {\n    const button = createButton(this.scene, {\n      assetKey: ImageAssets.awardsBanner.key,\n      message: obj,\n      textConfig: AwardsConstants.listTextConfig,\n      bitMapTextStyle: listBannerTextStyle,\n      onUp: callback,\n      onHoverEffect: completed\n    }).setPosition(xPos, yPos);\n\n    // For non completed award, they do not hover effect and is less visible\n    if (!completed) button.setAlpha(0.5);\n    return button;\n  }\n\n  /**\n   * Get the list of objects to be shown on the UI.\n   *\n   * List items is dependent on the active page;\n   * and is only limited to a number of items due to UI\n   * size. Hence, which section of list is taken is\n   * dependent on the parameter pageNum.\n   *\n   * @param pageNum page number\n   */\n  private getItems(pageNum: number) {\n    const keys = this.awardsGetter();\n    const itemList = getAwardProps(keys);\n    const itemStartIdx = pageNum * AwardsConstants.itemsPerPage;\n    return itemList.slice(itemStartIdx, itemStartIdx + AwardsConstants.itemsPerPage);\n  }\n}\n\nexport default GameAwardsManager;\n","import { ImageAsset } from '../assets/AssetsTypes';\nimport { screenSize } from '../commons/CommonConstants';\nimport { AssetKey } from '../commons/CommonTypes';\nimport { Layer } from '../layer/GameLayerTypes';\nimport { LocationId } from '../location/GameMapTypes';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport { resizeOverflow } from '../utils/SpriteUtils';\n\n/**\n * Manager for game's background.\n * Loads the background for a location on navigate and change_background action.\n */\nexport default class GameBackgroundManager {\n  private currentBackground?: ImageAsset;\n  /**\n   * Render the background with the asset attached to the location ID.\n   *\n   * @param locationId id of the location\n   */\n  public renderBackgroundLayerContainer(locationId: LocationId) {\n    const assetKey = GameGlobalAPI.getInstance().getLocationAtId(locationId).assetKey;\n\n    this.renderBackgroundImage(assetKey);\n  }\n\n  /**\n   * Render the background with the image associated with the asset key.\n   * The image will be resized (overflow) to fit the screen.\n   *\n   * @param assetKey key of the image\n   */\n  private renderBackgroundImage(assetKey: AssetKey) {\n    GameGlobalAPI.getInstance().clearSeveralLayers([Layer.Background]);\n    this.currentBackground = GameGlobalAPI.getInstance().getAssetByKey(assetKey);\n    const animationManager = GameGlobalAPI.getInstance().getGameManager().getAnimationManager();\n    let asset: Phaser.GameObjects.Image | Phaser.GameObjects.Sprite | undefined;\n\n    if (this.currentBackground) {\n      asset = animationManager.createImage(this.currentBackground, assetKey);\n      animationManager.startAnimation(this.currentBackground);\n\n      resizeOverflow(asset, screenSize.x, screenSize.y);\n      GameGlobalAPI.getInstance().addToLayer(Layer.Background, asset);\n      GameGlobalAPI.getInstance().fadeInLayer(Layer.Background);\n    }\n  }\n}\n","import { Layer } from 'src/features/game/layer/GameLayerTypes';\nimport GameGlobalAPI from 'src/features/game/scenes/gameManager/GameGlobalAPI';\n\nimport { ItemId } from '../commons/CommonTypes';\nimport { GameItemType, LocationId } from '../location/GameMapTypes';\nimport { ActivatableSprite } from '../objects/GameObjectTypes';\nimport { StateObserver } from '../state/GameStateTypes';\nimport { BBoxProperty } from './GameBoundingBoxTypes';\n\n/**\n * Manager for rendering interactive bounding boxes in the location.\n */\nclass GameBoundingBoxManager implements StateObserver {\n  private bboxes: Map<ItemId, ActivatableSprite>;\n\n  constructor() {\n    this.bboxes = new Map<ItemId, ActivatableSprite>();\n    GameGlobalAPI.getInstance().watchGameItemType(GameItemType.boundingBoxes, this);\n  }\n\n  /**\n   * Clear the layers, and render all the bboxes available to the location.\n   * Will immediately be shown on the screen.\n   *\n   * @param locationId location in which to render bboxes at\n   */\n  public renderBBoxLayerContainer(locationId: LocationId): void {\n    GameGlobalAPI.getInstance().clearSeveralLayers([Layer.BBox]);\n    const bboxIdsToRender = GameGlobalAPI.getInstance().getGameItemsInLocation(\n      GameItemType.boundingBoxes,\n      locationId\n    );\n\n    // Refresh mapping\n    this.bboxes.clear();\n\n    // Add all the bbox\n    bboxIdsToRender.map(id => this.handleAdd(id));\n  }\n\n  /**\n   * Create the bbox from the given bbox property.\n   * Because we want this sprite to be activatable\n   * by Explore Mode UI, we expose its actionIds\n   * and interactionId\n   *\n   * @param bboxProperty bbox property to be used\n   */\n  private createBBox(bboxProperty: BBoxProperty): ActivatableSprite {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    const { x, y, width, height, actionIds, interactionId } = bboxProperty;\n    const bboxSprite = new Phaser.GameObjects.Rectangle(gameManager, x, y, width, height, 0, 0);\n    if (bboxProperty.isInteractive) {\n      bboxSprite.setInteractive();\n    }\n\n    return {\n      sprite: bboxSprite,\n      clickArea: bboxSprite,\n      actionIds,\n      interactionId\n    };\n  }\n\n  /**\n   * Add the bbox, specified by the ID, into the scene\n   * and keep track of it within the mapping.\n   *\n   * Throws error if the bbox property is not available\n   * in the mapping.\n   *\n   * @param id id of bbox\n   * @return {boolean} true if successful, false otherwise\n   */\n  public handleAdd(id: ItemId): boolean {\n    const bboxProp = GameGlobalAPI.getInstance().getBBoxById(id);\n    const bbox = this.createBBox(bboxProp);\n    GameGlobalAPI.getInstance().addToLayer(Layer.BBox, bbox.sprite as Phaser.GameObjects.Rectangle);\n    this.bboxes.set(id, bbox);\n    return true;\n  }\n\n  /**\n   * Mutate the bbox of the given id.\n   *\n   * Internally, will delete and re-add the bbox with\n   * the updated property.\n   *\n   * @param id id of bbox\n   * @return {boolean} true if successful, false otherwise\n   */\n  public handleMutate(id: ItemId): boolean {\n    return this.handleDelete(id) && this.handleAdd(id);\n  }\n\n  /**\n   * Delete the bbox of the given id, if\n   * applicable.\n   *\n   * @param id id of the bbox\n   * @return {boolean} true if successful, false otherwise\n   */\n  public handleDelete(id: ItemId): boolean {\n    const bbox = this.bboxes.get(id);\n    if (bbox) {\n      this.bboxes.delete(id);\n      (bbox.sprite as Phaser.GameObjects.Rectangle).destroy();\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Get all the rectanlge sprites which can be activated\n   * by external Explore Mode UI\n   */\n  public getActivatables() {\n    return Array.from(this.bboxes.values());\n  }\n}\n\nexport default GameBoundingBoxManager;\n","import { screenCenter, screenSize } from '../commons/CommonConstants';\n\nconst charXOffset = 350;\n\nconst CharConstants = {\n  charWidth: 600,\n  charRect: {\n    x: { Left: charXOffset, Middle: screenCenter.x, Right: screenSize.x - charXOffset }\n  }\n};\n\nexport default CharConstants;\n","import GameGlobalAPI from 'src/features/game/scenes/gameManager/GameGlobalAPI';\n\nimport { screenSize } from '../commons/CommonConstants';\nimport { GamePosition, ItemId } from '../commons/CommonTypes';\nimport { Layer } from '../layer/GameLayerTypes';\nimport { GameItemType, LocationId } from '../location/GameMapTypes';\nimport { StateObserver } from '../state/GameStateTypes';\nimport { resize } from '../utils/SpriteUtils';\nimport CharConstants from './GameCharacterConstants';\n\n/**\n * Manager for rendering characters in the location.\n */\nexport default class CharacterManager implements StateObserver {\n  private characterSpriteMap: Map<ItemId, Phaser.GameObjects.Image>;\n\n  constructor() {\n    this.characterSpriteMap = new Map<ItemId, Phaser.GameObjects.Image>();\n    GameGlobalAPI.getInstance().watchGameItemType(GameItemType.characters, this);\n  }\n\n  /**\n   * Clear the layers, and render all the characters available to the location.\n   * Will immediately be shown on the screen.\n   *\n   * @param locationId location in which to render characters at\n   */\n  public renderCharacterLayerContainer(locationId: LocationId): void {\n    const idsToRender = GameGlobalAPI.getInstance().getGameItemsInLocation(\n      GameItemType.characters,\n      locationId\n    );\n\n    // Refresh mapping\n    this.characterSpriteMap.clear();\n\n    // Add all the characters\n    idsToRender.map(id => this.handleAdd(id));\n  }\n\n  /**\n   * Create the character sprite based on its ID,\n   * expression, and put it at the specified location.\n   *\n   * @param characterId id of the character\n   * @param overrideExpression expression of the shown character, optional\n   * @param overridePosition position to put the character at, optional\n   */\n  public createCharacterSprite(\n    characterId: ItemId,\n    overrideExpression?: string,\n    overridePosition?: GamePosition\n  ) {\n    const character = GameGlobalAPI.getInstance().getCharacterById(characterId);\n    const { defaultPosition, defaultExpression, expressions, scale } = character;\n    const characterXPosition = CharConstants.charRect.x[overridePosition || defaultPosition];\n    const assetKey = expressions.get(overrideExpression || defaultExpression)!;\n\n    const characterSprite = new Phaser.GameObjects.Image(\n      GameGlobalAPI.getInstance().getGameManager(),\n      characterXPosition,\n      screenSize.y,\n      assetKey\n    ).setOrigin(0.5, 1);\n\n    resize(characterSprite, CharConstants.charWidth * scale);\n    return characterSprite;\n  }\n\n  /**\n   * Add the character, specified by the ID, into the scene\n   * and keep track of it within the mapping.\n   *\n   * @param id id of character\n   * @return {boolean} true if successful, false otherwise\n\n   */\n  public handleAdd(id: ItemId): boolean {\n    const characterSprite = this.createCharacterSprite(id);\n    GameGlobalAPI.getInstance().addToLayer(Layer.Character, characterSprite);\n    this.characterSpriteMap.set(id, characterSprite);\n    return true;\n  }\n\n  /**\n   * Mutate the character of the given id.\n   *\n   * Internally, will delete and re-add the character with\n   * the updated property.\n   *\n   * @param id id of character\n   * @return {boolean} true if successful, false otherwise\n\n   */\n  public handleMutate(id: ItemId): boolean {\n    return this.handleDelete(id) && this.handleAdd(id);\n  }\n\n  /**\n   * Delete the character of the given id, if\n   * applicable.\n   *\n   * @param id id of the character\n   *  @return {boolean} true if successful, false otherwise\n   */\n  public handleDelete(id: ItemId) {\n    const char = this.characterSpriteMap.get(id);\n    if (char) {\n      this.characterSpriteMap.delete(id);\n      char.destroy();\n      return true;\n    }\n    return false;\n  }\n}\n","import FontAssets from '../assets/FontAssets';\nimport { screenSize } from '../commons/CommonConstants';\nimport { BitmapFontStyle } from '../commons/CommonTypes';\n\nexport const pageBannerTextStyle: BitmapFontStyle = {\n  key: FontAssets.alienLeagueFont.key,\n  size: 35,\n  align: Phaser.GameObjects.BitmapText.ALIGN_LEFT\n};\n\nconst DashboardConstants = {\n  backButton: { y: screenSize.y * 0.3 },\n  page: { yStart: -screenSize.y * 0.3, ySpace: 150 },\n  pageTextConfig: { x: screenSize.x * 0.3, y: 0, oriX: 0.1, oriY: 0.5 },\n  pageArea: { x: -869, y: -412, width: screenSize.x * 0.72, height: screenSize.y * 0.77 }\n};\n\nexport default DashboardConstants;\n","export enum DashboardPage {\n  Log = 'Log',\n  Tasks = 'Tasks',\n  Collectibles = 'Collectibles',\n  Achievements = 'Achievements'\n}\n\nexport interface DashboardPageManager {\n  createUIContainer: () => Phaser.GameObjects.Container;\n}\n","import ImageAssets from '../assets/ImageAssets';\nimport SoundAssets from '../assets/SoundAssets';\nimport { screenCenter, screenSize } from '../commons/CommonConstants';\nimport { IBaseScene, IGameUI } from '../commons/CommonTypes';\nimport { fadeAndDestroy } from '../effects/FadeEffect';\nimport { entryTweenProps, exitTweenProps } from '../effects/FlyEffect';\nimport { Layer } from '../layer/GameLayerTypes';\nimport { GamePhaseType } from '../phase/GamePhaseTypes';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { createButton } from '../utils/ButtonUtils';\nimport { sleep } from '../utils/GameUtils';\nimport { calcListFormatPos } from '../utils/StyleUtils';\nimport DashboardConstants, { pageBannerTextStyle } from './GameDashboardConstants';\nimport { DashboardPage, DashboardPageManager } from './GameDashboardTypes';\n\n/**\n * Manager for the dashboard.\n *\n * Here, the dialogue log and task log are available for browsing.\n */\nclass GameDashboardManager implements IGameUI {\n  private scene: IBaseScene;\n  private pages: DashboardPage[];\n  private pageManagers: DashboardPageManager[];\n\n  private pageMask: Phaser.Display.Masks.GeometryMask;\n  private uiContainer: Phaser.GameObjects.Container | undefined;\n  private pageChosenContainer: Phaser.GameObjects.Container | undefined;\n  private pageUIContainers: Phaser.GameObjects.Container[];\n  private currPageIndex: number;\n\n  constructor(scene: IBaseScene, pages: DashboardPage[], pageManagers: DashboardPageManager[]) {\n    this.scene = scene;\n    this.pages = pages;\n    this.pageManagers = pageManagers;\n    this.pageMask = this.createPageMask();\n    // Used to store each page's UI so they only get created once each time dashboard is opened.\n    this.pageUIContainers = new Array(pages.length);\n    this.currPageIndex = 0; // Use first page as starting page\n    this.scene.getPhaseManager().addPhaseToMap(GamePhaseType.Dashboard, this);\n  }\n\n  /**\n   * Creates the GeometryMask through which each page's UI can be seen.\n   */\n  private createPageMask() {\n    const shape = new Phaser.GameObjects.Graphics(this.scene);\n    // This is the rectangle of the background image\n    const { x, y, width, height } = DashboardConstants.pageArea;\n    shape.fillRect(x, y, width, height);\n    return shape.createGeometryMask();\n  }\n\n  /**\n   * Change the current page in view to a new page.\n   *\n   * Internally, create a container for each page when the page is first\n   * opened or retrieve the container from cache if opened before;\n   * also sets up the blue outline that denotes that the page is chosen.\n   *\n   * @param pageIndex new page\n   */\n  private setPage(pageIndex: number) {\n    if (this.uiContainer) {\n      if (this.pageChosenContainer) this.pageChosenContainer.destroy();\n\n      // Hide current page\n      const currPageUIContainer = this.pageUIContainers[this.currPageIndex];\n      // Only time currPageUIContainer does not exist here is when\n      // the dashboard is opened and the first page is set.\n      if (currPageUIContainer) {\n        currPageUIContainer.setVisible(false);\n      }\n\n      // Show selected page\n      this.currPageIndex = pageIndex;\n      let newPageUIContainer = this.pageUIContainers[this.currPageIndex];\n      if (!newPageUIContainer) {\n        // First time opening this page, UI container not created yet\n        newPageUIContainer = this.pageManagers[this.currPageIndex].createUIContainer();\n        newPageUIContainer.setMask(this.pageMask);\n        this.pageUIContainers[this.currPageIndex] = newPageUIContainer;\n        this.uiContainer.add(newPageUIContainer);\n      } else {\n        newPageUIContainer.setVisible(true);\n      }\n\n      // Set chosen page banner\n      const bannerPos = this.getPageOptPositions();\n      const chosenIdx = this.currPageIndex;\n      const bannerChosen = new Phaser.GameObjects.Sprite(\n        this.scene,\n        bannerPos[chosenIdx][0],\n        bannerPos[chosenIdx][1] + DashboardConstants.page.yStart,\n        ImageAssets.awardsPageChosen.key\n      );\n      this.pageChosenContainer = new Phaser.GameObjects.Container(this.scene, 0, 0, [bannerChosen]);\n      this.uiContainer.add(this.pageChosenContainer);\n    }\n  }\n\n  /**\n   * Create the container that encapsulate the 'Dashboard' UI.\n   */\n  private createUIContainer() {\n    const dashboardContainer = new Phaser.GameObjects.Container(this.scene, 0, 0);\n\n    const blackUnderlay = new Phaser.GameObjects.Rectangle(\n      this.scene,\n      0,\n      0,\n      screenSize.x,\n      4 * screenSize.y,\n      0\n    )\n      .setAlpha(0.7)\n      .setInteractive();\n\n    const dashboardBg = new Phaser.GameObjects.Image(this.scene, 0, 0, ImageAssets.awardsMenu.key);\n    dashboardContainer.add([blackUnderlay, dashboardBg]);\n\n    // Add options\n    const pageOptButtons = this.pages.map((page, pageIndex) => {\n      return {\n        text: page,\n        callback: () => this.setPage(pageIndex)\n      };\n    });\n    const pageOptButtonPositions = this.getPageOptPositions();\n    dashboardContainer.add(\n      pageOptButtons.map((button, index) =>\n        this.createPageOpt(\n          button.text,\n          pageOptButtonPositions[index][0],\n          pageOptButtonPositions[index][1] + DashboardConstants.page.yStart,\n          button.callback\n        )\n      )\n    );\n\n    // Add back button\n    const backButton = this.createPageOpt('Back', 0, DashboardConstants.backButton.y, async () => {\n      if (this.scene.getPhaseManager().isCurrentPhase(GamePhaseType.Dashboard)) {\n        await this.scene.getPhaseManager().popPhase();\n      }\n    });\n    dashboardContainer.add(backButton);\n\n    return dashboardContainer;\n  }\n\n  /**\n   * Get positions of the page options.\n   */\n  private getPageOptPositions() {\n    return calcListFormatPos({\n      numOfItems: Object.keys(DashboardPage).length,\n      xSpacing: 0,\n      ySpacing: DashboardConstants.page.ySpace\n    });\n  }\n\n  /**\n   * Format the button information to a UI container, complete with\n   * styling and functionality. This button represent the page option button,\n   * whether it is 'log' or 'tasks'\n   *\n   * @param text text to be displayed on the button\n   * @param xPos x position of the button\n   * @param yPos y position of the button\n   * @param callback callback to be executed on click\n   */\n  private createPageOpt(text: string, xPos: number, yPos: number, callback: any) {\n    return createButton(this.scene, {\n      assetKey: ImageAssets.awardsPage.key,\n      message: text,\n      textConfig: DashboardConstants.pageTextConfig,\n      bitMapTextStyle: pageBannerTextStyle,\n      onUp: callback\n    }).setPosition(xPos, yPos);\n  }\n\n  /**\n   * Activate the 'Dashboard' UI.\n   *\n   * Usually only called by the phase manager when 'Dashboard' phase is\n   * pushed.\n   */\n  public async activateUI(): Promise<void> {\n    this.uiContainer = this.createUIContainer();\n    this.scene.getLayerManager().addToLayer(Layer.Dashboard, this.uiContainer);\n    this.getSoundManager().playSound(SoundAssets.menuEnter.key);\n\n    // Set initial page\n    this.setPage(this.currPageIndex);\n\n    this.uiContainer.setPosition(screenCenter.x, -screenSize.y);\n    this.pageMask.geometryMask.setPosition(screenCenter.x, -screenSize.y);\n\n    this.scene.tweens.add({\n      targets: [this.uiContainer, this.pageMask.geometryMask],\n      ...entryTweenProps,\n      y: screenCenter.y\n    });\n  }\n\n  /**\n   * Deactivate the 'Dashboard' UI.\n   *\n   * Usually only called by the phase manager when 'Dashboard' phase is\n   * transitioned out.\n   */\n  public async deactivateUI(): Promise<void> {\n    if (this.uiContainer) {\n      // Reload page UIs next time dashboard is opened\n      this.pageUIContainers = new Array(this.pages.length);\n\n      this.uiContainer.setPosition(this.uiContainer.x, this.uiContainer.y);\n      this.getSoundManager().playSound(SoundAssets.menuExit.key);\n\n      this.scene.tweens.add({\n        targets: [this.uiContainer, this.pageMask.geometryMask],\n        ...exitTweenProps\n      });\n\n      await sleep(exitTweenProps.duration);\n      fadeAndDestroy(this.scene, this.uiContainer, { fadeDuration: 50 });\n    }\n  }\n\n  private getSoundManager = () => SourceAcademyGame.getInstance().getSoundManager();\n}\n\nexport default GameDashboardManager;\n","import GameActionConditionChecker from '../action/GameActionConditionChecker';\nimport { DialogueLine, DialogueObject, PartName } from './GameDialogueTypes';\n\n/**\n * Class for keeping track of which line, action, and speaker has to be shown next\n */\nexport default class DialogueGenerator {\n  private currPart: string;\n  private currLineNum: number;\n  private dialogueContent: DialogueObject;\n\n  /**\n   * @param dialogueContent the dialogue to keep track of and to play\n   */\n  public constructor(dialogueContent: DialogueObject) {\n    this.dialogueContent = dialogueContent;\n    this.currPart = dialogueContent.keys().next().value;\n    this.currLineNum = 0;\n  }\n\n  /**\n   * @returns {Promise<DialogueLine>} returns the dialgoueLine that is played next,\n   * based on what is dictated by the dialogueContent\n   */\n  public async generateNextLine(): Promise<DialogueLine> {\n    const dialogueLine = this.dialogueContent.get(this.currPart)![this.currLineNum];\n    if (!dialogueLine || !dialogueLine.line) {\n      return { line: '' };\n    }\n\n    if (dialogueLine.goto) {\n      let currPart: string | null = dialogueLine.goto.part;\n      const conditionCheck = await GameActionConditionChecker.checkAllConditionsSatisfied(\n        dialogueLine.goto.conditions\n      );\n      if (!conditionCheck) {\n        currPart = dialogueLine.goto.altPart;\n      }\n\n      if (!currPart) {\n        this.currLineNum++;\n      } else if (this.dialogueContent.get(currPart)) {\n        this.currPart = currPart;\n        this.currLineNum = 0;\n      } else {\n        return { line: '' };\n      }\n    } else {\n      this.currLineNum++;\n    }\n    return dialogueLine;\n  }\n\n  /**\n   * @param goto new PartName to change currPart to\n   */\n  public updateCurrPart(goto: PartName) {\n    this.currPart = goto;\n    this.currLineNum = 0;\n  }\n}\n","import GameInputManager from '../input/GameInputManager';\nimport GameLayerManager from '../layer/GameLayerManager';\nimport GamePhaseManager from '../phase/GamePhaseManager';\n\n/**\n * Encapsulate style of bitmap text.\n *\n * @prop {string} key - key to the bitmap text\n * @prop {number} size - font size\n * @prop {number} fill = text color, in hex\n * @prop {number} align - text alignment, from Phaser.GameObjects.BitmapText.ALIGN_*\n */\nexport type BitmapFontStyle = {\n  key: string;\n  size: number;\n  align: number;\n};\n\n/**\n * @typedef {string} ItemId - id associated with an item.\n * Item can be any of the following:\n * (Dialogue | ObjectProperty | BboxProperty | Character | Action | AwardProperty)\n */\nexport type ItemId = string;\n\n/** @typedef {string} AssetKey - key associated with an asset */\nexport type AssetKey = string;\n\n/** @typedef {string} AssetPath - path associated with an asset */\nexport type AssetPath = string;\n\n/**\n * Encapsulate tracked interaction.\n *\n * @prop {boolean} isInteractive whether an object is interactive\n * @prop {string} interactionId id of interaction. Must be unique across all interactions.\n */\nexport type TrackInteraction = {\n  isInteractive: boolean;\n  interactionId: string;\n};\n\n/**\n * Interface for classes that represents a UI.\n * The UI must be able to be activated and deactivated.\n *\n * @interface\n */\nexport interface IGameUI {\n  activateUI: () => Promise<void> | void;\n  deactivateUI: () => Promise<void> | void;\n}\n\n/**\n * Enum for common game positions.\n * @readonly\n * @enum {string}\n */\nexport enum GamePosition {\n  Left = 'Left',\n  Middle = 'Middle',\n  Right = 'Right'\n}\n\n/**\n * Enum for common game size.\n * @readonly\n * @enum {string}\n */\nexport enum GameSize {\n  Small = 'Small',\n  Medium = 'Medium',\n  Large = 'Large'\n}\n\n/**\n * Encapsulate text configuration.\n *\n * @prop {number} x x coordinate of the text\n * @prop {number} y y coordinate of the text\n * @prop {number} oriX originX of the text\n * @prop {number} oriY originY of the text\n */\nexport type TextConfig = { x: number; y: number; oriX: number; oriY: number };\n\n/**\n * Interface for basic scene, which incorporates input, phaser, and layer manager.\n * Due to the three managers, the scene should also provide a way to clean up\n * the necessary managers.\n *\n * @interface\n */\nexport interface IBaseScene extends Phaser.Scene {\n  getLayerManager: () => GameLayerManager;\n  getInputManager: () => GameInputManager;\n  getPhaseManager: () => GamePhaseManager;\n  cleanUp: () => void;\n}\n\n/**\n * Interface for scene which possess a layer manager.\n *\n * @interface\n */\nexport interface ILayeredScene extends Phaser.Scene {\n  getLayerManager: () => GameLayerManager;\n}\n","import { Constants } from '../commons/CommonConstants';\n\nexport default class StringUtils {\n  /**\n   * Splits text into several paragraphs, each containing header\n   * string and body string array\n   *\n   * Example input:\n   * [\"objectives\",\n   * \"    talkToHartin\"\n   * \"    completeTask\"]\n   *\n   * Example output:\n   * [ [\"objectives\"], [\"talkToHartin\", \"completeTask\"] ]\n   *\n   * @param lines raw text strings\n   * @returns {Array<[string, string[]]>} several parargraphs that have\n   *                                      been split into head and body\n   */\n  public static splitToParagraph(lines: string[]) {\n    const headerAndBodyLines: [string, string[]][] = [];\n    lines.forEach((line: string) => {\n      if (line.startsWith('\\t') || line.startsWith('    ')) {\n        const content = line.startsWith('\\t') ? line.slice(1) : line.slice(4);\n        if (headerAndBodyLines.length === 0) {\n          console.error('Unexpected tabs');\n          return;\n        }\n        const bodyLines = headerAndBodyLines[headerAndBodyLines.length - 1][1];\n        bodyLines.push(content);\n        return;\n      }\n      headerAndBodyLines.push([line.trim(), []]);\n    });\n    return headerAndBodyLines;\n  }\n\n  /**\n   * Given an array of lines, returns a Map where the keys are the headings\n   * and the value are the lines below each heading.\n   *\n   * @param lines lines to be processed\n   * @param isHeaderFunction predicate that determines the header syntax. This\n   *                         will be ran against every line, so take into account if you want\n   *                         to detect header in the middle of line/in between lines.\n   * @returns {Map<string, string>}\n   */\n  public static mapByHeader(\n    lines: string[],\n    isHeaderFunction: (line: string) => boolean\n  ): Map<string, string[]> {\n    const map = new Map<string, string[]>();\n    if (!isHeaderFunction(lines[0])) {\n      map.set('0', lines);\n      return map;\n    }\n    let currHeader = '';\n    lines.forEach(line => {\n      if (isHeaderFunction(line)) {\n        currHeader = line;\n        map.set(line, []);\n        return;\n      }\n      map.get(currHeader)!.push(line);\n    });\n    return map;\n  }\n\n  /**\n   * Split using separator, but limit number of separators to split with.\n   * After splitting, trim each entry to get rid of whitespaces.\n   *\n   * Example input: splitWithLimit(\"whatHappened, What Happened, Scottie?\\n\", \",\", 1)\n   * Example output: [\"whatHappened\", \"What Happened, Scottie?\"]\n   * Explanation: This splits the string only using the first 1 comma then trims whitespaces\n   *\n   * @param line line to be split\n   * @param sep separator to be used\n   * @param limit limit the number of separators to split the string, undefined if use all separators\n   * @returns {Array<string>}\n   */\n  public static splitWithLimit(line: string, sep: string, limit: number): string[] {\n    if (limit >= 0) {\n      const lines = line.split(sep);\n      const substrings = lines.slice(0, limit);\n      substrings.push(lines.slice(limit).join(sep));\n      return substrings.map((phrase: string) => phrase.trim());\n    }\n    return StringUtils.splitByChar(line, sep);\n  }\n\n  /**\n   * Split using separator. After splitting, trim each entry to get rid of whitespaces.\n   *\n   * @param line line to be split\n   * @param sep separator to be used\n   * @param {Array<string>}\n   */\n  public static splitByChar(line: string, sep: string): string[] {\n    return line.split(sep).map((phrase: string) => phrase.trim());\n  }\n\n  /**\n   * Splits text into string array and removes\n   * lines with only newlines.\n   *\n   * @param text text to split\n   * @returns {Array<string>}\n   */\n  public static splitToLines(text: string): string[] {\n    return text\n      .split('\\n')\n      .map(line => line.trimRight())\n      .filter(line => line !== '');\n  }\n\n  /**\n   * Splits text into string array, removes lines\n   * with only newlines and removes characters that\n   * are commented out in single and multi line\n   * comments\n   *\n   * @param text text to split\n   * @returns {Array<string>}\n   */\n  public static splitToLinesAndRemoveComments(text: string): string[] {\n    return this.removeMultiLineComments(text.split('\\n'), '/*', '*/')\n      .map(line => this.removeSingleLineComment(line, '//'))\n      .map(line => line.trimRight())\n      .filter(line => line !== '');\n  }\n\n  /**\n   * Removes characters from string before/after\n   * specified comment characters\n   *\n   * Example input:\n   * removeSingleLineComment('Hello # World','#',false)\n   *\n   * Example output:\n   * 'Hello '\n   *\n   * @param text text with single line comments\n   * @param commentChars characters to denote comment region\n   * @param removeAfter (optional) true - remove characters after commentChars,\n   *                              false - remove characters before commentChars\n   * @returns {string}\n   */\n  public static removeSingleLineComment(\n    text: string,\n    commentChars: string,\n    removeAfter: boolean = true\n  ) {\n    const commentIndex = text.indexOf(commentChars);\n    return commentIndex === -1\n      ? text\n      : removeAfter\n      ? text.slice(0, commentIndex)\n      : text.slice(commentIndex + commentChars.length);\n  }\n\n  /**\n   * Given an array of lines with a\n   * a subset of characters commented out\n   * by specified open and close comment\n   * characters, Returns an array of lines\n   * with characters inside commented regions\n   * removed\n   *\n   * Example input:\n   * removeMultiLineComments(\n   * ['objectives',\n   * '    checkedScreen',\n   * '    talkedToLokKim1',\n   * '/!    talkedToLokKim2',\n   * '    talkedToLokKim3!/'],\n   *  '/!', '!/');\n   *\n   * Example output:\n   * ['objectives',\n   * '    checkedScreen',\n   * '    talkedToLokKim1']\n   *\n   * @param lines lines to remove comments from\n   * @param openCommentChars characters to denote open comment\n   * @param closeCommentChars characters to denote close comment\n   * @returns {Array<string>}\n   */\n  public static removeMultiLineComments(\n    lines: string[],\n    openCommentChars: string,\n    closeCommentChars: string\n  ): string[] {\n    const newLines = [];\n    let commentOpen = false;\n\n    for (let l = 0; l < lines.length; l++) {\n      const line = lines[l];\n      const commentRegions: [number, number][] = [];\n      const openIns = this.findAllInstances(line, openCommentChars);\n      const closeIns = this.findAllInstances(line, closeCommentChars);\n      let activeIndex = -1; // current valid comment index in line\n      let openInd = 0; // open comment index in openIns\n      let closeInd = 0; // close comment index in closeIns\n      let region = commentOpen ? [0] : [];\n\n      while (openInd < openIns.length || closeInd < closeIns.length) {\n        const prevActive = activeIndex;\n        activeIndex = commentOpen\n          ? closeIns[closeInd++] + closeCommentChars.length\n          : openIns[openInd++];\n        if (activeIndex <= prevActive) {\n          console.error(`Comment mismatch: Line ${l + 1},  Pos ${activeIndex + 1}`);\n          activeIndex = prevActive;\n        } else {\n          region.push(activeIndex);\n          commentOpen = !commentOpen;\n        }\n        if (region.length === 2) {\n          commentRegions.push([region[0], region[1]]);\n          region = [];\n        }\n      }\n      if (region.length === 1) {\n        commentRegions.push([region[0], line.length]);\n      }\n      newLines.push(this.removeCommentRegions(line, commentRegions));\n    }\n    return newLines;\n  }\n\n  /**\n   * Return a string whose content within the regions is removed\n   * for each region; regions contain two elements: the index of\n   * the first character to ignore, and the index of the last character\n   * to ignore + 1, in the text string\n   *\n   * Example input (comment characters: '/!' and '!/'):\n   * removeCommentRegions('Sour/!ce Academ!/y', [[4,17]])\n   *\n   * Example output:\n   * 'Soury'\n   *\n   * @param text the text to be removed from\n   * @param regions contains all the regions of comments\n   * @returns {string}\n   */\n  public static removeCommentRegions(text: string, regions: [number, number][]) {\n    let newString = '';\n    let prevEnd = 0;\n    regions.forEach(arr => {\n      newString += text.slice(prevEnd, arr[0]);\n      prevEnd = arr[1];\n    });\n    newString += text.slice(prevEnd, text.length);\n    return newString;\n  }\n\n  /**\n   * Return an array of the starting indices of the substring within the text string\n   *\n   * @param text\n   * @param substring substring to search for\n   * @returns {Array<number>}\n   */\n  public static findAllInstances(text: string, substring: string): number[] {\n    const indices = [];\n    let index = text.indexOf(substring);\n    while (index !== -1) {\n      indices.push(index);\n      index = text.indexOf(substring, index + 1);\n    }\n    return indices;\n  }\n\n  /**\n   * Capitalise first letter.\n   *\n   * @param word text to be capitalized\n   * @returns {string}\n   */\n  public static capitalize(word: string) {\n    return word.charAt(0).toUpperCase() + word.slice(1);\n  }\n\n  /**\n   * Turns snake case to capitalized case.\n   * Only accounts for letters, i.e. numbers and symbols will be discarded.\n   * e.g. snake_case_to_capitalized -> Snake Case To Capitalized\n   *\n   * @param name text to be capitalized\n   * @returns {string}\n   */\n  public static toCapitalizedWords(name: string) {\n    const words = name.match(/[A-Za-z][a-z]*/g) || [];\n\n    return words.map(StringUtils.capitalize).join(' ');\n  }\n\n  /**\n   * Converts the given number into string. The given number\n   * is rounded down.\n   *\n   * @param num number to be converted\n   */\n  public static toIntString(num: number) {\n    return Math.floor(num).toString();\n  }\n\n  /**\n   * Check whether given string is empty string.\n   *\n   * @param str string to check\n   */\n  public static isEmptyString(str: string) {\n    return str === Constants.nullInteractionId;\n  }\n}\n","import ImageAssets from '../assets/ImageAssets';\nimport { SpeakerDetail } from '../character/GameCharacterTypes';\nimport { screenCenter, screenSize } from '../commons/CommonConstants';\nimport { GamePosition, ItemId } from '../commons/CommonTypes';\nimport { Layer } from '../layer/GameLayerTypes';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport StringUtils from '../utils/StringUtils';\nimport { createBitmapText } from '../utils/TextUtils';\nimport DialogueConstants, { speakerTextStyle } from './GameDialogueConstants';\n\n/**\n * Class that manages speakerbox portion of the dialgoue box\n * And renders the characters in Speaker Layer\n *\n */\nexport default class DialogueSpeakerRenderer {\n  private currentSpeakerId?: string;\n\n  /**\n   * Changes the speaker shown in the speaker box and the speaker rendered on screen\n   *\n   * @param newSpeakerDetail the details about the new speaker,\n   * including his characaterId, expression and position.\n   *\n   * Undefined - if no speaker changes are involved in the dialogue line.\n   * Null - if there is no speaker for the line\n   */\n  public changeSpeakerTo(newSpeakerDetail?: SpeakerDetail | null) {\n    if (newSpeakerDetail === undefined) return;\n\n    this.currentSpeakerId &&\n      GameGlobalAPI.getInstance().clearSeveralLayers([Layer.Speaker, Layer.SpeakerBox]);\n    this.showNewSpeaker(newSpeakerDetail);\n  }\n\n  private showNewSpeaker(newSpeakerDetail: SpeakerDetail | null) {\n    if (newSpeakerDetail) {\n      this.drawSpeakerSprite(newSpeakerDetail);\n      this.drawSpeakerBox(newSpeakerDetail.speakerId);\n    }\n  }\n\n  private drawSpeakerBox(speakerId: ItemId) {\n    if (speakerId === 'narrator') return;\n    const speakerContainer =\n      speakerId === 'you'\n        ? this.createSpeakerBox(this.getUsername(), GamePosition.Right)\n        : this.createSpeakerBox(\n            GameGlobalAPI.getInstance().getCharacterById(speakerId).name,\n            GamePosition.Left\n          );\n    GameGlobalAPI.getInstance().addToLayer(Layer.SpeakerBox, speakerContainer);\n  }\n\n  private drawSpeakerSprite({ speakerId, speakerPosition, expression }: SpeakerDetail) {\n    this.currentSpeakerId = speakerId;\n    if (speakerId === 'you' || speakerId === 'narrator') {\n      return;\n    }\n    const speakerSprite = GameGlobalAPI.getInstance().createCharacterSprite(\n      speakerId,\n      expression,\n      speakerPosition\n    );\n    GameGlobalAPI.getInstance().addToLayer(Layer.Speaker, speakerSprite);\n  }\n\n  private createSpeakerBox(text: string, position: GamePosition) {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    const container = new Phaser.GameObjects.Container(gameManager, 0, 0);\n    const rectangle = new Phaser.GameObjects.Image(\n      gameManager,\n      screenCenter.x,\n      screenCenter.y,\n      ImageAssets.speakerBox.key\n    ).setAlpha(0.8);\n\n    const speakerText = createBitmapText(\n      gameManager,\n      '',\n      DialogueConstants.speakerTextConfig,\n      speakerTextStyle\n    );\n\n    if (position === GamePosition.Right) {\n      rectangle.displayWidth *= -1;\n      speakerText.x = screenSize.x - speakerText.x;\n    }\n\n    container.add([rectangle, speakerText]);\n    speakerText.text = StringUtils.capitalize(text);\n    return container;\n  }\n\n  public getUsername = () => SourceAcademyGame.getInstance().getAccountInfo().name;\n}\n","import SoundAssets from '../assets/SoundAssets';\nimport { ItemId } from '../commons/CommonTypes';\nimport { promptWithChoices } from '../effects/Prompt';\nimport { Layer } from '../layer/GameLayerTypes';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { textTypeWriterStyle } from './GameDialogueConstants';\nimport DialogueGenerator from './GameDialogueGenerator';\nimport DialogueRenderer from './GameDialogueRenderer';\nimport DialogueSpeakerRenderer from './GameDialogueSpeakerRenderer';\n\n/**\n * Given a dialogue Id, this manager renders the correct dialogue.\n * It displays the lines, speakers, and performs actions\n * whenever players click on the dialogue box\n */\nexport default class DialogueManager {\n  private speakerRenderer?: DialogueSpeakerRenderer;\n  private dialogueRenderer?: DialogueRenderer;\n  private dialogueGenerator?: DialogueGenerator;\n\n  /**\n   * @param dialogueId the dialogue Id of the dialogue you want to play\n   *\n   * @returns {Promise} the promise that resolves when the entire dialogue has been played\n   */\n  public async showDialogue(dialogueId: ItemId): Promise<void> {\n    const dialogue = GameGlobalAPI.getInstance().getDialogueById(dialogueId);\n\n    this.dialogueRenderer = new DialogueRenderer(textTypeWriterStyle);\n    this.dialogueGenerator = new DialogueGenerator(dialogue.content);\n    this.speakerRenderer = new DialogueSpeakerRenderer();\n\n    GameGlobalAPI.getInstance().addToLayer(\n      Layer.Dialogue,\n      this.dialogueRenderer.getDialogueContainer()\n    );\n\n    GameGlobalAPI.getInstance().fadeInLayer(Layer.Dialogue);\n    await new Promise(resolve => this.playWholeDialogue(resolve as () => void));\n    this.getDialogueRenderer().destroy();\n    this.getSpeakerRenderer().changeSpeakerTo(null);\n  }\n\n  private async playWholeDialogue(resolve: () => void) {\n    await this.showNextLine(resolve);\n    this.getDialogueRenderer()\n      .getDialogueBox()\n      .on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP, async () => await this.showNextLine(resolve));\n  }\n\n  private async showNextLine(resolve: () => void) {\n    GameGlobalAPI.getInstance().playSound(SoundAssets.dialogueAdvance.key);\n    const { line, speakerDetail, actionIds, prompt } =\n      await this.getDialogueGenerator().generateNextLine();\n    const lineWithName = line.replace('{name}', this.getUsername());\n    this.getDialogueRenderer().changeText(lineWithName);\n    this.getSpeakerRenderer().changeSpeakerTo(speakerDetail);\n\n    // Store the current line into the storage\n    GameGlobalAPI.getInstance().storeDialogueLine(lineWithName, speakerDetail);\n\n    // Disable interactions while processing actions\n    GameGlobalAPI.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(), false);\n    if (prompt) {\n      const response = await promptWithChoices(\n        GameGlobalAPI.getInstance().getGameManager(),\n        prompt.promptTitle,\n        prompt.choices.map(choice => choice[0])\n      );\n      this.getDialogueGenerator().updateCurrPart(prompt.choices[response][1]);\n    }\n    await GameGlobalAPI.getInstance().processGameActionsInSamePhase(actionIds);\n    GameGlobalAPI.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(), true);\n\n    if (!line) resolve();\n  }\n\n  private getDialogueGenerator = () => this.dialogueGenerator as DialogueGenerator;\n  private getDialogueRenderer = () => this.dialogueRenderer as DialogueRenderer;\n  private getSpeakerRenderer = () => this.speakerRenderer as DialogueSpeakerRenderer;\n\n  public getUsername = () => SourceAcademyGame.getInstance().getAccountInfo().name;\n}\n","import { SpeakerDetail } from '../character/GameCharacterTypes';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { DialogueStorageLine } from './GameDialogueTypes';\n\n/**\n * Class for keeping track of all dialogue and actions shown to the player, in sequence.\n *\n * The storage is local to the instance, and should be reset when a user completes the\n * current checkpoint.\n */\nexport default class GameDialogueStorageManager {\n  private dialogueStorage?: Array<DialogueStorageLine>;\n\n  /**\n   * Stores a line of dialogue into the current storage instance.\n   * Only the dialogue line and the speaker details are passed into the method.\n   *\n   * @param newLine the dialogue line to be stored.\n   * @param newSpeakerDetail the SpeakerDetail object that contains the speaker id.\n   */\n  public storeLine(newLine: string, newSpeakerDetail?: SpeakerDetail | null) {\n    if (!newSpeakerDetail) return;\n\n    if (!this.dialogueStorage) {\n      this.dialogueStorage = new Array<DialogueStorageLine>();\n    }\n    const newDialogue = {\n      speaker: this.getSpeakerName(newSpeakerDetail),\n      line: newLine\n    };\n    this.dialogueStorage.push(newDialogue);\n  }\n\n  /**\n   * Gets the speaker name from the given SpeakerDetail object, by converting the speaker id\n   * stored in the SpeakerDetail object into a String containing the actual name of the Speaker,\n   * using the getCharacterById method available in GameGlobalAPI.\n   *\n   * @param speakerDetail the SpeakerDetail object that contains the speaker id.\n   *\n   * @returns the speaker name corresponding to the speaker id inside the given SpeakerDetail object.\n   */\n  private getSpeakerName(speakerDetail: SpeakerDetail | null) {\n    const speakerId = speakerDetail?.speakerId;\n\n    // Special cases are when the id is 'you', which is converted to the player's username, and 'narrator', which simply returns 'Narrator'.\n    // The getCharacterById method is primarily used to obtain the character name to be displayed on the game's dialogue box, and so the method returns '' when given 'narrator'.\n    return !speakerId\n      ? ''\n      : speakerId === 'you'\n      ? this.getUsername()\n      : speakerId === 'narrator'\n      ? 'Narrator'\n      : GameGlobalAPI.getInstance().getCharacterById(speakerId).name;\n  }\n\n  /**\n   * Clears the current iteration of the dialogue storage.\n   * This method should be called at the end of the chapter, when transitioning to the next checkpoint.\n   */\n  public clearDialogueStorage() {\n    this.dialogueStorage = new Array<DialogueStorageLine>();\n  }\n\n  /**\n   * Returns the current dialogue storage as an Array of strings.\n   *\n   * This method is called by the Dashboard in order to fetch the dialogues currently stored,\n   * and subsequently display them in order.\n   *\n   * @returns the Dialogue storage as an Array of strings.\n   */\n  public getDialogueStorage(): Array<String> {\n    if (!this.dialogueStorage) {\n      return new Array<String>();\n    }\n    return this.dialogueStorage.map(storageLine => `${storageLine.speaker}:\\n${storageLine.line}`);\n  }\n\n  public getUsername = () => SourceAcademyGame.getInstance().getAccountInfo().name;\n}\n","import { screenCenter } from '../commons/CommonConstants';\nimport { blackScreen } from './FadeEffect';\n\nconst barWidth = 320;\nconst barHeight = 50;\nconst padding = 10;\n\nconst innerWidth = barWidth - padding * 2;\nconst innerHeight = barHeight - padding * 2;\nconst barX = screenCenter.x - barWidth / 2;\nconst barY = screenCenter.y;\nconst innerBarX = barX + padding;\nconst innerBarY = barY + padding;\n\n/**\n * A function to display a loading bar while a scene's preload is in progress\n *\n * @param scene - the scene in which to add a loading screen when preload is occuring\n */\nexport function addLoadingScreen(scene: Phaser.Scene) {\n  let progressBar: Phaser.GameObjects.Graphics;\n  let progressBox: Phaser.GameObjects.Graphics;\n  let loadingScreenBg: Phaser.GameObjects.GameObject;\n\n  scene.load.on('start', () => {\n    loadingScreenBg = scene.add.existing(blackScreen(scene));\n    progressBar = scene.add.graphics();\n    progressBox = scene.add.graphics();\n    progressBox.fillStyle(0x222222, 0.8);\n    progressBox.fillRect(barX, barY, barWidth, barHeight);\n  });\n\n  scene.load.on('progress', (value: number) => {\n    progressBar.clear();\n    progressBar.fillStyle(0xffffff, 1);\n    progressBar.fillRect(innerBarX, innerBarY, innerWidth * value, innerHeight);\n  });\n\n  scene.load.on('complete', function () {\n    progressBar.destroy();\n    progressBox.destroy();\n    loadingScreenBg.destroy();\n  });\n}\n","import SoundAssets from '../assets/SoundAssets';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { calcTableFormatPos, HexColor } from '../utils/StyleUtils';\nimport { createBitmapText } from '../utils/TextUtils';\nimport { Constants, screenSize } from './CommonConstants';\nimport { AssetKey, BitmapFontStyle, TextConfig } from './CommonTypes';\n\ntype RadioButtonChoiceConfig = {\n  circleDim: number;\n  checkedDim: number;\n  outlineThickness: number;\n};\n\ntype RadioButtonConfig = {\n  choices: string[];\n  defaultChoiceIdx?: number;\n  maxXSpace?: number;\n  radioChoiceConfig?: RadioButtonChoiceConfig;\n  choiceTextConfig?: TextConfig;\n  bitmapTextStyle?: BitmapFontStyle;\n};\n\n/**\n * A container that is contains radio buttons.\n * Radio buttons only allows user to choose only one of the\n * predefined set of mutually exclusive options.\n *\n * The radio buttons will be arranged horizontally,\n * with even spacing.\n *\n * The radio button's choice will only be displayed when\n * the given radio button is selected so as to not clutter the display.\n */\nclass CommonRadioButton extends Phaser.GameObjects.Container {\n  private buttonClickSoundKey: AssetKey;\n\n  private activeChoice: Phaser.GameObjects.Container | undefined;\n  private activeChoiceIdx: number;\n  private choices: string[];\n  private buttonPositions: Array<[number, number]>;\n\n  private radioChoiceConfig: RadioButtonChoiceConfig;\n  private choiceTextConfig: TextConfig;\n  private bitmapTextStyle: BitmapFontStyle;\n\n  /**\n   * @param scene scene for the container to attach to\n   * @param choices displayed choices, in string, for the radio buttons.\n   * @param defaultChoiceIdx index of default choice, optional\n   * @param maxXSpace maximum horizontal space to be used by the radio buttons, optional\n   * @param circleDim diameter of the radio button, optional\n   * @param checkedDim diameter of the 'checked' radio button; commonly smaller than circleDim, optional\n   * @param outlineThickness if not 0, apply stroke effect on the radio button, optional\n   * @param choiceTextConfig text config to be applied to the displayed choice.\n   *                         The X, Y are relative to each individual radio button.\n   *                         Using this, we can specify where the choice should appear\n   *                         e.g. on top of the radio button, on the side of radio button, optional\n   * @param bitmapTextStyle style to be applied to the choices, optional\n   * @param x x coordinate of the container, optional\n   * @param y y coordinate of the container, optional\n   * @param soundManager if defined, the radio button will play sounds when clicked, optional\n   * @param buttonClickSoundKey require soundManager to be defined; Sound key to be played when\n   *                            button is clicked, optioanl\n   */\n  constructor(\n    scene: Phaser.Scene,\n    {\n      choices,\n      defaultChoiceIdx = 0,\n      maxXSpace = screenSize.x,\n      radioChoiceConfig = {\n        circleDim: 20,\n        checkedDim: 10,\n        outlineThickness: 5\n      },\n      choiceTextConfig = { x: 0, y: 0, oriX: 0.5, oriY: 0.5 },\n      bitmapTextStyle = Constants.defaultFontStyle\n    }: RadioButtonConfig,\n    x?: number,\n    y?: number,\n    buttonClickSoundKey: AssetKey = SoundAssets.radioButtonClick.key\n  ) {\n    super(scene, x, y);\n    this.activeChoiceIdx = defaultChoiceIdx;\n    this.choices = choices;\n    this.choiceTextConfig = choiceTextConfig;\n    this.bitmapTextStyle = bitmapTextStyle;\n    this.radioChoiceConfig = radioChoiceConfig;\n    this.buttonClickSoundKey = buttonClickSoundKey;\n\n    const buttons = this.getRadioButtons(choices);\n    this.buttonPositions = calcTableFormatPos({\n      numOfItems: buttons.length,\n      maxXSpace: maxXSpace\n    });\n\n    this.renderRadioButtons(buttons, this.buttonPositions, this.radioChoiceConfig);\n    this.activate(defaultChoiceIdx);\n  }\n\n  private getRadioButtons(choices: string[]) {\n    return choices.map((choice, index) => {\n      return {\n        text: choice,\n        callback: () => this.activate(index)\n      };\n    });\n  }\n\n  private renderRadioButtons(\n    buttons: { text: string; callback: any }[],\n    buttonPos: Array<[number, number]>,\n    radioChoiceConfig: RadioButtonChoiceConfig\n  ) {\n    this.add(\n      buttons.map((button, index) =>\n        this.createRadioButton(\n          buttonPos[index][0],\n          buttonPos[index][1],\n          button.callback,\n          radioChoiceConfig\n        )\n      )\n    );\n  }\n\n  private createRadioButton(\n    xPos: number,\n    yPos: number,\n    callback: any,\n    radioChoiceConfig: RadioButtonChoiceConfig\n  ) {\n    return new Phaser.GameObjects.Ellipse(\n      this.scene,\n      xPos,\n      yPos,\n      radioChoiceConfig.circleDim,\n      radioChoiceConfig.circleDim,\n      HexColor.lightBlue\n    )\n      .setStrokeStyle(radioChoiceConfig.outlineThickness, HexColor.darkBlue)\n      .setInteractive({ useHandCursor: true })\n      .addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP, () => {\n        SourceAcademyGame.getInstance().getSoundManager().playSound(this.buttonClickSoundKey);\n        callback();\n      });\n  }\n\n  private activate(id: number): void {\n    this.activeChoiceIdx = id;\n\n    // Render checked option\n    if (this.activeChoice) this.activeChoice.destroy();\n\n    this.activeChoice = new Phaser.GameObjects.Container(\n      this.scene,\n      this.buttonPositions[id][0],\n      this.buttonPositions[id][1]\n    );\n    const choiceText = createBitmapText(\n      this.scene,\n      this.choices[id],\n      this.choiceTextConfig,\n      this.bitmapTextStyle\n    );\n    const optionChecked = new Phaser.GameObjects.Ellipse(\n      this.scene,\n      0,\n      0,\n      this.radioChoiceConfig.checkedDim,\n      this.radioChoiceConfig.checkedDim,\n      HexColor.darkBlue\n    );\n    this.activeChoice.add([choiceText, optionChecked]);\n\n    this.add(this.activeChoice);\n  }\n\n  public getValueIdx(): number {\n    return this.activeChoiceIdx;\n  }\n\n  public getChoices(): string[] {\n    return this.choices;\n  }\n\n  public getChosenChoice(): string {\n    if (this.activeChoiceIdx < this.choices.length) {\n      return this.choices[this.activeChoiceIdx];\n    }\n    return Constants.nullInteractionId;\n  }\n}\n\nexport default CommonRadioButton;\n","import FontAssets from '../../assets/FontAssets';\nimport { screenSize } from '../../commons/CommonConstants';\nimport { BitmapFontStyle } from '../../commons/CommonTypes';\n\nexport const optionTextStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 25,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nexport const optionHeaderTextStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 35,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nexport const applySettingsTextStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 30,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nconst SettingsConstants = {\n  optHeaderTextConfig: { x: screenSize.x * 0.25, y: 0, oriX: 0.5, oriY: 0.75 },\n  opt: { x: 140, xSpace: screenSize.x * 0.4, ySpace: screenSize.y * 0.7 },\n  radioButtonsTextConfig: { x: 0, y: -50, oriX: 0.5, oriY: 0.25 },\n  volContainerOpts: ['0', '0.25', '0.5', '1.0', '1.5', '2.0']\n};\n\nexport default SettingsConstants;\n","import FontAssets from '../assets/FontAssets';\nimport { screenCenter, screenSize } from '../commons/CommonConstants';\nimport { BitmapFontStyle } from '../commons/CommonTypes';\n\nexport const escapeOptButtonStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 30,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nexport const volumeRadioOptTextStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 20,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nexport const optTextStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 30,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nconst EscapeConstants = {\n  button: { y: screenSize.y * 0.15 },\n  escapeOptTextConfig: { x: 0, y: 0, oriX: 0.37, oriY: 0.75 },\n  settings: { yOffset: -screenCenter.y * 0.1, ySpace: screenSize.y * 0.3 },\n  settingsTextConfig: { x: screenSize.x * 0.38, y: -screenCenter.y * 0.1, oriX: 0.0, oriY: 0.5 },\n  radioButtons: { xSpace: screenSize.x * 0.2 },\n  radioChoiceTextConfig: { x: 0, y: -45, oriX: 0.5, oriY: 0.25 },\n  volOpt: { x: screenSize.x * 0.05 }\n};\n\nexport default EscapeConstants;\n","import ImageAssets from '../assets/ImageAssets';\nimport SoundAssets from '../assets/SoundAssets';\nimport { screenCenter, screenSize } from '../commons/CommonConstants';\nimport CommonRadioButton from '../commons/CommonRadioButton';\nimport { IBaseScene, IGameUI } from '../commons/CommonTypes';\nimport { Layer } from '../layer/GameLayerTypes';\nimport { GamePhaseType } from '../phase/GamePhaseTypes';\nimport SettingsConstants from '../scenes/settings/SettingsConstants';\nimport SourceAcademyGame, { GameType } from '../SourceAcademyGame';\nimport { createButton } from '../utils/ButtonUtils';\nimport { calcTableFormatPos, Direction } from '../utils/StyleUtils';\nimport { createBitmapText } from '../utils/TextUtils';\nimport EscapeConstants, {\n  escapeOptButtonStyle,\n  optTextStyle,\n  volumeRadioOptTextStyle\n} from './GameEscapeConstants';\n\n/**\n * Manager in charge of rendering and destroying the escape manager in a scene\n */\nclass GameEscapeManager implements IGameUI {\n  private bgmVolumeRadioButtons: CommonRadioButton | undefined;\n  private sfxVolumeRadioButtons: CommonRadioButton | undefined;\n  private scene: IBaseScene;\n\n  /**\n   * Initialises the escape manager UI\n   *\n   * @param scene - the scene to add escape manager\n   */\n  public constructor(scene: IBaseScene) {\n    this.scene = scene;\n    this.scene.getPhaseManager().addPhaseToMap(GamePhaseType.EscapeMenu, this);\n  }\n\n  /**\n   * Create the container that encapsulate the 'Escape Menu' UI,\n   * i.e. the background, the buttons, and the options.\n   */\n  private createUIContainer() {\n    const escapeMenuContainer = new Phaser.GameObjects.Container(this.scene, 0, 0);\n\n    const escapeMenuBg = new Phaser.GameObjects.Image(\n      this.scene,\n      screenCenter.x,\n      screenCenter.y,\n      ImageAssets.escapeMenuBackground.key\n    )\n      .setDisplaySize(screenSize.x, screenSize.y)\n      .setInteractive({ pixelPerfect: true });\n    escapeMenuContainer.add(escapeMenuBg);\n\n    // Settings header\n    const settings = this.getSettings();\n    const settingsPos = calcTableFormatPos({\n      direction: Direction.Column,\n      numOfItems: settings.length,\n      maxYSpace: EscapeConstants.settings.ySpace\n    });\n    escapeMenuContainer.add(\n      settings.map((setting, index) =>\n        createBitmapText(\n          this.scene,\n          setting,\n          {\n            ...EscapeConstants.settingsTextConfig,\n            y: settingsPos[index][1] + EscapeConstants.settingsTextConfig.y\n          },\n          optTextStyle\n        )\n      )\n    );\n\n    // Get user settings, to use as default choice in the radio buttons\n    const { bgmVolume, sfxVolume } = this.getSettingsSaveManager().getSettings();\n    const sfxVolIdx = SettingsConstants.volContainerOpts.findIndex(\n      value => parseFloat(value) === sfxVolume\n    );\n    const bgmVolIdx = SettingsConstants.volContainerOpts.findIndex(\n      value => parseFloat(value) === bgmVolume\n    );\n\n    // SFX Radio buttons\n    this.sfxVolumeRadioButtons = this.createSettingsRadioOptions(sfxVolIdx, settingsPos[0][1]);\n    // BGM Radio buttons\n    this.bgmVolumeRadioButtons = this.createSettingsRadioOptions(bgmVolIdx, settingsPos[1][1]);\n    escapeMenuContainer.add([this.sfxVolumeRadioButtons, this.bgmVolumeRadioButtons]);\n\n    // Get all the buttons\n    const buttons = this.getOptButtons();\n    const buttonPositions = calcTableFormatPos({\n      numOfItems: buttons.length\n    });\n\n    escapeMenuContainer.add(\n      buttons.map((button, index) =>\n        this.createEscapeOptButton(\n          button.text,\n          buttonPositions[index][0],\n          buttonPositions[index][1] + EscapeConstants.button.y,\n          button.callback\n        )\n      )\n    );\n\n    return escapeMenuContainer;\n  }\n\n  /**\n   * Returns all the option available in the escape menu.\n   *\n   * For SFX and BGM, these are pure headers as the options, interactivity, and functionality\n   * are handled separately (radio buttons)\n   */\n  private getSettings() {\n    return ['SFX', 'BGM'];\n  }\n\n  /**\n   * Create radio buttons matching the escape menu style.\n   *\n   * @param defaultChoiceIdx default option for the radio button\n   * @param yPos y position of the radio buttons\n   */\n  private createSettingsRadioOptions(defaultChoiceIdx: number, yPos: number) {\n    return new CommonRadioButton(\n      this.scene,\n      {\n        choices: SettingsConstants.volContainerOpts,\n        defaultChoiceIdx: defaultChoiceIdx,\n        maxXSpace: EscapeConstants.radioButtons.xSpace,\n        radioChoiceConfig: {\n          circleDim: 15,\n          checkedDim: 10,\n          outlineThickness: 3\n        },\n        choiceTextConfig: EscapeConstants.radioChoiceTextConfig,\n        bitmapTextStyle: volumeRadioOptTextStyle\n      },\n      EscapeConstants.volOpt.x,\n      -screenCenter.y + yPos + EscapeConstants.settings.yOffset\n    );\n  }\n\n  /**\n   * Get the escape options buttons preset to be formatted later.\n   * The preset includes the text to be displayed on the button and\n   * its functionality.\n   */\n  private getOptButtons() {\n    return [\n      {\n        text: 'Main Menu',\n        callback: () => {\n          this.cleanUp();\n          if (SourceAcademyGame.getInstance().isGameType(GameType.Simulator)) {\n            this.scene.scene.start('StorySimulatorMenu');\n          } else {\n            this.scene.scene.start('MainMenu');\n          }\n        }\n      },\n      {\n        text: 'Continue',\n        callback: async () => {\n          if (this.scene.getPhaseManager().isCurrentPhase(GamePhaseType.EscapeMenu)) {\n            await this.scene.getPhaseManager().popPhase();\n          }\n        }\n      },\n      {\n        text: 'Apply Settings',\n        callback: () => this.applySettings()\n      }\n    ];\n  }\n\n  /**\n   * Format the button information to a UI container, complete with\n   * styling and functionality.\n   *\n   * @param text text to be displayed on the button\n   * @param xPos x position of the button\n   * @param yPos y position of the button\n   * @param callback callback to be executed on click\n   */\n  private createEscapeOptButton(text: string, xPos: number, yPos: number, callback: any) {\n    return createButton(this.scene, {\n      assetKey: ImageAssets.mediumButton.key,\n      message: text,\n      textConfig: EscapeConstants.escapeOptTextConfig,\n      bitMapTextStyle: escapeOptButtonStyle,\n      onUp: callback\n    }).setPosition(xPos, yPos);\n  }\n\n  /**\n   * Process the current settings on escape menu, save, and apply the settings.\n   * Escape Menu is responsible in contacting various managers to apply the settings.\n   */\n  private async applySettings() {\n    const sfxVol = this.sfxVolumeRadioButtons\n      ? parseFloat(this.sfxVolumeRadioButtons.getChosenChoice())\n      : 1;\n    const bgmVol = this.bgmVolumeRadioButtons\n      ? parseFloat(this.bgmVolumeRadioButtons.getChosenChoice())\n      : 1;\n\n    // Save settings\n    const newSettings = { bgmVolume: bgmVol, sfxVolume: sfxVol };\n    await this.getSettingsSaveManager().saveSettings(newSettings);\n\n    // Apply settings\n    SourceAcademyGame.getInstance().getSoundManager().applyUserSettings(newSettings);\n  }\n\n  /**\n   * Cleaning up of related managers.\n   */\n  private cleanUp() {\n    this.scene.getInputManager().clearListeners();\n    this.scene.getLayerManager().clearAllLayers();\n  }\n\n  /**\n   * Activate the 'Escape Menu' UI.\n   *\n   * Usually only called by the phase manager when 'Escape' phase is\n   * pushed.\n   */\n  public activateUI() {\n    const escapeMenuContainer = this.createUIContainer();\n    this.getSoundManager().playSound(SoundAssets.menuEnter.key);\n    this.scene.getLayerManager().addToLayer(Layer.Escape, escapeMenuContainer);\n  }\n\n  /**\n   * Deactivate the 'Escape Menu' UI.\n   *\n   * Usually only called by the phase manager when 'Escape' phase is\n   * transitioned out.\n   */\n  public deactivateUI() {\n    this.getSoundManager().playSound(SoundAssets.menuExit.key);\n    this.scene.getLayerManager().clearSeveralLayers([Layer.Escape]);\n  }\n\n  private getSoundManager = () => SourceAcademyGame.getInstance().getSoundManager();\n  private getSettingsSaveManager = () => SourceAcademyGame.getInstance().getSaveManager();\n}\n\nexport default GameEscapeManager;\n","/**\n * Manager that keeps track of all the event listeners.\n * This manager allow clearing of all listeners at once,\n * making it easier to clean up during scene transition.\n *\n * Additionally, it can also block/allow mouse and keyboard input\n * if needed.\n */\nclass GameInputManager {\n  private scene: Phaser.Scene;\n  private keyboardListeners: Phaser.Input.Keyboard.Key[];\n  private eventListeners: Phaser.Input.InputPlugin[];\n\n  constructor(scene: Phaser.Scene) {\n    this.keyboardListeners = [];\n    this.eventListeners = [];\n    this.scene = scene;\n  }\n\n  /**\n   * Set default cursor icon.\n   *\n   * @param cursor css cursor value\n   */\n  public setDefaultCursor(cursor: string) {\n    this.scene.input.setDefaultCursor(cursor);\n  }\n\n  /**\n   * Enable/disable mouse input based on the parameter.\n   *\n   * @param active if true, mouse input is enabled. Else, mouse input is disabled.\n   */\n  public enableMouseInput(active: boolean) {\n    this.scene.input.mouse.enabled = active;\n  }\n\n  /**\n   * Enable/disable keyboard input based on the parameter.\n   *\n   * @param active if true, keyboard input is enabled. Else, keyboard input is disabled.\n   */\n  public enableKeyboardInput(active: boolean) {\n    this.scene.input.keyboard.enabled = active;\n  }\n\n  /**\n   * Register a keyboard listener into the input manager.\n   * The manager will keep track of this listener.\n   *\n   * @param key keyboard key the listener is attached to\n   * @param event event to be listened to\n   * @param callback callback to execute on event\n   */\n  public registerKeyboardListener(\n    key: string | number | Phaser.Input.Keyboard.Key,\n    event: string | symbol,\n    callback: Function\n  ) {\n    const keyObj = this.scene.input.keyboard.addKey(key);\n    const keyboardListener = keyObj.addListener(event, callback);\n    this.keyboardListeners.push(keyboardListener);\n  }\n\n  /**\n   * Register an event listener into the input manager.\n   * The manager will keep track of this listener.\n   *\n   * @param event event to be listened to\n   * @param callback callback to execute on event\n   */\n  public registerEventListener(event: string | symbol, callback: Function) {\n    const eventListener = this.scene.input.addListener(event, callback);\n    this.eventListeners.concat(eventListener);\n  }\n\n  /**\n   * Clear all listeners, keyboard and event listeners.\n   */\n  public clearListeners() {\n    this.keyboardListeners.forEach(keyboardListener => keyboardListener.removeAllListeners());\n    this.eventListeners.forEach(eventListener => eventListener.removeAllListeners());\n  }\n}\n\nexport default GameInputManager;\n","import GameGlobalAPI from 'src/features/game/scenes/gameManager/GameGlobalAPI';\n\nimport { Constants } from '../commons/CommonConstants';\nimport { fadeIn, fadeOut } from '../effects/FadeEffect';\nimport { sleep } from '../utils/GameUtils';\nimport { defaultLayerSequence, Layer } from './GameLayerTypes';\n\n/**\n * Manager in charge of placing ordering the layers\n * as specified in Game Layer types\n */\nclass GameLayerManager {\n  private layers: Map<Layer, Phaser.GameObjects.Container>;\n\n  constructor(scene: Phaser.Scene) {\n    this.layers = new Map(\n      defaultLayerSequence.map(layer => [layer, new Phaser.GameObjects.Container(scene, 0, 0)])\n    );\n    this.layers.forEach(layer => scene.add.existing(layer));\n  }\n\n  /**\n   * Return a specific layer's container.\n   *\n   * @param layerType layer type to return\n   */\n  public getLayer(layerType: Layer) {\n    return this.layers.get(layerType);\n  }\n\n  /**\n   * Hide a specific layer.\n   *\n   * @param layerType layer type to hide\n   */\n  public hideLayer(layerType: Layer) {\n    const layerToHide = this.layers.get(layerType);\n    layerToHide && layerToHide.setVisible(false) && layerToHide.setAlpha(0);\n  }\n\n  /**\n   * Show a specific layer.\n   *\n   * @param layerType layer to show\n   */\n  public showLayer(layerType: Layer) {\n    const layerToShow = this.layers.get(layerType);\n    layerToShow && layerToShow.setVisible(true) && layerToShow.setAlpha(1);\n  }\n\n  /**\n   * Fade in a specific layer.\n   *\n   * @param layerType layer to fade in\n   * @param fadeDuration duration of fade\n   */\n  public async fadeInLayer(layerType: Layer, fadeDuration = Constants.fadeDuration) {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    const layerToFadeIn = this.layers.get(layerType)!;\n\n    layerToFadeIn.setVisible(true);\n    layerToFadeIn.setAlpha(0);\n    gameManager.tweens.add(fadeIn([layerToFadeIn], fadeDuration));\n    await sleep(fadeDuration);\n  }\n\n  /**\n   * Fade out a specific layer.\n   *\n   * @param layerType layer to fade out\n   * @param fadeDuration duration of fade\n   */\n  public async fadeOutLayer(layerType: Layer, fadeDuration = Constants.fadeDuration) {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    const layerToFadeOut = this.layers.get(layerType)!;\n\n    layerToFadeOut.setVisible(true);\n    layerToFadeOut.setAlpha(1);\n    gameManager.tweens.add(fadeOut([layerToFadeOut], fadeDuration));\n    await sleep(fadeDuration);\n  }\n\n  /**\n   * Add a game object to the specified layer.\n   *\n   * @param layerType layer to be added to\n   * @param gameObject game object to add\n   */\n  public addToLayer(layerType: Layer, gameObject: Phaser.GameObjects.GameObject) {\n    const layerContainer = this.layers.get(layerType);\n    if (!layerContainer) {\n      return;\n    }\n    layerContainer.add(gameObject);\n  }\n\n  /**\n   * Clear, by destroying, the content of several layers.\n   *\n   * NOTE: This will cause any references to the content within the layers\n   * also point to a destroyed game object.\n   *\n   * @param layerTypes layers to clear from\n   */\n  public clearSeveralLayers(layerTypes: Layer[]) {\n    layerTypes.forEach(layerType => this.clearLayerContents(layerType));\n  }\n\n  /**\n   * Clear, by destroying, the content of all layers.\n   *\n   * NOTE: This will cause any references to the content within the layers\n   * also point to a destroyed game object.\n   */\n  public clearAllLayers() {\n    this.layers.forEach((_, layerType) => this.clearLayerContents(layerType));\n  }\n\n  /**\n   * Clear, by destroying, the content of a layer.\n   *\n   * NOTE: This will cause any references to the content within the layers\n   * also point to a destroyed game object.\n   *\n   * @param layerType layer to clear from\n   */\n  public clearLayerContents(layerType: Layer) {\n    const layerContainer = this.layers.get(layerType);\n    if (!layerContainer) {\n      return;\n    }\n    while (layerContainer.list.length) {\n      layerContainer.list[0].destroy();\n    }\n  }\n}\n\nexport default GameLayerManager;\n","import FontAssets from '../assets/FontAssets';\nimport { screenSize } from '../commons/CommonConstants';\nimport { BitmapFontStyle } from '../commons/CommonTypes';\n\nexport const logTextStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 30,\n  align: Phaser.GameObjects.BitmapText.ALIGN_LEFT\n};\n\nconst scrollbarX = screenSize.x * 0.251;\nconst scrollbarWidth = 7;\n\nconst LogConstants = {\n  logTextConfig: { x: screenSize.x * -0.44, y: screenSize.y * -0.378, oriX: 0.0, oriY: 0.0 },\n  textMaxWidth: screenSize.x * 0.68,\n  logHeight: screenSize.y * 0.7632,\n  scrollbarTrack: {\n    x: scrollbarX,\n    y: screenSize.y * 0.005,\n    width: scrollbarWidth,\n    height: screenSize.y * 0.73,\n    color: 0x555555\n  },\n  scrollbarThumb: { x: scrollbarX, width: scrollbarWidth, color: 0x888888 },\n  scrollSpeed: 0.5\n};\n\nexport default LogConstants;\n","import { IBaseScene } from '../commons/CommonTypes';\nimport DashboardConstants from '../dashboard/GameDashboardConstants';\nimport { DashboardPageManager } from '../dashboard/GameDashboardTypes';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport { limitNumber } from '../utils/GameUtils';\nimport { createBitmapText } from '../utils/TextUtils';\nimport LogConstants, { logTextStyle } from './GameLogConstants';\n\n/**\n * Manager in charge of creating the game log\n */\nclass GameLogManager implements DashboardPageManager {\n  private scene: IBaseScene;\n\n  /**\n   * Initialises the game log UI\n   *\n   * @param scene - the scene to add game log\n   */\n  public constructor(scene: IBaseScene) {\n    this.scene = scene;\n  }\n\n  /**\n   * Creates the container that encapsulates the 'Game Log' UI,\n   * i.e. the scrollable text and the scrollbar\n   */\n  public createUIContainer() {\n    const logContainer = new Phaser.GameObjects.Container(this.scene, 0, 0);\n\n    const textLog = GameGlobalAPI.getInstance().getDialogueStorage();\n    if (textLog.length === 0) {\n      // No text to show\n      return logContainer;\n    }\n\n    // Scrollable Text\n    const bitmapText = createBitmapText(\n      this.scene,\n      textLog.join('\\n\\n'),\n      LogConstants.logTextConfig,\n      logTextStyle\n    ).setMaxWidth(LogConstants.textMaxWidth);\n\n    const textMinY =\n      LogConstants.logTextConfig.y - Math.max(bitmapText.height - LogConstants.logHeight, 0);\n    bitmapText.y = textMinY; // Show most recent text on screen first\n    logContainer.add(bitmapText);\n\n    // Scrollbar\n    const scrollbarTrack = new Phaser.GameObjects.Rectangle(\n      this.scene,\n      LogConstants.scrollbarTrack.x,\n      LogConstants.scrollbarTrack.y,\n      LogConstants.scrollbarTrack.width,\n      LogConstants.scrollbarTrack.height,\n      LogConstants.scrollbarTrack.color\n    );\n\n    const scrollbarThumbHeight = Math.max(\n      (LogConstants.logHeight / bitmapText.height) * LogConstants.scrollbarTrack.height,\n      LogConstants.scrollbarThumb.width * 4 // Limit how small thumb can be\n    );\n    const scrollbarThumbMaxY =\n      LogConstants.scrollbarTrack.y +\n      LogConstants.scrollbarTrack.height / 2 -\n      scrollbarThumbHeight / 2;\n    // The total distance the thumb can move\n    const thumbRange = LogConstants.scrollbarTrack.height - scrollbarThumbHeight;\n    // The ratio between how far the thumb moves to how far the text scrolls\n    const thumbTextScrollRatio = thumbRange / (LogConstants.logTextConfig.y - textMinY);\n\n    const scrollbarThumb = new Phaser.GameObjects.Rectangle(\n      this.scene,\n      LogConstants.scrollbarThumb.x,\n      scrollbarThumbMaxY,\n      LogConstants.scrollbarThumb.width,\n      scrollbarThumbHeight,\n      LogConstants.scrollbarThumb.color\n    );\n\n    logContainer.add(scrollbarTrack);\n    logContainer.add(scrollbarThumb);\n\n    if (bitmapText.height <= LogConstants.logHeight) {\n      // Hide scrollbar if all text fits on screen\n      scrollbarTrack.setVisible(false);\n      scrollbarThumb.setVisible(false);\n    }\n\n    // Add scroll listener\n    const { x, y, width, height } = DashboardConstants.pageArea;\n    const scrollZone = new Phaser.GameObjects.Zone(\n      this.scene,\n      x + width / 2,\n      y + height / 2,\n      width,\n      height\n    );\n    scrollZone.setInteractive();\n    scrollZone.on(\n      'wheel',\n      (pointer: Phaser.Input.Pointer, deltaX: number, deltaY: number, deltaZ: number) => {\n        bitmapText.y = limitNumber(\n          bitmapText.y - deltaY * LogConstants.scrollSpeed,\n          textMinY,\n          LogConstants.logTextConfig.y\n        );\n        scrollbarThumb.y = scrollbarThumbMaxY - (bitmapText.y - textMinY) * thumbTextScrollRatio;\n      }\n    );\n    logContainer.add(scrollZone);\n\n    return logContainer;\n  }\n}\n\nexport default GameLogManager;\n","import { AssetType } from '../assets/AssetsTypes';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport { resize } from '../utils/SpriteUtils';\nimport { blink } from './FadeEffect';\n\n/**\n * Augments the Phaser.GameObjects.Image to enable glow effect\n * for an image. Glow effect enables an image to blink with a tint of yellow\n *\n * This is for the make_object_glow action\n */\nexport default class GlowingImage {\n  private scene: Phaser.Scene;\n  private container: Phaser.GameObjects.Container;\n  private imageGlow: Phaser.GameObjects.Image;\n  private clickArea: Phaser.GameObjects.Image;\n  private glowClearer?: () => void;\n  private blinkClearer?: () => void;\n\n  /**\n   * Constructor for a GlowingImage\n   *\n   * @param scene - the scene in which to add this object to\n   * @param x - the x coordinate of the center of the object\n   * @param y - the y coordinate of the center of the object\n   * @param assetKey - the asset key of the image to render this object\n   * @param width - optional display width of the object\n   * @param height - optional displayheight of the object\n   */\n  constructor(\n    scene: Phaser.Scene,\n    x: number,\n    y: number,\n    assetKey: string,\n    width?: number,\n    height?: number\n  ) {\n    this.scene = scene;\n    this.container = new Phaser.GameObjects.Container(scene, x, y);\n\n    this.imageGlow = new Phaser.GameObjects.Image(scene, 0, 0, assetKey)\n      .setAlpha(0)\n      .setBlendMode(Phaser.BlendModes.ADD);\n    this.clickArea = new Phaser.GameObjects.Image(scene, 0, 0, assetKey)\n      .setAlpha(0.01)\n      .setInteractive({ pixelPerfect: true });\n\n    const image = GameGlobalAPI.getInstance().getGameMap().getMapAssets().get(assetKey);\n    const animationManager = GameGlobalAPI.getInstance().getGameManager().getAnimationManager();\n    if (image) {\n      const imageAsset = animationManager.createImage(image, assetKey);\n      switch (image?.type) {\n        case AssetType.Sprite:\n          this.clickArea.setAlpha(0);\n          animationManager.startAnimation(image);\n          break;\n        case AssetType.Image:\n          if (width) {\n            resize(imageAsset, width, height);\n            resize(this.imageGlow, width, height);\n            resize(this.clickArea, width, height);\n          }\n          break;\n        default:\n          break;\n      }\n      this.container.add([imageAsset, this.imageGlow, this.clickArea]);\n    }\n  }\n\n  public startGlow() {\n    this.glowClearer && this.glowClearer();\n    this.glowClearer = blink(this.scene, this.imageGlow);\n    this.imageGlow.setAlpha(1);\n  }\n\n  public clearGlow() {\n    this.glowClearer && this.glowClearer();\n    this.imageGlow.setAlpha(0);\n  }\n\n  public startBlink() {\n    this.blinkClearer = blink(this.scene, this.getContainer());\n  }\n\n  public clearBlink() {\n    this.getContainer().setAlpha(1);\n    this.blinkClearer && this.blinkClearer();\n  }\n\n  public getContainer() {\n    return this.container;\n  }\n\n  public getClickArea() {\n    return this.clickArea;\n  }\n}\n","import { Layer } from 'src/features/game/layer/GameLayerTypes';\nimport GameGlobalAPI from 'src/features/game/scenes/gameManager/GameGlobalAPI';\n\nimport { ItemId } from '../commons/CommonTypes';\nimport GlowingImage from '../effects/GlowingObject';\nimport { GameItemType, LocationId } from '../location/GameMapTypes';\nimport { StateObserver } from '../state/GameStateTypes';\nimport { ActivatableSprite, ObjectProperty } from './GameObjectTypes';\n\n/**\n * Manager that renders objects in a location\n * and also attaches actions as onClick callbacks to objects\n *\n * It provides the activate/and deactivate interfaces\n * for Explore mode to call, as well as\n * provides API for make_object_glow and make_object_blink actions\n *\n * It is a subject/listener of GameStateManager.\n */\nclass GameObjectManager implements StateObserver {\n  private objects: Map<ItemId, ActivatableSprite>;\n\n  constructor() {\n    this.objects = new Map<ItemId, ActivatableSprite>();\n    GameGlobalAPI.getInstance().watchGameItemType(GameItemType.objects, this);\n  }\n\n  /**\n   * Clear the layers, and render all the objects available to the location.\n   * Will immediately be shown on the screen.\n   *\n   * @param locationId location in which to render objects at\n   */\n  public renderObjectsLayerContainer(locationId: LocationId): void {\n    GameGlobalAPI.getInstance().clearSeveralLayers([Layer.Objects]);\n    const objIdsToRender = GameGlobalAPI.getInstance().getGameItemsInLocation(\n      GameItemType.objects,\n      locationId\n    );\n\n    // Refresh mapping\n    this.objects.clear();\n\n    // Add all the objects\n    objIdsToRender.map(id => this.handleAdd(id));\n  }\n\n  /**\n   * Apply glowing effect around the object.\n   *\n   * @param objectId id of the object\n   */\n  public makeObjectGlow(objectId: ItemId, turnOn: boolean) {\n    const object = this.objects.get(objectId);\n    if (!object) {\n      return;\n    }\n    if (turnOn) {\n      (object.sprite as GlowingImage).startGlow();\n    } else {\n      (object.sprite as GlowingImage).clearGlow();\n    }\n  }\n\n  /**\n   * Apply blinking effect on the object.\n   *\n   * @param objectId id of the object\n   */\n  public makeObjectBlink(objectId: ItemId, turnOn: boolean) {\n    const object = this.objects.get(objectId);\n    if (!object) {\n      return;\n    }\n    if (turnOn) {\n      (object.sprite as GlowingImage).startBlink();\n    } else {\n      (object.sprite as GlowingImage).clearBlink();\n    }\n  }\n\n  /**\n   * Create the object from the given object property.\n   * Because we want this sprite to be activatable\n   * by Explore Mode UI, we expose its actionIds\n   * and interactionId\n   *\n   * @param objectProperty object property to be used\n   */\n  private createObject(objectProperty: ObjectProperty): ActivatableSprite {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    const { assetKey, x, y, width, height, actionIds, interactionId } = objectProperty;\n    const object = new GlowingImage(gameManager, x, y, assetKey, width, height);\n\n    return {\n      sprite: object,\n      clickArea: object.getClickArea(),\n      actionIds,\n      interactionId\n    };\n  }\n\n  /**\n   * Add the object, specified by the ID, into the scene\n   * and keep track of it within the mapping.\n   *\n   * @param id id of object\n   * @return {boolean} true if successful, false otherwise\n   */\n  public handleAdd(id: ItemId): boolean {\n    const objectProp = GameGlobalAPI.getInstance().getObjectById(id);\n    const object = this.createObject(objectProp);\n    GameGlobalAPI.getInstance().addToLayer(\n      Layer.Objects,\n      (object.sprite as GlowingImage).getContainer()\n    );\n    this.objects.set(id, object);\n    return true;\n  }\n\n  /**\n   * Mutate the object of the given id.\n   *\n   * Internally, will delete and re-add the object with\n   * the updated property.\n   *\n   * @param id id of object\n   * @return {boolean} true if successful, false otherwise\n   */\n  public handleMutate(id: ItemId): boolean {\n    return this.handleDelete(id) && this.handleAdd(id);\n  }\n\n  /**\n   * Delete the object of the given id, if\n   * applicable.\n   *\n   * @param id id of the object\n   * @return {boolean} true if successful, false otherwise\n   */\n  public handleDelete(id: ItemId): boolean {\n    const object = this.objects.get(id);\n    if (object) {\n      this.objects.delete(id);\n      (object.sprite as GlowingImage).getContainer().destroy();\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Get all the rectanlge sprites which can be activated\n   * by external Explore Mode UI\n   */\n  public getActivatables() {\n    return Array.from(this.objects.values());\n  }\n}\n\nexport default GameObjectManager;\n","import { Constants } from '../commons/CommonConstants';\nimport { IGameUI } from '../commons/CommonTypes';\nimport GameInputManager from '../input/GameInputManager';\nimport { GamePhaseType, GameTerminalPhaseType } from './GamePhaseTypes';\n\n/**\n * State machine in charge of keeping track\n * of phases in the game, and is in charge of making phase\n * transitions from one phase to another.\n *\n * It keeps phases in a stack to keep track of states\n * that have been previously visited.\n *\n * For more, search for FSM (finite state machine).\n */\nexport default class GamePhaseManager {\n  public phaseMap: Map<GamePhaseType, IGameUI>;\n  private phaseStack: GamePhaseType[];\n  private inputManager: GameInputManager;\n  private interruptCheckCallback: (prevPhase: GamePhaseType, newPhase: GamePhaseType) => boolean;\n  private interruptTransitionCallback: (\n    prevPhase: GamePhaseType,\n    newPhase: GamePhaseType\n  ) => Promise<void>;\n  private transitionCallback: (prevPhase: GamePhaseType, newPhase: GamePhaseType) => void;\n\n  constructor(phaseMap: Map<GamePhaseType, IGameUI>, inputManager: GameInputManager) {\n    this.phaseStack = [GamePhaseType.None];\n    this.phaseMap = phaseMap;\n    this.interruptCheckCallback = () => false;\n    this.interruptTransitionCallback = async () => Constants.nullFunction();\n    this.transitionCallback = Constants.nullFunction;\n    this.inputManager = inputManager;\n  }\n\n  /**\n   * Add an additional phase into the phase map.\n   *\n   * @param gamePhaseType type of phase\n   * @param gameUI gameUI to be activated at the phase\n   */\n  public addPhaseToMap(gamePhaseType: GamePhaseType, gameUI: IGameUI) {\n    this.phaseMap.set(gamePhaseType, gameUI);\n  }\n\n  /**\n   * Set the interrupt check of the phase manager. Interrupt check is called\n   * to determine whether interrupt callback is called. The function\n   * signature must return a boolean.\n   *\n   * If the boolean returned is true, interrupt callback will be executed.\n   *\n   * @param fn callback\n   */\n  public setInterruptCheckCallback(\n    fn: (prevPhase: GamePhaseType, newPhase: GamePhaseType) => boolean\n  ) {\n    this.interruptCheckCallback = fn;\n  }\n\n  /**\n   * Set the interrupt callback of the phase manager.\n   * The callback will be executed before every phase transition.\n   *\n   * Will use the interruptCheck function to determine whether this function\n   * is executed. If executed, phase manager will not transition to the\n   * new phase i.e. interrupt the phase transition.\n   *\n   * @param fn callback\n   */\n  public setInterruptCallback(\n    fn: (prevPhase: GamePhaseType, newPhase: GamePhaseType) => Promise<void>\n  ) {\n    this.interruptTransitionCallback = fn;\n  }\n\n  /**\n   * Set the interrupt callback of the phase manager. The callback will be executed\n   * before every phase transition.\n   *\n   * @param fn callback\n   */\n  public setCallback(fn: (prevPhase: GamePhaseType, newPhase: GamePhaseType) => void) {\n    this.transitionCallback = fn;\n  }\n\n  /**\n   * Pop the current phase, and revert to the previous phase.\n   * The current phase will no longer be saved on the phase stack.\n   */\n  public async popPhase(): Promise<void> {\n    const prevPhase = this.phaseStack.pop()!;\n    await this.executePhaseTransition(prevPhase, this.getCurrentPhase());\n  }\n\n  /**\n   * Push a new phase; will cause previous phase to transition out\n   * and transition in the new phase. Previous phase will be stored within\n   * the phase stack.\n   *\n   * @param newPhase phase to transition to\n   */\n  public async pushPhase(newPhase: GamePhaseType): Promise<void> {\n    const prevPhase = this.getCurrentPhase();\n    if (newPhase === prevPhase) return;\n    this.phaseStack.push(newPhase);\n    await this.executePhaseTransition(prevPhase, newPhase);\n  }\n\n  /**\n   * Swap the previous phase to another phase. Previous phase will no\n   * longer be saved on the phase stack.\n   *\n   * @param newPhase phase to swap to\n   */\n  public async swapPhase(newPhase: GamePhaseType): Promise<void> {\n    const prevPhase = this.getCurrentPhase();\n    if (newPhase === prevPhase) return;\n    this.phaseStack.pop();\n    this.phaseStack.push(newPhase);\n    await this.executePhaseTransition(prevPhase, newPhase);\n  }\n\n  /**\n   * Handles the transition from one phase to another,\n   * by deactivating the previous phase followed by activating the new phase.\n   *\n   * During transition, all inputs are disabled (mouse and keyboard) to prevent\n   * user input which may mutate the phase stack during the transition.\n   *\n   * Mutating the stack during the transition leads to phaseStack not matching\n   * with what is shown on user screen; which leads to undefined behaviour.\n   *\n   * @param prevPhase previous phase to deactivate\n   * @param newPhase new phase to activate\n   */\n  private async executePhaseTransition(prevPhase: GamePhaseType, newPhase: GamePhaseType) {\n    // Disable inputs to avoid user input mutating the stack\n    this.inputManager.enableKeyboardInput(false);\n    this.inputManager.enableMouseInput(false);\n    await this.phaseMap.get(prevPhase)!.deactivateUI();\n\n    if (this.interruptCheckCallback(prevPhase, newPhase)) {\n      // Enable input in case interrupt transition callback needs it\n      this.inputManager.enableMouseInput(true);\n      this.inputManager.enableKeyboardInput(true);\n      await this.interruptTransitionCallback(prevPhase, newPhase);\n      return;\n    }\n\n    this.transitionCallback(prevPhase, newPhase);\n\n    // Transition to new phase\n    await this.phaseMap.get(newPhase)!.activateUI();\n    this.inputManager.enableMouseInput(true);\n    this.inputManager.enableKeyboardInput(true);\n  }\n\n  /**\n   * Checks whether the current phase is equal to the inquired phase\n   *\n   * @param phase phase to compare to\n   * @returns {boolean}\n   */\n  public isCurrentPhase(phase: GamePhaseType): boolean {\n    return this.getCurrentPhase() === phase;\n  }\n\n  /**\n   * Checks whether the current phase is a terminal phase.\n   *\n   * @returns {boolean}\n   */\n  public isCurrentPhaseTerminal(): boolean {\n    return Object.values(GameTerminalPhaseType).includes(this.getCurrentPhase());\n  }\n\n  /**\n   * Returns the current phase.\n   * If there is no phase, by default we return GamePhaseType.None.\n   *\n   * @return {GamePhaseType}\n   */\n  public getCurrentPhase(): GamePhaseType {\n    if (!this.phaseStack.length) {\n      this.phaseStack = [GamePhaseType.None];\n    }\n    return this.phaseStack[this.phaseStack.length - 1];\n  }\n}\n","import { screenCenter, screenSize } from '../commons/CommonConstants';\n\nconst popUpXOffset = 400;\n\nconst PopUpConstants = {\n  image: { xOffset: 20, yOffset: 20 },\n  rect: {\n    x: { Left: popUpXOffset, Middle: screenCenter.x, Right: screenSize.x - popUpXOffset },\n    y: { Small: 325, Medium: 350, Large: 420 },\n    scale: { Small: 0.7, Medium: 1, Large: 1.5 },\n    width: 280,\n    height: 280\n  },\n  tweenDuration: 300\n};\n\nexport default PopUpConstants;\n","import ImageAssets from '../assets/ImageAssets';\nimport SoundAssets from '../assets/SoundAssets';\nimport { Constants } from '../commons/CommonConstants';\nimport { GamePosition, GameSize, ItemId } from '../commons/CommonTypes';\nimport { scrollEntry, scrollExit } from '../effects/ScrollEffect';\nimport { Layer } from '../layer/GameLayerTypes';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport { sleep } from '../utils/GameUtils';\nimport { resizeUnderflow } from '../utils/SpriteUtils';\nimport PopUpConstants from './GamePopUpConstants';\n\n/**\n * Manager in charge of keeping track of the the popups in\n * a game\n */\nclass GamePopUpManager {\n  private currPopUp: Map<GamePosition, Phaser.GameObjects.Container>;\n\n  constructor() {\n    this.currPopUp = new Map<GamePosition, Phaser.GameObjects.Container>();\n  }\n\n  /**\n   * Display a popup image on the screen.\n   * The image is based the given ID, while its position\n   * is based on the given position.\n   *\n   * @param itemId item ID to be shown on the pop up\n   * @param position position of the pop up\n   * @param duration duration in which the pop up to be shown. Afterwards, the popup will\n   *                 be destroyed.\n   * @param size size of the popup, defaulted to medium.\n   */\n  public async displayPopUp(\n    itemId: ItemId,\n    position: GamePosition,\n    duration = Constants.popUpDuration,\n    size: GameSize = GameSize.Medium\n  ) {\n    // Destroy previous pop up if any\n    this.destroyPopUp(position);\n\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    const container = new Phaser.GameObjects.Container(gameManager, 0, 0);\n\n    // Frame\n    const popUpFrameImg = new Phaser.GameObjects.Image(\n      gameManager,\n      PopUpConstants.rect.x[position],\n      PopUpConstants.rect.y[size],\n      ImageAssets.popUpFrame.key\n    ).setScale(PopUpConstants.rect.scale[size]);\n\n    // Get assetKey\n    const assetKey = this.getAssetKey(itemId);\n    if (!assetKey) return;\n\n    // Set up images\n    const popUpImage = new Phaser.GameObjects.Image(\n      gameManager,\n      PopUpConstants.rect.x[position] + PopUpConstants.image.xOffset,\n      PopUpConstants.rect.y[size] + PopUpConstants.image.yOffset,\n      assetKey\n    );\n    const newWidth = PopUpConstants.rect.width * PopUpConstants.rect.scale[size];\n    const newHeight = PopUpConstants.rect.height * PopUpConstants.rect.scale[size];\n    resizeUnderflow(popUpImage, newWidth, newHeight);\n\n    container.add([popUpFrameImg, popUpImage]);\n    this.currPopUp.set(position, container);\n    GameGlobalAPI.getInstance().addToLayer(Layer.PopUp, container);\n    GameGlobalAPI.getInstance().playSound(SoundAssets.popUpEnter.key);\n\n    container.setActive(true);\n    container.setVisible(true);\n    container.setScale(1.0, 0);\n\n    gameManager.tweens.add(scrollEntry([container], PopUpConstants.tweenDuration));\n    await sleep(PopUpConstants.tweenDuration);\n\n    setTimeout(() => this.destroyPopUp(position), duration);\n  }\n\n  /**\n   * Destroy all active pop ups at all positions.\n   */\n  public destroyAllPopUps() {\n    this.currPopUp.forEach((popUp, position, map) => {\n      this.destroyPopUp(position);\n    });\n  }\n\n  /**\n   * Destroy a pop up at the given position, if any.\n   *\n   * @param position position of thhe pop up to be destroyed\n   */\n  public async destroyPopUp(position: GamePosition) {\n    const atPosContainer = this.currPopUp.get(position);\n    if (!atPosContainer) return;\n\n    GameGlobalAPI.getInstance()\n      .getGameManager()\n      .tweens.add(scrollExit([atPosContainer], PopUpConstants.tweenDuration));\n    await sleep(PopUpConstants.tweenDuration);\n\n    atPosContainer.setVisible(false);\n    atPosContainer.setActive(false);\n    atPosContainer.destroy();\n\n    this.currPopUp.delete(position);\n    GameGlobalAPI.getInstance().playSound(SoundAssets.popUpExit.key);\n  }\n\n  /**\n   * Get the asset key of the item ID.\n   *\n   * @param itemId item ID\n   */\n  private getAssetKey(itemId: ItemId) {\n    const objectPropMap = GameGlobalAPI.getInstance().getGameMap().getObjectPropMap();\n    const objProp = objectPropMap.get(itemId);\n    if (objProp) {\n      return objProp.assetKey;\n    }\n    return undefined;\n  }\n}\n\nexport default GamePopUpManager;\n","/**\n * Generates a tween configuration for making objects open like a scroll,\n * ie stretch open downwards from zero-height to full height.\n *\n * @param targets - an array of game objects that you want to enter via scroll effect\n * @param duration - the duration of the scroll animation\n * @returns {Phaser.Types.Tweens.TweenDataConfig} - the tween config for the scroll in animation\n */\nexport const scrollEntry = (targets: Phaser.GameObjects.GameObject[], duration = 500) => ({\n  scaleY: 1,\n  targets,\n  duration,\n  ease: 'Power1'\n});\n\n/**\n * Generates a tween configuration for making objects close like a scroll,\n * ie compress upwards from full height to zero height\n *\n * @param targets - an array of game objects that you want to exit via scroll effect\n * @param duration - the duration of the fascrollde animation\n * @returns {Phaser.Types.Tweens.TweenDataConfig} - the tween config for the scroll in animation\n */\nexport const scrollExit = (targets: Phaser.GameObjects.GameObject[], duration = 500) => ({\n  scaleY: 0,\n  targets,\n  duration,\n  ease: 'Power1'\n});\n","import { GamePhaseType } from '../phase/GamePhaseTypes';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { FullSaveState, GameSaveState } from './GameSaveTypes';\n\n/**\n * Function that saves game data as a 'snapshot' in FullSaveState\n * json format by collecting game data from game manager,\n * game state manager, user state manager, and phase manager\n *\n * @param prevGameState - the snapshot of the game the during the last save point\n * @param chapterNum - the chapterNumber of the game\n * @param checkpointNUm - the checkpoint of the game\n * @returns {FullSaveState} - the new 'snapshot' of the game\n */\nexport function gameStateToJson(\n  prevGameState: FullSaveState,\n  chapterNum: number,\n  checkpointNum: number\n): FullSaveState {\n  const gameManager = GameGlobalAPI.getInstance().getGameManager();\n  const gameStateManager = gameManager.getStateManager();\n  const phaseManager = gameManager.getPhaseManager();\n\n  return {\n    gameSaveStates: {\n      ...prevGameState.gameSaveStates,\n      [chapterNum]: {\n        lastCheckpointPlayed: checkpointNum,\n        currentLocation: gameManager.currentLocationId,\n        currentPhase: phaseManager.getCurrentPhase(),\n        chapterNewlyCompleted: gameStateManager.getChapterNewlyCompleted(),\n        incompleteTasks: gameStateManager.getIncompleteTasks(),\n        completedTasks: gameStateManager.getCompletedTasks(),\n        completedObjectives: gameStateManager.getCompletedObjectives(),\n        triggeredInteractions: gameStateManager.getTriggeredInteractions(),\n        triggeredStateChangeActions: gameStateManager.getTriggeredStateChangeActions()\n      }\n    },\n    userSaveState: {\n      settings: prevGameState.userSaveState.settings,\n      recentlyPlayedCheckpoint: [chapterNum, checkpointNum],\n      collectibles: SourceAcademyGame.getInstance().getUserStateManager().getCollectibles(),\n      largestCompletedChapter: prevGameState.userSaveState.largestCompletedChapter\n    }\n  };\n}\n\n/**\n * Function to create an empty full save state\n * Used for resetting game data of students\n *\n * @returns {FullSaveState} - an empty save state for starting players\n */\nexport const createEmptySaveState = (): FullSaveState => {\n  return {\n    gameSaveStates: {},\n    userSaveState: {\n      collectibles: [],\n      settings: { bgmVolume: 1, sfxVolume: 1 },\n      recentlyPlayedCheckpoint: [-1, -1],\n      largestCompletedChapter: -1\n    }\n  };\n};\n\n/**\n * Function to create an empty game save state\n * Used for resetting game data of students\n *\n * @returns {GameSaveState} - an empty save state for starting the game\n */\nexport const createEmptyGameSaveState = (): GameSaveState => {\n  return {\n    lastCheckpointPlayed: 0,\n    currentLocation: undefined,\n    currentPhase: GamePhaseType.Menu,\n    chapterNewlyCompleted: false,\n    incompleteTasks: [],\n    completedTasks: [],\n    completedObjectives: [],\n    triggeredInteractions: [],\n    triggeredStateChangeActions: []\n  };\n};\n\n/**\n * Converts a map, where some items have been triggered\n * into an array containing all the items that have been triggered.\n *\n * @param completionMap map containing string elements to boolean indicating\n *                      which elements have been completed/triggerd\n */\nexport function convertMapToArray(completionMap: Map<string, boolean>) {\n  return Array.from(completionMap)\n    .filter(([_objective, boolean]: [string, boolean]) => boolean)\n    .map(([objective]: [string, boolean]) => objective);\n}\n","import { BBoxProperty } from '../boundingBoxes/GameBoundingBoxTypes';\nimport { GameCheckpoint } from '../chapter/GameChapterTypes';\nimport { GamePosition, ItemId } from '../commons/CommonTypes';\nimport GameMap from '../location/GameMap';\nimport { GameItemType, LocationId } from '../location/GameMapTypes';\nimport { GameMode } from '../mode/GameModeTypes';\nimport GameObjective from '../objective/GameObjective';\nimport { ObjectProperty } from '../objects/GameObjectTypes';\nimport { convertMapToArray } from '../save/GameSaveHelper';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport GameTask from '../task/GameTask';\nimport { TaskDetail } from '../task/GameTaskTypes';\nimport { mandatory } from '../utils/GameUtils';\nimport { StateObserver } from './GameStateTypes';\n\n/**\n * Manages all states related to story, chapter, or checkpoint;\n * e.g. checkpoint objectives, objects' property, bboxes' property.\n *\n * Other than this manager, all other manager should not need to\n * manage their own state.\n *\n * Employs observer pattern, and notifies its subjects on state update.\n */\n\nclass GameStateManager {\n  // Subscribers\n  private subscribers: Map<GameItemType, StateObserver>;\n\n  // Game State\n  private gameMap: GameMap;\n  private checkpointObjective: GameObjective;\n  private checkpointTask: GameTask;\n  private chapterNewlyCompleted: boolean;\n\n  // Triggered Interactions\n  private updatedLocations: Set<LocationId>;\n  private triggeredInteractions: Map<ItemId, boolean>;\n  private triggeredStateChangeActions: ItemId[];\n\n  constructor(gameCheckpoint: GameCheckpoint) {\n    this.subscribers = new Map<GameItemType, StateObserver>();\n\n    this.gameMap = gameCheckpoint.map;\n    this.checkpointObjective = gameCheckpoint.objectives;\n    this.checkpointTask = gameCheckpoint.tasks;\n    this.chapterNewlyCompleted = false;\n\n    this.updatedLocations = new Set(this.gameMap.getLocationIds());\n    this.triggeredInteractions = new Map<ItemId, boolean>();\n    this.triggeredStateChangeActions = [];\n\n    this.loadStatesFromSaveManager();\n  }\n\n  /**\n   * Loads some game states from the save manager\n   */\n  private loadStatesFromSaveManager() {\n    this.triggeredStateChangeActions = this.getSaveManager().getTriggeredStateChangeActions();\n\n    this.getSaveManager()\n      .getTriggeredInteractions()\n      .forEach(interactionId => this.triggerInteraction(interactionId));\n\n    this.getSaveManager()\n      .getCompletedObjectives()\n      .forEach(objective => this.checkpointObjective.setObjective(objective, true));\n\n    this.getSaveManager()\n      .getCompletedTasks()\n      .forEach(task => {\n        this.checkpointTask.setTask(task, true);\n        this.checkpointTask.showTask(task);\n      });\n\n    this.getSaveManager()\n      .getIncompleteTasks()\n      .forEach(task => {\n        this.checkpointTask.setTask(task, false);\n        this.checkpointTask.showTask(task);\n      });\n\n    this.chapterNewlyCompleted = this.getSaveManager().getChapterNewlyCompleted();\n  }\n\n  ///////////////////////////////\n  //        Subscribers        //\n  ///////////////////////////////\n\n  /**\n   * This function is called to set state observers\n   *\n   * @param gameItemType Type of game item the observer wants to watch\n   * @param stateObserver reference to state observer\n   */\n  public watchGameItemType(gameItemType: GameItemType, stateObserver: StateObserver) {\n    this.subscribers.set(gameItemType, stateObserver);\n  }\n\n  /**\n   * Obtains the subscriber that watches the game item\n   *\n   * @param gameItemType the type of item being watched\n   */\n  private getSubscriberForItemType(gameItemType: GameItemType) {\n    return this.subscribers.get(gameItemType);\n  }\n\n  ///////////////////////////////\n  //        Interaction        //\n  ///////////////////////////////\n\n  /**\n   * Record that an interaction has been triggered.\n   *\n   * @param id id of interaction\n   */\n  public triggerInteraction(id: string): void {\n    this.triggeredInteractions.set(id, true);\n  }\n\n  /**\n   * Record a state-change action that has been triggered.\n   * State-change actions refer to actions that modify the map's\n   * original state\n   *\n   * @param actionId actionId of interaction\n   */\n  public triggerStateChangeAction(actionId: ItemId): void {\n    this.triggeredStateChangeActions.push(actionId);\n  }\n\n  /**\n   * Checks whether an interaction ID has been triggered or not.\n   *\n   * @param id id of interaction\n   * @returns {boolean}\n   */\n  public hasTriggeredInteraction(id: string): boolean | undefined {\n    return this.triggeredInteractions.get(id);\n  }\n\n  ///////////////////////////////\n  //          Notifs          //\n  ///////////////////////////////\n\n  /**\n   * Adds a location notification for a locationId\n   *\n   * @param locationId locationId of location you want to add notif to\n   */\n  public addLocationNotif(locationId: LocationId) {\n    this.updatedLocations.add(locationId);\n  }\n\n  /**\n   * Removes a location notification for a locationId\n   *\n   * @param locationId locationId of location you want to remove notif of\n   */\n  public removeLocationNotif(locationId: LocationId) {\n    this.updatedLocations.delete(locationId);\n  }\n\n  /**\n   * Gets whether or not the location has a notif\n   *\n   * @param locationId locationId of location you want to find out if got notif\n   */\n  public hasLocationNotif(locationId: LocationId) {\n    return this.updatedLocations.has(locationId);\n  }\n\n  /**\n   * Function to check if current location is the given locationId\n   *\n   * @param locationId locationId that you want to check whether is current one\n   */\n  public isCurrentLocation(locationId: LocationId) {\n    return locationId === GameGlobalAPI.getInstance().getCurrLocId();\n  }\n\n  ///////////////////////////////\n  //       Location Mode       //\n  ///////////////////////////////\n\n  /**\n   * Get modes available to a location based on the location ID.\n   *\n   * @param locationId location ID\n   * @returns {GameMode[]} game modes\n   */\n  public getLocationModes(locationId: LocationId): GameMode[] {\n    return Array.from(this.gameMap.getLocationAtId(locationId).modes) || [];\n  }\n\n  /**\n   * Add a mode to a location. If this is not the current location,\n   * then add a notification.\n   *\n   * @param locationId location ID\n   * @param mode game mode to add\n   */\n  public addLocationMode(locationId: LocationId, mode: GameMode) {\n    this.gameMap.getLocationAtId(locationId).modes.add(mode);\n    !this.isCurrentLocation(locationId) && this.addLocationNotif(locationId);\n  }\n\n  /**\n   * Remove a mode from a location. If this is not the current location,\n   * then add a notification.\n   *\n   * @param locationId location ID\n   * @param mode game mode to remove\n   */\n  public removeLocationMode(locationId: LocationId, mode: GameMode) {\n    this.gameMap.getLocationAtId(locationId).modes.delete(mode);\n    !this.isCurrentLocation(locationId) && this.addLocationNotif(locationId);\n  }\n\n  ///////////////////////////////\n  //        State Check        //\n  ///////////////////////////////\n\n  /**\n   * Get all IDs of a type of game item in a location.\n   *\n   * @param gameItemType type of game item\n   * @param locationId id of location\n   * @returns {ItemId[]} items IDS of all game items of that type in the location\n   */\n  public getGameItemsInLocation(gameItemType: GameItemType, locationId: LocationId): ItemId[] {\n    return Array.from(this.gameMap.getLocationAtId(locationId)[gameItemType]) || [];\n  }\n\n  /**\n   * Add an item ID of a game item type in gamemap's location.\n   *\n   * Either render the change instantly, or place a notification inside another location\n   *\n   * @param gameItemType type of game item\n   * @param locationId id of location to add items to\n   * @param itemId item ID to be added\n   */\n  public addItem(gameItemType: GameItemType, locationId: LocationId, itemId: ItemId) {\n    this.gameMap.getLocationAtId(locationId)[gameItemType]?.add(itemId);\n\n    this.isCurrentLocation(locationId)\n      ? this.getSubscriberForItemType(gameItemType)?.handleAdd(itemId)\n      : this.addLocationNotif(locationId);\n  }\n\n  /**\n   * Remove an item ID from game items in gamemap's location.\n   * If ID is not found within the game item list, nothing will be executed.\n   *\n   * Either render the change instantly, or place a notification inside another location\n   *\n   * @param gameItemType type of game item to remove\n   * @param locationId id of location to remove items from\n   * @param itemId item ID to be removed\n   */\n  public removeItem(gameItemType: GameItemType, locationId: LocationId, itemId: string) {\n    this.gameMap.getLocationAtId(locationId)[gameItemType]?.delete(itemId);\n\n    this.isCurrentLocation(locationId)\n      ? this.getSubscriberForItemType(gameItemType)?.handleDelete(itemId)\n      : this.addLocationNotif(locationId);\n  }\n\n  /**\n   * Replace an object property of the given ID with the new object\n   * property. Commonly used to update a specific object property.\n   *\n   * @param id id of object to change\n   * @param newObjProp new object property to replace the old one\n   */\n  public setObjProperty(id: ItemId, newObjProp: ObjectProperty) {\n    this.gameMap.setItemInMap(GameItemType.objects, id, newObjProp);\n\n    // Update every location that has the object\n    this.gameMap.getLocations().forEach((location, locId) => {\n      if (!location.objects.has(id)) return;\n\n      this.isCurrentLocation(locId)\n        ? this.getSubscriberForItemType(GameItemType.objects)?.handleMutate(id)\n        : this.addLocationNotif(locId);\n    });\n  }\n\n  /**\n   * Replace a bbox property of the given ID with the new bbox\n   * property. Commonly used to update a specific bbox property.\n   *\n   * @param id id of object to change\n   * @param newBBoxProp new object property to replace the old one\n   */\n  public setBBoxProperty(id: ItemId, newBBoxProp: BBoxProperty) {\n    this.gameMap.setItemInMap(GameItemType.boundingBoxes, id, newBBoxProp);\n\n    // Update every location that has the bbox\n    this.gameMap.getLocations().forEach((location, locId) => {\n      if (!location.boundingBoxes.has(id)) return;\n\n      this.isCurrentLocation(locId)\n        ? this.getSubscriberForItemType(GameItemType.boundingBoxes)?.handleMutate(id)\n        : this.addLocationNotif(locId);\n    });\n  }\n\n  /**\n   * Moves a character to another location and another position\n   *\n   * @param id id of character to change\n   * @param newLocation new location to put this character inside of\n   * @param newPosition new position of the character\n   */\n  public moveCharacter(id: ItemId, newLocation: LocationId, newPosition: GamePosition) {\n    // Move position\n    this.getCharacterAtId(id).defaultPosition = newPosition;\n\n    // Find location with character and remove him\n    this.gameMap.getLocations().forEach((location, locId) => {\n      if (!location.characters.has(id)) return;\n      this.removeItem(GameItemType.characters, locId, id);\n    });\n\n    // Add updated character to new location\n    this.addItem(GameItemType.characters, newLocation, id);\n  }\n\n  /**\n   * Changes the default expression of a character\n   *\n   * @param id id of character to change\n   * @param newExpression new expression of the character\n   */\n  public updateCharacter(id: ItemId, newExpression: string) {\n    this.getCharacterAtId(id).defaultExpression = newExpression;\n\n    // Update every location that has the character\n    this.gameMap.getLocations().forEach((location, locId) => {\n      if (!location.characters.has(id)) return;\n\n      this.isCurrentLocation(locId)\n        ? this.getSubscriberForItemType(GameItemType.characters)?.handleMutate(id)\n        : this.addLocationNotif(locId);\n    });\n  }\n\n  ///////////////////////////////\n  //    Chapter Objectives     //\n  ///////////////////////////////\n\n  /**\n   * Checks whether all the checkpoint objectives has been completed.\n   * @returns {boolean}\n   */\n  public areAllObjectivesComplete(): boolean {\n    return this.checkpointObjective.isAllComplete();\n  }\n\n  /**\n   * Checks whether a specific objective has been completed.\n   * If the objective does not exist, this method still returns true.\n   *\n   * @param key objective name\n   * @returns {boolean}\n   */\n  public isObjectiveComplete(key: string): boolean {\n    return this.checkpointObjective.getObjectiveState(key);\n  }\n\n  /**\n   * Check whether the objectives are complete or not.\n   * All specified objectives must be complete for this method\n   * to return true.\n   *\n   * @param keys objective names\n   * @returns {boolean}\n   */\n  public areObjectivesComplete(keys: string[]): boolean {\n    let result = true;\n    keys.forEach(key => (result = result && this.isObjectiveComplete(key)));\n    return result;\n  }\n\n  /**\n   * Record that an objective has been completed.\n   *\n   * @param key objective name\n   */\n  public completeObjective(key: string): void {\n    this.checkpointObjective.setObjective(key, true);\n  }\n\n  ///////////////////////////////\n  //    Chapter Tasks          //\n  ///////////////////////////////\n\n  /**\n   * Checks whether a specific task has been completed.\n   * If the task does not exist, this method still returns true.\n   *\n   * @param key task id\n   * @returns {boolean}\n   */\n  public isTaskComplete(key: string): boolean {\n    return this.checkpointTask.getTaskState(key);\n  }\n\n  /**\n   * Check whether the tasks are complete or not.\n   * All specified tasks must be complete for this method\n   * to return true.\n   *\n   * @param keys task ids\n   * @returns {boolean}\n   */\n  public areTasksComplete(keys: string[]): boolean {\n    let result = true;\n    keys.forEach(key => (result = result && this.isTaskComplete(key)));\n    return result;\n  }\n\n  /**\n   * Record that a task has been completed.\n   *\n   * @param key task id\n   */\n  public completeTask(key: string): void {\n    this.checkpointTask.setTask(key, true);\n  }\n\n  /**\n   * Indicate that a task should be shown to the user.\n   *\n   * @param key task id\n   */\n  public showTask(key: string): void {\n    this.checkpointTask.showTask(key);\n  }\n\n  public getAllVisibleTaskData(): Array<[TaskDetail, boolean]> {\n    return this.checkpointTask.getAllVisibleTaskData();\n  }\n\n  ///////////////////////////////\n  //          Saving           //\n  ///////////////////////////////\n\n  /**\n   * Gets array of all objectives that have been completed.\n   *\n   * @returns {ItemId[]}\n   */\n  public getCompletedObjectives(): ItemId[] {\n    return convertMapToArray(this.checkpointObjective.getObjectives());\n  }\n\n  /**\n   * Gets array of all tasks that have been completed.\n   *\n   * @returns {ItemId[]}\n   */\n  public getCompletedTasks(): ItemId[] {\n    return convertMapToArray(this.checkpointTask.getAllTasks());\n  }\n\n  /**\n   * Gets array of all tasks that have been displayed but yet to be completed.\n   *\n   * @returns {ItemId[]}\n   */\n  public getIncompleteTasks(): ItemId[] {\n    return this.checkpointTask.getAllIncompleteTasks();\n  }\n\n  /**\n   * Return an array interactions that have been triggered\n   *\n   * @returns {string[]}\n   */\n  public getTriggeredInteractions(): string[] {\n    return convertMapToArray(this.triggeredInteractions);\n  }\n\n  /**\n   * Return an array interactions of state-change actions that have been triggered\n   * State-change actions refer to actions that modify the game map's original state\n   *\n   * @returns {string[]}\n   */\n  public getTriggeredStateChangeActions(): string[] {\n    return this.triggeredStateChangeActions;\n  }\n\n  public getGameMap = () => this.gameMap;\n  public getCharacterAtId = (id: ItemId) => mandatory(this.gameMap.getCharacterMap().get(id));\n\n  private getSaveManager = () => SourceAcademyGame.getInstance().getSaveManager();\n  public getChapterNewlyCompleted = () => this.chapterNewlyCompleted;\n}\n\nexport default GameStateManager;\n","import FontAssets from '../assets/FontAssets';\nimport ImageAssets from '../assets/ImageAssets';\nimport { screenSize } from '../commons/CommonConstants';\nimport { BitmapFontStyle } from '../commons/CommonTypes';\n\nexport const taskTextStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 30,\n  align: Phaser.GameObjects.BitmapText.ALIGN_LEFT\n};\n\nconst scrollbarX = screenSize.x * 0.251;\nconst scrollbarWidth = 7;\n\nconst TaskLogConstants = {\n  taskTextConfig: { x: screenSize.x * -0.42, y: screenSize.y * -0.378, oriX: 0.0, oriY: 0.0 },\n  textMaxWidth: screenSize.x * 0.66,\n  checkMark: {\n    x: screenSize.x * -0.202,\n    y: screenSize.y * -0.369,\n    imageUrl: ImageAssets.talkOptCheck.key\n  },\n  logHeight: screenSize.y * 0.7632,\n  scrollbarTrack: {\n    x: scrollbarX,\n    y: screenSize.y * 0.005,\n    width: scrollbarWidth,\n    height: screenSize.y * 0.73,\n    color: 0x555555\n  },\n  scrollbarThumb: { x: scrollbarX, width: scrollbarWidth, color: 0x888888 },\n  scrollSpeed: 0.5\n};\n\nexport default TaskLogConstants;\n","import { IBaseScene } from '../commons/CommonTypes';\nimport DashboardConstants from '../dashboard/GameDashboardConstants';\nimport { DashboardPageManager } from '../dashboard/GameDashboardTypes';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport { limitNumber } from '../utils/GameUtils';\nimport { createBitmapText } from '../utils/TextUtils';\nimport TaskLogConstants, { taskTextStyle } from './GameTaskLogConstants';\n\n/**\n * Manager in charge of creating the task log\n */\nclass GameTaskLogManager implements DashboardPageManager {\n  private scene: IBaseScene;\n\n  /**\n   * Initialises the task log UI\n   *\n   * @param scene - the scene to add task log\n   */\n  public constructor(scene: IBaseScene) {\n    this.scene = scene;\n  }\n\n  /**\n   * Creates the container that encapsulates the 'Task Log' UI,\n   * i.e. the scrollable text, the check marks and the scrollbar\n   */\n  public createUIContainer() {\n    const taskLogContainer = new Phaser.GameObjects.Container(this.scene, 0, 0);\n\n    // Scrollable Text and Check Marks\n    const tasksData = GameGlobalAPI.getInstance().getAllVisibleTaskData();\n    const taskListContainer = new Phaser.GameObjects.Container(this.scene, 0, 0);\n    let totalTextHeight = 0;\n\n    if (tasksData.length === 0) {\n      // No tasks to show\n      const message = createBitmapText(\n        this.scene,\n        'No tasks available.',\n        TaskLogConstants.taskTextConfig,\n        taskTextStyle\n      ).setMaxWidth(TaskLogConstants.textMaxWidth);\n      taskListContainer.add(message);\n      totalTextHeight = message.height;\n    } else {\n      for (let i = 0; i < tasksData.length; i++) {\n        const task = tasksData[i][0];\n        const taskIsDone = tasksData[i][1];\n\n        if (taskIsDone) {\n          // Show a check mark next to completed tasks\n          const checkMark = new Phaser.GameObjects.Image(\n            this.scene,\n            TaskLogConstants.checkMark.x,\n            TaskLogConstants.checkMark.y + totalTextHeight,\n            TaskLogConstants.checkMark.imageUrl\n          );\n          taskListContainer.add(checkMark);\n        }\n\n        const taskTitle = createBitmapText(\n          this.scene,\n          task.title,\n          {\n            ...TaskLogConstants.taskTextConfig,\n            y: TaskLogConstants.taskTextConfig.y + totalTextHeight\n          },\n          taskTextStyle\n        ).setMaxWidth(TaskLogConstants.textMaxWidth);\n\n        // Underline the task title using a stretched underscore\n        // (Note: this will not underline subsequent lines if title longer than 1 line)\n        const underline = createBitmapText(\n          this.scene,\n          '_',\n          {\n            ...TaskLogConstants.taskTextConfig,\n            y: TaskLogConstants.taskTextConfig.y + totalTextHeight\n          },\n          taskTextStyle\n        );\n        underline.setScale(taskTitle.width / underline.width, 1);\n\n        taskListContainer.add(taskTitle);\n        taskListContainer.add(underline);\n        totalTextHeight += taskTitle.height;\n\n        const taskDescription = createBitmapText(\n          this.scene,\n          task.description + (i < tasksData.length - 1 ? '\\n ' : ''), // Line break between tasks\n          {\n            ...TaskLogConstants.taskTextConfig,\n            y: TaskLogConstants.taskTextConfig.y + totalTextHeight\n          },\n          taskTextStyle\n        ).setMaxWidth(TaskLogConstants.textMaxWidth);\n\n        taskListContainer.add(taskDescription);\n        totalTextHeight += taskDescription.height;\n      }\n    }\n\n    const taskListContainerMinY = -Math.max(totalTextHeight - TaskLogConstants.logHeight, 0);\n    taskListContainer.y = taskListContainerMinY; // Show newest tasks on screen first\n    taskLogContainer.add(taskListContainer);\n\n    // Scrollbar\n    const scrollbarTrack = new Phaser.GameObjects.Rectangle(\n      this.scene,\n      TaskLogConstants.scrollbarTrack.x,\n      TaskLogConstants.scrollbarTrack.y,\n      TaskLogConstants.scrollbarTrack.width,\n      TaskLogConstants.scrollbarTrack.height,\n      TaskLogConstants.scrollbarTrack.color\n    );\n\n    const scrollbarThumbHeight = Math.max(\n      (TaskLogConstants.logHeight / totalTextHeight) * TaskLogConstants.scrollbarTrack.height,\n      TaskLogConstants.scrollbarThumb.width * 4 // Limit how small thumb can be\n    );\n    const scrollbarThumbMaxY =\n      TaskLogConstants.scrollbarTrack.y +\n      TaskLogConstants.scrollbarTrack.height / 2 -\n      scrollbarThumbHeight / 2;\n    // The total distance the thumb can move\n    const thumbRange = TaskLogConstants.scrollbarTrack.height - scrollbarThumbHeight;\n    // The ratio between how far the thumb moves to how far the text scrolls\n    const thumbTextScrollRatio = thumbRange / -taskListContainerMinY;\n\n    const scrollbarThumb = new Phaser.GameObjects.Rectangle(\n      this.scene,\n      TaskLogConstants.scrollbarThumb.x,\n      scrollbarThumbMaxY,\n      TaskLogConstants.scrollbarThumb.width,\n      scrollbarThumbHeight,\n      TaskLogConstants.scrollbarThumb.color\n    );\n\n    taskLogContainer.add(scrollbarTrack);\n    taskLogContainer.add(scrollbarThumb);\n\n    if (totalTextHeight <= TaskLogConstants.logHeight) {\n      // Hide scrollbar if all text fits on screen\n      scrollbarTrack.setVisible(false);\n      scrollbarThumb.setVisible(false);\n    }\n\n    // Add scroll listener\n    const { x, y, width, height } = DashboardConstants.pageArea;\n    const scrollZone = new Phaser.GameObjects.Zone(\n      this.scene,\n      x + width / 2,\n      y + height / 2,\n      width,\n      height\n    );\n    scrollZone.setInteractive();\n    scrollZone.on(\n      'wheel',\n      (pointer: Phaser.Input.Pointer, deltaX: number, deltaY: number, deltaZ: number) => {\n        taskListContainer.y = limitNumber(\n          taskListContainer.y - deltaY * TaskLogConstants.scrollSpeed,\n          taskListContainerMinY,\n          0\n        );\n        scrollbarThumb.y =\n          scrollbarThumbMaxY - (taskListContainer.y - taskListContainerMinY) * thumbTextScrollRatio;\n      }\n    );\n    taskLogContainer.add(scrollZone);\n\n    return taskLogContainer;\n  }\n}\n\nexport default GameTaskLogManager;\n","import ImageAssets from '../assets/ImageAssets';\nimport { screenSize } from '../commons/CommonConstants';\nimport { AssetKey, IBaseScene } from '../commons/CommonTypes';\nimport { GamePhaseType } from '../phase/GamePhaseTypes';\n\nexport type ToolbarButtonConfig = {\n  assetKey: AssetKey;\n  onUp: (scene: IBaseScene) => () => void;\n};\n\n// From rightmost to leftmost\nconst buttonConfigs: ToolbarButtonConfig[] = [\n  {\n    // Escape menu button\n    assetKey: ImageAssets.gear.key,\n    onUp: scene => async () => {\n      const phaseManager = scene.getPhaseManager();\n      if (phaseManager.isCurrentPhase(GamePhaseType.EscapeMenu)) {\n        await phaseManager.popPhase();\n      } else if (phaseManager.isCurrentPhaseTerminal()) {\n        await phaseManager.swapPhase(GamePhaseType.EscapeMenu);\n      } else {\n        await phaseManager.pushPhase(GamePhaseType.EscapeMenu);\n      }\n    }\n  },\n  {\n    // Dashboard button\n    assetKey: ImageAssets.journal.key,\n    onUp: scene => async () => {\n      const phaseManager = scene.getPhaseManager();\n      if (phaseManager.isCurrentPhase(GamePhaseType.Dashboard)) {\n        await phaseManager.popPhase();\n      } else if (phaseManager.isCurrentPhaseTerminal()) {\n        await phaseManager.swapPhase(GamePhaseType.Dashboard);\n      } else {\n        await phaseManager.pushPhase(GamePhaseType.Dashboard);\n      }\n    }\n  }\n];\n\nconst ToolbarConstants = {\n  firstButton: { x: screenSize.x - 37, y: 37 },\n  xOffset: 64,\n  buttonConfigs\n};\n\nexport default ToolbarConstants;\n","import { IBaseScene } from '../commons/CommonTypes';\nimport { Layer } from '../layer/GameLayerTypes';\nimport { createButton } from '../utils/ButtonUtils';\nimport ToolbarConstants, { ToolbarButtonConfig } from './GameToolbarConstants';\n\n/**\n * Manager for the toolbar buttons in the top right corner of the screen\n *\n * It calls the phase mangager when the toolbar buttons are clicked\n * to bring up the approriate menu\n */\nclass GameToolbarManager {\n  private uiContainer: Phaser.GameObjects.Container | undefined;\n  private scene: IBaseScene;\n\n  /**\n   * Initialises the toolbar manager UI\n   *\n   * @param scene - the scene to add toolbar manager\n   */\n  public constructor(scene: IBaseScene) {\n    this.scene = scene;\n  }\n\n  /**\n   * Create the container that encapsulates the toolbar UI\n   */\n  private createUIContainer() {\n    const toolbarContainer = new Phaser.GameObjects.Container(this.scene, 0, 0);\n\n    toolbarContainer.add(\n      ToolbarConstants.buttonConfigs.map((buttonConfig, index) =>\n        this.createToolbarButton(\n          ToolbarConstants.firstButton.x - ToolbarConstants.xOffset * index,\n          ToolbarConstants.firstButton.y,\n          buttonConfig\n        )\n      )\n    );\n    return toolbarContainer;\n  }\n\n  /**\n   * Format the button information to a UI container, complete with\n   * styling and functionality.\n   *\n   * @param xPos x position of the button\n   * @param yPos y position of the button\n   * @param buttonConfig config details of the button\n   */\n  private createToolbarButton(xPos: number, yPos: number, buttonConfig: ToolbarButtonConfig) {\n    return createButton(this.scene, {\n      assetKey: buttonConfig.assetKey,\n      onUp: buttonConfig.onUp(this.scene)\n    }).setPosition(xPos, yPos);\n  }\n\n  /**\n   * Render the toolbar UI.\n   *\n   * Called by the GameManager in every location\n   */\n  public async renderToolbarContainer(): Promise<void> {\n    this.uiContainer = this.createUIContainer();\n    this.scene.getLayerManager().addToLayer(Layer.UI, this.uiContainer);\n  }\n}\n\nexport default GameToolbarManager;\n","import FontAssets from '../assets/FontAssets';\nimport ImageAssets from '../assets/ImageAssets';\nimport { createButton } from '../utils/ButtonUtils';\nimport { screenCenter } from './CommonConstants';\nimport { BitmapFontStyle } from './CommonTypes';\n\nconst backText = 'Back';\nconst backTextYPos = -screenCenter.y * 0.975;\nconst backButtonStyle: BitmapFontStyle = {\n  key: FontAssets.zektonDarkFont.key,\n  size: 25,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\n/**\n * A container that is a back button that is located\n * at the top, center of the screen.\n *\n * The style and colours are fixed.\n * It is not recommended to change the position of the container.\n */\nclass CommonBackButton extends Phaser.GameObjects.Container {\n  /**\n   * @param scene scene for the button to be attached to\n   * @param callback callback to be executed on onClick\n   */\n  constructor(scene: Phaser.Scene, callback: any) {\n    super(scene, 0, 0);\n    this.renderBackButton(callback);\n  }\n\n  private renderBackButton(callback: any) {\n    const backButton = createButton(this.scene, {\n      assetKey: ImageAssets.topButton.key,\n      message: backText,\n      textConfig: { x: 0, y: backTextYPos, oriX: 0.5, oriY: 0.25 },\n      bitMapTextStyle: backButtonStyle,\n      onUp: callback\n    }).setPosition(screenCenter.x, screenCenter.y);\n    this.add(backButton);\n  }\n}\n\nexport default CommonBackButton;\n","import { toS3Path } from '../../utils/GameUtils';\n\nconst ExploreModeConstants = {\n  normal: `url(${toS3Path('/ui/magnifying.png', false)}), pointer`,\n  hover: `url(${toS3Path('/ui/magnifying_trigg.png', false)}), pointer`,\n  checked: `url(${toS3Path('/ui/magnifying_check.png', false)}), pointer`\n};\n\nexport default ExploreModeConstants;\n","import GameGlobalAPI from 'src/features/game/scenes/gameManager/GameGlobalAPI';\n\nimport SoundAssets from '../../assets/SoundAssets';\nimport CommonBackButton from '../../commons/CommonBackButton';\nimport { Constants, screenSize } from '../../commons/CommonConstants';\nimport { IGameUI, ItemId } from '../../commons/CommonTypes';\nimport { fadeAndDestroy } from '../../effects/FadeEffect';\nimport { entryTweenProps, exitTweenProps } from '../../effects/FlyEffect';\nimport { Layer } from '../../layer/GameLayerTypes';\nimport { ActivatableSprite } from '../../objects/GameObjectTypes';\nimport { GamePhaseType } from '../../phase/GamePhaseTypes';\nimport { sleep } from '../../utils/GameUtils';\nimport ExploreModeConstants from './GameModeExploreConstants';\n\n/**\n * The class in charge of showing \"Explore\" mode UI\n * which comprises back button, attaching magnifying glass cursor and\n * making objects and bounding boxes active during Explore mode\n */\nclass GameModeExplore implements IGameUI {\n  private uiContainer: Phaser.GameObjects.Container | undefined;\n\n  /**\n   * Create the container that encapsulate the 'Explore' mode UI,\n   * i.e. the back button.\n   */\n  public createUIContainer(): Phaser.GameObjects.Container {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    const exploreMenuContainer = new Phaser.GameObjects.Container(gameManager, 0, 0);\n\n    const backButton = new CommonBackButton(\n      gameManager,\n      async () => await GameGlobalAPI.getInstance().swapPhase(GamePhaseType.Menu)\n    );\n    exploreMenuContainer.add(backButton);\n    return exploreMenuContainer;\n  }\n\n  /**\n   * Activate the 'Explore' mode UI.\n   *\n   * Usually only called by the phase manager when 'Explore' phase is\n   * pushed.\n   */\n  public async activateUI(): Promise<void> {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n\n    this.uiContainer = this.createUIContainer();\n    GameGlobalAPI.getInstance().addToLayer(Layer.UI, this.uiContainer);\n\n    this.uiContainer.setPosition(this.uiContainer.x, -screenSize.y);\n\n    this.enableInteractions();\n\n    gameManager.tweens.add({\n      targets: this.uiContainer,\n      ...entryTweenProps\n    });\n\n    // Change default icon\n    GameGlobalAPI.getInstance().setDefaultCursor(ExploreModeConstants.normal);\n    GameGlobalAPI.getInstance().playSound(SoundAssets.modeEnter.key);\n  }\n\n  /**\n   * Deactivate the 'Explore' mode UI.\n   *\n   * Usually only called by the phase manager when 'Explore' phase is\n   * transitioned out.\n   */\n  public async deactivateUI(): Promise<void> {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n\n    // Reset the cursor\n    GameGlobalAPI.getInstance().setDefaultCursor(Constants.defaultCursor);\n\n    this.disableInteractions();\n\n    if (this.uiContainer) {\n      this.uiContainer.setPosition(this.uiContainer.x, 0);\n\n      gameManager.tweens.add({\n        targets: this.uiContainer,\n        ...exitTweenProps\n      });\n\n      await sleep(500);\n      fadeAndDestroy(gameManager, this.uiContainer);\n    }\n  }\n\n  /**\n   * This function enables all the activatable sprites (objects/bboxes)\n   * that are currently being rendered on the map to have mouse events\n   *\n   * It changes the default cursor of the hover/click to a magnifying glass\n   * It also adds enables the activatable's actions to be played when clicked\n   */\n  private enableInteractions() {\n    GameGlobalAPI.getInstance()\n      .getAllActivatables()\n      .forEach((activatable: ActivatableSprite) => {\n        if (!activatable.actionIds || !activatable.actionIds.length) {\n          return;\n        }\n        activatable.clickArea.on('pointerout', () => this.explorePointerOut());\n        activatable.clickArea.on('pointerover', () =>\n          this.explorePointerOver(activatable.interactionId)\n        );\n        activatable.clickArea.on('pointerup', async () => {\n          this.explorePointerUp(activatable.interactionId);\n          await GameGlobalAPI.getInstance().processGameActions(activatable.actionIds);\n        });\n      });\n  }\n\n  /**\n   * This function disables all the activatable sprites (objects/bboxes)\n   * that are currently being rendered on the map\n   */\n  private disableInteractions() {\n    GameGlobalAPI.getInstance()\n      .getAllActivatables()\n      .forEach((activatable: ActivatableSprite) => {\n        activatable.clickArea.off('pointerout');\n        activatable.clickArea.off('pointerover');\n        activatable.clickArea.off('pointerup');\n      });\n  }\n\n  /**\n   * Function to be executed when user hover upon interactable object/bbox.\n   * It sets the cursor to different icons based on wheter user has ever\n   * interacted with it previously.\n   *\n   * @param id id of the object, to be used to check whether it has been\n   *           triggered before\n   */\n  private explorePointerOver(id: ItemId) {\n    const hasTriggered = GameGlobalAPI.getInstance().hasTriggeredInteraction(id);\n    if (hasTriggered) {\n      GameGlobalAPI.getInstance().setDefaultCursor(ExploreModeConstants.checked);\n    } else {\n      GameGlobalAPI.getInstance().setDefaultCursor(ExploreModeConstants.hover);\n    }\n  }\n\n  /**\n   * Function to be executed when user off hover upon interactable object/bbox.\n   * It sets the cursor back to 'Explore' mode cursor.\n   */\n  private explorePointerOut() {\n    GameGlobalAPI.getInstance().setDefaultCursor(ExploreModeConstants.normal);\n  }\n\n  /**\n   * Function to be executed when user click on the interatable object/bbox.\n   *\n   * It will prompt GameStateManager to record that this interaction has\n   * been triggered.\n   *\n   * @param id id of the object, to be used to inform GameStateManager\n   */\n  private explorePointerUp(id: string) {\n    GameGlobalAPI.getInstance().setDefaultCursor(Constants.defaultCursor);\n    GameGlobalAPI.getInstance().triggerInteraction(id);\n    GameGlobalAPI.getInstance().setDefaultCursor(ExploreModeConstants.normal);\n  }\n}\n\nexport default GameModeExplore;\n","import { GamePhaseType } from '../phase/GamePhaseTypes';\n\nexport enum GameMode {\n  Move = 'Move',\n  Explore = 'Explore',\n  Talk = 'Talk',\n  Menu = 'Menu'\n}\n\nexport const gameModeToPhase = {\n  Move: GamePhaseType.Move,\n  Explore: GamePhaseType.Explore,\n  Talk: GamePhaseType.Talk,\n  Menu: GamePhaseType.Menu\n};\n","import FontAssets from '../../assets/FontAssets';\nimport { screenSize } from '../../commons/CommonConstants';\nimport { BitmapFontStyle } from '../../commons/CommonTypes';\n\nexport const modeButtonStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 45,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nconst MenuModeConstants = {\n  button: { yOffset: screenSize.y * 0.3 },\n  entryTweenProps: {\n    y: 0,\n    duration: 500,\n    ease: 'Power2'\n  },\n  exitTweenProps: {\n    y: screenSize.y * 0.4,\n    duration: 300,\n    ease: 'Power2'\n  }\n};\n\nexport default MenuModeConstants;\n","import GameGlobalAPI from 'src/features/game/scenes/gameManager/GameGlobalAPI';\n\nimport ImageAssets from '../../assets/ImageAssets';\nimport SoundAssets from '../../assets/SoundAssets';\nimport { screenCenter, screenSize } from '../../commons/CommonConstants';\nimport { IGameUI } from '../../commons/CommonTypes';\nimport { fadeAndDestroy } from '../../effects/FadeEffect';\nimport { Layer } from '../../layer/GameLayerTypes';\nimport { GameItemType } from '../../location/GameMapTypes';\nimport { createButton } from '../../utils/ButtonUtils';\nimport { sleep } from '../../utils/GameUtils';\nimport { calcTableFormatPos } from '../../utils/StyleUtils';\nimport { GameMode, gameModeToPhase } from '../GameModeTypes';\nimport MenuModeConstants, { modeButtonStyle } from './GameModeMenuConstants';\n\n/**\n * The class in charge of showing the \"Menu\" mode UI\n * which displays the menu for players\n * to choose the game mode they want to play\n * in a location\n */\nclass GameModeMenu implements IGameUI {\n  private uiContainer: Phaser.GameObjects.Container | undefined;\n\n  /**\n   * Fetches the game modes of the current location id.\n   */\n  private getLatestLocationModes() {\n    const currLocId = GameGlobalAPI.getInstance().getCurrLocId();\n    let latestModesInLoc = GameGlobalAPI.getInstance().getLocationModes(currLocId);\n    const talkTopics = GameGlobalAPI.getInstance().getGameItemsInLocation(\n      GameItemType.talkTopics,\n      currLocId\n    );\n\n    // Remove talk mode if there is no talk topics\n    if (talkTopics.length === 0) {\n      latestModesInLoc = latestModesInLoc.filter(mode => mode !== GameMode.Talk);\n    }\n\n    return latestModesInLoc;\n  }\n\n  /**\n   * Create the container that encapsulate the 'Menu' mode UI,\n   * i.e. the modes selection.\n   */\n  private createUIContainer() {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    const modeMenuContainer = new Phaser.GameObjects.Container(gameManager, 0, 0);\n\n    const modeBanner = new Phaser.GameObjects.Image(\n      gameManager,\n      screenCenter.x,\n      screenCenter.y,\n      ImageAssets.modeMenuBanner.key\n    );\n    modeMenuContainer.add(modeBanner);\n\n    const modes = this.getLatestLocationModes();\n    const buttons = this.getModeButtons(modes);\n    const buttonPositions = calcTableFormatPos({\n      numOfItems: buttons.length\n    });\n\n    modeMenuContainer.add(\n      buttons.map((button, index) =>\n        this.createModeButton(\n          button.text,\n          buttonPositions[index][0],\n          buttonPositions[index][1] + MenuModeConstants.button.yOffset,\n          button.callback\n        )\n      )\n    );\n    return modeMenuContainer;\n  }\n\n  /**\n   * Get the mode buttons preset to be formatted later.\n   * The preset includes the text to be displayed on the button and\n   * its functionality (phase change callback).\n   *\n   * @param modes modes to be shown\n   */\n  private getModeButtons(modes: GameMode[]) {\n    return modes.sort().map(mode => {\n      return {\n        text: mode,\n        callback: async () => await GameGlobalAPI.getInstance().swapPhase(gameModeToPhase[mode])\n      };\n    });\n  }\n\n  /**\n   * Format the button information to a UI container, complete with\n   * styling and functionality.\n   *\n   * @param text text to be displayed on the button\n   * @param xPos x position of the button\n   * @param yPos y position of the button\n   * @param callback callback to be executed on click\n   */\n  private createModeButton(text: string, xPos: number, yPos: number, callback: any) {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    return createButton(gameManager, {\n      assetKey: ImageAssets.shortButton.key,\n      message: text,\n      textConfig: { x: 0, y: 0, oriX: 0.5, oriY: 0.25 },\n      bitMapTextStyle: modeButtonStyle,\n      onUp: callback\n    }).setPosition(xPos, yPos);\n  }\n\n  /**\n   * Activate the 'Menu' mode UI.\n   *\n   * Usually only called by the phase manager when 'Menu' phase is\n   * pushed.\n   */\n  public async activateUI(): Promise<void> {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    this.uiContainer = this.createUIContainer();\n    GameGlobalAPI.getInstance().addToLayer(Layer.UI, this.uiContainer);\n\n    this.uiContainer.setPosition(this.uiContainer.x, screenSize.y);\n\n    gameManager.tweens.add({\n      targets: this.uiContainer,\n      ...MenuModeConstants.entryTweenProps\n    });\n    await sleep(500);\n    GameGlobalAPI.getInstance().playSound(SoundAssets.modeEnter.key);\n  }\n\n  /**\n   * Deactivate the 'Menu' mode UI.\n   *\n   * Usually only called by the phase manager when 'Menu' phase is\n   * transitioned out.\n   */\n  public async deactivateUI(): Promise<void> {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n\n    if (this.uiContainer) {\n      this.uiContainer.setPosition(this.uiContainer.x, 0);\n\n      gameManager.tweens.add({\n        targets: this.uiContainer,\n        ...MenuModeConstants.exitTweenProps\n      });\n\n      await sleep(500);\n      fadeAndDestroy(gameManager, this.uiContainer);\n    }\n  }\n}\n\nexport default GameModeMenu;\n","import FontAssets from '../../assets/FontAssets';\nimport { screenSize } from '../../commons/CommonConstants';\nimport { BitmapFontStyle } from '../../commons/CommonTypes';\n\nexport const moveButtonStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 30,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nconst MoveModeConstants = {\n  button: { xOffSet: screenSize.x * 0.25, ySpace: screenSize.y * 0.8 },\n  preview: {\n    rect: {\n      x: screenSize.x * 0.3125,\n      y: screenSize.y * 0.515,\n      width: screenSize.x * 0.473,\n      height: screenSize.y * 0.56\n    },\n    frame: { x: screenSize.x * 0.3 }\n  }\n};\n\nexport default MoveModeConstants;\n","import ImageAssets from '../../assets/ImageAssets';\nimport SoundAssets from '../../assets/SoundAssets';\nimport CommonBackButton from '../../commons/CommonBackButton';\nimport { screenCenter, screenSize } from '../../commons/CommonConstants';\nimport { IGameUI } from '../../commons/CommonTypes';\nimport { fadeAndDestroy } from '../../effects/FadeEffect';\nimport { entryTweenProps, exitTweenProps } from '../../effects/FlyEffect';\nimport { Layer } from '../../layer/GameLayerTypes';\nimport { GameItemType, LocationId } from '../../location/GameMapTypes';\nimport { GamePhaseType } from '../../phase/GamePhaseTypes';\nimport GameGlobalAPI from '../../scenes/gameManager/GameGlobalAPI';\nimport { createButton } from '../../utils/ButtonUtils';\nimport { sleep } from '../../utils/GameUtils';\nimport { calcTableFormatPos } from '../../utils/StyleUtils';\nimport MoveModeConstants, { moveButtonStyle } from './GameModeMoveConstants';\n\n/**\n * The class in charge of showing the \"Move\" UI\n * to show the images and titles of navigable\n * locations from one location\n */\nclass GameModeMove implements IGameUI {\n  private uiContainer: Phaser.GameObjects.Container | undefined;\n\n  /**\n   * Set the location preview sprite to the given asset key.\n   *\n   * @param sprite sprite for which its texture will be replaced with the new preview\n   * @param assetKey asset key of the new preview\n   */\n  private setPreview(sprite: Phaser.GameObjects.Sprite, assetKey: string) {\n    sprite\n      .setTexture(assetKey)\n      .setDisplaySize(MoveModeConstants.preview.rect.width, MoveModeConstants.preview.rect.height)\n      .setPosition(MoveModeConstants.preview.rect.x, MoveModeConstants.preview.rect.y);\n  }\n\n  /**\n   * Fetches the navigations of the current location id.\n   */\n  private getLatestNavigations() {\n    return GameGlobalAPI.getInstance().getGameItemsInLocation(\n      GameItemType.navigation,\n      GameGlobalAPI.getInstance().getCurrLocId()\n    );\n  }\n\n  /**\n   * Create the container that encapsulate the 'Move' mode UI,\n   * i.e. the navigation, the back button, as well the preview of\n   * the location.\n   */\n  private createUIContainer() {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    const moveMenuContainer = new Phaser.GameObjects.Container(gameManager, 0, 0);\n\n    // Preview\n    const previewFrame = new Phaser.GameObjects.Sprite(\n      gameManager,\n      MoveModeConstants.preview.frame.x,\n      screenCenter.y,\n      ImageAssets.locationPreviewFrame.key\n    );\n    const previewFill = new Phaser.GameObjects.Sprite(\n      gameManager,\n      screenCenter.x,\n      screenCenter.y,\n      ImageAssets.locationPreviewFill.key\n    );\n    moveMenuContainer.add([previewFrame, previewFill]);\n\n    // Add all navigation buttons\n    const navigations = this.getLatestNavigations();\n    const buttons = this.getMoveButtons(navigations, previewFill);\n    const buttonPositions = calcTableFormatPos({\n      numOfItems: buttons.length,\n      numItemLimit: 1,\n      maxYSpace: MoveModeConstants.button.ySpace\n    });\n\n    moveMenuContainer.add(\n      buttons.map((button, index) =>\n        this.createMoveButton(\n          button.text,\n          buttonPositions[index][0] + MoveModeConstants.button.xOffSet,\n          buttonPositions[index][1],\n          button.callback,\n          button.onHover,\n          button.onOut\n        )\n      )\n    );\n\n    const backButton = new CommonBackButton(\n      gameManager,\n      async () => await GameGlobalAPI.getInstance().swapPhase(GamePhaseType.Menu)\n    );\n    moveMenuContainer.add(backButton);\n\n    // Initial setting\n    this.setPreview(previewFill, ImageAssets.defaultLocationImg.key);\n\n    return moveMenuContainer;\n  }\n\n  /**\n   * Get the move buttons preset to be formatted later.\n   * The preset includes the text to be displayed on the button and\n   * its functionality (change location callback).\n   *\n   * @param navigations navigations from the current location\n   * @param previewSprite the sprite in which to show the location preview, to be included\n   *                      in the callback\n   */\n  private getMoveButtons(navigations: LocationId[], previewSprite: Phaser.GameObjects.Sprite) {\n    const previewLoc = (assetKey: string) => this.setPreview(previewSprite, assetKey);\n    const previewDefault = () => this.setPreview(previewSprite, ImageAssets.defaultLocationImg.key);\n\n    return navigations.map(nav => {\n      const location = GameGlobalAPI.getInstance().getLocationAtId(nav);\n      return {\n        text: location.name,\n        callback: async () => {\n          await GameGlobalAPI.getInstance().swapPhase(GamePhaseType.Sequence);\n          await GameGlobalAPI.getInstance().changeLocationTo(nav);\n        },\n        onHover: () => previewLoc(location.previewKey || location.assetKey),\n        onOut: () => previewDefault()\n      };\n    });\n  }\n\n  /**\n   * Format the button information to a UI container, complete with\n   * styling and functionality.\n   *\n   * @param text text to be displayed on the button\n   * @param xPos x position of the button\n   * @param yPos y position of the button\n   * @param callback callback to be executed on click\n   * @param onHover callback to be executed on hover\n   * @param onOut callback to be executed on out hover\n   */\n  private createMoveButton(\n    text: string,\n    xPos: number,\n    yPos: number,\n    callback: any,\n    onHover: any,\n    onOut: any\n  ) {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    return createButton(gameManager, {\n      assetKey: ImageAssets.longButton.key,\n      message: text,\n      textConfig: { x: 0, y: 0, oriX: 0.4, oriY: 0.15 },\n      bitMapTextStyle: moveButtonStyle,\n      onUp: callback,\n      onHover: onHover,\n      onOut: onOut\n    }).setPosition(xPos, yPos);\n  }\n\n  /**\n   * Activate the 'Move' mode UI.\n   *\n   * Usually only called by the phase manager when 'Move' phase is\n   * pushed.\n   */\n  public async activateUI(): Promise<void> {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    this.uiContainer = this.createUIContainer();\n    GameGlobalAPI.getInstance().addToLayer(Layer.UI, this.uiContainer);\n\n    this.uiContainer.setPosition(this.uiContainer.x, -screenSize.y);\n\n    gameManager.tweens.add({\n      targets: this.uiContainer,\n      ...entryTweenProps\n    });\n    GameGlobalAPI.getInstance().playSound(SoundAssets.modeEnter.key);\n  }\n\n  /**\n   * Deactivate the 'Move' mode UI.\n   *\n   * Usually only called by the phase manager when 'Move' phase is\n   * transitioned out.\n   */\n  public async deactivateUI(): Promise<void> {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n\n    if (this.uiContainer) {\n      this.uiContainer.setPosition(this.uiContainer.x, 0);\n\n      gameManager.tweens.add({\n        targets: this.uiContainer,\n        ...exitTweenProps\n      });\n\n      await sleep(500);\n      fadeAndDestroy(gameManager, this.uiContainer);\n    }\n  }\n}\n\nexport default GameModeMove;\n","import { IGameUI } from '../../commons/CommonTypes';\n\n/**\n * This is the phase that is active when none of\n * the mode UI's are being shown.\n *\n * It is used for dialogue/popups and notifications\n */\nclass GameModeSequence implements IGameUI {\n  public activateUI() {}\n  public deactivateUI() {}\n}\n\nexport default GameModeSequence;\n","import FontAssets from '../../assets/FontAssets';\nimport { screenSize } from '../../commons/CommonConstants';\nimport { BitmapFontStyle } from '../../commons/CommonTypes';\n\nexport const talkButtonStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 30,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nconst TalkModeConstants = {\n  button: { ySpace: screenSize.y * 0.7 }\n};\n\nexport default TalkModeConstants;\n","import GameGlobalAPI from 'src/features/game/scenes/gameManager/GameGlobalAPI';\n\nimport ImageAssets from '../../assets/ImageAssets';\nimport SoundAssets from '../../assets/SoundAssets';\nimport CommonBackButton from '../../commons/CommonBackButton';\nimport { screenSize } from '../../commons/CommonConstants';\nimport { IGameUI, ItemId } from '../../commons/CommonTypes';\nimport { fadeAndDestroy } from '../../effects/FadeEffect';\nimport { entryTweenProps, exitTweenProps } from '../../effects/FlyEffect';\nimport { Layer } from '../../layer/GameLayerTypes';\nimport { GameItemType } from '../../location/GameMapTypes';\nimport { GamePhaseType } from '../../phase/GamePhaseTypes';\nimport { createButton } from '../../utils/ButtonUtils';\nimport { mandatory, sleep } from '../../utils/GameUtils';\nimport { calcTableFormatPos, Direction } from '../../utils/StyleUtils';\nimport TalkModeConstants, { talkButtonStyle } from './GameModeTalkConstants';\n\n/**\n * The class renders the \"Talk\" UI which displays\n * a selection of all the dialogues that players can\n * talk about in a location.\n */\nclass GameModeTalk implements IGameUI {\n  private uiContainer: Phaser.GameObjects.Container | undefined;\n\n  /**\n   * Fetches the talk topics of the current location id.\n   */\n  private getLatestTalkTopics() {\n    return GameGlobalAPI.getInstance().getGameItemsInLocation(\n      GameItemType.talkTopics,\n      GameGlobalAPI.getInstance().getCurrLocId()\n    );\n  }\n\n  /**\n   * Create the container that encapsulate the 'Talk' mode UI,\n   * i.e. the talk topics, the back button, as well the checked\n   * icon for triggered talk topics.\n   */\n  private createUIContainer() {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    const talkMenuContainer = new Phaser.GameObjects.Container(gameManager, 0, 0);\n\n    // Add talk topics of the location\n    const talkTopics = this.getLatestTalkTopics();\n    const buttons = this.getTalkTopicButtons(talkTopics);\n    const buttonPositions = calcTableFormatPos({\n      direction: Direction.Column,\n      numOfItems: buttons.length,\n      maxYSpace: TalkModeConstants.button.ySpace\n    });\n\n    talkMenuContainer.add(\n      buttons.map((button, index) =>\n        this.createTalkTopicButton(\n          button.text,\n          buttonPositions[index][0],\n          buttonPositions[index][1],\n          button.callback\n        )\n      )\n    );\n\n    // Add check for interacted talk topics\n    buttons.forEach((button, index) => {\n      const checkedSprite = new Phaser.GameObjects.Sprite(\n        gameManager,\n        buttonPositions[index][0],\n        buttonPositions[index][1],\n        ImageAssets.talkOptCheck.key\n      );\n\n      const isTriggeredTopic =\n        !!button.interactionId &&\n        GameGlobalAPI.getInstance().hasTriggeredInteraction(button.interactionId);\n\n      if (isTriggeredTopic) {\n        talkMenuContainer.add(checkedSprite);\n      }\n    });\n\n    const backButton = new CommonBackButton(\n      gameManager,\n      async () => await GameGlobalAPI.getInstance().swapPhase(GamePhaseType.Menu)\n    );\n    talkMenuContainer.add(backButton);\n    return talkMenuContainer;\n  }\n\n  /**\n   * Get the talk topics button preset to be formatted later.\n   * The preset includes the text to be displayed on the button and\n   * its functionality (dialogue callback).\n   *\n   * @param dialogueIds dialogue IDs to create talk topics from\n   */\n  private getTalkTopicButtons(dialogueIds: ItemId[]) {\n    return dialogueIds.map(dialogueId => {\n      const dialogue = mandatory(GameGlobalAPI.getInstance().getDialogueById(dialogueId));\n      return {\n        text: dialogue.title,\n        callback: async () => {\n          GameGlobalAPI.getInstance().triggerInteraction(dialogueId);\n          await GameGlobalAPI.getInstance().showDialogue(dialogueId);\n        },\n        interactionId: dialogueId\n      };\n    });\n  }\n\n  /**\n   * Format the button information to a UI container, complete with\n   * styling and functionality.\n   *\n   * @param text text to be displayed on the button\n   * @param xPos x position of the button\n   * @param yPos y position of the button\n   * @param callback callback to be executed on click\n   */\n  private createTalkTopicButton(text: string, xPos: number, yPos: number, callback: any) {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    return createButton(gameManager, {\n      assetKey: ImageAssets.talkOptButton.key,\n      message: text,\n      textConfig: { x: 0, y: 0, oriX: 0.5, oriY: 0.2 },\n      bitMapTextStyle: talkButtonStyle,\n      onUp: callback\n    }).setPosition(xPos, yPos);\n  }\n\n  /**\n   * Activate the 'Talk' mode UI.\n   *\n   * Usually only called by the phase manager when 'Talk' phase is\n   * pushed.\n   */\n  public async activateUI(): Promise<void> {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    this.uiContainer = this.createUIContainer();\n    GameGlobalAPI.getInstance().addToLayer(Layer.UI, this.uiContainer);\n\n    this.uiContainer.setPosition(this.uiContainer.x, -screenSize.y);\n\n    gameManager.tweens.add({\n      targets: this.uiContainer,\n      ...entryTweenProps\n    });\n    GameGlobalAPI.getInstance().playSound(SoundAssets.modeEnter.key);\n  }\n\n  /**\n   * Deactivate the 'Talk' mode UI.\n   *\n   * Usually only called by the phase manager when 'Talk' phase is\n   * transitioned out.\n   */\n  public async deactivateUI(): Promise<void> {\n    const gameManager = GameGlobalAPI.getInstance().getGameManager();\n    if (this.uiContainer) {\n      this.uiContainer.setPosition(this.uiContainer.x, 0);\n\n      gameManager.tweens.add({\n        targets: this.uiContainer,\n        ...exitTweenProps\n      });\n\n      await sleep(500);\n      fadeAndDestroy(gameManager, this.uiContainer);\n    }\n  }\n}\n\nexport default GameModeTalk;\n","import GameActionManager from '../../action/GameActionManager';\nimport GameAnimationManager from '../../animations/GameAnimationManager';\nimport { AssetType, ImageAsset } from '../../assets/AssetsTypes';\nimport GameAwardsManager from '../../awards/GameAwardsManager';\nimport GameBackgroundManager from '../../background/GameBackgroundManager';\nimport GameBBoxManager from '../../boundingBoxes/GameBoundingBoxManager';\nimport { GameCheckpoint } from '../../chapter/GameChapterTypes';\nimport GameCharacterManager from '../../character/GameCharacterManager';\nimport { Constants } from '../../commons/CommonConstants';\nimport { AssetKey } from '../../commons/CommonTypes';\nimport GameDashboardManager from '../../dashboard/GameDashboardManager';\nimport { DashboardPage } from '../../dashboard/GameDashboardTypes';\nimport GameDialogueManager from '../../dialogue/GameDialogueManager';\nimport GameDialogueStorageManager from '../../dialogue/GameDialogueStorageManager';\nimport { blackFade, blackScreen, fadeIn } from '../../effects/FadeEffect';\nimport { addLoadingScreen } from '../../effects/LoadingScreen';\nimport GameEscapeManager from '../../escape/GameEscapeManager';\nimport GameInputManager from '../../input/GameInputManager';\nimport GameLayerManager from '../../layer/GameLayerManager';\nimport { Layer } from '../../layer/GameLayerTypes';\nimport { LocationId } from '../../location/GameMapTypes';\nimport GameLogManager from '../../log/GameLogManager';\nimport GameObjectManager from '../../objects/GameObjectManager';\nimport GamePhaseManager from '../../phase/GamePhaseManager';\nimport { GamePhaseType } from '../../phase/GamePhaseTypes';\nimport GamePopUpManager from '../../popUp/GamePopUpManager';\nimport SourceAcademyGame from '../../SourceAcademyGame';\nimport GameStateManager from '../../state/GameStateManager';\nimport GameTaskLogManager from '../../task/GameTaskLogManager';\nimport GameToolbarManager from '../../toolbar/GameToolbarManager';\nimport { mandatory, sleep, toS3Path } from '../../utils/GameUtils';\nimport GameGlobalAPI from './GameGlobalAPI';\nimport { createGamePhases } from './GameManagerHelper';\n\ntype GameManagerProps = {\n  continueGame: boolean;\n  chapterNum: number;\n  checkpointNum: number;\n  gameCheckpoint: GameCheckpoint;\n};\n\n/**\n * Main scene that plays the checkpoint.\n *\n * It processes checkpoint objects and loads\n * the chapter exclusive assets (location image, sounds).\n *\n * It also handles main gameplay loop, e.g. switching between modes,\n * activation of escape or collectible menu, location switching,\n * triggering actions, etc.\n */\nclass GameManager extends Phaser.Scene {\n  public currentLocationId: LocationId;\n  public hasTransitioned: boolean;\n  private stateManager?: GameStateManager;\n  private layerManager?: GameLayerManager;\n  private objectManager?: GameObjectManager;\n  private characterManager?: GameCharacterManager;\n  private dialogueManager?: GameDialogueManager;\n  private actionManager?: GameActionManager;\n  private boundingBoxManager?: GameBBoxManager;\n  private popUpManager?: GamePopUpManager;\n  private phaseManager?: GamePhaseManager;\n  private backgroundManager?: GameBackgroundManager;\n  private animationManager?: GameAnimationManager;\n  private inputManager?: GameInputManager;\n  private escapeManager?: GameEscapeManager;\n  private collectibleManager?: GameAwardsManager;\n  private achievementManager?: GameAwardsManager;\n  private logManager?: GameLogManager;\n  private dialogueStorageManager?: GameDialogueStorageManager;\n  private toolbarManager?: GameToolbarManager;\n  private taskLogManager?: GameTaskLogManager;\n  private dashboardManager?: GameDashboardManager;\n\n  constructor() {\n    super('GameManager');\n    this.currentLocationId = Constants.nullInteractionId;\n    this.hasTransitioned = false;\n  }\n\n  public init({ gameCheckpoint, continueGame, chapterNum, checkpointNum }: GameManagerProps) {\n    GameGlobalAPI.getInstance().setGameManager(this);\n    SourceAcademyGame.getInstance().setCurrentSceneRef(this);\n    this.getSaveManager().registerGameInfo(chapterNum, checkpointNum, continueGame);\n    this.currentLocationId =\n      this.getSaveManager().getLoadedLocation() || gameCheckpoint.startingLoc;\n    this.hasTransitioned = false;\n\n    this.stateManager = new GameStateManager(gameCheckpoint);\n    this.layerManager = new GameLayerManager(this);\n    this.inputManager = new GameInputManager(this);\n    this.phaseManager = new GamePhaseManager(createGamePhases(), this.inputManager);\n    this.characterManager = new GameCharacterManager();\n    this.objectManager = new GameObjectManager();\n    this.dialogueManager = new GameDialogueManager();\n    this.actionManager = new GameActionManager();\n    this.boundingBoxManager = new GameBBoxManager();\n    this.backgroundManager = new GameBackgroundManager();\n    this.animationManager = new GameAnimationManager();\n    this.popUpManager = new GamePopUpManager();\n    this.escapeManager = new GameEscapeManager(this);\n    this.collectibleManager = new GameAwardsManager(\n      this,\n      SourceAcademyGame.getInstance().getUserStateManager().getCollectibles\n    );\n    this.achievementManager = new GameAwardsManager(\n      this,\n      SourceAcademyGame.getInstance().getUserStateManager().getAchievements\n    );\n    this.logManager = new GameLogManager(this);\n    this.dialogueStorageManager = new GameDialogueStorageManager();\n    this.toolbarManager = new GameToolbarManager(this);\n    this.taskLogManager = new GameTaskLogManager(this);\n    this.dashboardManager = new GameDashboardManager(\n      this,\n      [\n        DashboardPage.Log,\n        DashboardPage.Tasks,\n        DashboardPage.Collectibles,\n        DashboardPage.Achievements\n      ],\n      [this.logManager, this.taskLogManager, this.collectibleManager, this.achievementManager]\n    );\n  }\n\n  //////////////////////\n  //    Preload       //\n  //////////////////////\n\n  public preload() {\n    addLoadingScreen(this);\n    this.getPhaseManager().setInterruptCheckCallback(\n      (prevPhase: GamePhaseType, newPhase: GamePhaseType) =>\n        this.transitionChecker(prevPhase, newPhase)\n    );\n    this.getPhaseManager().setInterruptCallback(\n      async (prevPhase: GamePhaseType, newPhase: GamePhaseType) => await this.checkpointTransition()\n    );\n    this.getPhaseManager().setCallback(\n      async (prevPhase: GamePhaseType, newPhase: GamePhaseType) =>\n        await this.handleCharacterLayer(prevPhase, newPhase)\n    );\n    this.preloadLocationsAssets();\n    this.bindKeyboardTriggers();\n  }\n\n  /**\n   * Preload all assets (image and sounds) exclusive to the checkpoint's gamemap.\n   */\n  private preloadLocationsAssets() {\n    const gameMap = this.getStateManager().getGameMap();\n    GameGlobalAPI.getInstance().loadSounds(gameMap.getSoundAssets());\n    gameMap.getMapAssets().forEach((image, assetKey) => {\n      this.loadImage(image, assetKey);\n    });\n  }\n\n  /**\n   * Loads each asset type (image, sprite) appropriately\n   *\n   * @param image ImageAsset object to be loaded\n   * @param assetKey asset key of ImageAsset\n   */\n  private loadImage(image: ImageAsset, assetKey: AssetKey) {\n    switch (image.type) {\n      case AssetType.Image:\n        this.load.image(assetKey, toS3Path(image.path, true));\n        break;\n      case AssetType.Sprite:\n        this.load.spritesheet(assetKey, toS3Path(image.path, true), image.config);\n        break;\n      default:\n        break;\n    }\n  }\n\n  //////////////////////\n  // Location Helpers //\n  //////////////////////\n\n  public async create() {\n    GameGlobalAPI.getInstance().hideLayer(Layer.Character);\n    await this.changeLocationTo(this.currentLocationId, true);\n    await GameGlobalAPI.getInstance().saveGame();\n  }\n\n  /**\n   * Render a location, the assets related to it (objects, character);\n   * before executing the following in order (if available):\n   *\n   * Start Action, Notification, Cutscene\n   *\n   * Start action is only played when startAction argument is set to true;\n   * commonly only the first time user loads the checkpoint.\n   *\n   * @param locationId id of the location to render\n   * @param startAction if set to true, startAction will be executed\n   */\n  private async renderLocation(locationId: LocationId, startAction: boolean) {\n    const gameLocation = GameGlobalAPI.getInstance().getLocationAtId(locationId);\n\n    // Render the toolbar in every location\n    this.getToolbarManager().renderToolbarContainer();\n\n    // Play the BGM attached to the location\n    await GameGlobalAPI.getInstance().playBgMusic(gameLocation.bgmKey);\n\n    // Render all assets related to the location\n    this.getBackgroundManager().renderBackgroundLayerContainer(locationId);\n    this.getObjectManager().renderObjectsLayerContainer(locationId);\n    this.getBBoxManager().renderBBoxLayerContainer(locationId);\n    this.getCharacterManager().renderCharacterLayerContainer(locationId);\n\n    await this.getPhaseManager().swapPhase(GamePhaseType.Sequence);\n\n    if (startAction) {\n      // Execute fast forward actions\n      await this.getActionManager().fastForwardGameActions(\n        this.getStateManager().getTriggeredStateChangeActions()\n      );\n      // Game start actions\n      await this.getActionManager().processGameActions(\n        this.getStateManager().getGameMap().getGameStartActions()\n      );\n    }\n\n    // Location cutscene\n    await this.getActionManager().processGameActions(gameLocation.actionIds);\n\n    // Location notification\n    if (this.getStateManager().hasLocationNotif(locationId)) {\n      await GameGlobalAPI.getInstance().bringUpUpdateNotif(gameLocation.name);\n      this.getStateManager().removeLocationNotif(locationId);\n    }\n\n    if (this.getPhaseManager().isCurrentPhase(GamePhaseType.Sequence)) {\n      await this.getPhaseManager().swapPhase(GamePhaseType.Menu);\n    }\n  }\n\n  /**\n   * Change the current location to another location, based on the ID.\n   * This will properly clean up the previous location. It is highly\n   * encouraged to only change location of the game using this method.\n   *\n   * @param locationId id of location to be changed into\n   * @param startAction if set to true, start action will be triggered\n   */\n  public async changeLocationTo(locationId: LocationId, startAction: boolean = false) {\n    this.currentLocationId = locationId;\n\n    // Transition to the new location\n    await blackFade(this, 300, 500, async () => {\n      await this.getLayerManager().clearAllLayers();\n      await this.renderLocation(locationId, startAction);\n    });\n\n    // Update state after location is fully rendered, location has been visited\n    this.getStateManager().triggerInteraction(locationId);\n  }\n\n  /**\n   * Bind escape menu and dashboard to keyboard triggers.\n   */\n  private bindKeyboardTriggers() {\n    this.getInputManager().registerKeyboardListener(\n      Phaser.Input.Keyboard.KeyCodes.ESC,\n      'up',\n      async () => {\n        if (this.getPhaseManager().isCurrentPhaseTerminal()) {\n          await this.getPhaseManager().popPhase();\n        } else {\n          await this.getPhaseManager().pushPhase(GamePhaseType.EscapeMenu);\n        }\n      }\n    );\n    this.getInputManager().registerKeyboardListener(\n      Phaser.Input.Keyboard.KeyCodes.TAB,\n      'up',\n      async () => {\n        if (this.getPhaseManager().isCurrentPhase(GamePhaseType.Dashboard)) {\n          await this.getPhaseManager().popPhase();\n        } else if (this.getPhaseManager().isCurrentPhaseTerminal()) {\n          await this.getPhaseManager().swapPhase(GamePhaseType.Dashboard);\n        } else {\n          await this.getPhaseManager().pushPhase(GamePhaseType.Dashboard);\n        }\n      }\n    );\n  }\n\n  /**\n   * Clean up on related managers\n   */\n  public cleanUp() {\n    this.getInputManager().clearListeners();\n    this.getLayerManager().clearAllLayers();\n    this.getDialogueStorageManager().clearDialogueStorage();\n  }\n\n  /**\n   * Checks whether game is able to transition to the next checkpoint.\n   * Game is only able to transition to the next checkpoint\n   * if all of the objectives of the current checkpoint has been cleared.\n   *\n   * We also do not want to go Transition scene if players have just\n   * completed the chapter so that they can don't get kicked out of the\n   * chapter if they've already finished it before.\n   * This is unless they press replay, which sets their chapNewlyCompleted back to false.\n   *\n   * Additionally, game will only transition if the newPhase is not Sequence phase;\n   * in order to ensure that we don't transition to the next checkpoint\n   * during dialogue/cutscene.\n   *\n   * This method is passed to the phase manager, as the interrupt checker.\n   *\n   * @param prevPhase previous phase to transition from\n   * @param newPhase new phase to transition to\n   */\n  public transitionChecker(prevPhase: GamePhaseType, newPhase: GamePhaseType) {\n    return (\n      !this.hasTransitioned &&\n      newPhase !== GamePhaseType.Sequence &&\n      GameGlobalAPI.getInstance().areAllObjectivesComplete() &&\n      !this.getStateManager().getChapterNewlyCompleted()\n    );\n  }\n\n  /**\n   * Transition to the next checkpoint and resets the input setting.\n   *\n   * This method is passed to the phase manager\n   * as the interrupt transition callback.\n   */\n  public async checkpointTransition() {\n    this.hasTransitioned = true;\n\n    await this.getActionManager().processGameActions(\n      this.getStateManager().getGameMap().getCheckpointCompleteActions()\n    );\n\n    // Reset input and cursor, in case it is changed after story complete actions\n    this.getInputManager().setDefaultCursor(Constants.defaultCursor);\n    this.getInputManager().enableMouseInput(true);\n    this.getInputManager().enableKeyboardInput(true);\n\n    this.tweens.add(fadeIn([blackScreen(this).setAlpha(0)], Constants.fadeDuration));\n    await sleep(Constants.fadeDuration);\n\n    // Clean up all layers & current storage\n    this.cleanUp();\n\n    // Start the next Checkpoint\n    this.scene.start('CheckpointTransition');\n  }\n\n  /**\n   * Handle when character layer should be shown and hidden.\n   * Character layer should only be shown when student is at\n   * Menu Mode.\n   *\n   * This method is passed to the phase manager, to be executed on\n   * every phase transition.\n   *\n   * @param prevPhase previous phase to transition from\n   * @param newPhase new phase to transition to\n   */\n  public async handleCharacterLayer(prevPhase: GamePhaseType, newPhase: GamePhaseType) {\n    if (prevPhase === GamePhaseType.Menu) {\n      GameGlobalAPI.getInstance().fadeOutLayer(Layer.Character);\n    }\n\n    if (newPhase === GamePhaseType.Menu) {\n      GameGlobalAPI.getInstance().fadeInLayer(Layer.Character);\n    }\n  }\n\n  public getSaveManager = () => SourceAcademyGame.getInstance().getSaveManager();\n  public getStateManager = () => mandatory(this.stateManager);\n  public getObjectManager = () => mandatory(this.objectManager);\n  public getDialogueManager = () => mandatory(this.dialogueManager);\n  public getCharacterManager = () => mandatory(this.characterManager);\n  public getBBoxManager = () => mandatory(this.boundingBoxManager);\n  public getActionManager = () => mandatory(this.actionManager);\n  public getInputManager = () => mandatory(this.inputManager);\n  public getLayerManager = () => mandatory(this.layerManager);\n  public getPhaseManager = () => mandatory(this.phaseManager);\n  public getBackgroundManager = () => mandatory(this.backgroundManager);\n  public getAnimationManager = () => mandatory(this.animationManager);\n  public getPopupManager = () => mandatory(this.popUpManager);\n  public getEscapeManager = () => mandatory(this.escapeManager);\n  public getCollectibleManager = () => mandatory(this.collectibleManager);\n  public getAchievementManager = () => mandatory(this.achievementManager);\n  public getLogManager = () => mandatory(this.logManager);\n  public getDialogueStorageManager = () => mandatory(this.dialogueStorageManager);\n  public getToolbarManager = () => mandatory(this.toolbarManager);\n  public getTaskLogManager = () => mandatory(this.taskLogManager);\n  public getDashboardManager = () => mandatory(this.dashboardManager);\n}\n\nexport default GameManager;\n","import GameModeExplore from '../../mode/explore/GameModeExplore';\nimport GameModeMenu from '../../mode/menu/GameModeMenu';\nimport GameModeMove from '../../mode/move/GameModeMove';\nimport GameModeSequence from '../../mode/sequence/GameModeSequence';\nimport GameModeTalk from '../../mode/talk/GameModeTalk';\nimport { GamePhaseType } from '../../phase/GamePhaseTypes';\n\n/**\n * Game Manager phases, for the phase manager.\n */\nexport const createGamePhases = () => {\n  return new Map([\n    [GamePhaseType.Menu, new GameModeMenu()],\n    [GamePhaseType.Move, new GameModeMove()],\n    [GamePhaseType.Explore, new GameModeExplore()],\n    [GamePhaseType.Talk, new GameModeTalk()],\n    [GamePhaseType.Sequence, new GameModeSequence()],\n    [GamePhaseType.None, new GameModeSequence()]\n  ]);\n};\n","import GameManager from '../scenes/gameManager/GameManager';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { mandatory } from '../utils/GameUtils';\nimport { createEmptyGameSaveState, createEmptySaveState, gameStateToJson } from './GameSaveHelper';\nimport { loadData, saveData } from './GameSaveRequests';\nimport { FullSaveState, GameSaveState, SettingsJson } from './GameSaveTypes';\n\n/**\n * The manager provides API for loading and saving data from the backend\n * and is in charge of keeping record of the last save point, so that\n * players can make new save data based on the last one.\n */\nexport default class GameSaveManager {\n  private fullSaveState: FullSaveState;\n\n  private chapterNum?: number;\n  private checkpointNum?: number;\n\n  constructor() {\n    this.fullSaveState = createEmptySaveState();\n  }\n\n  /**\n   * Fetches the FullSaveState of the student at the start of the game\n   * and stores this internally as full save state\n   */\n  public async loadLastSaveState() {\n    this.fullSaveState = await loadData();\n  }\n\n  /**\n   * Updates the save manager with chapter number and checkpoint number\n   * if player has chosen a chapter/checkpoint to play with.\n   *\n   * Chapter number and checkpoint number can be -1 if inside the Story Simulator,\n   *\n   * @param chapterNum chapter number\n   * @param checkpointNum checkpoint number\n   * @param continueGame whether user wants to continue or restart the chapter.\n   */\n  public registerGameInfo(chapterNum: number, checkpointNum: number, continueGame: boolean) {\n    this.chapterNum = chapterNum;\n    this.checkpointNum = checkpointNum;\n    if (!continueGame) {\n      this.fullSaveState.gameSaveStates[chapterNum] = createEmptyGameSaveState();\n    }\n  }\n\n  ///////////////////////////////\n  //          Saving          //\n  ///////////////////////////////\n\n  /**\n   * Save the current game state as a JSON 'snapshot' to the backend.\n   * Can only be called inside the GameManager scene because this function retrieves\n   * informtion from GameManager, GameStateManager, or other in-game managers,\n   * and converts them into JSON format to be saved to backend.\n   *\n   * Only called when playing the Game (not Story Simulator), because Story Simulator\n   * shouldn't save game state to backend.\n   */\n  public async saveGame() {\n    if (SourceAcademyGame.getInstance().getCurrentSceneRef() instanceof GameManager) {\n      this.fullSaveState = gameStateToJson(\n        this.fullSaveState,\n        this.getChapterNum(),\n        this.getCheckpointNum()\n      );\n      await saveData(this.fullSaveState);\n    }\n  }\n\n  /**\n   * This function is called during CheckpointTransition to update\n   * and save that largest chapter that the player has completed\n   * so far.\n   *\n   * @param completedChapter the number of the completed chapter\n   */\n  public async saveChapterComplete(completedChapter: number) {\n    this.fullSaveState.gameSaveStates[completedChapter].chapterNewlyCompleted = true;\n    if (completedChapter > this.getLargestCompletedChapterNum()) {\n      this.fullSaveState.userSaveState.largestCompletedChapter = completedChapter;\n    }\n    await saveData(this.fullSaveState);\n  }\n\n  /**\n   * This function is called by the Escape Manager and Settings scene\n   * to store new user settings to the backend\n   *\n   * @param settingsJson the newest settings of the user\n   */\n  public async saveSettings(settingsJson: SettingsJson) {\n    this.fullSaveState.userSaveState.settings = settingsJson;\n    await saveData(this.fullSaveState);\n  }\n\n  ///////////////////////////////\n  //         Getters           //\n  ///////////////////////////////\n\n  /**\n   * Obtains user settings from full save state\n   *\n   * @returns User settings\n   */\n  public getSettings(): SettingsJson {\n    return this.fullSaveState.userSaveState.settings;\n  }\n\n  /**\n   * Obtains user state from full save state\n   */\n  public getLoadedUserState() {\n    return this.fullSaveState.userSaveState;\n  }\n\n  /**\n   * Obtains the largest completed chapter number by the player\n   */\n  public getLargestCompletedChapterNum(): number {\n    return this.fullSaveState.userSaveState.largestCompletedChapter;\n  }\n\n  /**\n   * Gets user's gamestate for this chapter\n   */\n  public getGameSaveState(): GameSaveState {\n    return this.fullSaveState.gameSaveStates[this.getChapterNum()] || createEmptyGameSaveState();\n  }\n\n  /**\n   * Gets user's location for this chapter if chapter has been created\n   */\n  public getLoadedLocation() {\n    return this.getGameSaveState().currentLocation;\n  }\n  /**\n   * Returns the save state for a particular chapter, if no data, then create an empty save state\n   */\n  public getChapterSaveState(index: number) {\n    return this.fullSaveState.gameSaveStates[index] || createEmptyGameSaveState();\n  }\n\n  public getTriggeredStateChangeActions = () => this.getGameSaveState().triggeredStateChangeActions;\n  public getTriggeredInteractions = () => this.getGameSaveState().triggeredInteractions;\n  public getCompletedObjectives = () => this.getGameSaveState().completedObjectives;\n  public getCompletedTasks = () => this.getGameSaveState().completedTasks;\n  public getIncompleteTasks = () => this.getGameSaveState().incompleteTasks;\n  public getLoadedPhase = () => this.getGameSaveState().currentPhase;\n  public getChapterNewlyCompleted = () => this.getGameSaveState().chapterNewlyCompleted;\n\n  public getChapterNum = () => mandatory(this.chapterNum);\n  public getCheckpointNum = () => mandatory(this.checkpointNum);\n  public getFullSaveState = () => this.fullSaveState;\n}\n","import _ from 'lodash';\nimport Constants from 'src/commons/utils/Constants';\n\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { courseId } from '../utils/GameUtils';\nimport { createEmptySaveState } from './GameSaveHelper';\nimport { FullSaveState } from './GameSaveTypes';\n\n/**\n * This function saves data to the backend under user's game state.\n *\n * @param fullSaveState - the entire game data that needs to be saved, including game state and userstate\n */\nexport async function saveData(fullSaveState: FullSaveState) {\n  if (SourceAcademyGame.getInstance().getAccountInfo().role !== 'student') {\n    return;\n  }\n\n  const options = {\n    method: 'PUT',\n    headers: createHeaders(SourceAcademyGame.getInstance().getAccountInfo().accessToken),\n    body: JSON.stringify({\n      gameStates: fullSaveState\n    })\n  };\n\n  const resp = await fetch(\n    `${Constants.backendUrl}/v2/courses/${courseId()}/user/game_states`,\n    options\n  );\n\n  if (resp && resp.ok) {\n    return resp;\n  }\n  return;\n}\n\n/**\n * This function fetches data from the backend.\n */\nexport async function loadData(): Promise<FullSaveState> {\n  const options = {\n    method: 'GET',\n    headers: createHeaders(SourceAcademyGame.getInstance().getAccountInfo().accessToken)\n  };\n\n  const resp = await fetch(`${Constants.backendUrl}/v2/user`, options);\n  const message = await resp.text();\n\n  const json = JSON.parse(message).courseRegistration?.gameStates;\n  return _.isEmpty(json) ? createEmptySaveState() : json;\n}\n\n/**\n * Format a header object.\n *\n * @param accessToken access token to be used\n */\nfunction createHeaders(accessToken: string): Headers {\n  const headers = new Headers();\n  headers.append('Accept', 'application/json');\n  headers.append('Authorization', `Bearer ${accessToken}`);\n  headers.append('Content-Type', 'application/json');\n  return headers;\n}\n","import FontAssets from '../assets/FontAssets';\nimport { BitmapFontStyle, ILayeredScene, TextConfig } from '../commons/CommonTypes';\nimport { createBitmapText } from '../utils/TextUtils';\n\nconst defaultGlitchStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 30,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\n/**\n * Create a bitmap text that glitches.\n *\n * Internally, we make use of multiple bitmap texts and apply\n * random small displacement to the individual bitmap texts.\n *\n * Returns an array of the individual bitmap texts.\n *\n * @param scene scene to attach it to\n * @param text text to show on the screen\n * @param baseTextConfig text config to be applied as the base to the text.\n *                       All random displacement is relative to this config\n * @param style style of the bitmap text\n * @param numOfFrames number of bitmap text to be created. The larger it is,\n *                    the more glitchy it becomes; but the more expensive is the effect\n * @param maxXDisplacement maximum horizontal displacement to be applied to the text\n * @param maxYDisplacement maximum vertical displacement to be applied to the text\n */\nexport function createGlitchBitmapText(\n  scene: ILayeredScene,\n  text: string,\n  baseTextConfig: TextConfig = { x: 0, y: 0, oriX: 0.5, oriY: 0.5 },\n  style: BitmapFontStyle = defaultGlitchStyle,\n  numOfFrames: number = 4,\n  maxXDisplacement: number = 5,\n  maxYDisplacement: number = 3\n) {\n  const textFrames = [];\n  for (let i = 0; i < numOfFrames; i++) {\n    const textConfig = {\n      x: baseTextConfig.x + maxXDisplacement * Math.random(),\n      y: baseTextConfig.y + maxYDisplacement * Math.random(),\n      oriX: baseTextConfig.oriX,\n      oriY: baseTextConfig.oriY\n    };\n    const bitmapText = createBitmapText(scene, text, textConfig, style);\n    bitmapText.setAlpha(0.4).setBlendMode(Phaser.BlendModes.SCREEN);\n    textFrames.push(bitmapText);\n  }\n\n  textFrames.forEach(bitmapText => {\n    scene.tweens.add({\n      targets: bitmapText,\n      x: bitmapText.x + maxXDisplacement * Math.random(),\n      y: bitmapText.y + maxYDisplacement * Math.random(),\n      alpha: 0.5,\n      duration: 20,\n      yoyo: true,\n      loop: -1,\n      loopDelay: 1000 * Math.random()\n    });\n  });\n\n  return textFrames;\n}\n","import SoundAssets from '../assets/SoundAssets';\nimport { Constants, screenCenter } from '../commons/CommonConstants';\nimport { ILayeredScene } from '../commons/CommonTypes';\nimport { Layer } from '../layer/GameLayerTypes';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { sleep } from '../utils/GameUtils';\nimport { calcListFormatPos } from '../utils/StyleUtils';\nimport { blackScreen, fadeAndDestroy, fadeIn } from './FadeEffect';\nimport { createGlitchBitmapText } from './Glitch';\n\nconst workerALines = [\n  'Clang. Thud. One hit to the wall, one hit to my flesh.',\n  '',\n  'They told me I was to be the pillar of this',\n  'spaceship - who knew they meant it literally?',\n  '- A. Halim'\n];\n\nconst workerTLines = [\n  'I blink synchronously with the screen;',\n  'I breathe as the machine steams on and off.',\n  '',\n  'Behind this closed space, my very blood fuels',\n  'these engines - hoping for you to find me.',\n  '- T. S. Chong'\n];\n\nconst WorkerConstants = {\n  yInterval: 80,\n  messageDuration: 5000\n};\n\n/**\n * Create a hidden interactive box that shows\n * the worker message when interacted with.\n *\n * Also adds it to the scene.\n *\n * @param scene scene for the box to be attached to\n * @param workerId either string 'A' or any other letter, represent which message to show\n * @param x top left hand corner of the hidden box\n * @param y top left hand corner of the hidden box\n * @param width width ot the box\n * @param height height of the box\n */\nexport function putWorkerMessage(\n  scene: ILayeredScene,\n  workerId: string,\n  x: number,\n  y: number,\n  width: number = 50,\n  height: number = 50\n) {\n  const rect = new Phaser.GameObjects.Rectangle(scene, x, y, width, height, 0, 0);\n  const lines = workerId === 'A' ? workerALines : workerTLines;\n\n  rect.setInteractive({ useHandCursor: true });\n  rect.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP, () => showLines(scene, lines));\n\n  scene.getLayerManager().addToLayer(Layer.UI, rect);\n}\n\n/**\n * Takes array of strings, and format them line by line on the screen.\n * Automatically fade in with a black screen, add glitch effect\n * to the text, followed by fade and destroy of all the objects created.\n *\n * @param scene scene to be attached to\n * @param lines lines to show on the screen, glitched\n */\nasync function showLines(scene: ILayeredScene, lines: string[]) {\n  // Set interactive to block mouse inputs on the screen\n  const blackOverlay = blackScreen(scene).setInteractive().setAlpha(0);\n\n  const linesPos = calcListFormatPos({\n    numOfItems: lines.length,\n    xSpacing: 0,\n    ySpacing: WorkerConstants.yInterval\n  });\n\n  // Each line has different Y position\n  const textConfig = { x: screenCenter.x, y: 0, oriX: 0.5, oriY: 0.5 };\n  const yStartPos = screenCenter.y - lines.length * WorkerConstants.yInterval * 0.5;\n\n  scene.getLayerManager().addToLayer(Layer.WorkerMessage, blackOverlay);\n  scene.add.tween(fadeIn([blackOverlay], Constants.fadeDuration));\n\n  // Play SFX\n  SourceAcademyGame.getInstance().getSoundManager().playSound(SoundAssets.radioStatic.key);\n\n  await sleep(Constants.fadeDuration);\n\n  // Create and add the texts, line by line\n  lines.forEach((line, index) => {\n    const textFrames = createGlitchBitmapText(scene, line, {\n      ...textConfig,\n      y: linesPos[index][1] + yStartPos\n    });\n    textFrames.forEach(frame => scene.getLayerManager().addToLayer(Layer.WorkerMessage, frame));\n    setTimeout(() => textFrames.forEach(frame => frame.destroy()), WorkerConstants.messageDuration);\n  });\n\n  await sleep(WorkerConstants.messageDuration);\n\n  fadeAndDestroy(scene, blackOverlay);\n}\n","import FontAssets from '../../assets/FontAssets';\nimport { screenCenter, screenSize } from '../../commons/CommonConstants';\nimport { BitmapFontStyle } from '../../commons/CommonTypes';\nimport { Color } from '../../utils/StyleUtils';\n\nexport const AwardsHallConstants = {\n  scrollSpeed: 20,\n  tileDim: 2048,\n  maxAwardsPerCol: 2,\n  arrow: { xOffset: 875 },\n  award: { xSpace: 300, yStart: 300, ySpace: screenCenter.y - 50, dim: 200 },\n  awardInfo: { width: 300 },\n  banner: { xOffset: -screenSize.x * 0.28 },\n  bannerTextConfig: { x: 30, y: 0, oriX: 0.0, oriY: 0.5 }\n};\n\nexport const awardBannerTextStyle: BitmapFontStyle = {\n  key: FontAssets.alienLeagueFont.key,\n  size: 35,\n  align: Phaser.GameObjects.BitmapText.ALIGN_LEFT\n};\n\nexport const awardNoAssetTitleStyle = {\n  fontFamily: 'Verdana',\n  fontSize: '30px',\n  fill: Color.lightBlue,\n  align: 'center',\n  wordWrap: { width: AwardsHallConstants.award.dim - 20 }\n};\n\nexport const awardHoverTitleStyle = {\n  fontFamily: 'Verdana',\n  fontSize: '20px',\n  fill: Color.lightBlue,\n  align: 'left',\n  wordWrap: { width: AwardsHallConstants.awardInfo.width - 20 }\n};\n\nexport const awardHoverKeyStyle = {\n  fontFamily: 'Verdana',\n  fontSize: '15px',\n  fill: Color.offWhite,\n  align: 'left',\n  wordWrap: { width: AwardsHallConstants.awardInfo.width - 20 }\n};\n\nexport const awardHoverDescStyle = {\n  fontFamily: 'Verdana',\n  fontSize: '15px',\n  fill: Color.lightBlue,\n  align: 'left',\n  wordWrap: { width: AwardsHallConstants.awardInfo.width - 20 }\n};\n","import ImageAssets from '../../assets/ImageAssets';\nimport { getAwardProps } from '../../awards/GameAwardsHelper';\nimport { AwardProperty } from '../../awards/GameAwardsTypes';\nimport CommonBackButton from '../../commons/CommonBackButton';\nimport { Constants, screenCenter, screenSize } from '../../commons/CommonConstants';\nimport { addLoadingScreen } from '../../effects/LoadingScreen';\nimport { putWorkerMessage } from '../../effects/WorkerMessage';\nimport GameInputManager from '../../input/GameInputManager';\nimport GameLayerManager from '../../layer/GameLayerManager';\nimport { Layer } from '../../layer/GameLayerTypes';\nimport SourceAcademyGame from '../../SourceAcademyGame';\nimport { createButton } from '../../utils/ButtonUtils';\nimport { limitNumber, mandatory } from '../../utils/GameUtils';\nimport { resizeUnderflow } from '../../utils/SpriteUtils';\nimport { calcTableFormatPos, Direction, HexColor } from '../../utils/StyleUtils';\nimport { createBitmapText } from '../../utils/TextUtils';\nimport {\n  awardBannerTextStyle,\n  awardNoAssetTitleStyle,\n  AwardsHallConstants\n} from './AwardsHallConstants';\nimport { createAwardsHoverContainer } from './AwardsHallHelper';\n\n/**\n * This scenes display all students awards (collectibles and achievements).\n */\nclass AwardsHall extends Phaser.Scene {\n  public layerManager?: GameLayerManager;\n  public inputManager?: GameInputManager;\n\n  private backgroundTile: Phaser.GameObjects.TileSprite | undefined;\n  private awardsContainer: Phaser.GameObjects.Container | undefined;\n\n  private isScrollLeft: boolean;\n  private isScrollRight: boolean;\n  private scrollLim: number;\n  private awardXSpace: number;\n\n  constructor() {\n    super('AwardsHall');\n    SourceAcademyGame.getInstance().setCurrentSceneRef(this);\n\n    this.isScrollLeft = false;\n    this.isScrollRight = false;\n    this.scrollLim = 0;\n    this.awardXSpace = 0;\n  }\n\n  public init() {\n    this.layerManager = new GameLayerManager(this);\n    this.inputManager = new GameInputManager(this);\n  }\n\n  public preload() {\n    addLoadingScreen(this);\n  }\n\n  public async create() {\n    // Calculate the maximum horizontal space required based\n    // on maximum number of achievement/collectible\n    const achievementLength = this.getUserStateManager().getAchievements().length;\n    const collectibleLength = this.getUserStateManager().getCollectibles().length;\n    this.awardXSpace =\n      Math.ceil(\n        Math.max(achievementLength, collectibleLength) / AwardsHallConstants.maxAwardsPerCol\n      ) * AwardsHallConstants.award.xSpace;\n\n    // Scroll limit is anything that exceed the screen size\n    this.scrollLim = this.awardXSpace < screenSize.x ? 0 : this.awardXSpace - screenSize.x;\n    this.renderBackground();\n    this.renderAwards();\n\n    putWorkerMessage(this, 'A', screenSize.x * 0.95, screenSize.y * 0.99);\n  }\n\n  public update() {\n    if (!this.backgroundTile || !this.awardsContainer) return;\n\n    // Scroll the awards hall if button is currently clicked/held down\n    let newXPos = this.awardsContainer.x;\n    if (this.isScrollRight) {\n      newXPos -= AwardsHallConstants.scrollSpeed;\n    } else if (this.isScrollLeft) {\n      newXPos += AwardsHallConstants.scrollSpeed;\n    }\n    newXPos = limitNumber(newXPos, -this.scrollLim, 0);\n\n    // To achieve seamless background, we need to scroll on .tilePosition for background\n    this.backgroundTile.tilePositionX = -newXPos;\n    this.awardsContainer.x = newXPos;\n  }\n\n  /**\n   * Render background of this scene, as well as its\n   * UI elements (arrows, backbutton, as well as the 'Collectible' and 'Achievement' banner).\n   */\n  private renderBackground() {\n    if (this.backgroundTile) this.backgroundTile.destroy();\n\n    this.backgroundTile = new Phaser.GameObjects.TileSprite(\n      this,\n      0,\n      0,\n      AwardsHallConstants.tileDim,\n      AwardsHallConstants.tileDim,\n      ImageAssets.awardsBackground.key\n    ).setOrigin(0, 0.25);\n    this.getLayerManager().addToLayer(Layer.Background, this.backgroundTile);\n\n    // Add banners\n    const banners = ['Achievements', 'Collectibles'];\n    const bannerPos = calcTableFormatPos({\n      direction: Direction.Column,\n      numOfItems: banners.length\n    });\n    banners.forEach((banner, index) => {\n      const bannerCont = this.createBanner(banner, bannerPos[index][1]);\n      this.getLayerManager().addToLayer(Layer.UI, bannerCont);\n    });\n\n    const leftArrow = createButton(this, {\n      assetKey: ImageAssets.chapterSelectArrow.key,\n      onDown: () => (this.isScrollLeft = true),\n      onUp: () => (this.isScrollLeft = false),\n      onOut: () => (this.isScrollLeft = false)\n    }).setPosition(screenCenter.x - AwardsHallConstants.arrow.xOffset, screenCenter.y);\n\n    const rightArrow = createButton(this, {\n      assetKey: ImageAssets.chapterSelectArrow.key,\n      onDown: () => (this.isScrollRight = true),\n      onUp: () => (this.isScrollRight = false),\n      onOut: () => (this.isScrollRight = false)\n    })\n      .setPosition(screenCenter.x + AwardsHallConstants.arrow.xOffset, screenCenter.y)\n      .setScale(-1, 1);\n\n    const backButton = new CommonBackButton(this, () => {\n      this.cleanUp();\n      this.scene.start('MainMenu');\n    });\n\n    this.getLayerManager().addToLayer(Layer.UI, leftArrow);\n    this.getLayerManager().addToLayer(Layer.UI, rightArrow);\n    this.getLayerManager().addToLayer(Layer.UI, backButton);\n  }\n\n  /**\n   * Render all the awards that student has.\n   */\n  private renderAwards() {\n    if (this.awardsContainer) this.awardsContainer.destroy();\n\n    this.awardsContainer = new Phaser.GameObjects.Container(this, 0, 0);\n\n    // Achievement\n    const achievements = this.getAwards(this.getUserStateManager().getAchievements());\n    const achievementsPos = calcTableFormatPos({\n      direction: Direction.Column,\n      numOfItems: achievements.length,\n      numItemLimit: AwardsHallConstants.maxAwardsPerCol,\n      redistributeLast: false,\n      maxXSpace: this.awardXSpace,\n      maxYSpace: AwardsHallConstants.award.ySpace\n    });\n\n    // Achievement is positioned on the upper half of the screen\n    this.awardsContainer.add(\n      achievements.map((achievement, index) =>\n        this.createAward(\n          achievement,\n          achievementsPos[index][0],\n          achievementsPos[index][1] + AwardsHallConstants.award.yStart - screenCenter.y\n        )\n      )\n    );\n\n    // Collectible\n    const collectibles = this.getAwards(this.getUserStateManager().getCollectibles());\n    const collectiblesPos = calcTableFormatPos({\n      direction: Direction.Column,\n      numOfItems: collectibles.length,\n      numItemLimit: AwardsHallConstants.maxAwardsPerCol,\n      redistributeLast: false,\n      maxXSpace: this.awardXSpace,\n      maxYSpace: AwardsHallConstants.award.ySpace\n    });\n\n    // Collectible is positioned on the lower half of the screen\n    this.awardsContainer.add(\n      collectibles.map((collectible, index) =>\n        this.createAward(\n          collectible,\n          collectiblesPos[index][0],\n          collectiblesPos[index][1] + AwardsHallConstants.award.yStart\n        )\n      )\n    );\n\n    this.getLayerManager().addToLayer(Layer.Objects, this.awardsContainer);\n  }\n\n  /**\n   * Fetch awardProps based on the type string[]\n   * @param keys\n   */\n  private getAwards(keys: string[]) {\n    const awardProps = getAwardProps(keys);\n    return awardProps;\n  }\n\n  /**\n   * Format the given award; giving it a pop up hover of its\n   * description, resize it to the correct size, and position it\n   * based on the given xPos and yPos.\n   *\n   * @param award awardProperty to be used\n   * @param xPos x position of the award\n   * @param yPos y position of the award\n   */\n  private createAward(award: AwardProperty, xPos: number, yPos: number) {\n    const awardCont = new Phaser.GameObjects.Container(this, xPos, yPos);\n\n    let image;\n    if (award.assetKey === Constants.nullInteractionId) {\n      // No asset is associated with the award\n      image = new Phaser.GameObjects.Rectangle(\n        this,\n        0,\n        0,\n        AwardsHallConstants.award.dim,\n        AwardsHallConstants.award.dim,\n        HexColor.darkBlue,\n        0.8\n      );\n      image.setInteractive();\n\n      const text = new Phaser.GameObjects.Text(\n        this,\n        0,\n        0,\n        award.title,\n        awardNoAssetTitleStyle\n      ).setOrigin(0.5, 0.5);\n      awardCont.add([image, text]);\n    } else {\n      image = new Phaser.GameObjects.Sprite(this, 0, 0, award.assetKey).setOrigin(0.5);\n      resizeUnderflow(image, AwardsHallConstants.award.dim, AwardsHallConstants.award.dim);\n      image.setInteractive({ pixelPerfect: true, useHandCursor: true });\n\n      awardCont.add(image);\n    }\n\n    // Add black tint if award is not completed\n    const blackTint = new Phaser.GameObjects.Rectangle(\n      this,\n      0,\n      0,\n      AwardsHallConstants.award.dim,\n      AwardsHallConstants.award.dim,\n      0\n    ).setAlpha(award.completed ? 0 : 0.8);\n    awardCont.add(blackTint);\n\n    // Set up the pop up\n    const hoverCont = createAwardsHoverContainer(this, award);\n    image.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER, () =>\n      hoverCont.setVisible(true)\n    );\n    image.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT, () =>\n      hoverCont.setVisible(false)\n    );\n    image.addListener(\n      Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,\n      (pointer: Phaser.Input.Pointer) => {\n        hoverCont.x = pointer.x + 10;\n        hoverCont.y = pointer.y - 10;\n      }\n    );\n\n    this.getLayerManager().addToLayer(Layer.UI, hoverCont);\n    return awardCont;\n  }\n\n  /**\n   * Clean up of related managers\n   */\n  private cleanUp() {\n    this.getInputManager().clearListeners();\n    this.getLayerManager().clearAllLayers();\n  }\n\n  /**\n   * Format the given text with banner style.\n   *\n   * In-game, this is the achievement & collectible banner\n   * that is positioned on the left hand side.\n   *\n   * @param text text to be put on the banner\n   * @param yPos y position of the banner\n   */\n  private createBanner(text: string, yPos: number) {\n    const bannerContainer = new Phaser.GameObjects.Container(this, 0, yPos);\n    const bannerBg = new Phaser.GameObjects.Sprite(\n      this,\n      AwardsHallConstants.banner.xOffset,\n      0,\n      ImageAssets.awardsPage.key\n    );\n    const bannerText = createBitmapText(\n      this,\n      text,\n      AwardsHallConstants.bannerTextConfig,\n      awardBannerTextStyle\n    );\n    bannerContainer.add([bannerBg, bannerText]);\n    return bannerContainer;\n  }\n\n  public getUserStateManager = () => SourceAcademyGame.getInstance().getUserStateManager();\n  public getInputManager = () => mandatory(this.inputManager);\n  public getLayerManager = () => mandatory(this.layerManager);\n}\n\nexport default AwardsHall;\n","import ImageAssets from '../../assets/ImageAssets';\nimport { AwardProperty } from '../../awards/GameAwardsTypes';\nimport { HexColor } from '../../utils/StyleUtils';\nimport {\n  awardHoverDescStyle,\n  awardHoverKeyStyle,\n  awardHoverTitleStyle,\n  AwardsHallConstants\n} from './AwardsHallConstants';\n\n/**\n * Create a pop up text that appear when user hover over an award.\n * The hover container will display information based on the award property;\n * e.g. its title, its asset-key, as well as its description.\n *\n * @param scene scene for the hover to attach to\n * @param award awardProperty to be used\n * @returns {Phaser.GameObjects.Container}\n */\nexport const createAwardsHoverContainer = (scene: Phaser.Scene, award: AwardProperty) => {\n  const hoverContainer = new Phaser.GameObjects.Container(scene, 0, 0);\n\n  const awardTitle = new Phaser.GameObjects.Text(scene, 20, 20, award.title, awardHoverTitleStyle);\n  const awardAssetKey = new Phaser.GameObjects.Text(\n    scene,\n    20,\n    awardTitle.getBounds().bottom + 20,\n    award.assetKey,\n    awardHoverKeyStyle\n  );\n  const awardDesc = new Phaser.GameObjects.Text(\n    scene,\n    20,\n    awardAssetKey.getBounds().bottom + 20,\n    award.description,\n    awardHoverDescStyle\n  );\n\n  const hoverTextBg = new Phaser.GameObjects.Rectangle(\n    scene,\n    0,\n    0,\n    AwardsHallConstants.awardInfo.width,\n    awardDesc.getBounds().bottom + 20,\n    HexColor.darkBlue\n  )\n    .setOrigin(0.0, 0.0)\n    .setAlpha(0.8);\n\n  const scrollFrameTop = new Phaser.GameObjects.Sprite(\n    scene,\n    AwardsHallConstants.awardInfo.width / 2,\n    0,\n    ImageAssets.scrollFrame.key\n  );\n  const scrollFrameBot = new Phaser.GameObjects.Sprite(\n    scene,\n    AwardsHallConstants.awardInfo.width / 2,\n    hoverTextBg.getBounds().bottom,\n    ImageAssets.scrollFrame.key\n  );\n\n  hoverContainer.add([hoverTextBg, awardTitle, awardDesc, scrollFrameTop, scrollFrameBot]);\n\n  // Only show asset key if award is completed\n  award.completed && hoverContainer.add(awardAssetKey);\n\n  hoverContainer.setVisible(false);\n  return hoverContainer;\n};\n","import FontAssets from '../../assets/FontAssets';\nimport { screenCenter } from '../../commons/CommonConstants';\nimport { BitmapFontStyle } from '../../commons/CommonTypes';\n\nexport const BindingConstants = {\n  keyTextConfig: { x: screenCenter.x - 100, y: 0, oriX: 0.5, oriY: 0.5 },\n  keyDescTextConfig: { x: screenCenter.x + 100, y: 0, oriX: 0.5, oriY: 0.5 },\n  key: { yStart: screenCenter.y * 0.9, yInterval: 150 },\n  icon: { x: screenCenter.x - 100 }\n};\n\nexport const keyStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 30,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nexport const keyDescStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 25,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n","import ImageAssets from '../../assets/ImageAssets';\nimport CommonBackButton from '../../commons/CommonBackButton';\nimport { screenCenter, screenSize } from '../../commons/CommonConstants';\nimport GameInputManager from '../../input/GameInputManager';\nimport GameLayerManager from '../../layer/GameLayerManager';\nimport { Layer } from '../../layer/GameLayerTypes';\nimport { mandatory } from '../../utils/GameUtils';\nimport { calcListFormatPos } from '../../utils/StyleUtils';\nimport { createBitmapText } from '../../utils/TextUtils';\nimport { BindingConstants, keyDescStyle, keyStyle } from './BindingsConstants';\n\n/**\n * Displays various bindings of the game.\n * Static scene.\n */\nclass Bindings extends Phaser.Scene {\n  public layerManager?: GameLayerManager;\n  public inputManager?: GameInputManager;\n\n  constructor() {\n    super('Bindings');\n  }\n\n  public init() {\n    this.layerManager = new GameLayerManager(this);\n    this.inputManager = new GameInputManager(this);\n  }\n\n  public create() {\n    this.renderBackground();\n    this.renderBindings();\n  }\n\n  /**\n   * Render the background of the scene\n   */\n  private renderBackground() {\n    const background = new Phaser.GameObjects.Image(\n      this,\n      screenCenter.x,\n      screenCenter.y,\n      ImageAssets.spaceshipBg.key\n    );\n    const blackOverlay = new Phaser.GameObjects.Rectangle(\n      this,\n      screenCenter.x,\n      screenCenter.y,\n      screenSize.x,\n      screenSize.y,\n      0\n    ).setAlpha(0.3);\n    this.getLayerManager().addToLayer(Layer.Background, background);\n    this.getLayerManager().addToLayer(Layer.Background, blackOverlay);\n  }\n\n  /**\n   * Render the various binding and add it to the scene.\n   */\n  private renderBindings() {\n    const bindingsContainer = new Phaser.GameObjects.Container(this, 0, 0);\n\n    const bindings = this.getBindings();\n    const bindingPositions = calcListFormatPos({\n      numOfItems: bindings.length,\n      xSpacing: 0,\n      ySpacing: BindingConstants.key.yInterval\n    });\n\n    bindingsContainer.add(\n      bindings.map((binding, index) =>\n        this.createBinding(\n          binding.key,\n          binding.text,\n          bindingPositions[index][0],\n          bindingPositions[index][1] + BindingConstants.key.yStart\n        )\n      )\n    );\n    const backButton = new CommonBackButton(this, () => {\n      this.getLayerManager().clearAllLayers();\n      this.scene.start('MainMenu');\n    });\n\n    this.getLayerManager().addToLayer(Layer.UI, bindingsContainer);\n    this.getLayerManager().addToLayer(Layer.UI, backButton);\n  }\n\n  /**\n   * Encapsulate information of the available bindings within the game.\n   */\n  private getBindings() {\n    return [\n      {\n        key: 'Esc',\n        text: 'Escape Menu'\n      },\n      {\n        key: 'Tab',\n        text: 'Dashboard'\n      }\n    ];\n  }\n\n  /**\n   * Formats the binding information and add it to the scene.\n   *\n   * @param key name of the keyboard key associated with the description\n   * @param desc description to be shown next to the binding\n   * @param xPos x position of the container\n   * @param yPos y position of the container\n   * @returns {Phaser.GameObjects.Container}\n   */\n  private createBinding(key: string, desc: string, xPos: number, yPos: number) {\n    const bindingContainer = new Phaser.GameObjects.Container(this, xPos, yPos);\n\n    // Different keys may use different key icon\n    const keyIcon = new Phaser.GameObjects.Sprite(\n      this,\n      BindingConstants.icon.x,\n      0,\n      ImageAssets.squareKeyboardIcon.key\n    );\n    switch (key) {\n      case 'Tab':\n        keyIcon.setTexture(ImageAssets.medKeyboardIcon.key);\n        break;\n      default:\n        break;\n    }\n\n    const keyText = createBitmapText(this, key, BindingConstants.keyTextConfig, keyStyle);\n    const keyDesc = createBitmapText(this, desc, BindingConstants.keyDescTextConfig, keyDescStyle);\n\n    bindingContainer.add([keyIcon, keyText, keyDesc]);\n    return bindingContainer;\n  }\n  public getInputManager = () => mandatory(this.inputManager);\n  public getLayerManager = () => mandatory(this.layerManager);\n}\n\nexport default Bindings;\n","import { AssetKey, AssetPath } from 'src/features/game/commons/CommonTypes';\n\n/**\n * The functions below loads assets, and and only resolves\n * once the assets are loaded.\n * If the assets have already been loaded previously,\n * then the promise is resolved instantly.\n *\n * To use these functions, call the line \"await loadImage(...)\"\n * inside an async function\n */\n\n/**\n * Waits for an image (with assetkey, assetpath) to load in scene\n *\n * @param scene scene where to load this asset\n * @param assetKey the key to be used\n * @param assetPath the path to the file\n * @returns {Promise} promise that resolves when image is loaded.\n */\nexport const loadImage = (scene: Phaser.Scene, assetKey: AssetKey, assetPath: AssetPath) =>\n  new Promise<AssetKey>(resolve => {\n    if (scene.textures.get(assetKey).key !== '__MISSING') {\n      resolve(assetKey);\n    } else {\n      scene.load.image(assetKey, assetPath);\n      scene.load.once(`filecomplete-image-${assetKey}`, resolve);\n      scene.load.once(`loaderror`, resolve);\n      scene.load.start();\n    }\n  });\n\n/**\n * Waits for a text (with assetkey, assetpath) to load in scene\n *\n * @param scene scene where to load this asset\n * @param assetKey the key to be used\n * @param assetPath the path to the file\n * @returns {Promise} promise that resolves when text is loaded.\n */\nexport const loadText = (scene: Phaser.Scene, assetKey: AssetKey, assetPath: AssetPath) =>\n  new Promise<AssetKey>(resolve => {\n    if (scene.cache.text.exists(assetKey)) {\n      resolve(assetKey);\n    } else {\n      scene.load.text(assetKey, assetPath);\n      scene.load.once(`filecomplete-text-${assetKey}`, resolve);\n      scene.load.start();\n    }\n  });\n\n/**\n * Waits for a sound (with assetkey, assetpath) to load in scene\n *\n * @param scene scene where to load this asset\n * @param assetKey the key to be used\n * @param assetPath the path to the file\n * @returns {Promise} promise that resolves when sound is loaded.\n */\nexport const loadSound = (scene: Phaser.Scene, assetKey: AssetKey, assetPath: AssetPath) =>\n  new Promise<AssetKey>(resolve => {\n    if (scene.sound.get(assetKey) !== null) {\n      resolve(assetKey);\n    } else {\n      scene.load.audio(assetKey, assetPath).on('filecomplete', resolve);\n      scene.load.start();\n    }\n  });\n\n/**\n * Waits for an spritesheet (with assetkey, assetpath, and config) to load in scene\n *\n * @param scene scene where to load this asset\n * @param assetKey the key to be used\n * @param assetPath the path to the file\n * @param config spritesheet config\n * @returns {Promise} promise that resolves when spritesheet is loaded.\n */\nexport const loadSpritesheet = (\n  scene: Phaser.Scene,\n  assetKey: AssetKey,\n  assetPath: AssetPath,\n  config: any\n) =>\n  new Promise<AssetKey>(resolve => {\n    if (scene.textures.get(assetKey).key !== '__MISSING') {\n      resolve(assetKey);\n    } else {\n      scene.load.spritesheet(assetKey, assetPath, config);\n      scene.load.once(`filecomplete-spritesheet-${assetKey}`, resolve);\n      scene.load.once(`loaderror`, resolve);\n      scene.load.start();\n    }\n  });\n","import FontAssets from '../../assets/FontAssets';\nimport { screenCenter, screenSize } from '../../commons/CommonConstants';\nimport { BitmapFontStyle } from '../../commons/CommonTypes';\n\nexport const chapterIndexStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 25,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nexport const chapterTitleStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 30,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nexport const pageNumberStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 25,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\n// These are the original chapter preview image and frame dimensions\nconst originalImageRectWidth = 500;\nconst originalImageRectHeight = 700;\n// Use these to change the size of each chapter's image and frame\nconst imageScaleX = 0.8;\nconst imageScaleY = 0.4;\n\nconst chapPerRow = 3;\nconst chapPerCol = 3;\n\nconst chapConstants = {\n  arrow: { xOffset: 875 },\n  buttons: { scale: 0.65 },\n  resetButton: { xOffset: 135, yOffset: 85 },\n  playButton: { xOffset: 55, yOffset: 85 },\n  frame: { xOffset: 15 * imageScaleX, yOffset: -10 * imageScaleY },\n  scrollSpeed: 100,\n  indexTextConfig: { x: 0, y: -110, oriX: 0.5, oriY: 0.5 },\n  titleTextConfig: { x: 0, y: -50, oriX: 0.5, oriY: 0.5 },\n  pageNumberTextConfig: { x: screenCenter.x, y: screenSize.y - 30, oriX: 0.5, oriY: 0.5 },\n  imageRect: {\n    width: originalImageRectWidth * imageScaleX,\n    height: originalImageRectHeight * imageScaleY\n  },\n  imageScale: {\n    x: imageScaleX,\n    y: imageScaleY\n  },\n  chapComplete: {\n    y: 10,\n    height: 30,\n    text: 'Chapter Completed'\n  },\n  grid: {\n    chapPerRow,\n    chapPerCol,\n    chapPerPage: chapPerRow * chapPerCol,\n    chapGapX: 50,\n    chapGapY: 50\n  }\n};\n\nexport default chapConstants;\n","import { toS3Path } from '../utils/GameUtils';\n\nexport const toTxtPath = (path: string) => toS3Path(`/stories/${path}`, true);\n\nconst TextAssets = {\n  defaultCheckpoint: { key: 'default-chap', path: toTxtPath('defaultCheckpoint.txt') },\n  awardsMapping: { key: 'awards-mapping', path: toTxtPath('awardsMapping.txt') },\n  roomPreviewMapping: { key: 'room-prev-mapping', path: toTxtPath('roomPreviewMapping.txt') }\n};\n\nexport const MockTextAssets = {\n  defaultCheckpoint: { key: 'mock-default-chap', path: '../../assets/mockDefaultCheckpoint.txt' },\n  awardsMapping: { key: 'mock-awards-mapping', path: '../../assets/mockAwardsMapping.txt' },\n  roomPreviewMapping: {\n    key: 'mock-room-prev-mapping',\n    path: '../../assets/mockRoomPreviewMapping.txt'\n  }\n};\n\nexport default TextAssets;\n","import { GameAction } from '../action/GameActionTypes';\nimport { ImageAsset, SoundAsset } from '../assets/AssetsTypes';\nimport { BBoxProperty } from '../boundingBoxes/GameBoundingBoxTypes';\nimport { Character } from '../character/GameCharacterTypes';\nimport { AssetKey, ItemId } from '../commons/CommonTypes';\nimport { Dialogue } from '../dialogue/GameDialogueTypes';\nimport { GameMode } from '../mode/GameModeTypes';\nimport { ObjectProperty } from '../objects/GameObjectTypes';\nimport { mandatory } from '../utils/GameUtils';\nimport { AnyId, GameItemType, GameLocation, LocationId } from './GameMapTypes';\n\n/**\n * Game map is the class that encapsulates data about\n * all the locations and items in the map in a checkpoint\n *\n * Mainly used by game checkpoint.\n *\n * All possible assets should be stored within the soundAssets\n * and mapAssets; while mapping from ItemId to other properties\n * are stored separately.\n *\n * Lastly, the GameLocation should only refer to the ItemIDs,\n * and not the actual property.\n *\n * GameManager, along other managers, will process this class\n * as when as its needed.\n */\nclass GameMap {\n  private soundAssets: SoundAsset[];\n  private mapAssets: Map<AssetKey, ImageAsset>;\n  private locations: Map<LocationId, GameLocation>;\n  private dialogues: Map<ItemId, Dialogue>;\n  private objects: Map<ItemId, ObjectProperty>;\n  private boundingBoxes: Map<ItemId, BBoxProperty>;\n  private characters: Map<ItemId, Character>;\n  private actions: Map<ItemId, GameAction>;\n  private gameStartActions: ItemId[];\n  private checkpointCompleteActions: ItemId[];\n\n  constructor() {\n    this.soundAssets = [];\n    this.mapAssets = new Map<AssetKey, ImageAsset>();\n\n    this.locations = new Map<LocationId, GameLocation>();\n    this.dialogues = new Map<ItemId, Dialogue>();\n    this.objects = new Map<ItemId, ObjectProperty>();\n    this.boundingBoxes = new Map<ItemId, BBoxProperty>();\n    this.characters = new Map<ItemId, Character>();\n    this.actions = new Map<ItemId, GameAction>();\n\n    this.gameStartActions = [];\n    this.checkpointCompleteActions = [];\n  }\n\n  public addSoundAsset(soundAsset: SoundAsset) {\n    this.soundAssets.push(soundAsset);\n  }\n\n  public addMapAsset(assetKey: AssetKey, imageAsset: ImageAsset) {\n    this.mapAssets.set(assetKey, imageAsset);\n  }\n\n  public getMapAssets(): Map<AssetKey, ImageAsset> {\n    return this.mapAssets;\n  }\n\n  public addLocation(locationId: LocationId, location: GameLocation): void {\n    this.locations.set(locationId, location);\n  }\n\n  public setModesAt(id: LocationId, modes: GameMode[]) {\n    this.getLocationAtId(id).modes = new Set(modes);\n  }\n\n  public setNavigationFrom(id: LocationId, navigation: string[]) {\n    this.getLocationAtId(id).navigation = new Set(navigation);\n  }\n\n  public getNavigationFrom(id: LocationId): Set<string> | undefined {\n    return this.getLocationAtId(id).navigation;\n  }\n\n  public setGameStartActions(actionIds: ItemId[]) {\n    this.gameStartActions = actionIds;\n  }\n\n  public setCheckpointCompleteActions(actionIds: ItemId[]) {\n    this.checkpointCompleteActions = actionIds;\n  }\n\n  public getGameStartActions() {\n    return this.gameStartActions;\n  }\n\n  public getCheckpointCompleteActions() {\n    return this.checkpointCompleteActions;\n  }\n\n  public getLocations(): Map<LocationId, GameLocation> {\n    return this.locations;\n  }\n\n  public getObjectPropMap(): Map<ItemId, ObjectProperty> {\n    return this.objects;\n  }\n\n  public getBBoxPropMap(): Map<ItemId, BBoxProperty> {\n    return this.boundingBoxes;\n  }\n\n  public getDialogueMap(): Map<ItemId, Dialogue> {\n    return this.dialogues;\n  }\n\n  public getCharacterMap(): Map<ItemId, Character> {\n    return this.characters;\n  }\n\n  public getActionMap(): Map<ItemId, GameAction> {\n    return this.actions;\n  }\n\n  public getSoundAssets(): SoundAsset[] {\n    return this.soundAssets;\n  }\n\n  public setItemInMap(gameItemType: GameItemType, itemId: string, item: any) {\n    this[gameItemType].set(itemId, item);\n  }\n\n  public addItemToLocation(locId: LocationId, gameItemType: GameItemType, itemId: string) {\n    this.getLocationAtId(locId)[gameItemType].add(itemId);\n  }\n\n  public setBGMusicAt(locId: LocationId, soundKey: AssetKey) {\n    this.getLocationAtId(locId).bgmKey = soundKey;\n  }\n\n  public getLocationAtId = (locId: LocationId) =>\n    mandatory(this.locations.get(locId), `Location ${locId} was not found!`);\n\n  public getAssetByKey = (key: AssetKey) =>\n    mandatory(this.mapAssets.get(key), `Asset ${key} not found!`);\n\n  public getLocationIds(): LocationId[] {\n    return Array.from(this.locations.keys());\n  }\n\n  public getAssetKeyFromId(id: AnyId): AssetKey {\n    return mandatory(\n      this.objects.get(id)?.assetKey || this.locations.get(id)?.assetKey,\n      `Id ${id} not found!`\n    );\n  }\n}\n\nexport default GameMap;\n","/**\n * The class encapsulates data on all the objective ids\n * thatplayers must complete and keeps track of which\n * objectives have already been completed.\n *\n * One of the components of game checkpoint.\n */\nclass GameObjective {\n  private objective: Map<string, boolean>;\n  private totalNumOfObjectives: number;\n  private numOfCompletedObjectives: number;\n\n  constructor() {\n    this.objective = new Map<string, boolean>();\n    this.totalNumOfObjectives = 0;\n    this.numOfCompletedObjectives = 0;\n  }\n\n  /**\n   * Set an objective to a boolean value.\n   *\n   * @param key key of the objective\n   * @param value boolean value to set to\n   */\n  public setObjective(key: string, value: boolean): void {\n    const prevState = this.objective.get(key);\n    this.objective.set(key, value);\n    // Handle repeated calls\n    if (prevState !== undefined && prevState !== value) {\n      this.numOfCompletedObjectives++;\n    }\n  }\n\n  /**\n   * Add an objective tied to the given string.\n   *\n   * @param key key of the objective\n   */\n  public addObjective(key: string): void {\n    this.objective.set(key, false);\n    this.totalNumOfObjectives++;\n  }\n\n  /**\n   * Add multiple objectives.\n   *\n   * @param keys objective keys\n   */\n  public addObjectives(keys: string[]): void {\n    keys.forEach(key => this.addObjective(key));\n  }\n\n  /**\n   * Check whether all the objectives are complete.\n   */\n  public isAllComplete(): boolean {\n    return this.numOfCompletedObjectives >= this.totalNumOfObjectives;\n  }\n\n  /**\n   * Check the state of a specific objective.\n   * If objective is not present, will return undefined instead.\n   *\n   * @param key key of the objective\n   */\n  public getObjectiveState(key: string): boolean {\n    const objState = this.objective.get(key);\n    if (objState === undefined) {\n      throw new Error(`Cannot find objective with the given task id \"${key}\"`);\n    }\n    return objState;\n  }\n\n  /**\n   * Returns all the objectives.\n   */\n  public getObjectives() {\n    return this.objective;\n  }\n\n  /**\n   * Set the objective to the given parameter directly.\n   *\n   * @param objective map of objective keys(string) to its value (boolean)\n   */\n  public setObjectives(objective: Map<string, boolean>) {\n    this.objective = objective;\n  }\n}\n\nexport default GameObjective;\n","import { TaskDetail } from './GameTaskTypes';\n\n/**\n * The class encapsulates data on all the task ids\n * thatplayers can optionally complete, and keeps track of\n * which tasks have already been completed.\n *\n * One of the components of game checkpoint.\n */\nclass GameTask {\n  private tasks: Map<string, boolean>;\n  private taskDetails: Map<string, TaskDetail>;\n\n  constructor() {\n    this.tasks = new Map<string, boolean>();\n    this.taskDetails = new Map<string, TaskDetail>();\n  }\n\n  /**\n   * Set a task to a boolean value.\n   *\n   * @param key key of the task\n   * @param value boolean value to set to\n   *\n   */\n  public setTask(key: string, value: boolean): void {\n    this.tasks.set(key, value);\n  }\n\n  /**\n   * Indicate that the players should be able to see this task.\n   *\n   * @param key key of the task\n   */\n  public showTask(key: string): void {\n    const prevDetail = this.taskDetails.get(key);\n\n    // Handle repeated calls\n    if (prevDetail !== undefined) {\n      const newDetail: TaskDetail = {\n        ...prevDetail,\n        visible: true\n      };\n      this.taskDetails.set(key, newDetail);\n    }\n  }\n\n  /**\n   * Add a task tied to the given string.\n   *\n   * @param task the new task containing the task id (key) and task data\n   */\n  public addTask(newTask: TaskDetail): void {\n    const key = newTask.taskId;\n    this.tasks.set(key, false);\n    this.taskDetails.set(key, newTask);\n  }\n\n  /**\n   * Add multiple tasks.\n   *\n   * @param newTasks an array of tasks, each containing a task id (key) and task detail\n   */\n  public addTasks(newTasks: TaskDetail[]): void {\n    newTasks.forEach(task => this.addTask(task));\n  }\n\n  /**\n   * Check the state of a specific task.\n   * If task is not present, will return undefined instead.\n   *\n   * @param key key of the task\n   */\n  public getTaskState(key: string): boolean {\n    const taskState = this.tasks.get(key);\n    if (taskState === undefined) {\n      throw new Error(`Cannot find task with the given task id \"${key}\"`);\n    }\n    return taskState;\n  }\n\n  /**\n   * Retrieve the data of a specific task.\n   * If task is not present, will return undefined instead.\n   *\n   * @param key key of the task\n   */\n  public getTaskDetail(key: string): TaskDetail {\n    const taskDetail = this.taskDetails.get(key);\n    if (taskDetail === undefined) {\n      throw new Error(`Cannot find task with the given task id \"${key}\"`);\n    }\n    return taskDetail;\n  }\n\n  /**\n   * Returns all the tasks.\n   */\n  public getAllTasks(): Map<string, boolean> {\n    return this.tasks;\n  }\n\n  /**\n   * Returns all incomplete tasks.\n   */\n  public getAllIncompleteTasks(): Array<string> {\n    const incompleteTasks: Array<string> = new Array<string>();\n    for (const key of this.tasks.keys()) {\n      if (!this.tasks.get(key) && this.taskDetails.get(key)?.visible) {\n        incompleteTasks.push(key);\n      }\n    }\n    return incompleteTasks;\n  }\n\n  /**\n   * Returns all the task data, including the task id, title, description, and the state.\n   */\n  public getAllVisibleTaskData(): Array<[TaskDetail, boolean]> {\n    const allVisibleTask: Array<[TaskDetail, boolean]> = new Array<[TaskDetail, boolean]>();\n    for (const key of this.tasks.keys()) {\n      const taskState = this.getTaskState(key);\n      const taskDetail = this.getTaskDetail(key);\n      if (taskState !== undefined && taskDetail !== undefined && taskDetail.visible) {\n        allVisibleTask.push([taskDetail, taskState]);\n      }\n    }\n    return allVisibleTask;\n  }\n}\n\nexport default GameTask;\n","import { GameActionType } from '../action/GameActionTypes';\nimport { GamePosition, GameSize } from '../commons/CommonTypes';\nimport { GameItemType } from '../location/GameMapTypes';\nimport { GameMode } from '../mode/GameModeTypes';\nimport { GameStateStorage, UserStateType } from '../state/GameStateTypes';\nimport { mandatory } from '../utils/GameUtils';\n\nconst stringToSizeMap = {\n  small: GameSize.Small,\n  medium: GameSize.Medium,\n  large: GameSize.Large\n};\n\nconst stringToPositionMap = {\n  left: GamePosition.Left,\n  middle: GamePosition.Middle,\n  right: GamePosition.Right\n};\n\nconst stringToGameModeMap = {\n  talk: GameMode.Talk,\n  explore: GameMode.Explore,\n  move: GameMode.Move,\n  menu: GameMode.Menu\n};\n\nconst stringToGameItemMap = {\n  navigation: GameItemType.navigation,\n  talkTopics: GameItemType.talkTopics,\n  objects: GameItemType.objects,\n  boundingBoxes: GameItemType.boundingBoxes,\n  characters: GameItemType.characters,\n  actions: GameItemType.actions,\n  bgmKey: GameItemType.bgmKey,\n  collectibles: GameItemType.collectibles\n};\n\nconst stringToActionTypeMap = {\n  move_character: GameActionType.MoveCharacter,\n  update_character: GameActionType.UpdateCharacter,\n  obtain_collectible: GameActionType.ObtainCollectible,\n  complete_objective: GameActionType.CompleteObjective,\n  complete_task: GameActionType.CompleteTask,\n  show_task: GameActionType.ShowTask,\n  add_item: GameActionType.AddItem,\n  remove_item: GameActionType.RemoveItem,\n  change_background: GameActionType.ChangeBackground,\n  start_animation: GameActionType.StartAnimation,\n  stop_animation: GameActionType.StopAnimation,\n  show_dialogue: GameActionType.ShowDialogue,\n  add_mode: GameActionType.AddLocationMode,\n  remove_mode: GameActionType.RemoveLocationMode,\n  add_popup: GameActionType.AddPopup,\n  make_object_glow: GameActionType.MakeObjectGlow,\n  make_object_blink: GameActionType.MakeObjectBlink,\n  play_bgm: GameActionType.PlayBGM,\n  play_sfx: GameActionType.PlaySFX,\n  preview_location: GameActionType.PreviewLocation,\n  show_object_layer: GameActionType.ShowObjectLayer,\n  navigate_to_assessment: GameActionType.NavigateToAssessment,\n  update_assessment_status: GameActionType.UpdateAssessmentStatus,\n  delay: GameActionType.Delay\n};\n\nconst stringToGameStateStorageMap = {\n  checklist: GameStateStorage.ChecklistState,\n  tasklist: GameStateStorage.TasklistState,\n  userstate: GameStateStorage.UserState\n};\n\nconst stringToUserStateTypeMap = {\n  assessments: UserStateType.assessments,\n  achievements: UserStateType.achievements,\n  collectibles: UserStateType.collectibles\n};\n\n/**\n * This class is in charge of converting strings from\n * the txt into enums that can be stored in the Checkpoint\n * object, which can be read and played by the game engine.\n *\n * This also acts as a validity checker to ensure that\n * strings such as action types (eg 'show_dialogue') and\n * game modes (eg 'explore') are actually valid enums\n */\nexport default class ParserConverter {\n  public static stringToSize(str: string) {\n    return stringToSizeMap[str] || GameSize.Medium;\n  }\n\n  public static stringToPosition(str: string) {\n    return stringToPositionMap[str] || GamePosition.Middle;\n  }\n\n  public static stringToGameMode(str: string) {\n    return mandatory(stringToGameModeMap[str], `Invalid location mode, ${str}`);\n  }\n\n  public static stringToActionType(str: string) {\n    return mandatory(stringToActionTypeMap[str], `Invalid action type, ${str}`);\n  }\n\n  public static stringToGameStateStorage(str: string) {\n    return mandatory(stringToGameStateStorageMap[str], `Invalid condition type, ${str}`);\n  }\n\n  public static stringToGameItemType(str: string) {\n    return mandatory(stringToGameItemMap[str], `Invalid entity type, ${str}`);\n  }\n\n  public static stringToBoolean(str: string) {\n    return str === 'false' ? false : true;\n  }\n\n  public static stringToUserStateType(str: string) {\n    return mandatory(stringToUserStateTypeMap[str], `Invalid user state type ${str}`);\n  }\n}\n","import { ItemId } from '../commons/CommonTypes';\nimport { GameItemType } from '../location/GameMapTypes';\nimport { GameSoundType } from '../sound/GameSoundTypes';\nimport Parser from './Parser';\n\nexport enum GameEntityType {\n  locations = 'locations',\n  objectives = 'objectives',\n  tasks = 'tasks',\n  bgms = 'bgms',\n  sfxs = 'sfxs'\n}\n\ntype AssertionDetail = {\n  itemId: string;\n  actionType?: string;\n};\n\n/**\n * Parser Validator has two functions:\n *\n * A. Duplicate ID checker\n * Asserts that there are no duplicated IDs in the text file\n *\n * Implementation: Keep a set of IDs declared.\n * As IDs are added onto the set, check and throw error if ID\n * is added twice onto the set.\n *\n * B. Type assertion manager\n * Assert that all the IDs used are declared somewhere in the text file.\n *\n * e.g.\n * Say make_object_glow(door) is called\n * Since make_object_glow takes in an Object Id as parameter,\n * we assert that \"door\" is an Object ID declared in the text.\n *\n * Implementation: Store all the assertions by type when ID is used.\n * At the end of the parsing process, verify that all type assertions exist\n * by counterchecking with items in the Checkpoint Object.\n *\n * Note the two types of assertions:\n * Game item assertions - Item ID e.g. Dialogue, Object, Bbox, Character, Action, Award\n * Game entity assertions - Entity ID e.g. Location, Bgm, Sfx, Objectives\n */\nexport default class ParserValidator {\n  private gameItemAsserts: Map<GameItemType, AssertionDetail[]>;\n  private gameEntityAsserts: Map<GameEntityType, AssertionDetail[]>;\n  private gameAnimAsserts: AssertionDetail[];\n  private gameAnimMaps = [\n    // Game Locations Map\n    Parser.checkpoint.map.getLocations(),\n    // Game Object Prop Map\n    Parser.checkpoint.map[GameItemType.objects]\n  ];\n  private allItemIds: Set<string>;\n\n  constructor() {\n    this.gameItemAsserts = new Map<GameItemType, AssertionDetail[]>();\n    this.gameEntityAsserts = new Map<GameEntityType, AssertionDetail[]>();\n    this.gameAnimAsserts = [];\n    this.allItemIds = new Set();\n  }\n\n  ////////////////////////////\n  //  Duplicate ID Checker  //\n  ////////////////////////////\n\n  /**\n   * We register item id to check for possible duplicates\n   * with other item ids.\n   *\n   * @param {string} id an object ID e.g. ItemId / Location ID / Objective ID / BGM ID / SFX ID\n   */\n  public registerId(id: string) {\n    if (this.allItemIds.has(id)) {\n      throw new Error(`Duplicate item id ${id}`);\n    }\n    this.allItemIds.add(id);\n  }\n\n  /////////////////////////////\n  //  Type assertion manager //\n  /////////////////////////////\n\n  public verifyAssertions() {\n    this.verifyGameItemAssert();\n    this.verifyGameEntityAsserts();\n    this.verifyGameAnimAsserts();\n  }\n\n  //////////////////////////////////////////////\n  //  Type assertion manager - Game Item Type //\n  //////////////////////////////////////////////\n\n  /**\n   * This function stores game item type assertions.\n   *\n   * @param gameItemType the attribute that the itemId needs to be\n   * @param itemId the itemId that needs to be checked for validity\n   * @param actionType action type e.g. make_object_glow if the assertion\n   *                   was made while parsing an action\n   */\n  public assertItemType(gameItemType: GameItemType, itemId: ItemId, actionType?: string) {\n    if (gameItemType === GameItemType.talkTopics) {\n      gameItemType = GameItemType.dialogues;\n    } else if (gameItemType === GameItemType.navigation) {\n      gameItemType = GameItemType.locations;\n    }\n    if (!this.gameItemAsserts.get(gameItemType)) {\n      this.gameItemAsserts.set(gameItemType, []);\n    }\n    this.gameItemAsserts.get(gameItemType)!.push({ itemId, actionType });\n  }\n\n  /**\n   * This function verifies all game item type assertions,\n   * ensuring that each ID used belongs to the correct type.\n   */\n  private verifyGameItemAssert() {\n    this.gameItemAsserts.forEach(\n      (assertionDetails: AssertionDetail[], gameItemType: GameItemType) => {\n        assertionDetails.forEach((assertionDetail: AssertionDetail) => {\n          const { itemId, actionType } = assertionDetail;\n          if (!Parser.checkpoint.map[gameItemType].has(itemId)) {\n            if (actionType) {\n              this.actionAssertionError(itemId, gameItemType, actionType);\n            }\n            throw new Error(`Cannot find id \"${itemId}\" under ${gameItemType} entity type`);\n          }\n        });\n      }\n    );\n  }\n\n  /**\n   * Similar to assert item type, but used for asserting multiple game item types at once.\n   *\n   * @param gameItemType item type that the ID must be\n   * @param itemIds item IDs of the item to assert\n   * @param actionType action type e.g. make_object_glow if the assertion\n   *                   was made while parsing an action\n   */\n  public assertItemTypes(gameItemType: GameItemType, itemIds: string[], actionType?: string) {\n    itemIds.forEach(itemId => this.assertItemType(gameItemType, itemId, actionType));\n  }\n\n  ////////////////////////////////////////////////\n  //  Type assertion manager - Game Entity Type //\n  ////////////////////////////////////////////////\n\n  /**\n   * This function stores game entity type assertions.\n   * ensures that 'room' is of locations type.\n   *\n   * @param gameEntityType the attribute that the id needs to be\n   * @param id the itemId that needs to be checked for validity\n   * @param actionType action type e.g. make_object_glow if the assertion\n   *                   was made while parsing an action\n   */\n  public assertEntityType(gameEntityType: GameEntityType, id: string, actionType?: string) {\n    if (!this.gameEntityAsserts.get(gameEntityType)) {\n      this.gameEntityAsserts.set(gameEntityType, []);\n    }\n    this.gameEntityAsserts.get(gameEntityType)!.push({ itemId: id, actionType });\n  }\n\n  /**\n   * This function verifies game entity assertions that have been stored.\n   * ensures that 'room' is of locations type.\n   *\n   * @param gameEntityType the attribute that the id needs to be\n   * @param id the itemId that needs to be checked for validity\n   * @param actionType action type e.g. make_object_glow if the assertion\n   *                   was made while parsing an action\n   */\n  private verifyGameEntityAsserts() {\n    this.gameEntityAsserts.forEach(\n      (assertionDetails: AssertionDetail[], gameEntityType: GameEntityType) => {\n        assertionDetails.forEach((assertionDetail: AssertionDetail) => {\n          const { itemId, actionType } = assertionDetail;\n          switch (gameEntityType) {\n            case GameEntityType.locations:\n              Parser.checkpoint.map.getLocationAtId(itemId);\n              break;\n\n            case GameEntityType.objectives:\n              if (Parser.checkpoint.objectives.getObjectives().get(itemId) === undefined) {\n                if (actionType) {\n                  this.actionAssertionError(itemId, gameEntityType, actionType);\n                }\n                throw new Error(`Cannot find objective id \"${itemId}\"`);\n              }\n              break;\n\n            case GameEntityType.tasks:\n              if (Parser.checkpoint.tasks.getAllTasks().get(itemId) === undefined) {\n                if (actionType) {\n                  this.actionAssertionError(itemId, gameEntityType, actionType);\n                }\n                throw new Error(`Cannot find task id \"${itemId}\"`);\n              }\n              break;\n\n            case GameEntityType.bgms:\n              const numberOfBgm = Parser.checkpoint.map\n                .getSoundAssets()\n                .filter(\n                  sound => sound.soundType === GameSoundType.BGM && sound.key === itemId\n                ).length;\n              if (numberOfBgm === 0) {\n                throw new Error(`Cannot find bgm key \"${itemId}\"`);\n              } else if (numberOfBgm > 1) {\n                throw new Error(`More than 1 bgm key \"${itemId}\"`);\n              }\n              break;\n\n            case GameEntityType.sfxs:\n              const numberOfSfx = Parser.checkpoint.map\n                .getSoundAssets()\n                .filter(\n                  sound => sound.soundType === GameSoundType.SFX && sound.key === itemId\n                ).length;\n              if (numberOfSfx === 0) {\n                throw new Error(`Cannot find sfx key \"${itemId}\"`);\n              } else if (numberOfSfx > 1) {\n                throw new Error(`More than 1 sfx key \"${itemId}\"`);\n              }\n              break;\n          }\n        });\n      }\n    );\n  }\n\n  //////////////////////////////////////////////\n  //  Type assertion manager - Game Anim Type //\n  //////////////////////////////////////////////\n\n  /**\n   * This function stores game anim type assertions.\n   *\n   * @param itemId id of item that needs to be checked\n   * @param actionType action type e.g. start_animation\n   */\n  public assertAnimType(itemId: ItemId, actionType: string) {\n    this.gameAnimAsserts.push({ itemId, actionType });\n  }\n\n  /**\n   * This function verifies game entity assertions that have\n   * been stored, by ensuring that the itemIds are declared\n   * in at least one of the animation types.\n   */\n  private verifyGameAnimAsserts() {\n    this.gameAnimAsserts.forEach((assertionDetail: AssertionDetail) => {\n      const { itemId, actionType } = assertionDetail;\n      let idFound = false;\n      this.gameAnimMaps.forEach(map => {\n        if (map.get(itemId)) {\n          idFound = true;\n        }\n      });\n      if (!idFound) {\n        this.actionAssertionError(itemId, 'locationId or itemId', actionType!);\n      }\n    });\n  }\n\n  private actionAssertionError(itemId: string, attribute: string, actionType: string) {\n    throw new Error(\n      `Expected type of \"${attribute}\" as argument for \"${actionType}\", obtained \"${itemId}\" which is either undefined or the wrong id.`\n    );\n  }\n}\n","import { ActionCondition } from '../action/GameActionTypes';\nimport { GameStateStorage } from '../state/GameStateTypes';\nimport StringUtils from '../utils/StringUtils';\nimport Parser from './Parser';\nimport ParserConverter from './ParserConverter';\nimport { GameEntityType } from './ParserValidator';\n\n/**\n * This parser is in charge of parsing conditionals\n */\nexport default class ConditionParser {\n  /**\n   * This function creates an ActionCondition object, given a condition string\n   *\n   * @param conditionDetails A conditional string such as \"!if userstate.assessments.301\"\n   * @returns {ActionCondition} encapsulating the information on the conditional\n   */\n  public static parse(conditionDetails: string): ActionCondition {\n    const hasExclamation = conditionDetails[0] === '!';\n    if (hasExclamation) {\n      conditionDetails = conditionDetails.slice(1);\n    }\n    const [gameStateStorage, ...condParams] = StringUtils.splitByChar(conditionDetails, '.');\n    switch (ParserConverter.stringToGameStateStorage(gameStateStorage)) {\n      case GameStateStorage.ChecklistState:\n        Parser.validator.assertEntityType(GameEntityType.objectives, condParams[0]);\n        return {\n          state: GameStateStorage.ChecklistState,\n          conditionParams: {\n            id: condParams[0]\n          },\n          boolean: !hasExclamation\n        };\n\n      case GameStateStorage.TasklistState:\n        Parser.validator.assertEntityType(GameEntityType.tasks, condParams[0]);\n        return {\n          state: GameStateStorage.TasklistState,\n          conditionParams: {\n            id: condParams[0]\n          },\n          boolean: !hasExclamation\n        };\n\n      case GameStateStorage.UserState:\n        return {\n          state: GameStateStorage.UserState,\n          conditionParams: {\n            userStateType: ParserConverter.stringToUserStateType(condParams[0]),\n            id: condParams[1]\n          },\n          boolean: !hasExclamation\n        };\n      default:\n        throw new Error('Parsing error: Invalid condition param');\n    }\n  }\n}\n","import { GameAction, GameActionType } from '../action/GameActionTypes';\nimport { ItemId } from '../commons/CommonTypes';\nimport { GameItemType } from '../location/GameMapTypes';\nimport StringUtils from '../utils/StringUtils';\nimport ConditionParser from './ConditionParser';\nimport Parser from './Parser';\nimport ParserConverter from './ParserConverter';\nimport { GameEntityType } from './ParserValidator';\n\n/**\n * The Action Parser parses actions for all entities.\n * This class takes in action strings to produce GameAction objects,\n * which store information about action type and\n * action params (much like React actions)\n */\nexport default class ActionParser {\n  /**\n   * Parses many action strings, stores resulting Game Action objects\n   * inside the game map, and returns the corresponding actionIds.\n   *\n   * @param fullActionStrings raw action strings, eg [\"show_dialogue(done)\", \"change_location(room) if gamestate.finish\"]\n   * @returns {Array<ItemId>} returns actionIds of the parsed actions with actions are stored in the game map.\n   */\n  public static parseActions(fullActionStrings: string[]): ItemId[] {\n    return fullActionStrings.map(fullActionString => this.parseAction(fullActionString));\n  }\n\n  /**\n   * Parses an action string, stores resulting Game Action object\n   * inside the game map, and returns the corresponding actionId.\n   *\n   * @param rawActionString raw action string eg \"show_dialogue(done) if gamestate.finish\"\n   * @returns {ItemId} returns actionId of the parsed actions, as action is stored in the game map.\n   */\n  public static parseAction(rawActionString: string): ItemId {\n    const [actionString, conditionalsString] = StringUtils.splitByChar(rawActionString, 'if');\n\n    const gameAction = this.parseActionContent(actionString);\n    if (conditionalsString) {\n      gameAction.actionConditions = StringUtils.splitByChar(conditionalsString, 'AND').map(\n        condition => ConditionParser.parse(condition)\n      );\n    }\n\n    Parser.checkpoint.map.setItemInMap(GameItemType.actions, gameAction.interactionId, gameAction);\n\n    return gameAction.interactionId;\n  }\n\n  /**\n   * This funciton converts action strings eg \"show_dialogue(hello)\"\n   * (excluding conditionals) into Game Action objects\n   *\n   * Note that this function also validates the parameters to make\n   * sure that they are used correctly.\n   *\n   * @param actionString the action string to be parsed\n   * @returns {GameAction} resulting action that can be stored in the game map\n   */\n  public static parseActionContent(actionString: string): GameAction {\n    const [action, actionParamString] = StringUtils.splitByChar(actionString, '(');\n    let repeatable = false;\n    let actionType = action;\n    if (action[action.length - 1] === '*') {\n      repeatable = true;\n      actionType = actionType.slice(0, -1);\n    }\n\n    const gameActionType = ParserConverter.stringToActionType(actionType);\n    const actionParams = StringUtils.splitByChar(actionParamString.slice(0, -1), ',');\n    const actionParamObj: any = {};\n\n    switch (gameActionType) {\n      case GameActionType.ObtainCollectible:\n        actionParamObj.id = actionParams[0];\n        break;\n\n      case GameActionType.CompleteObjective:\n        actionParamObj.id = actionParams[0];\n        Parser.validator.assertEntityType(GameEntityType.objectives, actionParams[0], actionType);\n        break;\n\n      case GameActionType.CompleteTask:\n        actionParamObj.id = actionParams[0];\n        Parser.validator.assertEntityType(GameEntityType.tasks, actionParams[0], actionType);\n        break;\n\n      case GameActionType.ShowTask:\n        actionParamObj.id = actionParams[0];\n        Parser.validator.assertEntityType(GameEntityType.tasks, actionParams[0], actionType);\n        break;\n\n      case GameActionType.PreviewLocation:\n      case GameActionType.ChangeBackground:\n        actionParamObj.id = actionParams[0];\n        Parser.validator.assertEntityType(GameEntityType.locations, actionParams[0], actionType);\n        break;\n      case GameActionType.StartAnimation:\n        actionParamObj.id = actionParams[0];\n        actionParamObj.startFrame = +actionParams[1];\n        actionParamObj.frameRate = +actionParams[2];\n        actionParamObj.assetCategory = actionParams[3];\n        Parser.validator.assertAnimType(actionParams[0], actionType);\n        break;\n      case GameActionType.StopAnimation:\n        actionParamObj.id = actionParams[0];\n        Parser.validator.assertAnimType(actionParams[0], actionType);\n        break;\n      case GameActionType.ShowDialogue:\n        actionParamObj.id = actionParams[0];\n        Parser.validator.assertItemType(GameItemType.dialogues, actionParams[0], actionType);\n        break;\n\n      case GameActionType.AddItem:\n      case GameActionType.RemoveItem:\n        const gameItemType = ParserConverter.stringToGameItemType(actionParams[0]);\n        actionParamObj.gameItemType = gameItemType;\n\n        actionParamObj.locationId = actionParams[1];\n        Parser.validator.assertEntityType(GameEntityType.locations, actionParams[1], actionType);\n\n        actionParamObj.id = actionParams[2];\n        Parser.validator.assertItemType(gameItemType, actionParams[2], actionType);\n        break;\n\n      case GameActionType.AddLocationMode:\n      case GameActionType.RemoveLocationMode:\n        Parser.validator.assertEntityType(GameEntityType.locations, actionParams[0], actionType);\n        actionParamObj.locationId = actionParams[0];\n        actionParamObj.mode = ParserConverter.stringToGameMode(actionParams[1]);\n        break;\n\n      case GameActionType.AddPopup:\n        Parser.validator.assertItemType(GameItemType.objects, actionParams[0], actionType);\n        actionParamObj.id = actionParams[0];\n        actionParamObj.position = ParserConverter.stringToPosition(actionParams[1]);\n        actionParams[2] && (actionParamObj.duration = parseInt(actionParams[2]) * 1000);\n        actionParams[3] && (actionParamObj.size = ParserConverter.stringToSize(actionParams[3]));\n        break;\n\n      case GameActionType.MakeObjectBlink:\n        Parser.validator.assertItemType(GameItemType.objects, actionParams[0], actionType);\n        actionParamObj.id = actionParams[0];\n        actionParamObj.turnOn = ParserConverter.stringToBoolean(actionParams[1]);\n        break;\n\n      case GameActionType.MakeObjectGlow:\n        Parser.validator.assertItemType(GameItemType.objects, actionParams[0], actionType);\n        actionParamObj.id = actionParams[0];\n        actionParamObj.turnOn = ParserConverter.stringToBoolean(actionParams[1]);\n        break;\n\n      case GameActionType.PlayBGM:\n        actionParamObj.id = actionParams[0];\n        Parser.validator.assertEntityType(GameEntityType.bgms, actionParams[0], actionType);\n        break;\n\n      case GameActionType.PlaySFX:\n        actionParamObj.id = actionParams[0];\n        Parser.validator.assertEntityType(GameEntityType.sfxs, actionParams[0], actionType);\n        break;\n\n      case GameActionType.ShowObjectLayer:\n        actionParamObj.show = ParserConverter.stringToBoolean(actionParams[0]);\n        break;\n\n      case GameActionType.UpdateCharacter:\n        Parser.validator.assertItemType(GameItemType.characters, actionParams[0], actionType);\n        actionParamObj.id = actionParams[0];\n        actionParamObj.expression = actionParams[1];\n        break;\n\n      case GameActionType.MoveCharacter:\n        Parser.validator.assertItemType(GameItemType.characters, actionParams[0], actionType);\n        Parser.validator.assertEntityType(GameEntityType.locations, actionParams[1], actionType);\n        actionParamObj.id = actionParams[0];\n        actionParamObj.locationId = actionParams[1];\n        actionParamObj.position = ParserConverter.stringToPosition(actionParams[2]);\n        break;\n\n      case GameActionType.NavigateToAssessment:\n        actionParamObj.assessmentId = actionParams[0];\n        break;\n\n      case GameActionType.Delay:\n        actionParamObj.duration = parseInt(actionParams[0]) * 1000;\n        break;\n    }\n\n    const actionId = Parser.generateActionId();\n    return {\n      actionType: gameActionType,\n      actionParams: actionParamObj,\n      actionConditions: [],\n      interactionId: actionId,\n      isInteractive: false,\n      isRepeatable: repeatable\n    };\n  }\n}\n","import { Prompt } from '../dialogue/GameDialogueTypes';\nimport StringUtils from '../utils/StringUtils';\n\n/**\n * This class parses prompt and creates Prompt\n * objects stored that are stored in a DialogueLine\n */\nexport default class PromptParser {\n  /**\n   * Parses title and choice strings and returns a\n   * Prompt object with this information\n   * @param title title of prompt to give context\n   * @param choices raw choice strings, eg [\"Yes -> goto 4\", \"No -> goto 5\"]\n   * @returns {Prompt} returns prompt object with associated information\n   */\n  public static parsePrompt(title: string, choices: string[]): Prompt {\n    const prompt = {\n      promptTitle: title.split('prompt:')[1].trim(),\n      choices: choices.map(this.splitChoice)\n    };\n    return prompt;\n  }\n\n  /**\n   * Split a choice string into a Choice option and\n   * PartName\n   * @param rawChoice raw choice string, eg \"Yes -> goto 4\"\n   * @returns {[string, string]} returns a 2-element array, the\n   * first element a choice option and the second element the\n   * corresponding goto\n   */\n  public static splitChoice(rawChoice: string): [string, string] {\n    const choice = StringUtils.splitWithLimit(rawChoice, '->', 1);\n    return [choice[0].trim(), choice[1].split(' ')[1].trim()];\n  }\n}\n","import { AssetType } from '../assets/AssetsTypes';\nimport { Character } from '../character/GameCharacterTypes';\nimport { AssetKey, ItemId } from '../commons/CommonTypes';\nimport { GameItemType, LocationId } from '../location/GameMapTypes';\nimport StringUtils from '../utils/StringUtils';\nimport Parser from './Parser';\nimport ParserConverter from './ParserConverter';\n\n/**\n * This class is in charge of parsing Character entities\n * from character lines\n */\nexport default class CharacterParser {\n  /**\n   * This class parses the character paragraph into\n   * Characters and places them in the game map\n   *\n   * @param locationId Location where the character lines are found\n   * @param characterList the list of character CSV lines\n   */\n  public static parse(locationId: LocationId, characterList: string[]) {\n    characterList.forEach(characterDetails =>\n      this.parseCharacterDetails(locationId, characterDetails)\n    );\n  }\n\n  /**\n   * Generates the asset key for a character and expression\n   *\n   * @param characterId the character's id, which is also the folder of the character in /avatars folder\n   * @param expression the expression of the character, which is also present in filename\n   */\n  public static characterAssetKey(characterId: ItemId, expression: string) {\n    return characterId + '-' + expression;\n  }\n\n  /**\n   * Generates the short asset path for a character and an expression\n   *\n   * @param characterId the character's id, which is also the folder of the character in /avatars folder\n   * @param expression the expression of the character, which is also present in filename\n   */\n  public static characterAssetPath(characterId: ItemId, expression: string) {\n    return `/avatars/${characterId}/${characterId}.${expression}.png`;\n  }\n\n  /**\n   * This function parses character CSVs and returns Characters\n   * and places the characters inside the game map\n   *\n   * @param locationId the character's location\n   * @param characterDetails the CSV string containing character details\n   */\n  private static parseCharacterDetails(locationId: LocationId, characterDetails: string) {\n    const addToLoc = characterDetails[0] === '+';\n    if (addToLoc) {\n      characterDetails = characterDetails.slice(1);\n    }\n\n    const [id, name, defaultExpression, defaultPosition, scale] = StringUtils.splitByChar(\n      characterDetails,\n      ','\n    );\n    Parser.validator.registerId(id);\n\n    const expressions = new Map<string, AssetKey>();\n\n    const character: Character = {\n      id,\n      name,\n      expressions,\n      defaultExpression,\n      defaultPosition: ParserConverter.stringToPosition(defaultPosition),\n      scale: scale ? parseFloat(scale) : 1\n    };\n\n    // Add asset key to expression map\n    expressions.set(defaultExpression, this.characterAssetKey(id, defaultExpression));\n\n    // Add asset keys to expression map\n    Parser.checkpoint.map.addMapAsset(this.characterAssetKey(id, defaultExpression), {\n      type: AssetType.Image,\n      path: this.characterAssetPath(id, defaultExpression),\n      key: id\n    });\n\n    // Add character to map\n    Parser.checkpoint.map.setItemInMap(GameItemType.characters, id, character);\n\n    // Add character to location\n    if (addToLoc) {\n      Parser.checkpoint.map.addItemToLocation(locationId, GameItemType.characters, id);\n    }\n  }\n}\n","import { AssetType } from '../assets/AssetsTypes';\nimport { SpeakerDetail } from '../character/GameCharacterTypes';\nimport StringUtils from '../utils/StringUtils';\nimport CharacterParser from './CharacterParser';\nimport Parser from './Parser';\nimport ParserConverter from './ParserConverter';\n\n/**\n * This classes parses the speaker portion of the dialogue\n * and returns SpeakerDetail object encapsulating information\n * about speakers in a dialogue.\n *\n * This class also loads the character expressions into the\n * Character entity in the game map\n */\nexport default class SpeakerParser {\n  /**\n   * The character parses one line containing the speaker details\n   * and returns a speaker detail object which is a property of some DialogueLine's.\n   *\n   * @param rawStr the string containing the character ids and expressions\n   * @returns {SpeakerDetail} associated with that string\n   */\n  public static parse(rawStr: string): SpeakerDetail {\n    const [speakerId, expression, speakerPositionStr] = StringUtils.splitByChar(\n      rawStr.slice(1), // remove the @\n      ','\n    );\n    const speakerPosition = ParserConverter.stringToPosition(speakerPositionStr);\n\n    this.addCharacterExprToMap(speakerId, expression);\n\n    return {\n      speakerId,\n      expression,\n      speakerPosition\n    };\n  }\n\n  /**\n   * This line adds the  expression into the expression map of an\n   * existing Character in the game map. This ensures that\n   * images of the characters' various expressions are loaded properly\n   * into the game map.\n   *\n   * @param charId the character Id of that character, also the asset folder of the character inside /avatars folder\n   * @param expression the expression of character to be loaded into the expression map of the character\n   */\n  private static addCharacterExprToMap(charId: string, expression: string) {\n    if (charId === 'you' || charId === 'narrator') {\n      return;\n    }\n    const character = Parser.checkpoint.map.getCharacterMap().get(charId);\n\n    if (!character) {\n      throw new Error(`Character \"${charId}\" not in map`);\n    }\n\n    const charExpression = expression || character.defaultExpression;\n\n    character.expressions.set(\n      expression,\n      CharacterParser.characterAssetKey(charId, expression || charExpression)\n    );\n\n    Parser.checkpoint.map.addMapAsset(CharacterParser.characterAssetKey(charId, charExpression), {\n      path: CharacterParser.characterAssetPath(charId, charExpression),\n      type: AssetType.Image,\n      key: charId\n    });\n  }\n}\n","import { Dialogue, DialogueLine, PartName } from '../dialogue/GameDialogueTypes';\nimport { GameItemType } from '../location/GameMapTypes';\nimport { mapValues } from '../utils/GameUtils';\nimport StringUtils from '../utils/StringUtils';\nimport ActionParser from './ActionParser';\nimport ConditionParser from './ConditionParser';\nimport Parser from './Parser';\nimport PromptParser from './PromptParser';\nimport SpeakerParser from './SpeakerParser';\n\n/**\n * This class parses dialogues and creates\n * Dialogue Objects which can be read by the\n * Dialogue Generator\n */\nexport default class DialogueParser {\n  /**\n   * This function reads the entire text under the \"dialogue\" heading,\n   * converts dialogues listed underneath into Dialogue entities,\n   * and stores these dialogues in the game map.\n   *\n   * @param dialogueText the entire dialogue text beneath Dialogue\n   */\n  public static parse(dialogueText: string[]) {\n    const dialoguesParagraphs = StringUtils.splitToParagraph(dialogueText);\n\n    dialoguesParagraphs.forEach(([dialogueDetails, dialogueBody]: [string, string[]]) => {\n      if (dialogueBody.length === 0) {\n        console.error('No dialogue found for dialogueId');\n        return;\n      }\n      this.parseDialogue(dialogueDetails, dialogueBody);\n    });\n  }\n\n  /**\n   * This function parses one dialogue and stores it into the game map\n   *\n   * @param dialogueDetails the string containing dialogue Id and/or dialouge title\n   * @param dialogueBody the body of the dialogue containing its contents\n   */\n  private static parseDialogue(dialogueDetails: string, dialogueBody: string[]) {\n    const [dialogueId, title] = StringUtils.splitWithLimit(dialogueDetails, ',', 1);\n    Parser.validator.registerId(dialogueId);\n\n    const content = this.parseDialogueContent(dialogueBody);\n    const dialogue: Dialogue = { title, content };\n\n    // Add fallback title\n    if (!dialogue.title) {\n      dialogue.title = StringUtils.toCapitalizedWords(dialogueId);\n    }\n\n    Parser.checkpoint.map.setItemInMap(GameItemType.dialogues, dialogueId, dialogue);\n  }\n\n  /**\n   * This function parses the dialogue's body and\n   * converts each into a Dialogue object.\n   *\n   * This function's main task is to separate a dialogue into\n   * parts (or part if just one), and then uses  createDialogueLines to parse each part.\n   *\n   * @param dialogueBody The entire dialogue body\n   */\n  private static parseDialogueContent(dialogueBody: string[]) {\n    const rawDialogueContent: Map<PartName, string[]> = StringUtils.mapByHeader(\n      dialogueBody,\n      isInteger\n    );\n\n    const dialogueObject: Map<PartName, DialogueLine[]> = mapValues(\n      rawDialogueContent,\n      this.createDialogueLines\n    );\n    return dialogueObject;\n  }\n\n  /**\n   * This function parses one \"part\" of a dialogue,\n   * and converts them into a series of DialogueLine's,\n   * where DialogueLine encapsulates data on the text,\n   * (as well as speaker change, actions, gotos and prompts if any)\n   *\n   * @param {Array<string>} lines the lines inside one part of a dialogue\n   * @returns {Array<DialogueLine>}\n   */\n  private static createDialogueLines(lines: string[]): DialogueLine[] {\n    const dialogueLines: DialogueLine[] = [];\n    let currIndex = 0;\n\n    while (currIndex !== lines.length) {\n      const rawStr = lines[currIndex];\n      switch (true) {\n        case isGotoLabel(rawStr):\n          const [gotoString, postpend] = StringUtils.splitByChar(rawStr, 'if');\n          const [conditionalsString, altPart] = postpend\n            ? StringUtils.splitByChar(postpend, 'else')\n            : [null, null];\n          const conditions = conditionalsString\n            ? StringUtils.splitByChar(conditionalsString, 'AND').map(condition =>\n                ConditionParser.parse(condition)\n              )\n            : [];\n          dialogueLines[dialogueLines.length - 1].goto = {\n            conditions,\n            part: gotoString.split(' ')[1],\n            altPart: altPart\n          };\n          break;\n        case isPrompt(rawStr):\n          const rawTitle = rawStr;\n          const rawChoices: string[] = [];\n          while (lines[currIndex + 1] && isPromptChoice(lines[currIndex + 1])) {\n            currIndex++;\n            rawChoices.push(lines[currIndex].trim());\n          }\n          const prompt = PromptParser.parsePrompt(rawTitle, rawChoices);\n          dialogueLines[dialogueLines.length - 1].prompt = prompt;\n          break;\n        case isActionLabel(rawStr):\n          const lastLine = dialogueLines[dialogueLines.length - 1];\n          !lastLine.actionIds && (lastLine.actionIds = []);\n          lastLine.actionIds.push(ActionParser.parseAction(rawStr));\n          break;\n        case isSpeaker(rawStr):\n          currIndex++;\n          const nextLine = lines[currIndex];\n          if (!nextLine) {\n            throw new Error('Parsing error: Cannot change speaker without next line');\n          }\n          dialogueLines.push({ line: nextLine });\n          dialogueLines[dialogueLines.length - 1].speakerDetail = SpeakerParser.parse(rawStr);\n          break;\n        default:\n          // Dialogue lines without speaker are by default treated as lines by narrator\n          // This also ensures that lines without speaker are displayed on the dialogue log\n          dialogueLines.push({ line: rawStr });\n          dialogueLines[dialogueLines.length - 1].speakerDetail = SpeakerParser.parse('@narrator');\n          break;\n      }\n      currIndex++;\n    }\n    return dialogueLines;\n  }\n}\n\nconst isInteger = (line: string) => new RegExp(/^[0-9]+$/).test(line);\nconst isGotoLabel = (line: string) => new RegExp(/^goto [0-9]+.*$/).test(line);\nconst isActionLabel = (line: string) => line && (line[0] === '\\t' || line.slice(0, 4) === '    ');\nconst isSpeaker = (line: string) => line && line[0] === '@';\nconst isPrompt = (line: string) => line.trim().startsWith('prompt:');\nconst isPromptChoice = (line: string) => new RegExp(/-> +goto/).test(line);\n","import { LocationId } from '../location/GameMapTypes';\nimport { GameSoundType } from '../sound/GameSoundTypes';\nimport StringUtils from '../utils/StringUtils';\nimport Parser from './Parser';\n\n/**\n * This class contains the parser for the BGM and SFX paragraphs\n * within a location\n */\nexport default class MusicParser {\n  /**\n   * This function parses a series of sounds and updates\n   * the sound assets included in the game map.\n   *\n   * It also parses the first BGM as the bgm of the location\n   *\n   * @param locationId The locationId of the BGM/SFX you want to parse\n   * @param soundList the list of sounds to be added as assets\n   * @param soundType Whether it's BGM or SFX\n   */\n  public static parse(locationId: LocationId, soundList: string[], soundType: GameSoundType) {\n    soundList.forEach((musicDetails, musicIndex) => {\n      const [id, assetPath, volume] = StringUtils.splitByChar(musicDetails, ',');\n      Parser.validator.registerId(id);\n\n      Parser.checkpoint.map.addSoundAsset({\n        key: id,\n        path: assetPath,\n        config: {\n          volume: parseFloat(volume),\n          loop: soundType === GameSoundType.BGM\n        },\n        soundType\n      });\n\n      if (soundType === GameSoundType.BGM && musicIndex === 0) {\n        Parser.checkpoint.map.setBGMusicAt(locationId, id);\n      }\n    });\n  }\n}\n","import { GameCheckpoint } from '../chapter/GameChapterTypes';\nimport GameMap from '../location/GameMap';\nimport GameObjective from '../objective/GameObjective';\nimport GameTask from '../task/GameTask';\nimport StringUtils from '../utils/StringUtils';\nimport ActionParser from './ActionParser';\nimport DialoguesParser from './DialogueParser';\nimport LocationsParser from './LocationDetailsParser';\nimport LocationParser from './LocationParser';\nimport ParserValidator, { GameEntityType } from './ParserValidator';\nimport TasksParser from './TasksParser';\n\n/**\n * This class converts a checkpoint txt file into a Checkpoint\n * object.\n *\n * A Checkpoint object encapsulates data about the map including all\n * the locations inside it, as well as the objectives in that checkpoint,\n * basically everything the game engine needs to know to render\n * the entire checkpoint for players to play.\n *\n */\nclass Parser {\n  public static checkpoint: GameCheckpoint;\n  private static actionIdNum: number;\n  public static validator: ParserValidator;\n\n  public static generateActionId() {\n    Parser.actionIdNum++;\n    return `action#${Parser.actionIdNum}`;\n  }\n\n  public static init() {\n    Parser.actionIdNum = 0;\n\n    Parser.checkpoint = {\n      map: new GameMap(),\n      startingLoc: '',\n      objectives: new GameObjective(),\n      tasks: new GameTask()\n    };\n\n    Parser.validator = new ParserValidator();\n  }\n\n  public static parse(chapterText: string, continueParse = false) {\n    if (!continueParse) {\n      Parser.init();\n    }\n\n    const checkPointLines = StringUtils.splitToLinesAndRemoveComments(chapterText);\n    const checkPointParagraphs = StringUtils.splitToParagraph(checkPointLines);\n\n    checkPointParagraphs.forEach(([header, body]: [string, string[]]) => {\n      if (body.length === 0 && header.includes(':')) {\n        Parser.parseCheckpointConfig(header);\n      } else {\n        Parser.parseCheckpointParagraphs(header, body) || LocationParser.parse(header, body);\n      }\n    });\n\n    Parser.validator.verifyAssertions();\n  }\n\n  private static parseCheckpointConfig(checkpointConfig: string) {\n    const [key, value] = StringUtils.splitByChar(checkpointConfig, ':');\n    switch (key) {\n      case 'startingLoc':\n        Parser.validator.assertEntityType(GameEntityType.locations, value);\n        Parser.checkpoint.startingLoc = value;\n        break;\n      default:\n        throw new Error(`Invalid checkpoint config key, \"${checkpointConfig}\"`);\n    }\n  }\n\n  private static parseCheckpointParagraphs(header: string, body: string[]) {\n    switch (header) {\n      case 'objectives':\n        Parser.checkpoint.objectives.addObjectives(body);\n        break;\n      case 'tasks':\n        TasksParser.parse(body);\n        break;\n      case 'locations':\n        LocationsParser.parse(body);\n        break;\n      case 'gameStartActions':\n        Parser.checkpoint.map.setGameStartActions(ActionParser.parseActions(body));\n        break;\n      case 'checkpointCompleteActions':\n        Parser.checkpoint.map.setCheckpointCompleteActions(ActionParser.parseActions(body));\n        break;\n      case 'dialogues':\n        DialoguesParser.parse(body);\n        break;\n      default:\n        return false;\n    }\n    return true;\n  }\n}\n\nexport default Parser;\n","import { AssetType } from '../assets/AssetsTypes';\nimport { GameItemType, GameLocation, LocationId } from '../location/GameMapTypes';\nimport { GameSoundType } from '../sound/GameSoundTypes';\nimport StringUtils from '../utils/StringUtils';\nimport ActionParser from './ActionParser';\nimport BoundingBoxParser from './BoundingBoxParser';\nimport CharacterParser from './CharacterParser';\nimport MusicParser from './MusicParser';\nimport ObjectParser from './ObjectParser';\nimport Parser from './Parser';\nimport ParserConverter from './ParserConverter';\nimport { GameEntityType } from './ParserValidator';\n\n/**\n * This class parses data for one specific location.\n */\nexport default class LocationParser {\n  /**\n   * This function reads the entire location body and\n   * updates the location in the game map based on details inside\n   * including charcters, objects, boundingBoxes etc.\n   *\n   * @param locationId The location id for the location to parse\n   * @param locationBody The entire body of the location as string array\n   */\n  public static parse(locationId: LocationId, locationBody: string[]) {\n    const location = Parser.checkpoint.map.getLocationAtId(locationId);\n    const locationParagraphs = StringUtils.splitToParagraph(locationBody);\n\n    locationParagraphs.forEach(([header, body]: [string, string[]]) => {\n      if (body.length === 0 && header.includes(':')) {\n        this.parseLocationConfig(location, header);\n      } else {\n        this.parseLocationParagraphs(location, header, body);\n      }\n    });\n  }\n\n  /**\n   * This paragraph parses all the config details in a specific location\n   * ie lines containing the ':' to specify gameplay details about the location\n   *\n   * @param location The reference game location that we want to update\n   * @param locationConfig The config string about the location\n   */\n  private static parseLocationConfig(location: GameLocation, locationConfig: string) {\n    const [key, value] = StringUtils.splitByChar(locationConfig, ':');\n    const configValues = StringUtils.splitByChar(value, ',');\n    switch (key) {\n      case 'modes':\n        configValues.forEach(mode => {\n          const gameMode = ParserConverter.stringToGameMode(mode);\n          location.modes.add(gameMode);\n        });\n        break;\n      case 'nav':\n        configValues.forEach(otherLocationId => {\n          Parser.validator.assertEntityType(GameEntityType.locations, otherLocationId);\n          location.navigation.add(otherLocationId);\n        });\n        break;\n      case 'talkTopics':\n        const talkTopics = configValues;\n        Parser.validator.assertItemTypes(GameItemType.dialogues, talkTopics);\n        location.talkTopics = new Set(talkTopics);\n        break;\n      case 'preview':\n        const [previewPath] = configValues;\n        if (previewPath) {\n          const previewKey = '/preview' + previewPath;\n          Parser.checkpoint.map.addMapAsset(previewKey, {\n            type: AssetType.Image,\n            key: location.id + 'Preview',\n            path: previewPath\n          });\n          location.previewKey = previewKey;\n        }\n        break;\n      default:\n        throw new Error(`Invalid config key \"${key}\" specified under location \"${location.id}\"`);\n    }\n  }\n\n  /**\n   * This paragraph parses all the paragraphs inside a specific location\n   * ie lines paragraphs headed by 'objects', 'boundingBoxes', etc.\n   *\n   * @param location The reference game location that we want to update\n   * @param entityHeader The header of the entity we want to parse in the location\n   * @param body The body paragraph underneath the entity header\n   */\n  private static parseLocationParagraphs(\n    location: GameLocation,\n    entityHeader: string,\n    body: string[]\n  ) {\n    switch (entityHeader) {\n      case 'objects':\n        ObjectParser.parse(location.id, body);\n        break;\n      case 'boundingBoxes':\n        BoundingBoxParser.parse(location.id, body);\n        break;\n      case 'characters':\n        CharacterParser.parse(location.id, body);\n        break;\n      case 'bgm':\n        MusicParser.parse(location.id, body, GameSoundType.BGM);\n        break;\n      case 'sfx':\n        MusicParser.parse(location.id, body, GameSoundType.SFX);\n        break;\n      case 'actions':\n        location.actionIds = ActionParser.parseActions(body);\n        break;\n      default:\n        throw new Error(`Invalid location paragraph header \"${entityHeader}\"`);\n    }\n  }\n}\n","import { AnimType, AssetType } from '../assets/AssetsTypes';\nimport { GameItemType, LocationId } from '../location/GameMapTypes';\nimport { ObjectProperty } from '../objects/GameObjectTypes';\nimport StringUtils from '../utils/StringUtils';\nimport ActionParser from './ActionParser';\nimport Parser from './Parser';\n\n/**\n * This class parses object CSV's into Object Properties\n */\nexport default class ObjectParser {\n  /**\n   * This function parses object CSVs in a location,\n   * and creates Object Properties corresponding to the each object CSV,\n   * and stores these Object Properties into the game map.\n   *\n   * The class also parses actions of objects if any.\n   *\n   * @param locationId the location where the object paragraph can be found\n   * @param objectList the list of lines describing objects in the location, including actions\n   */\n  public static parse(locationId: LocationId, objectList: string[]) {\n    const objectParagraphs = StringUtils.splitToParagraph(objectList);\n\n    objectParagraphs.forEach(([header, body]: [string, string[]]) => {\n      const object = this.parseObjectConfig(locationId, header);\n      if (body.length) {\n        object.isInteractive = true;\n        object.actionIds = ActionParser.parseActions(body);\n      }\n    });\n  }\n\n  /**\n   * Generates an asset key based on the object path\n   *\n   * @param shortPath path to the object\n   */\n  private static objectAssetKey(shortPath: string) {\n    return shortPath;\n  }\n\n  /**\n   * Generates an asset path based on the object path\n   *\n   * @param shortPath path to the object\n   */\n  private static objectPath(shortPath: string) {\n    return shortPath;\n  }\n\n  /**\n   * This function parses one object CSV into an Object Property,\n   * and places the object inside the game map.\n   *\n   * It also returns the reference to the object property, so that\n   * actionIds can be added to it.\n   *\n   * @param locationId The location id\n   * @param objectDetails One line containing an object CSV\n   * @returns {ObjectProperty} the object property created\n   */\n  private static parseObjectConfig(locationId: LocationId, objectDetails: string): ObjectProperty {\n    const addToLoc = objectDetails[0] === '+';\n    if (addToLoc) {\n      objectDetails = objectDetails.slice(1);\n    }\n\n    const [objectId, shortPath, x, y, width, height, type, frame] = StringUtils.splitByChar(\n      objectDetails,\n      ','\n    );\n    Parser.validator.registerId(objectId);\n\n    const objectProperty: ObjectProperty = {\n      assetKey: this.objectAssetKey(shortPath),\n      x: parseInt(x),\n      y: parseInt(y),\n      width: parseInt(width) || undefined,\n      height: parseInt(height) || undefined,\n      isInteractive: false,\n      interactionId: objectId\n    };\n\n    Parser.checkpoint.map.addMapAsset(this.objectAssetKey(shortPath), {\n      type: AssetType[type] || AssetType.Image,\n      key: objectId,\n      path: this.objectPath(shortPath),\n      config: {\n        frameHeight: parseInt(height) || -1,\n        frameWidth: parseInt(width) || -1,\n        centreX: 0,\n        centreY: 0,\n        endFrame: parseInt(frame) - 1 || 0,\n        animType: AnimType.Object\n      }\n    });\n\n    Parser.checkpoint.map.setItemInMap(GameItemType.objects, objectId, objectProperty);\n    if (addToLoc) {\n      Parser.checkpoint.map.addItemToLocation(locationId, GameItemType.objects, objectId);\n    }\n\n    return objectProperty;\n  }\n}\n","import { BBoxProperty } from '../boundingBoxes/GameBoundingBoxTypes';\nimport { GameItemType, LocationId } from '../location/GameMapTypes';\nimport StringUtils from '../utils/StringUtils';\nimport ActionParser from './ActionParser';\nimport Parser from './Parser';\n\n/**\n * This class is in charge of parsing the boundingBoxes paragraph\n */\nexport default class BoundingBoxParser {\n  /**\n   * This parses the boundingBoxes paragraph (with actions) into Bounding Box Properties\n   * and stores them in the correct location in the game map\n   *\n   * @param locationId locationId where the boundingBox paragraph is\n   * @param boundingBoxList the list of raw bounding box strings in the paragraph\n   */\n  public static parse(locationId: LocationId, boundingBoxList: string[]) {\n    const boundingBoxParagraphs = StringUtils.splitToParagraph(boundingBoxList);\n\n    boundingBoxParagraphs.forEach(([header, body]: [string, string[]]) => {\n      const boundingBox = this.parseBBoxConfig(locationId, header);\n      if (body.length) {\n        boundingBox.isInteractive = true;\n        boundingBox.actionIds = ActionParser.parseActions(body);\n      }\n    });\n  }\n\n  /**\n   * This class parses one bounding box CSV and produces a\n   * Bounding box property from that bounding box string\n   *\n   * @param locationId LocationId where the bounding box paragraph is\n   * @param bboxDetails One bounding box CSV line\n   * @returns {BBoxProperty} corresponding bbox property produced from that CSV line\n   */\n  private static parseBBoxConfig(locationId: LocationId, bboxDetails: string): BBoxProperty {\n    const addToLoc = bboxDetails[0] === '+';\n    if (addToLoc) {\n      bboxDetails = bboxDetails.slice(1);\n    }\n\n    const [bboxId, x, y, width, height] = StringUtils.splitByChar(bboxDetails, ',');\n    const bboxProperty: BBoxProperty = {\n      x: parseInt(x),\n      y: parseInt(y),\n      width: parseInt(width),\n      height: parseInt(height),\n      isInteractive: false,\n      interactionId: bboxId\n    };\n\n    Parser.validator.registerId(bboxId);\n    Parser.checkpoint.map.setItemInMap(GameItemType.boundingBoxes, bboxId, bboxProperty);\n    if (addToLoc) {\n      Parser.checkpoint.map.addItemToLocation(locationId, GameItemType.boundingBoxes, bboxId);\n    }\n\n    return bboxProperty;\n  }\n}\n","import { TaskDetail } from '../task/GameTaskTypes';\nimport StringUtils from '../utils/StringUtils';\nimport Parser from './Parser';\n\n/**\n * This class parses the \"tasks\" paragraphs,\n * and creates the indicated tasks to be displayed\n * to the user on the Task Log.\n */\nexport default class TasksParser {\n  /**\n   * This function parses the strings and creates each task\n   * based on three parameters:\n   *\n   * (1) The specified task id\n   * (2) The title of the task\n   * (3) The description of the task\n   *\n   * E.g.\n   *\n   * tasks\n   *     taskTalkToScottie, Talk to Scottie, Have a chat with your best friend, Scottie!\n   *     taskCheckScreen, Check the monitor, Go to your room and check for further instructions!\n   *\n   * @param taskDetails the CSV lines containing descriptions about the tasks\n   */\n  public static parse(taskDetails: string[]) {\n    const tasks: TaskDetail[] = [];\n    taskDetails.forEach(taskDetail => {\n      const [taskId, title, desc] = StringUtils.splitWithLimit(taskDetail, ',', 2);\n      const newTask: TaskDetail = {\n        taskId: taskId,\n        title: title,\n        description: desc,\n        visible: false\n      };\n      tasks.push(newTask);\n    });\n    Parser.checkpoint.tasks.addTasks(tasks);\n  }\n}\n","import { AnimType, AssetType } from '../assets/AssetsTypes';\nimport { screenCenter, screenSize } from '../commons/CommonConstants';\nimport { createEmptyLocation } from '../location/GameMapHelper';\nimport StringUtils from '../utils/StringUtils';\nimport Parser from './Parser';\n\n/**\n * This class parses the \"locations\" paragraphs,\n * and creates all the game locations declared\n * in the paragraph.\n */\nexport default class LocationDetailsParser {\n  /**\n   * This function parses location strings\n   * and adds GameLocations to the map based on location\n   * descriptions\n   *\n   * @param locationDetails the CSV lines containing descriptions about game locations\n   */\n  public static parse(locationDetails: string[]) {\n    locationDetails.forEach(locationDetail => {\n      const [id, shortPath, name, type, frame] = StringUtils.splitByChar(locationDetail, ',');\n      Parser.validator.registerId(id);\n\n      Parser.checkpoint.map.addLocation(id, {\n        ...createEmptyLocation(),\n        id,\n        name,\n        assetKey: this.locationAssetKey(shortPath)\n      });\n\n      Parser.checkpoint.map.addMapAsset(this.locationAssetKey(shortPath), {\n        type: AssetType[type] || AssetType.Image,\n        key: id,\n        path: this.locationPath(shortPath),\n        config: {\n          frameWidth: screenSize.x,\n          frameHeight: screenSize.y,\n          centreX: screenCenter.x,\n          centreY: screenCenter.y,\n          endFrame: parseInt(frame) - 1 || 0,\n          animType: AnimType.Background\n        }\n      });\n    });\n  }\n\n  /**\n   * Genrates an asset key for the location\n   *\n   * @param shortPath the path to the location\n   */\n  private static locationAssetKey(shortPath: string) {\n    return shortPath;\n  }\n\n  /**\n   * Genrates an asset path for the location\n   *\n   * @param shortPath the path to the location\n   */\n  private static locationPath(shortPath: string) {\n    return shortPath;\n  }\n}\n","import { GameLocation } from './GameMapTypes';\n\n/**\n * Intialises an an empty location\n */\nexport function createEmptyLocation(): GameLocation {\n  return {\n    id: '',\n    name: '',\n    assetKey: '',\n    previewKey: null,\n    modes: new Set([]),\n    navigation: new Set([]),\n    talkTopics: new Set([]),\n    objects: new Set([]),\n    boundingBoxes: new Set([]),\n    bgmKey: '',\n    characters: new Set([])\n  };\n}\n","import TextAssets, { MockTextAssets, toTxtPath } from '../assets/TextAssets';\nimport Parser from '../parser/Parser';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { loadText } from './LoaderUtils';\n\n/**\n * Starts a new checkpoint with the given chapter number\n * and checkpoint number. The chapter/checkpoint file\n * will also be appended with the default checkpoint text.\n *\n * @param continueGame if true, will load the last checkpoint. Else, restart the chapter.\n * @param chapterNum chapter number\n * @param checkpointNum checkpoint number\n */\nexport async function callGameManagerOnTxtLoad(\n  continueGame: boolean,\n  chapterNum: number,\n  checkpointNum: number\n) {\n  const textAssets = SourceAcademyGame.getInstance().getIsUsingMock() ? MockTextAssets : TextAssets;\n  const scene = SourceAcademyGame.getInstance().getCurrentSceneRef();\n  const gameChapters = SourceAcademyGame.getInstance().getGameChapters();\n  const filename = gameChapters[chapterNum].filenames[checkpointNum];\n  if (!filename) {\n    return;\n  }\n\n  await loadText(scene, filename, filename);\n  await loadText(scene, textAssets.defaultCheckpoint.key, textAssets.defaultCheckpoint.path);\n\n  const text = scene.cache.text.get(filename);\n  const defaultCheckpointText = scene.cache.text.get(textAssets.defaultCheckpoint.key);\n\n  Parser.parse(defaultCheckpointText);\n  Parser.parse(text, true);\n  const gameCheckpoint = Parser.checkpoint;\n\n  scene.scene.start('GameManager', {\n    gameCheckpoint,\n    continueGame,\n    chapterNum,\n    checkpointNum\n  });\n}\n\n/**\n * Starts a new checkpoint using the next checkpoint in the\n * the chapter simulator stack\n */\nexport async function callGameManagerForSim() {\n  const scene = SourceAcademyGame.getInstance().getCurrentSceneRef();\n  const checkpointFilenames = SourceAcademyGame.getInstance().getSSChapterSimFilenames();\n  if (!checkpointFilenames.length) {\n    scene.scene.start('StorySimulatorMenu');\n    return;\n  }\n  const filename = checkpointFilenames.pop() as string;\n  await loadText(scene, filename, toTxtPath(filename));\n  await loadText(scene, TextAssets.defaultCheckpoint.key, TextAssets.defaultCheckpoint.path);\n\n  const text = scene.cache.text.get(filename);\n  const defaultCheckpointText = scene.cache.text.get(TextAssets.defaultCheckpoint.key);\n\n  Parser.parse(defaultCheckpointText);\n  Parser.parse(text, true);\n  const gameCheckpoint = Parser.checkpoint;\n\n  scene.scene.start('GameManager', {\n    gameCheckpoint,\n    chapterNum: -1,\n    checkpointNum: -1\n  });\n  return true;\n}\n","import ImageAssets from '../../assets/ImageAssets';\nimport { GameChapter } from '../../chapter/GameChapterTypes';\nimport { screenCenter, screenSize } from '../../commons/CommonConstants';\nimport CommonTextHover from '../../commons/CommonTextHover';\nimport SourceAcademyGame from '../../SourceAcademyGame';\nimport { createButton } from '../../utils/ButtonUtils';\nimport { createBitmapText } from '../../utils/TextUtils';\nimport { callGameManagerOnTxtLoad } from '../../utils/TxtLoaderUtils';\nimport ChapterSelect from './ChapterSelect';\nimport chapConstants, { chapterIndexStyle, chapterTitleStyle } from './ChapterSelectConstants';\n\n/**\n * Create a chapter selection and formats it.\n *\n * It will use the chapter preview background and set it as the\n * chapter selection background.\n *\n * Additionally, this method attach a 'Play/Continue' button and\n * 'Reset Progress' button to the chapter selection; with an already\n * set up button functionality.\n *\n * @param scene scene for the chapter selection container to attach to\n * @param title title of the chapter\n * @param imageUrl url of the preview image\n * @param index index of chapter\n * @param lastCheckpointsIdx last checkpoint to continue users' progression from\n */\nexport function createChapter(\n  scene: ChapterSelect,\n  { title, imageUrl }: GameChapter,\n  index: number\n) {\n  const [x, y] = getCoorByChapter(index);\n  const chapterContainer = new Phaser.GameObjects.Container(scene, x, y);\n\n  const chapterDone =\n    index <= SourceAcademyGame.getInstance().getSaveManager().getLargestCompletedChapterNum();\n\n  // Chapter Preview\n  const chapterPreview = new Phaser.GameObjects.Image(scene, 0, 0, imageUrl).setDisplaySize(\n    chapConstants.imageRect.width,\n    chapConstants.imageRect.height\n  );\n\n  // Chapter Frame + blue tint\n  const chapterFrame = new Phaser.GameObjects.Sprite(\n    scene,\n    chapConstants.frame.xOffset,\n    chapConstants.frame.yOffset,\n    ImageAssets.chapterSelectFrame.key\n  ).setScale(0.99 * chapConstants.imageScale.x, 0.99 * chapConstants.imageScale.y);\n\n  // Chapter completed rectangle\n  const chapCompleteRect = new Phaser.GameObjects.Rectangle(\n    scene,\n    0,\n    chapConstants.chapComplete.y,\n    chapConstants.imageRect.width,\n    chapConstants.chapComplete.height,\n    0\n  )\n    .setOrigin(0.5)\n    .setAlpha(0.7)\n    .setInteractive()\n    .setVisible(chapterDone);\n\n  // Chapter complete text\n  const chapCompleteText = createBitmapText(\n    scene,\n    chapConstants.chapComplete.text,\n    { x: 0, y: chapConstants.chapComplete.y, oriX: 0.5, oriY: 0.5 },\n    chapterIndexStyle\n  ).setVisible(chapterDone);\n\n  // Chapter Action Popup\n  const chapterRepeatHover = new CommonTextHover(\n    scene,\n    chapConstants.resetButton.xOffset + 8,\n    chapConstants.resetButton.yOffset - 20,\n    'Reset progress'\n  );\n  const chapterContinueHover = new CommonTextHover(\n    scene,\n    chapConstants.playButton.xOffset + 8,\n    chapConstants.playButton.yOffset - 20,\n    'Play/Continue'\n  );\n\n  // Chapter Actions\n  const chapterRepeat = createButton(scene, {\n    assetKey: ImageAssets.chapterRepeatButton.key,\n    onUp: async () => await callGameManagerOnTxtLoad(false, index, 0),\n    onHover: () => chapterRepeatHover.setVisible(true),\n    onOut: () => chapterRepeatHover.setVisible(false)\n  })\n    .setPosition(chapConstants.resetButton.xOffset, chapConstants.resetButton.yOffset)\n    .setScale(chapConstants.buttons.scale);\n\n  const lastCheckpointPlayed = SourceAcademyGame.getInstance()\n    .getSaveManager()\n    .getChapterSaveState(index).lastCheckpointPlayed;\n\n  const chapterContinue = createButton(scene, {\n    assetKey: ImageAssets.chapterContinueButton.key,\n    onUp: async () => await callGameManagerOnTxtLoad(true, index, lastCheckpointPlayed),\n    onHover: () => chapterContinueHover.setVisible(true),\n    onOut: () => chapterContinueHover.setVisible(false)\n  })\n    .setPosition(chapConstants.playButton.xOffset, chapConstants.playButton.yOffset)\n    .setScale(chapConstants.buttons.scale);\n\n  // Chapter Text\n  const chapterIndexText = createBitmapText(\n    scene,\n    `Chapter ${index}`,\n    chapConstants.indexTextConfig,\n    chapterIndexStyle\n  );\n\n  const chapterTitleText = createBitmapText(\n    scene,\n    title,\n    chapConstants.titleTextConfig,\n    chapterTitleStyle\n  );\n\n  const chapterAccessible =\n    index <= SourceAcademyGame.getInstance().getSaveManager().getLargestCompletedChapterNum() + 1;\n\n  const blackTint = new Phaser.GameObjects.Rectangle(\n    scene,\n    0,\n    0,\n    chapConstants.imageRect.width,\n    chapConstants.imageRect.height,\n    0\n  )\n    .setOrigin(0.5)\n    .setAlpha(chapterAccessible ? 0 : 0.8)\n    .setInteractive();\n\n  chapterContainer.add([\n    chapterPreview,\n    chapterFrame,\n    chapCompleteRect,\n    chapCompleteText,\n    chapterRepeat,\n    chapterContinue,\n    chapterRepeatHover,\n    chapterContinueHover,\n    chapterIndexText,\n    chapterTitleText,\n    blackTint\n  ]);\n\n  return chapterContainer;\n}\n\nfunction getCoorByChapter(chapterNum: number) {\n  const page = Math.floor(chapterNum / chapConstants.grid.chapPerPage);\n  chapterNum %= chapConstants.grid.chapPerPage;\n  const row = Math.floor(chapterNum / chapConstants.grid.chapPerRow);\n  const col = chapterNum % chapConstants.grid.chapPerRow;\n\n  const centreCol = (chapConstants.grid.chapPerRow - 1) / 2;\n  const centreRow = (chapConstants.grid.chapPerCol - 1) / 2;\n\n  let x = page * screenSize.x + screenCenter.x;\n  x += (col - centreCol) * (chapConstants.imageRect.width + chapConstants.grid.chapGapX);\n  let y = screenCenter.y;\n  y += (row - centreRow) * (chapConstants.imageRect.height + chapConstants.grid.chapGapY);\n\n  return [x, y];\n}\n","import { screenCenter, screenSize } from 'src/features/game/commons/CommonConstants';\nimport { mandatory, toS3Path } from 'src/features/game/utils/GameUtils';\n\nimport ImageAssets from '../../assets/ImageAssets';\nimport CommonBackButton from '../../commons/CommonBackButton';\nimport { addLoadingScreen } from '../../effects/LoadingScreen';\nimport GameLayerManager from '../../layer/GameLayerManager';\nimport { Layer } from '../../layer/GameLayerTypes';\nimport SourceAcademyGame from '../../SourceAcademyGame';\nimport { createButton } from '../../utils/ButtonUtils';\nimport { loadImage } from '../../utils/LoaderUtils';\nimport { createBitmapText } from '../../utils/TextUtils';\nimport chapConstants, { pageNumberStyle } from './ChapterSelectConstants';\nimport { createChapter } from './ChapterSelectHelper';\n\n/**\n * The Chapter Select scene.\n * Player is able to choose which chapter to play from here.\n */\nclass ChapterSelect extends Phaser.Scene {\n  public layerManager?: GameLayerManager;\n\n  private chaptersContainer: Phaser.GameObjects.Container | undefined;\n  private backButtonContainer: Phaser.GameObjects.Container | undefined;\n  private pageNumberText: Phaser.GameObjects.BitmapText | undefined;\n  private targetPage: number;\n\n  constructor() {\n    super('ChapterSelect');\n\n    this.chaptersContainer = undefined;\n    this.backButtonContainer = undefined;\n    this.pageNumberText = undefined;\n    this.targetPage = 0; // First page is page 0 (but is displayed as page 1)\n  }\n\n  public preload() {\n    addLoadingScreen(this);\n  }\n\n  public async create() {\n    SourceAcademyGame.getInstance().setCurrentSceneRef(this);\n    this.layerManager = new GameLayerManager(this);\n    await this.preloadChapterAssets();\n    this.renderBackground();\n    this.renderChapters();\n  }\n\n  public update() {\n    if (!this.chaptersContainer) return;\n\n    const targetX = -this.targetPage * screenSize.x;\n    if (this.chaptersContainer.x > targetX) {\n      // Scroll right\n      const newXPos = this.chaptersContainer.x - chapConstants.scrollSpeed;\n      this.chaptersContainer.x = Math.max(newXPos, targetX);\n    } else if (targetX > this.chaptersContainer.x) {\n      // Scroll left\n      const newXPos = this.chaptersContainer.x + chapConstants.scrollSpeed;\n      this.chaptersContainer.x = Math.min(newXPos, targetX);\n    }\n  }\n\n  /**\n   * Clean up of related managers.\n   */\n  public cleanUp() {\n    this.getLayerManager().clearAllLayers();\n  }\n\n  /**\n   * Load the chapter previews assets to be shown.\n   */\n  private async preloadChapterAssets() {\n    await Promise.all(\n      this.getGameChapters().map(\n        async chapterDetail =>\n          await loadImage(this, chapterDetail.imageUrl, toS3Path(chapterDetail.imageUrl, true))\n      )\n    );\n  }\n\n  /**\n   * Render the background of this scene.\n   */\n  private renderBackground() {\n    const background = new Phaser.GameObjects.Image(\n      this,\n      screenCenter.x,\n      screenCenter.y,\n      ImageAssets.spaceshipBg.key\n    );\n    const blackOverlay = new Phaser.GameObjects.Rectangle(\n      this,\n      screenCenter.x,\n      screenCenter.y,\n      screenSize.x,\n      screenSize.y,\n      0\n    ).setAlpha(0.3);\n    this.getLayerManager().addToLayer(Layer.Background, background);\n    this.getLayerManager().addToLayer(Layer.Background, blackOverlay);\n  }\n\n  /**\n   * Render all the chapter selections and UI elements\n   * (the gray frame, the left and right arrow, back button, page number)\n   */\n  private renderChapters() {\n    this.backButtonContainer = new CommonBackButton(this, () => {\n      this.cleanUp();\n      this.scene.start('MainMenu');\n    });\n    this.chaptersContainer = this.createChaptersContainer();\n\n    this.pageNumberText = createBitmapText(\n      this,\n      `1 / ${this.numPages()}`,\n      chapConstants.pageNumberTextConfig,\n      pageNumberStyle\n    );\n\n    // Prepare to autoscroll to smallest incomplete chapter\n    const latestChapter = Math.min(\n      SourceAcademyGame.getInstance().getSaveManager().getLargestCompletedChapterNum() + 1,\n      this.getGameChapters().length - 1\n    );\n    this.targetPage = Math.floor(latestChapter / chapConstants.grid.chapPerPage);\n    if (this.targetPage < 0) {\n      // Only happens when this.getGameChapters().length === 0\n      this.targetPage = 0;\n    }\n    this.pageNumberText.setText(`${this.targetPage + 1} / ${this.numPages()}`);\n\n    const border = new Phaser.GameObjects.Image(\n      this,\n      screenCenter.x,\n      screenCenter.y,\n      ImageAssets.chapterSelectBorder.key\n    );\n\n    const leftArrow = createButton(this, {\n      assetKey: ImageAssets.chapterSelectArrow.key,\n      onUp: () => this.scrollPrevPage()\n    }).setPosition(screenCenter.x - chapConstants.arrow.xOffset, screenCenter.y);\n\n    const rightArrow = createButton(this, {\n      assetKey: ImageAssets.chapterSelectArrow.key,\n      onUp: () => this.scrollNextPage()\n    })\n      .setPosition(screenCenter.x + chapConstants.arrow.xOffset, screenCenter.y)\n      .setScale(-1, 1);\n\n    this.getLayerManager().addToLayer(Layer.UI, this.chaptersContainer);\n    this.getLayerManager().addToLayer(Layer.UI, this.backButtonContainer);\n    this.getLayerManager().addToLayer(Layer.UI, this.pageNumberText);\n    this.getLayerManager().addToLayer(Layer.UI, border);\n    this.getLayerManager().addToLayer(Layer.UI, leftArrow);\n    this.getLayerManager().addToLayer(Layer.UI, rightArrow);\n  }\n\n  /**\n   * Create a chapter selection based on its detail; as well as\n   * attach it with the necessary information (user progress).\n   *\n   * The information will be used/mutated depending on whether\n   * the user decides to continue or reset the progress.\n   */\n  private createChaptersContainer() {\n    const chaptersContainer = new Phaser.GameObjects.Container(this, 0, 0);\n    chaptersContainer\n      .add(\n        this.getGameChapters().map((chapterDetail, chapterIndex) => {\n          return createChapter(this, chapterDetail, chapterIndex);\n        })\n      )\n      .sort('depth')\n      .reverse(); // Ensures hover text correctly render over other objects in container\n    return chaptersContainer;\n  }\n\n  private getGameChapters = () => SourceAcademyGame.getInstance().getGameChapters();\n\n  /**\n   * Returns the number of pages of chapters\n   */\n  private numPages() {\n    const pages = Math.ceil(this.getGameChapters().length / chapConstants.grid.chapPerPage);\n    return Math.max(pages, 1); // Always have at least 1 page, even when 0 chapters\n  }\n\n  /**\n   * Scroll the screen to the previous page of chapters\n   */\n  private scrollPrevPage() {\n    this.targetPage = Math.max(this.targetPage - 1, 0);\n    this.pageNumberText?.setText(`${this.targetPage + 1} / ${this.numPages()}`);\n  }\n\n  /**\n   * Scroll the screen to the next page of chapters\n   */\n  private scrollNextPage() {\n    const numPages = this.numPages();\n    this.targetPage = Math.min(this.targetPage + 1, numPages - 1);\n    this.pageNumberText?.setText(`${this.targetPage + 1} / ${numPages}`);\n  }\n\n  public getLayerManager = () => mandatory(this.layerManager);\n}\n\nexport default ChapterSelect;\n","import FontAssets from '../../assets/FontAssets';\nimport { screenCenter } from '../../commons/CommonConstants';\nimport { BitmapFontStyle } from '../../commons/CommonTypes';\n\nexport const transitionTextStyle: BitmapFontStyle = {\n  key: FontAssets.alienCowsFont.key,\n  size: 80,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nconst tweenDuration = 1500;\n\nconst CheckpointConstants = {\n  text: { chapter: 'Chapter completed.', checkpoint: 'Checkpoint reached.' },\n  transitionTextConfig: { x: screenCenter.x, y: screenCenter.y, oriX: 0.5, oriY: 0.5 },\n  tweenDuration: tweenDuration,\n  entryTween: {\n    alpha: 1,\n    duration: tweenDuration,\n    ease: 'Power2'\n  },\n  exitTween: {\n    alpha: 0,\n    duration: tweenDuration,\n    ease: 'Power2'\n  }\n};\n\nexport default CheckpointConstants;\n","import { GameChapter } from '../../chapter/GameChapterTypes';\nimport SourceAcademyGame, { GameType } from '../../SourceAcademyGame';\nimport { sleep } from '../../utils/GameUtils';\nimport { createBitmapText } from '../../utils/TextUtils';\nimport { callGameManagerForSim, callGameManagerOnTxtLoad } from '../../utils/TxtLoaderUtils';\nimport CheckpointConstants, { transitionTextStyle } from './CheckpointTransitionConstants';\n\n/**\n * This scene is triggered in between checkpoints/chapters.\n * From user's perspective, it is when the in-between scene that is triggered\n * after they completed a checkpoint.\n *\n * Internally, we use this scene to fully load the next checkpoint,\n * before finally loading the next scene.\n *\n * In story simulator, the next checkpoint is loaded based on the\n * chapterSimStack using the callGameManagerForSim function.\n *\n * We cannot load these informations at the start of GameManager as\n * it can alter the sequencing of preload() and create() in the GameManager.\n */\nclass CheckpointTransition extends Phaser.Scene {\n  constructor() {\n    super('CheckpointTransition');\n  }\n\n  public preload() {\n    SourceAcademyGame.getInstance().setCurrentSceneRef(this);\n  }\n\n  public async create() {\n    if (SourceAcademyGame.getInstance().isGameType(GameType.Simulator)) {\n      await this.showTransitionText(CheckpointConstants.text.checkpoint);\n      await callGameManagerForSim();\n      return;\n    }\n\n    // Fetch all the necessary informations: save state and chapter details.\n    const loadedGameState = SourceAcademyGame.getInstance().getSaveManager().getFullSaveState();\n    const chapterDetails = SourceAcademyGame.getInstance().getGameChapters();\n\n    const [currChapter, currCheckpoint] = loadedGameState.userSaveState.recentlyPlayedCheckpoint;\n\n    if (this.isLastCheckpoint(chapterDetails, currChapter, currCheckpoint)) {\n      // If it is the last checkpoint, we mark that chapter is completed\n      await SourceAcademyGame.getInstance().getSaveManager().saveChapterComplete(currChapter);\n      await this.showTransitionText(CheckpointConstants.text.chapter);\n      if (this.isLastChapter(chapterDetails, currChapter)) {\n        // No more chapter, transition to chapter select instead\n        this.scene.start('ChapterSelect');\n        return;\n      } else {\n        // Transition to the next chapter, first checkpoint\n        await callGameManagerOnTxtLoad(true, currChapter + 1, 0);\n        return;\n      }\n    } else {\n      // Transition to the next checkpoint\n      await this.showTransitionText(CheckpointConstants.text.checkpoint);\n      await callGameManagerOnTxtLoad(false, currChapter, currCheckpoint + 1);\n      return;\n    }\n  }\n\n  /**\n   * In-game text to be shown during the checkpoint transition.\n   *\n   * @param text text to show\n   */\n  private async showTransitionText(text: string) {\n    const transitionText = createBitmapText(\n      this,\n      text,\n      CheckpointConstants.transitionTextConfig,\n      transitionTextStyle\n    ).setAlpha(0);\n\n    this.add.existing(transitionText);\n\n    // Fade in\n    this.tweens.add({\n      targets: transitionText,\n      ...CheckpointConstants.entryTween\n    });\n\n    await sleep(CheckpointConstants.tweenDuration * 2);\n\n    // Fade out\n    this.tweens.add({\n      targets: transitionText,\n      ...CheckpointConstants.exitTween\n    });\n\n    await sleep(CheckpointConstants.tweenDuration);\n  }\n\n  /**\n   * Checks whether the given checkpoint is the last checkpoint\n   * of the chapter.\n   *\n   * @param chapterDetails the entire story collection of chapters' information\n   * @param currChapter current chapter\n   * @param currCheckpoint current checkpoint\n   */\n  private isLastCheckpoint(\n    chapterDetails: GameChapter[],\n    currChapter: number,\n    currCheckpoint: number\n  ) {\n    return currCheckpoint >= chapterDetails[currChapter].filenames.length - 1;\n  }\n\n  /**\n   * Checks whether the given chapter is the last chapter of the story.\n   *\n   * @param chapterDetails the entire story collection of chapters' information\n   * @param currChapter current chapter\n   */\n  public isLastChapter(chapterDetails: GameChapter[], currChapter: number) {\n    return currChapter >= chapterDetails.length - 1;\n  }\n}\n\nexport default CheckpointTransition;\n","import FontAssets from '../../assets/FontAssets';\nimport { screenCenter, screenSize } from '../../commons/CommonConstants';\nimport { BitmapFontStyle } from '../../commons/CommonTypes';\n\nexport const mainMenuStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 30,\n  align: Phaser.GameObjects.BitmapText.ALIGN_RIGHT\n};\n\nconst bannerShow = 200;\nconst bannerHide = 300;\n\nconst MainMenuConstants = {\n  text: {\n    chapterSelect: 'Play Chapter',\n    studentRoom: 'Go to My Room',\n    awards: 'Awards Hall',\n    settings: 'Settings',\n    bindings: 'Key Bindings'\n  },\n  button: { ySpace: screenSize.y * 0.5 },\n  buttonTextConfig: { x: 600, y: 0, oriX: 1.0, oriY: 0.1 },\n  banner: { xHide: bannerHide },\n  onFocusTween: {\n    x: screenCenter.x + bannerShow,\n    duration: 200,\n    ease: 'Power2'\n  },\n  outFocusTween: {\n    x: screenCenter.x + bannerHide,\n    duration: 200,\n    ease: 'Power2'\n  },\n  saBanner: { x: screenSize.x * 0.3, y: screenSize.y * 0.9 }\n};\n\nexport default MainMenuConstants;\n","import ImageAssets from '../../assets/ImageAssets';\nimport SoundAssets from '../../assets/SoundAssets';\nimport { screenCenter, screenSize } from '../../commons/CommonConstants';\nimport { blackScreen } from '../../effects/FadeEffect';\nimport { putWorkerMessage } from '../../effects/WorkerMessage';\nimport GameLayerManager from '../../layer/GameLayerManager';\nimport { Layer } from '../../layer/GameLayerTypes';\nimport SourceAcademyGame from '../../SourceAcademyGame';\nimport { createButton } from '../../utils/ButtonUtils';\nimport { mandatory } from '../../utils/GameUtils';\nimport { calcTableFormatPos, Direction } from '../../utils/StyleUtils';\nimport MainMenuConstants, { mainMenuStyle } from './MainMenuConstants';\n\n/**\n * Main Menu\n *\n * User can navigate to other scenes from here.\n */\nclass MainMenu extends Phaser.Scene {\n  private layerManager?: GameLayerManager;\n\n  constructor() {\n    super('MainMenu');\n  }\n\n  public async create() {\n    SourceAcademyGame.getInstance().setCurrentSceneRef(this);\n    this.layerManager = new GameLayerManager(this);\n    this.renderBackground();\n    this.renderOptionButtons();\n\n    putWorkerMessage(this, 'T', screenCenter.x * 1.12, screenCenter.y * 1.1);\n\n    SourceAcademyGame.getInstance().getSoundManager().playBgMusic(SoundAssets.galacticHarmony.key);\n  }\n\n  /**\n   * Render background image for the main menu.\n   */\n  private renderBackground() {\n    const backgroundImg = new Phaser.GameObjects.Image(\n      this,\n      screenCenter.x,\n      screenCenter.y,\n      ImageAssets.spaceshipBg.key\n    ).setDisplaySize(screenSize.x, screenSize.y);\n    const blackOverlay = blackScreen(this).setAlpha(0.15);\n    const saBanner = new Phaser.GameObjects.Image(\n      this,\n      MainMenuConstants.saBanner.x,\n      MainMenuConstants.saBanner.y,\n      ImageAssets.saBanner.key\n    ).setAlpha(0.7);\n    this.getLayerManager().addToLayer(Layer.Background, backgroundImg);\n    this.getLayerManager().addToLayer(Layer.Background, blackOverlay);\n    this.getLayerManager().addToLayer(Layer.Background, saBanner);\n  }\n\n  /**\n   * Render all the buttons for the main menu.\n   * Selection of buttons is detailed at getOptionButtons().\n   */\n  private renderOptionButtons() {\n    const optionsContainer = new Phaser.GameObjects.Container(this, 0, 0);\n    const buttons = this.getOptionButtons();\n\n    const buttonPositions = calcTableFormatPos({\n      direction: Direction.Column,\n      numOfItems: buttons.length,\n      maxYSpace: MainMenuConstants.button.ySpace\n    });\n\n    optionsContainer.add(\n      buttons.map((button, index) =>\n        this.createOptionButton(\n          button.text,\n          buttonPositions[index][0] + MainMenuConstants.banner.xHide,\n          buttonPositions[index][1],\n          button.callback\n        )\n      )\n    );\n\n    this.getLayerManager().addToLayer(Layer.UI, optionsContainer);\n  }\n\n  /**\n   * Format a main menu button with the given text; attach a callback\n   * and position it at the given xPos and yPos.\n   *\n   * @param text text to be displayed on the button\n   * @param xPos x position of the button\n   * @param yPos y position of the button\n   * @param callback callback to be attached to the button\n   */\n  private createOptionButton(text: string, xPos: number, yPos: number, callback: any) {\n    // Animation to trigger on Hover and off Hover\n    const tweenOnHover = (target: Phaser.GameObjects.Container) => {\n      this.tweens.add({\n        targets: target,\n        ...MainMenuConstants.onFocusTween\n      });\n    };\n    const tweenOffHover = (target: Phaser.GameObjects.Container) => {\n      this.tweens.add({\n        targets: target,\n        ...MainMenuConstants.outFocusTween\n      });\n    };\n\n    // Create button with main menu style\n    const optButton: Phaser.GameObjects.Container = createButton(this, {\n      assetKey: ImageAssets.mainMenuOptBanner.key,\n      message: text,\n      textConfig: MainMenuConstants.buttonTextConfig,\n      bitMapTextStyle: mainMenuStyle,\n      onUp: callback,\n      onHover: () => tweenOnHover(optButton),\n      onOut: () => tweenOffHover(optButton),\n      onHoverEffect: false\n    }).setPosition(xPos, yPos);\n\n    return optButton;\n  }\n\n  /**\n   * Return all the buttons available at main menu,\n   * as well as their callbacks.\n   */\n  private getOptionButtons() {\n    return [\n      {\n        text: MainMenuConstants.text.chapterSelect,\n        callback: () => {\n          this.getLayerManager().clearAllLayers();\n          this.scene.start('ChapterSelect');\n        }\n      },\n      {\n        text: MainMenuConstants.text.awards,\n        callback: () => {\n          this.getLayerManager().clearAllLayers();\n          this.scene.start('AwardsHall');\n        }\n      },\n      {\n        text: MainMenuConstants.text.studentRoom,\n        callback: () => {\n          this.getLayerManager().clearAllLayers();\n          this.scene.start('RoomPreview');\n        }\n      },\n      {\n        text: MainMenuConstants.text.settings,\n        callback: () => {\n          this.getLayerManager().clearAllLayers();\n          this.scene.start('Settings');\n        }\n      },\n      {\n        text: MainMenuConstants.text.bindings,\n        callback: () => {\n          this.getLayerManager().clearAllLayers();\n          this.scene.start('Bindings');\n        }\n      }\n    ];\n  }\n  public getLayerManager = () => mandatory(this.layerManager);\n}\n\nexport default MainMenu;\n","import FontAssets from '../../assets/FontAssets';\nimport { screenSize } from '../../commons/CommonConstants';\nimport { BitmapFontStyle } from '../../commons/CommonTypes';\n\nexport const roomDefaultCode = `\nimport { prepend_remote_url, get_screen_width, get_screen_height, load_image, create_image, create_text, create_rect, add, set_display_size, set_alpha, set_origin } from 'game';\n\nfunction preload() {\n    load_image(\"galaxy\", prepend_remote_url(\"/locations/galaxy/normal.png\"));\n}\n\nfunction create() {\n    const width = get_screen_width();\n    const height = get_screen_height();\n    const centre_x = width / 2;\n    const centre_y = height / 2;\n\n    const image = create_image(centre_x, centre_y, \"galaxy\");\n    const image_resized = set_display_size(image, width, height);\n\n    const black_tint = create_rect(centre_x, centre_y, width, height, 0x000011);\n    const black_tint_alpha = set_alpha(black_tint, 0.5);\n\n    const text = create_text(centre_x, centre_y, \"Unable to fetch mission!\");\n    const text_repos = set_origin(text, 0.5, 0.5);\n\n    add(image_resized);\n    add(black_tint_alpha);\n    add(text_repos);\n}\n\nfunction update() {}\n`;\n\nexport const verifiedStyle: BitmapFontStyle = {\n  key: FontAssets.pixelFont.key,\n  size: 20,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nexport const RoomConstants = {\n  assessmentNumber: 'MYROOM',\n  verifiedText: 'VERIFIED',\n  tag: { width: 128, height: 50 },\n  hoverTagTextConfig: { x: 64, y: 0, oriX: 0.5, oriY: 0.55 },\n  refreshButton: { x: 0.95 * screenSize.x, y: 0.92 * screenSize.y }\n};\n","import { Assessment, IProgrammingQuestion } from 'src/commons/assessment/AssessmentTypes';\nimport { getAssessment, getAssessmentOverviews } from 'src/commons/sagas/RequestsSaga';\n\nimport ImageAssets from '../../assets/ImageAssets';\nimport GameModeSequence from '../../mode/sequence/GameModeSequence';\nimport { GamePhaseType } from '../../phase/GamePhaseTypes';\nimport SourceAcademyGame from '../../SourceAcademyGame';\nimport { HexColor } from '../../utils/StyleUtils';\nimport { createBitmapText } from '../../utils/TextUtils';\nimport RoomPreview from './RoomPreview';\nimport { RoomConstants, roomDefaultCode, verifiedStyle } from './RoomPreviewConstants';\n\n/**\n * Async function that obtains students code for Create-My-Room mission\n *\n * @param {AccountInfo} accInfo - students' account information\n * @returns {Promise<string>} - promise of students code\n */\nexport async function getRoomPreviewCode(): Promise<string> {\n  const roomAssessmentId = await getRoomAssessmentId();\n  if (!roomAssessmentId) {\n    // Get default room code.\n    return getStudentRoomCode(null);\n  }\n  const mission = await getAssessment(\n    roomAssessmentId,\n    SourceAcademyGame.getInstance().getAccountInfo()\n  );\n  const studentCode = getStudentRoomCode(mission);\n  return studentCode;\n}\n\n/**\n * Function that generates the correct assessment id of students\n *\n * @param {AccountInfo} accInfo - students' account information\n */\nasync function getRoomAssessmentId() {\n  const assessments = await getAssessmentOverviews(\n    SourceAcademyGame.getInstance().getAccountInfo()\n  );\n  const roomAssessment = (assessments || []).find(\n    assessment => assessment.number === RoomConstants.assessmentNumber\n  );\n  return roomAssessment ? roomAssessment.id : null;\n}\n\n/**\n * Fetches the student code based on the mission.\n * If student has not attempted the mission; will return\n * the answer template instead.\n *\n * If the mission is invalid (e.g. invalid ID, typo), the\n * default code for the room will be returned instead.\n *\n * @param mission\n */\nfunction getStudentRoomCode(mission: Assessment | null) {\n  if (mission) {\n    const progQn = mission.questions[0] as IProgrammingQuestion;\n    const answer = progQn.answer;\n    return answer ? (answer as string) : progQn.solutionTemplate;\n  }\n  return roomDefaultCode;\n}\n\n/**\n * CMR Game Phases for the phase manager.\n */\nexport const createCMRGamePhases = () => {\n  return new Map([[GamePhaseType.None, new GameModeSequence()]]);\n};\n\n/**\n * Create a verification container.\n *\n * @param scene room preview scene\n * @returns {Phaser.GameObjects.Container} verification container\n */\nexport const createVerifiedHoverContainer = (scene: RoomPreview) => {\n  const hoverContainer = new Phaser.GameObjects.Container(scene, 0, 0);\n\n  const hoverTextBg = new Phaser.GameObjects.Rectangle(\n    scene,\n    0,\n    0,\n    RoomConstants.tag.width,\n    RoomConstants.tag.height,\n    HexColor.darkBlue\n  )\n    .setOrigin(0.0, 0.5)\n    .setAlpha(0.8);\n\n  const hoverTextFrame = new Phaser.GameObjects.Sprite(\n    scene,\n    0,\n    0,\n    ImageAssets.verifiedFrame.key\n  ).setOrigin(0.0, 0.5);\n\n  const hoverLine = new Phaser.GameObjects.Rectangle(\n    scene,\n    0,\n    -hoverTextBg.height * 0.5,\n    hoverTextBg.width,\n    hoverTextBg.height * 0.05,\n    HexColor.offWhite\n  ).setOrigin(0.0, 0.0);\n\n  const hoverText = createBitmapText(\n    scene,\n    RoomConstants.verifiedText,\n    RoomConstants.hoverTagTextConfig,\n    verifiedStyle\n  ).setBlendMode(Phaser.BlendModes.DIFFERENCE);\n\n  scene.tweens.add({\n    targets: hoverLine,\n    alpha: 0.2,\n    y: hoverTextBg.height * 0.35,\n    duration: 2000,\n    ease: 'Power0',\n    yoyo: true,\n    loop: -1\n  });\n\n  hoverContainer.add([hoverTextBg, hoverText, hoverLine, hoverTextFrame]);\n  hoverContainer.setVisible(false);\n  return hoverContainer;\n};\n","import { Context, runInContext } from 'c-slang';\nimport { Variant } from 'c-slang/dist/types';\nimport { createContext } from 'src/commons/utils/JsSlangHelper';\n\nimport ImageAssets from '../../assets/ImageAssets';\nimport { getAwardProp } from '../../awards/GameAwardsHelper';\nimport GameAwardsManager from '../../awards/GameAwardsManager';\nimport { Constants, screenCenter, screenSize } from '../../commons/CommonConstants';\nimport CommonTextHover from '../../commons/CommonTextHover';\nimport { ItemId } from '../../commons/CommonTypes';\nimport GameDashboardManager from '../../dashboard/GameDashboardManager';\nimport { DashboardPage } from '../../dashboard/GameDashboardTypes';\nimport { addLoadingScreen } from '../../effects/LoadingScreen';\nimport GameEscapeManager from '../../escape/GameEscapeManager';\nimport GameInputManager from '../../input/GameInputManager';\nimport GameLayerManager from '../../layer/GameLayerManager';\nimport { Layer } from '../../layer/GameLayerTypes';\nimport GamePhaseManager from '../../phase/GamePhaseManager';\nimport { GamePhaseType } from '../../phase/GamePhaseTypes';\nimport SourceAcademyGame from '../../SourceAcademyGame';\nimport GameToolbarManager from '../../toolbar/GameToolbarManager';\nimport { createButton } from '../../utils/ButtonUtils';\nimport { mandatory, toS3Path } from '../../utils/GameUtils';\nimport { loadImage, loadSound, loadSpritesheet } from '../../utils/LoaderUtils';\nimport { resizeOverflow } from '../../utils/SpriteUtils';\nimport { RoomConstants, roomDefaultCode } from './RoomPreviewConstants';\nimport { createCMRGamePhases, createVerifiedHoverContainer } from './RoomPreviewHelper';\n\n/**\n * This scene uses the students code as part of its code.\n *\n * Additionally, the scene shares some common functionality as\n * GameManager, in that it incorporates escape menu and collectible\n * menu.\n *\n * Student code is not executed within a layer manager as\n * there are features that do not work well with container\n * e.g. mask, animations.\n *\n * Hence, student code will be executed and added to the scene\n * as per normal. Meanwhile, UI parts of this scene will still\n * make use of the layer manager; separate from student code.\n */\nexport default class RoomPreview extends Phaser.Scene {\n  private layerManager?: GameLayerManager;\n  private inputManager?: GameInputManager;\n  private phaseManager?: GamePhaseManager;\n  private escapeManager?: GameEscapeManager;\n  private collectibleManager?: GameAwardsManager;\n  private achievementManager?: GameAwardsManager;\n  private toolbarManager?: GameToolbarManager;\n  private dashboardManager?: GameDashboardManager;\n\n  private studentCode: string;\n  private preloadImageMap: Map<string, string>;\n  private preloadSoundMap: Map<string, string>;\n  private preloadSpritesheetMap: Map<string, [string, object]>;\n\n  private verifCont: Phaser.GameObjects.Container | undefined;\n\n  private context?: Context;\n\n  constructor() {\n    super('RoomPreview');\n    this.preloadImageMap = new Map<string, string>();\n    this.preloadSoundMap = new Map<string, string>();\n    this.preloadSpritesheetMap = new Map<string, [string, object]>();\n    this.studentCode = roomDefaultCode;\n  }\n\n  public init() {\n    SourceAcademyGame.getInstance().setCurrentSceneRef(this);\n    this.studentCode = SourceAcademyGame.getInstance().getRoomCode();\n    this.createContext();\n  }\n\n  public preload() {\n    addLoadingScreen(this);\n\n    // Initialise one verified tag to be used throughout the CMR\n    this.verifCont = createVerifiedHoverContainer(this);\n  }\n\n  public async create() {\n    // Run student code once to update the context\n    await this.eval(this.studentCode);\n\n    this.renderDefaultBackground();\n\n    /**\n     * We don't use .eval('preload();') at preload() as\n     * .eval() is not awaited by the preload() method i.e. it does not\n     * wait for student's preload function to finish.\n     *\n     * Instead, the students' 'preload()' function simply populate a map\n     * of assets key and path to be loaded.\n     *\n     * We await the students .eval('preload();') at create()\n     * to ensure that the .eval('preload();') is fully resolved.\n     */\n    await this.eval(`preload();`);\n\n    // Preload all necessary assets\n    await Promise.all(\n      Array.from(this.preloadImageMap).map(async ([key, path]) => {\n        await loadImage(this, key, path);\n      })\n    );\n    await Promise.all(\n      Array.from(this.preloadSoundMap).map(async ([key, path]) => {\n        await loadSound(this, key, path);\n      })\n    );\n    await Promise.all(\n      Array.from(this.preloadSpritesheetMap).map(async ([key, [path, config]]) => {\n        await loadSpritesheet(this, key, path, config);\n      })\n    );\n\n    const roomRefreshHover = new CommonTextHover(\n      this,\n      RoomConstants.refreshButton.x - 200,\n      RoomConstants.refreshButton.y - 30,\n      'Refresh Room'\n    );\n\n    const refreshButton = createButton(this, {\n      assetKey: ImageAssets.chapterRepeatButton.key,\n      onUp: async () => {\n        await SourceAcademyGame.getInstance().loadRoomCode();\n        this.studentCode = SourceAcademyGame.getInstance().getRoomCode();\n        this.getLayerManager().clearAllLayers();\n        this.sound.stopAll();\n        this.scene.restart();\n      },\n      onHover: () => roomRefreshHover.setVisible(true),\n      onOut: () => roomRefreshHover.setVisible(false)\n    }).setPosition(RoomConstants.refreshButton.x, RoomConstants.refreshButton.y);\n\n    // Execute create\n    await this.eval(`create();`);\n    SourceAcademyGame.getInstance().getSoundManager().playBgMusic(Constants.nullInteractionId);\n\n    // Initialise managers after students `create()`\n    // This is primarily to ensure layer manager's layer\n    // are on top of the displayed room objects\n    this.initialiseManagers();\n\n    // Binding keyboard triggers require managers to be initialised\n    this.bindKeyboardTriggers();\n\n    // Add verified tag\n    this.getLayerManager().addToLayer(Layer.UI, this.getVerifCont());\n    this.getLayerManager().addToLayer(Layer.UI, refreshButton);\n    this.getLayerManager().addToLayer(Layer.UI, roomRefreshHover);\n\n    this.getToolbarManager().renderToolbarContainer();\n  }\n\n  public update() {\n    /**\n     * runInContext appends new frame everytime it is run,\n     * which leads to out of memory error when we run\n     * runInContext as often as FPS of the game for `update()`.\n     *\n     * Hence, we replace the scope instead of appending\n     * new one each time.\n     */\n    this.eval(`update();`);\n  }\n\n  public createContext() {\n    this.context = createContext([], 'playground', Variant.DEFAULT);\n    this.context.moduleContexts.game = {\n      tabs: null,\n      state: {\n        scene: this,\n        preloadImageMap: this.preloadImageMap,\n        preloadSoundMap: this.preloadSoundMap,\n        preloadSpritesheetMap: this.preloadSpritesheetMap,\n        remotePath: (file: string) => toS3Path(file, true),\n        screenSize: screenSize,\n        createAward: (x: number, y: number, key: ItemId) => this.createAward(x, y, key)\n      }\n    };\n  }\n\n  private async eval(code: string) {\n    // runInContext also automatically updates the context\n    await runInContext(code, this.context!);\n  }\n\n  /**\n   * Bind the escape menu and dashboard to keyboard keys.\n   */\n  private bindKeyboardTriggers() {\n    this.getInputManager().registerKeyboardListener(\n      Phaser.Input.Keyboard.KeyCodes.ESC,\n      'up',\n      async () => {\n        if (this.getPhaseManager().isCurrentPhaseTerminal()) {\n          await this.getPhaseManager().popPhase();\n        } else {\n          await this.getPhaseManager().pushPhase(GamePhaseType.EscapeMenu);\n        }\n      }\n    );\n    this.getInputManager().registerKeyboardListener(\n      Phaser.Input.Keyboard.KeyCodes.TAB,\n      'up',\n      async () => {\n        if (this.getPhaseManager().isCurrentPhase(GamePhaseType.Dashboard)) {\n          await this.getPhaseManager().popPhase();\n        } else if (this.getPhaseManager().isCurrentPhaseTerminal()) {\n          await this.getPhaseManager().swapPhase(GamePhaseType.Dashboard);\n        } else {\n          await this.getPhaseManager().pushPhase(GamePhaseType.Dashboard);\n        }\n      }\n    );\n  }\n\n  /**\n   * Clean up on related managers\n   */\n  public cleanUp() {\n    this.getInputManager().clearListeners();\n    this.getLayerManager().clearAllLayers();\n  }\n\n  /**\n   * Create an award based on the given award key.\n   * The award key is associated with an awardProperty,\n   * which in turn will be used as the source of information for\n   * the award.\n   *\n   * If the award is a valid key and the student already has\n   * the award, the resulting object will have a verification\n   * tag that pops up when student hovers over it.\n   *\n   * Else, we return a default image of a cookie; without\n   * the verification tag.\n   *\n   * @param x x position of the award\n   * @param y y position of the award\n   * @param awardKey key associated with the award\n   */\n  private createAward(x: number, y: number, awardKey: ItemId) {\n    const achievements = this.getUserStateManager().getAchievements();\n    const collectibles = this.getUserStateManager().getCollectibles();\n    const defaultAward = new Phaser.GameObjects.Sprite(this, x, y, ImageAssets.cookies.key);\n\n    if (!achievements.includes(awardKey) && !collectibles.includes(awardKey)) return defaultAward;\n\n    const awardProp = getAwardProp(awardKey);\n    if (!awardProp.completed) return defaultAward;\n\n    const award = new Phaser.GameObjects.Sprite(this, x, y, awardProp.assetKey);\n    return this.attachVerificationTag(award);\n  }\n\n  /**\n   * Attach a verification tag to the sprite.\n   * When user hovers on the sprite, a verification will appear\n   * on the image.\n   *\n   * Used to verify autheticity of the award.\n   *\n   * @param sprite sprite to attach the verification tag to\n   */\n  private attachVerificationTag(sprite: Phaser.GameObjects.Sprite) {\n    const verifCont = this.getVerifCont();\n\n    sprite.setInteractive({ pixelPerfect: true, useHandCursor: true });\n    sprite.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER, () =>\n      verifCont.setVisible(true)\n    );\n    sprite.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT, () =>\n      verifCont.setVisible(false)\n    );\n    sprite.addListener(\n      Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,\n      (pointer: Phaser.Input.Pointer) => {\n        verifCont.x = pointer.x + 10;\n        verifCont.y = pointer.y - 10;\n      }\n    );\n    return sprite;\n  }\n\n  /**\n   * Render starting background for the room.\n   */\n  private renderDefaultBackground() {\n    const backgroundAsset = new Phaser.GameObjects.Image(\n      this,\n      screenCenter.x,\n      screenCenter.y,\n      this.getDefaultBackgroundKey()\n    );\n    resizeOverflow(backgroundAsset, screenSize.x, screenSize.y);\n\n    // Don't use layer manager because it does not exist at this point\n    this.add.existing(backgroundAsset);\n  }\n\n  /**\n   * Returns the background key to be used, based on the user's assessment\n   * progression.\n   */\n  private getDefaultBackgroundKey() {\n    // Once reversed, the first element is the submitted assessment with the most recent close date\n    const completedAssessmentIds = this.getUserStateManager().getAssessments().reverse();\n    const backgroundMapping = SourceAcademyGame.getInstance().getRoomPreviewMapping();\n\n    // Iterative search for assessment with valid mapping\n    for (let i = 0; i < completedAssessmentIds.length; i++) {\n      if (backgroundMapping.has(completedAssessmentIds[i])) {\n        return completedAssessmentIds[i];\n      }\n    }\n\n    // If there is no valid mapping, we use default background image\n    return ImageAssets.sourceCrashedPod.key;\n  }\n\n  /**\n   * Construct the necessary managers for this scene\n   */\n  private initialiseManagers() {\n    this.layerManager = new GameLayerManager(this);\n    this.inputManager = new GameInputManager(this);\n    this.phaseManager = new GamePhaseManager(createCMRGamePhases(), this.inputManager);\n    this.escapeManager = new GameEscapeManager(this);\n    this.collectibleManager = new GameAwardsManager(\n      this,\n      SourceAcademyGame.getInstance().getUserStateManager().getCollectibles\n    );\n    this.achievementManager = new GameAwardsManager(\n      this,\n      SourceAcademyGame.getInstance().getUserStateManager().getAchievements\n    );\n    this.toolbarManager = new GameToolbarManager(this);\n    this.dashboardManager = new GameDashboardManager(\n      this,\n      [DashboardPage.Collectibles, DashboardPage.Achievements],\n      [this.collectibleManager, this.achievementManager]\n    );\n  }\n\n  private getVerifCont = () => mandatory(this.verifCont);\n  private getUserStateManager = () => SourceAcademyGame.getInstance().getUserStateManager();\n\n  public getInputManager = () => mandatory(this.inputManager);\n  public getLayerManager = () => mandatory(this.layerManager);\n  public getPhaseManager = () => mandatory(this.phaseManager);\n  public getEscapeManager = () => mandatory(this.escapeManager);\n  public getCollectibleManager = () => mandatory(this.collectibleManager);\n  public getAchievementManager = () => mandatory(this.achievementManager);\n  public getToolbarManager = () => mandatory(this.toolbarManager);\n  public getDashboardManager = () => mandatory(this.dashboardManager);\n}\n","import ImageAssets from '../../assets/ImageAssets';\nimport CommonBackButton from '../../commons/CommonBackButton';\nimport { screenCenter, screenSize } from '../../commons/CommonConstants';\nimport CommonRadioButton from '../../commons/CommonRadioButton';\nimport GameLayerManager from '../../layer/GameLayerManager';\nimport { Layer } from '../../layer/GameLayerTypes';\nimport SourceAcademyGame from '../../SourceAcademyGame';\nimport { createButton } from '../../utils/ButtonUtils';\nimport { mandatory } from '../../utils/GameUtils';\nimport { calcTableFormatPos, Direction } from '../../utils/StyleUtils';\nimport { createBitmapText } from '../../utils/TextUtils';\nimport SettingsConstants, {\n  applySettingsTextStyle,\n  optionHeaderTextStyle,\n  optionTextStyle\n} from './SettingsConstants';\n\n/**\n * Settings scene, in which students can control\n * different settings of the game.\n */\nclass Settings extends Phaser.Scene {\n  private bgmVolumeRadioButtons: CommonRadioButton | undefined;\n  private sfxVolumeRadioButtons: CommonRadioButton | undefined;\n  private layerManager?: GameLayerManager;\n\n  constructor() {\n    super('Settings');\n  }\n\n  public async create() {\n    SourceAcademyGame.getInstance().setCurrentSceneRef(this);\n    this.layerManager = new GameLayerManager(this);\n    this.renderBackground();\n    this.renderOptions();\n  }\n\n  /**\n   * Set up the background and add it to the background layer.\n   */\n  private renderBackground() {\n    const background = new Phaser.GameObjects.Image(\n      this,\n      screenCenter.x,\n      screenCenter.y,\n      ImageAssets.spaceshipBg.key\n    );\n\n    const settingBgImg = new Phaser.GameObjects.Image(\n      this,\n      screenCenter.x,\n      screenCenter.y,\n      ImageAssets.settingBanner.key\n    );\n    this.getLayerManager().addToLayer(Layer.Background, background);\n    this.getLayerManager().addToLayer(Layer.Background, settingBgImg);\n  }\n\n  /**\n   * Add various settings that user can use.\n   * Sets up the header and the radio buttons, and add it to the screen.\n   */\n  private renderOptions() {\n    // Create Headers\n    const optCont = new Phaser.GameObjects.Container(this, 0, 0);\n    const optHeader = this.getSettingsHeader();\n    const optHeaderPos = calcTableFormatPos({\n      direction: Direction.Column,\n      numOfItems: optHeader.length,\n      maxYSpace: SettingsConstants.opt.ySpace\n    });\n    optCont.add(\n      optHeader.map((header, index) => this.createOptionHeader(header, optHeaderPos[index][1]))\n    );\n\n    // Get user default choice\n    const { bgmVolume, sfxVolume } = this.getSaveManager().getSettings();\n    const sfxVolIdx = SettingsConstants.volContainerOpts.findIndex(\n      value => parseFloat(value) === sfxVolume\n    );\n    const bgmVolIdx = SettingsConstants.volContainerOpts.findIndex(\n      value => parseFloat(value) === bgmVolume\n    );\n\n    // Create SFX Radio Buttons\n    this.sfxVolumeRadioButtons = this.createOptRadioOptions(sfxVolIdx, optHeaderPos[0][1]);\n    // Create BGM Radio Buttons\n    this.bgmVolumeRadioButtons = this.createOptRadioOptions(bgmVolIdx, optHeaderPos[1][1]);\n\n    // Create apply settings button\n    const applySettingsButton = createButton(this, {\n      assetKey: ImageAssets.mediumButton.key,\n      message: 'Apply Settings',\n      textConfig: { x: 0, y: 0, oriX: 0.33, oriY: 0.85 },\n      bitMapTextStyle: applySettingsTextStyle,\n      onUp: () => this.applySettings()\n    }).setPosition(screenCenter.x, screenSize.y * 0.925);\n\n    // Create back button to main menu\n    const backButton = new CommonBackButton(this, () => {\n      this.getLayerManager().clearAllLayers();\n      this.scene.start('MainMenu');\n    });\n\n    this.getLayerManager().addToLayer(Layer.UI, optCont);\n    this.getLayerManager().addToLayer(Layer.UI, this.sfxVolumeRadioButtons);\n    this.getLayerManager().addToLayer(Layer.UI, this.bgmVolumeRadioButtons);\n    this.getLayerManager().addToLayer(Layer.UI, applySettingsButton);\n    this.getLayerManager().addToLayer(Layer.UI, backButton);\n  }\n\n  /**\n   * Options header to display.\n   */\n  private getSettingsHeader() {\n    return ['SFX', 'BGM'];\n  }\n\n  /**\n   * Formats the header text as well as the blue arrow and\n   * underline, and place it based on the given yPos.\n   *\n   * @param header text for the header\n   * @param yPos y position of the option\n   */\n  private createOptionHeader(header: string, yPos: number) {\n    const optHeaderCont = new Phaser.GameObjects.Container(this, 0, yPos);\n    const headerDiv = new Phaser.GameObjects.Image(\n      this,\n      screenCenter.x,\n      0,\n      ImageAssets.settingOption.key\n    );\n    const headerText = createBitmapText(\n      this,\n      header,\n      SettingsConstants.optHeaderTextConfig,\n      optionHeaderTextStyle\n    );\n    optHeaderCont.add([headerDiv, headerText]);\n    return optHeaderCont;\n  }\n\n  /**\n   * Create a radio buttons, formatted with settings' style.\n   *\n   * @param defaultChoiceIdx default choice of the radio button\n   * @param yPos y position of the radio button\n   */\n  private createOptRadioOptions(defaultChoiceIdx: number, yPos: number) {\n    return new CommonRadioButton(\n      this,\n      {\n        choices: SettingsConstants.volContainerOpts,\n        defaultChoiceIdx: defaultChoiceIdx,\n        maxXSpace: SettingsConstants.opt.xSpace,\n        choiceTextConfig: SettingsConstants.radioButtonsTextConfig,\n        bitmapTextStyle: optionTextStyle\n      },\n      SettingsConstants.opt.x,\n      -screenCenter.y + yPos\n    );\n  }\n\n  /**\n   * Fetch the current radio buttons value, save it, then apply it.\n   *\n   * This method is responsible in contacting the managers that\n   * need to be aware of the update.\n   */\n  public async applySettings() {\n    const sfxVol = this.sfxVolumeRadioButtons\n      ? parseFloat(this.sfxVolumeRadioButtons.getChosenChoice())\n      : 1;\n    const bgmVol = this.bgmVolumeRadioButtons\n      ? parseFloat(this.bgmVolumeRadioButtons.getChosenChoice())\n      : 1;\n\n    // Save settings\n    await this.getSaveManager().saveSettings({ bgmVolume: bgmVol, sfxVolume: sfxVol });\n\n    // Apply settings\n    SourceAcademyGame.getInstance()\n      .getSoundManager()\n      .applyUserSettings(this.getSaveManager().getSettings());\n  }\n\n  public getSaveManager = () => SourceAcademyGame.getInstance().getSaveManager();\n  public getLayerManager = () => mandatory(this.layerManager);\n}\n\nexport default Settings;\n","import { AssetMap, SoundAsset } from '../assets/AssetsTypes';\nimport { Constants } from '../commons/CommonConstants';\nimport { AssetKey, AssetPath } from '../commons/CommonTypes';\nimport { SettingsJson } from '../save/GameSaveTypes';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { mandatory, toS3Path } from '../utils/GameUtils';\nimport { bgMusicFadeDuration, musicFadeOutTween } from './GameSoundTypes';\n\n/**\n * This class manages the sounds for the entire game\n * It proxies the game's sound manager\n */\nclass GameSoundManager {\n  private soundAssetMap: Map<AssetKey, SoundAsset>;\n  private bgmVol: number;\n  private sfxVol: number;\n\n  private currBgMusicKey: AssetKey;\n  private currBgMusic: Phaser.Sound.WebAudioSound | undefined;\n\n  constructor() {\n    this.soundAssetMap = new Map<AssetKey, SoundAsset>();\n    this.bgmVol = 1;\n    this.sfxVol = 1;\n    this.currBgMusicKey = Constants.nullInteractionId;\n  }\n\n  /**\n   * Apply user settings to the sound manager;\n   * namely the sfxVolume and bgmVolume.\n   *\n   * In the case the volumes are not defined, it will\n   * be defaulted to 1 (max volume).\n   *\n   * @param settings user settings\n   */\n  public applyUserSettings(settings: SettingsJson) {\n    this.bgmVol = settings.bgmVolume !== undefined ? settings.bgmVolume : 1;\n    this.sfxVol = settings.sfxVolume !== undefined ? settings.sfxVolume : 1;\n\n    // Modify currently playing BGM, if any\n    if (this.currBgMusic && this.currBgMusic.isPlaying) {\n      const soundAsset = mandatory(this.getSoundAsset(this.currBgMusicKey));\n      const bgmVol = soundAsset.config.volume !== undefined ? soundAsset.config.volume : 1;\n      this.currBgMusic.setVolume(bgmVol * this.bgmVol);\n    }\n  }\n\n  /**\n   * Store the sound asset within the sound manager.\n   * Sound asset is stored as it is used when playing the\n   * sound (to apply the sound config).\n   *\n   * @param soundAsset sound asset\n   */\n  private addSoundAsset(soundAsset: SoundAsset) {\n    this.soundAssetMap.set(soundAsset.key, soundAsset);\n  }\n\n  /**\n   * Return a sound asset based on its key.\n   * If there is none, return undefined.\n   *\n   * @param key sound asset key\n   */\n  private getSoundAsset(key: AssetKey) {\n    return this.soundAssetMap.get(key);\n  }\n\n  /**\n   * Preload sound assets into the sound manager.\n   *\n   * @param soundAssets array of sound assets\n   */\n  public loadSounds(soundAssets: SoundAsset[]) {\n    soundAssets.forEach(asset => {\n      this.addSoundAsset(asset);\n      this.loadSound(asset.key, toS3Path(asset.path, true));\n    });\n  }\n\n  /**\n   * Preload sound assets into the sound manager.\n   *\n   * @param assetMap AssetMap of sound assets\n   */\n  public loadSoundAssetMap(assetMap: AssetMap<SoundAsset>) {\n    Object.values(assetMap).forEach(asset => {\n      this.addSoundAsset(asset);\n      this.loadSound(asset.key, toS3Path(asset.path, false));\n    });\n  }\n\n  /**\n   * Preload sound asset into the sound manager.\n   *\n   * @param assetKey key to be associated with the sound\n   * @param assetPath path to the sound file\n   */\n  private loadSound(assetKey: AssetKey, assetPath: AssetPath) {\n    this.getCurrentScene().load.audio(assetKey, assetPath);\n  }\n\n  /**\n   * Play a sound, usually an SFX.\n   * The sound will be added, played, and destroyed afterwards; hence\n   * there is no need to keep any reference to it.\n   *\n   * Its volume will be multipled by the current user's SFX volume.\n   *\n   * @param soundKey key associated with the sound.\n   */\n  public playSound(soundKey: AssetKey) {\n    const soundAsset = this.getSoundAsset(soundKey);\n    if (soundAsset) {\n      const vol = soundAsset.config.volume !== undefined ? soundAsset.config.volume : 1;\n      this.getBaseSoundManager().play(soundAsset.key, {\n        ...soundAsset.config,\n        volume: vol * this.sfxVol\n      });\n    }\n  }\n\n  /**\n   * Play a background music. Only one background music is able\n   * to be played at any one time; hence calling this method will\n   * also stop the previous background music.\n   *\n   * If the provided soundKey is the same as the the currently\n   * playing background music, it will be skipped (to avoid strange\n   * stopping and playing of the same music).\n   *\n   * To play no music, the parameter can be set to empty string i.e. ''.\n   *\n   * @param soundKey key to the background music to be played.\n   * @param fadeDuration duration to fade out previous background music\n   */\n  public playBgMusic(soundKey: AssetKey, fadeDuration?: number) {\n    // Game is no longer mounted, do not play the music\n    if (!SourceAcademyGame.getInstance().isMounted) {\n      return;\n    }\n\n    // If same music is already playing, skip\n    if (this.currBgMusicKey === soundKey) {\n      return;\n    }\n\n    // Requested soundKey is empty, stop current BGM\n    if (soundKey === Constants.nullInteractionId && this.currBgMusic) {\n      this.fadeOutAndDestroyMusic(this.currBgMusic, fadeDuration);\n      this.currBgMusic = undefined;\n      this.currBgMusicKey = soundKey;\n      return;\n    }\n\n    // Stop previous BgMusic\n    if (this.currBgMusic) this.fadeOutAndDestroyMusic(this.currBgMusic);\n\n    // Update BGM and key\n    const soundAsset = mandatory(this.getSoundAsset(soundKey));\n    const bgmVol = soundAsset.config.volume !== undefined ? soundAsset.config.volume : 1;\n\n    this.currBgMusic = this.getBaseSoundManager().add(soundAsset.key, {\n      ...soundAsset.config,\n      volume: bgmVol * this.bgmVol\n    }) as Phaser.Sound.WebAudioSound;\n    this.currBgMusicKey = soundAsset.key;\n\n    // Finally, play it\n    this.currBgMusic.play();\n  }\n\n  /**\n   * Fade out a sound and destroy it.\n   *\n   * @param sound sound to be destroyed\n   * @param fadeDuration duration of fade out\n   */\n  private fadeOutAndDestroyMusic(\n    sound: Phaser.Sound.BaseSound,\n    fadeDuration: number = bgMusicFadeDuration\n  ) {\n    this.getCurrentScene().tweens.add({\n      targets: sound,\n      ...musicFadeOutTween,\n      duration: fadeDuration\n    });\n\n    // TODO: fix `TypeError: Cannot read property 'disconnect' of null` error\n    // when user navigates away from game scene before fadeDuration * 2\n    setTimeout(() => sound.destroy(), fadeDuration * 2);\n  }\n\n  /**\n   * Stop all currently playing sounds.\n   */\n  public stopAllSound() {\n    this.getBaseSoundManager().stopAll();\n  }\n\n  /**\n   * Pause currently playing BGM music, if it is playing.\n   */\n  public pauseCurrBgMusic() {\n    if (this.getCurrentScene() && this.currBgMusic && this.currBgMusic.isPlaying) {\n      this.currBgMusic.pause();\n    }\n  }\n\n  /**\n   * Continue currently playing BGM music, if it is paused.\n   */\n  public continueCurrBgMusic() {\n    if (this.getCurrentScene() && this.currBgMusic && this.currBgMusic.isPaused) {\n      this.currBgMusic.play();\n    }\n  }\n\n  /**\n   * We do not use `this.game.sound` as it often\n   * results in crash, due to audio not being present into audio cache.\n   * i.e. calling `.add()` while the sound is not in cache.audio will\n   * result in crash.\n   *\n   * From observation, the audio cache used by `this.game.sound`\n   * and `this.scene.sound` can be different.\n   *\n   * From observation, `loadSound()` loads the audio into\n   * `this.scene.sound.game.cache.audio`; and not into\n   * `this.game.sound.game.cache.audio`.\n   *\n   * Hence, we use `this.getCurrentScene().sound.add` in order to refer\n   * to the correct audio cache.\n   *\n   * NOTE: To check the audio cache, compare between:\n   *  - this.game.sound.game.cache.audio\n   *  - this.scene.sound.game.cache.audio\n   */\n  public getBaseSoundManager = () =>\n    this.getCurrentScene().sound as Phaser.Sound.WebAudioSoundManager;\n  public getCurrentScene = () => mandatory(SourceAcademyGame.getInstance().getCurrentSceneRef());\n}\n\nexport default GameSoundManager;\n","import { GameChapter } from './GameChapterTypes';\n\nconst GameChapterMocks: GameChapter[] = [\n  {\n    title: 'Spaceship Emergency',\n    imageUrl: '/locations/planet-y-orbit/crashing.png',\n    filenames: ['../../assets/mockChapter0.txt', '../../assets/mockChapter0.1.txt']\n  },\n  {\n    title: 'Alien Attack',\n    imageUrl: '/locations/telebay/emergency.png',\n    filenames: ['../../assets/mockChapter1.txt']\n  },\n  {\n    title: 'Jedi Master',\n    imageUrl: '/locations/classroom/normal.png',\n    filenames: ['../../assets/mockChapter2.txt']\n  }\n];\nexport default GameChapterMocks;\n","import { AwardProperty } from '../awards/GameAwardsTypes';\nimport { ItemId } from '../commons/CommonTypes';\nimport { toS3Path } from '../utils/GameUtils';\nimport StringUtils from '../utils/StringUtils';\n\n/**\n * This class parses the awardsMapping.txt, and creates a\n * map of each item id to their corresponding award properties.\n */\nclass AwardParser {\n  public static awardsMapping: Map<ItemId, AwardProperty>;\n\n  /**\n   * This function parses the awards and produces the mapping of award id to award properties.\n   *\n   * @param assetText the entire txt file\n   * @returns {Map<ItemId, AwardProperty>} the mapping of the assets and details corresponding to each award id\n   *                                       the award id may either refer to collectible id or achievement id\n   */\n  public static parse(assetText: string): Map<ItemId, AwardProperty> {\n    AwardParser.awardsMapping = new Map<ItemId, AwardProperty>();\n\n    const assetLines = StringUtils.splitToLines(assetText);\n    const assetParagraphs = StringUtils.splitToParagraph(assetLines);\n\n    assetParagraphs.forEach(([, awardBody]: [string, string[]]) => {\n      AwardParser.parseAwardParagraphs(awardBody);\n    });\n    return this.awardsMapping;\n  }\n\n  /**\n   * This parses the each award paragraph and stores award properties into the award mapping\n   *\n   * @param awardType whether the type is collectible or achievement\n   * @param awardBody whether this is a\n   */\n  private static parseAwardParagraphs(awardBody: string[]) {\n    const awardParagraph = StringUtils.splitToParagraph(awardBody);\n    awardParagraph.forEach(([id, awardProperties]: [ItemId, string[]]) => {\n      const [assetKey, assetPath, title, description] = StringUtils.splitWithLimit(\n        awardProperties[0],\n        ',',\n        3\n      );\n      AwardParser.awardsMapping.set(id, {\n        id,\n        assetKey,\n        assetPath: toS3Path(assetPath, true),\n        title,\n        description,\n        completed: true\n      });\n    });\n  }\n}\n\nexport default AwardParser;\n","import { AssetPath, ItemId } from '../commons/CommonTypes';\nimport { toS3Path } from '../utils/GameUtils';\nimport StringUtils from '../utils/StringUtils';\n\n/**\n * This class parses the roomPreviewMapping.txt, and creates a\n * map of each assesment id to their corresponding background.\n */\nclass RoomPreviewParser {\n  public static backgroundMapping: Map<ItemId, AssetPath>;\n\n  /**\n   * This function parses the text and produces the mapping of assessment id to background key.\n   *\n   * @param assetText the entire txt file\n   * @returns {Map<ItemId, AssetPath>} the mapping of the assessment id to the background key\n   */\n  public static parse(assetText: string): Map<ItemId, AssetPath> {\n    RoomPreviewParser.backgroundMapping = new Map<ItemId, AssetPath>();\n\n    const assetLines = StringUtils.splitToLines(assetText);\n    const assetParagraphs = StringUtils.splitToParagraph(assetLines);\n\n    assetParagraphs.forEach(([assesmentId, assetPath]: [string, string[]]) => {\n      RoomPreviewParser.backgroundMapping.set(assesmentId, toS3Path(assetPath[0], true));\n    });\n    return RoomPreviewParser.backgroundMapping;\n  }\n}\n\nexport default RoomPreviewParser;\n","import FontAssets from '../../assets/FontAssets';\nimport ImageAssets from '../../assets/ImageAssets';\nimport SoundAssets from '../../assets/SoundAssets';\nimport TextAssets from '../../assets/TextAssets';\nimport { addLoadingScreen } from '../../effects/LoadingScreen';\nimport AwardParser from '../../parser/AwardParser';\nimport RoomPreviewParser from '../../parser/RoomPreviewParser';\nimport SourceAcademyGame from '../../SourceAcademyGame';\nimport { toS3Path } from '../../utils/GameUtils';\nimport { loadImage } from '../../utils/LoaderUtils';\n\n/**\n * User entry point into the game.\n *\n * This is where all the fetching happens\n */\nclass Entry extends Phaser.Scene {\n  constructor() {\n    super('Entry');\n  }\n\n  public async preload() {\n    SourceAcademyGame.getInstance().setCurrentSceneRef(this);\n    this.preloadAssets();\n    addLoadingScreen(this);\n\n    await SourceAcademyGame.getInstance().loadGameChapters();\n    await SourceAcademyGame.getInstance().loadRoomCode();\n    await SourceAcademyGame.getInstance().getSaveManager().loadLastSaveState();\n  }\n\n  public async create() {\n    await this.preloadAwards();\n    await SourceAcademyGame.getInstance().getUserStateManager().loadUserState();\n    await this.preloadRoomPreviewBackgrounds();\n\n    this.applyLoadedSettings();\n\n    this.scene.start('MainMenu');\n  }\n\n  /**\n   * Load save state and settings; then applying them.\n   */\n  private applyLoadedSettings() {\n    const userSettings = SourceAcademyGame.getInstance().getSaveManager().getSettings();\n    SourceAcademyGame.getInstance().getSoundManager().applyUserSettings(userSettings);\n  }\n\n  /**\n   * Fetch the awardsMapping text, set it as global variable,\n   * and load all the necessary assets.\n   */\n  private async preloadAwards() {\n    const awardsMappingTxt = this.cache.text.get(TextAssets.awardsMapping.key) || '';\n    const awardsMapping = AwardParser.parse(awardsMappingTxt);\n    SourceAcademyGame.getInstance().setAwardsMapping(awardsMapping);\n    await Promise.all(\n      Array.from(awardsMapping.values()).map(\n        async awardInfo => await loadImage(this, awardInfo.assetKey, awardInfo.assetPath)\n      )\n    );\n  }\n\n  /**\n   * Fetch the roomPreviewMapping text, set it as global variable,\n   * and load all the necessary assets.\n   */\n  private async preloadRoomPreviewBackgrounds() {\n    const roomPreviewMappingTxt = this.cache.text.get(TextAssets.roomPreviewMapping.key) || '';\n    const roomPreviewMapping = RoomPreviewParser.parse(roomPreviewMappingTxt);\n    SourceAcademyGame.getInstance().setRoomPreviewMapping(roomPreviewMapping);\n    await Promise.all(\n      Array.from(roomPreviewMapping.entries()).map(\n        async ([key, value]) => await loadImage(this, key, value)\n      )\n    );\n  }\n\n  /**\n   * Preload all image assets, font assets, and sound assets into the game.\n   */\n  private preloadAssets() {\n    SourceAcademyGame.getInstance().getSoundManager().loadSoundAssetMap(SoundAssets);\n    Object.values(ImageAssets).forEach(asset =>\n      this.load.image(asset.key, toS3Path(asset.path, false))\n    );\n    Object.values(FontAssets).forEach(asset =>\n      this.load.bitmapFont(asset.key, asset.pngPath, asset.fntPath)\n    );\n    Object.values(TextAssets).forEach(asset => this.load.text(asset.key, asset.path));\n  }\n}\n\nexport default Entry;\n","import { getAssessmentOverviews } from 'src/commons/sagas/RequestsSaga';\nimport { AchievementGoal } from 'src/features/achievement/AchievementTypes';\n\nimport { ItemId } from '../commons/CommonTypes';\nimport { promptWithChoices } from '../effects/Prompt';\nimport GameGlobalAPI from '../scenes/gameManager/GameGlobalAPI';\nimport SourceAcademyGame, { GameType } from '../SourceAcademyGame';\nimport StringUtils from '../utils/StringUtils';\nimport { UserStateType } from './GameStateTypes';\n\n/**\n * Manages all states related to user, but not related to the\n * particular story or chapter; e.g. collectibles, achievements, and assessments.\n */\nexport default class GameUserStateManager {\n  private collectibles: Set<string>;\n  private achievements: Set<string>;\n  private assessments: Set<string>;\n\n  constructor() {\n    this.collectibles = new Set([]);\n    this.achievements = new Set([]);\n    this.assessments = new Set([]);\n  }\n\n  public async loadUserState() {\n    if (SourceAcademyGame.getInstance().isGameType(GameType.Simulator)) return;\n    await this.loadAchievements();\n    await this.loadAssessments();\n    this.collectibles = new Set(\n      SourceAcademyGame.getInstance().getSaveManager().getLoadedUserState().collectibles\n    );\n  }\n\n  /**\n   * Adds the given id to the collectible list\n   *\n   * @param collectibleId - collectible you want to check if present\n   */\n  public addCollectible(collectibleId: ItemId) {\n    this.collectibles.add(collectibleId);\n  }\n\n  /**\n   * Fetches assessment overview of the student; based on\n   * the account information. Only include submitted assessments' ids.\n   *\n   * IMPT: The assessments are ordered from earliest close date.\n   */\n  public async loadAssessments() {\n    const assessments = await getAssessmentOverviews(\n      SourceAcademyGame.getInstance().getAccountInfo()\n    );\n    this.assessments = new Set(\n      (assessments || [])\n        .filter(assessment => assessment.status === 'submitted')\n        .sort((a, b) => (a.closeAt <= b.closeAt ? -1 : 1))\n        .map(assessment => assessment.id.toString())\n    );\n  }\n\n  /**\n   * This function checks for the existence of a certain\n   * item ID inside one of the user state lists\n   *\n   * @param userStateType which of the user states you want to check\n   * @param id the item ID of the state you want to check\n   * @returns {Promise<boolean>} true if item ID is found in the user state list\n   */\n  public async isInUserState(userStateType: UserStateType, id: ItemId): Promise<boolean> {\n    if (SourceAcademyGame.getInstance().isGameType(GameType.Game)) {\n      return this[userStateType].has(id);\n    } else {\n      const response = await promptWithChoices(\n        GameGlobalAPI.getInstance().getGameManager(),\n        `${StringUtils.capitalize(userStateType)} ${id}?`,\n        ['Yes', 'No']\n      );\n      return response === 0;\n    }\n  }\n\n  /**\n   * Fetches achievements of the student;\n   */\n  public async loadAchievements() {\n    const awardsMapping = SourceAcademyGame.getInstance().getAwardsMapping();\n    const achievements = SourceAcademyGame.getInstance().getAchievements();\n    const goals = SourceAcademyGame.getInstance().getGoals();\n\n    // Convert goals to map\n    const goalMapping = new Map<string, AchievementGoal>();\n    goals.forEach(goal => goalMapping.set(goal.uuid, goal));\n\n    achievements.forEach(achievement => {\n      const achievementUuid = achievement.uuid.toString();\n      const isCompleted = achievement.goalUuids.reduce(\n        (result, goalUuid) => result && !!goalMapping.get(goalUuid)?.completed,\n        true\n      );\n      const awardProp = awardsMapping.get(achievementUuid);\n\n      if (awardProp) {\n        // If there is mapping, we update the complete attribute\n        const newAwardProp = { ...awardProp, completed: isCompleted };\n        SourceAcademyGame.getInstance().addAwardMapping(newAwardProp.assetKey, newAwardProp);\n        this.achievements.add(newAwardProp.assetKey);\n      }\n    });\n  }\n\n  public getCollectibles = () => Array.from(this.collectibles);\n  public getAchievements = () => Array.from(this.achievements);\n  public getAssessments = () => Array.from(this.assessments);\n}\n","import * as Phaser from 'phaser';\nimport { AwardProperty } from 'src/features/game/awards/GameAwardsTypes';\nimport { Constants, screenSize } from 'src/features/game/commons/CommonConstants';\nimport { AssetPath, ItemId } from 'src/features/game/commons/CommonTypes';\nimport GameSaveManager from 'src/features/game/save/GameSaveManager';\nimport AwardsHall from 'src/features/game/scenes/awardsHall/AwardsHall';\nimport Bindings from 'src/features/game/scenes/bindings/Bindings';\nimport ChapterSelect from 'src/features/game/scenes/chapterSelect/ChapterSelect';\nimport CheckpointTransition from 'src/features/game/scenes/checkpointTransition/CheckpointTransition';\nimport GameManager from 'src/features/game/scenes/gameManager/GameManager';\nimport MainMenu from 'src/features/game/scenes/mainMenu/MainMenu';\nimport RoomPreview from 'src/features/game/scenes/roomPreview/RoomPreview';\nimport Settings from 'src/features/game/scenes/settings/Settings';\nimport GameSoundManager from 'src/features/game/sound/GameSoundManager';\nimport { mandatory } from 'src/features/game/utils/GameUtils';\nimport { StorySimState } from 'src/features/storySimulator/StorySimulatorTypes';\n\nimport { AchievementGoal, AchievementItem } from '../achievement/AchievementTypes';\nimport { fetchGameChapters } from './chapter/GameChapterHelpers';\nimport GameChapterMocks from './chapter/GameChapterMocks';\nimport { GameChapter } from './chapter/GameChapterTypes';\nimport Entry from './scenes/entry/Entry';\nimport { getRoomPreviewCode } from './scenes/roomPreview/RoomPreviewHelper';\nimport GameUserStateManager from './state/GameUserStateManager';\n\nexport type AccountInfo = {\n  accessToken: string;\n  refreshToken: string;\n  role: string;\n  name: string;\n};\n\nexport enum GameType {\n  Simulator = 'Simulator',\n  Game = 'Game'\n}\n\ntype GlobalGameProps = {\n  accountInfo: AccountInfo | undefined;\n  achievements: AchievementItem[] | undefined;\n  awardsMapping: Map<ItemId, AwardProperty>;\n  currentSceneRef?: Phaser.Scene;\n  gameChapters: GameChapter[];\n  gameType: GameType;\n  goals: AchievementGoal[] | undefined;\n  isUsingMock: boolean;\n  roomCode: string;\n  roomPreviewMapping: Map<ItemId, AssetPath>;\n  saveManager: GameSaveManager;\n  setStorySimState: (value: React.SetStateAction<string>) => void;\n  soundManager: GameSoundManager;\n  ssChapterSimFilenames: string[];\n  userStateManager: GameUserStateManager;\n};\n\nexport default class SourceAcademyGame extends Phaser.Game {\n  static instance: SourceAcademyGame;\n  protected global: GlobalGameProps;\n  public isMounted: boolean;\n\n  constructor(config: Phaser.Types.Core.GameConfig, gameType: GameType) {\n    super(config);\n    SourceAcademyGame.instance = this;\n    this.isMounted = true;\n    this.global = {\n      awardsMapping: new Map<ItemId, AwardProperty>(),\n      accountInfo: undefined,\n      achievements: undefined,\n      currentSceneRef: undefined,\n      gameChapters: [],\n      gameType: gameType,\n      goals: undefined,\n      isUsingMock: false,\n      roomCode: '',\n      roomPreviewMapping: new Map<ItemId, AssetPath>(),\n      saveManager: new GameSaveManager(),\n      setStorySimState: Constants.nullFunction,\n      soundManager: new GameSoundManager(),\n      ssChapterSimFilenames: [],\n      userStateManager: new GameUserStateManager()\n    };\n  }\n\n  static getInstance = () => mandatory(SourceAcademyGame.instance);\n\n  public stopAllSounds() {\n    this.sound.stopAll();\n  }\n\n  public setAccountInfo(acc: AccountInfo | undefined) {\n    this.global.accountInfo = acc;\n  }\n\n  public setAchievements(achievements: AchievementItem[]) {\n    this.global.achievements = achievements;\n  }\n\n  public setAwardsMapping(awardsMapping: Map<ItemId, AwardProperty>) {\n    this.global.awardsMapping = awardsMapping;\n  }\n\n  public addAwardMapping(awardId: ItemId, awardProp: AwardProperty) {\n    this.global.awardsMapping.set(awardId, awardProp);\n  }\n\n  public setGoals(goals: AchievementGoal[]) {\n    this.global.goals = goals;\n  }\n\n  public setStorySimStateSetter(setStorySimState: (value: React.SetStateAction<string>) => void) {\n    this.setStorySimState = setStorySimState;\n  }\n\n  public setRoomPreviewMapping(mapping: Map<ItemId, AssetPath>) {\n    this.global.roomPreviewMapping = mapping;\n  }\n\n  public async loadGameChapters() {\n    this.global.gameChapters = await fetchGameChapters();\n  }\n\n  public async loadRoomCode() {\n    this.global.roomCode = await getRoomPreviewCode();\n  }\n\n  public setStorySimState(state: StorySimState) {\n    this.global.setStorySimState(state);\n  }\n\n  public setCurrentSceneRef(scene: Phaser.Scene) {\n    this.global.currentSceneRef = scene;\n  }\n\n  public toggleUsingMock(value?: boolean) {\n    if (value === undefined) {\n      this.global.isUsingMock = !this.global.isUsingMock;\n    } else {\n      this.global.isUsingMock = value;\n    }\n  }\n\n  public setChapterSimStack(checkpointFilenames: string[]) {\n    this.global.ssChapterSimFilenames = checkpointFilenames.reverse();\n  }\n\n  public getAwardsMapping = () => mandatory(this.global.awardsMapping);\n  public getAccountInfo = () => mandatory(this.global.accountInfo);\n  public getAchievements = () => mandatory(this.global.achievements);\n  public getSoundManager = () => mandatory(this.global.soundManager);\n  public getGoals = () => mandatory(this.global.goals);\n  public getRoomPreviewMapping = () => mandatory(this.global.roomPreviewMapping);\n  public getUserStateManager = () => mandatory(this.global.userStateManager);\n  public getSaveManager = () => mandatory(this.global.saveManager);\n  public getCurrentSceneRef = () => mandatory(this.global.currentSceneRef);\n  public isGameType = (gameType: GameType) => this.global.gameType === gameType;\n  public getSSChapterSimFilenames = () => this.global.ssChapterSimFilenames;\n  public getIsUsingMock = () => this.global.isUsingMock;\n  public getRoomCode = () => this.global.roomCode;\n  public getGameChapters = () =>\n    this.global.isUsingMock ? GameChapterMocks : this.global.gameChapters;\n}\n\nconst config = {\n  debug: true,\n  type: Phaser.CANVAS,\n  width: screenSize.x,\n  height: screenSize.y,\n  physics: {\n    default: 'arcade'\n  },\n  scale: {\n    mode: Phaser.Scale.FIT,\n    parent: 'game-display'\n  },\n  fps: {\n    target: 24\n  },\n  scene: [\n    Entry,\n    MainMenu,\n    Settings,\n    ChapterSelect,\n    GameManager,\n    CheckpointTransition,\n    AwardsHall,\n    RoomPreview,\n    Bindings\n  ]\n};\n\nexport const createSourceAcademyGame = () => {\n  return new SourceAcademyGame(config, GameType.Game);\n};\n","import _ from 'lodash';\nimport { request } from 'src/commons/sagas/RequestsSaga';\n\nimport { store } from '../../../pages/createStore';\nimport { toTxtPath } from '../assets/TextAssets';\nimport SourceAcademyGame from '../SourceAcademyGame';\nimport { GameChapter } from './GameChapterTypes';\n\n/**\n * Fetches all chapters from the backend\n *\n * @returns {Promise<GameChapter[]>} - All the chapter objects in a list\n */\nexport async function fetchGameChapters(): Promise<GameChapter[]> {\n  const courseId = store.getState().session.courseId;\n  const response = await request(`courses/${courseId}/stories`, 'GET', {\n    accessToken: SourceAcademyGame.getInstance().getAccountInfo().accessToken,\n    refreshToken: SourceAcademyGame.getInstance().getAccountInfo().refreshToken,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n  if (!response) return [];\n  const chapterDetails = response.status === 200 ? await response.json() : [];\n  const sortedChapters = _.sortBy(chapterDetails, chapterDetail => new Date(chapterDetail.openAt));\n  sortedChapters.forEach(chapter => (chapter.filenames = chapter.filenames.map(toTxtPath)));\n  return sortedChapters;\n}\n","import * as React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useTypedSelector } from 'src/commons/utils/Hooks';\nimport { getAchievements, getOwnGoals } from 'src/features/achievement/AchievementActions';\nimport { saveData } from 'src/features/game/save/GameSaveRequests';\nimport { FullSaveState } from 'src/features/game/save/GameSaveTypes';\nimport SourceAcademyGame, {\n  AccountInfo,\n  createSourceAcademyGame\n} from 'src/features/game/SourceAcademyGame';\n\nfunction Game() {\n  const session = useTypedSelector(state => state.session);\n  const dispatch = useDispatch();\n\n  const achievements = useTypedSelector(state => state.achievement.achievements);\n  const goals = useTypedSelector(state => state.achievement.goals);\n\n  const [isTestStudent, setIsTestStudent] = React.useState(false);\n  const [isUsingMock, setIsUsingMock] = React.useState(false);\n\n  React.useEffect(() => {\n    dispatch(getAchievements());\n    dispatch(getOwnGoals());\n  }, [dispatch]);\n\n  React.useEffect(() => {\n    const game = createSourceAcademyGame();\n    return () => {\n      game.isMounted = false;\n      game.stopAllSounds();\n      game.destroy(true);\n    };\n  }, []);\n\n  React.useEffect(() => {\n    SourceAcademyGame.getInstance().setAccountInfo({\n      accessToken: session.accessToken,\n      refreshToken: session.refreshToken,\n      role: session.role,\n      name: session.name\n    } as AccountInfo);\n    SourceAcademyGame.getInstance().setAchievements(achievements);\n    SourceAcademyGame.getInstance().setGoals(goals);\n\n    if (process.env.NODE_ENV === 'development') {\n      setIsTestStudent(true);\n      setIsUsingMock(true);\n      SourceAcademyGame.getInstance().toggleUsingMock(true);\n    }\n  }, [session, achievements, goals]);\n\n  return (\n    <>\n      <div id=\"game-display\"></div>\n      {isTestStudent && (\n        <div className=\"Horizontal\">\n          <button\n            onClick={async () => {\n              await saveData({} as FullSaveState);\n              alert('Game cleared! Please refresh');\n            }}\n          >\n            Clear data\n          </button>\n          <button\n            onClick={() => {\n              setIsUsingMock(!isUsingMock);\n              SourceAcademyGame.getInstance().toggleUsingMock();\n            }}\n          >\n            {isUsingMock ? 'Use Game Chapters' : 'Use Mock Chapters'}\n          </button>\n        </div>\n      )}\n    </>\n  );\n}\n\nexport default Game;\n","import { AnchorButton } from '@blueprintjs/core';\nimport React from 'react';\nimport { Link, LinkProps } from 'react-router-dom';\n\nimport { PropsType } from './utils/TypeHelper';\n\n// Adapted from https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/modules/Link.js\n\nfunction makeAnchorButton(anchorButtonProps: PropsType<AnchorButton>) {\n  return (props: { href: string; navigate: () => void }) => (\n    <AnchorButton\n      onClick={(event: React.MouseEvent<HTMLElement>) => {\n        try {\n          if (anchorButtonProps.onClick) {\n            anchorButtonProps.onClick(event);\n          }\n        } catch (ex) {\n          event.preventDefault();\n          throw ex;\n        }\n\n        if (\n          !event.defaultPrevented &&\n          event.button === 0 &&\n          (!anchorButtonProps.target || anchorButtonProps.target === '_self') &&\n          !event.metaKey &&\n          !event.altKey &&\n          !event.ctrlKey &&\n          !event.shiftKey\n        ) {\n          event.preventDefault();\n          props.navigate();\n        }\n      }}\n      href={props.href}\n      {...anchorButtonProps}\n    />\n  );\n}\n\n/**\n * A combination of Blueprint's AnchorButton and React Router's Link.\n *\n * This element results in a single <a> that is styled as a Blueprint button.\n *\n * Note: do not use <Link><AnchorButton /></Link>, as that creates `<a><a ... ></a></a>`\n * which is illegal HTML. (The same applies for NavLink.)\n *\n * Also do not use `<Link><Button /></Link>`, as that creates `<a><button ...></button></a>`,\n * which is not ideal.\n */\nexport default function AnchorButtonLink({\n  to,\n  replace,\n  ...anchorButtonProps\n}: PropsType<AnchorButton> & { to: LinkProps['to']; replace?: boolean }) {\n  return <Link to={to} replace={replace} component={makeAnchorButton(anchorButtonProps)} />;\n}\n","import { Button } from '@blueprintjs/core';\nimport * as React from 'react';\nimport AnchorButtonLink from 'src/commons/AnchorButtonLink';\n\nimport { Role } from '../../../../commons/application/ApplicationTypes';\nimport { showSimpleConfirmDialog } from '../../../../commons/utils/DialogHelper';\nimport { GradingOverview } from '../../../../features/grading/GradingTypes';\n\nexport type GradingActionsCellProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleUnsubmitSubmission: (submissionId: number) => void;\n  handleReautogradeSubmission: (submissionId: number) => void;\n};\n\ntype StateProps = {\n  data: GradingOverview;\n  courseId?: number;\n  courseRegId?: number;\n  role?: Role;\n};\n\nconst GradingActionsCell: React.FC<GradingActionsCellProps> = props => {\n  const handleConfirmUnsubmit = async () => {\n    const confirm = await showSimpleConfirmDialog({\n      contents: 'Are you sure you want to unsubmit?',\n      positiveIntent: 'danger',\n      positiveLabel: 'Unsubmit'\n    });\n    if (confirm) {\n      props.handleUnsubmitSubmission(props.data.submissionId);\n    }\n  };\n\n  const handleConfirmReautograde = async () => {\n    const confirm = await showSimpleConfirmDialog({\n      contents: (\n        <>\n          <p>Reautograde this submission?</p>\n          <p>Note: all manual adjustments will be reset to 0.</p>\n        </>\n      ),\n      positiveIntent: 'danger',\n      positiveLabel: 'Reautograde'\n    });\n    if (confirm) {\n      props.handleReautogradeSubmission(props.data.submissionId);\n    }\n  };\n\n  const isOwnSubmission = props.courseRegId && props.courseRegId === props.data.studentId;\n  const canReautograde = isOwnSubmission || props.data.submissionStatus === 'submitted';\n  const canUnsubmit =\n    props.data.submissionStatus === 'submitted' &&\n    props.courseRegId &&\n    (props.courseRegId === props.data.groupLeaderId ||\n      isOwnSubmission ||\n      props.role === Role.Admin);\n\n  return (\n    <>\n      <AnchorButtonLink\n        to={`/courses/${props.courseId}/grading/${props.data.submissionId}`}\n        icon=\"annotation\"\n        minimal\n        title=\"Grade\"\n      />\n      <Button\n        icon=\"refresh\"\n        minimal\n        onClick={handleConfirmReautograde}\n        disabled={!canReautograde}\n        title=\"Reautograde\"\n      />\n      <Button\n        icon=\"arrow-left\"\n        minimal\n        onClick={handleConfirmUnsubmit}\n        disabled={!canUnsubmit}\n        title=\"Unsubmit\"\n      />\n    </>\n  );\n};\n\nexport default GradingActionsCell;\n","import { Icon, IconName, Intent, Position } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport React from 'react';\n\nimport { GradingStatuses } from '../../../../commons/assessment/AssessmentTypes';\nimport { GradingCellProps } from '../../../../features/grading/GradingTypes';\n\n/**\n * Used to render the submission grading status details in the table that displays GradingOverviews.\n * This is a fully fledged component (not SFC) by specification in\n * ag-grid.\n *\n * See {@link https://www.ag-grid.com/example-react-dynamic}\n */\nconst GradingStatusCell: React.FC<GradingCellProps> = props => {\n  const gradingStatus = props.data.gradingStatus;\n  let iconName: IconName;\n  let tooltip: string;\n  let intent: Intent;\n\n  switch (gradingStatus) {\n    case GradingStatuses.graded:\n      iconName = IconNames.TICK;\n      tooltip = `Fully graded: ${props.data.gradedCount} of\n          ${props.data.questionCount}`;\n      intent = Intent.SUCCESS;\n      break;\n    case GradingStatuses.grading:\n      iconName = IconNames.TIME;\n      tooltip = `Partially graded: ${props.data.gradedCount} of\n          ${props.data.questionCount}`;\n      intent = Intent.WARNING;\n      break;\n    case GradingStatuses.none:\n      iconName = IconNames.CROSS;\n      tooltip = `Not graded: ${props.data.gradedCount} of\n          ${props.data.questionCount}`;\n      intent = Intent.DANGER;\n      break;\n    default:\n      iconName = IconNames.DISABLE;\n      tooltip = 'Not applicable';\n      intent = Intent.PRIMARY;\n  }\n\n  return (\n    <div>\n      <Tooltip2 content={tooltip} placement={Position.LEFT} hoverOpenDelay={10} lazy={true}>\n        <Icon icon={iconName} intent={intent} />\n      </Tooltip2>\n    </div>\n  );\n};\n\nexport default GradingStatusCell;\n","import {\n  Button,\n  Divider,\n  H3,\n  Icon,\n  IconName,\n  Intent,\n  NumericInput,\n  Position,\n  Pre\n} from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport React, { useEffect, useState } from 'react';\nimport ReactMde, { ReactMdeProps } from 'react-mde';\nimport { Prompt } from 'react-router';\n\nimport ControlButton from '../../../../commons/ControlButton';\nimport Markdown from '../../../../commons/Markdown';\nimport { getPrettyDate } from '../../../../commons/utils/DateHelper';\nimport { showSimpleConfirmDialog } from '../../../../commons/utils/DialogHelper';\nimport {\n  showSuccessMessage,\n  showWarningMessage\n} from '../../../../commons/utils/NotificationsHelper';\nimport { stringParamToInt } from '../../../../commons/utils/ParamParseHelper';\n\ntype GradingEditorProps = DispatchProps & OwnProps;\n\ntype GradingSaveFunction = (\n  submissionId: number,\n  questionId: number,\n  xpAdjustment: number | undefined,\n  comments?: string\n) => void;\n\nexport type DispatchProps = {\n  handleGradingSave: GradingSaveFunction;\n  handleGradingSaveAndContinue: GradingSaveFunction;\n  handleReautogradeAnswer: (submissionId: number, questionId: number) => void;\n};\n\ntype OwnProps = {\n  solution: number | string | null;\n  questionId: number;\n  submissionId: number;\n  initialXp: number;\n  xpAdjustment: number;\n  maxXp: number;\n  studentName: string;\n  comments: string;\n  graderName?: string;\n  gradedAt?: string;\n};\n\nconst gradingEditorButtonClass = 'grading-editor-button';\n\nconst GradingEditor: React.FC<GradingEditorProps> = props => {\n  /**\n   * A potentially null string which defines the\n   * result for the number XP input. This property being null\n   * will show the hint text in the NumericInput. This property is a string\n   * so as to allow input such as the '-' character.\n   */\n  const [xpAdjustmentInput, setXpAdjustmentInput] = useState<string | null>(\n    props.xpAdjustment.toString()\n  );\n  /**\n   * The text in the react-mde editor, that will be saved\n   * to a comment displayed below the numerical XP */\n  const [editorValue, setEditorValue] = useState(props.comments);\n  /**\n   * The selected tab for the react-mde editor (either 'write' or 'preview')\n   */\n  const [selectedTab, setSelectedTab] = useState<ReactMdeProps['selectedTab']>('write');\n  /**\n   * Determines whether the 'You have unsaved changes'\n   * prompt should appear on page navigation, to prevent the\n   * 'Save and Continue' button from activating the prompt\n   * in cases where navigation occurs before Redux has\n   * updated the props of the Editor component\n   *\n   * This may pose a problem if the user clicks 'Save and Continue'\n   * and the saving process fails. The prompt would no longer\n   * appear although there exist unsaved changes\n   */\n  const [currentlySaving, setCurrentlySaving] = useState(false);\n\n  useEffect(() => {\n    makeInitialState();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.submissionId, props.questionId]);\n\n  const makeInitialState = () => {\n    setXpAdjustmentInput(props.xpAdjustment.toString());\n    setEditorValue(props.comments);\n    setSelectedTab('write');\n    setCurrentlySaving(false);\n  };\n\n  /**\n   * A custom icons provider. It uses a bulky mapping function\n   * defined below.\n   *\n   * See {@link https://github.com/andrerpena/react-mde}\n   */\n  function blueprintIconProvider(name: string) {\n    const blueprintIcon = mdeToBlueprintIconMapping(name);\n    return <Icon icon={blueprintIcon.iconName} htmlTitle={blueprintIcon.title} />;\n  }\n\n  /**\n   * Makes sure that the XP values are permissible before\n   * returning the relevant saving function (for the 'Save Draft'\n   * and 'Submit and Continue' buttons)\n   */\n  const validateXpBeforeSave =\n    (handleSaving: GradingSaveFunction): (() => void) =>\n    () => {\n      const newXpAdjustmentInput = stringParamToInt(xpAdjustmentInput || undefined) || undefined;\n      const xp = props.initialXp + (newXpAdjustmentInput || 0);\n      if (xp < 0 || xp > props.maxXp) {\n        showWarningMessage(\n          `XP ${xp.toString()} is out of bounds. Maximum xp is ${props.maxXp.toString()}.`\n        );\n        return;\n      } else {\n        handleSaving(props.submissionId, props.questionId, newXpAdjustmentInput, editorValue);\n      }\n    };\n\n  /**\n   * Sets the state currentlySaving to true to disable\n   * the 'You have unsaved changes' prompt\n   */\n  const onClickSaveAndContinue: GradingSaveFunction = (\n    submissionId: number,\n    questionId: number,\n    xpAdjustment: number | undefined,\n    comments?: string\n  ) => {\n    const callback = (): void => {\n      props.handleGradingSaveAndContinue(submissionId, questionId, xpAdjustment, comments!);\n    };\n    setCurrentlySaving(true);\n    // TODO: Check (not sure how) if this results in a regression.\n    callback();\n  };\n\n  const onClickReautogradeAnswer = async () => {\n    const confirm = await showSimpleConfirmDialog({\n      contents: (\n        <>\n          <p>Reautograde this answer?</p>\n          <p>Note: manual adjustments will be reset to 0.</p>\n        </>\n      ),\n      positiveLabel: 'Reautograde',\n      positiveIntent: 'danger'\n    });\n    if (confirm) {\n      props.handleReautogradeAnswer(props.submissionId, props.questionId);\n    }\n  };\n\n  /**\n   * Send a warning prompt that loading from a local draft\n   * will overwrite any unsaved changes\n   */\n  const discardChanges = (): void => {\n    if (!checkHasUnsavedChanges() || window.confirm('This will reset the editor. Are you sure?')) {\n      setXpAdjustmentInput(props.xpAdjustment!.toString());\n      setEditorValue(props.comments);\n      // TODO: Check (not sure how) if this results in a regression.\n      showSuccessMessage('Discarded!', 1000);\n    }\n  };\n\n  /**\n   * Handles changes in the XP NumericInput, and updates the local State.\n   *\n   * @param valueAsNumber an unused parameter, as we use strings for the input. @see State\n   * @param valueAsString a string that contains the input. To be parsed by another function.\n   */\n  const onXpAdjustmentInputChange = (valueAsNumber: number, valueAsString: string | null) => {\n    setXpAdjustmentInput(valueAsString);\n  };\n\n  const checkHasUnsavedChanges = () => {\n    const newXpAdjustmentInput = stringParamToInt(xpAdjustmentInput || undefined);\n    return props.xpAdjustment !== newXpAdjustmentInput || props.comments !== editorValue;\n  };\n\n  const generateMarkdownPreview = (markdown: string) =>\n    Promise.resolve(\n      <Markdown\n        content={markdown}\n        simplifiedAutoLink\n        strikethrough\n        tasklists\n        openLinksInNewWindow\n      />\n    );\n\n  // Render\n  const hasUnsavedChanges = checkHasUnsavedChanges();\n  const saveButtonOpts = {\n    intent: hasUnsavedChanges ? Intent.WARNING : Intent.NONE,\n    minimal: !hasUnsavedChanges,\n    className: gradingEditorButtonClass\n  };\n  const discardButtonOpts = {\n    intent: hasUnsavedChanges ? Intent.DANGER : Intent.NONE,\n    minimal: !hasUnsavedChanges,\n    className: gradingEditorButtonClass\n  };\n  const saveAndContinueButtonOpts = {\n    intent: hasUnsavedChanges ? Intent.SUCCESS : Intent.NONE,\n    minimal: !hasUnsavedChanges,\n    className: gradingEditorButtonClass\n  };\n  const onTabChange = (tab: ReactMdeProps['selectedTab']) => setSelectedTab(tab);\n\n  // Derived values\n  const totalXp = props.initialXp + (stringParamToInt(xpAdjustmentInput || undefined) || 0);\n  const xpPlaceholder = `${props.initialXp > 0 ? '-' : ''}${props.initialXp} to ${\n    props.maxXp - props.initialXp\n  }`;\n\n  return (\n    <div className=\"GradingEditor\">\n      {!currentlySaving && hasUnsavedChanges ? (\n        <Prompt message={'You have unsaved changes. Are you sure you want to leave?'} />\n      ) : null}\n\n      <div className=\"grading-editor-header\">\n        <H3>Currently Grading: {props.studentName}</H3>\n      </div>\n      {props.solution !== null ? (\n        <div className=\"grading-editor-marking-scheme\">\n          <Pre>{props.solution.toString()} </Pre>\n        </div>\n      ) : null}\n\n      <div className=\"grading-editor-container\">\n        <div className=\"grading-editor-xp\">\n          <div className=\"autograder-xp\">\n            <div>Autograder XP:</div>\n            <div>\n              {`${props.initialXp} / ${props.maxXp}`}{' '}\n              <Button icon=\"refresh\" small minimal onClick={onClickReautogradeAnswer}></Button>\n            </div>\n          </div>\n          <div className=\"xp-adjustment\">\n            <div>XP adjustment:</div>\n            <div>\n              <NumericInput\n                className=\"adjustment-input\"\n                onValueChange={onXpAdjustmentInputChange}\n                value={xpAdjustmentInput || ''}\n                buttonPosition={Position.RIGHT}\n                fill={true}\n                placeholder={xpPlaceholder}\n                intent={totalXp < 0 || totalXp > props.maxXp ? Intent.DANGER : Intent.NONE}\n                min={0 - props.initialXp}\n                max={props.maxXp > props.initialXp ? props.maxXp - props.initialXp : undefined}\n                stepSize={50}\n                minorStepSize={25}\n                majorStepSize={100}\n              />\n            </div>\n          </div>\n          <div className=\"final-xp\">\n            <div>Final XP:</div>\n            <div>{`${totalXp} / ${props.maxXp}`}</div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"react-mde-parent\">\n        <ReactMde\n          value={editorValue}\n          onChange={setEditorValue}\n          selectedTab={selectedTab}\n          onTabChange={onTabChange}\n          generateMarkdownPreview={generateMarkdownPreview}\n          minEditorHeight={200}\n          maxEditorHeight={1000}\n          minPreviewHeight={240}\n          getIcon={blueprintIconProvider}\n        />\n      </div>\n\n      {selectedTab === 'write' && (\n        <div className=\"grading-editor-draft-buttons\">\n          <div className=\"grading-editor-save-button\">\n            <ControlButton\n              label=\"Save Changes\"\n              icon={IconNames.FLOPPY_DISK}\n              onClick={validateXpBeforeSave(props.handleGradingSave)}\n              options={saveButtonOpts}\n            />\n          </div>\n          <div className=\"grading-editor-discard-button\">\n            <ControlButton\n              label=\"Discard Changes\"\n              icon={IconNames.TRASH}\n              onClick={discardChanges}\n              options={discardButtonOpts}\n            />\n          </div>\n        </div>\n      )}\n      <div className=\"grading-editor-save-continue-button\">\n        <ControlButton\n          label=\"Save and Continue\"\n          icon={IconNames.UPDATED}\n          onClick={validateXpBeforeSave(onClickSaveAndContinue)}\n          options={saveAndContinueButtonOpts}\n        />\n      </div>\n      {props.graderName && props.gradedAt && (\n        <>\n          <Divider />\n          <div className=\"grading-editor-last-graded-details\">\n            Last edited by <b>{props.graderName}</b> on {getPrettyDate(props.gradedAt)}\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n\nconst mdeToBlueprintIconMap: Readonly<Record<string, readonly [IconName, string?]>> = {\n  header: [IconNames.HEADER, 'Header Styles'],\n  bold: [IconNames.BOLD, 'Bold'],\n  italic: [IconNames.ITALIC, 'Italic'],\n  strikethrough: [IconNames.STRIKETHROUGH, 'Strikethrough'],\n  link: [IconNames.LINK, 'Link'],\n  quote: [IconNames.CITATION, 'Quote'],\n  code: [IconNames.CODE, 'Monospaced'],\n  image: [IconNames.MEDIA, 'Image'],\n  'unordered-list': [IconNames.UNGROUP_OBJECTS, 'Bullets'],\n  'ordered-list': [IconNames.NUMBERED_LIST, 'Numbering'],\n  'checked-list': [IconNames.SQUARE, 'Checkboxes']\n} as const;\n\n/**\n * Maps react-mde icon names to blueprintjs counterparts\n * to reduce the number of dependencies on icons and\n * keep a more consistent look\n *\n * Also, generate a HTML title for the icon to be shown on mouse hover\n *\n * By default, react-mde would use FontAwesome5 icons if this\n * icon mapping is not provided\n */\nconst mdeToBlueprintIconMapping = (name: string): { iconName: IconName; title?: string } => {\n  switch (name) {\n    case 'header':\n    case 'bold':\n    case 'italic':\n    case 'strikethrough':\n    case 'link':\n    case 'quote':\n    case 'code':\n    case 'image':\n    case 'unordered-list':\n    case 'ordered-list':\n    case 'checked-list':\n      const [iconName, title] = mdeToBlueprintIconMap[name];\n      return { iconName, title };\n    default:\n      // For unknown icons, a question mark icon is returned\n      return {\n        iconName: IconNames.HELP\n      };\n  }\n};\n\nexport default GradingEditor;\n","import { connect, MapDispatchToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport {\n  reautogradeAnswer,\n  submitGrading,\n  submitGradingAndContinue\n} from '../../../../commons/application/actions/SessionActions';\nimport GradingEditor, { DispatchProps } from './GradingEditor';\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleGradingSave: submitGrading,\n      handleGradingSaveAndContinue: submitGradingAndContinue,\n      handleReautogradeAnswer: reautogradeAnswer\n    },\n    dispatch\n  );\n\nconst GradingEditorContainer = connect(null, mapDispatchToProps)(GradingEditor);\n\nexport default GradingEditorContainer;\n","import { Classes, NonIdealState, Spinner, SpinnerSize } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport SideContentToneMatrix from 'src/commons/sideContent/SideContentToneMatrix';\n\nimport {\n  defaultWorkspaceManager,\n  InterpreterOutput\n} from '../../../../commons/application/ApplicationTypes';\nimport {\n  AutogradingResult,\n  IMCQQuestion,\n  Library,\n  Question,\n  QuestionTypes,\n  Testcase\n} from '../../../../commons/assessment/AssessmentTypes';\nimport { ControlBarProps } from '../../../../commons/controlBar/ControlBar';\nimport { ControlBarClearButton } from '../../../../commons/controlBar/ControlBarClearButton';\nimport { ControlBarEvalButton } from '../../../../commons/controlBar/ControlBarEvalButton';\nimport { ControlBarNextButton } from '../../../../commons/controlBar/ControlBarNextButton';\nimport { ControlBarPreviousButton } from '../../../../commons/controlBar/ControlBarPreviousButton';\nimport { ControlBarQuestionViewButton } from '../../../../commons/controlBar/ControlBarQuestionViewButton';\nimport { ControlBarRunButton } from '../../../../commons/controlBar/ControlBarRunButton';\nimport { convertEditorTabStateToProps } from '../../../../commons/editor/EditorContainer';\nimport { Position } from '../../../../commons/editor/EditorTypes';\nimport Markdown from '../../../../commons/Markdown';\nimport { SideContentProps } from '../../../../commons/sideContent/SideContent';\nimport SideContentAutograder from '../../../../commons/sideContent/SideContentAutograder';\nimport { SideContentTab, SideContentType } from '../../../../commons/sideContent/SideContentTypes';\nimport { history } from '../../../../commons/utils/HistoryHelper';\nimport Workspace, { WorkspaceProps } from '../../../../commons/workspace/Workspace';\nimport { EditorTabState, WorkspaceState } from '../../../../commons/workspace/WorkspaceTypes';\nimport { AnsweredQuestion, Grading } from '../../../../features/grading/GradingTypes';\nimport GradingEditor from './GradingEditorContainer';\n\ntype GradingWorkspaceProps = DispatchProps & OwnProps & StateProps;\n\nexport type DispatchProps = {\n  handleBrowseHistoryDown: () => void;\n  handleBrowseHistoryUp: () => void;\n  handleClearContext: (library: Library, shouldInitLibrary: boolean) => void;\n  handleDeclarationNavigate: (cursorPosition: Position) => void;\n  handleEditorEval: () => void;\n  handleEditorValueChange: (val: string) => void;\n  handleEditorUpdateBreakpoints: (breakpoints: string[]) => void;\n  handleGradingFetch: (submissionId: number) => void;\n  handleInterruptEval: () => void;\n  handleReplEval: () => void;\n  handleReplOutputClear: () => void;\n  handleReplValueChange: (newValue: string) => void;\n  handleSendReplInputToOutput: (code: string) => void;\n  handleResetWorkspace: (options: Partial<WorkspaceState>) => void;\n  handleChangeExecTime: (execTimeMs: number) => void;\n  handleSideContentHeightChange: (heightChange: number) => void;\n  handleTestcaseEval: (testcaseId: number) => void;\n  handleRunAllTestcases: () => void;\n  handleDebuggerPause: () => void;\n  handleDebuggerResume: () => void;\n  handleDebuggerReset: () => void;\n  handleUpdateCurrentSubmissionId: (submissionId: number, questionId: number) => void;\n  handleUpdateHasUnsavedChanges: (hasUnsavedChanges: boolean) => void;\n  handlePromptAutocomplete: (row: number, col: number, callback: any) => void;\n};\n\nexport type OwnProps = {\n  submissionId: number;\n  questionId: number;\n};\n\nexport type StateProps = {\n  autogradingResults: AutogradingResult[];\n  grading?: Grading;\n  activeEditorTabIndex: number | null;\n  editorTabs: EditorTabState[];\n  editorTestcases: Testcase[];\n  hasUnsavedChanges: boolean;\n  isRunning: boolean;\n  isDebugging: boolean;\n  enableDebugging: boolean;\n  output: InterpreterOutput[];\n  replValue: string;\n  sideContentHeight?: number;\n  storedSubmissionId?: number;\n  storedQuestionId?: number;\n  courseId?: number;\n};\n\ntype State = {\n  selectedTab: SideContentType;\n};\n\nclass GradingWorkspace extends React.Component<GradingWorkspaceProps, State> {\n  public constructor(props: GradingWorkspaceProps) {\n    super(props);\n\n    this.state = {\n      selectedTab: SideContentType.grading\n    };\n\n    this.handleEval = this.handleEval.bind(this);\n  }\n\n  /**\n   * After mounting (either an older copy of the grading\n   * or a loading screen), try to fetch a newer grading.\n   */\n  public componentDidMount() {\n    this.props.handleGradingFetch(this.props.submissionId);\n\n    if (!this.props.grading) {\n      return;\n    }\n\n    let questionId = this.props.questionId;\n    if (this.props.questionId >= this.props.grading.length) {\n      questionId = this.props.grading.length - 1;\n    }\n\n    const question: AnsweredQuestion = this.props.grading[questionId].question;\n    let answer: string = '';\n\n    if (question.type === QuestionTypes.programming) {\n      if (question.answer) {\n        answer = question.answer as string;\n      } else {\n        answer = question.solutionTemplate || '';\n      }\n    }\n\n    this.props.handleEditorValueChange(answer);\n  }\n\n  /**\n   * Once there is an update (due to the grading being fetched), check\n   * if a workspace reset is needed.\n   */\n  public componentDidUpdate() {\n    /* Don't reset workspace if grading not fetched yet. */\n    if (this.props.grading === undefined) {\n      return;\n    }\n    const questionId = this.props.questionId;\n\n    /**\n     * Check if questionId is out of bounds, if it is, redirect to the\n     * grading overview page\n     *\n     * This occurs if the grading is submitted on the last question,\n     * as the function to move to the next question does not check\n     * if that question exists\n     */\n    if (this.props.grading[questionId] === undefined) {\n      history.push(`/courses/${this.props.courseId}/grading`);\n    } else {\n      this.checkWorkspaceReset(this.props);\n    }\n  }\n\n  public render() {\n    if (this.props.grading === undefined) {\n      return (\n        <NonIdealState\n          className={classNames('WorkspaceParent', Classes.DARK)}\n          description=\"Getting assessment ready...\"\n          icon={<Spinner size={SpinnerSize.LARGE} />}\n        />\n      );\n    }\n\n    /* If questionId is out of bounds, set it to the max. */\n    const questionId =\n      this.props.questionId >= this.props.grading.length\n        ? this.props.grading.length - 1\n        : this.props.questionId;\n    /* Get the question to be graded */\n    const question = this.props.grading[questionId].question as Question;\n    const workspaceProps: WorkspaceProps = {\n      controlBarProps: this.controlBarProps(questionId),\n      editorContainerProps:\n        question.type === QuestionTypes.programming || question.type === QuestionTypes.voting\n          ? {\n              editorVariant: 'normal',\n              editorTabs: this.props.editorTabs.map(convertEditorTabStateToProps),\n              editorSessionId: '',\n              handleDeclarationNavigate: this.props.handleDeclarationNavigate,\n              handleEditorEval: this.handleEval,\n              handleEditorCheck: () => {},\n              handleEditorValueChange: this.props.handleEditorValueChange,\n              handleEditorUpdateBreakpoints: this.props.handleEditorUpdateBreakpoints,\n              handlePromptAutocomplete: this.props.handlePromptAutocomplete,\n              isEditorAutorun: false,\n              sourceChapter: Chapter.CALC,\n              sourceVariant: question?.library?.variant ?? Variant.DEFAULT,\n              externalLibraryName: question?.library?.external?.name || 'NONE'\n            }\n          : undefined,\n      handleSideContentHeightChange: this.props.handleSideContentHeightChange,\n      mcqProps: {\n        mcq: question as IMCQQuestion,\n        handleMCQSubmit: (i: number) => {}\n      },\n      sideBarProps: {\n        tabs: []\n      },\n      sideContentHeight: this.props.sideContentHeight,\n      sideContentProps: this.sideContentProps(this.props, questionId),\n      replProps: {\n        handleBrowseHistoryDown: this.props.handleBrowseHistoryDown,\n        handleBrowseHistoryUp: this.props.handleBrowseHistoryUp,\n        handleReplEval: this.props.handleReplEval,\n        handleReplValueChange: this.props.handleReplValueChange,\n        output: this.props.output,\n        replValue: this.props.replValue,\n        sourceChapter: Chapter.CALC,\n        sourceVariant: question?.library?.variant ?? Variant.DEFAULT,\n        externalLibrary: question?.library?.external?.name || 'NONE',\n        replButtons: this.replButtons()\n      }\n    };\n    return (\n      <div className={classNames('WorkspaceParent', Classes.DARK)}>\n        <Workspace {...workspaceProps} />\n      </div>\n    );\n  }\n\n  /**\n   * Checks if there is a need to reset the workspace, then executes\n   * a dispatch (in the props) if needed.\n   *\n   * Assumes that 'props.grading' is defined\n   */\n  private checkWorkspaceReset(props: GradingWorkspaceProps) {\n    /* Reset grading if it has changed.*/\n    const submissionId = props.submissionId;\n    const questionId = props.questionId;\n\n    if (props.storedSubmissionId === submissionId && props.storedQuestionId === questionId) {\n      return;\n    }\n    const question = props.grading![questionId].question as Question;\n\n    let autogradingResults: AutogradingResult[] = [];\n    let editorValue: string = '';\n    let editorPrepend: string = '';\n    let editorPostpend: string = '';\n    let editorTestcases: Testcase[] = [];\n\n    if (question.type === QuestionTypes.programming) {\n      const questionData = question as AnsweredQuestion;\n      autogradingResults = questionData.autogradingResults;\n      editorPrepend = questionData.prepend;\n      editorPostpend = questionData.postpend;\n      editorTestcases = questionData.testcases;\n\n      editorValue = questionData.answer as string;\n      if (!editorValue) {\n        editorValue = questionData.solutionTemplate!;\n      }\n    }\n\n    props.handleEditorUpdateBreakpoints([]);\n    props.handleUpdateCurrentSubmissionId(submissionId, questionId);\n    props.handleResetWorkspace({\n      autogradingResults,\n      // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n      editorTabs: [\n        {\n          value: editorValue,\n          prependValue: editorPrepend,\n          postpendValue: editorPostpend,\n          highlightedLines: [],\n          breakpoints: []\n        }\n      ],\n      editorTestcases\n    });\n    props.handleChangeExecTime(\n      question.library.execTimeMs ?? defaultWorkspaceManager.grading.execTime\n    );\n    props.handleClearContext(question.library, true);\n    props.handleUpdateHasUnsavedChanges(false);\n    if (editorValue) {\n      props.handleEditorValueChange(editorValue);\n    }\n  }\n\n  /** Pre-condition: Grading has been loaded */\n  private sideContentProps: (p: GradingWorkspaceProps, q: number) => SideContentProps = (\n    props: GradingWorkspaceProps,\n    questionId: number\n  ) => {\n    const tabs: SideContentTab[] = [\n      {\n        label: `Grading: Question ${questionId + 1}`,\n        iconName: IconNames.TICK,\n        /* Render an editor with the xp given to the current question. */\n        body: (\n          <GradingEditor\n            solution={props.grading![questionId].question.solution}\n            questionId={props.grading![questionId].question.id}\n            submissionId={props.submissionId}\n            initialXp={props.grading![questionId].grade.xp}\n            xpAdjustment={props.grading![questionId].grade.xpAdjustment}\n            maxXp={props.grading![questionId].question.maxXp}\n            studentName={props.grading![questionId].student.name}\n            comments={props.grading![questionId].grade.comments ?? ''}\n            graderName={\n              props.grading![questionId].grade.grader\n                ? props.grading![questionId].grade.grader!.name\n                : undefined\n            }\n            gradedAt={\n              props.grading![questionId].grade.grader\n                ? props.grading![questionId].grade.gradedAt!\n                : undefined\n            }\n          />\n        ),\n        id: SideContentType.grading\n      },\n      {\n        label: `Question ${questionId + 1}`,\n        iconName: IconNames.NINJA,\n        body: <Markdown content={props.grading![questionId].question.content} />,\n        id: SideContentType.questionOverview\n      },\n      {\n        label: `Autograder`,\n        iconName: IconNames.AIRPLANE,\n        body: (\n          <SideContentAutograder\n            testcases={props.editorTestcases}\n            autogradingResults={props.autogradingResults}\n            handleTestcaseEval={this.props.handleTestcaseEval}\n            workspaceLocation=\"grading\"\n          />\n        ),\n        id: SideContentType.autograder\n      }\n    ];\n    const externalLibrary = props.grading![questionId].question.library.external;\n    const functionsAttached = externalLibrary.symbols;\n    if (functionsAttached.includes('get_matrix')) {\n      tabs.push({\n        label: `Tone Matrix`,\n        iconName: IconNames.GRID_VIEW,\n        body: <SideContentToneMatrix />,\n        id: SideContentType.toneMatrix\n      });\n    }\n\n    const sideContentProps: SideContentProps = {\n      onChange: (\n        newTabId: SideContentType,\n        prevTabId: SideContentType,\n        event: React.MouseEvent<HTMLElement>\n      ) => {\n        if (newTabId === prevTabId) {\n          return;\n        }\n        this.setState({ selectedTab: newTabId });\n      },\n      tabs: {\n        beforeDynamicTabs: tabs,\n        afterDynamicTabs: []\n      },\n      workspaceLocation: 'grading'\n    };\n\n    return sideContentProps;\n  };\n\n  /** Pre-condition: Grading has been loaded */\n  private controlBarProps: (q: number) => ControlBarProps = (questionId: number) => {\n    const listingPath = `/courses/${this.props.courseId}/grading`;\n    const gradingWorkspacePath = listingPath + `/${this.props.submissionId}`;\n    const questionProgress: [number, number] = [questionId + 1, this.props.grading!.length];\n\n    const onClickPrevious = () =>\n      history.push(gradingWorkspacePath + `/${(questionId - 1).toString()}`);\n    const onClickNext = () =>\n      history.push(gradingWorkspacePath + `/${(questionId + 1).toString()}`);\n    const onClickReturn = () => history.push(listingPath);\n\n    const nextButton = (\n      <ControlBarNextButton\n        onClickNext={onClickNext}\n        onClickReturn={onClickReturn}\n        questionProgress={questionProgress}\n        key=\"next_question\"\n      />\n    );\n\n    const previousButton = (\n      <ControlBarPreviousButton\n        onClick={onClickPrevious}\n        questionProgress={questionProgress}\n        key=\"previous_question\"\n      />\n    );\n\n    const questionView = (\n      <ControlBarQuestionViewButton questionProgress={questionProgress} key=\"question_view\" />\n    );\n\n    const runButton = <ControlBarRunButton handleEditorEval={this.handleEval} key=\"run\" />;\n\n    return {\n      editorButtons: [runButton],\n      flowButtons: [previousButton, questionView, nextButton]\n    };\n  };\n\n  private replButtons() {\n    const clearButton = (\n      <ControlBarClearButton\n        handleReplOutputClear={this.props.handleReplOutputClear}\n        key=\"clear_repl\"\n      />\n    );\n\n    const evalButton = (\n      <ControlBarEvalButton\n        handleReplEval={this.props.handleReplEval}\n        isRunning={this.props.isRunning}\n        key=\"eval_repl\"\n      />\n    );\n\n    return [evalButton, clearButton];\n  }\n\n  private handleEval() {\n    this.props.handleEditorEval();\n\n    // Run testcases when the autograder tab is selected\n    if (this.state.selectedTab === SideContentType.autograder) {\n      this.props.handleRunAllTestcases();\n    }\n  }\n}\n\nexport default GradingWorkspace;\n","import { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport {\n  beginDebuggerPause,\n  beginInterruptExecution,\n  debuggerReset,\n  debuggerResume\n} from '../../../../commons/application/actions/InterpreterActions';\nimport { fetchGrading } from '../../../../commons/application/actions/SessionActions';\nimport { OverallState } from '../../../../commons/application/ApplicationTypes';\nimport { Library } from '../../../../commons/assessment/AssessmentTypes';\nimport { Position } from '../../../../commons/editor/EditorTypes';\nimport {\n  beginClearContext,\n  browseReplHistoryDown,\n  browseReplHistoryUp,\n  changeExecTime,\n  changeSideContentHeight,\n  clearReplOutput,\n  evalEditor,\n  evalRepl,\n  evalTestcase,\n  navigateToDeclaration,\n  promptAutocomplete,\n  resetWorkspace,\n  runAllTestcases,\n  sendReplInputToOutput,\n  setEditorBreakpoint,\n  updateCurrentSubmissionId,\n  updateEditorValue,\n  updateHasUnsavedChanges,\n  updateReplValue\n} from '../../../../commons/workspace/WorkspaceActions';\nimport { WorkspaceLocation, WorkspaceState } from '../../../../commons/workspace/WorkspaceTypes';\nimport GradingWorkspace, { DispatchProps, OwnProps, StateProps } from './GradingWorkspace';\n\nconst workspaceLocation: WorkspaceLocation = 'grading';\n\nconst mapStateToProps: MapStateToProps<StateProps, OwnProps, OverallState> = (state, props) => {\n  return {\n    autogradingResults: state.workspaces.grading.autogradingResults,\n    activeEditorTabIndex: state.workspaces.grading.activeEditorTabIndex,\n    editorTabs: state.workspaces.grading.editorTabs,\n    editorTestcases: state.workspaces.grading.editorTestcases,\n    grading: state.session.gradings.get(props.submissionId),\n    hasUnsavedChanges: state.workspaces.grading.hasUnsavedChanges,\n    isRunning: state.workspaces.grading.isRunning,\n    isDebugging: state.workspaces.grading.isDebugging,\n    enableDebugging: state.workspaces.grading.enableDebugging,\n    output: state.workspaces.grading.output,\n    replValue: state.workspaces.grading.replValue,\n    sideContentHeight: state.workspaces.grading.sideContentHeight,\n    storedSubmissionId: state.workspaces.grading.currentSubmission,\n    storedQuestionId: state.workspaces.grading.currentQuestion,\n    courseId: state.session.courseId\n  };\n};\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleBrowseHistoryDown: () => browseReplHistoryDown(workspaceLocation),\n      handleBrowseHistoryUp: () => browseReplHistoryUp(workspaceLocation),\n      handleClearContext: (library: Library, shouldInitLibrary: boolean) =>\n        beginClearContext(workspaceLocation, library, shouldInitLibrary),\n      handleDeclarationNavigate: (cursorPosition: Position) =>\n        navigateToDeclaration(workspaceLocation, cursorPosition),\n      handleEditorEval: () => evalEditor(workspaceLocation),\n      handleEditorValueChange: (val: string) => updateEditorValue(val, workspaceLocation),\n      handleEditorUpdateBreakpoints: (breakpoints: string[]) =>\n        setEditorBreakpoint(breakpoints, workspaceLocation),\n      handleGradingFetch: fetchGrading,\n      handleInterruptEval: () => beginInterruptExecution(workspaceLocation),\n      handleReplEval: () => evalRepl(workspaceLocation),\n      handleReplOutputClear: () => clearReplOutput(workspaceLocation),\n      handleReplValueChange: (newValue: string) => updateReplValue(newValue, workspaceLocation),\n      handleSendReplInputToOutput: (code: string) => sendReplInputToOutput(code, workspaceLocation),\n      handleResetWorkspace: (options: Partial<WorkspaceState>) =>\n        resetWorkspace(workspaceLocation, options),\n      handleChangeExecTime: (execTimeMs: number) => changeExecTime(execTimeMs, workspaceLocation),\n      handleSideContentHeightChange: (heightChange: number) =>\n        changeSideContentHeight(heightChange, workspaceLocation),\n      handleTestcaseEval: (testcaseId: number) => evalTestcase(workspaceLocation, testcaseId),\n      handleRunAllTestcases: () => runAllTestcases(workspaceLocation),\n      handleUpdateCurrentSubmissionId: updateCurrentSubmissionId,\n      handleUpdateHasUnsavedChanges: (unsavedChanges: boolean) =>\n        updateHasUnsavedChanges(workspaceLocation, unsavedChanges),\n      handleDebuggerPause: () => beginDebuggerPause(workspaceLocation),\n      handleDebuggerResume: () => debuggerResume(workspaceLocation),\n      handleDebuggerReset: () => debuggerReset(workspaceLocation),\n      handlePromptAutocomplete: (row: number, col: number, callback: any) =>\n        promptAutocomplete(workspaceLocation, row, col, callback)\n    },\n    dispatch\n  );\n\nconst GradingWorkspaceContainer = connect(mapStateToProps, mapDispatchToProps)(GradingWorkspace);\n\nexport default GradingWorkspaceContainer;\n","import { Position } from '@blueprintjs/core';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport React from 'react';\n\nimport { GradingCellProps } from '../../../../features/grading/GradingTypes';\n\n/**\n * Used to render the submission XP details in the table that displays GradingOverviews.\n * This is a fully fledged component (not SFC) by specification in\n * ag-grid.\n *\n * See {@link https://www.ag-grid.com/example-react-dynamic}\n */\nconst GradingXPCell: React.FC<GradingCellProps> = props => {\n  if (props.data.maxXp || props.data.xpBonus) {\n    const tooltip = `Initial XP: ${props.data.initialXp}\n        (${props.data.xpBonus > 0 ? `+${props.data.xpBonus} bonus ` : ''}\n        ${props.data.xpAdjustment >= 0 ? '+' : ''}${props.data.xpAdjustment} adj.)`;\n    return (\n      <div>\n        <Tooltip2 content={tooltip} placement={Position.LEFT} hoverOpenDelay={10} lazy={true}>\n          {`${props.data.currentXp + props.data.xpBonus} / ${props.data.maxXp}`}\n        </Tooltip2>\n      </div>\n    );\n  } else {\n    return <div>No Exp</div>;\n  }\n};\n\nexport default GradingXPCell;\n","import 'ag-grid-community/dist/styles/ag-grid.css';\nimport 'ag-grid-community/dist/styles/ag-theme-balham.css';\n\nimport {\n  Button,\n  Colors,\n  Divider,\n  FormGroup,\n  InputGroup,\n  Intent,\n  NonIdealState,\n  Spinner,\n  SpinnerSize\n} from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { ColDef, GridApi, GridReadyEvent } from 'ag-grid-community';\nimport { ValueFormatterParams } from 'ag-grid-community/dist/lib/entities/colDef';\nimport { AgGridReact } from 'ag-grid-react';\nimport * as React from 'react';\nimport { RouteComponentProps } from 'react-router';\nimport { GradingNavLinkProps, GradingWorkspaceParams } from 'src/features/grading/GradingTypes';\n\nimport { Role } from '../../../commons/application/ApplicationTypes';\nimport ContentDisplay from '../../../commons/ContentDisplay';\nimport NotificationBadge from '../../../commons/notificationBadge/NotificationBadgeContainer';\nimport { filterNotificationsBySubmission } from '../../../commons/notificationBadge/NotificationBadgeHelper';\nimport {\n  Notification,\n  NotificationFilterFunction\n} from '../../../commons/notificationBadge/NotificationBadgeTypes';\nimport { stringParamToInt } from '../../../commons/utils/ParamParseHelper';\nimport {\n  GradingOverview,\n  GradingOverviewWithNotifications\n} from '../../../features/grading/GradingTypes';\nimport GradingActionsCell from './subcomponents/GradingActionsCell';\nimport GradingStatusCell from './subcomponents/GradingStatusCell';\nimport { OwnProps as GradingWorkspaceOwnProps } from './subcomponents/GradingWorkspace';\nimport GradingWorkspaceContainer from './subcomponents/GradingWorkspaceContainer';\nimport GradingXPCell from './subcomponents/GradingXPCell';\n\ntype GradingProps = DispatchProps & StateProps & RouteComponentProps<GradingWorkspaceParams>;\n\nexport type DispatchProps = {\n  handleAcknowledgeNotifications: (withFilter?: NotificationFilterFunction) => void;\n  handleFetchGradingOverviews: (filterToGroup?: boolean) => void;\n  handleUnsubmitSubmission: (submissionId: number) => void;\n  handleReautogradeSubmission: (submissionId: number) => void;\n};\n\nexport type StateProps = {\n  courseRegId?: number;\n  gradingOverviews?: GradingOverview[];\n  notifications: Notification[];\n  role?: Role;\n  courseId?: number;\n};\n\ntype State = {\n  groupFilterEnabled: boolean;\n  currPage: number;\n  maxPages: number;\n  rowCountString: string;\n  isBackDisabled: boolean;\n  isForwardDisabled: boolean;\n};\n\nclass Grading extends React.Component<GradingProps, State> {\n  private columnDefs: ColDef[];\n  private defaultColumnDefs: ColDef;\n  private gridApi?: GridApi;\n\n  public constructor(props: GradingProps) {\n    super(props);\n\n    this.columnDefs = [\n      {\n        headerName: '',\n        field: 'notifications',\n        cellRendererFramework: this.NotificationBadgeCell,\n        width: 30,\n        filter: false,\n        resizable: false,\n        sortable: false,\n        suppressSizeToFit: true\n      },\n      { headerName: 'Assessment Name', field: 'assessmentName' },\n      { headerName: 'Category', field: 'assessmentType', maxWidth: 100 },\n      { headerName: 'Student Name', field: 'studentName' },\n      {\n        headerName: 'Group',\n        field: 'groupName',\n        maxWidth: 100\n      },\n      {\n        headerName: 'Status',\n        field: 'submissionStatus',\n        maxWidth: 100,\n        valueFormatter: (params: ValueFormatterParams) => {\n          const str = params.value as string;\n          return str.charAt(0).toUpperCase() + str.slice(1);\n        },\n        cellStyle: (params: GradingNavLinkProps) => {\n          if (params.data.submissionStatus === 'submitted') {\n            return { backgroundColor: Colors.GREEN5 };\n          }\n          return { backgroundColor: Colors.RED5 };\n        }\n      },\n      {\n        headerName: 'Grading',\n        field: 'gradingStatus',\n        cellRendererFramework: this.GradingStatus,\n        maxWidth: 110\n      },\n      {\n        headerName: 'XP',\n        field: '',\n        cellRendererFramework: this.GradingExp,\n        maxWidth: 100,\n        comparator: (valueA, valueB, nodeA, nodeB, isInverted) => {\n          if (nodeA && nodeB) {\n            return nodeA.data.currentXp - nodeB.data.currentXp;\n          }\n          return valueA - valueB;\n        }\n      },\n      {\n        headerName: 'Actions',\n        colId: 'Actions',\n        width: 120,\n        field: '',\n        cellRendererFramework: GradingActionsCell,\n        cellRendererParams: {\n          courseId: this.props.courseId,\n          courseRegId: this.props.courseRegId,\n          handleUnsubmitSubmission: this.props.handleUnsubmitSubmission,\n          handleReautogradeSubmission: this.props.handleReautogradeSubmission,\n          role: this.props.role\n        },\n        filter: false,\n        resizable: false,\n        sortable: false,\n        suppressSizeToFit: true,\n        cellStyle: {\n          padding: 0\n        }\n      },\n      { headerName: 'Question Count', field: 'questionCount', hide: true },\n      { headerName: 'Questions Graded', field: 'gradedCount', hide: true },\n      { headerName: 'Initial Grade', field: 'initialGrade', hide: true },\n      { headerName: 'Grade Adjustment', field: 'gradeAdjustment', hide: true },\n      { headerName: 'Initial XP', field: 'initialXp', hide: true },\n      { headerName: 'XP Adjustment', field: 'xpAdjustment', hide: true },\n      { headerName: 'Current Grade', field: 'currentGrade', hide: true },\n      { headerName: 'Max Grade', field: 'maxGrade', hide: true },\n      { headerName: 'Current XP (excl. bonus)', field: 'currentXp', hide: true },\n      { headerName: 'Max XP', field: 'maxXp', hide: true },\n      { headerName: 'Bonus XP', field: 'xpBonus', hide: true }\n    ];\n\n    this.defaultColumnDefs = {\n      filter: true,\n      resizable: true,\n      sortable: true\n    };\n\n    this.state = {\n      groupFilterEnabled: false,\n      currPage: 1,\n      maxPages: 1,\n      rowCountString: '(none)',\n      isBackDisabled: true,\n      isForwardDisabled: true\n    };\n  }\n\n  public render() {\n    const submissionId: number | null = stringParamToInt(this.props.match.params.submissionId);\n    // default questionId is 0 (the first question)\n    const questionId: number = stringParamToInt(this.props.match.params.questionId) || 0;\n\n    /* Create a workspace to grade a submission. */\n    if (submissionId !== null) {\n      const props: GradingWorkspaceOwnProps = {\n        submissionId,\n        questionId\n      };\n      return <GradingWorkspaceContainer {...props} />;\n    }\n\n    /* Display either a loading screen or a table with overviews. */\n    const loadingDisplay = (\n      <NonIdealState\n        className=\"Grading\"\n        description=\"Fetching submissions...\"\n        icon={<Spinner size={SpinnerSize.LARGE} />}\n      />\n    );\n\n    const data = this.sortSubmissionsByNotifications().map(e =>\n      !e.studentName ? { ...e, studentName: '(user has yet to log in)' } : e\n    );\n\n    const controls = (\n      <div className=\"grading-controls\">\n        <FormGroup label=\"Filter:\" labelFor=\"text-input\" inline={true}>\n          <InputGroup\n            id=\"filterBar\"\n            large={false}\n            leftIcon=\"filter\"\n            placeholder=\"Enter any text (e.g. mission)\"\n            onKeyPress={this.handleFilterKeypress}\n            onBlur={this.handleApplyFilter}\n          />\n        </FormGroup>\n\n        <div className=\"GridControls ag-grid-controls\">\n          <div className=\"left-controls\">\n            <Button\n              active={this.state.groupFilterEnabled}\n              icon={IconNames.GIT_REPO}\n              intent={this.state.groupFilterEnabled ? Intent.PRIMARY : Intent.NONE}\n              onClick={this.handleGroupsFilter}\n            >\n              <span className=\"hidden-xs\">Show all groups</span>\n            </Button>\n          </div>\n          <div className=\"centre-controls\">\n            <Button\n              icon={IconNames.CHEVRON_BACKWARD}\n              onClick={this.changePaginationView('first')}\n              minimal={true}\n              disabled={this.state.isBackDisabled}\n            />\n            <Button\n              icon={IconNames.CHEVRON_LEFT}\n              onClick={this.changePaginationView('prev')}\n              minimal={true}\n              disabled={this.state.isBackDisabled}\n            />\n            <Button className=\"pagination-details hidden-xs\" disabled={true} minimal={true}>\n              <div>{`Page ${this.state.currPage} of ${this.state.maxPages}`}</div>\n              <div>{this.state.rowCountString}</div>\n            </Button>\n            <Button\n              icon={IconNames.CHEVRON_RIGHT}\n              onClick={this.changePaginationView('next')}\n              minimal={true}\n              disabled={this.state.isForwardDisabled}\n            />\n            <Button\n              icon={IconNames.CHEVRON_FORWARD}\n              onClick={this.changePaginationView('last')}\n              minimal={true}\n              disabled={this.state.isForwardDisabled}\n            />\n          </div>\n          <div className=\"right-controls\">\n            <Button icon={IconNames.EXPORT} onClick={this.exportCSV}>\n              <span className=\"hidden-xs\">Export to CSV</span>\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n\n    const grid = (\n      <div className=\"Grid ag-grid-parent ag-theme-balham\">\n        <AgGridReact\n          domLayout={'autoHeight'}\n          columnDefs={this.columnDefs}\n          defaultColDef={this.defaultColumnDefs}\n          onGridReady={this.onGridReady}\n          onGridSizeChanged={this.resizeGrid}\n          onPaginationChanged={this.updatePaginationState}\n          rowData={data}\n          rowHeight={30}\n          pagination={true}\n          paginationPageSize={25}\n          suppressCellSelection={true}\n          suppressMovableColumns={true}\n          suppressPaginationPanel={true}\n        />\n      </div>\n    );\n\n    const content = (\n      <div className=\"Grading\">\n        {controls}\n        <Divider />\n        {grid}\n      </div>\n    );\n\n    return (\n      <div>\n        <ContentDisplay\n          loadContentDispatch={this.props.handleFetchGradingOverviews}\n          display={this.props.gradingOverviews === undefined ? loadingDisplay : content}\n          fullWidth={false}\n        />\n      </div>\n    );\n  }\n\n  public componentDidUpdate(prevProps: GradingProps, prevState: State) {\n    // Only update grid data when a notification is acknowledged\n    if (this.gridApi && this.props.notifications.length !== prevProps.notifications.length) {\n      // Pass the new reconstructed row data to the grid after fetching the updated notifs\n      this.gridApi.setRowData(this.sortSubmissionsByNotifications());\n    }\n  }\n\n  /** Component to render in table - grading status */\n  private GradingStatus = (props: GradingNavLinkProps) => {\n    return <GradingStatusCell data={props.data} />;\n  };\n\n  private NotificationBadgeCell = (props: GradingNavLinkProps) => {\n    return (\n      <NotificationBadge\n        notificationFilter={filterNotificationsBySubmission(props.data.submissionId)}\n      />\n    );\n  };\n\n  /** Component to render in table - XP */\n  private GradingExp = (props: GradingNavLinkProps) => {\n    return <GradingXPCell data={props.data} />;\n  };\n\n  // Forcibly resizes columns to fit the width of the datagrid - prevents datagrid\n  // from needing to render a horizontal scrollbar when columns overflow grid width\n  private resizeGrid = () => {\n    if (this.gridApi) {\n      this.gridApi.sizeColumnsToFit();\n    }\n  };\n\n  private updatePaginationState = () => {\n    if (this.gridApi) {\n      const newTotalPages = this.gridApi.paginationGetTotalPages();\n      const newCurrPage = newTotalPages === 0 ? 0 : this.gridApi.paginationGetCurrentPage() + 1;\n      this.setState({\n        currPage: newCurrPage,\n        maxPages: newTotalPages,\n        rowCountString: this.formatRowCountString(\n          25,\n          newCurrPage,\n          newTotalPages,\n          this.gridApi.paginationGetRowCount()\n        ),\n        isBackDisabled: newTotalPages === 0 || newCurrPage === 1,\n        isForwardDisabled: newTotalPages === 0 || newCurrPage === newTotalPages\n      });\n    }\n  };\n\n  private formatRowCountString = (\n    pageSize: number,\n    currPage: number,\n    maxPages: number,\n    totalRows: number\n  ) => {\n    return maxPages === 0\n      ? '(none)'\n      : currPage !== maxPages\n      ? `(#${pageSize * currPage - 24} - #${pageSize * currPage})`\n      : `(#${pageSize * currPage - 24} - #${totalRows})`;\n  };\n\n  private handleFilterKeypress = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    if (event.key === 'Enter') {\n      this.applyFilter(event.currentTarget.value);\n    }\n  };\n\n  private handleApplyFilter = (event: React.FocusEvent<HTMLInputElement>) => {\n    this.applyFilter(event.target.value);\n  };\n\n  private handleGroupsFilter = () => {\n    if (this.gridApi) {\n      this.setState({ groupFilterEnabled: !this.state.groupFilterEnabled });\n      this.props.handleFetchGradingOverviews(this.state.groupFilterEnabled);\n    }\n  };\n\n  private applyFilter = (filter: string) => {\n    this.gridApi?.setQuickFilter(filter);\n  };\n\n  private onGridReady = (params: GridReadyEvent) => {\n    this.gridApi = params.api;\n    this.gridApi.sizeColumnsToFit();\n    this.updatePaginationState();\n  };\n\n  private exportCSV = () => {\n    if (this.gridApi) {\n      this.gridApi.exportDataAsCsv({\n        fileName: `SA submissions (${new Date().toISOString()}).csv`,\n        // Explicitly declare exported columns to avoid exporting trash columns\n        columnKeys: [\n          'assessmentName',\n          'assessmentCategory',\n          'studentName',\n          'groupName',\n          'submissionStatus',\n          'gradingStatus',\n          'questionCount',\n          'gradedCount',\n          'initialGrade',\n          'gradeAdjustment',\n          'currentGrade',\n          'maxGrade',\n          'initialXp',\n          'xpAdjustment',\n          'currentXp',\n          'maxXp',\n          'xpBonus'\n        ]\n      });\n    }\n  };\n\n  private changePaginationView = (type: string) => {\n    return () => {\n      if (this.gridApi) {\n        switch (type) {\n          case 'first':\n            return this.gridApi.paginationGoToFirstPage();\n          case 'prev':\n            return this.gridApi.paginationGoToPreviousPage();\n          case 'next':\n            return this.gridApi.paginationGoToNextPage();\n          case 'last':\n            return this.gridApi.paginationGoToLastPage();\n          default:\n        }\n      }\n    };\n  };\n\n  /** Constructs data nodes for the datagrid by joining grading overviews with their\n   *  associated notifications.\n   *  @return Returns an array of data nodes, prioritising grading overviews with\n   *  notifications first.\n   */\n  private sortSubmissionsByNotifications = () => {\n    if (!this.props.gradingOverviews) {\n      return [];\n    }\n\n    return (this.props.gradingOverviews as GradingOverviewWithNotifications[])\n      .map(overview => ({\n        ...overview,\n        notifications: filterNotificationsBySubmission(overview.submissionId)(\n          this.props.notifications\n        )\n      }))\n      .sort((subX, subY) => subY.notifications.length - subX.notifications.length);\n  };\n}\n\nexport default Grading;\n","import { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport {\n  acknowledgeNotifications,\n  fetchGradingOverviews,\n  reautogradeSubmission,\n  unsubmitSubmission\n} from '../../../commons/application/actions/SessionActions';\nimport { OverallState } from '../../../commons/application/ApplicationTypes';\nimport Grading, { DispatchProps, StateProps } from './Grading';\n\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => ({\n  gradingOverviews: state.session.gradingOverviews,\n  courseRegId: state.session.courseRegId,\n  notifications: state.session.notifications,\n  role: state.session.role,\n  courseId: state.session.courseId\n});\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleAcknowledgeNotifications: acknowledgeNotifications,\n      handleFetchGradingOverviews: fetchGradingOverviews,\n      handleUnsubmitSubmission: unsubmitSubmission,\n      handleReautogradeSubmission: reautogradeSubmission\n    },\n    dispatch\n  );\n\nconst GradingContainer = connect(mapStateToProps, mapDispatchToProps)(Grading);\n\nexport default GradingContainer;\n","import { Button, Classes, Dialog, Intent, Menu, MenuItem } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { ItemListRenderer, ItemRenderer, Select } from '@blueprintjs/select';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport * as React from 'react';\n\nimport {\n  defaultLanguages,\n  SALanguage,\n  sourceLanguages,\n  styliseSublanguage,\n  variantLanguages\n} from '../../../../commons/application/ApplicationTypes';\nimport ControlButton from '../../../../commons/ControlButton';\n\nexport type DefaultChapterSelectProps = DispatchProps & StateProps;\n\nexport type DispatchProps = {\n  handleUpdateSublanguage: (sublang: SALanguage) => void;\n};\n\nexport type StateProps = {\n  sourceChapter: Chapter;\n  sourceVariant: Variant;\n};\n\nconst DefaultChapterSelect: React.FunctionComponent<DefaultChapterSelectProps> = props => {\n  const { handleUpdateSublanguage } = props;\n  const { sourceChapter, sourceVariant } = props;\n\n  const [chosenSublang, setSublanguage] = React.useState<SALanguage>(sourceLanguages[0]);\n  const [isDialogOpen, setDialogState] = React.useState<boolean>(false);\n\n  const handleOpenDialog = React.useCallback(\n    (choice: SALanguage) => {\n      setDialogState(true);\n      setSublanguage(choice);\n    },\n    [setDialogState, setSublanguage]\n  );\n  const handleCloseDialog = React.useCallback(() => {\n    setDialogState(false);\n  }, [setDialogState]);\n  const handleConfirmDialog = React.useCallback(() => {\n    setDialogState(false);\n    handleUpdateSublanguage(chosenSublang);\n  }, [chosenSublang, setDialogState, handleUpdateSublanguage]);\n\n  const chapterRenderer: ItemRenderer<SALanguage> = React.useCallback(\n    (lang, { handleClick }) => (\n      <MenuItem key={lang.displayName} onClick={handleClick} text={lang.displayName} />\n    ),\n    []\n  );\n\n  const chapterListRenderer: ItemListRenderer<SALanguage> = React.useCallback(\n    ({ itemsParentRef, renderItem }) => {\n      const defaultChoices = defaultLanguages.map(renderItem);\n      const variantChoices = variantLanguages.map(renderItem);\n\n      return (\n        <Menu ulRef={itemsParentRef}>\n          {defaultChoices}\n          <MenuItem key=\"variant-menu\" text=\"Variants\" icon=\"cog\">\n            {variantChoices}\n          </MenuItem>\n        </Menu>\n      );\n    },\n    []\n  );\n\n  const DefaultChapterSelectComponent = Select.ofType<SALanguage>();\n\n  const dialog = (\n    <Dialog\n      canEscapeKeyClose={true}\n      canOutsideClickClose={true}\n      className=\"change-default-lang-dialog\"\n      icon={IconNames.ERROR}\n      isCloseButtonShown={true}\n      isOpen={isDialogOpen}\n      onClose={handleCloseDialog}\n      title=\"Updating default Source sublanguage\"\n    >\n      <div className={Classes.DIALOG_BODY}>\n        Are you sure you want to update the <b>default Playground Source sublanguage</b> from{' '}\n        {styliseSublanguage(sourceChapter, sourceVariant)} to <b>{chosenSublang.displayName}</b>?\n      </div>\n      <div className={Classes.DIALOG_FOOTER}>\n        <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n          <ControlButton label=\"Cancel\" onClick={handleCloseDialog} options={{ minimal: false }} />\n          <ControlButton\n            label=\"Confirm\"\n            onClick={handleConfirmDialog}\n            options={{ minimal: false, intent: Intent.DANGER }}\n          />\n        </div>\n      </div>\n    </Dialog>\n  );\n\n  return (\n    <>\n      <DefaultChapterSelectComponent\n        items={sourceLanguages}\n        onItemSelect={handleOpenDialog}\n        itemRenderer={chapterRenderer}\n        itemListRenderer={chapterListRenderer}\n        filterable={false}\n      >\n        <Button rightIcon={IconNames.DOUBLE_CARET_VERTICAL}>\n          <span className=\"hidden-xs hidden-sm\">Default sublanguage: </span>\n          <span>{styliseSublanguage(sourceChapter, sourceVariant)}</span>\n        </Button>\n      </DefaultChapterSelectComponent>\n      {dialog}\n    </>\n  );\n};\n\nexport default DefaultChapterSelect;\n","import { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\nimport Constants from 'src/commons/utils/Constants';\n\nimport { OverallState } from '../../../../commons/application/ApplicationTypes';\nimport { changeSublanguage } from '../../../../commons/workspace/WorkspaceActions';\nimport DefaultChapterSelect, { DispatchProps, StateProps } from './DefaultChapterSelect';\n\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => ({\n  // Temporarily load the defaults when the course configuration fetch has yet to return\n  sourceChapter: state.session.sourceChapter || Constants.defaultSourceChapter,\n  sourceVariant: state.session.sourceVariant || Constants.defaultSourceVariant\n});\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleUpdateSublanguage: changeSublanguage\n    },\n    dispatch\n  );\n\nconst DefaultChapterSelectContainer = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(DefaultChapterSelect);\n\nexport default DefaultChapterSelectContainer;\n","import { Classes, Dialog, Intent } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport * as React from 'react';\n\nimport { AssessmentOverview } from '../../../../commons/assessment/AssessmentTypes';\nimport ControlButton from '../../../../commons/ControlButton';\n\nexport type DeleteCellProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleDeleteAssessment: (id: number) => void;\n};\n\ntype StateProps = {\n  data: AssessmentOverview;\n};\n\nconst DeleteCell: React.FunctionComponent<DeleteCellProps> = props => {\n  const [isDialogOpen, setDialogState] = React.useState<boolean>(false);\n\n  const handleOpenDialog = React.useCallback(() => setDialogState(true), []);\n  const handleCloseDialog = React.useCallback(() => setDialogState(false), []);\n\n  const { handleDeleteAssessment, data } = props;\n\n  const handleDelete = React.useCallback(() => {\n    const { id } = data;\n    handleDeleteAssessment(id);\n    handleCloseDialog();\n  }, [data, handleCloseDialog, handleDeleteAssessment]);\n\n  return (\n    <>\n      <ControlButton icon={IconNames.TRASH} onClick={handleOpenDialog} />\n      <Dialog\n        icon={IconNames.WARNING_SIGN}\n        isOpen={isDialogOpen}\n        onClose={handleCloseDialog}\n        title=\"Deleting assessment\"\n        canOutsideClickClose={true}\n      >\n        <div className={Classes.DIALOG_BODY}>\n          <p>\n            Are you sure you want to <b>delete</b> the assessment <i>{data.title}</i>?\n          </p>\n          <p>\n            <b>All submissions and their answers will be deleted as well.</b>\n          </p>\n        </div>\n        <div className={Classes.DIALOG_FOOTER}>\n          <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n            <ControlButton\n              label=\"Cancel\"\n              icon={IconNames.CROSS}\n              onClick={handleCloseDialog}\n              options={{ minimal: false }}\n            />\n            <ControlButton\n              label=\"Confirm\"\n              icon={IconNames.TRASH}\n              onClick={handleDelete}\n              options={{ minimal: false, intent: Intent.DANGER }}\n            />\n          </div>\n        </div>\n      </Dialog>\n    </>\n  );\n};\n\nexport default DeleteCell;\n","import { Card, Elevation, HTMLSelect, Intent, Switch } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport { FileRejection, useDropzone } from 'react-dropzone';\nimport { AssessmentConfiguration } from 'src/commons/assessment/AssessmentTypes';\n\nimport ControlButton from '../../../../commons/ControlButton';\nimport { showWarningMessage } from '../../../../commons/utils/NotificationsHelper';\n\nexport type DropzoneProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleUploadAssessment: (file: File, forceUpdate: boolean, assessmentConfigId: number) => void;\n};\n\ntype StateProps = {\n  assessmentConfigurations?: AssessmentConfiguration[];\n};\n\nconst MaterialDropzone: React.FunctionComponent<DropzoneProps> = props => {\n  const [file, setFile] = React.useState<File | undefined>(undefined);\n  const [isWarningShown, setPromptShown] = React.useState<boolean>(false);\n  const [forceUpdate, setForceUpdate] = React.useState<boolean>(false);\n  const [assessmentConfigId, setAssessmentConfigId] = React.useState<number>(-1);\n\n  React.useEffect(() => {\n    if (props.assessmentConfigurations && assessmentConfigId === -1) {\n      setAssessmentConfigId(props.assessmentConfigurations[0].assessmentConfigId);\n    }\n  }, [props.assessmentConfigurations, assessmentConfigId]);\n\n  const { handleUploadAssessment } = props;\n\n  const htmlSelectOptions = React.useMemo(() => {\n    return props.assessmentConfigurations?.map(e => {\n      return {\n        value: e.assessmentConfigId,\n        label: e.type\n      };\n    });\n  }, [props.assessmentConfigurations]);\n\n  const handleConfirmUpload = React.useCallback(() => {\n    if (assessmentConfigId === -1) {\n      showWarningMessage('Please select a valid assessment type before uploading!');\n      return;\n    }\n    if (file) {\n      handleUploadAssessment(file, forceUpdate, assessmentConfigId);\n      setForceUpdate(false);\n    }\n    setFile(undefined);\n  }, [file, forceUpdate, handleUploadAssessment, assessmentConfigId]);\n  const handleCancelUpload = React.useCallback(() => setFile(undefined), [setFile]);\n\n  const handleDropAccepted = React.useCallback(\n    (acceptedFiles: File[]) => {\n      setFile(acceptedFiles[0]);\n      setForceUpdate(false);\n    },\n    [setFile]\n  );\n  const handleDropRejected = React.useCallback((rejectedFiles: FileRejection[]) => {\n    if (rejectedFiles.length > 1) {\n      showWarningMessage('Uploading multiple files at once is not currently supported!', 2000);\n    }\n  }, []);\n\n  const { getRootProps, getInputProps, isFocused, isDragActive, isDragAccept, isDragReject } =\n    useDropzone({\n      multiple: false,\n      onDropAccepted: handleDropAccepted,\n      onDropRejected: handleDropRejected\n    });\n\n  const classList = React.useMemo(() => {\n    return classNames(\n      'dropzone-base',\n      isFocused || isDragActive ? 'dropzone-active' : undefined,\n      isDragAccept ? 'dropzone-accept' : undefined,\n      isDragReject ? 'dropzone-reject' : undefined\n    );\n  }, [isFocused, isDragActive, isDragAccept, isDragReject]);\n\n  const handleSwitchOnChange = React.useCallback(() => {\n    if (!forceUpdate) {\n      setPromptShown(true);\n    } else {\n      setForceUpdate(false);\n    }\n  }, [forceUpdate, setPromptShown, setForceUpdate]);\n\n  const toggleButton = React.useMemo(\n    () => (\n      <div className=\"toggle-button-wrapper\">\n        <Switch checked={forceUpdate} onChange={handleSwitchOnChange} />\n      </div>\n    ),\n    [forceUpdate, handleSwitchOnChange]\n  );\n\n  const handleConfirmForceUpdate = React.useCallback(() => {\n    setForceUpdate(true);\n    setPromptShown(false);\n  }, [setForceUpdate]);\n  const handleCancelForceUpdate = React.useCallback(() => {\n    setPromptShown(false);\n  }, [setPromptShown]);\n\n  const confirmationPrompt = React.useMemo(\n    () => (\n      <div className=\"dropzone-controls\">\n        <ControlButton\n          label=\"Yes\"\n          icon={IconNames.CONFIRM}\n          onClick={handleConfirmForceUpdate}\n          options={{ minimal: false, intent: Intent.DANGER }}\n        />\n        <ControlButton\n          label=\"No\"\n          icon={IconNames.CROSS}\n          onClick={handleCancelForceUpdate}\n          options={{ minimal: false }}\n        />\n      </div>\n    ),\n    [handleCancelForceUpdate, handleConfirmForceUpdate]\n  );\n\n  return (\n    <>\n      <Card elevation={Elevation.TWO} interactive={true}>\n        <div {...getRootProps({ className: classList })}>\n          <input {...getInputProps()} />\n          <p>Drag 'n' drop a file here, or click to select a file</p>\n        </div>\n      </Card>\n      {file && (\n        <Card className=\"dropzone-prompt\" elevation={Elevation.TWO} interactive={true}>\n          <h3>{file?.name}</h3>\n          {!isWarningShown && (\n            <>\n              <div className=\"dropzone-controls\">\n                <HTMLSelect\n                  options={htmlSelectOptions}\n                  onChange={e => setAssessmentConfigId(parseInt(e.target.value))}\n                  value={assessmentConfigId}\n                />\n                <ControlButton\n                  label=\"Confirm Upload\"\n                  icon={IconNames.UPLOAD}\n                  onClick={handleConfirmUpload}\n                  options={{ minimal: false, intent: Intent.DANGER }}\n                />\n                <ControlButton\n                  label=\"Cancel Upload\"\n                  icon={IconNames.DELETE}\n                  onClick={handleCancelUpload}\n                  options={{ minimal: false }}\n                />\n              </div>\n              <div className=\"dropzone-controls\">\n                <p>Force update opened assessment</p>\n                {toggleButton}\n              </div>\n            </>\n          )}\n          {isWarningShown && <p>Are you sure that you want to force update the assessment?</p>}\n          {isWarningShown && confirmationPrompt}\n        </Card>\n      )}\n    </>\n  );\n};\n\nexport default MaterialDropzone;\n","import { Classes, Dialog, Intent } from '@blueprintjs/core';\nimport { DateInput } from '@blueprintjs/datetime';\nimport { IconNames } from '@blueprintjs/icons';\nimport * as moment from 'moment';\nimport * as React from 'react';\n\nimport { AssessmentOverview } from '../../../../commons/assessment/AssessmentTypes';\nimport ControlButton from '../../../../commons/ControlButton';\nimport { showWarningMessage } from '../../../../commons/utils/NotificationsHelper';\n\nexport type EditCellProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleAssessmentChangeDate: (id: number, openAt: string, closeAt: string) => void;\n};\n\ntype StateProps = {\n  data: AssessmentOverview;\n  forOpenDate: boolean;\n};\n\nconst dateDisplayFormat = 'YYYY-MM-DD HH:mm:ss ZZ';\n\nconst EditCell: React.FunctionComponent<EditCellProps> = props => {\n  const minDate = new Date(2010, 0, 0);\n  const maxDate = new Date(2030, 11, 31);\n\n  const { data, forOpenDate } = props;\n  const currentDateString = forOpenDate ? data.openAt : data.closeAt;\n  const currentDate = moment(currentDateString, moment.ISO_8601, true);\n\n  const [isDialogOpen, setDialogState] = React.useState<boolean>(false);\n  const [newDate, setNewDate] = React.useState<moment.Moment | null>(currentDate);\n\n  const handleOpenDialog = React.useCallback(() => setDialogState(true), []);\n  const handleCloseDialog = React.useCallback(() => setDialogState(false), []);\n\n  const { handleAssessmentChangeDate } = props;\n\n  const handleUpdateDate = React.useCallback(() => {\n    if (!newDate) {\n      // Reset date to current date if no date is selected (null date) in the date input\n      showWarningMessage('No date and time selected!', 2000);\n      setNewDate(currentDate);\n    } else {\n      const { id, openAt, closeAt } = data;\n      handleAssessmentChangeDate(\n        id,\n        forOpenDate ? newDate.toISOString() : openAt,\n        forOpenDate ? closeAt : newDate.toISOString()\n      );\n      handleCloseDialog();\n    }\n  }, [newDate, currentDate, data, handleAssessmentChangeDate, forOpenDate, handleCloseDialog]);\n\n  const handleParseDate = (str: string) => {\n    const date = moment(str, dateDisplayFormat, true);\n    return date.isValid() ? date.toDate() : false;\n  };\n  const handleFormatDate = (date: Date) => moment(date).format(dateDisplayFormat);\n\n  const handleDateChange = React.useCallback(\n    (selectedDate: Date | null) => setNewDate(moment(selectedDate)),\n    []\n  );\n  const handleDateError = React.useCallback(() => {\n    // Reset date to current date if user enters an invalid date string\n    showWarningMessage('Failed to parse date string! Defaulting to current date.', 2000);\n    setNewDate(currentDate);\n  }, [currentDate]);\n\n  const dateInput = (\n    <DateInput\n      formatDate={handleFormatDate}\n      onChange={handleDateChange}\n      onError={handleDateError}\n      parseDate={handleParseDate}\n      placeholder={`${dateDisplayFormat} or select a date`}\n      value={newDate?.toDate()}\n      timePrecision={'second'}\n      fill={true}\n      minDate={minDate}\n      maxDate={maxDate}\n      closeOnSelection={false}\n    />\n  );\n\n  return (\n    <>\n      <span className=\"date-cell-text\">{currentDate.format(dateDisplayFormat)}</span>\n      <ControlButton icon={IconNames.EDIT} onClick={handleOpenDialog} />\n      <Dialog\n        icon={IconNames.INFO_SIGN}\n        isOpen={isDialogOpen}\n        onClose={handleCloseDialog}\n        title=\"Updating assessment settings\"\n        canOutsideClickClose={true}\n      >\n        <div className={Classes.DIALOG_BODY}>\n          <p>{forOpenDate ? 'Opening' : 'Closing'} date and time:</p>\n          {dateInput}\n        </div>\n        <div className={Classes.DIALOG_FOOTER}>\n          <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n            <ControlButton\n              label=\"Cancel\"\n              icon={IconNames.CROSS}\n              onClick={handleCloseDialog}\n              options={{ minimal: false }}\n            />\n            <ControlButton\n              label=\"Confirm\"\n              icon={IconNames.TICK}\n              onClick={handleUpdateDate}\n              options={{ minimal: false, intent: Intent.DANGER }}\n            />\n          </div>\n        </div>\n      </Dialog>\n    </>\n  );\n};\n\nexport default EditCell;\n","import { Classes, Dialog, Intent, Switch } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport * as React from 'react';\n\nimport { AssessmentOverview } from '../../../../commons/assessment/AssessmentTypes';\nimport ControlButton from '../../../../commons/ControlButton';\n\nexport type PublishCellProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handlePublishAssessment: (togglePublishTo: boolean, id: number) => void;\n};\n\ntype StateProps = {\n  data: AssessmentOverview;\n};\n\nconst PublishCell: React.FunctionComponent<PublishCellProps> = props => {\n  const { data } = props;\n\n  const [isDialogOpen, setDialogState] = React.useState<boolean>(false);\n  const [isPublished] = React.useState<boolean>(!!data.isPublished);\n\n  const handleOpenDialog = React.useCallback(() => setDialogState(true), []);\n  const handleCloseDialog = React.useCallback(() => setDialogState(false), []);\n\n  const { handlePublishAssessment } = props;\n\n  const handleTogglePublished = React.useCallback(() => {\n    const { id } = data;\n    handlePublishAssessment(!isPublished, id);\n    handleCloseDialog();\n  }, [data, isPublished, handleCloseDialog, handlePublishAssessment]);\n\n  return (\n    <>\n      <Switch className=\"publish-cell\" checked={isPublished} onChange={handleOpenDialog} />\n      <Dialog\n        icon={IconNames.WARNING_SIGN}\n        isOpen={isDialogOpen}\n        onClose={handleCloseDialog}\n        title={`${isPublished ? 'Unpublish' : 'Publish'} assessment`}\n        canOutsideClickClose={true}\n      >\n        <div className={Classes.DIALOG_BODY}>\n          <p>\n            Are you sure you want to <b>{isPublished ? 'unpublish' : 'publish'}</b> the assessment{' '}\n            <i>{data.title}</i>?\n          </p>\n          {isPublished ? (\n            <p>\n              <b>\n                This will hide the assessment for students and prevent them from uploading new\n                answers. Admins and staff are not affected.\n              </b>\n            </p>\n          ) : null}\n        </div>\n        <div className={Classes.DIALOG_FOOTER}>\n          <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n            <ControlButton\n              label=\"Cancel\"\n              icon={IconNames.CROSS}\n              onClick={handleCloseDialog}\n              options={{ minimal: false }}\n            />\n            <ControlButton\n              label=\"Confirm\"\n              icon={IconNames.CONFIRM}\n              onClick={handleTogglePublished}\n              options={{ minimal: false, intent: Intent.DANGER }}\n            />\n          </div>\n        </div>\n      </Dialog>\n    </>\n  );\n};\n\nexport default PublishCell;\n","import 'ag-grid-community/dist/styles/ag-grid.css';\nimport 'ag-grid-community/dist/styles/ag-theme-balham.css';\n\nimport { Button, Collapse, Divider, Intent } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { ColDef, ColumnApi, GridApi, GridReadyEvent } from 'ag-grid-community';\nimport { AgGridReact } from 'ag-grid-react';\nimport * as React from 'react';\n\nimport {\n  AssessmentConfiguration,\n  AssessmentOverview\n} from '../../../commons/assessment/AssessmentTypes';\nimport ContentDisplay from '../../../commons/ContentDisplay';\nimport DefaultChapterSelect from './subcomponents/DefaultChapterSelectContainer';\nimport DeleteCell from './subcomponents/GroundControlDeleteCell';\nimport Dropzone from './subcomponents/GroundControlDropzone';\nimport EditCell from './subcomponents/GroundControlEditCell';\nimport PublishCell from './subcomponents/GroundControlPublishCell';\n\nexport type GroundControlProps = DispatchProps & StateProps;\n\nexport type DispatchProps = {\n  handleAssessmentOverviewFetch: () => void;\n  handleDeleteAssessment: (id: number) => void;\n  handleUploadAssessment: (file: File, forceUpdate: boolean, assessmentConfigId: number) => void;\n  handlePublishAssessment: (togglePublishTo: boolean, id: number) => void;\n  handleAssessmentChangeDate: (id: number, openAt: string, closeAt: string) => void;\n  handleFetchCourseConfigs: () => void;\n};\n\nexport type StateProps = {\n  assessmentOverviews?: AssessmentOverview[];\n  assessmentConfigurations?: AssessmentConfiguration[];\n};\n\ntype State = {\n  showDropzone: boolean;\n};\n\nclass GroundControl extends React.Component<GroundControlProps, State> {\n  private columnDefs: ColDef[];\n  private defaultColumnDefs: ColDef;\n  private gridApi?: GridApi;\n  private columnApi?: ColumnApi;\n\n  public constructor(props: GroundControlProps) {\n    super(props);\n\n    this.state = {\n      showDropzone: false\n    };\n\n    this.columnDefs = [\n      {\n        field: 'number',\n        headerName: 'ID',\n        width: 50\n      },\n      {\n        headerName: 'Title',\n        field: 'title'\n      },\n      {\n        headerName: 'Category',\n        field: 'type',\n        width: 100\n      },\n      {\n        headerName: 'Open Date',\n        field: 'openAt',\n        filter: 'agDateColumnFilter',\n        filterParams: {\n          comparator: this.dateFilterComparator,\n          inRangeInclusive: true\n        },\n        sortingOrder: ['desc', 'asc', null],\n        cellRendererFramework: EditCell,\n        cellRendererParams: {\n          handleAssessmentChangeDate: this.props.handleAssessmentChangeDate,\n          forOpenDate: true\n        },\n        width: 150\n      },\n      {\n        headerName: 'Close Date',\n        field: 'closeAt',\n        filter: 'agDateColumnFilter',\n        filterParams: {\n          comparator: this.dateFilterComparator,\n          inRangeInclusive: true\n        },\n        sortingOrder: ['desc', 'asc', null],\n        cellRendererFramework: EditCell,\n        cellRendererParams: {\n          handleAssessmentChangeDate: this.props.handleAssessmentChangeDate,\n          forOpenDate: false\n        },\n        width: 150\n      },\n      {\n        headerName: 'Publish',\n        field: '',\n        cellRendererFramework: PublishCell,\n        cellRendererParams: {\n          handlePublishAssessment: this.props.handlePublishAssessment\n        },\n        width: 100,\n        filter: false,\n        resizable: false,\n        sortable: false,\n        cellStyle: {\n          padding: 0\n        }\n      },\n      {\n        headerName: 'Delete',\n        field: '',\n        cellRendererFramework: DeleteCell,\n        cellRendererParams: {\n          handleDeleteAssessment: this.props.handleDeleteAssessment\n        },\n        width: 100,\n        filter: false,\n        resizable: false,\n        sortable: false,\n        cellStyle: {\n          padding: 0\n        }\n      }\n    ];\n\n    this.defaultColumnDefs = {\n      filter: true,\n      resizable: true,\n      sortable: true\n    };\n  }\n\n  public render() {\n    const controls = (\n      <div className=\"GridControls ground-control-controls\">\n        <Button\n          active={this.state.showDropzone}\n          icon={IconNames.CLOUD_UPLOAD}\n          intent={this.state.showDropzone ? Intent.PRIMARY : Intent.NONE}\n          onClick={this.toggleDropzone}\n        >\n          <span className=\"hidden-xs\">Upload assessment</span>\n        </Button>\n        <DefaultChapterSelect />\n        <Button icon={IconNames.REFRESH} onClick={this.props.handleAssessmentOverviewFetch}>\n          <span className=\"hidden-xs\">Refresh assessments</span>\n        </Button>\n      </div>\n    );\n\n    const dropzone = (\n      <Collapse isOpen={this.state.showDropzone} keepChildrenMounted={true}>\n        <Dropzone\n          handleUploadAssessment={this.props.handleUploadAssessment}\n          assessmentConfigurations={this.props.assessmentConfigurations}\n        />\n      </Collapse>\n    );\n\n    const grid = (\n      <div className=\"Grid ag-grid-parent ag-theme-balham\">\n        <AgGridReact\n          domLayout={'autoHeight'}\n          columnDefs={this.columnDefs}\n          defaultColDef={this.defaultColumnDefs}\n          onGridReady={this.onGridReady}\n          onGridSizeChanged={this.resizeGrid}\n          rowData={this.props.assessmentOverviews}\n          rowHeight={30}\n          suppressCellSelection={true}\n          suppressMovableColumns={true}\n          suppressPaginationPanel={true}\n        />\n      </div>\n    );\n\n    const content = (\n      <div className=\"GroundControl\">\n        {controls}\n        {dropzone}\n        <Divider />\n        {grid}\n      </div>\n    );\n\n    return (\n      <div>\n        <ContentDisplay display={content} loadContentDispatch={this.loadContent} />\n      </div>\n    );\n  }\n\n  private loadContent = () => {\n    // Always load AssessmentOverviews and CourseConfigs to get the latest values (just in case)\n    this.props.handleAssessmentOverviewFetch();\n    this.props.handleFetchCourseConfigs();\n  };\n\n  /*\n   *  Reference: https://www.ag-grid.com/javascript-grid-filter-date/#date-filter-comparator\n   */\n  private dateFilterComparator = (filterDate: Date, cellValue: string) => {\n    const cellDate = new Date(cellValue);\n\n    return cellDate < filterDate ? -1 : cellDate > filterDate ? 1 : 0;\n  };\n\n  private onGridReady = (params: GridReadyEvent) => {\n    this.gridApi = params.api;\n    this.columnApi = params.columnApi;\n    this.gridApi.sizeColumnsToFit();\n\n    // Sort assessments by opening date, breaking ties by later of closing dates\n    this.columnApi.applyColumnState({\n      state: [\n        { colId: 'openAt', sort: 'desc' },\n        { colId: 'closeAt', sort: 'desc' }\n      ]\n    });\n  };\n\n  private resizeGrid = () => {\n    if (this.gridApi) {\n      this.gridApi.sizeColumnsToFit();\n    }\n  };\n\n  private toggleDropzone = () => {\n    this.setState({ showDropzone: !this.state.showDropzone });\n  };\n}\n\nexport default GroundControl;\n","import { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport {\n  fetchAssessmentOverviews,\n  fetchCourseConfig\n} from '../../../commons/application/actions/SessionActions';\nimport { OverallState } from '../../../commons/application/ApplicationTypes';\nimport {\n  changeDateAssessment,\n  deleteAssessment,\n  publishAssessment,\n  uploadAssessment\n} from '../../../features/groundControl/GroundControlActions';\nimport GroundControl, { DispatchProps, StateProps } from './GroundControl';\n\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => ({\n  assessmentOverviews: state.session.assessmentOverviews,\n  assessmentConfigurations: state.session.assessmentConfigurations\n});\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleAssessmentChangeDate: changeDateAssessment,\n      handleAssessmentOverviewFetch: fetchAssessmentOverviews,\n      handleDeleteAssessment: deleteAssessment,\n      handleUploadAssessment: uploadAssessment,\n      handlePublishAssessment: publishAssessment,\n      handleFetchCourseConfigs: fetchCourseConfig\n    },\n    dispatch\n  );\n\nconst GroundControlContainer = connect(mapStateToProps, mapDispatchToProps)(GroundControl);\n\nexport default GroundControlContainer;\n","import { Card, Classes, Dialog, H1, InputGroup } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport * as React from 'react';\nimport Recorder from 'yareco';\n\nimport ControlButton from '../../../../commons/ControlButton';\nimport {\n  Input,\n  PlaybackData,\n  RecordingStatus\n} from '../../../../features/sourceRecorder/SourceRecorderTypes';\n\ntype SourcereelControlbarProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleRecordInit: () => void;\n  handleRecordPause: () => void;\n  handleResetInputs: (inputs: Input[]) => void;\n  handleSaveSourcecastData: (\n    title: string,\n    description: string,\n    uid: string,\n    audio: Blob,\n    playbackData: PlaybackData\n  ) => void;\n  handleSetSourcecastData: (\n    title: string,\n    description: string,\n    uid: string,\n    audioUrl: string,\n    playbackData: PlaybackData\n  ) => void;\n  handleSetIsEditorReadonly: (readonly: boolean) => void;\n  handleTimerPause: () => void;\n  handleTimerReset: () => void;\n  handleTimerResume: (timeBefore: number) => void;\n  handleTimerStart: () => void;\n  handleTimerStop: () => void;\n  getTimerDuration: () => number;\n};\n\ntype StateProps = {\n  currentPlayerTime: number;\n  editorValue: string;\n  playbackData: PlaybackData;\n  recordingStatus: RecordingStatus;\n};\n\ntype State = {\n  dialogOpen: boolean;\n  duration: number;\n  fileDataBlob?: Blob;\n  updater?: NodeJS.Timeout;\n  saveTitle: string;\n  saveDescription: string;\n  saveUID: string;\n};\n\nclass SourcereelControlbar extends React.PureComponent<SourcereelControlbarProps, State> {\n  private recorder?: Recorder = undefined;\n\n  constructor(props: SourcereelControlbarProps) {\n    super(props);\n    this.state = {\n      dialogOpen: false,\n      duration: 0,\n      updater: undefined,\n      saveTitle: '',\n      saveDescription: '',\n      saveUID: ''\n    };\n  }\n\n  public async componentDidMount() {\n    Recorder.getPermission().then(\n      () => {},\n      (error: any) => {\n        alert('Microphone not found: ' + error);\n      }\n    );\n  }\n\n  public render() {\n    const RecorderRecordPauseButton = (\n      <ControlButton\n        label=\"Record Pause\"\n        icon={IconNames.SNOWFLAKE}\n        onClick={this.props.handleRecordPause}\n      />\n    );\n    const RecorderPauseButton = (\n      <ControlButton label=\"Pause\" icon={IconNames.PAUSE} onClick={this.handleRecorderPausing} />\n    );\n    const RecorderResumeButton = (\n      <ControlButton label=\"Resume\" icon={IconNames.PLAY} onClick={this.handleRecorderResuming} />\n    );\n    const RecorderResumeFromCurrentButton = (\n      <ControlButton\n        label=\"Resume Here\"\n        icon={IconNames.PLAY}\n        onClick={this.handleRecorderResumingFromCurrent}\n      />\n    );\n    const RecorderStartButton = (\n      <ControlButton label=\"Record\" icon={IconNames.PLAY} onClick={this.handleRecorderStarting} />\n    );\n    const RecorderStopButton = (\n      <ControlButton label=\"Stop\" icon={IconNames.STOP} onClick={this.handleRecorderStopping} />\n    );\n    const RecorderResetButton = (\n      <ControlButton\n        label=\"Reset\"\n        icon={IconNames.REFRESH}\n        onClick={this.handleRecorderResetting}\n      />\n    );\n    const RecorderSaveButton = (\n      <ControlButton label=\"Upload\" icon={IconNames.FLOPPY_DISK} onClick={this.handleOpenDialog} />\n    );\n    return (\n      <div>\n        <Dialog\n          icon=\"info-sign\"\n          isOpen={this.state.dialogOpen}\n          onClose={this.handleCloseDialog}\n          title=\"Upload Sourcecast\"\n          canOutsideClickClose={true}\n        >\n          <div className={Classes.DIALOG_BODY}>\n            <InputGroup\n              id=\"title\"\n              leftIcon={IconNames.HEADER}\n              onChange={this.handleSaveTitleInputChange}\n              placeholder=\"Title\"\n              value={this.state.saveTitle}\n            />\n            <br />\n            <InputGroup\n              id=\"description\"\n              leftIcon={IconNames.LIST_DETAIL_VIEW}\n              onChange={this.handleSaveDescriptionInputChange}\n              placeholder=\"Description\"\n              value={this.state.saveDescription}\n            />\n            <br />\n            <InputGroup\n              id=\"uid\"\n              leftIcon={IconNames.KEY}\n              onChange={this.handleSaveUIDInputChange}\n              placeholder=\"UID (optional, only alphanumeric, dash and underscore allowed)\"\n              value={this.state.saveUID}\n            />\n          </div>\n          <div className={Classes.DIALOG_FOOTER}>\n            <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n              <ControlButton\n                label=\"Confirm Upload\"\n                icon={IconNames.TICK}\n                onClick={this.handleRecorderSaving}\n              />\n              <ControlButton\n                label=\"Cancel\"\n                icon={IconNames.CROSS}\n                onClick={this.handleCloseDialog}\n              />\n            </div>\n          </div>\n        </Dialog>\n        <br />\n        <div className=\"Timer\">\n          <Card elevation={2} style={{ background: '#24323F' }}>\n            <H1>\n              {this.renderLabel(\n                this.props.recordingStatus !== RecordingStatus.paused\n                  ? this.state.duration / 1000\n                  : this.props.currentPlayerTime\n              )}\n            </H1>\n          </Card>\n        </div>\n        <br />\n        <div className=\"RecorderControl\">\n          {this.props.recordingStatus === RecordingStatus.notStarted && RecorderStartButton}\n          {this.props.recordingStatus === RecordingStatus.paused && RecorderResumeButton}\n          {this.props.recordingStatus === RecordingStatus.paused && RecorderResumeFromCurrentButton}\n          {this.props.recordingStatus === RecordingStatus.recording && RecorderPauseButton}\n          {this.props.recordingStatus === RecordingStatus.recording && RecorderRecordPauseButton}\n          {this.props.recordingStatus === RecordingStatus.paused && RecorderStopButton}\n          {this.props.recordingStatus === RecordingStatus.finished && RecorderSaveButton}\n          {this.props.recordingStatus !== RecordingStatus.notStarted && RecorderResetButton}\n        </div>\n        <br />\n      </div>\n    );\n  }\n\n  private handleCloseDialog = () => this.setState({ dialogOpen: false });\n\n  private handleOpenDialog = () => this.setState({ dialogOpen: true });\n\n  private updateTimerDuration = () => {\n    this.setState({ duration: this.props.getTimerDuration() });\n  };\n\n  private handleTruncatePlaybackData = () => {\n    const truncatedInputs = this.props.playbackData.inputs.filter(\n      deltaWithTime => deltaWithTime.time <= this.props.currentPlayerTime * 1000\n    );\n    this.props.handleResetInputs(truncatedInputs);\n  };\n\n  private handleRecorderPausing = () => {\n    if (!this.recorder) {\n      return;\n    }\n    const { handleSetIsEditorReadonly, handleSetSourcecastData, handleTimerPause } = this.props;\n    clearInterval(this.state.updater!);\n    handleSetIsEditorReadonly(true);\n    handleTimerPause();\n    this.recorder.pause();\n    const audioUrl = window.URL.createObjectURL(this.recorder.exportWAV());\n    handleSetSourcecastData('', '', '', audioUrl, this.props.playbackData);\n  };\n\n  private handleRecorderStarting = () => {\n    this.recorder = new Recorder();\n    const { handleRecordInit, handleSetIsEditorReadonly, handleTimerStart } = this.props;\n    this.recorder.start().then(\n      () => {\n        handleRecordInit();\n        handleSetIsEditorReadonly(false);\n        handleTimerStart();\n        const updater = setInterval(this.updateTimerDuration, 100);\n        this.setState({ updater });\n        // this.recorder.onRecord = (duration: number) => console.log(duration);\n      },\n      (error: any) => {\n        alert('Microphone not found: ' + error);\n      }\n    );\n  };\n\n  private handleRecorderResuming = () => {\n    if (!this.recorder) {\n      return;\n    }\n    const { handleSetIsEditorReadonly, handleTimerResume } = this.props;\n    handleSetIsEditorReadonly(false);\n    // -1 means resume from the end\n    handleTimerResume(-1);\n    const updater = setInterval(this.updateTimerDuration, 100);\n    this.setState({ updater });\n    this.recorder.resume();\n  };\n\n  private handleRecorderResumingFromCurrent = () => {\n    if (!this.recorder) {\n      return;\n    }\n    const { currentPlayerTime, handleSetIsEditorReadonly, handleTimerResume } = this.props;\n    this.handleTruncatePlaybackData();\n    handleSetIsEditorReadonly(false);\n    handleTimerResume(currentPlayerTime * 1000);\n    const updater = setInterval(this.updateTimerDuration, 100);\n    this.setState({ updater });\n    this.recorder.resume(currentPlayerTime);\n  };\n\n  private handleRecorderStopping = () => {\n    if (!this.recorder) {\n      return;\n    }\n    const { handleSetIsEditorReadonly, handleTimerStop } = this.props;\n    handleSetIsEditorReadonly(false);\n    handleTimerStop();\n    clearInterval(this.state.updater!);\n    this.recorder.stop();\n    this.setState({\n      fileDataBlob: this.recorder.exportWAV()\n    });\n    this.recorder.clear();\n  };\n\n  private handleRecorderResetting = () => {\n    const { handleSetIsEditorReadonly, handleTimerReset } = this.props;\n    handleSetIsEditorReadonly(false);\n    handleTimerReset();\n    clearInterval(this.state.updater!);\n    this.setState({ duration: 0 });\n    if (this.recorder) {\n      this.recorder.stop();\n      this.recorder.clear();\n    }\n  };\n\n  private handleRecorderSaving = () => {\n    if (!this.state.fileDataBlob) {\n      alert('No recording found');\n      return;\n    }\n    this.props.handleSaveSourcecastData(\n      this.state.saveTitle,\n      this.state.saveDescription,\n      this.state.saveUID,\n      this.state.fileDataBlob,\n      this.props.playbackData\n    );\n  };\n\n  private renderLabel = (value: number) => {\n    const min = Math.floor(value / 60);\n    const sec = Math.floor(value - min * 60);\n    const minString = min < 10 ? '0' + min : min;\n    const secString = sec < 10 ? '0' + sec : sec;\n    return minString + ':' + secString;\n  };\n\n  private handleSaveTitleInputChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    this.setState({ saveTitle: event.target.value });\n  };\n\n  private handleSaveDescriptionInputChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    this.setState({ saveDescription: event.target.value });\n  };\n\n  private handleSaveUIDInputChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    this.setState({ saveUID: event.target.value });\n  };\n}\n\nexport default SourcereelControlbar;\n","import { Classes, Pre } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport classNames from 'classnames';\nimport _ from 'lodash';\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport {\n  beginDebuggerPause,\n  beginInterruptExecution,\n  debuggerReset,\n  debuggerResume\n} from 'src/commons/application/actions/InterpreterActions';\nimport { fetchSourcecastIndex } from 'src/features/sourceRecorder/sourcecast/SourcecastActions';\nimport {\n  saveSourcecastData,\n  setCodeDeltasToApply,\n  setCurrentPlayerTime,\n  setInputToApply,\n  setSourcecastData,\n  setSourcecastDuration\n} from 'src/features/sourceRecorder/SourceRecorderActions';\nimport {\n  deleteSourcecastEntry,\n  recordInit,\n  resetInputs,\n  timerPause,\n  timerReset,\n  timerResume,\n  timerStart,\n  timerStop\n} from 'src/features/sourceRecorder/sourcereel/SourcereelActions';\n\nimport { InterpreterOutput } from '../../../commons/application/ApplicationTypes';\nimport { ExternalLibraryName } from '../../../commons/application/types/ExternalTypes';\nimport { ControlBarAutorunButtons } from '../../../commons/controlBar/ControlBarAutorunButtons';\nimport { ControlBarChapterSelect } from '../../../commons/controlBar/ControlBarChapterSelect';\nimport { ControlBarClearButton } from '../../../commons/controlBar/ControlBarClearButton';\nimport { ControlBarEvalButton } from '../../../commons/controlBar/ControlBarEvalButton';\nimport {\n  convertEditorTabStateToProps,\n  SourcecastEditorContainerProps\n} from '../../../commons/editor/EditorContainer';\nimport SideContentDataVisualizer from '../../../commons/sideContent/SideContentDataVisualizer';\nimport SideContentEnvVisualizer from '../../../commons/sideContent/SideContentEnvVisualizer';\nimport { SideContentTab, SideContentType } from '../../../commons/sideContent/SideContentTypes';\nimport SourceRecorderControlBar, {\n  SourceRecorderControlBarProps\n} from '../../../commons/sourceRecorder/SourceRecorderControlBar';\nimport SourcecastTable from '../../../commons/sourceRecorder/SourceRecorderTable';\nimport Workspace, { WorkspaceProps } from '../../../commons/workspace/Workspace';\nimport {\n  browseReplHistoryDown,\n  browseReplHistoryUp,\n  changeSideContentHeight,\n  clearReplOutput,\n  navigateToDeclaration,\n  promptAutocomplete,\n  setEditorBreakpoint,\n  toggleEditorAutorun,\n  updateReplValue\n} from '../../../commons/workspace/WorkspaceActions';\nimport { EditorTabState, WorkspaceLocation } from '../../../commons/workspace/WorkspaceTypes';\nimport {\n  CodeDelta,\n  Input,\n  KeyboardCommand,\n  PlaybackData,\n  PlaybackStatus,\n  RecordingStatus,\n  SourcecastData\n} from '../../../features/sourceRecorder/SourceRecorderTypes';\nimport SourcereelControlbar from './subcomponents/SourcereelControlbar';\n\ntype SourcereelProps = DispatchProps & StateProps;\n\nexport type DispatchProps = {\n  handleChapterSelect: (chapter: Chapter) => void;\n  handleEditorEval: () => void;\n  handleEditorValueChange: (val: string) => void;\n  handleExternalSelect: (externalLibraryName: ExternalLibraryName) => void;\n  handleRecordInput: (input: Input) => void;\n  handleReplEval: () => void;\n  handleSetIsEditorReadonly: (editorReadonly: boolean) => void;\n  handleSetSourcecastStatus: (PlaybackStatus: PlaybackStatus) => void;\n};\n\nexport type StateProps = {\n  audioUrl: string;\n  currentPlayerTime: number;\n  codeDeltasToApply: CodeDelta[] | null;\n  activeEditorTabIndex: number | null;\n  editorTabs: EditorTabState[];\n  isEditorReadonly: boolean;\n  enableDebugging: boolean;\n  externalLibraryName: ExternalLibraryName;\n  inputToApply: Input | null;\n  isDebugging: boolean;\n  isEditorAutorun: boolean;\n  isRunning: boolean;\n  output: InterpreterOutput[];\n  playbackData: PlaybackData;\n  playbackDuration: number;\n  playbackStatus: PlaybackStatus;\n  recordingStatus: RecordingStatus;\n  replValue: string;\n  timeElapsedBeforePause: number;\n  sideContentHeight?: number;\n  sourcecastIndex: SourcecastData[] | null;\n  sourceChapter: Chapter;\n  sourceVariant: Variant;\n  timeResumed: number;\n  courseId?: number;\n};\n\nconst workspaceLocation: WorkspaceLocation = 'sourcereel';\n\nconst Sourcereel: React.FC<SourcereelProps> = props => {\n  const [selectedTab, setSelectedTab] = useState(SideContentType.sourcereel);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    fetchSourcecastIndex('sourcecast');\n  }, []);\n\n  useEffect(() => {\n    const { inputToApply } = props;\n\n    if (!inputToApply) {\n      return;\n    }\n\n    switch (inputToApply.type) {\n      case 'activeTabChange':\n        setSelectedTab(inputToApply.data);\n        break;\n      case 'chapterSelect':\n        props.handleChapterSelect(inputToApply.data);\n        break;\n      case 'externalLibrarySelect':\n        props.handleExternalSelect(inputToApply.data);\n        break;\n      case 'forcePause':\n        props.handleSetSourcecastStatus(PlaybackStatus.forcedPaused);\n        break;\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.inputToApply]);\n\n  const getTimerDuration = () => props.timeElapsedBeforePause + Date.now() - props.timeResumed;\n\n  const handleRecordInit = () => {\n    const initData: PlaybackData['init'] = {\n      chapter: props.sourceChapter,\n      externalLibrary: props.externalLibraryName as ExternalLibraryName,\n      // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n      editorValue: props.editorTabs[0].value\n    };\n    dispatch(recordInit(initData, workspaceLocation));\n  };\n\n  const handleRecordPause = () =>\n    props.handleRecordInput({\n      time: getTimerDuration(),\n      type: 'forcePause',\n      data: null\n    });\n\n  const editorEvalHandler = () => {\n    props.handleEditorEval();\n    if (props.recordingStatus !== RecordingStatus.recording) {\n      return;\n    }\n    props.handleRecordInput({\n      time: getTimerDuration(),\n      type: 'keyboardCommand',\n      data: KeyboardCommand.run\n    });\n  };\n  const autorunButtons = (\n    <ControlBarAutorunButtons\n      handleDebuggerPause={() => dispatch(beginDebuggerPause(workspaceLocation))}\n      handleDebuggerResume={() => dispatch(debuggerResume(workspaceLocation))}\n      handleDebuggerReset={() => dispatch(debuggerReset(workspaceLocation))}\n      handleEditorEval={editorEvalHandler}\n      handleInterruptEval={() => dispatch(beginInterruptExecution(workspaceLocation))}\n      handleToggleEditorAutorun={() => dispatch(toggleEditorAutorun(workspaceLocation))}\n      isDebugging={props.isDebugging}\n      isEditorAutorun={props.isEditorAutorun}\n      isRunning={props.isRunning}\n      key=\"autorun\"\n    />\n  );\n\n  const chapterSelectHandler = ({ chapter }: { chapter: Chapter }, e: any) => {\n    props.handleChapterSelect(chapter);\n    if (props.recordingStatus !== RecordingStatus.recording) {\n      return;\n    }\n    props.handleRecordInput({\n      time: getTimerDuration(),\n      type: 'chapterSelect',\n      data: chapter\n    });\n  };\n\n  const chapterSelect = (\n    <ControlBarChapterSelect\n      handleChapterSelect={chapterSelectHandler}\n      sourceChapter={props.sourceChapter}\n      sourceVariant={props.sourceVariant}\n      key=\"chapter\"\n    />\n  );\n\n  const clearButton = (\n    <ControlBarClearButton\n      handleReplOutputClear={() => dispatch(clearReplOutput(workspaceLocation))}\n      key=\"clear_repl\"\n    />\n  );\n\n  const evalButton = (\n    <ControlBarEvalButton\n      handleReplEval={props.handleReplEval}\n      isRunning={props.isRunning}\n      key=\"eval_repl\"\n    />\n  );\n\n  const editorContainerProps: SourcecastEditorContainerProps = {\n    ..._.pick(\n      props,\n      'codeDeltasToApply',\n      'handleEditorEval',\n      'handleEditorValueChange',\n      'isEditorAutorun',\n      'inputToApply',\n      'handleRecordInput',\n      'isEditorReadonly'\n    ),\n    editorVariant: 'sourcecast',\n    editorTabs: props.editorTabs.map(convertEditorTabStateToProps),\n    handleDeclarationNavigate: cursorPosition =>\n      dispatch(navigateToDeclaration(workspaceLocation, cursorPosition)),\n    handleEditorUpdateBreakpoints: breakpoints =>\n      dispatch(setEditorBreakpoint(breakpoints, workspaceLocation)),\n    editorSessionId: '',\n    getTimerDuration: getTimerDuration,\n    isPlaying: props.playbackStatus === PlaybackStatus.playing,\n    isRecording: props.recordingStatus === RecordingStatus.recording\n  };\n\n  const activeTabChangeHandler = (activeTab: SideContentType) => {\n    setSelectedTab(activeTab);\n    if (props.recordingStatus !== RecordingStatus.recording) {\n      return;\n    }\n    props.handleRecordInput({\n      time: getTimerDuration(),\n      type: 'activeTabChange',\n      data: activeTab\n    });\n  };\n\n  const workspaceProps: WorkspaceProps = {\n    controlBarProps: {\n      editorButtons: [autorunButtons, chapterSelect]\n    },\n    editorContainerProps: editorContainerProps,\n    handleSideContentHeightChange: heightChange =>\n      dispatch(changeSideContentHeight(heightChange, workspaceLocation)),\n    replProps: {\n      output: props.output,\n      replValue: props.replValue,\n      handleBrowseHistoryDown: () => dispatch(browseReplHistoryDown(workspaceLocation)),\n      handleBrowseHistoryUp: () => dispatch(browseReplHistoryUp(workspaceLocation)),\n      handleReplEval: props.handleReplEval,\n      handleReplValueChange: newValue => dispatch(updateReplValue(newValue, workspaceLocation)),\n      sourceChapter: props.sourceChapter,\n      sourceVariant: props.sourceVariant,\n      externalLibrary: props.externalLibraryName,\n      replButtons: [evalButton, clearButton]\n    },\n    sideBarProps: {\n      tabs: []\n    },\n    sideContentHeight: props.sideContentHeight,\n    sideContentProps: {\n      onChange: activeTabChangeHandler,\n      selectedTabId: selectedTab,\n      /**\n       * NOTE: An ag-grid console warning is shown here on load as the 'Sourcecast Table' tab\n       * is not the default tab, and the ag-grid table inside it has not been rendered.\n       * This is a known issue with ag-grid, and is okay since only staff and admins have\n       * access to Sourcereel. For more info, see issue #1152 in frontend.\n       */\n      tabs: {\n        beforeDynamicTabs: [\n          {\n            label: 'Recording Panel',\n            iconName: IconNames.COMPASS,\n            body: (\n              <div>\n                <span className=\"Multi-line\">\n                  <Pre> {INTRODUCTION} </Pre>\n                </span>\n                <SourcereelControlbar\n                  currentPlayerTime={props.currentPlayerTime}\n                  // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n                  editorValue={props.editorTabs[0].value}\n                  getTimerDuration={getTimerDuration}\n                  playbackData={props.playbackData}\n                  handleRecordInit={handleRecordInit}\n                  handleRecordPause={handleRecordPause}\n                  handleResetInputs={(inputs: Input[]) =>\n                    dispatch(resetInputs(inputs, workspaceLocation))\n                  }\n                  handleSaveSourcecastData={(title, description, uid, audio, playbackData) =>\n                    dispatch(\n                      saveSourcecastData(title, description, uid, audio, playbackData, 'sourcecast')\n                    )\n                  }\n                  handleSetSourcecastData={(title, description, uid, audioUrl, playbackData) =>\n                    dispatch(\n                      setSourcecastData(\n                        title,\n                        description,\n                        uid,\n                        audioUrl,\n                        playbackData,\n                        'sourcecast'\n                      )\n                    )\n                  }\n                  handleSetIsEditorReadonly={props.handleSetIsEditorReadonly}\n                  handleTimerPause={() => dispatch(timerPause(workspaceLocation))}\n                  handleTimerReset={() => dispatch(timerReset(workspaceLocation))}\n                  handleTimerResume={timeBefore =>\n                    dispatch(timerResume(timeBefore, workspaceLocation))\n                  }\n                  handleTimerStart={() => dispatch(timerStart(workspaceLocation))}\n                  handleTimerStop={() => dispatch(timerStop(workspaceLocation))}\n                  recordingStatus={props.recordingStatus}\n                />\n              </div>\n            ),\n            id: SideContentType.sourcereel\n          },\n          {\n            label: 'Sourcecast Table',\n            iconName: IconNames.EDIT,\n            body: (\n              <div>\n                <SourcecastTable\n                  handleDeleteSourcecastEntry={id =>\n                    dispatch(deleteSourcecastEntry(id, 'sourcecast'))\n                  }\n                  sourcecastIndex={props.sourcecastIndex}\n                  courseId={props.courseId}\n                />\n              </div>\n            ),\n            id: SideContentType.introduction\n          },\n          dataVisualizerTab,\n          envVisualizerTab\n        ],\n        afterDynamicTabs: []\n      },\n      workspaceLocation: 'sourcereel'\n    }\n  };\n  const sourcecastControlbarProps: SourceRecorderControlBarProps = {\n    ..._.pick(\n      props,\n      'handleEditorValueChange',\n      'handleSetIsEditorReadonly',\n      'handleSetSourcecastStatus',\n      'audioUrl',\n      'currentPlayerTime',\n      'playbackData',\n      'playbackStatus',\n      'handleChapterSelect',\n      'handleExternalSelect'\n    ),\n    handleSetCurrentPlayerTime: playerTime =>\n      dispatch(setCurrentPlayerTime(playerTime, 'sourcecast')),\n    handleSetCodeDeltasToApply: (deltas: CodeDelta[]) =>\n      dispatch(setCodeDeltasToApply(deltas, 'sourcecast')),\n    handleSetInputToApply: (inputToApply: Input) =>\n      dispatch(setInputToApply(inputToApply, 'sourcecast')),\n    handleSetSourcecastDuration: duration =>\n      dispatch(setSourcecastDuration(duration, 'sourcecast')),\n    handlePromptAutocomplete: (row, col, callback) =>\n      dispatch(promptAutocomplete(workspaceLocation, row, col, callback)),\n    duration: props.playbackDuration\n  };\n  return (\n    <div className={classNames('Sourcereel', Classes.DARK)}>\n      {props.recordingStatus === RecordingStatus.paused ? (\n        <SourceRecorderControlBar {...sourcecastControlbarProps} />\n      ) : undefined}\n      <Workspace {...workspaceProps} />\n    </div>\n  );\n};\n\nconst INTRODUCTION = 'Welcome to Sourcereel!';\n\nconst dataVisualizerTab: SideContentTab = {\n  label: 'Data Visualizer',\n  iconName: IconNames.EYE_OPEN,\n  body: <SideContentDataVisualizer />,\n  id: SideContentType.dataVisualizer\n};\n\nconst envVisualizerTab: SideContentTab = {\n  label: 'Env Visualizer',\n  iconName: IconNames.GLOBE,\n  body: <SideContentEnvVisualizer />,\n  id: SideContentType.envVisualizer\n};\n\nexport default Sourcereel;\n","import { Chapter, Variant } from 'c-slang/dist/types';\nimport { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport { OverallState } from '../../../commons/application/ApplicationTypes';\nimport { ExternalLibraryName } from '../../../commons/application/types/ExternalTypes';\nimport {\n  chapterSelect,\n  evalEditor,\n  evalRepl,\n  externalLibrarySelect,\n  setIsEditorReadonly,\n  updateEditorValue\n} from '../../../commons/workspace/WorkspaceActions';\nimport { WorkspaceLocation } from '../../../commons/workspace/WorkspaceTypes';\nimport { setSourcecastStatus } from '../../../features/sourceRecorder/SourceRecorderActions';\nimport { Input, PlaybackStatus } from '../../../features/sourceRecorder/SourceRecorderTypes';\nimport { recordInput } from '../../../features/sourceRecorder/sourcereel/SourcereelActions';\nimport Sourcereel, { DispatchProps, StateProps } from './Sourcereel';\n\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => ({\n  audioUrl: state.workspaces.sourcecast.audioUrl,\n  currentPlayerTime: state.workspaces.sourcecast.currentPlayerTime,\n  codeDeltasToApply: state.workspaces.sourcecast.codeDeltasToApply,\n  activeEditorTabIndex: state.workspaces.sourcereel.activeEditorTabIndex,\n  editorTabs: state.workspaces.sourcereel.editorTabs,\n  enableDebugging: state.workspaces.sourcereel.enableDebugging,\n  externalLibraryName: state.workspaces.sourcereel.externalLibrary,\n  inputToApply: state.workspaces.sourcecast.inputToApply,\n  isDebugging: state.workspaces.sourcereel.isDebugging,\n  isEditorAutorun: state.workspaces.sourcereel.isEditorAutorun,\n  isEditorReadonly: state.workspaces.sourcereel.isEditorReadonly,\n  isRunning: state.workspaces.sourcereel.isRunning,\n  output: state.workspaces.sourcereel.output,\n  playbackData: state.workspaces.sourcereel.playbackData,\n  playbackDuration: state.workspaces.sourcecast.playbackDuration,\n  playbackStatus: state.workspaces.sourcecast.playbackStatus,\n  recordingStatus: state.workspaces.sourcereel.recordingStatus,\n  replValue: state.workspaces.sourcereel.replValue,\n  sideContentHeight: state.workspaces.sourcereel.sideContentHeight,\n  sourcecastIndex: state.workspaces.sourcecast.sourcecastIndex,\n  sourceChapter: Chapter.CALC,\n  sourceVariant: state.workspaces.sourcereel.context.variant,\n  timeElapsedBeforePause: state.workspaces.sourcereel.timeElapsedBeforePause,\n  timeResumed: state.workspaces.sourcereel.timeResumed,\n  courseId: state.session.courseId\n});\n\nconst location: WorkspaceLocation = 'sourcereel';\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleChapterSelect: (chapter: Chapter) => chapterSelect(chapter, Variant.DEFAULT, location),\n      handleEditorEval: () => evalEditor(location),\n      handleEditorValueChange: (val: string) => updateEditorValue(val, location),\n      handleExternalSelect: (externalLibraryName: ExternalLibraryName) =>\n        externalLibrarySelect(externalLibraryName, location),\n      handleRecordInput: (input: Input) => recordInput(input, location),\n      handleReplEval: () => evalRepl(location),\n      handleSetSourcecastStatus: (playbackStatus: PlaybackStatus) =>\n        setSourcecastStatus(playbackStatus, 'sourcecast'),\n      handleSetIsEditorReadonly: (readonly: boolean) => setIsEditorReadonly(location, readonly)\n    },\n    dispatch\n  );\n\nconst SourcereelContainer = connect(mapStateToProps, mapDispatchToProps)(Sourcereel);\n\nexport default SourcereelContainer;\n","export enum StorySimState {\n  Default = 'Default',\n  ObjectPlacement = 'ObjectPlacement',\n  AssetUploader = 'AssetUploader',\n  CheckpointSim = 'CheckpointSim',\n  ChapterSim = 'ChapterSim'\n}\n\nexport type ChapterDetail = {\n  id: string;\n  openAt: string;\n  closeAt: string;\n  title: string;\n  filenames: string[];\n  isPublished: boolean;\n  imageUrl: string;\n};\n","import Constants from '../../commons/utils/Constants';\nimport SourceAcademyGame from '../game/SourceAcademyGame';\nimport { courseId } from '../game/utils/GameUtils';\n\nconst sendRequest =\n  (route: string) =>\n  async (\n    requestPath: string,\n    method: string,\n    headerConfig: object = {},\n    requestDetails: object = {}\n  ) => {\n    try {\n      const accessToken = SourceAcademyGame.getInstance().getAccountInfo().accessToken || '';\n\n      const headers = createHeaders(accessToken);\n      Object.entries(headerConfig).forEach(([key, value]: string[]) => {\n        headers.append(key, value);\n      });\n\n      const config = {\n        method,\n        headers,\n        ...requestDetails\n      };\n\n      return fetch(\n        Constants.backendUrl + `/v2/courses/${courseId()}/${route}/` + requestPath,\n        config\n      );\n    } finally {\n    }\n  };\n\nexport const sendAssetRequest = sendRequest(`admin/assets`);\nexport const sendStoryRequest = sendRequest(`stories`);\nexport const sendAdminStoryRequest = sendRequest(`admin/stories`);\n\nexport function createHeaders(accessToken: string): Headers {\n  const headers = new Headers();\n  headers.append('Accept', 'application/json');\n  headers.append('Authorization', `Bearer ${accessToken}`);\n  return headers;\n}\n","import _ from 'lodash';\n\nimport { sendAdminStoryRequest, sendAssetRequest, sendStoryRequest } from './StorySimulatorRequest';\nimport { ChapterDetail } from './StorySimulatorTypes';\n\n/**\n * List of all folders to fetch S3 assets from\n */\nexport const s3AssetFolders = [\n  'locations',\n  'objects',\n  'images',\n  'avatars',\n  'ui',\n  'sfx',\n  'bgm',\n  'stories'\n];\n\nexport function obtainTextAssets(assetPaths: string[]) {\n  return assetPaths\n    .filter(assetPath => assetPath.startsWith('stories') && assetPath.endsWith('txt'))\n    .map(\n      assetPath => assetPath.slice(8) // remove /stories\n    );\n}\n\nexport const fetchTextAssets = async () => obtainTextAssets(await fetchFolder('stories'));\n\n/**\n * Request to fetches assets from all S3 folders\n *\n * @returns {Promise<string[]>} - full concatenated list of files in the given S3 folders\n */\nexport async function fetchAssetPaths(): Promise<string[]> {\n  const files = await Promise.all(\n    s3AssetFolders.map(async folderName => {\n      const files = await fetchFolder(folderName);\n      return files.length ? files : [`${folderName}`];\n    })\n  );\n  return files.reduce((combinedList, newList) => combinedList.concat(newList), []);\n}\n\n/**\n * Request to fetches assets from one S3 folders\n *\n * @param folderName - S3 folder to fetch from\n * @returns {Promise<string[]>} - list of files in S3 folder\n */\nasync function fetchFolder(folderName: string) {\n  const response = await sendAssetRequest(folderName, 'GET', {\n    'Content-Type': 'application/json'\n  });\n  return response.status === 200 ? response.json() : [];\n}\n\n/**\n * Request to delete an S3 file\n *\n * @param assetPath - file path to delete\n * @returns {Promise<string>} - request response\n */\nexport async function deleteS3File(assetPath: string) {\n  const response = await sendAssetRequest(assetPath, 'DELETE');\n  const message = await response.text();\n  return message || 'Successfully Deleted';\n}\n\n/**\n * Request to upload a group of files into a chosen S3 folder\n *\n * @param fileList - the files to upload\n * @param folderName - which folder to upload to\n * @returns {Promise<string>} - Request responses, concatentated together\n */\nexport async function uploadAssetsToS3(fileList: FileList, folderName: string) {\n  const responses = await Promise.all(\n    Array.from(fileList).map(async file => {\n      const response = await uploadAssetToS3(file, folderName);\n      return file.name + ' => ' + response;\n    })\n  );\n  return responses.join('\\n');\n}\n\n/**\n * Uploads just one file into S3 folder\n *\n * @param file - file to delete\n * @param folderName - file path to delete\n * @returns {Promise<string>} - Request response\n */\nexport async function uploadAssetToS3(file: File, folderName: string) {\n  const formData = new FormData();\n  formData.set('upload', file);\n\n  const response = await sendAssetRequest(\n    `${folderName}/${file.name}`,\n    'POST',\n    {},\n    { body: formData, mode: 'cors' }\n  );\n\n  return response ? response.text() : '';\n}\n\n/**\n * Fetches all chapters from the backend\n *\n * @param accessToken - staff access token\n * @returns {Promise<object[]>} - All the chapter objects in a list\n */\nexport async function fetchChapters(): Promise<ChapterDetail[]> {\n  const response = await sendStoryRequest('', 'GET');\n  const chapterDetails = response.status === 200 ? await response.json() : [];\n  return _.sortBy(chapterDetails, (chapterDetail: ChapterDetail) => new Date(chapterDetail.openAt));\n}\n\n/**\n * Creates or updates a chapter\n *\n * @returns {Promise<string>} - Response\n */\nexport async function updateChapterRequest(id: string, body: object) {\n  const response = await sendAdminStoryRequest(\n    id,\n    'POST',\n    {\n      'Content-Type': 'application/json'\n    },\n    {\n      body: JSON.stringify(body)\n    }\n  );\n  return response.status === 200 ? 'Chapter successfully created/updated' : response.text();\n}\n\n/**\n * Creates a chapter\n *\n * @returns {Promise<string>} - Response\n */\nexport async function deleteChapterRequest(id: string) {\n  const response = await sendAdminStoryRequest(id, 'DELETE');\n  return response.status === 204 ? 'Chapter successfully deleted' : response.text();\n}\n","import { Button, InputGroup, Menu, MenuItem, Position } from '@blueprintjs/core';\nimport { Popover2 } from '@blueprintjs/popover2';\nimport React from 'react';\nimport {\n  s3AssetFolders,\n  uploadAssetsToS3\n} from 'src/features/storySimulator/StorySimulatorService';\n\nconst specifyFolderText = 'Specify own folder...';\nconst folderOverwritePlaceholder = \"Or specify your own, e.g. 'locations/hallway'\";\n\n/**\n * This is component allows storywriters to upload any assets into to\n * specific folders into Story Sim's Asset Uploader\n */\nconst AssetFileUploader = () => {\n  const [fileList, setFileList] = React.useState<FileList>();\n  const [uploadFolder, setUploadFolder] = React.useState<string>(s3AssetFolders[0]);\n\n  const [folderOverwrite, setFolderOverwrite] = React.useState<string>();\n  const [showfolderOverwrite, setShowFolderOverwrite] = React.useState<boolean>(false);\n\n  function handleLoadFile(e: any) {\n    if (!e.target.files) return;\n    const loadedFiles = e.target.files;\n    setFileList(loadedFiles);\n  }\n\n  async function handleUploadButtonClick() {\n    const finalFolder = folderOverwrite || uploadFolder;\n    if (!fileList || !finalFolder) return;\n    const response = await uploadAssetsToS3(fileList, finalFolder);\n    alert(response);\n  }\n\n  function handleChangeUploadFolder(e: any) {\n    if (!e.target.innerText) return;\n    setUploadFolder(e.target.innerText);\n    setShowFolderOverwrite(false);\n  }\n\n  function handleChangeFolderOverwrite(e: any) {\n    setFolderOverwrite(e.target.value);\n  }\n\n  function showSpecifyFolder(e: any) {\n    if (!e.target.innerText) return;\n    setUploadFolder(e.target.innerText);\n    setShowFolderOverwrite(true);\n  }\n\n  const uploadButtonPopoverContent = (\n    <Menu>\n      {s3AssetFolders.map(folder => (\n        <MenuItem onClick={handleChangeUploadFolder} id={folder} key={folder} text={folder} />\n      ))}\n      <MenuItem\n        onClick={showSpecifyFolder}\n        id={specifyFolderText}\n        key={specifyFolderText}\n        text={specifyFolderText}\n      ></MenuItem>\n    </Menu>\n  );\n  return (\n    <div className=\"LeftAlign\">\n      <h4>Choose Folder</h4>\n      <Popover2 placement={Position.BOTTOM} content={uploadButtonPopoverContent}>\n        <Button text={uploadFolder} />\n      </Popover2>\n      {showfolderOverwrite && (\n        <InputGroup\n          placeholder={folderOverwritePlaceholder}\n          onChange={handleChangeFolderOverwrite}\n        />\n      )}\n      <br />\n      <h4>Choose File</h4>\n      <input type=\"file\" multiple onChange={handleLoadFile} />\n      <Button onClick={handleUploadButtonClick}>Upload</Button>\n    </div>\n  );\n};\n\nexport default AssetFileUploader;\n","import { ITreeNode } from '@blueprintjs/core';\nimport _ from 'lodash';\n\n/**\n * This function applies a function fn to every node in a blueprint core Tree\n *\n * @param nodes All parent nodes of the blueprint core tree\n * @param fn Function to apply to every element in the tree\n */\nexport function treeMap(nodes: ITreeNode[] | undefined, fn: (node: ITreeNode) => void) {\n  nodes &&\n    nodes.forEach(node => {\n      fn(node);\n      treeMap(node.childNodes, fn);\n    });\n}\n\n/**\n * This function takes a list of filepaths\n * (e.g. [\"locations/hallway/normal.png\", \"locations/hallway/emergency.png\"]) and returns\n * blueprint core tree nodes, where each node represents a folder/file.\n *\n * The child of each folder node are the files/folders inside it.\n *\n * @param assetPaths - a list of all filepaths\n * @param iconRenderer - Function that dictates what JSX Element/icon to render beside\n *                       all blueprint core nodes basded on the file path\n * @param rootFolders - a default list of parent folder names that you want to display regardless of\n *                      whether or not they have contents\n * @returns {ITreeNode[]} - a blueprint core tree parent nodes\n */\nexport function assetPathsToTree(\n  assetPaths: string[],\n  iconRenderer: (pathName: string) => JSX.Element,\n  rootFolders: string[] = []\n): ITreeNode[] {\n  const assetObj = {};\n  assetPaths.forEach(assetPath => _.set(assetObj, assetPath.split('/'), 'FILE'));\n  rootFolders.forEach(folder => {\n    if (!assetObj[folder] || assetObj[folder] === 'FILE') {\n      assetObj[folder] = [];\n    }\n  });\n\n  function helper(parentFolders: string[], assetObj: object | Array<string>): ITreeNode[] {\n    return Object.keys(assetObj).map(file => {\n      const shortPath = '/' + parentFolders.join('/') + '/' + file;\n      return {\n        id: shortPath,\n        label: file,\n        secondaryLabel: iconRenderer(shortPath),\n        childNodes:\n          assetObj[file] === 'FILE' ? undefined : helper([...parentFolders, file], assetObj[file])\n      };\n    });\n  }\n  return helper([], assetObj);\n}\n","import { memo } from 'react';\nimport { Constants } from 'src/features/game/commons/CommonConstants';\nimport { toS3Path } from 'src/features/game/utils/GameUtils';\n\ntype AssetProps = {\n  assetPath: string;\n};\n\n/**\n * This file renders one asset path so that story writers can preview\n * the asset\n *\n * @assetPath - the asset to render/preview\n */\nconst AssetViewer = memo(({ assetPath }: AssetProps) => {\n  const displayAssetPath = assetPath || Constants.defaultAssetPath;\n  return (\n    <>\n      <img\n        alt=\"asset\"\n        crossOrigin={'anonymous'}\n        src={toS3Path(displayAssetPath, !!assetPath)}\n        width=\"150px\"\n        onError={e => {\n          (e.target as any).onerror = null;\n          (e.target as any).src = toS3Path(Constants.defaultAssetPath, false);\n        }}\n      ></img>\n    </>\n  );\n});\n\nexport default AssetViewer;\n","import { Icon, ITreeNode, Tree } from '@blueprintjs/core';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport React from 'react';\nimport { useRequest } from 'src/commons/utils/Hooks';\nimport {\n  deleteS3File,\n  fetchAssetPaths,\n  s3AssetFolders\n} from 'src/features/storySimulator/StorySimulatorService';\n\nimport { assetPathsToTree, treeMap } from './StorySimulatorAssetSelectionHelper';\nimport StorySimulatorAssetViewer from './StorySimulatorAssetViewer';\n\ntype TreeState = {\n  nodes: ITreeNode[];\n};\n\n/**\n * This component provides a preview of all the S3 asset files.\n *\n * When a image is selected, the filename of the image is stored in session storage,\n * so Story Simulator's Object Placement can read the filename and load the image.\n */\nconst StorySimulatorAssetSelection = () => {\n  const { value: assetPaths } = useRequest<string[]>(fetchAssetPaths, []);\n\n  const [currentAsset, setCurrentAsset] = React.useState('');\n  const [assetTree, setAssetTree] = React.useState<TreeState>({ nodes: [] });\n\n  React.useEffect(() => {\n    setAssetTree({ nodes: assetPathsToTree(assetPaths, toolIcons, s3AssetFolders) });\n  }, [assetPaths]);\n\n  const handleNodeClick = (nodeData: ITreeNode) => {\n    treeMap(assetTree.nodes, (node: ITreeNode) => (node.isSelected = false));\n    nodeData.isSelected = !nodeData.isSelected;\n    nodeData.isExpanded = !nodeData.isExpanded;\n    const selectedPath = nodeData.id.toString();\n    if (!nodeData.childNodes) {\n      setCurrentAsset(selectedPath);\n      sessionStorage.setItem('selectedAsset', selectedPath);\n    }\n    setAssetTree({ ...assetTree });\n  };\n\n  return (\n    <>\n      <StorySimulatorAssetViewer assetPath={currentAsset} />\n      <Tree contents={assetTree.nodes} onNodeClick={handleNodeClick} />\n    </>\n  );\n};\n\n/**\n * Tools that are added to asset selection, includes: trash-can delete tool\n *\n * @param filePath the path to asset you want to supply tools for\n * @returns {JSX.Element} A trash can that deletes the file given the asset path\n */\nconst toolIcons = (filePath: string) => (\n  <Tooltip2 content=\"Delete\">\n    <Icon icon=\"trash\" onClick={deleteFile(filePath)} />\n  </Tooltip2>\n);\n\n/**\n * This function deletes an S3 file given the short filepath\n *\n * @param filePath - the file path e.g. \"stories/chapter0.txt\"\n */\nconst deleteFile = (filePath: string) => async () => {\n  const confirm = window.confirm(\n    `Are you sure you want to delete ${filePath}?\\nThere is no undoing this action!`\n  );\n  alert(confirm ? await deleteS3File(filePath) : 'Whew');\n};\n\nexport default StorySimulatorAssetSelection;\n","import { Button } from '@blueprintjs/core';\nimport { arrayMoveImmutable } from 'array-move';\nimport React from 'react';\nimport { SortableContainer, SortableElement } from 'react-sortable-hoc';\n\nconst SortableItem = React.memo(\n  SortableElement(({ value }: any) => (\n    <div>\n      <Button>{value}</Button>\n    </div>\n  ))\n);\n\nexport const SortableList = React.memo(\n  SortableContainer(({ items }: any) => {\n    return (\n      <div>\n        {items &&\n          items.map((value: any, index: number) => (\n            <SortableItem key={`item-${value}`} index={index} value={value} />\n          ))}\n      </div>\n    );\n  })\n);\n\nexport const useSortableList = () => {\n  const [items, setItems] = React.useState<string[]>([]);\n\n  const onSortEnd = React.useCallback(({ oldIndex, newIndex }: any) => {\n    setItems(prevState => arrayMoveImmutable(prevState, oldIndex, newIndex));\n  }, []);\n\n  return {\n    items,\n    setItems,\n    onSortEnd\n  };\n};\n","import { Button, Intent, Switch } from '@blueprintjs/core';\nimport { DatePicker } from '@blueprintjs/datetime';\nimport React from 'react';\nimport { getStandardDateTime } from 'src/commons/utils/DateHelper';\nimport { useInput } from 'src/commons/utils/Hooks';\nimport { SortableList, useSortableList } from 'src/commons/utils/SortableList';\nimport SourceAcademyGame from 'src/features/game/SourceAcademyGame';\nimport { toS3Path } from 'src/features/game/utils/GameUtils';\nimport { callGameManagerForSim } from 'src/features/game/utils/TxtLoaderUtils';\nimport {\n  deleteChapterRequest,\n  updateChapterRequest\n} from 'src/features/storySimulator/StorySimulatorService';\nimport { ChapterDetail } from 'src/features/storySimulator/StorySimulatorTypes';\n\nimport { createChapterIndex, inAYear } from './StorySimulatorChapterSim';\n\ntype ChapterSimProps = {\n  chapterDetail: ChapterDetail;\n  checkpointFilenames?: string[];\n};\n\n/**\n * This is the Chapter Editor Form that\n * storywriters use to either create\n * or udpate chapters for the game.\n *\n * @param chapterDetail the starting state of the form,\n *                      either loaded from defaultChapter if user wants to create a new chapter\n *                      or loaded from the existing chapter if user wants to edit the chapter\n * @param checkpointFilenames the list of all checkpoint text files to choose from\n */\nconst ChapterEditor = React.memo(({ chapterDetail, checkpointFilenames }: ChapterSimProps) => {\n  const { id } = chapterDetail;\n  const { value: title, setValue: setTitle, inputProps: titleProps } = useInput('');\n  const { value: imageUrl, setValue: setImageUrl, inputProps: imageUrlProps } = useInput('');\n  const { items: chosenFiles, setItems: setChosenFiles, onSortEnd } = useSortableList();\n\n  const [isPublished, setIsPublished] = React.useState(false);\n  const [openDate, setOpenDate] = React.useState<Date>(new Date());\n  const [txtsNotChosen, setTxtsNotChosen] = React.useState<string[]>([]);\n  const [rerender, setRender] = React.useState(false);\n\n  React.useEffect(() => {\n    setTitle(chapterDetail.title);\n    setImageUrl(chapterDetail.imageUrl);\n    setOpenDate(new Date(chapterDetail.openAt));\n    setChosenFiles(chapterDetail.filenames);\n    setIsPublished(chapterDetail.isPublished);\n    setTxtsNotChosen(\n      (checkpointFilenames || []).filter(textAsset => !chapterDetail.filenames.includes(textAsset))\n    );\n  }, [\n    chapterDetail,\n    setChosenFiles,\n    setImageUrl,\n    setOpenDate,\n    setTitle,\n    checkpointFilenames,\n    rerender\n  ]);\n\n  const deleteAllFromChosen = () => chosenFiles.map(deleteFileFromChosen);\n\n  const deleteFileFromChosen = React.useCallback(\n    (txtFile: string) => {\n      setChosenFiles(prevItemList => prevItemList.filter(item => item !== txtFile));\n      setTxtsNotChosen(prevItemList => [...prevItemList, txtFile]);\n    },\n    [setChosenFiles]\n  );\n\n  const addFileToChosen = React.useCallback(\n    (txtFile: string) => {\n      setChosenFiles(prevItemList => [...prevItemList, txtFile]);\n      setTxtsNotChosen(prevItemList => prevItemList.filter(item => item !== txtFile));\n    },\n    [setChosenFiles]\n  );\n\n  const saveChapter = async () => {\n    const updatedChapter = {\n      openAt: openDate.toISOString(),\n      closeAt: inAYear(openDate).toISOString(),\n      title,\n      filenames: chosenFiles,\n      imageUrl,\n      isPublished\n    };\n\n    const confirm = window.confirm(\n      `Are you sure you want to save changes to ${JSON.stringify(updatedChapter)}`\n    );\n    if (!confirm) {\n      return;\n    }\n    const response =\n      parseInt(id) === createChapterIndex\n        ? await updateChapterRequest('', { story: updatedChapter })\n        : await updateChapterRequest(id, { story: updatedChapter });\n\n    alert(response);\n  };\n\n  const deleteChapter = async () => {\n    const confirm = window.confirm('Are you sure you want to delete this chapter?');\n    if (confirm) {\n      const response = await deleteChapterRequest(id);\n      alert(response);\n    }\n  };\n\n  const clearChanges = () => {\n    const confirm = window.confirm('Are you you want to clear changes for this chapter?');\n    if (confirm) {\n      setRender(!rerender);\n      alert('Cleared changes');\n    }\n  };\n\n  const simulateChapter = async () => {\n    SourceAcademyGame.getInstance().setChapterSimStack(chosenFiles);\n    await callGameManagerForSim();\n  };\n\n  return (\n    <>\n      <h4>\n        Title: <input className=\"bp4-input\" type=\"text\" {...titleProps} />\n      </h4>\n      <b>Open date: </b>\n      {openDate && getStandardDateTime(openDate.toISOString())}\n      <DatePicker\n        onChange={(date: Date) => {\n          date && setOpenDate(date);\n        }}\n      />\n      <h4>\n        Image url: <input className=\"bp4-input\" type=\"text\" {...imageUrlProps} />\n        <Button onClick={(_: any) => window.open(toS3Path(imageUrl, true))}>View</Button>\n      </h4>\n      <b>Checkpoint Txt Files</b>\n      <SortableList items={chosenFiles} onSortEnd={onSortEnd} />\n      <br />\n      {chosenFiles.length > 0 && (\n        <Button icon={'delete'} onClick={deleteAllFromChosen}>\n          Clear checkpoint files\n        </Button>\n      )}\n      <br />\n      <b>All Txt Files</b>\n      {txtsNotChosen &&\n        txtsNotChosen.map(textFile => {\n          return (\n            <div key={`choice-${textFile}`}>\n              <Button onClick={() => addFileToChosen(textFile)} icon={'add'}>\n                {textFile}\n              </Button>\n            </div>\n          );\n        })}\n      <br />\n      <Button icon=\"play\" onClick={simulateChapter}>\n        Simulate Chapter\n      </Button>\n      <br />\n      <br />\n      <Switch\n        checked={isPublished}\n        labelElement={'Published'}\n        onChange={() => setIsPublished(!isPublished)}\n      />\n      <Button onClick={saveChapter}>Save Changes</Button>\n      <Button intent={Intent.WARNING} onClick={clearChanges}>\n        Clear Changes\n      </Button>\n      <br />\n      <br />\n      <Button icon=\"trash\" intent={Intent.DANGER} onClick={deleteChapter}>\n        Delete Chapter\n      </Button>\n    </>\n  );\n});\n\nexport default ChapterEditor;\n","import React from 'react';\nimport { useRequest } from 'src/commons/utils/Hooks';\nimport { fetchChapters, fetchTextAssets } from 'src/features/storySimulator/StorySimulatorService';\nimport { ChapterDetail } from 'src/features/storySimulator/StorySimulatorTypes';\n\nimport StorySimulatorChapterEditor from './StorySimulatorChapterEditor';\n\nexport const inAYear = (date: Date) => {\n  date.setFullYear(date.getFullYear() + 1);\n  return date;\n};\n\nexport const createChapterIndex = -1;\nconst defaultChapter = {\n  id: createChapterIndex,\n  title: 'title goes here',\n  imageUrl: '/locations/telebay/emergency.png',\n  openAt: new Date().toISOString(),\n  closeAt: inAYear(new Date()).toISOString(),\n  isPublished: false,\n  filenames: []\n};\n\n/**\n * This components renders the chapter editor/chapter creator component\n * based on the chapter chosen in the dropdown.\n *\n * @param textAssets - the list of all text assets on S3 to choose from\n */\nconst ChapterSim = React.memo(() => {\n  const { value: textAssets } = useRequest<string[]>(fetchTextAssets, []);\n  const { value: chapters } = useRequest<ChapterDetail[]>(fetchChapters, []);\n\n  const [chosenIndex, setChosenIndex] = React.useState(createChapterIndex);\n\n  return (\n    <>\n      <h3>Chapter Simulator</h3>\n      <select className=\"bp4-menu\" onChange={(e: any) => setChosenIndex(e.target.value)}>\n        {chapters.map((chapter, chapterIndex) => (\n          <option value={chapterIndex} key={chapterIndex}>\n            {`Chapter ${chapterIndex}: ${chapter.title}`}\n          </option>\n        ))}\n        <option value={createChapterIndex} key={createChapterIndex}>\n          {`Create new chapter`}\n        </option>\n      </select>\n      <hr />\n      <StorySimulatorChapterEditor\n        chapterDetail={chapters[chosenIndex] || defaultChapter}\n        checkpointFilenames={textAssets}\n      />\n    </>\n  );\n});\nexport default ChapterSim;\n","import FontAssets from 'src/features/game/assets/FontAssets';\nimport { screenSize } from 'src/features/game/commons/CommonConstants';\nimport { BitmapFontStyle } from 'src/features/game/commons/CommonTypes';\n\nexport const mainMenuOptStyle: BitmapFontStyle = {\n  key: FontAssets.zektonDarkFont.key,\n  size: 35,\n  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER\n};\n\nconst SSMainMenuConstants = {\n  maxOptButtonsRow: 2,\n  optButton: { xSpace: screenSize.x * 0.9, ySpace: screenSize.y * 0.5 },\n  gameTxtStorageName: {\n    defaultChapter: 'defaultChapter',\n    checkpointTxt: 'checkpointTxt'\n  }\n};\n\nexport default SSMainMenuConstants;\n","import 'ace-builds/webpack-resolver';\n\nimport { Button, Tab, Tabs } from '@blueprintjs/core';\nimport React from 'react';\nimport { toTxtPath } from 'src/features/game/assets/TextAssets';\nimport { toS3Path } from 'src/features/game/utils/GameUtils';\n\ntype Props = {\n  storageName: string;\n  s3TxtFiles: string[];\n};\n\n/**\n * This component enables story writers to upload their txt file contents\n * to the browser, or load a file from S3 and store the txt contents\n * in the browser. So that GameManager can read from these txt files\n *\n * @param storageName the field in browser storage where the loaded/fetched txt files get stored temporarily\n * @param s3TxtFiles the list of S3 txt files to choose from\n */\nfunction CheckpointTxtLoader({ storageName, s3TxtFiles }: Props) {\n  const [chosenFilename, setChosenFilename] = React.useState(s3TxtFiles[0]);\n\n  function onLoadTxt(e: any) {\n    if (!e.target.files) return;\n    const [file] = e.target.files;\n    loadFileLocally(storageName, file);\n  }\n\n  async function changeChosenFilename(e: any) {\n    const filename = e.target.value;\n    setChosenFilename(filename);\n    const response = await fetch(toS3Path(`/stories/${filename}`, true), {\n      headers: createHeadersWithCors()\n    });\n    const txt = await response.text();\n    sessionStorage.setItem(storageName, txt);\n  }\n\n  const uploadButton = <input type=\"file\" onChange={onLoadTxt} style={{ width: '250px' }} />;\n\n  const chooseS3Txt = (\n    <>\n      <select className=\"bp4-menu\" onChange={changeChosenFilename}>\n        {s3TxtFiles.map(file => (\n          <option value={file} key={file}>\n            {file}\n          </option>\n        ))}\n      </select>\n      <Button icon={'download'} onClick={() => window.open(toTxtPath(chosenFilename))} />\n    </>\n  );\n\n  return (\n    <div className=\"LeftAlign\">\n      <hr />\n      <Tabs id=\"Tabs\" key=\"vertical\" renderActiveTabPanelOnly={true}>\n        <Tab id=\"own\" title=\"Local\" panel={uploadButton} />\n        <Tab id=\"s3\" title=\"S3\" panel={chooseS3Txt} />\n      </Tabs>\n      <hr />\n    </div>\n  );\n}\n\nconst loadFileLocally = (storageName: string, txtFile: File) => {\n  const reader = new FileReader();\n  reader.readAsText(txtFile);\n  reader.onloadend = _ => {\n    if (!reader.result) {\n      return;\n    }\n    sessionStorage.setItem(storageName, reader.result.toString());\n  };\n};\n\nexport default CheckpointTxtLoader;\n\nfunction createHeadersWithCors(): Headers {\n  const headers = new Headers();\n  headers.append('Access-Control-Allow-Origin', '*');\n  return headers;\n}\n","import { Button } from '@blueprintjs/core';\nimport { useRequest } from 'src/commons/utils/Hooks';\nimport SourceAcademyGame from 'src/features/game/SourceAcademyGame';\nimport MainMenu from 'src/features/storySimulator/scenes/mainMenu/MainMenu';\nimport mainMenuConstants from 'src/features/storySimulator/scenes/mainMenu/MainMenuConstants';\nimport { fetchTextAssets } from 'src/features/storySimulator/StorySimulatorService';\n\nimport CheckpointTxtLoader from './StorySimulatorCheckpointTxtLoader';\n\n/**\n * This component helps one simulate a checkpoint by\n * supplying two txt files - the default txt file\n * and the checkpoint txt file\n *\n * @param textAssets these are the list of text files on S3, if storywriter's simulation\n *                   involves S3 text files.\n */\nexport default function CheckpointSim() {\n  const { value: textAssets } = useRequest<string[]>(fetchTextAssets, []);\n\n  function simulateCheckpoint() {\n    (SourceAcademyGame.getInstance().getCurrentSceneRef() as MainMenu).simulateCheckpoint();\n  }\n\n  return (\n    <>\n      <h3>Checkpoint Text Loader</h3>\n      <b>Step 1: Choose default checkpoint</b>\n      <CheckpointTxtLoader\n        s3TxtFiles={textAssets}\n        storageName={mainMenuConstants.gameTxtStorageName.defaultChapter}\n      />\n      <b>Step 2: Choose checkpoint text</b>\n      <CheckpointTxtLoader\n        s3TxtFiles={textAssets}\n        storageName={mainMenuConstants.gameTxtStorageName.checkpointTxt}\n      />\n      <br />\n      <Button onClick={simulateCheckpoint} icon=\"play\">\n        Simulate Checkpoint\n      </Button>\n      <br />\n      <br />\n      <Button onClick={clearSessionStorage}>Reset All Files</Button>\n      <br />\n    </>\n  );\n}\n\nfunction clearSessionStorage(e: any) {\n  sessionStorage.setItem(mainMenuConstants.gameTxtStorageName.checkpointTxt, '');\n  sessionStorage.setItem(mainMenuConstants.gameTxtStorageName.defaultChapter, '');\n}\n","import { AssetMap, AssetType, ImageAsset } from 'src/features/game/assets/AssetsTypes';\n\nconst SSImageAssets: AssetMap<ImageAsset> = {\n  storySimBg: {\n    type: AssetType.Image,\n    key: 'student-room',\n    path: '/locations/deathCube_ext/shields-down.png'\n  },\n  shortButton: { type: AssetType.Image, key: 'short-button', path: '/ui/shortButton.png' },\n  invertedButton: {\n    type: AssetType.Image,\n    key: 'inverted-button',\n    path: '/ui/invertedColorButton.png'\n  },\n  blueUnderlay: { type: AssetType.Image, key: 'blue-underlay', path: '/ui/blueUnderlay.png' },\n  topButton: { type: AssetType.Image, key: 'top-button', path: '/ui/topButton.png' },\n  colorIcon: { type: AssetType.Image, key: 'color-icon', path: '/ui/colorIcon.png' },\n  imageIcon: { type: AssetType.Image, key: 'image-icon', path: '/ui/imageIcon.png' },\n  bboxIcon: { type: AssetType.Image, key: 'bbox-icon', path: '/ui/bboxIcon.png' },\n  handIcon: { type: AssetType.Image, key: 'hand-icon', path: '/ui/handIcon.png' },\n  listIcon: { type: AssetType.Image, key: 'list-icon', path: '/ui/listIcon.png' },\n  eraseIcon: { type: AssetType.Image, key: 'erase-icon', path: '/ui/eraserIcon.png' },\n  iconBg: { type: AssetType.Image, key: 'icon-bg', path: '/ui/modeIconBg.png' }\n};\n\nexport default SSImageAssets;\n","import FontAssets from 'src/features/game/assets/FontAssets';\nimport ImageAssets from 'src/features/game/assets/ImageAssets';\nimport SoundAssets from 'src/features/game/assets/SoundAssets';\nimport { screenCenter, screenSize } from 'src/features/game/commons/CommonConstants';\nimport { addLoadingScreen } from 'src/features/game/effects/LoadingScreen';\nimport GameLayerManager from 'src/features/game/layer/GameLayerManager';\nimport { Layer } from 'src/features/game/layer/GameLayerTypes';\nimport Parser from 'src/features/game/parser/Parser';\nimport SourceAcademyGame from 'src/features/game/SourceAcademyGame';\nimport { createButton } from 'src/features/game/utils/ButtonUtils';\nimport { mandatory, toS3Path } from 'src/features/game/utils/GameUtils';\nimport { calcTableFormatPos } from 'src/features/game/utils/StyleUtils';\n\nimport SSImageAssets from '../../assets/ImageAssets';\nimport { StorySimState } from '../../StorySimulatorTypes';\nimport mainMenuConstants, { mainMenuOptStyle } from './MainMenuConstants';\n\n/**\n * Entry point for story simulator.\n *\n * User can access different story simulator\n * functionalities from here.\n */\nclass MainMenu extends Phaser.Scene {\n  private layerManager?: GameLayerManager;\n\n  constructor() {\n    super('StorySimulatorMenu');\n  }\n\n  public preload() {\n    SourceAcademyGame.getInstance().setCurrentSceneRef(this);\n    this.layerManager = new GameLayerManager(this);\n\n    addLoadingScreen(this);\n    Object.values(ImageAssets).forEach(asset =>\n      this.load.image(asset.key, toS3Path(asset.path, false))\n    );\n    Object.values(SSImageAssets).forEach(asset =>\n      this.load.image(asset.key, toS3Path(asset.path, false))\n    );\n    Object.values(FontAssets).forEach(asset =>\n      this.load.bitmapFont(asset.key, asset.pngPath, asset.fntPath)\n    );\n    SourceAcademyGame.getInstance().getSoundManager().loadSoundAssetMap(SoundAssets);\n  }\n\n  public async create() {\n    if (SourceAcademyGame.getInstance().getAccountInfo().role === 'student') {\n      console.log('Students cannot use story sim');\n      return;\n    }\n    this.renderBackground();\n    this.renderOptionButtons();\n  }\n\n  private renderOptionButtons() {\n    const optionsContainer = new Phaser.GameObjects.Container(this, 0, 0);\n    const buttons = this.getOptionButtons();\n\n    const buttonPositions = calcTableFormatPos({\n      numOfItems: buttons.length,\n      maxXSpace: mainMenuConstants.optButton.xSpace,\n      maxYSpace: mainMenuConstants.optButton.ySpace,\n      numItemLimit: mainMenuConstants.maxOptButtonsRow,\n      redistributeLast: true\n    });\n\n    optionsContainer.add(\n      buttons.map((button, index) =>\n        this.createOptButton(\n          button.text,\n          buttonPositions[index][0],\n          buttonPositions[index][1],\n          button.callback\n        )\n      )\n    );\n    this.getLayerManager().addToLayer(Layer.UI, optionsContainer);\n  }\n\n  private getOptionButtons() {\n    return [\n      {\n        text: 'Object Placement',\n        callback: () => {\n          SourceAcademyGame.getInstance().setStorySimState(StorySimState.ObjectPlacement);\n          this.getLayerManager().clearAllLayers();\n          this.scene.start('ObjectPlacement');\n        }\n      },\n      {\n        text: 'Checkpoint Simulator',\n        callback: () => {\n          SourceAcademyGame.getInstance().setStorySimState(StorySimState.CheckpointSim);\n        }\n      },\n      {\n        text: 'Asset Uploader',\n        callback: () => {\n          SourceAcademyGame.getInstance().setStorySimState(StorySimState.AssetUploader);\n        }\n      },\n      {\n        text: 'Chapter Simulator',\n        callback: () => {\n          SourceAcademyGame.getInstance().setStorySimState(StorySimState.ChapterSim);\n        }\n      }\n    ];\n  }\n\n  private createOptButton(text: string, xPos: number, yPos: number, callback: any) {\n    return createButton(this, {\n      assetKey: SSImageAssets.invertedButton.key,\n      message: text,\n      textConfig: { x: 0, y: 0, oriX: 0.5, oriY: 0.5 },\n      bitMapTextStyle: mainMenuOptStyle,\n      onUp: callback\n    }).setPosition(xPos, yPos);\n  }\n\n  public simulateCheckpoint() {\n    const defaultChapterText =\n      sessionStorage.getItem(mainMenuConstants.gameTxtStorageName.defaultChapter) || '';\n    const checkpointTxt =\n      sessionStorage.getItem(mainMenuConstants.gameTxtStorageName.checkpointTxt) || '';\n    if (defaultChapterText === '' && checkpointTxt === '') {\n      return;\n    }\n\n    this.getLayerManager().clearAllLayers();\n\n    Parser.parse(defaultChapterText);\n    if (checkpointTxt) {\n      Parser.parse(checkpointTxt, true);\n    }\n    const gameCheckpoint = Parser.checkpoint;\n\n    this.scene.start('GameManager', {\n      gameCheckpoint,\n      chapterNum: -1,\n      checkpointNum: -1\n    });\n  }\n\n  private renderBackground() {\n    const backgroundImg = new Phaser.GameObjects.Image(\n      this,\n      screenCenter.x,\n      screenCenter.y,\n      SSImageAssets.storySimBg.key\n    );\n    backgroundImg.setDisplaySize(screenSize.x, screenSize.y);\n    const backgroundUnderlay = new Phaser.GameObjects.Image(\n      this,\n      screenCenter.x,\n      screenCenter.y,\n      SSImageAssets.blueUnderlay.key\n    ).setAlpha(0.5);\n    this.getLayerManager().addToLayer(Layer.Background, backgroundImg);\n    this.getLayerManager().addToLayer(Layer.Background, backgroundUnderlay);\n  }\n  public getLayerManager = () => mandatory(this.layerManager);\n}\n\nexport default MainMenu;\n","import { screenCenter } from 'src/features/game/commons/CommonConstants';\nimport { AssetKey } from 'src/features/game/commons/CommonTypes';\nimport { Layer } from 'src/features/game/layer/GameLayerTypes';\nimport { mandatory, toS3Path } from 'src/features/game/utils/GameUtils';\n\nimport { loadImage } from '../../game/utils/LoaderUtils';\nimport ObjectPlacement from '../scenes/ObjectPlacement/ObjectPlacement';\n\n/**\n * This manager manages the background for Story Simulator's Object Placement scene\n * It handles (1) storing of information on the chosen background (2) Rendering background\n */\nexport default class SSBackgroundManager {\n  private backgroundAssetPath: string | undefined;\n  private objectPlacement: ObjectPlacement | undefined;\n  public x: number;\n  public y: number;\n\n  public constructor() {\n    this.x = screenCenter.x;\n    this.y = screenCenter.y;\n  }\n\n  public initialise(objectPlacement: ObjectPlacement) {\n    this.objectPlacement = objectPlacement;\n  }\n\n  /**\n   * Loads the background if the chosen file comes from the\n   * locations folder\n   *\n   * And records the short path of the background image\n   */\n  public async loadBackground() {\n    const shortPath = sessionStorage.getItem('selectedAsset');\n    if (!shortPath || !shortPath.startsWith('/locations/')) {\n      return;\n    }\n    this.backgroundAssetPath = shortPath;\n\n    const backgroundAssetKey = `!${shortPath}`;\n    this.getObjectPlacement().addAsset(backgroundAssetKey, shortPath);\n\n    const assetKeyOnLoad = await loadImage(\n      this.getObjectPlacement(),\n      backgroundAssetKey,\n      toS3Path(shortPath, true)\n    );\n    this.renderBackground(assetKeyOnLoad);\n  }\n\n  private renderBackground(backgroundAssetKey: AssetKey) {\n    if (backgroundAssetKey[0] !== '!') {\n      return;\n    }\n\n    this.getObjectPlacement().getLayerManager().clearLayerContents(Layer.Background);\n    const backgroundSprite = new Phaser.GameObjects.Image(\n      this.getObjectPlacement(),\n      screenCenter.x,\n      screenCenter.y,\n      backgroundAssetKey\n    ).setInteractive();\n    this.getObjectPlacement().getLayerManager().addToLayer(Layer.Background, backgroundSprite);\n  }\n\n  private getObjectPlacement = () => mandatory(this.objectPlacement);\n\n  public getBackgroundAssetPath() {\n    return this.backgroundAssetPath;\n  }\n\n  public screenLog() {\n    return this.backgroundAssetPath + '\\n';\n  }\n}\n","export enum CursorMode {\n  DrawBBox,\n  DragResizeObj\n}\n","import { ItemId } from 'src/features/game/commons/CommonTypes';\nimport { Layer } from 'src/features/game/layer/GameLayerTypes';\nimport { mandatory } from 'src/features/game/utils/GameUtils';\nimport { resize } from 'src/features/game/utils/SpriteUtils';\nimport StringUtils from 'src/features/game/utils/StringUtils';\nimport { HexColor } from 'src/features/game/utils/StyleUtils';\n\nimport { CursorMode } from '../cursorMode/SSCursorModeTypes';\nimport { ICheckpointLoggable } from '../logger/SSLogManagerTypes';\nimport ObjectPlacement from '../scenes/ObjectPlacement/ObjectPlacement';\nimport { SSBBoxDetail } from './SSBBoxManagerTypes';\n\n/**\n * This manager manages the bounding boxes for Story Simulator's Object Placement scene\n *\n * It handles:\n * (1) Storing of information on bounding boxes\n * (2) Creation of bboxes using mouse drag\n * (3) Rendering of bboxes as translucent white boxes\n */\nexport default class SSBBoxManager implements ICheckpointLoggable {\n  public checkpointTitle = 'boundingBoxes';\n\n  private objectPlacement: ObjectPlacement | undefined;\n  private bboxBeingDrawn: Phaser.GameObjects.Rectangle | undefined;\n  private startingCoordinates: number[] | undefined;\n  private bboxDetailMap: Map<ItemId, SSBBoxDetail>;\n\n  constructor() {\n    this.bboxDetailMap = new Map<ItemId, SSBBoxDetail>();\n  }\n\n  public initialise(objectPlacement: ObjectPlacement) {\n    this.objectPlacement = objectPlacement;\n    this.addBBoxListeners(objectPlacement);\n  }\n\n  /**\n   * Adds pointer up and down listener on the object placement scene\n   * in order to draw bboxes when the mode is bbox draw-mode\n   *\n   * Pointer down causes bbox to be drawn\n   * Pointer up stops a bbox from being drawn\n   *\n   * @param objectPlacement the object placement scene\n   */\n  private addBBoxListeners(objectPlacement: ObjectPlacement) {\n    this.getObjectPlacement()\n      .getInputManager()\n      .registerEventListener('pointerdown', () => {\n        if (this.getObjectPlacement().isCursorMode(CursorMode.DrawBBox)) {\n          this.bboxBeingDrawn = this.createNewBBox();\n        }\n      });\n\n    this.getObjectPlacement()\n      .getInputManager()\n      .registerEventListener('pointerup', () => {\n        if (this.getObjectPlacement().isCursorMode(CursorMode.DrawBBox) && this.bboxBeingDrawn) {\n          if (this.bboxBeingDrawn.displayWidth <= 2 || this.bboxBeingDrawn.displayHeight <= 2) {\n            this.bboxBeingDrawn.destroy();\n            return;\n          }\n          this.bboxBeingDrawn.x += this.bboxBeingDrawn.displayWidth / 2;\n          this.bboxBeingDrawn.y += this.bboxBeingDrawn.displayHeight / 2;\n          this.bboxBeingDrawn.setOrigin(0.5);\n          this.registerBBox(this.bboxBeingDrawn);\n\n          objectPlacement.input.setDraggable(this.bboxBeingDrawn);\n          this.getObjectPlacement().setActiveSelection(this.bboxBeingDrawn);\n\n          this.startingCoordinates = undefined;\n          this.bboxBeingDrawn = undefined;\n        }\n      });\n  }\n\n  /**\n   * Draws a new bbox whose center is the center\n   * created by the dragged bbox\n   */\n  private createNewBBox() {\n    const [x, y] = this.getObjectPlacement().getCoordinates();\n    const bboxBeingDrawn = new Phaser.GameObjects.Rectangle(\n      this.getObjectPlacement(),\n      x,\n      y,\n      1,\n      1,\n      HexColor.white\n    )\n      .setOrigin(0)\n      .setAlpha(0.1)\n      .setInteractive()\n      .setDataEnabled();\n\n    this.startingCoordinates = [x, y];\n    this.getObjectPlacement().getLayerManager().addToLayer(Layer.BBox, bboxBeingDrawn);\n    return bboxBeingDrawn;\n  }\n\n  /**\n   * Memorises the dimensions and coordinates of the drawn\n   * bbox and stores this information\n   */\n  private registerBBox(bboxSprite: Phaser.GameObjects.Rectangle) {\n    const itemId = 'bbox' + this.getObjectPlacement().generateItemIdNumber();\n\n    const objectDetail: SSBBoxDetail = {\n      id: itemId,\n      x: bboxSprite.x,\n      y: bboxSprite.y,\n      width: bboxSprite.displayWidth,\n      height: bboxSprite.displayHeight\n    };\n\n    this.bboxDetailMap.set(itemId, objectDetail);\n\n    bboxSprite.data.set('itemId', itemId);\n    bboxSprite.data.set('type', 'bbox');\n  }\n\n  /**\n   * Returns an array of bounding box details for logging information\n   * into info-boxes by LOg Manager\n   */\n  public getLoggables() {\n    return [...this.bboxDetailMap.values()];\n  }\n\n  public getItemById(itemId: ItemId) {\n    return this.bboxDetailMap.get(itemId);\n  }\n\n  private getObjectPlacement = () => mandatory(this.objectPlacement);\n\n  /**\n   * This function resizes the bbox that is currently being drawn,\n   * so that users can see the effects of drawing a rectangle in real-time.\n   *\n   * @param objectPlacement the bbox being drawn\n   */\n  public resizeWhileBeingDrawn(objectPlacement: ObjectPlacement) {\n    if (\n      !this.getObjectPlacement().isCursorMode(CursorMode.DrawBBox) ||\n      !this.startingCoordinates ||\n      !this.bboxBeingDrawn\n    ) {\n      return;\n    }\n    const [startX, startY] = this.startingCoordinates;\n    const currentX = objectPlacement.input.x;\n    const currentY = objectPlacement.input.y;\n    resize(this.bboxBeingDrawn, currentX - startX, currentY - startY);\n  }\n\n  /**\n   * This function is called when printing the checkpoint text file\n   *\n   * Provides the array of strings that are associated with the `boundingBoxes` entity\n   * that are printed within the location paragraph.\n   */\n  public checkpointTxtLog() {\n    const map: string[] = [];\n    this.bboxDetailMap.forEach((bboxDetail: SSBBoxDetail) => {\n      const bboxDetailArray = [\n        '+' + bboxDetail.id,\n        StringUtils.toIntString(bboxDetail.x),\n        StringUtils.toIntString(bboxDetail.y),\n        StringUtils.toIntString(bboxDetail.width),\n        StringUtils.toIntString(bboxDetail.height)\n      ];\n\n      map.push(bboxDetailArray.join(', '));\n      map.push('    show_dialogue*(click)');\n    });\n    return map;\n  }\n\n  /**\n   * This function receives any transformation updates on bboxes\n   * from Transformation manager and stores information internally in its `bboxDetailMap`\n   *\n   * @param gameObject bounding box being updated\n   * @param attribute attributes being updated for that bbox\n   * @param value value to set this attribute to\n   */\n  public setAttribute(\n    gameObject: Phaser.GameObjects.Rectangle | Phaser.GameObjects.Image,\n    attribute: string,\n    value: number\n  ) {\n    const itemId = gameObject.data.get('itemId');\n    const bboxDetail = this.bboxDetailMap.get(itemId);\n    if (!bboxDetail) return;\n    bboxDetail[attribute] = value;\n  }\n\n  public deleteAll() {\n    this.bboxDetailMap.clear();\n  }\n\n  public delete(gameObject: Phaser.GameObjects.Image | Phaser.GameObjects.Rectangle) {\n    const itemId = gameObject.data.get('itemId');\n    this.bboxDetailMap.delete(itemId);\n  }\n}\n","const iconBgSize = 55;\n\nconst SSCursorModeConstants = {\n  icon: { bgSize: iconBgSize, size: 40, yInterval: 15 },\n  alpha: { inactive: 0.7, hover: 1.0, active: 0.9 }\n};\n\nexport default SSCursorModeConstants;\n","import { Constants } from 'src/features/game/commons/CommonConstants';\nimport CommonTextHover from 'src/features/game/commons/CommonTextHover';\nimport { AssetKey } from 'src/features/game/commons/CommonTypes';\nimport { createButton } from 'src/features/game/utils/ButtonUtils';\n\nimport SSImageAssets from '../assets/ImageAssets';\nimport SSCursorModeConstants from './SSCursorModeConstants';\nimport { CursorMode } from './SSCursorModeTypes';\n\n/**\n * This manager manages rendering of the cursor mode icons\n * and manages which SS cursor mode is activated\n */\nexport default class SSCursorMode extends Phaser.GameObjects.Container {\n  private isModes: Array<boolean>;\n  private currCursorMode: CursorMode;\n  private cursorModes: Array<Phaser.GameObjects.Container>;\n  private currActiveModeIdx: number;\n\n  constructor(\n    scene: Phaser.Scene,\n    x?: number,\n    y?: number,\n    defaultCursorMode: CursorMode = CursorMode.DragResizeObj\n  ) {\n    super(scene, x, y);\n    this.currCursorMode = defaultCursorMode;\n    this.isModes = new Array<boolean>();\n    this.cursorModes = new Array<Phaser.GameObjects.Container>();\n    this.currActiveModeIdx = Constants.nullSequenceNumber;\n  }\n\n  public getCurrCursorMode() {\n    return this.currCursorMode;\n  }\n\n  public setCursorMode(newMode: CursorMode) {\n    this.currCursorMode = newMode;\n  }\n\n  public addCursorMode(\n    scene: Phaser.Scene,\n    assetKey: AssetKey,\n    isMode: boolean = true,\n    text: string = '',\n    onClick: () => void = Constants.nullFunction,\n    onHover: () => void = Constants.nullFunction,\n    onOut: () => void = Constants.nullFunction\n  ) {\n    // Main container\n    const cursorModeContainer = new Phaser.GameObjects.Container(scene, 0, 0);\n\n    // Update\n    this.isModes.push(isMode);\n    this.cursorModes.push(cursorModeContainer);\n    const currIdx = this.cursorModes.length - 1;\n\n    // On hover text container\n    const hoverText = new CommonTextHover(scene, 0, 0, text);\n\n    const onUp = () => {\n      if (this.isModes[currIdx]) this.currActiveModeIdx = currIdx;\n      onClick();\n      this.renderCursorModesContainer();\n    };\n\n    const onHoverWrapper = () => {\n      if (text !== '') hoverText.setVisible(true);\n      cursorModeContainer.setAlpha(SSCursorModeConstants.alpha.hover);\n      onHover();\n    };\n\n    const onOutWrapper = () => {\n      hoverText.setVisible(false);\n      const activeMode = currIdx === this.currActiveModeIdx && this.isModes[currIdx];\n      cursorModeContainer.setAlpha(\n        activeMode ? SSCursorModeConstants.alpha.active : SSCursorModeConstants.alpha.inactive\n      );\n      onOut();\n    };\n\n    const modeButton = createButton(scene, {\n      assetKey: SSImageAssets.iconBg.key,\n      onUp: onUp,\n      onHover: onHoverWrapper,\n      onOut: onOutWrapper,\n      onPointerMove: (pointer: Phaser.Input.Pointer) => {\n        hoverText.x = pointer.x - cursorModeContainer.x - 100;\n        hoverText.y = pointer.y - cursorModeContainer.y - 100;\n      },\n      onHoverEffect: false\n    });\n\n    // Icon\n    const modeIcon = new Phaser.GameObjects.Sprite(scene, 0, 0, assetKey).setDisplaySize(\n      SSCursorModeConstants.icon.size,\n      SSCursorModeConstants.icon.size\n    );\n\n    modeButton.add(modeIcon);\n\n    cursorModeContainer.add([modeButton, hoverText]);\n  }\n\n  public renderCursorModesContainer() {\n    this.removeAll(false);\n    let spacing = 0;\n    this.cursorModes.forEach((mode, index) => {\n      mode.setPosition(0, spacing);\n      const activeMode = index === this.currActiveModeIdx && this.isModes[index];\n      mode.setAlpha(\n        activeMode ? SSCursorModeConstants.alpha.active : SSCursorModeConstants.alpha.inactive\n      );\n      this.add(mode);\n      spacing += SSCursorModeConstants.icon.bgSize + SSCursorModeConstants.icon.yInterval;\n    });\n  }\n}\n","import FontAssets from 'src/features/game/assets/FontAssets';\nimport { BitmapFontStyle } from 'src/features/game/commons/CommonTypes';\n\nexport const loggableStyle: BitmapFontStyle = {\n  key: FontAssets.zektonFont.key,\n  size: 27,\n  align: Phaser.GameObjects.BitmapText.ALIGN_LEFT\n};\n","import { AssetPath } from 'src/features/game/commons/CommonTypes';\n\nexport function getIdFromShortPath(shortPath: AssetPath) {\n  return shortPath.split('/').pop()!.split('.')[0];\n}\n\nexport const padWithTab = (str: string) => '    ' + str;\n","import { AssetPath } from 'src/features/game/commons/CommonTypes';\nimport { mandatory } from 'src/features/game/utils/GameUtils';\nimport StringUtils from 'src/features/game/utils/StringUtils';\nimport { HexColor } from 'src/features/game/utils/StyleUtils';\nimport { createBitmapText } from 'src/features/game/utils/TextUtils';\n\nimport ObjectPlacement from '../scenes/ObjectPlacement/ObjectPlacement';\nimport { loggableStyle } from './SSLogConstants';\nimport { getIdFromShortPath, padWithTab } from './SSLogManagerHelper';\nimport { ICheckpointLoggable, IScreenLoggable } from './SSLogManagerTypes';\n\n/**\n * This manager manages 2 types of logging\n *\n * (1) On-screen logging of coordinates and asset paths\n * (2) Printing of asset texts onto console\n */\nexport default class SSLogManager {\n  private detailMapContainer: Phaser.GameObjects.Container | undefined;\n  private objectPlacement: ObjectPlacement | undefined;\n\n  public initialise(objectPlacement: ObjectPlacement) {\n    this.objectPlacement = objectPlacement;\n  }\n\n  /**\n   * Prints the checkpoint text file generated onto the console\n   *\n   * @param locationAssetPath The location to use as the base for this text file\n   * @param checkpointLoggers The managers that manage entities that can be logged into the checkpoint\n   */\n  public printCheckpoint(\n    locationAssetPath: AssetPath = '/locations/yourRoom-dim/normal.png',\n    checkpointLoggers: ICheckpointLoggable[]\n  ) {\n    const locationId = locationAssetPath === '' ? 'default' : getIdFromShortPath(locationAssetPath);\n\n    const loggables = checkpointLoggers.map(checkpointLogger => {\n      const txt = checkpointLogger.checkpointTxtLog();\n      if (!txt) {\n        return '';\n      }\n      const details = `${checkpointLogger.checkpointTitle}\\n${txt\n        .map(padWithTab)\n        .map(padWithTab)\n        .join('\\n')}`;\n\n      return details;\n    });\n\n    const checkpoint = `\nstartingLoc: ${locationId}\n\nobjectives\n    talk\n\nlocations\n    ${locationId}, ${locationAssetPath}, ${StringUtils.toCapitalizedWords(locationAssetPath)}\n\n${locationId}\n    modes: explore\n    actions\n        show_dialogue(welcome)\n${loggables.map(padWithTab).join('\\n')}\n\ndialogues\n    welcome\n        Congrats on creating your scene\n    click\n        Invisible bounding box is right here\n`;\n    alert('Chapter ready!');\n    console.log(checkpoint);\n  }\n\n  /**\n   * Renders information box for every entity present\n   * on-screen when mouse is hovered over the \"Show Details\" button.\n   *\n   * @param loggables A list of IScreenLoggable that have x and y coordinates (to determine where their info-box is rendered)\n   *                  Each IScreenLoggable object also contains other details such as asset keys, that will be rendered inside the info-box\n   */\n  public showDetailMap(loggables: IScreenLoggable[]) {\n    this.detailMapContainer = new Phaser.GameObjects.Container(this.getObjectPlacement(), 0, 0);\n\n    loggables.forEach((loggable: IScreenLoggable) => {\n      const loggerRectangle = new Phaser.GameObjects.Rectangle(\n        this.getObjectPlacement(),\n        loggable.x,\n        loggable.y,\n        400,\n        210,\n        HexColor.darkBlue\n      )\n        .setOrigin(0.0, 0.5)\n        .setAlpha(0.9);\n\n      const loggerText = createBitmapText(\n        this.getObjectPlacement(),\n        this.formatObjectDetails(loggable),\n        { x: loggable.x + 20, y: loggable.y + 10, oriX: 0.0, oriY: 0.6 },\n        loggableStyle\n      ).setLetterSpacing(3);\n\n      this.detailMapContainer!.add([loggerRectangle, loggerText]);\n    });\n    this.getObjectPlacement().add.existing(this.detailMapContainer);\n  }\n\n  /**\n   * Helper function for formatting the IScreenLoggable into format readable to users\n   *\n   * @param loggable\n   */\n  private formatObjectDetails(loggable: IScreenLoggable) {\n    return Object.entries(loggable)\n      .map(\n        ([key, value]) =>\n          `${key}: ${typeof value === 'number' ? StringUtils.toIntString(value) : value.toString()}`\n      )\n      .join('\\n');\n  }\n\n  /**\n   * Hide the information boxes shown on screen\n   * when user is no longer hovering over the \"Show Details\" button\n   */\n  public hideDetailMap() {\n    if (this.detailMapContainer) {\n      this.detailMapContainer.destroy();\n    }\n  }\n\n  private getObjectPlacement = () => mandatory(this.objectPlacement);\n}\n","import { screenCenter } from 'src/features/game/commons/CommonConstants';\nimport { AssetKey, ItemId } from 'src/features/game/commons/CommonTypes';\nimport { Layer } from 'src/features/game/layer/GameLayerTypes';\nimport { mandatory, toS3Path } from 'src/features/game/utils/GameUtils';\nimport StringUtils from 'src/features/game/utils/StringUtils';\n\nimport { loadImage } from '../../game/utils/LoaderUtils';\nimport { getIdFromShortPath } from '../logger/SSLogManagerHelper';\nimport { ICheckpointLoggable } from '../logger/SSLogManagerTypes';\nimport ObjectPlacement from '../scenes/ObjectPlacement/ObjectPlacement';\nimport { SSObjectDetail } from './SSObjectManagerTypes';\n\n/**\n * This manager manages the object (image assets) for Story Simulator's Object Placement scene\n *\n * It handles:\n * (1) Storing of information on image assets used\n * (2) Creation of image assets by taking the image name from browser storage\n * (3) Rendering of image assets onto screen\n */\nexport default class SSObjectManager implements ICheckpointLoggable {\n  public checkpointTitle = 'objects';\n\n  private objectPlacement: ObjectPlacement | undefined;\n  private objectDetailMap: Map<ItemId, SSObjectDetail>;\n\n  constructor() {\n    this.objectDetailMap = new Map<ItemId, SSObjectDetail>();\n  }\n\n  public initialise(objectPlacement: ObjectPlacement) {\n    this.objectPlacement = objectPlacement;\n    this.objectDetailMap = new Map<ItemId, SSObjectDetail>();\n  }\n\n  /**\n   * Takes the image path from the session storage\n   * and renders the image on screen\n   */\n  public async loadObject() {\n    const shortPath = sessionStorage.getItem('selectedAsset');\n    if (!shortPath) return;\n    const objectAssetKey = `#${shortPath}`;\n    this.getObjectPlacement().addAsset(objectAssetKey, shortPath);\n\n    const assetKeyOnLoad = await loadImage(\n      this.getObjectPlacement(),\n      objectAssetKey,\n      toS3Path(shortPath, true)\n    );\n    this.renderObject(assetKeyOnLoad);\n  }\n\n  /**\n   * Helper to renders the object in the middle of the screen\n   *\n   * @param objectAssetKey asset key of the image used for the object\n   */\n  private renderObject(objectAssetKey: string) {\n    if (objectAssetKey[0] !== '#') {\n      return;\n    }\n    const objectSprite = new Phaser.GameObjects.Image(\n      this.getObjectPlacement(),\n      screenCenter.x,\n      screenCenter.y,\n      objectAssetKey\n    )\n      .setInteractive()\n      .setDataEnabled();\n    this.getObjectPlacement().input.setDraggable(objectSprite);\n    this.getObjectPlacement().getLayerManager().addToLayer(Layer.Objects, objectSprite);\n\n    this.registerObject(objectAssetKey, objectSprite);\n  }\n\n  /**\n   * Helper to record down information on the object that has been placed onto the scene\n   *\n   * @param objectAssetKey\n   * @param objectSprite\n   */\n  private registerObject(objectAssetKey: AssetKey, objectSprite: Phaser.GameObjects.Image) {\n    const itemId = this.generateItemId(\n      objectAssetKey,\n      this.getObjectPlacement().generateItemIdNumber()\n    );\n\n    const assetShortPath = mandatory(this.getObjectPlacement().getAssetPath(objectAssetKey));\n\n    const objectDetail: SSObjectDetail = {\n      id: itemId,\n      assetKey: objectAssetKey,\n      assetPath: assetShortPath,\n      x: screenCenter.x,\n      y: screenCenter.y\n    };\n\n    this.objectDetailMap.set(itemId, objectDetail);\n\n    objectSprite.data.set('itemId', itemId);\n    objectSprite.data.set('type', 'object');\n\n    this.getObjectPlacement().setActiveSelection(objectSprite);\n  }\n\n  /**\n   * Helper to generate a default id for this object\n   *\n   * @param assetKey\n   * @param objectIdNumber\n   */\n  private generateItemId(assetKey: string, objectIdNumber: number) {\n    const itemName = getIdFromShortPath(assetKey);\n    return `${itemName}${objectIdNumber}`;\n  }\n\n  /**\n   * Returns the list of objects details for logging information\n   * into info-boxes by LogManager\n   */\n  public getLoggables() {\n    return [...this.objectDetailMap.values()];\n  }\n\n  /**\n   * This function is called when printing the checkpoint text file\n   *\n   * Provides the array of strings that are associated with the `objects` entity\n   * that are printed within the location paragraph.\n   */\n  public checkpointTxtLog() {\n    return Array.from(this.objectDetailMap.values()).map((objectDetail: SSObjectDetail) => {\n      const objectDetailArray = [\n        '+' + objectDetail.id,\n        objectDetail.assetPath,\n        StringUtils.toIntString(objectDetail.x),\n        StringUtils.toIntString(objectDetail.y)\n      ];\n      if (objectDetail.width) {\n        objectDetailArray.push(StringUtils.toIntString(objectDetail.width));\n        objectDetailArray.push(StringUtils.toIntString(objectDetail.height!));\n      }\n      return objectDetailArray.join(', ');\n    });\n  }\n\n  private getObjectPlacement = () => mandatory(this.objectPlacement);\n\n  /**\n   * This function receives any transformation updates on objects\n   * from Transformation manager and stores information internally in its `objectDetailMap`\n   *\n   * @param gameObject bounding box being updated\n   * @param attribute attributes being updated for that bbox\n   * @param value value to set this attribute to\n   */\n  public setAttribute(\n    gameObject: Phaser.GameObjects.Image | Phaser.GameObjects.Rectangle,\n    attribute: string,\n    value: number\n  ) {\n    const itemId = gameObject.data.get('itemId');\n    const itemDetail = this.objectDetailMap.get(itemId);\n    if (!itemDetail) return;\n    itemDetail[attribute] = value;\n  }\n\n  public deleteAll() {\n    this.objectDetailMap.clear();\n  }\n\n  public delete(gameObject: Phaser.GameObjects.Image | Phaser.GameObjects.Rectangle) {\n    const itemId = gameObject.data.get('itemId');\n    this.objectDetailMap.delete(itemId);\n  }\n}\n","const TransformConstants = {\n  activeSelectMargin: 30,\n  scaleFactor: 1.02\n};\n\nexport default TransformConstants;\n","import { Layer } from 'src/features/game/layer/GameLayerTypes';\nimport { mandatory } from 'src/features/game/utils/GameUtils';\nimport { multiplyDimensions } from 'src/features/game/utils/SpriteUtils';\n\nimport { CursorMode } from '../cursorMode/SSCursorModeTypes';\nimport ObjectPlacement from '../scenes/ObjectPlacement/ObjectPlacement';\nimport TransformConstants from './SSTransformManagerConstants';\n\n/**\n * This manager manages transformation (changing of dimensions and coordinates)\n * of on-screen assets, ie bounding boxes and objects\n *\n * For dragging: It firstly renders the chagnes in real time using Phaser's drag listener\n * When mouse is detached, it updates the details for bbox/objects by contacting their managers\n *\n * For resizing: The `[` and `]` keys are used to resize an object\n */\nexport default class SSTransformManager {\n  private activeSelection: Phaser.GameObjects.Image | Phaser.GameObjects.Rectangle | undefined;\n  private activeSelectRect: Phaser.GameObjects.Rectangle | undefined;\n  private objectPlacement: ObjectPlacement | undefined;\n\n  public initialise(objectPlacement: ObjectPlacement) {\n    this.objectPlacement = objectPlacement;\n    this.trackDraggables(objectPlacement);\n    this.drawActiveSelectRect();\n    this.bindDeleteKey();\n  }\n\n  private drawActiveSelectRect() {\n    this.activeSelectRect = new Phaser.GameObjects.Rectangle(\n      this.getObjectPlacement(),\n      0,\n      0,\n      1,\n      1,\n      0\n    ).setAlpha(0.3);\n    this.getObjectPlacement().getLayerManager().addToLayer(Layer.Selector, this.activeSelectRect);\n  }\n\n  private trackDraggables(objectPlacement: ObjectPlacement) {\n    objectPlacement\n      .getInputManager()\n      .registerEventListener(\n        'drag',\n        (\n          pointer: MouseEvent,\n          gameObject: Phaser.GameObjects.Image | Phaser.GameObjects.Rectangle,\n          dragX: number,\n          dragY: number\n        ) => {\n          if (!objectPlacement.isCursorMode(CursorMode.DrawBBox)) {\n            objectPlacement.getCursorManager().setCursorMode(CursorMode.DragResizeObj);\n            gameObject.x = dragX;\n            gameObject.y = dragY;\n          }\n\n          if (gameObject.data.get('type') === 'object') {\n            objectPlacement.setObjAttribute(gameObject, 'x', dragX);\n            objectPlacement.setObjAttribute(gameObject, 'y', dragY);\n            this.setActiveSelection(gameObject);\n          }\n\n          if (gameObject.data.get('type') === 'bbox') {\n            objectPlacement.setBBoxAttribute(gameObject, 'x', dragX);\n            objectPlacement.setBBoxAttribute(gameObject, 'y', dragY);\n            this.setActiveSelection(gameObject);\n          }\n        }\n      );\n  }\n\n  public resizeActive(enlarge: boolean) {\n    const objectPlacement = this.getObjectPlacement();\n    if (!this.activeSelection || !this.activeSelectRect) {\n      return;\n    }\n    const factor = enlarge ? TransformConstants.scaleFactor : 1 / TransformConstants.scaleFactor;\n    multiplyDimensions(this.activeSelection, factor);\n    this.activeSelectRect.displayHeight =\n      this.activeSelection.displayHeight + TransformConstants.activeSelectMargin;\n    this.activeSelectRect.displayWidth =\n      this.activeSelection.displayWidth + TransformConstants.activeSelectMargin;\n\n    if (this.activeSelection.data.get('type') === 'object') {\n      objectPlacement.setObjAttribute(\n        this.activeSelection,\n        'width',\n        Math.abs(this.activeSelection.displayWidth)\n      );\n      objectPlacement.setObjAttribute(\n        this.activeSelection,\n        'height',\n        Math.abs(this.activeSelection.displayHeight)\n      );\n    }\n\n    if (this.activeSelection.data.get('type') === 'bbox') {\n      objectPlacement.setBBoxAttribute(\n        this.activeSelection,\n        'width',\n        Math.abs(this.activeSelection.displayWidth)\n      );\n      objectPlacement.setBBoxAttribute(\n        this.activeSelection,\n        'height',\n        Math.abs(this.activeSelection.displayHeight)\n      );\n    }\n  }\n\n  public setActiveSelection(gameObject: Phaser.GameObjects.Image | Phaser.GameObjects.Rectangle) {\n    if (!this.activeSelectRect) {\n      return;\n    }\n    this.activeSelectRect!.setAlpha(0.3);\n    this.activeSelection = gameObject;\n    this.activeSelectRect.x = gameObject.x;\n    this.activeSelectRect.y = gameObject.y;\n\n    this.activeSelectRect.displayHeight =\n      gameObject.displayHeight + TransformConstants.activeSelectMargin;\n    this.activeSelectRect.displayWidth =\n      gameObject.displayWidth + TransformConstants.activeSelectMargin;\n  }\n\n  public deselect() {\n    this.activeSelectRect!.setAlpha(0);\n    this.activeSelection = undefined;\n  }\n\n  private getObjectPlacement = () => mandatory(this.objectPlacement);\n\n  private bindDeleteKey() {\n    const deleteKeys = [\n      Phaser.Input.Keyboard.KeyCodes.BACKSPACE,\n      Phaser.Input.Keyboard.KeyCodes.DELETE\n    ];\n    deleteKeys.forEach(key =>\n      this.getObjectPlacement()\n        .getInputManager()\n        .registerKeyboardListener(key, 'up', () => {\n          this.deleteActiveSelection();\n          this.deselect();\n        })\n    );\n  }\n\n  private deleteActiveSelection() {\n    if (!this.activeSelection) return;\n    switch (this.getType(this.activeSelection)) {\n      case 'object':\n        this.getObjectPlacement().deleteObj(this.activeSelection);\n        break;\n      case 'bbox':\n        this.getObjectPlacement().deleteBBox(this.activeSelection);\n        break;\n    }\n    this.activeSelection.destroy();\n  }\n\n  private getType(gameObject: Phaser.GameObjects.Rectangle | Phaser.GameObjects.Image) {\n    return this.activeSelection?.data.get('type');\n  }\n}\n","const ObjPlacementConstants = {\n  cursor: { x: 100, y: 100 }\n};\n\nexport default ObjPlacementConstants;\n","import CommonBackButton from 'src/features/game/commons/CommonBackButton';\nimport { screenCenter, screenSize } from 'src/features/game/commons/CommonConstants';\nimport { AssetKey, AssetPath } from 'src/features/game/commons/CommonTypes';\nimport GameInputManager from 'src/features/game/input/GameInputManager';\nimport GameLayerManager from 'src/features/game/layer/GameLayerManager';\nimport { Layer } from 'src/features/game/layer/GameLayerTypes';\nimport SourceAcademyGame from 'src/features/game/SourceAcademyGame';\nimport { mandatory } from 'src/features/game/utils/GameUtils';\n\nimport SSImageAssets from '../../assets/ImageAssets';\nimport SSBackgroundManager from '../../background/SSBackgroundManager';\nimport SSBBoxManager from '../../boundingBoxes/SSBBoxManager';\nimport SSCursorMode from '../../cursorMode/SSCursorMode';\nimport { CursorMode } from '../../cursorMode/SSCursorModeTypes';\nimport SSLogManager from '../../logger/SSLogManager';\nimport SSObjectManager from '../../objects/SSObjectManager';\nimport { StorySimState } from '../../StorySimulatorTypes';\nimport SSTransformManager from '../../transform/SSTransformManager';\nimport ObjPlacementConstants from './ObjectPlacementConstants';\n\n/**\n * Allow users to position objects, set backgrounds, and get\n * the coordinates of the objects.\n */\nexport default class ObjectPlacement extends Phaser.Scene {\n  public layerManager?: GameLayerManager;\n  public inputManager?: GameInputManager;\n  private transformManager: SSTransformManager;\n  private cursorModes: SSCursorMode | undefined;\n  private bboxManager: SSBBoxManager;\n  private objectManager: SSObjectManager;\n  private backgroundManager: SSBackgroundManager;\n  private logManager: SSLogManager;\n\n  private assetMap: Map<AssetKey, AssetPath>;\n  private itemIdNumber: number;\n\n  private openBracket: Phaser.Input.Keyboard.Key | undefined;\n  private closedBracket: Phaser.Input.Keyboard.Key | undefined;\n\n  constructor() {\n    super('ObjectPlacement');\n    this.objectManager = new SSObjectManager();\n    this.bboxManager = new SSBBoxManager();\n    this.backgroundManager = new SSBackgroundManager();\n    this.logManager = new SSLogManager();\n    this.transformManager = new SSTransformManager();\n\n    this.cursorModes = undefined;\n    this.itemIdNumber = 0;\n    this.assetMap = new Map<AssetKey, AssetPath>();\n  }\n\n  public init() {\n    this.layerManager = new GameLayerManager(this);\n    this.inputManager = new GameInputManager(this);\n    this.objectManager = new SSObjectManager();\n    this.bboxManager = new SSBBoxManager();\n    this.backgroundManager = new SSBackgroundManager();\n    this.logManager = new SSLogManager();\n    this.transformManager = new SSTransformManager();\n\n    this.cursorModes = undefined;\n    this.itemIdNumber = 0;\n    this.assetMap = new Map<AssetKey, AssetPath>();\n  }\n\n  public create() {\n    SourceAcademyGame.getInstance().setCurrentSceneRef(this);\n\n    this.renderBackground();\n    this.createUIButtons();\n    this.backgroundManager.initialise(this);\n    this.objectManager.initialise(this);\n    this.bboxManager.initialise(this);\n    this.transformManager.initialise(this);\n    this.logManager.initialise(this);\n\n    this.openBracket = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.OPEN_BRACKET);\n    this.closedBracket = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.CLOSED_BRACKET);\n  }\n\n  public update() {\n    if (this.openBracket && this.openBracket.isDown) {\n      this.transformManager.resizeActive(false);\n    }\n    if (this.closedBracket && this.closedBracket.isDown) {\n      this.transformManager.resizeActive(true);\n    }\n\n    this.bboxManager.resizeWhileBeingDrawn(this);\n  }\n\n  private createUIButtons() {\n    const uiContainer = new Phaser.GameObjects.Container(this, 0, 0);\n    const backButton = new CommonBackButton(this, () => {\n      this.cleanUp();\n      SourceAcademyGame.getInstance().setStorySimState(StorySimState.Default);\n      this.scene.start('StorySimulatorMenu');\n    });\n\n    this.cursorModes = new SSCursorMode(\n      this,\n      ObjPlacementConstants.cursor.x,\n      ObjPlacementConstants.cursor.y\n    );\n    this.populateCursorModes();\n\n    uiContainer.add(this.cursorModes);\n    uiContainer.add(backButton);\n\n    this.getLayerManager().addToLayer(Layer.UI, uiContainer);\n  }\n\n  public renderBackground() {\n    const backgroundImg = new Phaser.GameObjects.Image(\n      this,\n      screenCenter.x,\n      screenCenter.y,\n      SSImageAssets.storySimBg.key\n    );\n    backgroundImg.setDisplaySize(screenSize.x, screenSize.y);\n\n    this.getLayerManager().addToLayer(Layer.Background, backgroundImg);\n  }\n\n  private populateCursorModes() {\n    if (this.cursorModes) {\n      // Change background\n      this.cursorModes.addCursorMode(\n        this,\n        SSImageAssets.colorIcon.key,\n        false,\n        'Set background',\n        async () => await this.backgroundManager.loadBackground()\n      );\n\n      // Add object\n      this.cursorModes.addCursorMode(\n        this,\n        SSImageAssets.imageIcon.key,\n        false,\n        'Add selected object',\n        async () => await this.objectManager.loadObject()\n      );\n\n      // Draw BBox\n      this.cursorModes.addCursorMode(\n        this,\n        SSImageAssets.bboxIcon.key,\n        true,\n        'Draw bounding boxes',\n        () => this.cursorModes!.setCursorMode(CursorMode.DrawBBox)\n      );\n\n      // Drag/Resize\n      this.cursorModes.addCursorMode(this, SSImageAssets.handIcon.key, true, 'Drag or resize', () =>\n        this.cursorModes!.setCursorMode(CursorMode.DragResizeObj)\n      );\n\n      // Print info\n      this.cursorModes.addCursorMode(\n        this,\n        SSImageAssets.listIcon.key,\n        false,\n        'Print coordinates',\n        () =>\n          this.logManager.printCheckpoint(this.backgroundManager.getBackgroundAssetPath(), [\n            this.objectManager,\n            this.bboxManager\n          ]),\n        () =>\n          this.logManager.showDetailMap([\n            ...this.objectManager.getLoggables(),\n            ...this.bboxManager.getLoggables()\n          ]),\n        () => this.logManager.hideDetailMap()\n      );\n\n      // Erase Layers\n      this.cursorModes.addCursorMode(this, SSImageAssets.eraseIcon.key, false, 'Erase all', () => {\n        const confirm = window.confirm('Are you sure you want to delete?');\n\n        if (!confirm) return;\n        this.getLayerManager().clearSeveralLayers([Layer.Background, Layer.BBox, Layer.Objects]);\n        this.objectManager.deleteAll();\n        this.bboxManager.deleteAll();\n        this.transformManager.deselect();\n        this.renderBackground();\n      });\n\n      this.cursorModes.renderCursorModesContainer();\n    }\n  }\n\n  public getCursorManager = () => mandatory(this.cursorModes);\n\n  public getCoordinates(): number[] {\n    return [this.input.x, this.input.y];\n  }\n\n  public isCursorMode(cursorMode: CursorMode) {\n    return this.getCursorManager().getCurrCursorMode() === cursorMode;\n  }\n\n  private cleanUp() {\n    this.getInputManager().clearListeners();\n    this.getLayerManager().clearAllLayers();\n  }\n\n  public addAsset(assetKey: AssetKey, assetPath: AssetPath) {\n    this.assetMap.set(assetKey, assetPath);\n  }\n\n  public getAssetPath(assetKey: AssetKey) {\n    return this.assetMap.get(assetKey);\n  }\n\n  public generateItemIdNumber() {\n    return this.itemIdNumber++;\n  }\n\n  public setActiveSelection(gameObject: Phaser.GameObjects.Image | Phaser.GameObjects.Rectangle) {\n    this.transformManager.setActiveSelection(gameObject);\n  }\n\n  public setObjAttribute(\n    objectSprite: Phaser.GameObjects.Image | Phaser.GameObjects.Rectangle,\n    attribute: string,\n    value: number\n  ) {\n    this.objectManager.setAttribute(objectSprite, attribute, value);\n  }\n\n  public deleteObj(objectSprite: Phaser.GameObjects.Rectangle | Phaser.GameObjects.Image) {\n    this.objectManager.delete(objectSprite);\n  }\n\n  public setBBoxAttribute(\n    bboxSprite: Phaser.GameObjects.Image | Phaser.GameObjects.Rectangle,\n    attribute: string,\n    value: number\n  ) {\n    this.bboxManager.setAttribute(bboxSprite, attribute, value);\n  }\n\n  public deleteBBox(bboxSprite: Phaser.GameObjects.Rectangle | Phaser.GameObjects.Image) {\n    this.bboxManager.delete(bboxSprite);\n  }\n\n  public getInputManager = () => mandatory(this.inputManager);\n  public getLayerManager = () => mandatory(this.layerManager);\n}\n","import * as Phaser from 'phaser';\nimport { screenSize } from 'src/features/game/commons/CommonConstants';\nimport CheckpointTransition from 'src/features/game/scenes/checkpointTransition/CheckpointTransition';\nimport GameManager from 'src/features/game/scenes/gameManager/GameManager';\nimport SourceAcademyGame, { GameType } from 'src/features/game/SourceAcademyGame';\nimport MainMenu from 'src/features/storySimulator/scenes/mainMenu/MainMenu';\nimport ObjectPlacement from 'src/features/storySimulator/scenes/ObjectPlacement/ObjectPlacement';\n\nconst config = {\n  debug: true,\n  type: Phaser.CANVAS,\n  width: screenSize.x,\n  height: screenSize.y,\n  physics: {\n    default: 'arcade'\n  },\n  scale: {\n    mode: Phaser.Scale.FIT,\n    parent: 'game-display'\n  },\n  fps: {\n    target: 24\n  }\n};\n\nexport const createStorySimulatorGame = () => {\n  const game = new SourceAcademyGame(config, GameType.Simulator);\n  game.scene.add('StorySimulatorMenu', MainMenu, true);\n  game.scene.add('ObjectPlacement', ObjectPlacement);\n  game.scene.add('GameManager', GameManager);\n  game.scene.add('CheckpointTransition', CheckpointTransition);\n  return game;\n};\n","import * as React from 'react';\nimport { useTypedSelector } from 'src/commons/utils/Hooks';\nimport SourceAcademyGame, { AccountInfo } from 'src/features/game/SourceAcademyGame';\nimport { StorySimState } from 'src/features/storySimulator/StorySimulatorTypes';\n\nimport StorySimulatorAssetFileUploader from './subcomponents/StorySimulatorAssetFileUploader';\nimport StorySimulatorAssetSelection from './subcomponents/StorySimulatorAssetSelection';\nimport StorySimulatorChapterSim from './subcomponents/StorySimulatorChapterSim';\nimport StorySimulatorCheckpointSim from './subcomponents/StorySimulatorCheckpointSim';\nimport { createStorySimulatorGame } from './subcomponents/storySimulatorGame';\n\n/**\n * Story simulator main page\n *\n * Displays the following elements:\n * (1) Story Simulator phaser canvas\n * (2) Story Simulator control panel\n *\n * Story Simulator control panel's content can be altered using\n * `setStorySimState` function. This function is passed into story\n * simulator phaser game, so that the StorySimulatorMainMenu buttons\n * are able to control what is shown on the Story Simulator panel.\n */\nfunction StorySimulator() {\n  const session = useTypedSelector(state => state.session);\n  const [storySimState, setStorySimState] = React.useState<string>(StorySimState.Default);\n\n  React.useEffect(() => {\n    createStorySimulatorGame().setStorySimStateSetter(setStorySimState);\n  }, []);\n\n  React.useEffect(() => {\n    SourceAcademyGame.getInstance().setAccountInfo({\n      accessToken: session.accessToken,\n      refreshToken: session.refreshToken,\n      role: session.role,\n      name: session.name\n    } as AccountInfo);\n  }, [session]);\n\n  return (\n    <>\n      <div className=\"StorySimulatorWrapper\">\n        <div id=\"game-display\" />\n        <div className=\"LeftAlign StorySimulatorPanel\">\n          {storySimState === StorySimState.Default && (\n            <>\n              <h3>Welcome to story simulator!</h3>\n            </>\n          )}\n          {storySimState === StorySimState.CheckpointSim && <StorySimulatorCheckpointSim />}\n          {storySimState === StorySimState.ObjectPlacement && (\n            <>\n              <h3>Asset Selection</h3>\n              <StorySimulatorAssetSelection />\n            </>\n          )}\n          {storySimState === StorySimState.AssetUploader && (\n            <>\n              <h3>Asset uploader</h3>\n              <StorySimulatorAssetFileUploader />\n              <h3>Asset Viewer</h3>\n              <StorySimulatorAssetSelection />\n            </>\n          )}\n          {storySimState === StorySimState.ChapterSim && <StorySimulatorChapterSim />}\n        </div>\n      </div>\n    </>\n  );\n}\n\nexport default StorySimulator;\n","import 'ag-grid-community/dist/styles/ag-grid.css';\nimport 'ag-grid-community/dist/styles/ag-theme-balham.css';\n\nimport { Button, Divider, NonIdealState, Spinner, SpinnerSize } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { GridApi, GridReadyEvent } from 'ag-grid-community';\nimport { AgGridReact } from 'ag-grid-react';\nimport { useCallback, useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { fetchAllUserXp } from 'src/commons/application/actions/SessionActions';\nimport ContentDisplay from 'src/commons/ContentDisplay';\nimport { useTypedSelector } from 'src/commons/utils/Hooks';\n\ntype RowData = {\n  name: string;\n  'NUS Net ID': string;\n  'Assessment Xp': string;\n  'Achievement Xp': string;\n};\n\ntype PageState = {\n  currPage: number;\n  maxPages: number;\n  rowCountString: string;\n  isBackDisabled: boolean;\n  isForwardDisabled: boolean;\n};\n\nconst columnDefs = [\n  { field: 'name' },\n  { field: 'NUS Net ID' },\n  { field: 'Assessment Xp' },\n  { field: 'Achievement Xp' }\n];\n\nconst defaultColDef = {\n  resizable: true,\n  sortable: true\n};\n\nconst XpCalculation: React.FC = () => {\n  const dispatch = useDispatch();\n  const allUserXp = useTypedSelector(state => state.session.allUserXp);\n\n  const [rowData, setRowData] = useState<RowData[]>([]);\n  const [gridApi, setGridApi] = useState<GridApi>();\n  const [pageState, setPageState] = useState<PageState>({\n    currPage: 1,\n    maxPages: 1,\n    rowCountString: '(none)',\n    isBackDisabled: true,\n    isForwardDisabled: true\n  });\n\n  useEffect(() => {\n    if (allUserXp) {\n      const rowData = allUserXp.map(data => {\n        const [name, nusNetId, assessmentXp, achievementXp] = data;\n        return {\n          name: name ?? '',\n          'NUS Net ID': nusNetId ?? '',\n          'Assessment Xp': assessmentXp ?? '0',\n          'Achievement Xp': achievementXp ?? '0'\n        };\n      });\n      setRowData(rowData);\n    }\n  }, [allUserXp]);\n\n  const exportCSV = useCallback(() => {\n    if (gridApi) {\n      gridApi.exportDataAsCsv({\n        fileName: `SA XP Count (${new Date().toISOString()}).csv`,\n        // Explicitly declare exported columns to avoid exporting trash columns\n        columnKeys: ['name', 'NUS Net ID', 'Assessment Xp', 'Achievement Xp']\n      });\n    }\n  }, [gridApi]);\n\n  // Forcibly resizes columns to fit the width of the datagrid - prevents datagrid\n  // from needing to render a horizontal scrollbar when columns overflow grid width\n  const resizeGrid = useCallback(() => {\n    if (gridApi) {\n      gridApi.sizeColumnsToFit();\n    }\n  }, [gridApi]);\n\n  const changePaginationView = useCallback(\n    (type: string) => {\n      return () => {\n        if (gridApi) {\n          switch (type) {\n            case 'first':\n              return gridApi.paginationGoToFirstPage();\n            case 'prev':\n              return gridApi.paginationGoToPreviousPage();\n            case 'next':\n              return gridApi.paginationGoToNextPage();\n            case 'last':\n              return gridApi.paginationGoToLastPage();\n            default:\n          }\n        }\n      };\n    },\n    [gridApi]\n  );\n\n  const updatePaginationState = useCallback(() => {\n    if (gridApi) {\n      const newTotalPages = gridApi.paginationGetTotalPages();\n      const newCurrPage = newTotalPages === 0 ? 0 : gridApi.paginationGetCurrentPage() + 1;\n      setPageState({\n        currPage: newCurrPage,\n        maxPages: newTotalPages,\n        rowCountString: formatRowCountString(\n          25,\n          newCurrPage,\n          newTotalPages,\n          gridApi.paginationGetRowCount()\n        ),\n        isBackDisabled: newTotalPages === 0 || newCurrPage === 1,\n        isForwardDisabled: newTotalPages === 0 || newCurrPage === newTotalPages\n      });\n    }\n  }, [gridApi, setPageState]);\n\n  const onGridReady = useCallback(\n    (params: GridReadyEvent) => {\n      setGridApi(params.api);\n      updatePaginationState();\n    },\n    [setGridApi, updatePaginationState]\n  );\n\n  const Controls = () => {\n    return (\n      <div className=\"grading-controls\">\n        <div className=\"GridControls ag-grid-controls\">\n          <div style={{ width: '130px' }} className=\"left-controls\"></div>\n          <div className=\"centre-controls\">\n            <Button\n              icon={IconNames.CHEVRON_BACKWARD}\n              onClick={changePaginationView('first')}\n              minimal={true}\n              disabled={pageState.isBackDisabled}\n            />\n            <Button\n              icon={IconNames.CHEVRON_LEFT}\n              onClick={changePaginationView('prev')}\n              minimal={true}\n              disabled={pageState.isBackDisabled}\n            />\n            <Button className=\"pagination-details hidden-xs\" disabled={true} minimal={true}>\n              <div>{`Page ${pageState.currPage} of ${pageState.maxPages}`}</div>\n              <div>{pageState.rowCountString}</div>\n            </Button>\n            <Button\n              icon={IconNames.CHEVRON_RIGHT}\n              onClick={changePaginationView('next')}\n              minimal={true}\n              disabled={pageState.isForwardDisabled}\n            />\n            <Button\n              icon={IconNames.CHEVRON_FORWARD}\n              onClick={changePaginationView('last')}\n              minimal={true}\n              disabled={pageState.isForwardDisabled}\n            />\n          </div>\n          <div className=\"right-controls\">\n            <Button icon={IconNames.EXPORT} onClick={exportCSV}>\n              <span className=\"hidden-xs\">Export to CSV</span>\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }; /* Display either a loading screen or a table with overviews. */\n  const LoadingDisplay = (\n    <NonIdealState\n      className=\"Grading\"\n      description=\"Fetching XP...\"\n      icon={<Spinner size={SpinnerSize.LARGE} />}\n    />\n  );\n\n  const Content = (\n    <div className=\"Grading\">\n      <Controls />\n      <Divider />\n      <AgGridReact\n        domLayout={'autoHeight'}\n        className=\"ag-grid-parent ag-theme-balham\"\n        columnDefs={columnDefs}\n        onGridReady={onGridReady}\n        onPaginationChanged={updatePaginationState}\n        onGridSizeChanged={resizeGrid}\n        defaultColDef={defaultColDef}\n        rowData={rowData}\n        rowHeight={30}\n        pagination={true}\n        paginationPageSize={20}\n        suppressCellSelection={true}\n        suppressMovableColumns={true}\n        suppressPaginationPanel={true}\n      />\n    </div>\n  );\n\n  return (\n    <ContentDisplay\n      loadContentDispatch={() => dispatch(fetchAllUserXp())}\n      display={!allUserXp ? LoadingDisplay : Content}\n      fullWidth={false}\n    />\n  );\n};\n\nconst formatRowCountString = (\n  pageSize: number,\n  currPage: number,\n  maxPages: number,\n  totalRows: number\n) => {\n  return maxPages === 0\n    ? '(none)'\n    : currPage !== maxPages\n    ? `(#${pageSize * currPage - 19} - #${pageSize * currPage})`\n    : `(#${pageSize * currPage - 19} - #${totalRows})`;\n};\n\nexport default XpCalculation;\n","import { Card, Classes, NonIdealState, Spinner, SpinnerSize } from '@blueprintjs/core';\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { Redirect, Route, Switch, useParams, useRouteMatch } from 'react-router';\nimport { useTypedSelector } from 'src/commons/utils/Hooks';\n\nimport {\n  fetchNotifications,\n  updateLatestViewedCourse\n} from '../../commons/application/actions/SessionActions';\nimport AssessmentContainer from '../../commons/assessment/AssessmentContainer';\nimport { assessmentTypeLink } from '../../commons/utils/ParamParseHelper';\nimport { assessmentRegExp, gradingRegExp } from '../../features/academy/AcademyTypes';\nimport Achievement from '../../pages/achievement/AchievementContainer';\nimport Sourcecast from '../../pages/sourcecast/SourcecastContainer';\nimport Playground from '../playground/Playground';\nimport AdminPanel from './adminPanel/AdminPanelContainer';\nimport DashboardContainer from './dashboard/DashboardContainer';\nimport Game from './game/Game';\nimport Grading from './grading/GradingContainer';\nimport GroundControl from './groundControl/GroundControlContainer';\nimport Sourcereel from './sourcereel/SourcereelContainer';\nimport StorySimulator from './storySimulator/StorySimulator';\nimport XpCalculation from './xpCalculation/XpCalculation';\n\nconst Academy: React.FC<{}> = () => {\n  const { path, url } = useRouteMatch();\n  const dispatch = useDispatch();\n  React.useEffect(() => {\n    dispatch(fetchNotifications());\n  }, [dispatch]);\n\n  const assessmentConfigurations = useTypedSelector(\n    state => state.session.assessmentConfigurations\n  );\n  const enableGame = useTypedSelector(state => state.session.enableGame);\n  const role = useTypedSelector(state => state.session.role);\n\n  const staffRoutes =\n    role !== 'student'\n      ? [\n          <Route path={`${path}/groundcontrol`} component={GroundControl} key={0} />,\n          <Route path={`${path}/grading/${gradingRegExp}`} component={Grading} key={1} />,\n          <Route path={`${path}/xpcalculation`} component={XpCalculation} key={2} />,\n          <Route path={`${path}/sourcereel`} component={Sourcereel} key={3} />,\n          <Route path={`${path}/storysimulator`} component={StorySimulator} key={4} />,\n          <Route path={`${path}/dashboard`} component={DashboardContainer} key={5} />\n        ]\n      : null;\n  return (\n    <div className=\"Academy\">\n      <Switch>\n        {assessmentConfigurations?.map(assessmentConfiguration => (\n          <Route\n            path={`${path}/${assessmentTypeLink(assessmentConfiguration.type)}/${assessmentRegExp}`}\n            key={assessmentConfiguration.type}\n          >\n            <AssessmentContainer assessmentConfiguration={assessmentConfiguration} />\n          </Route>\n        ))}\n        {enableGame && <Route path={`${path}/game`} component={Game} />}\n        <Route path={`${path}/sourcecast/:sourcecastId?`} component={Sourcecast} />\n        <Route path={`${path}/achievements`} component={Achievement} />\n        <Route exact={true} path={path}>\n          <Redirect\n            push={false}\n            to={\n              enableGame\n                ? `${url}/game`\n                : assessmentConfigurations && assessmentConfigurations.length > 0\n                ? `${url}/${assessmentTypeLink(assessmentConfigurations[0].type)}`\n                : role === 'admin'\n                ? `${url}/adminpanel`\n                : '/404'\n            }\n          />\n        </Route>\n        {staffRoutes}\n        {role === 'admin' && <Route path={`${path}/adminpanel`} component={AdminPanel} />}\n        <Route component={Playground} />\n      </Switch>\n    </div>\n  );\n};\n\nconst CourseSelectingAcademy: React.FC<{}> = () => {\n  const dispatch = useDispatch();\n  const courseId = useTypedSelector(state => state.session.courseId);\n  const { courseId: routeCourseIdStr } = useParams<{ courseId?: string }>();\n  const routeCourseId = routeCourseIdStr != null ? parseInt(routeCourseIdStr, 10) : undefined;\n\n  React.useEffect(() => {\n    if (routeCourseId !== undefined && courseId !== routeCourseId) {\n      dispatch(updateLatestViewedCourse(routeCourseId));\n    }\n  }, [courseId, dispatch, routeCourseId]);\n\n  return routeCourseId === courseId ? (\n    <Academy />\n  ) : (\n    <div className={classNames('Academy-switching-courses', Classes.DARK)}>\n      <Card className={Classes.ELEVATION_4}>\n        <NonIdealState\n          description=\"Switching courses...\"\n          icon={<Spinner size={SpinnerSize.LARGE} />}\n        />\n      </Card>\n    </div>\n  );\n};\n\nexport default CourseSelectingAcademy;\n","import { Card, Elevation, H3, H5 } from '@blueprintjs/core';\nimport React from 'react';\n\nimport { Links } from '../../../commons/utils/Constants';\n\nconst dot = <span className=\"dot\">&bull;</span>;\n\nconst ContributorsDetails: React.FC = () => (\n  <div className=\"outsideDetails\">\n    <Card className=\"contributorsDetails\" elevation={Elevation.ONE}>\n      <H3>The Team behind the Source Academy</H3>\n      <p className=\"description\">\n        The <i>Source Academy</i> is designed and developed by a team of students, most of who have\n        used the system to learn the fundamentals of computing and enjoyed it. This page includes\n        all developers who contributed to the Source Academy <i>Merlin</i> (2023) and its precursors{' '}\n        <i>Rook</i> (2022), <i>Knight</i> (2020) and <i>Cadet</i> (2018). These versions succeeded\n        Source Academy 2 (2017) and ultimately the original Source Academy (2016).\n      </p>\n      <div className=\"leadership\">\n        <H5>\n          <strong>\n            <u>2023 Leadership (Merlin)</u>\n          </strong>\n        </H5>\n        <p>\n          Chow En Rong,\n          <br />\n          Shen Yi Hong\n          <br />\n          <strong>(Frontend)</strong>\n        </p>\n        {dot}\n        <p>\n          Chen Yanyu\n          <br />\n          <strong>(Backend)</strong>\n        </p>\n        {dot}\n        <p>\n          Gokul Rajiv,\n          <br />\n          Lee Hyung Woon\n          <br />\n          <strong>(Game)</strong>\n        </p>\n        {dot}\n        <p>\n          Shen Yi Hong,\n          <br />\n          Zhan Jie,\n          <br />\n          <strong>(Source)</strong>\n        </p>\n        {dot}\n        <p>\n          Lee Yi,\n          <br />\n          Joel Leow\n          <br />\n          <strong>(Modules)</strong>\n        </p>\n        {dot}\n        <p>\n          Richard Dominick\n          <br />\n          <strong>(Robotics)</strong>\n        </p>\n        {dot}\n        <p>\n          Boyd Anderson,\n          <br />\n          Martin Henz,\n          <br />\n          Eldric Liew,\n          <br />\n          Low Kok Lim,\n          <br />\n          Sanka Rasnayaka\n          <br />\n          <strong>(Coordination)</strong>\n        </p>\n      </div>\n      <div className=\"hallOfFame\">\n        <H5>\n          <strong>\n            <u>Hall of Fame</u>\n          </strong>\n        </H5>\n        <p>\n          <strong>Cadet architect</strong>\n        </p>\n        <p>Evan Sebastian</p>\n        <p>\n          <strong>Cadet core team</strong>\n        </p>\n        <p>\n          Julius Putra Tanu Setiaji {dot} Lee Ning Yuan {dot} Vignesh Shankar {dot} Thomas Tan {dot}{' '}\n          Chen Shaowei\n        </p>\n        <p>\n          <strong>Graphic design</strong>\n        </p>\n        <p>\n          Ng Tse Pei {dot} Joey Yeo {dot} Tan Yu Wei {dot} Sigmund Chianasta\n        </p>\n      </div>\n      <div className=\"leadership\">\n        <p>\n          <strong>2019 Leadership</strong>\n        </p>\n        <br />\n        <p>\n          Liow Jia Chen\n          <br />\n          (Backend)\n        </p>\n        {dot}\n        <p>\n          Ge Shuming\n          <br />\n          (Frontend)\n        </p>\n        {dot}\n        <p>\n          Rahul Rajesh\n          <br />\n          (DevOps)\n        </p>\n        {dot}\n        <p>\n          Daryl Tan\n          <br />\n          (Source)\n        </p>\n        {dot}\n        <p>\n          She Jiayu\n          <br />\n          (Tools)\n        </p>\n      </div>\n      <div className=\"leadership\">\n        <p className=\"evenWider\">\n          <strong>2020 Leadership (Knight)</strong>\n        </p>\n        <br />\n        <p>\n          Tiffany Chong\n          <br />\n          (Game)\n        </p>\n        {dot}\n        <p>\n          Anthony Halim\n          <br />\n          (Architecture)\n        </p>\n        {dot}\n        <p>\n          Kan Yip Keng, Jet\n          <br />\n          (Frontend)\n        </p>\n        {dot}\n        <p>\n          Low Jun Kai, Sean\n          <br />\n          (Frontend)\n        </p>\n        {dot}\n        <p>\n          Daryl Tan\n          <br />\n          (Source)\n        </p>\n        {dot}\n        <p className=\"wider\">\n          Tee Hao Wei\n          <br />\n          (Backend &amp; DevOps)\n        </p>\n      </div>\n      <div className=\"leadership\">\n        <p>\n          <strong>2021 Leadership</strong>\n        </p>\n        <br />\n        <p>\n          Tiffany Chong\n          <br />\n          (Game)\n        </p>\n        {dot}\n        <p>\n          Anthony Halim\n          <br />\n          (Frontend)\n        </p>\n        {dot}\n        <p className=\"evenWider\">\n          Daryl Tan, Thomas Tan\n          <br />\n          (Source)\n        </p>\n        {dot}\n        <p className=\"wider\">\n          Tee Hao Wei\n          <br />\n          (Backend &amp; DevOps)\n        </p>\n      </div>\n      <div className=\"leadership\">\n        <p className=\"evenWider\">\n          <strong>2022 Leadership (Rook)</strong>\n        </p>\n        <br />\n        <p>\n          Tee Hao Wei\n          <br />\n          (CTO)\n        </p>\n        {dot}\n        <p>\n          Chow En Rong\n          <br />\n          (Frontend)\n        </p>\n        {dot}\n        <p>\n          Chen Yanyu\n          <br />\n          (Backend)\n        </p>\n        {dot}\n        <p>\n          Samuel Fang\n          <br />\n          (SICP JS)\n        </p>\n        {dot}\n        <p>\n          Gokul Rajiv,\n          <br />\n          Lee Hyung Woon\n          <br />\n          (Game)\n        </p>\n        {dot}\n        <p>\n          Shen Yi Hong,\n          <br />\n          Zhan Jie,\n          <br />\n          Thomas Tan\n          <br />\n          (Source)\n        </p>\n        {dot}\n        <p>\n          Bryan Loh,\n          <br />\n          Marcus Tang\n          <br />\n          (Modules)\n        </p>\n      </div>\n      <div className=\"contributors\">\n        <H5>\n          <strong>\n            <u>All Contributors</u>\n          </strong>\n        </H5>\n        <p>\n          Below are all contributors to the{' '}\n          <a href={Links.githubOrg}>GitHub repositories of the Source Academy</a>. Feel free to join\n          us!\n        </p>\n      </div>\n    </Card>\n  </div>\n);\n\nexport default ContributorsDetails;\n","import {\n  ContributorsInApi,\n  Repo,\n  ReposInApi\n} from '../../../features/contributors/ContributorsTypes';\n\nconst apiRepoDetails: string = 'https://api.github.com/orgs/source-academy/repos';\nconst ignoreRepos: string[] = ['assessments', 'tools', 'source-academy2'];\nconst ignoreContributors: string[] = ['dependabot[bot]', 'dependabot-preview[bot]'];\n\nexport const fetchRepos = async () => {\n  const response = await fetch(apiRepoDetails);\n  const results = await response.json();\n  const repos = await results\n    .filter((repo: ReposInApi) => {\n      return !ignoreRepos.includes(repo.name);\n    })\n    .map((repo: ReposInApi) => {\n      return {\n        key: repo.id,\n        name: repo.name,\n        description: repo.description,\n        link: repo.contributors_url\n      };\n    });\n  return repos;\n};\n\nexport const fetchContributors = async (endpoints: Repo[]) => {\n  const responses = await Promise.all(\n    endpoints.map((endpoint: Repo) => {\n      return fetch(endpoint.link);\n    })\n  );\n  const results = await Promise.all(\n    responses.map((res: any) => {\n      return res.json();\n    })\n  );\n  const contributorsByRepo = await Promise.all(\n    results.map((contributors: ContributorsInApi[]) => {\n      return contributors\n        .filter((contributor: ContributorsInApi) => {\n          return !ignoreContributors.includes(contributor.login);\n        })\n        .map((contributor: ContributorsInApi) => {\n          return {\n            key: contributor.id,\n            photo: contributor.avatar_url,\n            githubPage: contributor.html_url,\n            githubName: contributor.login,\n            commits: contributor.contributions\n          };\n        });\n    })\n  );\n  return contributorsByRepo;\n};\n","import { Card, Elevation, H2, H3, H5 } from '@blueprintjs/core';\nimport React, { useEffect, useState } from 'react';\n\nimport { Contributor, Repo } from '../../../features/contributors/ContributorsTypes';\nimport { fetchContributors, fetchRepos } from './ContributorsGithubApi';\n\nconst ContributorsList: React.FC = () => {\n  const [repos, setRepos] = useState<Repo[]>([]);\n  const [contributors, setContributors] = useState<Contributor[][]>([]);\n\n  useEffect(() => {\n    fetchRepos().then((repos: Repo[]) => {\n      fetchContributors(repos).then((contributors: Contributor[][]) => {\n        setRepos(repos);\n        setContributors(contributors);\n      });\n    });\n  }, []);\n\n  const contributorList = contributors.length ? (\n    contributors.map((array: Contributor[], index: number) => {\n      const repo = repos[index];\n      const arrayMapped = array.map((contributor: Contributor) => {\n        return (\n          <div key={contributor.key}>\n            <img src={contributor.photo} alt=\"Contributor\" />\n            <p>\n              <a href={contributor.githubPage} rel=\"noopener noreferrer\" target=\"_blank\">\n                {contributor.githubName}\n              </a>\n            </p>\n            <p>Commits: {contributor.commits}</p>\n          </div>\n        );\n      });\n      return (\n        <Card key={repo.key} className=\"containerPermalink\" elevation={Elevation.ONE}>\n          <div className=\"repoDetailsPermalink\">\n            <H3>{repo.name}</H3>\n            <H5>{repo.description}</H5>\n          </div>\n          <div className=\"inPermalink\">{arrayMapped}</div>\n        </Card>\n      );\n    })\n  ) : (\n    <H2>Loading...</H2>\n  );\n  return <div>{contributorList}</div>;\n};\n\nexport default ContributorsList;\n","import { Card, Elevation } from '@blueprintjs/core';\nimport React from 'react';\n\nimport ContributorsDetails from './subcomponents/ContributorsDetails';\nimport ContributorsList from './subcomponents/ContributorsList';\n\nconst Contributors: React.FC = () => (\n  <div className=\"fullpage\">\n    <Card className=\"fullpage-content\" elevation={Elevation.THREE}>\n      <ContributorsDetails />\n      <ContributorsList />\n    </Card>\n  </div>\n);\n\nexport default Contributors;\n","import { Classes, NonIdealState } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport classNames from 'classnames';\nimport * as React from 'react';\n\ninterface DisabledProps {\n  reason?: string;\n}\n\nconst Disabled: React.FC<DisabledProps> = ({ reason }) => (\n  <div className={classNames('NoPage', Classes.DARK)}>\n    <NonIdealState\n      icon={IconNames.ERROR}\n      title=\"Disabled\"\n      description={`The Source Academy has been disabled${\n        reason ? ` for this reason: ${reason}` : ''\n      }.`}\n    />\n  </div>\n);\n\nexport default Disabled;\n","import { Classes, NonIdealState, Spinner, SpinnerSize } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport classNames from 'classnames';\nimport * as qs from 'query-string';\nimport { useEffect, useState } from 'react';\nimport { RouteComponentProps } from 'react-router';\n\nimport Constants from '../../commons/utils/Constants';\nimport { parseQuery } from '../../commons/utils/QueryHelper';\nimport * as GitHubUtils from '../../features/github/GitHubUtils';\n\n/**\n * The page that the user is redirected to after they have approved the app through GitHub.\n * This page will complete the OAuth workflow by sending the access code the back-end to retrieve the auth-token.\n * The auth-token is then broadcasted back to the main browser page.\n */\nfunction GitHubCallback({ location }: RouteComponentProps<{}>) {\n  const accessCode = parseQuery(location.search).code;\n\n  const [state, setState] = useState<'initial' | 'loading' | 'error'>('initial');\n  useEffect(() => {\n    if (state === 'initial' && Constants.githubClientId && accessCode) {\n      setState('loading');\n      retrieveAuthTokenUpdatePage(accessCode, Constants.githubClientId, () => setState('error'));\n    }\n  }, [accessCode, state]);\n\n  if (!Constants.githubClientId) {\n    return (\n      <Failure title=\"We couldn't authenticate you with GitHub\">\n        Client ID not included with deployment. Please try again or contact the website\n        administrator.\n      </Failure>\n    );\n  }\n\n  if (!accessCode) {\n    return (\n      <Failure title=\"We couldn't authenticate you with GitHub\">\n        Access code not found in callback URL. Please try again or contact the website\n        administrator.\n      </Failure>\n    );\n  }\n\n  return state === 'error' ? (\n    <Failure title=\"We couldn't authenticate you with GitHub\">\n      Connection with server was denied, or incorrect payload received. Please try again or contact\n      the website administrator.\n    </Failure>\n  ) : (\n    <div className={classNames('NoPage', Classes.DARK)}>\n      <NonIdealState description=\"Logging In...\" icon={<Spinner size={SpinnerSize.LARGE} />} />\n    </div>\n  );\n}\n\nasync function retrieveAuthTokenUpdatePage(\n  accessCode: string,\n  clientId: string,\n  onError: () => void\n) {\n  const responseObject = await GitHubUtils.exchangeAccessCode(\n    Constants.githubOAuthProxyUrl,\n    qs.stringify({\n      code: accessCode,\n      clientId: clientId\n    })\n  );\n\n  let response: any;\n\n  try {\n    // This line might throw syntax error if the payload received is in the wrong format\n    response = await responseObject.json();\n\n    if (typeof response.access_token === 'undefined') {\n      throw new Error('Access Token not found in payload');\n    }\n  } catch (err) {\n    onError();\n    return;\n  }\n\n  try {\n    // Send auth token back to the main browser page\n    const broadcastChannel = new BroadcastChannel('GitHubOAuthAccessToken');\n    broadcastChannel.postMessage(response.access_token);\n    window.close();\n  } catch (err) {\n    // This block should not be reached during normal running of code\n    // However, BroadcastChannel does not exist in the test environment\n  }\n}\n\nfunction Failure({ title, children }: { title: string; children: string }) {\n  return (\n    <div className={classNames('NoPage', Classes.DARK)}>\n      <NonIdealState icon={IconNames.ERROR} title={title} description={children} />\n    </div>\n  );\n}\n\nexport default GitHubCallback;\n","import {\n  Button,\n  ButtonGroup,\n  Card,\n  Classes,\n  H4,\n  Icon,\n  NonIdealState,\n  Spinner,\n  SpinnerSize\n} from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useLocation } from 'react-router';\n\nimport { fetchAuth, login } from '../../commons/application/actions/SessionActions';\nimport Constants from '../../commons/utils/Constants';\nimport { parseQuery } from '../../commons/utils/QueryHelper';\n\nconst providers = [...Constants.authProviders.entries()].map(([id, { name }]) => ({\n  id,\n  name\n}));\n\nconst Login: React.FunctionComponent<{}> = () => {\n  const dispatch = useDispatch();\n  const location = useLocation();\n  const { code, provider: providerId } = parseQuery(location.search);\n\n  const handleLogin = React.useCallback(providerId => dispatch(login(providerId)), [dispatch]);\n\n  React.useEffect(() => {\n    if (code) {\n      dispatch(fetchAuth(code, providerId));\n    }\n  }, [code, providerId, dispatch]);\n\n  if (code) {\n    return (\n      <div className={classNames('Login', Classes.DARK)}>\n        <Card className={classNames('login-card', Classes.ELEVATION_4)}>\n          <div className=\"login-body\">\n            <NonIdealState\n              description=\"Logging In...\"\n              icon={<Spinner size={SpinnerSize.LARGE} />}\n            />\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className={classNames('Login', Classes.DARK)}>\n      <Card className={classNames('login-card', Classes.ELEVATION_4)}>\n        <div className=\"login-header\">\n          <H4>\n            <Icon icon={IconNames.LOCK} />\n            LOGIN\n          </H4>\n        </div>\n        <div className=\"login-body\">\n          <ButtonGroup fill={true} vertical={true}>\n            {providers.map(({ id, name }) => (\n              <LoginButton handleClick={handleLogin} name={name} id={id} key={id} />\n            ))}\n          </ButtonGroup>\n        </div>\n      </Card>\n    </div>\n  );\n};\n\nconst LoginButton = ({\n  handleClick,\n  id,\n  name\n}: {\n  handleClick: (id: string) => void;\n  id: string;\n  name: string;\n}) => {\n  return (\n    <Button\n      className={Classes.LARGE}\n      rightIcon={IconNames.LOG_IN}\n      onClick={React.useCallback(() => handleClick(id), [handleClick, id])}\n    >\n      {`Log in with ${name}`}\n    </Button>\n  );\n};\n\nexport default Login;\n","import { ExternalLibraryName } from '../application/types/ExternalTypes';\nimport { Question } from '../assessment/AssessmentTypes';\n\nexport const EDITING_ID = -1;\n\nexport type XmlParseStrTask = {\n  $: XmlParseStrOverview;\n  DEPLOYMENT: XmlParseStrDeployment[];\n  GRADERDEPLOYMENT: XmlParseStrDeployment[];\n  PROBLEMS: Array<{ PROBLEM: XmlParseStrProblem[] }>;\n  READING: string[];\n  TEXT: string[];\n  WEBSUMMARY?: string[];\n};\n\nexport type XmlParseStrDeployment = {\n  $: {\n    interpreter: string;\n  };\n  GLOBAL?: Array<{\n    IDENTIFIER: string[];\n    VALUE: string[];\n  }>;\n  IMPORT?: Array<{\n    $: {\n      name: ExternalLibraryName;\n    };\n    SYMBOL: string[];\n  }>;\n  // deprecated EXTERNAL in DEPLOYMENT and GRADERDEPLOYMENT, use IMPORT instead\n  EXTERNAL?: Array<{\n    $: {\n      name: ExternalLibraryName;\n    };\n    SYMBOL: string[];\n  }>;\n};\n\nexport type XmlParseStrOverview = {\n  coverimage: string;\n  duedate: string;\n  kind: string;\n  number: string;\n  title: string;\n  startdate: string;\n  story: string | null;\n};\n\nexport type XmlParseStrProblem = {\n  $: {\n    type: Question['type'];\n    maxgrade: string;\n    maxxp: string;\n  };\n  DEPLOYMENT?: XmlParseStrDeployment[];\n  GRADERDEPLOYMENT?: XmlParseStrDeployment[];\n  TEXT: string[];\n};\n\ntype PProblem = {\n  SNIPPET: Array<{\n    TEMPLATE: string[];\n    PREPEND: string;\n    SOLUTION: string[];\n    POSTPEND: string;\n    TESTCASES: Array<{\n      PUBLIC?: XmlParseStrTestcase[];\n      PRIVATE?: XmlParseStrTestcase[];\n    }>;\n    GRADER: string[];\n  }>;\n  TEXT: string[];\n};\n\nexport type XmlParseStrPProblem = PProblem & XmlParseStrProblem;\n\ntype CProblem = {\n  CHOICE: XmlParseStrProblemChoice[];\n  SNIPPET: {\n    SOLUTION: string[];\n  };\n};\n\nexport type XmlParseStrCProblem = CProblem & XmlParseStrProblem;\n\nexport type XmlParseStrProblemChoice = {\n  $: {\n    correct: string;\n  };\n  TEXT: string[];\n};\n\nexport type XmlParseStrTestcase = {\n  $: {\n    answer: string;\n    score: string;\n  };\n  _: string;\n};\n","import { Chapter } from 'c-slang/dist/types';\nimport { Builder } from 'xml2js';\n\nimport { ExternalLibraryName } from '../application/types/ExternalTypes';\nimport {\n  Assessment,\n  AssessmentOverview,\n  AssessmentStatuses,\n  AssessmentType,\n  BaseQuestion,\n  emptyLibrary,\n  GradingStatuses,\n  IMCQQuestion,\n  IProgrammingQuestion,\n  Library,\n  MCQChoice,\n  Question,\n  Testcase,\n  TestcaseTypes\n} from '../assessment/AssessmentTypes';\nimport {\n  EDITING_ID,\n  XmlParseStrCProblem,\n  XmlParseStrDeployment,\n  XmlParseStrOverview,\n  XmlParseStrPProblem,\n  XmlParseStrProblem,\n  XmlParseStrProblemChoice,\n  XmlParseStrTask,\n  XmlParseStrTestcase\n} from './XMLParserTypes';\n\nconst capitalizeFirstLetter = (str: string) => {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n};\n\nexport const retrieveLocalAssessment = (): Assessment | null => {\n  const assessment = localStorage.getItem('MissionEditingAssessmentSA');\n  if (assessment) {\n    return JSON.parse(assessment);\n  } else {\n    return null;\n  }\n};\n\nexport const retrieveLocalAssessmentOverview = (): AssessmentOverview | null => {\n  const assessment = localStorage.getItem('MissionEditingOverviewSA');\n  if (assessment) {\n    return JSON.parse(assessment);\n  } else {\n    return null;\n  }\n};\n\nexport const storeLocalAssessment = (assessment: Assessment): void => {\n  localStorage.setItem('MissionEditingAssessmentSA', JSON.stringify(assessment));\n};\n\nexport const storeLocalAssessmentOverview = (overview: AssessmentOverview): void => {\n  localStorage.setItem('MissionEditingOverviewSA', JSON.stringify(overview));\n};\n\nexport const makeEntireAssessment = (result: any): [AssessmentOverview, Assessment] => {\n  const assessmentArr = makeAssessment(result);\n  const overview = makeAssessmentOverview(result, assessmentArr[1]);\n  return [overview, assessmentArr[0]];\n};\n\nconst makeAssessmentOverview = (result: any, maxXpVal: number): AssessmentOverview => {\n  const task: XmlParseStrTask = result.CONTENT.TASK[0];\n  const rawOverview: XmlParseStrOverview = task.$;\n  return {\n    type: capitalizeFirstLetter(rawOverview.kind) as AssessmentType,\n    isManuallyGraded: true, // TODO: This is temporarily hardcoded to true. To be redone when overhauling MissionControl\n    closeAt: rawOverview.duedate,\n    coverImage: rawOverview.coverimage,\n    id: EDITING_ID,\n    maxXp: maxXpVal,\n    number: rawOverview.number || '',\n    openAt: rawOverview.startdate,\n    title: rawOverview.title,\n    reading: task.READING ? task.READING[0] : '',\n    shortSummary: task.WEBSUMMARY ? task.WEBSUMMARY[0] : '',\n    status: AssessmentStatuses.attempting,\n    story: rawOverview.story,\n    xp: 0,\n    gradingStatus: 'none' as GradingStatuses\n  };\n};\n\nconst makeAssessment = (result: any): [Assessment, number] => {\n  const task: XmlParseStrTask = result.CONTENT.TASK[0];\n  const rawOverview: XmlParseStrOverview = task.$;\n  const questionArr = makeQuestions(task);\n  return [\n    {\n      type: capitalizeFirstLetter(rawOverview.kind) as AssessmentType,\n      id: EDITING_ID,\n      globalDeployment: makeLibrary(task.DEPLOYMENT),\n      graderDeployment: makeLibrary(task.GRADERDEPLOYMENT),\n      longSummary: task.TEXT[0],\n      missionPDF: 'google.com',\n      questions: questionArr[0],\n      title: rawOverview.title\n    },\n    questionArr[1]\n  ];\n};\n\nconst altEval = (str: string): any => {\n  // eslint-disable-next-line no-new-func\n  return Function('\"use strict\";return (' + str + ')')();\n};\n\nconst makeLibrary = (deploymentArr: XmlParseStrDeployment[] | undefined): Library => {\n  if (deploymentArr === undefined) {\n    return emptyLibrary();\n  } else {\n    const deployment = deploymentArr[0];\n    const external = deployment.IMPORT || deployment.EXTERNAL;\n    const nameVal = external ? external[0].$.name : 'NONE';\n    const symbolsVal = external ? external[0].SYMBOL || [] : [];\n    const globalsVal = deployment.GLOBAL\n      ? (deployment.GLOBAL.map(x => [x.IDENTIFIER[0], altEval(x.VALUE[0]), x.VALUE[0]]) as Array<\n          [string, any, string]\n        >)\n      : [];\n    return {\n      external: {\n        name: nameVal as ExternalLibraryName,\n        symbols: symbolsVal\n      },\n      globals: globalsVal\n    };\n  }\n};\n\nconst makeQuestions = (task: XmlParseStrTask): [Question[], number] => {\n  let maxXp = 0;\n  const questions: Array<IProgrammingQuestion | IMCQQuestion> = [];\n  task.PROBLEMS[0].PROBLEM.forEach((problem: XmlParseStrProblem, curId: number) => {\n    const localMaxXp = problem.$.maxxp ? parseInt(problem.$.maxxp, 10) : 0;\n    const question: BaseQuestion = {\n      answer: null,\n      content: problem.TEXT[0],\n      id: curId,\n      library: makeLibrary(problem.DEPLOYMENT),\n      graderLibrary: makeLibrary(problem.GRADERDEPLOYMENT),\n      type: problem.$.type,\n      xp: 0,\n      maxXp: localMaxXp\n    };\n    maxXp += localMaxXp;\n    if (question.type === 'programming') {\n      questions.push(makeProgramming(problem as XmlParseStrPProblem, question));\n    }\n    if (question.type === 'mcq') {\n      questions.push(makeMCQ(problem as XmlParseStrCProblem, question));\n    }\n  });\n  return [questions, maxXp];\n};\n\nconst makeMCQ = (problem: XmlParseStrCProblem, question: BaseQuestion): IMCQQuestion => {\n  const choicesVal: MCQChoice[] = [];\n  const solution = problem.SNIPPET ? problem.SNIPPET[0].SOLUTION : undefined;\n  let solutionVal = 0;\n  problem.CHOICE.forEach((choice: XmlParseStrProblemChoice, i: number) => {\n    choicesVal.push({\n      content: choice.TEXT[0],\n      hint: null\n    });\n    solutionVal = choice.$.correct === 'true' ? i : solutionVal;\n  });\n  return {\n    ...question,\n    type: 'mcq',\n    answer: solution ? parseInt(solution[0], 10) : 0,\n    choices: choicesVal,\n    solution: solutionVal\n  };\n};\n\nconst makeProgramming = (\n  problem: XmlParseStrPProblem,\n  question: BaseQuestion\n): IProgrammingQuestion => {\n  const testcases = problem.SNIPPET[0].TESTCASES;\n  const publicTestcases = testcases ? testcases[0].PUBLIC || [] : [];\n  const privateTestcases = testcases ? testcases[0].PRIVATE || [] : [];\n  const prepend = problem.SNIPPET[0].PREPEND;\n  const postpend = problem.SNIPPET[0].POSTPEND;\n  const solution = problem.SNIPPET[0].SOLUTION;\n\n  const result: IProgrammingQuestion = {\n    ...question,\n    autogradingResults: [],\n    prepend: prepend ? (prepend[0] as string).trim() : '',\n    solutionTemplate: problem.SNIPPET[0].TEMPLATE[0].trim() as string,\n    postpend: postpend ? (postpend[0] as string).trim() : '',\n    testcases: publicTestcases.map(testcase => makeTestcase(testcase)),\n    testcasesPrivate: privateTestcases.map(testcase => makeTestcase(testcase)),\n    answer: solution ? (solution[0] as string).trim() : '',\n    type: 'programming'\n  };\n  if (problem.SNIPPET[0].GRADER) {\n    result.graderTemplate = problem.SNIPPET[0].GRADER[0];\n  }\n  return result;\n};\n\nconst makeTestcase = (testcase: XmlParseStrTestcase): Testcase => {\n  return {\n    type: TestcaseTypes.public,\n    answer: testcase.$.answer,\n    score: parseInt(testcase.$.score, 10),\n    program: testcase._\n  };\n};\n\nexport const exportXml = () => {\n  const assessmentStr = localStorage.getItem('MissionEditingAssessmentSA');\n  const overviewStr = localStorage.getItem('MissionEditingOverviewSA');\n  if (assessmentStr && overviewStr) {\n    const assessment: Assessment = JSON.parse(assessmentStr);\n    const overview: AssessmentOverview = JSON.parse(overviewStr);\n    const filename = overview.fileName || overview.title;\n    const builder = new Builder();\n    const xmlTask: XmlParseStrTask = assessmentToXml(assessment, overview);\n    const xml = {\n      CONTENT: {\n        $: {\n          'xmlns:xsi': 'http://www.w3.org/2001/XMLSchema-instance'\n        },\n        TASK: xmlTask\n      }\n    };\n    let xmlStr = builder.buildObject(xml);\n    xmlStr = xmlStr.replace(/(&#xD;)+/g, '');\n    download(filename + '.xml', xmlStr);\n  }\n};\n\nconst download = (filename: string, text: string) => {\n  const element = document.createElement('a');\n  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));\n  element.setAttribute('download', filename);\n\n  element.style.display = 'none';\n  document.body.appendChild(element);\n\n  element.click();\n\n  document.body.removeChild(element);\n};\n\nconst exportLibrary = (library: Library) => {\n  const deployment = {\n    $: {\n      interpreter: Chapter.CALC.toString()\n    },\n    EXTERNAL: {\n      $: {\n        name: library.external.name\n      }\n    }\n  };\n\n  if (library.external.symbols.length !== 0) {\n    /* tslint:disable:no-string-literal */\n    deployment.EXTERNAL['SYMBOL'] = library.external.symbols;\n  }\n  if (library.globals.length !== 0) {\n    /* tslint:disable:no-string-literal */\n    deployment['GLOBAL'] = library.globals.map(x => {\n      return {\n        IDENTIFIER: x[0],\n        VALUE: x[2]\n      };\n    });\n  }\n  return deployment;\n};\n\nexport const assessmentToXml = (\n  assessment: Assessment,\n  overview: AssessmentOverview\n): XmlParseStrTask => {\n  const task: any = {};\n  const rawOverview: XmlParseStrOverview = {\n    coverimage: overview.coverImage,\n    duedate: overview.closeAt,\n    kind: overview.type.toLowerCase(),\n    number: overview.number || '',\n    startdate: overview.openAt,\n    story: overview.story,\n    title: overview.title\n  };\n  task.$ = rawOverview;\n\n  if (overview.reading && overview.reading !== '') {\n    task.READING = overview.reading;\n  }\n\n  task.WEBSUMMARY = overview.shortSummary;\n  task.TEXT = assessment.longSummary;\n  task.PROBLEMS = { PROBLEM: [] };\n\n  task.DEPLOYMENT = exportLibrary(assessment.globalDeployment!);\n\n  task.GRADERDEPLOYMENT = exportLibrary(assessment.graderDeployment!);\n\n  assessment.questions.forEach((question: Question) => {\n    const problem = {\n      $: {\n        type: question.type\n      },\n      SNIPPET: {\n        SOLUTION: question.answer\n      },\n      TEXT: question.content,\n      CHOICE: [] as any[]\n    };\n\n    \n    /* tslint:disable:no-string-literal */\n    problem.$['DEPLOYMENT'] = exportLibrary(question.library);\n\n    /* tslint:disable:no-string-literal */\n    problem.$['GRADERDEPLOYMENT'] = exportLibrary(question.graderLibrary!);\n\n    if (question.maxXp) {\n      /* tslint:disable:no-string-literal */\n      problem.$['maxxp'] = question.maxXp;\n    }\n\n    if (question.type === 'programming') {\n      if (question.graderTemplate) {\n        /* tslint:disable:no-string-literal */\n        problem.SNIPPET['GRADER'] = question.graderTemplate;\n      }\n      const snippet = {\n        ...problem.SNIPPET,\n        TEMPLATE: question.solutionTemplate,\n        PREPEND: question.prepend,\n        POSTPEND: question.postpend,\n        TESTCASES: '' as any\n      };\n\n      if (question.testcases.length || question.testcasesPrivate!.length) {\n        /* tslint:disable:no-string-literal */\n        snippet.TESTCASES = {};\n        if (question.testcases.length) {\n          const publicTests = question.testcases.map(testcase => {\n            return {\n              $: {\n                answer: testcase.answer,\n                score: testcase.score\n              },\n              _: testcase.program\n            };\n          });\n          snippet.TESTCASES['PUBLIC'] = publicTests;\n        }\n\n        if (question.testcasesPrivate && question.testcasesPrivate.length) {\n          const privateTests = question.testcasesPrivate.map(testcase => {\n            return {\n              $: {\n                answer: testcase.answer,\n                score: testcase.score\n              },\n              _: testcase.program\n            };\n          });\n          snippet.TESTCASES['PRIVATE'] = privateTests;\n        }\n      }\n\n      problem.SNIPPET = snippet;\n    }\n\n    if (question.type === 'mcq') {\n      question.choices.forEach((choice: MCQChoice, i: number) => {\n        problem.CHOICE.push({\n          $: {\n            correct: question.solution === i ? 'true' : 'false'\n          },\n          TEXT: choice.content\n        });\n      });\n    }\n\n    task.PROBLEMS.PROBLEM.push(problem);\n  });\n\n  return task;\n};\n","import {\n  Button,\n  Card,\n  Classes,\n  Dialog,\n  Elevation,\n  H3,\n  H4,\n  H6,\n  Icon,\n  Intent,\n  MenuItem,\n  Text\n} from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { ItemRenderer, Select } from '@blueprintjs/select';\nimport * as React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport Textarea from 'react-textarea-autosize';\n\nimport defaultCoverImage from '../../assets/default_cover_image.jpg';\nimport { AssessmentOverview, AssessmentType } from '../assessment/AssessmentTypes';\nimport ControlButton from '../ControlButton';\nimport Markdown from '../Markdown';\nimport Constants from '../utils/Constants';\nimport { getPrettyDate } from '../utils/DateHelper';\nimport { exportXml, storeLocalAssessmentOverview } from '../XMLParser/XMLParserHelper';\n\ntype EditingOverviewCardProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  updateEditingOverview: (overview: AssessmentOverview) => void;\n};\n\ntype StateProps = {\n  listingPath: string;\n  overview: AssessmentOverview;\n  assessmentTypes: AssessmentType[];\n};\n\ntype State = {\n  editingOverviewField: string;\n  fieldValue: any;\n  showOptionsOverlay: boolean;\n};\n\nexport class EditingOverviewCard extends React.Component<EditingOverviewCardProps, State> {\n  public constructor(props: EditingOverviewCardProps) {\n    super(props);\n    this.state = {\n      editingOverviewField: '',\n      fieldValue: '',\n      showOptionsOverlay: false\n    };\n  }\n\n  public render() {\n    return (\n      <div>\n        {this.optionsOverlay()}\n        {this.makeEditingOverviewCard(this.props.overview)}\n      </div>\n    );\n  }\n\n  private saveEditOverview = (field: keyof AssessmentOverview) => (e: any) => {\n    const overview = {\n      ...this.props.overview,\n      [field]: this.state.fieldValue\n    };\n    this.setState({\n      editingOverviewField: '',\n      fieldValue: ''\n    });\n    storeLocalAssessmentOverview(overview);\n    this.props.updateEditingOverview(overview);\n  };\n\n  private handleEditOverview = () => (e: any) => {\n    this.setState({\n      fieldValue: e.target.value\n    });\n  };\n\n  private toggleEditField = (field: keyof AssessmentOverview) => (e: any) => {\n    if (this.state.editingOverviewField !== field) {\n      this.setState({\n        editingOverviewField: field,\n        fieldValue: this.props.overview[field]\n      });\n    }\n  };\n\n  private toggleOptionsOverlay = () => {\n    this.setState({\n      showOptionsOverlay: !this.state.showOptionsOverlay\n    });\n  };\n\n  private handleExportXml = (e: any) => {\n    exportXml();\n  };\n\n  private makeEditingOverviewTextarea = (field: keyof AssessmentOverview) => (\n    <Textarea\n      autoFocus={true}\n      className={'editing-textarea'}\n      onChange={this.handleEditOverview()}\n      onBlur={this.saveEditOverview(field)}\n      value={this.state.fieldValue}\n    />\n  );\n\n  private makeEditingOverviewCard = (overview: AssessmentOverview) => (\n    <div>\n      <Card className=\"row listing\" elevation={Elevation.ONE}>\n        <div className=\"col-xs-3 listing-picture\" onClick={this.toggleEditField('coverImage')}>\n          {this.state.editingOverviewField === 'coverImage' ? (\n            this.makeEditingOverviewTextarea('coverImage')\n          ) : (\n            <img\n              alt=\"Assessment cover\"\n              className={`cover-image-${overview.status}`}\n              src={overview.coverImage ? overview.coverImage : defaultCoverImage}\n            />\n          )}\n        </div>\n\n        <div className=\"col-xs-9 listing-text\">\n          {this.makeEditingOverviewCardTitle(overview, overview.title)}\n          <div className=\"row listing-xp\">\n            <H6> {`Max XP: ${overview.maxXp}`} </H6>\n          </div>\n          <div className=\"row listing-description\" onClick={this.toggleEditField('shortSummary')}>\n            {this.state.editingOverviewField === 'shortSummary' ? (\n              this.makeEditingOverviewTextarea('shortSummary')\n            ) : (\n              <Markdown content={createPlaceholder(overview.shortSummary)} />\n            )}\n          </div>\n          <div className=\"listing-controls\">\n            <Text className=\"listing-due-date\">\n              <Icon className=\"listing-due-icon\" iconSize={12} icon={IconNames.TIME} />\n              <div className=\"date-container\">Opens at:&nbsp;</div>\n              <div className=\"date-container\" onClick={this.toggleEditField('openAt')}>\n                {this.state.editingOverviewField === 'openAt'\n                  ? this.makeEditingOverviewTextarea('openAt')\n                  : `${getPrettyDate(overview.openAt)}`}\n              </div>\n\n              <div className=\"date-container\">&nbsp;&nbsp;Due:&nbsp;</div>\n              <div className=\"date-container\" onClick={this.toggleEditField('closeAt')}>\n                {this.state.editingOverviewField === 'closeAt'\n                  ? this.makeEditingOverviewTextarea('closeAt')\n                  : `${getPrettyDate(overview.closeAt)}`}\n              </div>\n            </Text>\n            <Button icon={IconNames.WRENCH} minimal={true} onClick={this.toggleOptionsOverlay}>\n              Other Options\n            </Button>\n            <NavLink\n              to={`${this.props.listingPath}/${overview.id.toString()}/${\n                Constants.defaultQuestionId\n              }`}\n            >\n              <ControlButton label=\"Edit mission\" icon={IconNames.EDIT} />\n            </NavLink>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n\n  private makeEditingOverviewCardTitle = (overview: AssessmentOverview, title: string) => (\n    <div className=\"row listing-title\">\n      <Text ellipsize={true} className={'col-xs-10'}>\n        <H4 onClick={this.toggleEditField('title')}>\n          {this.state.editingOverviewField === 'title'\n            ? this.makeEditingOverviewTextarea('title')\n            : createPlaceholder(title)}\n        </H4>\n      </Text>\n      <div className=\"col-xs-2\">{this.makeExportButton(overview)}</div>\n    </div>\n  );\n\n  private makeExportButton = (overview: AssessmentOverview) => (\n    <Button\n      icon={IconNames.EXPORT}\n      intent={Intent.DANGER}\n      minimal={true}\n      onClick={this.handleExportXml}\n    >\n      Save as XML\n    </Button>\n  );\n\n  private saveCategory = (i: AssessmentType, e: any) => {\n    const overview = {\n      ...this.props.overview,\n      category: i\n    };\n    storeLocalAssessmentOverview(overview);\n    this.props.updateEditingOverview(overview);\n  };\n\n  private optionsOverlay = () => (\n    <Dialog\n      canOutsideClickClose={false}\n      className=\"assessment-reset\"\n      icon={IconNames.WRENCH}\n      isCloseButtonShown={true}\n      isOpen={this.state.showOptionsOverlay}\n      onClose={this.toggleOptionsOverlay}\n      title=\"Other options\"\n    >\n      <div className={Classes.DIALOG_BODY}>\n        <H3>Assessment Type</H3>\n        {this.assessmentTypeSelect(this.props.overview.type, this.saveCategory)}\n        <H3>Number</H3>\n        <div onClick={this.toggleEditField('number')}>\n          {this.state.editingOverviewField === 'number'\n            ? this.makeEditingOverviewTextarea('number')\n            : createPlaceholder(this.props.overview.number || '')}\n        </div>\n        <H3>Story</H3>\n        <div onClick={this.toggleEditField('story')}>\n          {this.state.editingOverviewField === 'story'\n            ? this.makeEditingOverviewTextarea('story')\n            : createPlaceholder(this.props.overview.story || '')}\n        </div>\n        <br />\n        <H3>Filename</H3>\n        <div onClick={this.toggleEditField('fileName')}>\n          {this.state.editingOverviewField === 'fileName'\n            ? this.makeEditingOverviewTextarea('fileName')\n            : createPlaceholder(this.props.overview.fileName || '')}\n        </div>\n      </div>\n    </Dialog>\n  );\n\n  private assessmentTypeSelect = (\n    assessmentType: AssessmentType,\n    handleSelect = (i: AssessmentType, e?: React.SyntheticEvent<HTMLElement>) => {}\n  ) => (\n    <AssessmentTypeSelectComponent\n      className={Classes.MINIMAL}\n      items={this.props.assessmentTypes}\n      onItemSelect={handleSelect}\n      itemRenderer={assessmentTypeRenderer}\n      filterable={false}\n    >\n      <Button\n        className={Classes.MINIMAL}\n        text={assessmentType}\n        rightIcon={IconNames.DOUBLE_CARET_VERTICAL}\n      />\n    </AssessmentTypeSelectComponent>\n  );\n}\n\nconst createPlaceholder = (str: string): string => {\n  if (str.match('^(\\n| )*$')) {\n    return 'Enter Value Here (If Applicable)';\n  } else {\n    return str;\n  }\n};\n\nconst AssessmentTypeSelectComponent = Select.ofType<AssessmentType>();\n\nconst assessmentTypeRenderer: ItemRenderer<AssessmentType> = (\n  assessmentType,\n  { handleClick, modifiers, query }\n) => <MenuItem active={false} key={assessmentType} onClick={handleClick} text={assessmentType} />;\n","import { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport React from 'react';\n\nimport ControlButton from '../ControlButton';\n\ntype ControlBarToggleEditModeButtonProps = {\n  toggleEditMode?(): void;\n  editingMode?: string;\n};\n\nexport const ControlBarToggleEditModeButton: React.FC<ControlBarToggleEditModeButtonProps> = ({\n  toggleEditMode,\n  editingMode\n}) => {\n  const editMode = editingMode === 'question' ? 'Global' : 'Question Specific';\n  return (\n    <Tooltip2 content={'Switch to ' + editMode + ' Editing Mode'}>\n      <ControlButton\n        label={editMode + ' Editing Mode'}\n        icon={IconNames.REFRESH}\n        onClick={toggleEditMode}\n      />\n    </Tooltip2>\n  );\n};\n","export const getValueFromPath = (path: Array<string | number>, obj: any): any => {\n  for (const next of path) {\n    obj = obj[next];\n  }\n  return obj;\n};\n\nexport const assignToPath = (path: Array<string | number>, value: any, obj: any): void => {\n  let i = 0;\n  for (i = 0; i < path.length - 1; i++) {\n    obj = obj[path[i]];\n  }\n  obj[path[i]] = value;\n};\n\nexport const limitNumberRange =\n  (min: number | null = 0, max: number | null = null) =>\n  (value: number | string): number => {\n    value = typeof value === 'string' ? parseInt(value, 10) : value;\n    let result;\n    if (min !== null && value < min) {\n      result = min;\n    } else if (max !== null && value > max) {\n      result = max;\n    } else {\n      result = value;\n    }\n    return result;\n  };\n","import React, { useState } from 'react';\nimport Textarea from 'react-textarea-autosize';\n\nimport { Assessment } from '../assessment/AssessmentTypes';\nimport Markdown from '../Markdown';\nimport { assignToPath, getValueFromPath } from './EditingWorkspaceSideContentHelper';\n\ntype TextAreaContentProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  processResults?: (newVal: string | number) => string | number;\n  updateAssessment: (assessment: Assessment) => void;\n};\n\ntype StateProps = {\n  assessment: Assessment;\n  isNumber?: boolean;\n  path: Array<string | number>;\n  useRawValue?: boolean;\n};\n\nexport const TextAreaContent: React.FC<TextAreaContentProps> = props => {\n  const isNumberVal = props.isNumber || false;\n\n  const [isEditing, setIsEditing] = useState(false);\n  const [isNumber] = useState(isNumberVal);\n  const [fieldValue, setFieldValue] = useState('');\n  const [useRawValue] = useState(props.useRawValue || isNumberVal);\n\n  const saveEditAssessment = (e: any) => {\n    let parsedFieldValue: number | string;\n    if (isNumber) {\n      parsedFieldValue = parseInt(fieldValue, 10);\n      if (isNaN(parsedFieldValue)) {\n        parsedFieldValue = getValueFromPath(props.path, props.assessment);\n      }\n    } else {\n      parsedFieldValue = fieldValue;\n    }\n    const originalVal = getValueFromPath(props.path, props.assessment);\n    if (props.processResults) {\n      parsedFieldValue = props.processResults(parsedFieldValue);\n    }\n    if (parsedFieldValue !== originalVal) {\n      const assessmentVal = props.assessment;\n      assignToPath(props.path, parsedFieldValue, assessmentVal);\n      props.updateAssessment(assessmentVal);\n    }\n\n    setIsEditing(false);\n  };\n\n  const handleEditAssessment = (e: any) => {\n    setFieldValue(e.target.value);\n  };\n\n  const makeEditingTextarea = () => (\n    <Textarea\n      autoFocus={true}\n      className={'editing-textarea'}\n      onChange={handleEditAssessment}\n      onBlur={saveEditAssessment}\n      value={fieldValue}\n    />\n  );\n\n  const toggleEditField = () => (e: any) => {\n    if (!isEditing) {\n      const fieldVal = getValueFromPath(props.path, props.assessment) || '';\n      setIsEditing(true);\n      setFieldValue(typeof fieldVal === 'string' ? fieldVal : fieldVal.toString());\n    }\n  };\n\n  let display;\n  if (isEditing) {\n    display = makeEditingTextarea();\n  } else {\n    const filler = 'Please enter value (if applicable)';\n    let value = getValueFromPath(props.path, props.assessment);\n    if (!props.isNumber) {\n      value = value || '';\n      value = value.match(/^\\s*$/) ? filler : value;\n    }\n    if (useRawValue) {\n      display = value;\n    } else {\n      display = <Markdown content={value} />;\n    }\n  }\n  return <div onClick={toggleEditField()}>{display}</div>;\n};\n\nexport default TextAreaContent;\n","import { Card, Elevation, H6 } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport * as React from 'react';\n\nimport {\n  Assessment,\n  IProgrammingQuestion,\n  Testcase,\n  testcaseTemplate\n} from '../assessment/AssessmentTypes';\nimport ControlButton from '../ControlButton';\nimport { getValueFromPath } from './EditingWorkspaceSideContentHelper';\nimport TextAreaContent from './EditingWorkspaceSideContentTextAreaContent';\n\ntype AutograderProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleTestcaseEval: (testcase: Testcase) => void;\n  updateAssessment: (assessment: Assessment) => void;\n};\n\ntype StateProps = {\n  assessment: Assessment;\n  questionId: number;\n};\n\nexport const AutograderTab: React.FC<AutograderProps> = props => {\n  const addTestcase = (testcases: Testcase[]) => () => {\n    testcases.push(testcaseTemplate());\n    props.updateAssessment(props.assessment);\n  };\n\n  const removeTestcase = (testcases: Testcase[], id: number) => {\n    testcases.splice(id, 1);\n    props.updateAssessment(props.assessment);\n  };\n\n  const autograderCard = (testcasePath: Array<string | number>, index: number) => {\n    const testcases = getValueFromPath(testcasePath, props.assessment) as Testcase[];\n    const testcase = testcases[index];\n\n    return (\n      <div>\n        <Card className=\"row listing\" elevation={Elevation.ONE}>\n          <div className=\"col-xs-9 listing-text\">\n            {/* {makeOverviewCardTitle(overview, index, setBetchaAssessment, renderGradingStatus)} */}\n            <div className=\"row listing-program\">\n              <H6>\n                Test Program:\n                <TextAreaContent\n                  assessment={props.assessment}\n                  path={testcasePath.concat([index, 'program'])}\n                  useRawValue={true}\n                  updateAssessment={props.updateAssessment}\n                />\n              </H6>\n            </div>\n            <div className=\"row listing-expected\">\n              <H6>\n                Score:\n                <TextAreaContent\n                  assessment={props.assessment}\n                  isNumber={true}\n                  path={testcasePath.concat([index, 'score'])}\n                  updateAssessment={props.updateAssessment}\n                />\n              </H6>\n            </div>\n            <div className=\"row listing-expected\">\n              <H6>\n                Expected Answer:\n                <TextAreaContent\n                  assessment={props.assessment}\n                  path={testcasePath.concat([index, 'answer'])}\n                  useRawValue={true}\n                  updateAssessment={props.updateAssessment}\n                />\n              </H6>\n            </div>\n            <div className=\"listing-controls\">\n              <div>\n                <ControlButton\n                  label=\"Test\"\n                  icon={IconNames.PLAY}\n                  onClick={() => props.handleTestcaseEval(testcase)}\n                />\n                <ControlButton\n                  label=\"Delete\"\n                  icon={IconNames.DELETE}\n                  onClick={() => removeTestcase(testcases, index)}\n                />\n              </div>\n            </div>\n          </div>\n        </Card>\n      </div>\n    );\n  };\n\n  const question = props.assessment.questions[props.questionId] as IProgrammingQuestion;\n  const publicTestPath = ['questions', props.questionId, 'testcases'];\n\n  const publicTestcases = question.testcases.map((testcase, index) => (\n    <div key={index}>{autograderCard(publicTestPath, index)}</div>\n  ));\n\n  const privateTestPath = ['questions', props.questionId, 'testcasesPrivate'];\n  const privateTestcases = question.testcasesPrivate!.map((testcase, index) => (\n    <div key={index}>{autograderCard(privateTestPath, index)}</div>\n  ));\n\n  return (\n    <div>\n      Public Testcases\n      {publicTestcases}\n      <ControlButton\n        label=\"New public testcase\"\n        icon={IconNames.PLUS}\n        onClick={addTestcase(question.testcases)}\n      />\n      <br />\n      <br />\n      Private Testcases\n      {privateTestcases}\n      <ControlButton\n        label=\"New private testcase\"\n        icon={IconNames.PLUS}\n        onClick={addTestcase(question.testcasesPrivate!)}\n      />\n    </div>\n  );\n};\n","import { Button, Classes, Divider, MenuItem, Switch } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { ItemRenderer, Select } from '@blueprintjs/select';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport * as React from 'react';\n\nimport { SALanguage, sourceLanguages, styliseSublanguage } from '../application/ApplicationTypes';\nimport {\n  External,\n  externalLibraries,\n  ExternalLibraryName\n} from '../application/types/ExternalTypes';\nimport { Assessment, emptyLibrary, Library } from '../assessment/AssessmentTypes';\nimport ControlButton from '../ControlButton';\nimport { assignToPath, getValueFromPath } from './EditingWorkspaceSideContentHelper';\nimport TextAreaContent from './EditingWorkspaceSideContentTextAreaContent';\n\ntype DeploymentTabProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  updateAssessment: (assessment: Assessment) => void;\n  handleRefreshLibrary: (library: Library) => void;\n};\n\ntype StateProps = {\n  assessment: Assessment;\n  label: string;\n  pathToLibrary: Array<string | number>;\n  pathToCopy?: Array<string | number>;\n  isOptionalDeployment: boolean;\n};\n\nclass DeploymentTab extends React.Component<DeploymentTabProps, {}> {\n  public render() {\n    if (!this.props.isOptionalDeployment) {\n      return (\n        <div>\n          {this.props.label + ' Deployment'}\n          <br />\n          {this.deploymentTab()}\n        </div>\n      );\n    } else {\n      return (\n        <div>\n          <Switch\n            checked={!this.isEmptyLibrary()}\n            label={'Enable ' + this.props.label + ' Deployment'}\n            onChange={this.handleSwitchDeployment}\n          />\n          {this.isEmptyLibrary() ? null : this.deploymentTab()}\n        </div>\n      );\n    }\n  }\n\n  private deploymentTab = () => {\n    const deploymentPath = this.props.pathToLibrary;\n    const deployment = getValueFromPath(deploymentPath, this.props.assessment) as Library;\n    // const deploymentDisp = this.props.isGlobalDeployment ? 'Global Deployment' : 'Local Deployment';\n    const symbols = deployment.external.symbols.map((symbol, i) => (\n      <tr key={i}>\n        <td>{this.textareaContent(deploymentPath.concat(['external', 'symbols', i]))}</td>\n        <td style={{ width: '100px' }}>\n          <ControlButton\n            label=\"Delete\"\n            icon={IconNames.MINUS}\n            onClick={this.handleSymbolDelete(i)}\n          />\n        </td>\n      </tr>\n    ));\n\n    const globals = deployment.globals.map((symbol, i) => (\n      <tr key={i}>\n        <td style={{ width: '170px' }}>\n          {this.textareaContent(deploymentPath.concat(['globals', i, 0]))}\n        </td>\n        <td>{this.globalValueTextareaContent(i)}</td>\n        <td style={{ width: '90px' }}>\n          <ControlButton\n            label=\"Delete\"\n            icon={IconNames.MINUS}\n            onClick={this.handleGlobalDelete(i)}\n          />\n        </td>\n      </tr>\n    ));\n\n    const resetLibrary = (\n      <ControlButton\n        label=\"Use this Library\"\n        icon={IconNames.REFRESH}\n        onClick={() => this.props.handleRefreshLibrary(deployment)}\n      />\n    );\n\n    const symbolsFragment = (\n      <React.Fragment>\n        External Library:\n        <br />\n        {externalSelect(deployment.external.name, this.handleExternalSelect!)}\n        <Divider />\n        <div>Symbols:</div>\n        <br />\n        <table style={{ width: '100%' }}>\n          <tbody>{symbols}</tbody>\n        </table>\n        <ControlButton label=\"New Symbol\" icon={IconNames.PLUS} onClick={this.handleNewSymbol} />\n      </React.Fragment>\n    );\n\n    const globalsFragment = (\n      <React.Fragment>\n        <div>Globals:</div>\n        <br />\n        <table style={{ width: '100%', borderSpacing: '5px' }}>\n          <tbody>{globals}</tbody>\n        </table>\n        <ControlButton label=\"New Global\" icon={IconNames.PLUS} onClick={this.handleNewGlobal} />\n      </React.Fragment>\n    );\n\n    return (\n      <div>\n        {/* {deploymentDisp}\n        <br /> */}\n        <Divider />\n        {resetLibrary}\n        <Divider />\n        Interpreter:\n        <br />\n        {chapterSelect(deployment.variant, this.handleChapterSelect)}\n        <Divider />\n        {symbolsFragment}\n        <Divider />\n        {globalsFragment}\n      </div>\n    );\n  };\n\n  private textareaContent = (path: Array<string | number>) => {\n    return (\n      <TextAreaContent\n        assessment={this.props.assessment}\n        path={path}\n        processResults={removeSpaces}\n        updateAssessment={this.props.updateAssessment}\n        useRawValue={true}\n      />\n    );\n  };\n\n  private globalValueTextareaContent = (i: number) => {\n    const pathVal = this.props.pathToLibrary.concat(['globals', i, 2]);\n    return (\n      <TextAreaContent\n        assessment={this.props.assessment}\n        path={pathVal}\n        updateAssessment={this.handleGlobalValueUpdate(i)}\n        useRawValue={true}\n      />\n    );\n  };\n\n  private handleGlobalValueUpdate = (i: number) => (assessment: Assessment) => {\n    const deployment = getValueFromPath(this.props.pathToLibrary, this.props.assessment) as Library;\n    const global = deployment.globals[i];\n    try {\n      global[1] = altEval(global[2]!);\n      this.props.updateAssessment(assessment);\n    } catch (e) {\n      global[2] = '\"Invalid Expression\"';\n    }\n  };\n\n  private handleSymbolDelete = (index: number) => () => {\n    const assessment = this.props.assessment;\n    const deployment = getValueFromPath(this.props.pathToLibrary, assessment) as Library;\n    const symbols = deployment.external.symbols;\n    symbols.splice(index, 1);\n    this.props.updateAssessment(assessment);\n  };\n\n  private handleNewSymbol = () => {\n    const assessment = this.props.assessment;\n    const deployment = getValueFromPath(this.props.pathToLibrary, assessment) as Library;\n    const symbols = deployment.external.symbols;\n    symbols.push('new_symbol');\n    this.props.updateAssessment(assessment);\n  };\n\n  private handleGlobalDelete = (index: number) => () => {\n    const assessment = this.props.assessment;\n    const deployment = getValueFromPath(this.props.pathToLibrary, assessment) as Library;\n    deployment.globals.splice(index, 1);\n    this.props.updateAssessment(assessment);\n  };\n\n  private handleNewGlobal = () => {\n    const assessment = this.props.assessment;\n    const deployment = getValueFromPath(this.props.pathToLibrary, assessment) as Library;\n    deployment.globals.push(['new_global', null, 'null']);\n    this.props.updateAssessment(assessment);\n  };\n\n  private handleChapterSelect = (i: SALanguage, _e?: React.SyntheticEvent<HTMLElement>) => {\n    const assessment = this.props.assessment;\n    this.props.updateAssessment(assessment);\n  };\n\n  private handleExternalSelect = (i: External, _e?: React.SyntheticEvent<HTMLElement>) => {\n    const assessment = this.props.assessment;\n    const deployment = getValueFromPath(this.props.pathToLibrary, assessment) as Library;\n    deployment.external.name = i.name;\n    deployment.external.symbols = JSON.parse(JSON.stringify(externalLibraries.get(i.name)!));\n    this.props.updateAssessment(assessment);\n  };\n\n  private handleSwitchDeployment = () => {\n    const assessment = this.props.assessment;\n    if (this.isEmptyLibrary()) {\n      let library = getValueFromPath(\n        this.props.pathToCopy || ['globalDeployment'],\n        assessment\n      ) as Library;\n      library = JSON.parse(JSON.stringify(library));\n      assignToPath(this.props.pathToLibrary, library, assessment);\n    } else {\n      assignToPath(this.props.pathToLibrary, emptyLibrary(), assessment);\n    }\n    this.props.updateAssessment(assessment);\n  };\n\n  private isEmptyLibrary = (path: Array<string | number> = this.props.pathToLibrary) => {\n    return getValueFromPath(path.concat(['chapter']), this.props.assessment) === -1;\n  };\n}\n\nconst removeSpaces = (str: string | number) => {\n  return typeof str === 'string' ? str.replace(/\\s+/g, '') : str;\n};\n\nconst altEval = (str: string): any => {\n  // eslint-disable-next-line no-new-func\n  return Function('\"use strict\";return (' + str + ')')();\n};\n\nconst chapterSelect = (\n  variant: Variant = Variant.DEFAULT,\n  handleSelect = (i: SALanguage, e?: React.SyntheticEvent<HTMLElement>) => {}\n) => (\n  <ChapterSelectComponent\n    className={Classes.MINIMAL}\n    items={sourceLanguages}\n    onItemSelect={handleSelect}\n    itemRenderer={chapterRenderer}\n    filterable={false}\n  >\n    <Button\n      className={Classes.MINIMAL}\n      text={styliseSublanguage(Chapter.CALC, variant)}\n      rightIcon={IconNames.DOUBLE_CARET_VERTICAL}\n    />\n  </ChapterSelectComponent>\n);\n\nconst ChapterSelectComponent = Select.ofType<SALanguage>();\n\nconst chapterRenderer: ItemRenderer<SALanguage> = (chap, { handleClick, modifiers, query }) => (\n  <MenuItem active={false} key={chap.displayName} onClick={handleClick} text={chap.displayName} />\n);\n\nconst iExternals = Array.from(externalLibraries.entries()).map((entry, index) => ({\n  name: entry[0] as ExternalLibraryName,\n  key: index,\n  symbols: entry[1]\n}));\n\nconst externalSelect = (\n  currentExternal: string,\n  handleSelect: (i: External, e?: React.SyntheticEvent<HTMLElement>) => void\n) => (\n  <ExternalSelectComponent\n    className={Classes.MINIMAL}\n    items={iExternals}\n    onItemSelect={handleSelect}\n    itemRenderer={externalRenderer}\n    filterable={false}\n  >\n    <Button\n      className={Classes.MINIMAL}\n      text={currentExternal}\n      rightIcon={IconNames.DOUBLE_CARET_VERTICAL}\n    />\n  </ExternalSelectComponent>\n);\n\nconst ExternalSelectComponent = Select.ofType<External>();\n\nconst externalRenderer: ItemRenderer<External> = (external, { handleClick, modifiers, query }) => (\n  <MenuItem active={false} key={external.key} onClick={handleClick} text={external.name} />\n);\n\nexport default DeploymentTab;\n","import * as React from 'react';\n\nimport { Assessment } from '../assessment/AssessmentTypes';\nimport { limitNumberRange } from './EditingWorkspaceSideContentHelper';\nimport TextAreaContent from './EditingWorkspaceSideContentTextAreaContent';\n\ntype GradingTabProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  updateAssessment: (assessment: Assessment) => void;\n};\n\ntype StateProps = {\n  assessment: Assessment;\n  path: Array<string | number>;\n};\n\nconst GradingTab: React.FC<GradingTabProps> = props => {\n  const textareaContent = (path: Array<string | number>) => {\n    return (\n      <TextAreaContent\n        assessment={props.assessment}\n        isNumber={true}\n        path={path}\n        processResults={limitNumberRange(0)}\n        updateAssessment={props.updateAssessment}\n      />\n    );\n  };\n\n  return (\n    <div>\n      Max Xp:\n      {textareaContent(props.path.concat(['maxXp']))}\n    </div>\n  );\n};\n\nexport default GradingTab;\n","import { Button, ButtonGroup, Classes, Dialog, Intent } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport React, { useState } from 'react';\n\nimport { Assessment, mcqTemplate, programmingTemplate } from '../assessment/AssessmentTypes';\nimport ControlButton from '../ControlButton';\nimport Markdown from '../Markdown';\nimport { history } from '../utils/HistoryHelper';\n\ntype ManageQuestionTabProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  updateAssessment: (assessment: Assessment) => void;\n};\n\ntype StateProps = {\n  assessment: Assessment;\n  hasUnsavedChanges: boolean;\n  questionId: number;\n};\n\nconst ManageQuestionTab: React.FC<ManageQuestionTabProps> = props => {\n  const [showSaveOverlay, setShowSaveOverlay] = useState(false);\n  const [modifyAssessment, setModifyAssessment] = useState<VoidFunction>(() => {});\n\n  const manageQuestionTab = (index: number) => {\n    return (\n      <div>\n        <ControlButton\n          label=\"Clone\"\n          icon={IconNames.DOCUMENT}\n          onClick={confirmSave(\n            makeQuestion(() => deepCopy(props.assessment.questions[index]), index)\n          )}\n        />\n        <ControlButton\n          label=\"Delete\"\n          icon={IconNames.REMOVE}\n          onClick={confirmSave(deleteQuestion(index))}\n        />\n        <ControlButton\n          label=\"Shift Up\"\n          icon={IconNames.CARET_UP}\n          onClick={confirmSave(shiftQuestion(-1, index))}\n          isDisabled={index === 0}\n        />\n        <ControlButton\n          label=\"Shift Down\"\n          icon={IconNames.CARET_DOWN}\n          onClick={confirmSave(shiftQuestion(1, index))}\n          isDisabled={index >= props.assessment.questions.length - 1}\n        />\n        <br />\n        <ControlButton\n          label=\"Insert Programming Question\"\n          icon={IconNames.FONT}\n          onClick={confirmSave(makeQuestion(programmingTemplate, index))}\n        />\n        <ControlButton\n          label=\"Insert MCQ Question\"\n          icon={IconNames.CONFIRM}\n          onClick={confirmSave(makeQuestion(mcqTemplate, index))}\n        />\n      </div>\n    );\n  };\n\n  const shiftQuestion = (dir: number, index: number) => () => {\n    const assessment = props.assessment;\n    const newIndex = index + dir;\n    if (newIndex >= 0 && newIndex < assessment.questions.length) {\n      const question = assessment.questions[index];\n      const questions = assessment.questions;\n      questions[index] = questions[newIndex];\n      questions[newIndex] = question;\n      assessment.questions = questions;\n      props.updateAssessment(assessment);\n      history.push('/mission-control/-1/' + newIndex.toString());\n    }\n  };\n\n  const makeQuestion = (template: () => any, index: number) => () => {\n    const assessment = props.assessment;\n    index = index + 1;\n    const questions = assessment.questions;\n    questions.splice(index, 0, template());\n    assessment.questions = questions;\n    props.updateAssessment(assessment);\n    history.push('/mission-control/-1/' + index.toString());\n  };\n\n  const deleteQuestion = (index: number) => () => {\n    const assessment = props.assessment;\n    let questions = assessment.questions;\n    if (questions.length > 1) {\n      questions = questions.slice(0, index).concat(questions.slice(index + 1));\n    }\n    assessment.questions = questions;\n    props.updateAssessment(assessment);\n  };\n\n  const confirmSave = (modifyAssessment: () => void) => () => {\n    if (props.hasUnsavedChanges) {\n      setShowSaveOverlay(true);\n      setModifyAssessment(modifyAssessment);\n    } else {\n      modifyAssessment();\n    }\n  };\n\n  /**\n   * Asks to save work.\n   */\n  const confirmSaveOverlay = (\n    <Dialog\n      className=\"assessment-reset\"\n      icon={IconNames.ERROR}\n      isCloseButtonShown={true}\n      isOpen={showSaveOverlay}\n      title=\"Confirmation: Save unsaved changes?\"\n    >\n      <div className={Classes.DIALOG_BODY}>\n        <Markdown content=\"Are you sure you want to save over your unsaved changes?\" />\n      </div>\n      <div className={Classes.DIALOG_FOOTER}>\n        <ButtonGroup>\n          <ControlButton\n            label=\"Cancel\"\n            onClick={() => setShowSaveOverlay(false)}\n            options={{ minimal: false }}\n          />\n          <ControlButton\n            label=\"Confirm\"\n            onClick={() => {\n              modifyAssessment();\n              setShowSaveOverlay(false);\n            }}\n            options={{ minimal: false, intent: Intent.DANGER }}\n          />\n        </ButtonGroup>\n      </div>\n    </Dialog>\n  );\n\n  return (\n    <div>\n      {confirmSaveOverlay}\n      {props.assessment.questions.map((q, index) => (\n        <div key={index}>\n          Question {index + 1}\n          <br />\n          <Button className=\"mcq-option col-xs-12\" minimal={true}>\n            <Markdown\n              content={q.content.length > 200 ? q.content.substring(0, 300) + '...' : q.content}\n            />\n          </Button>\n          {manageQuestionTab(index)}\n          <br />\n          <br />\n        </div>\n      ))}\n    </div>\n  );\n};\n\nconst deepCopy = (arr: any) => {\n  return JSON.parse(JSON.stringify(arr));\n};\n\nexport default ManageQuestionTab;\n","import { Card } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport * as React from 'react';\n\nimport { Assessment, IMCQQuestion } from '../assessment/AssessmentTypes';\nimport ControlButton from '../ControlButton';\nimport { limitNumberRange } from './EditingWorkspaceSideContentHelper';\nimport TextAreaContent from './EditingWorkspaceSideContentTextAreaContent';\n\ntype MCQQuestionTemplateTabProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  updateAssessment: (assessment: Assessment) => void;\n};\n\ntype StateProps = {\n  assessment: Assessment;\n  questionId: number;\n};\n\nconst MCQQuestionTemplateTab: React.FC<MCQQuestionTemplateTabProps> = props => {\n  const addOption = () => {\n    const { assessment, questionId } = props;\n    const question = assessment!.questions[questionId] as IMCQQuestion;\n    const choices = question.choices.concat([\n      {\n        content: 'A',\n        hint: null\n      }\n    ]);\n    question.choices = choices;\n    assessment!.questions[questionId] = question;\n    props.updateAssessment(assessment);\n  };\n\n  const delOption = () => {\n    const { assessment, questionId } = props;\n    const question = assessment!.questions[questionId] as IMCQQuestion;\n    const choices = question.choices.slice(0, question.choices.length - 1);\n    question.choices = choices;\n    assessment!.questions[questionId] = question;\n    props.updateAssessment(assessment);\n  };\n\n  const textareaContent = (\n    path: Array<string | number>,\n    isNumber: boolean = false,\n    range: number[] = [0]\n  ) => {\n    if (isNumber) {\n      return (\n        <TextAreaContent\n          assessment={props.assessment}\n          isNumber={true}\n          path={path}\n          processResults={limitNumberRange(range[0], range[1])}\n          updateAssessment={props.updateAssessment}\n        />\n      );\n    } else {\n      return (\n        <TextAreaContent\n          assessment={props.assessment}\n          path={path}\n          updateAssessment={props.updateAssessment}\n        />\n      );\n    }\n  };\n\n  // Render\n  const { questionId } = props;\n  const question = props.assessment!.questions[questionId] as IMCQQuestion;\n  const mcqButton = question.choices.map((choice, i) => (\n    <div key={i} className=\"mcq-option col-xs-12\">\n      Option {i}:{textareaContent(['questions', questionId, 'choices', i, 'content'])}\n      <br />\n      Hint:\n      {textareaContent(['questions', questionId, 'choices', i, 'hint'])}\n    </div>\n  ));\n  const deleteButton = (\n    <ControlButton label=\"Delete Option\" icon={IconNames.REMOVE} onClick={delOption} />\n  );\n\n  return (\n    <div className=\"MCQChooser row\">\n      <Card className=\"mcq-content-parent col-xs-12 middle-xs\">\n        <div className=\"row mcq-options-parent between-xs\">\n          {mcqButton}\n          Solution:\n          {textareaContent(['questions', questionId, 'solution'], true, [\n            0,\n            question.choices.length\n          ])}\n          <br />\n          <ControlButton label=\"Add Option\" icon={IconNames.CONFIRM} onClick={addOption} />\n          {question.choices.length > 0 ? deleteButton : undefined}\n        </div>\n      </Card>\n    </div>\n  );\n};\n\nexport default MCQQuestionTemplateTab;\n","import { Button, Card, Classes, Divider, IconName, MenuItem } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { ItemRenderer, Select } from '@blueprintjs/select';\nimport React, { useState } from 'react';\nimport AceEditor from 'react-ace';\n\nimport { Assessment } from '../assessment/AssessmentTypes';\nimport ControlButton from '../ControlButton';\nimport { EditorTabState } from '../workspace/WorkspaceTypes';\nimport { assignToPath, getValueFromPath } from './EditingWorkspaceSideContentHelper';\n\ntype QuestionEditorProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  updateAssessment: (assessment: Assessment) => void;\n  handleEditorValueChange: (val: string) => void;\n  handleUpdateActiveEditorTab: (options: Partial<EditorTabState>) => void;\n};\n\ntype StateProps = {\n  assessment: Assessment;\n  editorValue: string;\n  questionId: number;\n};\n\nconst questionEditorPaths = ['prepend', 'postpend', 'solutionTemplate', 'answer'] as const;\n\nexport type QuestionEditorId = typeof questionEditorPaths[number];\n\nconst QuestionEditorSelect = Select.ofType<QuestionEditor>();\n\nexport type QuestionEditor = {\n  label: string;\n  icon: IconName;\n  id: QuestionEditorId;\n};\n\nconst questionEditors: QuestionEditor[] = [\n  {\n    label: 'Prepend',\n    icon: IconNames.CHEVRON_UP,\n    id: 'prepend'\n  },\n  {\n    label: 'Postpend',\n    icon: IconNames.CHEVRON_DOWN,\n    id: 'postpend'\n  },\n  {\n    label: 'Solution Template',\n    icon: IconNames.MANUAL,\n    id: 'solutionTemplate'\n  },\n  {\n    label: 'Suggested Answer',\n    icon: IconNames.TICK,\n    id: 'answer'\n  }\n];\n\n/*\n * activeEditor is the default editor to show initially\n */\nconst ProgrammingQuestionTemplateTab: React.FC<QuestionEditorProps> = props => {\n  const [activeEditor, setActiveEditor] = useState(questionEditors[0]);\n  const [templateValue, setTemplateValue] = useState('');\n  const [templateFocused, setTemplateFocused] = useState(false);\n\n  const programmingTab = () => {\n    const qnPath = ['questions', props.questionId];\n    const path = qnPath.concat(activeEditor.id);\n\n    const copyFromEditorButton = (\n      <ControlButton\n        label=\"Copy from Editor\"\n        icon={IconNames.IMPORT}\n        onClick={handleCopyFromEditor(path)}\n      />\n    );\n\n    const copyToEditorButton = (\n      <ControlButton\n        label=\"Copy to Editor\"\n        icon={IconNames.EXPORT}\n        onClick={handleCopyToEditor(path)}\n      />\n    );\n\n    const editorPanel = (\n      <div>\n        {copyFromEditorButton}\n        {copyToEditorButton}\n        <Divider />\n        {editor(path)}\n      </div>\n    );\n\n    const menuRenderer: ItemRenderer<QuestionEditor> = (editor, { handleClick }) => (\n      <MenuItem\n        active={false}\n        key={editor.id}\n        onClick={handleClick}\n        text={editor.label}\n        icon={editor.icon}\n      />\n    );\n\n    const editorSelect = (\n      currentEditor: QuestionEditor,\n      handleSelect: (i: QuestionEditor) => void\n    ) => (\n      <QuestionEditorSelect\n        className={Classes.MINIMAL}\n        items={questionEditors}\n        itemRenderer={menuRenderer}\n        onItemSelect={handleSelect}\n        filterable={false}\n      >\n        <Button\n          className={Classes.MINIMAL}\n          text={currentEditor.label}\n          icon={IconNames.EDIT}\n          rightIcon={IconNames.DOUBLE_CARET_VERTICAL}\n        />\n      </QuestionEditorSelect>\n    );\n\n    return (\n      <div className=\"side-content\">\n        <Card>\n          {editorSelect(activeEditor, setActiveEditor)}\n          <Divider />\n          <div className=\"side-content-text\">{editorPanel}</div>\n        </Card>\n      </div>\n    );\n  };\n\n  const editor = (path: Array<string | number>) => {\n    const value = templateFocused ? templateValue : getValueFromPath(path, props.assessment);\n\n    return (\n      <div onClick={focusEditor(path)} onBlur={unFocusEditor(path)}>\n        <AceEditor\n          className=\"react-ace\"\n          editorProps={{\n            $blockScrolling: Infinity\n          }}\n          fontSize={14}\n          highlightActiveLine={false}\n          mode=\"javascript\"\n          onChange={setTemplateValue}\n          theme=\"source\"\n          value={value}\n          width=\"100%\"\n        />\n      </div>\n    );\n  };\n\n  const focusEditor =\n    (path: Array<string | number>) =>\n    (e: any): void => {\n      if (!templateFocused) {\n        setTemplateValue(getValueFromPath(path, props.assessment));\n        setTemplateFocused(true);\n      }\n    };\n\n  const unFocusEditor =\n    (path: Array<string | number>) =>\n    (e: any): void => {\n      if (templateFocused) {\n        const value = getValueFromPath(path, props.assessment);\n        if (value !== templateValue) {\n          const assessmentVal = props.assessment;\n          assignToPath(path, templateValue, assessmentVal);\n          props.updateAssessment(assessmentVal);\n        }\n\n        if (activeEditor.id === 'prepend') {\n          const editorPrepend = templateValue;\n          props.handleUpdateActiveEditorTab({ prependValue: editorPrepend });\n        } else if (activeEditor.id === 'postpend') {\n          const editorPostpend = templateValue;\n          props.handleUpdateActiveEditorTab({ postpendValue: editorPostpend });\n        }\n\n        setTemplateValue('');\n        setTemplateFocused(false);\n      }\n    };\n\n  const handleCopyFromEditor = (path: Array<string | number>) => (): void => {\n    const assessment = props.assessment;\n    assignToPath(path, props.editorValue, assessment);\n    props.updateAssessment(assessment);\n  };\n\n  const handleCopyToEditor = (path: Array<string | number>) => (): void => {\n    const value = getValueFromPath(path, props.assessment);\n    props.handleEditorValueChange(value);\n  };\n\n  return programmingTab();\n};\n\nexport default ProgrammingQuestionTemplateTab;\n","import {\n  ButtonGroup,\n  Classes,\n  Dialog,\n  Intent,\n  NonIdealState,\n  Spinner,\n  SpinnerSize\n} from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport classNames from 'classnames';\nimport React, { useEffect, useState } from 'react';\n\nimport { InterpreterOutput } from '../application/ApplicationTypes';\nimport {\n  Assessment,\n  AssessmentOverview,\n  IMCQQuestion,\n  IProgrammingQuestion,\n  Library,\n  Question,\n  QuestionTypes,\n  Testcase\n} from '../assessment/AssessmentTypes';\nimport { ControlBarProps } from '../controlBar/ControlBar';\nimport { ControlBarClearButton } from '../controlBar/ControlBarClearButton';\nimport { ControlBarEvalButton } from '../controlBar/ControlBarEvalButton';\nimport { ControlBarNextButton } from '../controlBar/ControlBarNextButton';\nimport { ControlBarPreviousButton } from '../controlBar/ControlBarPreviousButton';\nimport { ControlBarQuestionViewButton } from '../controlBar/ControlBarQuestionViewButton';\nimport { ControlBarResetButton } from '../controlBar/ControlBarResetButton';\nimport { ControlBarRunButton } from '../controlBar/ControlBarRunButton';\nimport { ControlButtonSaveButton } from '../controlBar/ControlBarSaveButton';\nimport { ControlBarToggleEditModeButton } from '../controlBar/ControlBarToggleEditModeButton';\nimport ControlButton from '../ControlButton';\nimport { AutograderTab } from '../editingWorkspaceSideContent/EditingWorkspaceSideContentAutograderTab';\nimport DeploymentTab from '../editingWorkspaceSideContent/EditingWorkspaceSideContentDeploymentTab';\nimport GradingTab from '../editingWorkspaceSideContent/EditingWorkspaceSideContentGradingTab';\nimport ManageQuestionTab from '../editingWorkspaceSideContent/EditingWorkspaceSideContentManageQuestionTab';\nimport MCQQuestionTemplateTab from '../editingWorkspaceSideContent/EditingWorkspaceSideContentMcqQuestionTemplateTab';\nimport ProgrammingQuestionTemplateTab from '../editingWorkspaceSideContent/EditingWorkspaceSideContentProgrammingQuestionTemplateTab';\nimport { TextAreaContent } from '../editingWorkspaceSideContent/EditingWorkspaceSideContentTextAreaContent';\nimport { convertEditorTabStateToProps } from '../editor/EditorContainer';\nimport { Position } from '../editor/EditorTypes';\nimport Markdown from '../Markdown';\nimport { SideContentProps } from '../sideContent/SideContent';\nimport SideContentToneMatrix from '../sideContent/SideContentToneMatrix';\nimport { SideContentTab, SideContentType } from '../sideContent/SideContentTypes';\nimport { history } from '../utils/HistoryHelper';\nimport Workspace, { WorkspaceProps } from '../workspace/Workspace';\nimport { EditorTabState, WorkspaceState } from '../workspace/WorkspaceTypes';\nimport {\n  retrieveLocalAssessment,\n  storeLocalAssessment,\n  storeLocalAssessmentOverview\n} from '../XMLParser/XMLParserHelper';\n\nexport type EditingWorkspaceProps = DispatchProps & StateProps & OwnProps;\n\nexport type DispatchProps = {\n  handleBrowseHistoryDown: () => void;\n  handleBrowseHistoryUp: () => void;\n  handleChapterSelect: (chapter: any, changeEvent: any) => void;\n  handleClearContext: (library: Library, shouldInitLibrary: boolean) => void;\n  handleDeclarationNavigate: (cursorPosition: Position) => void;\n  handleEditorEval: () => void;\n  handleEditorCheck: () => void;\n  handleEditorValueChange: (val: string) => void;\n  handleEditorUpdateBreakpoints: (breakpoints: string[]) => void;\n  handleInterruptEval: () => void;\n  handleReplEval: () => void;\n  handleReplOutputClear: () => void;\n  handleReplValueChange: (newValue: string) => void;\n  handleResetWorkspace: (options: Partial<WorkspaceState>) => void;\n  handleUpdateWorkspace: (options: Partial<WorkspaceState>) => void;\n  handleUpdateActiveEditorTab: (options: Partial<EditorTabState>) => void;\n  handleSave: (id: number, answer: number | string) => void;\n  handleSideContentHeightChange: (heightChange: number) => void;\n  handleTestcaseEval: (testcaseId: number) => void;\n  handleDebuggerPause: () => void;\n  handleDebuggerResume: () => void;\n  handleDebuggerReset: () => void;\n  handleUpdateCurrentAssessmentId: (assessmentId: number, questionId: number) => void;\n  handleUpdateHasUnsavedChanges: (hasUnsavedChanges: boolean) => void;\n  handlePromptAutocomplete: (row: number, col: number, callback: any) => void;\n};\n\nexport type OwnProps = {\n  assessmentId: number;\n  questionId: number;\n  assessmentOverview: AssessmentOverview;\n  updateAssessmentOverview: (overview: AssessmentOverview) => void;\n  notAttempted: boolean;\n  closeDate: string;\n};\n\nexport type StateProps = {\n  activeEditorTabIndex: number | null;\n  editorTabs: EditorTabState[];\n  hasUnsavedChanges: boolean;\n  isRunning: boolean;\n  isDebugging: boolean;\n  enableDebugging: boolean;\n  output: InterpreterOutput[];\n  replValue: string;\n  sideContentHeight?: number;\n  storedAssessmentId?: number;\n  storedQuestionId?: number;\n};\n\nconst EditingWorkspace: React.FC<EditingWorkspaceProps> = props => {\n  const [assessment, setAssessment] = useState(retrieveLocalAssessment());\n  const [editingMode, setEditingMode] = useState('question');\n  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\n  const [showResetTemplateOverlay, setShowResetTemplateOverlay] = useState(false);\n  const [originalMaxXp, setOriginalMaxXp] = useState(0);\n\n  /**\n   * After mounting (either an older copy of the assessment\n   * or a loading screen), try to fetch a newer assessment,\n   * and show the briefing.\n   */\n  useEffect(() => {\n    if (assessment) {\n      resetWorkspaceValues();\n      setOriginalMaxXp(getMaxXp());\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  /**\n   * Once there is an update (due to the assessment being fetched), check\n   * if a workspace reset is needed.\n   */\n  useEffect(() => checkWorkspaceReset());\n\n  if (assessment === null || assessment!.questions.length === 0) {\n    return (\n      <NonIdealState\n        className={classNames('WorkspaceParent', Classes.DARK)}\n        description=\"Getting mission ready...\"\n        icon={<Spinner size={SpinnerSize.LARGE} />}\n      />\n    );\n  }\n\n  /* If questionId is out of bounds, set it within range. */\n  const formatedQuestionId = () => {\n    let questionId = props.questionId;\n    if (questionId < 0) {\n      questionId = 0;\n    } else if (questionId >= assessment!.questions.length) {\n      questionId = assessment!.questions.length - 1;\n    }\n    return questionId;\n  };\n\n  /**\n   * Resets to last save.\n   */\n  const resetTemplateOverlay = () => (\n    <Dialog\n      className=\"assessment-reset\"\n      icon={IconNames.ERROR}\n      isCloseButtonShown={true}\n      isOpen={showResetTemplateOverlay}\n      title=\"Confirmation: Reset editor?\"\n    >\n      <div className={Classes.DIALOG_BODY}>\n        <Markdown content=\"Are you sure you want to reset to your last save?\" />\n      </div>\n      <div className={Classes.DIALOG_FOOTER}>\n        <ButtonGroup>\n          <ControlButton\n            label=\"Cancel\"\n            onClick={() => setShowResetTemplateOverlay(false)}\n            options={{ minimal: false }}\n          />\n          <ControlButton\n            label=\"Confirm\"\n            onClick={() => {\n              const assessment = retrieveLocalAssessment()!;\n              setAssessment(assessment);\n              setHasUnsavedChanges(false);\n              setShowResetTemplateOverlay(false);\n              setOriginalMaxXp(getMaxXp());\n              handleRefreshLibrary();\n              resetWorkspaceValues();\n            }}\n            options={{ minimal: false, intent: Intent.DANGER }}\n          />\n        </ButtonGroup>\n      </div>\n    </Dialog>\n  );\n\n  /**\n   * Checks if there is a need to reset the workspace, then executes\n   * a dispatch (in the props) if needed.\n   */\n  function checkWorkspaceReset() {\n    /* Don't reset workspace if assessment not fetched yet. */\n    if (assessment === undefined) {\n      return;\n    }\n\n    /* Reset assessment if it has changed.*/\n    const assessmentId = -1;\n    const questionId = formatedQuestionId();\n\n    if (props.storedAssessmentId !== assessmentId || props.storedQuestionId !== questionId) {\n      resetWorkspaceValues();\n      props.handleUpdateCurrentAssessmentId(assessmentId, questionId);\n      props.handleUpdateHasUnsavedChanges(false);\n      if (hasUnsavedChanges) {\n        setAssessment(retrieveLocalAssessment());\n        setHasUnsavedChanges(false);\n      }\n      handleRefreshLibrary();\n    }\n  }\n\n  const handleRefreshLibrary = (library: Library | undefined = undefined) => {\n    const question = assessment!.questions[formatedQuestionId()];\n    if (!library) {\n      library = question.library;\n    }\n    if (library && library.globals.length > 0) {\n      const globalsVal = library.globals.map((x: any) => x[0]);\n      const symbolsVal = library.external.symbols.concat(globalsVal);\n      library = {\n        ...library,\n        external: {\n          name: library.external.name,\n          symbols: uniq(symbolsVal)\n        }\n      };\n    }\n    props.handleClearContext(library, true);\n  };\n\n  const resetWorkspaceValues = () => {\n    const question: Question = assessment!.questions[formatedQuestionId()];\n    let editorValue: string;\n    let editorPrepend = '';\n    let editorPostpend = '';\n    if (question.type === QuestionTypes.programming) {\n      if (question.editorValue) {\n        editorValue = question.editorValue;\n      } else {\n        editorValue = (question as IProgrammingQuestion).solutionTemplate as string;\n      }\n      editorPrepend = (question as IProgrammingQuestion).prepend;\n      editorPostpend = (question as IProgrammingQuestion).postpend;\n    } else {\n      editorValue = '//If you see this, this is a bug. Please report bug.';\n    }\n\n    props.handleResetWorkspace({\n      // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n      editorTabs: [\n        {\n          value: editorValue,\n          prependValue: editorPrepend,\n          postpendValue: editorPostpend,\n          highlightedLines: [],\n          breakpoints: []\n        }\n      ]\n    });\n    props.handleEditorValueChange(editorValue);\n  };\n\n  const handleTestcaseEval = (testcase: Testcase) => {\n    const editorTestcases = [testcase];\n    props.handleUpdateWorkspace({ editorTestcases });\n    props.handleTestcaseEval(0);\n  };\n\n  const handleSave = () => {\n    // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n    assessment!.questions[formatedQuestionId()].editorValue = props.editorTabs[0].value;\n    setAssessment(assessment);\n    setHasUnsavedChanges(false);\n    storeLocalAssessment(assessment);\n    // this.handleRefreshLibrary();\n    handleSaveXp();\n  };\n\n  const handleSaveXp = () => {\n    const curXp = getMaxXp();\n    const changeXp = curXp - originalMaxXp;\n    if (changeXp !== 0) {\n      const overview = props.assessmentOverview;\n      if (changeXp !== 0) {\n        overview.maxXp = curXp;\n      }\n      setOriginalMaxXp(curXp);\n      props.updateAssessmentOverview(overview);\n      storeLocalAssessmentOverview(overview);\n    }\n  };\n\n  const getMaxXp = () => {\n    let xp = 0;\n    const questions = assessment!.questions;\n    for (const question of questions) {\n      xp += question.maxXp;\n    }\n    return xp as number;\n  };\n  const updateEditAssessmentState = (assessmentVal: Assessment) => {\n    setAssessment(assessmentVal);\n    setHasUnsavedChanges(true);\n  };\n\n  const updateAndSaveAssessment = (assessmentVal: Assessment) => {\n    setAssessment(assessmentVal);\n    handleRefreshLibrary();\n    handleSave();\n    resetWorkspaceValues();\n  };\n\n  const toggleEditingMode = () => {\n    const toggle = editingMode === 'question' ? 'global' : 'question';\n    setEditingMode(toggle);\n  };\n\n  /** Pre-condition: IAssessment has been loaded */\n  const sideContentProps: (p: EditingWorkspaceProps, q: number) => SideContentProps = (\n    props: EditingWorkspaceProps,\n    questionId: number\n  ) => {\n    const currentAssessment = assessment!;\n    let tabs: SideContentTab[];\n    if (editingMode === 'question') {\n      const qnType = currentAssessment!.questions[props.questionId].type;\n      const questionTemplateTab =\n        qnType === 'mcq' ? (\n          <MCQQuestionTemplateTab\n            assessment={currentAssessment}\n            questionId={questionId}\n            updateAssessment={updateEditAssessmentState}\n          />\n        ) : (\n          <ProgrammingQuestionTemplateTab\n            assessment={currentAssessment}\n            questionId={questionId}\n            updateAssessment={updateEditAssessmentState}\n            // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n            editorValue={props.editorTabs[0].value}\n            handleEditorValueChange={props.handleEditorValueChange}\n            handleUpdateActiveEditorTab={props.handleUpdateActiveEditorTab}\n          />\n        );\n\n      tabs = [\n        {\n          label: `Question ${questionId + 1}`,\n          iconName: IconNames.NINJA,\n          body: (\n            <TextAreaContent\n              assessment={currentAssessment}\n              path={['questions', questionId, 'content']}\n              updateAssessment={updateEditAssessmentState}\n            />\n          ),\n          id: SideContentType.editorQuestionOverview\n        },\n        {\n          label: `Question Template`,\n          iconName: IconNames.DOCUMENT,\n          body: questionTemplateTab,\n          id: SideContentType.editorQuestionTemplate\n        },\n        {\n          label: `Manage Local Deployment`,\n          iconName: IconNames.HOME,\n          body: (\n            <DeploymentTab\n              assessment={currentAssessment}\n              label={'Question Specific'}\n              handleRefreshLibrary={handleRefreshLibrary}\n              pathToLibrary={['questions', questionId, 'library']}\n              updateAssessment={updateEditAssessmentState}\n              isOptionalDeployment={true}\n            />\n          ),\n          id: SideContentType.editorLocalDeployment\n        },\n        {\n          label: `Manage Local Grader Deployment`,\n          iconName: IconNames.CONFIRM,\n          body: (\n            <DeploymentTab\n              assessment={currentAssessment}\n              label={'Question Specific Grader'}\n              handleRefreshLibrary={handleRefreshLibrary}\n              pathToLibrary={['questions', questionId, 'graderLibrary']}\n              pathToCopy={['questions', questionId, 'library']}\n              updateAssessment={updateEditAssessmentState}\n              isOptionalDeployment={true}\n            />\n          ),\n          id: SideContentType.editorLocalGraderDeployment\n        },\n        {\n          label: `Grading`,\n          iconName: IconNames.TICK,\n          body: (\n            <GradingTab\n              assessment={currentAssessment}\n              path={['questions', questionId]}\n              updateAssessment={updateEditAssessmentState}\n            />\n          ),\n          id: SideContentType.editorGrading\n        }\n      ];\n      if (qnType === 'programming') {\n        tabs.push({\n          label: `Autograder`,\n          iconName: IconNames.AIRPLANE,\n          body: (\n            <AutograderTab\n              assessment={currentAssessment}\n              questionId={questionId}\n              handleTestcaseEval={handleTestcaseEval}\n              updateAssessment={updateEditAssessmentState}\n            />\n          ),\n          id: SideContentType.editorAutograder\n        });\n      }\n      const functionsAttached = currentAssessment!.globalDeployment!.external.symbols;\n      if (functionsAttached.includes('get_matrix')) {\n        tabs.push({\n          label: `Tone Matrix`,\n          iconName: IconNames.GRID_VIEW,\n          body: <SideContentToneMatrix />,\n          id: SideContentType.toneMatrix\n        });\n      }\n    } else {\n      tabs = [\n        {\n          label: `${currentAssessment!.type} Briefing`,\n          iconName: IconNames.BRIEFCASE,\n          body: (\n            <TextAreaContent\n              assessment={currentAssessment}\n              path={['longSummary']}\n              updateAssessment={updateEditAssessmentState}\n            />\n          ),\n          id: SideContentType.editorBriefing\n        },\n        {\n          label: `Manage Question`,\n          iconName: IconNames.WRENCH,\n          body: (\n            <ManageQuestionTab\n              assessment={currentAssessment}\n              hasUnsavedChanges={hasUnsavedChanges}\n              questionId={questionId}\n              updateAssessment={updateAndSaveAssessment}\n            />\n          ),\n          id: SideContentType.editorManageQuestion\n        },\n        {\n          label: `Manage Global Deployment`,\n          iconName: IconNames.GLOBE,\n          body: (\n            <DeploymentTab\n              assessment={currentAssessment}\n              label={'Global'}\n              handleRefreshLibrary={handleRefreshLibrary}\n              pathToLibrary={['globalDeployment']}\n              updateAssessment={updateEditAssessmentState}\n              isOptionalDeployment={false}\n            />\n          ),\n          id: SideContentType.editorGlobalDeployment\n        },\n        {\n          label: `Manage Global Grader Deployment`,\n          iconName: IconNames.CONFIRM,\n          body: (\n            <DeploymentTab\n              assessment={currentAssessment}\n              label={'Global Grader'}\n              handleRefreshLibrary={handleRefreshLibrary}\n              pathToLibrary={['graderDeployment']}\n              updateAssessment={updateEditAssessmentState}\n              isOptionalDeployment={true}\n            />\n          ),\n          id: SideContentType.editorGlobalGraderDeployment\n        }\n      ];\n    }\n\n    return {\n      tabs: { beforeDynamicTabs: tabs, afterDynamicTabs: [] }\n    };\n  };\n\n  /** Pre-condition: IAssessment has been loaded */\n  const controlBarProps: (q: number) => ControlBarProps = (questionId: number) => {\n    const listingPath = '/mission-control';\n    const assessmentWorkspacePath = listingPath + `/${assessment!.id.toString()}`;\n    const questionProgress: [number, number] = [questionId + 1, assessment!.questions.length];\n\n    const onClickPrevious = () =>\n      history.push(assessmentWorkspacePath + `/${(questionId - 1).toString()}`);\n    const onClickNext = () =>\n      history.push(assessmentWorkspacePath + `/${(questionId + 1).toString()}`);\n    const onClickReturn = () => history.push(listingPath);\n\n    const onClickResetTemplate = () => {\n      setShowResetTemplateOverlay(() => hasUnsavedChanges);\n    };\n\n    const nextButton = (\n      <ControlBarNextButton\n        onClickNext={onClickNext}\n        onClickReturn={onClickReturn}\n        questionProgress={questionProgress}\n        key=\"next_question\"\n      />\n    );\n\n    const previousButton = (\n      <ControlBarPreviousButton\n        onClick={onClickPrevious}\n        questionProgress={questionProgress}\n        key=\"previous_question\"\n      />\n    );\n\n    const questionView = (\n      <ControlBarQuestionViewButton questionProgress={questionProgress} key=\"question_view\" />\n    );\n\n    const resetButton = (\n      <ControlBarResetButton onClick={onClickResetTemplate} key=\"reset_template\" />\n    );\n\n    const runButton = <ControlBarRunButton handleEditorEval={props.handleEditorEval} key=\"run\" />;\n\n    const saveButton = (\n      <ControlButtonSaveButton\n        hasUnsavedChanges={hasUnsavedChanges}\n        onClickSave={handleSave}\n        key=\"save\"\n      />\n    );\n\n    const toggleEditModeButton = (\n      <ControlBarToggleEditModeButton\n        editingMode={editingMode}\n        toggleEditMode={toggleEditingMode}\n        key=\"toggle_edit_mode\"\n      />\n    );\n\n    return {\n      editorButtons: [runButton, saveButton, resetButton],\n      flowButtons: [previousButton, questionView, nextButton],\n      editingWorkspaceButtons: [toggleEditModeButton]\n    };\n  };\n\n  function replButtons() {\n    const clearButton = (\n      <ControlBarClearButton handleReplOutputClear={props.handleReplOutputClear} key=\"clear_repl\" />\n    );\n\n    const evalButton = (\n      <ControlBarEvalButton\n        handleReplEval={props.handleReplEval}\n        isRunning={props.isRunning}\n        key=\"eval_repl\"\n      />\n    );\n\n    return [evalButton, clearButton];\n  }\n\n  const questionId = formatedQuestionId();\n  const question: Question = assessment.questions[questionId];\n\n  const workspaceProps: WorkspaceProps = {\n    controlBarProps: controlBarProps(questionId),\n    editorContainerProps:\n      question.type === QuestionTypes.programming\n        ? {\n            editorVariant: 'normal',\n            editorTabs: props.editorTabs\n              .map(convertEditorTabStateToProps)\n              .map((editorTabStateProps, index) => {\n                // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n                //       Specifically, need to update questions such that they can span multiple files.\n                if (index !== 0) {\n                  return editorTabStateProps;\n                }\n                return {\n                  ...editorTabStateProps,\n                  editorValue:\n                    editorTabStateProps.editorValue ||\n                    question.editorValue ||\n                    (question as IProgrammingQuestion).solutionTemplate\n                };\n              }),\n            editorSessionId: '',\n            handleDeclarationNavigate: props.handleDeclarationNavigate,\n            handleEditorEval: props.handleEditorEval,\n            handleEditorCheck: props.handleEditorCheck,\n            handleEditorValueChange: props.handleEditorValueChange,\n            handleEditorUpdateBreakpoints: props.handleEditorUpdateBreakpoints,\n            handleUpdateHasUnsavedChanges: props.handleUpdateHasUnsavedChanges,\n            handlePromptAutocomplete: props.handlePromptAutocomplete,\n            isEditorAutorun: false\n          }\n        : undefined,\n    handleSideContentHeightChange: props.handleSideContentHeightChange,\n    hasUnsavedChanges: hasUnsavedChanges,\n    mcqProps: {\n      mcq: question as IMCQQuestion,\n      handleMCQSubmit: (option: number) =>\n        props.handleSave(assessment!.questions[questionId].id, option)\n    },\n    sideBarProps: {\n      tabs: []\n    },\n    sideContentHeight: props.sideContentHeight,\n    sideContentProps: sideContentProps(props, questionId),\n    replProps: {\n      handleBrowseHistoryDown: props.handleBrowseHistoryDown,\n      handleBrowseHistoryUp: props.handleBrowseHistoryUp,\n      handleReplEval: props.handleReplEval,\n      handleReplValueChange: props.handleReplValueChange,\n      output: props.output,\n      replValue: props.replValue,\n      sourceChapter: Chapter.CALC,\n      sourceVariant: Variant.DEFAULT,\n      externalLibrary: question?.library?.external?.name || 'NONE',\n      replButtons: replButtons()\n    }\n  };\n  return (\n    <div className={classNames('WorkspaceParent', Classes.DARK)}>\n      {resetTemplateOverlay()}\n      <Workspace {...workspaceProps} />\n    </div>\n  );\n};\n\nfunction uniq(a: string[]) {\n  const seen = {};\n  return a.filter(item => (seen.hasOwnProperty(item) ? false : (seen[item] = true)));\n}\n\nexport default EditingWorkspace;\n","import { Chapter, Variant } from 'c-slang/dist/types';\nimport { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport {\n  beginDebuggerPause,\n  beginInterruptExecution,\n  debuggerReset,\n  debuggerResume\n} from '../application/actions/InterpreterActions';\nimport { submitAnswer } from '../application/actions/SessionActions';\nimport { OverallState } from '../application/ApplicationTypes';\nimport { Library } from '../assessment/AssessmentTypes';\nimport { Position } from '../editor/EditorTypes';\nimport {\n  beginClearContext,\n  browseReplHistoryDown,\n  browseReplHistoryUp,\n  changeSideContentHeight,\n  chapterSelect,\n  checkEditor,\n  clearReplOutput,\n  evalEditor,\n  evalRepl,\n  evalTestcase,\n  navigateToDeclaration,\n  promptAutocomplete,\n  resetWorkspace,\n  setEditorBreakpoint,\n  updateActiveEditorTab,\n  updateCurrentAssessmentId,\n  updateEditorValue,\n  updateHasUnsavedChanges,\n  updateReplValue,\n  updateWorkspace\n} from '../workspace/WorkspaceActions';\nimport { EditorTabState, WorkspaceLocation, WorkspaceState } from '../workspace/WorkspaceTypes';\nimport EditingWorkspace, { DispatchProps, OwnProps, StateProps } from './EditingWorkspace';\n\nconst mapStateToProps: MapStateToProps<StateProps, OwnProps, OverallState> = (state, props) => {\n  return {\n    activeEditorTabIndex: state.workspaces.assessment.activeEditorTabIndex,\n    editorTabs: state.workspaces.assessment.editorTabs,\n    hasUnsavedChanges: state.workspaces.assessment.hasUnsavedChanges,\n    isRunning: state.workspaces.assessment.isRunning,\n    isDebugging: state.workspaces.assessment.isDebugging,\n    enableDebugging: state.workspaces.assessment.enableDebugging,\n    output: state.workspaces.assessment.output,\n    replValue: state.workspaces.assessment.replValue,\n    sideContentHeight: state.workspaces.assessment.sideContentHeight,\n    storedAssessmentId: state.workspaces.assessment.currentAssessment,\n    storedQuestionId: state.workspaces.assessment.currentQuestion\n  };\n};\n\nconst workspaceLocation: WorkspaceLocation = 'assessment';\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleBrowseHistoryDown: () => browseReplHistoryDown(workspaceLocation),\n      handleBrowseHistoryUp: () => browseReplHistoryUp(workspaceLocation),\n      handleChapterSelect: (chapter: Chapter, changeEvent: any) =>\n        chapterSelect(chapter, Variant.DEFAULT, workspaceLocation),\n      handleClearContext: (library: Library, shouldInitLibrary: boolean) =>\n        beginClearContext(workspaceLocation, library, shouldInitLibrary),\n      handleDeclarationNavigate: (cursorPosition: Position) =>\n        navigateToDeclaration(workspaceLocation, cursorPosition),\n      handleEditorEval: () => evalEditor(workspaceLocation),\n      handleEditorCheck: () => checkEditor(workspaceLocation),\n      handleEditorValueChange: (val: string) => updateEditorValue(val, workspaceLocation),\n      handleEditorUpdateBreakpoints: (breakpoints: string[]) =>\n        setEditorBreakpoint(breakpoints, workspaceLocation),\n      handleInterruptEval: () => beginInterruptExecution(workspaceLocation),\n      handleReplEval: () => evalRepl(workspaceLocation),\n      handleReplOutputClear: () => clearReplOutput(workspaceLocation),\n      handleReplValueChange: (newValue: string) => updateReplValue(newValue, workspaceLocation),\n      handleResetWorkspace: (options: Partial<WorkspaceState>) =>\n        resetWorkspace(workspaceLocation, options),\n      handleUpdateWorkspace: (options: Partial<WorkspaceState>) =>\n        updateWorkspace(workspaceLocation, options),\n      handleUpdateActiveEditorTab: (options: Partial<EditorTabState>) =>\n        updateActiveEditorTab(workspaceLocation, options),\n      handleSave: submitAnswer,\n      handleSideContentHeightChange: (heightChange: number) =>\n        changeSideContentHeight(heightChange, workspaceLocation),\n      handleTestcaseEval: (testcaseId: number) => evalTestcase(workspaceLocation, testcaseId),\n      handleUpdateHasUnsavedChanges: (hasUnsavedChanges: boolean) =>\n        updateHasUnsavedChanges(workspaceLocation, hasUnsavedChanges),\n      handleUpdateCurrentAssessmentId: updateCurrentAssessmentId,\n      handleDebuggerPause: () => beginDebuggerPause(workspaceLocation),\n      handleDebuggerResume: () => debuggerResume(workspaceLocation),\n      handleDebuggerReset: () => debuggerReset(workspaceLocation),\n      handlePromptAutocomplete: (row: number, col: number, callback: any) =>\n        promptAutocomplete(workspaceLocation, row, col, callback)\n    },\n    dispatch\n  );\n\nconst EditingWorkspaceContainer = connect(mapStateToProps, mapDispatchToProps)(EditingWorkspace);\n\nexport default EditingWorkspaceContainer;\n","import { FileInput } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport * as React from 'react';\nimport { parseString } from 'xml2js';\n\nimport {\n  Assessment,\n  AssessmentOverview,\n  assessmentTemplate,\n  overviewTemplate\n} from '../assessment/AssessmentTypes';\nimport ControlButton from '../ControlButton';\nimport {\n  makeEntireAssessment,\n  retrieveLocalAssessment,\n  storeLocalAssessment,\n  storeLocalAssessmentOverview\n} from '../XMLParser/XMLParserHelper';\n\ntype MissionCreatorProps = DispatchProps & OwnProps;\n\nexport type DispatchProps = {\n  newAssessment: (assessment: Assessment) => void;\n};\n\ntype OwnProps = {\n  updateEditingOverview: (overview: AssessmentOverview) => void;\n};\n\ntype State = {\n  fileInputText: string;\n};\n\nclass MissionCreator extends React.Component<MissionCreatorProps, State> {\n  private fileReader?: FileReader = undefined;\n  public constructor(props: any) {\n    super(props);\n    this.handleFileRead = this.handleFileRead.bind(this);\n    this.handleChangeFile = this.handleChangeFile.bind(this);\n    this.makeMission = this.makeMission.bind(this);\n    this.state = {\n      fileInputText: 'Import XML'\n    };\n  }\n\n  public componentDidMount() {\n    const assessment = retrieveLocalAssessment();\n    if (assessment) {\n      this.props.newAssessment(assessment);\n    }\n  }\n\n  public render() {\n    return (\n      <div>\n        <div>Please ensure that the xml uploaded is trustable.</div>\n        <div>\n          <FileInput\n            text={this.state.fileInputText}\n            inputProps={{ accept: '.xml' }}\n            onChange={this.handleChangeFile}\n          />\n        </div>\n        <div>\n          <ControlButton\n            label=\"Make New Mission\"\n            icon={IconNames.NEW_OBJECT}\n            onClick={this.makeMission}\n          />\n        </div>\n      </div>\n    );\n  }\n\n  private handleFileRead = (file: any) => (e: any) => {\n    if (!this.fileReader) {\n      return;\n    }\n    const content = this.fileReader.result;\n    if (content) {\n      parseString(content, (err: any, result: any) => {\n        // tslint:disable-next-line:no-console\n        console.dir(file);\n        try {\n          const entireAssessment: [AssessmentOverview, Assessment] = makeEntireAssessment(result);\n          entireAssessment[0].fileName = file.name.slice(0, -4);\n          storeLocalAssessmentOverview(entireAssessment[0]);\n          this.props.updateEditingOverview(entireAssessment[0]);\n\n          storeLocalAssessment(entireAssessment[1]);\n          this.props.newAssessment(entireAssessment[1]);\n          this.setState({\n            fileInputText: 'Success!'\n          });\n        } catch (err) {\n          // tslint:disable-next-line:no-console\n          console.log(err);\n          this.setState({\n            fileInputText: 'Invalid XML!'\n          });\n        }\n      });\n    }\n  };\n\n  private handleChangeFile = (e: any) => {\n    const files = e.target.files;\n    if (e.target.files) {\n      this.fileReader = new FileReader();\n      this.fileReader.onloadend = this.handleFileRead(files[0]);\n      this.fileReader.readAsText(files[0]);\n    }\n  };\n\n  private makeMission = () => {\n    storeLocalAssessmentOverview(overviewTemplate());\n    this.props.updateEditingOverview(overviewTemplate());\n    storeLocalAssessment(assessmentTemplate());\n    this.props.newAssessment(assessmentTemplate());\n  };\n}\n\nexport default MissionCreator;\n","import { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport { updateAssessment } from '../application/actions/SessionActions';\nimport MissionCreator, { DispatchProps } from './MissionCreator';\n\nconst mapStateToProps: MapStateToProps<{}, any, {}> = (state, ownProps) => ownProps;\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      newAssessment: updateAssessment\n    },\n    dispatch\n  );\n\nconst MissionCreatorContainer = connect(mapStateToProps, mapDispatchToProps)(MissionCreator);\n\nexport default MissionCreatorContainer;\n","import React, { useState } from 'react';\nimport { RouteComponentProps } from 'react-router';\n\nimport {\n  AssessmentStatuses,\n  AssessmentType,\n  AssessmentWorkspaceParams\n} from '../../commons/assessment/AssessmentTypes';\nimport ContentDisplay from '../../commons/ContentDisplay';\nimport { EditingOverviewCard } from '../../commons/editingOverviewCard/EditingOverviewCard';\nimport { OwnProps as EditingWorkspaceOwnProps } from '../../commons/editingWorkspace/EditingWorkspace';\nimport EditingWorkspaceContainer from '../../commons/editingWorkspace/EditingWorkspaceContainer';\nimport MissionCreator from '../../commons/missionCreator/MissionCreatorContainer';\nimport Constants from '../../commons/utils/Constants';\nimport { stringParamToInt } from '../../commons/utils/ParamParseHelper';\nimport { retrieveLocalAssessmentOverview } from '../../commons/XMLParser/XMLParserHelper';\n\nexport type MissionControlProps = StateProps & RouteComponentProps<AssessmentWorkspaceParams>;\n\nexport type StateProps = {\n  assessmentTypes: AssessmentType[];\n};\n\nconst nullFunction = () => {};\n\nconst MissionControl: React.FC<MissionControlProps> = props => {\n  const [editingOverview, setEditingOverview] = useState(retrieveLocalAssessmentOverview());\n\n  const assessmentId: number | null = stringParamToInt(props.match.params.assessmentId);\n  const questionId: number =\n    stringParamToInt(props.match.params.questionId) || Constants.defaultQuestionId;\n\n  // If mission for testing is to render, create workspace\n  if (assessmentId === -1 && editingOverview) {\n    const overview = editingOverview;\n    const assessmentProps: EditingWorkspaceOwnProps = {\n      assessmentId,\n      questionId,\n      assessmentOverview: overview,\n      updateAssessmentOverview: setEditingOverview,\n      notAttempted: overview.status === AssessmentStatuses.not_attempted,\n      closeDate: overview.closeAt\n    };\n    return (\n      <div className=\"Academy\">\n        <EditingWorkspaceContainer {...assessmentProps} />\n      </div>\n    );\n  }\n\n  const display = (\n    <>\n      <MissionCreator updateEditingOverview={setEditingOverview} />\n      {editingOverview && (\n        <EditingOverviewCard\n          overview={editingOverview}\n          updateEditingOverview={setEditingOverview}\n          listingPath=\"/mission-control\"\n          assessmentTypes={props.assessmentTypes}\n        />\n      )}\n    </>\n  );\n\n  // Finally, render the ContentDisplay.\n  return (\n    <div className=\"Assessment Academy\">\n      <ContentDisplay display={display} loadContentDispatch={nullFunction} />\n    </div>\n  );\n};\n\nexport default MissionControl;\n","import { connect, MapStateToProps } from 'react-redux';\nimport { withRouter } from 'react-router';\nimport { OverallState } from 'src/commons/application/ApplicationTypes';\n\nimport MissionControl, { StateProps } from './MissionControl';\n\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => ({\n  assessmentTypes: state.session.assessmentConfigurations?.map(e => e.type) || []\n});\n\nconst MissionControlContainer = withRouter(connect(mapStateToProps)(MissionControl));\n\nexport default MissionControlContainer;\n","import { Chapter, Variant } from 'c-slang/dist/types';\nimport _ from 'lodash';\nimport { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { withRouter } from 'react-router';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport { OverallState } from '../../commons/application/ApplicationTypes';\nimport {\n  changeExecTime,\n  chapterSelect,\n  clearReplOutput,\n  evalRepl,\n  setEditorBreakpoint,\n  toggleUsingSubst,\n  updateEditorValue\n} from '../../commons/workspace/WorkspaceActions';\nimport { WorkspaceLocation } from '../../commons/workspace/WorkspaceTypes';\nimport Playground, { DispatchProps, StateProps } from './Playground';\n\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => ({\n  ..._.pick(\n    state.workspaces.playground,\n    'activeEditorTabIndex',\n    'editorTabs',\n    'editorSessionId',\n    'execTime',\n    'stepLimit',\n    'isEditorAutorun',\n    'isRunning',\n    'isDebugging',\n    'enableDebugging',\n    'output',\n    'replValue',\n    'sideContentHeight',\n    'sharedbConnected',\n    'usingSubst'\n  ),\n  queryString: state.playground.queryString,\n  shortURL: state.playground.shortURL,\n  playgroundSourceChapter: Chapter.CALC,\n  playgroundSourceVariant: state.workspaces.playground.context.variant,\n  courseSourceChapter: state.session.sourceChapter,\n  courseSourceVariant: state.session.sourceVariant,\n  persistenceUser: state.session.googleUser,\n  persistenceFile: state.playground.persistenceFile,\n  githubOctokitObject: state.session.githubOctokitObject,\n  githubSaveInfo: state.playground.githubSaveInfo\n});\n\nconst workspaceLocation: WorkspaceLocation = 'playground';\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleChangeExecTime: (execTime: number) => changeExecTime(execTime, workspaceLocation),\n      handleChapterSelect: (chapter: Chapter, variant: Variant) =>\n        chapterSelect(chapter, variant, workspaceLocation),\n      handleEditorValueChange: (val: string) => updateEditorValue(val, workspaceLocation),\n      handleEditorUpdateBreakpoints: (breakpoints: string[]) =>\n        setEditorBreakpoint(breakpoints, workspaceLocation),\n      handleReplEval: () => evalRepl(workspaceLocation),\n      handleReplOutputClear: () => clearReplOutput(workspaceLocation),\n      handleUsingSubst: (usingSubst: boolean) => toggleUsingSubst(usingSubst, workspaceLocation)\n    },\n    dispatch\n  );\n\nconst PlaygroundContainer = () => {\n  const Component = withRouter(connect(mapStateToProps, mapDispatchToProps)(Playground));\n  return <Component workspaceLocation={workspaceLocation} />;\n};\n\nexport default PlaygroundContainer;\n","import { Card, H2, UL } from '@blueprintjs/core';\nimport Constants, { Links } from 'src/commons/utils/Constants';\nimport { useTypedSelector } from 'src/commons/utils/Hooks';\n\nconst Welcome: React.FC = () => {\n  const name = useTypedSelector(store => store.session.name);\n\n  return (\n    <div className=\"fullpage\">\n      <Card className=\"fullpage-content\">\n        <div style={{ marginTop: '20px', display: 'flex', justifyContent: 'center' }}>\n          <div>\n            <H2>Welcome to {Constants.sourceAcademyDeploymentName}</H2>\n            <div>\n              You have logged in as <strong>{name}</strong>. {Constants.sourceAcademyDeploymentName}{' '}\n              does not have any course information for this account.\n            </div>\n            <div style={{ display: 'flex', justifyContent: 'center' }}>\n              <UL style={{ textAlign: 'left' }}>\n                <li>\n                  If you are enrolled in a course, check with the course staff to make sure your\n                  account is added to the course.\n                </li>\n                <li>\n                  If you are looking for a course to join, check{' '}\n                  <a href={Links.resourcesForLearners}>here</a> to find a course that suits your\n                  needs.\n                </li>\n                <li>\n                  If you are an instructor and want to create a course, click{' '}\n                  <a href={Links.resourcesForEducators}>here</a> for a list of resources to get\n                  started.\n                </li>\n              </UL>\n            </div>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n};\n\nexport default Welcome;\n","import { Callout, ProgressBar } from '@blueprintjs/core';\nimport { IconName } from '@blueprintjs/icons';\nimport React from 'react';\nimport { NavLink } from 'react-router-dom';\n\nimport { AssessmentOverview, AssessmentType } from '../assessment/AssessmentTypes';\nimport { assessmentTypeLink } from '../utils/ParamParseHelper';\n\ntype ProfileCardProps = DispatchProps & StateProps;\n\ntype StateProps = {\n  item: AssessmentOverview;\n  courseId?: number;\n};\n\ntype DispatchProps = {\n  getFrac: (num: number, den: number) => number;\n  parseColour: (frac: number) => string;\n  renderIcon: (category: AssessmentType) => IconName;\n};\n\nconst ProfileCard: React.FC<ProfileCardProps> = props => {\n  const { item } = props;\n\n  const isInvalidXP = item.maxXp <= 0 && item.xp === 0;\n\n  const xpDetails = (\n    <div className=\"xp-details\">\n      <div className=\"title\">XP</div>\n      <div className=\"value\">\n        {item.xp} / {item.maxXp}\n      </div>\n      <ProgressBar\n        animate={false}\n        className={'value-bar' + props.parseColour(props.getFrac(item.xp, item.maxXp))}\n        stripes={false}\n        value={props.getFrac(item.xp, item.maxXp)}\n      />\n    </div>\n  );\n\n  return (\n    // Make each card navigate the user to the respective assessment\n    <NavLink\n      className=\"profile-summary-navlink\"\n      key={`${item.title}-${item.id}`}\n      target=\"_blank\"\n      to={`/courses/${props.courseId}/${assessmentTypeLink(item.type)}/${item.id}/0`}\n      activeClassName=\"profile-summary-navlink\"\n    >\n      <Callout\n        className=\"profile-summary-callout\"\n        key={`${item.title}-${item.id}`}\n        icon={props.renderIcon(item.type)}\n        title={item.title}\n      >\n        {isInvalidXP ? '' : xpDetails}\n      </Callout>\n    </NavLink>\n  );\n};\n\nexport default ProfileCard;\n","import { Drawer, DrawerSize, NonIdealState, Spinner } from '@blueprintjs/core';\nimport { IconName, IconNames } from '@blueprintjs/icons';\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\n\nimport { fetchAssessmentOverviews, fetchTotalXp } from '../application/actions/SessionActions';\nimport { Role } from '../application/ApplicationTypes';\nimport {\n  AssessmentConfiguration,\n  AssessmentOverview,\n  AssessmentStatuses,\n  AssessmentType,\n  GradingStatuses\n} from '../assessment/AssessmentTypes';\nimport Constants from '../utils/Constants';\nimport { useTypedSelector } from '../utils/Hooks';\nimport ProfileCard from './ProfileCard';\n\nexport type ProfileProps = OwnProps;\n\ntype StateProps = {\n  name?: string;\n  role?: Role;\n  assessmentOverviews?: AssessmentOverview[];\n  assessmentConfigurations?: AssessmentConfiguration[];\n  xp?: number;\n  courseId?: number;\n};\n\ntype OwnProps = {\n  isOpen: boolean;\n  onClose: () => void;\n};\n\nconst Profile: React.FC<ProfileProps> = props => {\n  // FIXME: `xp` is actually of type number | undefined here!\n  // Fix the session type, then remove the typecast below\n  const { name, role, assessmentOverviews, assessmentConfigurations, xp, courseId } =\n    useTypedSelector(state => state.session) as StateProps;\n\n  const dispatch = useDispatch();\n  useEffect(() => {\n    if (name && role && !assessmentOverviews) {\n      // If assessment overviews are not loaded, fetch them\n      dispatch(fetchAssessmentOverviews());\n    }\n  }, [assessmentOverviews, dispatch, name, role, xp]);\n\n  useEffect(() => {\n    if (courseId && !xp) {\n      dispatch(fetchTotalXp());\n    }\n  }, [courseId, dispatch, xp]);\n\n  const [isLoaded, setIsLoaded] = useState(name && role && assessmentOverviews);\n\n  useEffect(() => {\n    setIsLoaded(name && role && assessmentOverviews);\n  }, [assessmentOverviews, name, role]);\n\n  // Render\n  let content: JSX.Element;\n\n  if (!isLoaded) {\n    content = <NonIdealState description=\"Loading...\" icon={<Spinner />} />;\n  } else {\n    // Check if there are any closed assessments, else render a placeholder <div>\n    const numClosed = assessmentOverviews!.filter(\n      item => item.status === AssessmentStatuses.submitted\n    ).length;\n\n    const userXp = xp || 0;\n    const caFulfillmentLevel = Constants.caFulfillmentLevel;\n    const fullXp = caFulfillmentLevel * 1000;\n\n    const userDetails = (\n      <div className=\"profile-header\">\n        <div className=\"profile-username\">\n          <div className=\"name\">{name}</div>\n          <div className=\"role\">{role}</div>\n        </div>\n      </div>\n    );\n\n    if (numClosed === 0) {\n      content = (\n        <div className=\"profile-content\">\n          {userDetails}\n          <div className=\"profile-placeholder\">\n            There are no closed assessments to render grade and XP of.\n          </div>\n        </div>\n      );\n    } else {\n      // Performs boundary checks if denominator is 0 or if it exceeds 1 (100%)\n      const getFrac = (num: number, den: number): number => {\n        return den <= 0 || num / den > 1 ? 1 : num / den;\n      };\n\n      // Given a fraction between 0 and 1 inclusive, returns a className to apply colour with CSS\n      const parseColour = (frac: number): string => {\n        return frac < 0\n          ? ''\n          : frac >= 0.8\n          ? ' progress-steelblue'\n          : frac >= 0.45\n          ? ' progress-deepskyblue'\n          : ' progress-skyblue';\n      };\n\n      // Given an assessment category, return its icon\n      const renderIcon = (assessmentType: AssessmentType) => {\n        const icons: IconName[] = [\n          IconNames.FLAME,\n          IconNames.LIGHTBULB,\n          IconNames.PREDICTIVE_ANALYSIS,\n          IconNames.COMPARISON,\n          IconNames.MANUAL\n        ];\n        if (assessmentConfigurations) {\n          const index = assessmentConfigurations.findIndex(c => c.type === assessmentType);\n\n          // For rendering hidden assessments not visible to the student\n          // e.g. studio participation marks\n          return index > 0 ? icons[index] : IconNames.PULSE;\n        } else {\n          // Should never hit this case as there are no assessments, submissions or answers\n          // if there are no assessmentTypes\n          return IconNames.PULSE;\n        }\n      };\n\n      // Build condensed assessment cards from an array of assessments\n      const summaryCallouts = assessmentOverviews!\n        .filter(\n          item =>\n            item.status === AssessmentStatuses.submitted &&\n            (item.gradingStatus === GradingStatuses.graded ||\n              item.gradingStatus === GradingStatuses.excluded)\n        )\n        .map((assessment, index) => {\n          return (\n            <ProfileCard\n              key={index}\n              item={assessment}\n              getFrac={getFrac}\n              parseColour={parseColour}\n              renderIcon={renderIcon}\n              courseId={courseId}\n            />\n          );\n        });\n\n      content = (\n        <div className=\"profile-content\">\n          {userDetails}\n\n          <div className=\"profile-progress\">\n            <div className=\"profile-xp\">\n              <Spinner\n                className={'profile-spinner' + parseColour(getFrac(userXp, fullXp))}\n                size={144}\n                value={getFrac(userXp, fullXp)}\n              />\n              <div className=\"type\">XP Progress</div>\n              <div className=\"total-value\">\n                {userXp} / {fullXp}*\n              </div>\n              <div className=\"percentage\">{(getFrac(userXp, fullXp) * 100).toFixed(2)}%</div>\n            </div>\n          </div>\n          <div className=\"profile-xp-footer\">\n            *{fullXp}XP needed to reach full CA level of {caFulfillmentLevel}\n          </div>\n          <div className=\"profile-callouts\">{summaryCallouts}</div>\n        </div>\n      );\n    }\n  }\n\n  return (\n    <Drawer\n      className=\"profile\"\n      icon={IconNames.USER}\n      isCloseButtonShown={true}\n      isOpen={props.isOpen}\n      onClose={props.onClose}\n      title=\"User Profile\"\n      position=\"left\"\n      size={DrawerSize.SMALL}\n    >\n      {content}\n    </Drawer>\n  );\n};\n\nexport default Profile;\n","import { Classes, Dialog } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport * as React from 'react';\n\nimport { Links } from '../utils/Constants';\n\ntype DialogProps = {\n  isOpen: boolean;\n  onClose: () => void;\n};\n\nconst DropdownAbout: React.SFC<DialogProps> = props => (\n  <Dialog\n    className=\"about\"\n    icon={IconNames.HELP}\n    isCloseButtonShown={true}\n    isOpen={props.isOpen}\n    onClose={props.onClose}\n    title=\"About\"\n  >\n    <div className={Classes.DIALOG_BODY}>\n      <div className=\"abt\">\n        <p>\n          The <i>Source Academy</i> is a computer-mediated learning environment for studying the\n          structure and interpretation of computer programs. Students write and run their programs\n          in their web browser, using sublanguages of JavaScript called{' '}\n          <a href={Links.sourceDocs}>Source</a>, designed for the textbook{' '}\n          <a href={Links.textbook}>\n            Structure and Interpretation of Computer Programs, JavaScript Edition\n          </a>\n          .\n        </p>\n        <p>\n          The Source Academy is available under the Apache License 2.0 at the GitHub organisation{' '}\n          <a href={Links.githubOrg}>source-academy</a>. More information and resources are available\n          at the <a href={Links.about}>about pages</a> of the Source Academy.\n        </p>\n      </div>\n    </div>\n  </Dialog>\n);\n\nexport default DropdownAbout;\n","import { Classes, Dialog, HTMLSelect } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport * as React from 'react';\n\nimport { Role } from '../application/ApplicationTypes';\nimport { UserCourse } from '../application/types/SessionTypes';\nimport { history } from '../utils/HistoryHelper';\n\ntype DialogProps = {\n  isOpen: boolean;\n  onClose: () => void;\n  courses: UserCourse[];\n  courseId?: number;\n};\n\nconst DropdownCourses: React.FC<DialogProps> = props => {\n  const { courses } = props;\n\n  const options = courses.map(course => ({\n    value: course.courseId,\n    label: course.courseName.concat(!course.viewable ? ' - disabled' : ''),\n    disabled: !course.viewable && course.role !== Role.Admin\n  }));\n\n  const onChangeHandler = (e: React.ChangeEvent<HTMLSelectElement>) => {\n    history.push(`/courses/${e.currentTarget.value}`);\n    props.onClose();\n  };\n\n  return (\n    <Dialog\n      className=\"my-courses\"\n      icon={IconNames.PROPERTIES}\n      isCloseButtonShown={true}\n      isOpen={props.isOpen}\n      onClose={props.onClose}\n      title=\"My Courses\"\n    >\n      <div className={Classes.DIALOG_BODY}>\n        <div>Select a course to switch to:</div>\n        <HTMLSelect\n          value={props.courseId}\n          options={options}\n          fill\n          onChange={onChangeHandler}\n          disabled={courses.length <= 1}\n        />\n      </div>\n    </Dialog>\n  );\n};\n\nexport default DropdownCourses;\n","import {\n  Button,\n  Classes,\n  Dialog,\n  FormGroup,\n  HTMLSelect,\n  InputGroup,\n  Switch,\n  Tab,\n  Tabs,\n  Text,\n  TextArea\n} from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport * as React from 'react';\n\nimport { CourseHelpTextEditorTab } from '../../pages/academy/adminPanel/subcomponents/CourseConfigPanel';\nimport { sourceLanguages } from '../application/ApplicationTypes';\nimport { UpdateCourseConfiguration } from '../application/types/SessionTypes';\nimport Markdown from '../Markdown';\nimport { showWarningMessage } from '../utils/NotificationsHelper';\n\ntype DialogProps = {\n  isOpen: boolean;\n  onClose: () => void;\n  handleCreateCourse: (courseConfig: UpdateCourseConfiguration) => void;\n};\n\nconst DropdownCreateCourse: React.FC<DialogProps> = props => {\n  const [courseConfig, setCourseConfig] = React.useState<UpdateCourseConfiguration>({\n    courseName: '',\n    courseShortName: '',\n    viewable: true,\n    enableGame: true,\n    enableAchievements: true,\n    enableSourcecast: true,\n    sourceChapter: Chapter.CALC,\n    sourceVariant: Variant.DEFAULT,\n    moduleHelpText: ''\n  });\n\n  const [courseHelpTextSelectedTab, setCourseHelpTextSelectedTab] =\n    React.useState<CourseHelpTextEditorTab>(CourseHelpTextEditorTab.WRITE);\n\n  const sourceChapterOptions = [\n    { value: Chapter.CALC }\n  ];\n\n  const sourceVariantOptions = (chapter: Chapter) =>\n    sourceLanguages\n      .filter(e => e.chapter === chapter)\n      .map(e => {\n        return {\n          label: e.variant.replace(/^\\w/, c => c.toUpperCase()),\n          value: e.variant\n        };\n      });\n\n  const submitHandler = () => {\n    // Validate that courseName is not an empty string\n    if (courseConfig.courseName === '') {\n      showWarningMessage('Course Name cannot be empty!');\n      return;\n    }\n    props.handleCreateCourse(courseConfig);\n    props.onClose();\n  };\n\n  const onChangeTabs = React.useCallback(\n    (\n      newTabId: CourseHelpTextEditorTab,\n      prevTabId: CourseHelpTextEditorTab,\n      event: React.MouseEvent<HTMLElement>\n    ) => {\n      if (newTabId === prevTabId) {\n        return;\n      }\n      setCourseHelpTextSelectedTab(newTabId);\n    },\n    [setCourseHelpTextSelectedTab]\n  );\n\n  return (\n    <Dialog\n      className=\"create-course\"\n      icon={IconNames.ADD}\n      isCloseButtonShown={true}\n      canOutsideClickClose={false}\n      isOpen={props.isOpen}\n      onClose={props.onClose}\n      title=\"Create Course\"\n    >\n      <div className={Classes.DIALOG_BODY}>\n        <div>\n          <b>Create your own Source Academy course and manage your own learners!</b>\n        </div>\n        <br />\n        <FormGroup\n          helperText=\"Please enter the course name that will be used for course selection\"\n          label=\"Course Name\"\n          labelInfo=\"(* required)\"\n          labelFor=\"courseName\"\n        >\n          <InputGroup\n            id=\"courseName\"\n            value={courseConfig.courseName}\n            onChange={e =>\n              setCourseConfig({\n                ...courseConfig,\n                courseName: e.target.value\n              })\n            }\n          />\n        </FormGroup>\n        <FormGroup\n          helperText=\"Usually the module code of the course. This will be displayed on the top left.\"\n          label={'Course Short Name'}\n          labelInfo=\"(optional)\"\n          labelFor=\"courseShortName\"\n        >\n          <InputGroup\n            id=\"courseShortName\"\n            value={courseConfig.courseShortName}\n            onChange={e =>\n              setCourseConfig({\n                ...courseConfig,\n                courseShortName: e.target.value\n              })\n            }\n          />\n        </FormGroup>\n        <FormGroup\n          helperText=\"The module help text will be used in the course help dialog.\"\n          labelFor=\"moduleHelpText\"\n        >\n          <Text tagName=\"span\">Module Help Text&nbsp;</Text>\n          <Text tagName=\"span\" className=\"optional-text\">\n            (optional)\n          </Text>\n          <Tabs\n            selectedTabId={courseHelpTextSelectedTab}\n            onChange={onChangeTabs}\n            className=\"module-help-text-tabs\"\n          >\n            <Tab id={CourseHelpTextEditorTab.WRITE} title=\"Write\" />\n            <Tab id={CourseHelpTextEditorTab.PREVIEW} title=\"Preview\" />\n          </Tabs>\n          {courseHelpTextSelectedTab === CourseHelpTextEditorTab.WRITE && (\n            <TextArea\n              id=\"moduleHelpText\"\n              className=\"input-textarea\"\n              fill={true}\n              value={courseConfig.moduleHelpText}\n              onChange={e =>\n                setCourseConfig({\n                  ...courseConfig,\n                  moduleHelpText: e.target.value\n                })\n              }\n            />\n          )}\n          {courseHelpTextSelectedTab === CourseHelpTextEditorTab.PREVIEW && (\n            <div className=\"input-markdown\">\n              <Markdown content={courseConfig.moduleHelpText || ''} openLinksInNewWindow />\n            </div>\n          )}\n        </FormGroup>\n\n        <div className=\"boolean-container\">\n          <div>\n            <Switch\n              checked={courseConfig.viewable}\n              inline\n              label=\"Viewable\"\n              onChange={e =>\n                setCourseConfig({\n                  ...courseConfig,\n                  viewable: (e.target as HTMLInputElement).checked\n                })\n              }\n            />\n            <Switch\n              checked={courseConfig.enableAchievements}\n              inline\n              label=\"Enable Achievements\"\n              onChange={e =>\n                setCourseConfig({\n                  ...courseConfig,\n                  enableAchievements: (e.target as HTMLInputElement).checked\n                })\n              }\n            />\n          </div>\n          <div>\n            <Switch\n              checked={courseConfig.enableGame}\n              inline\n              label=\"Enable Game\"\n              onChange={e =>\n                setCourseConfig({\n                  ...courseConfig,\n                  enableGame: (e.target as HTMLInputElement).checked\n                })\n              }\n            />\n\n            <Switch\n              checked={courseConfig.enableSourcecast}\n              inline\n              label=\"Enable Sourcecast\"\n              onChange={e =>\n                setCourseConfig({\n                  ...courseConfig,\n                  enableSourcecast: (e.target as HTMLInputElement).checked\n                })\n              }\n            />\n          </div>\n        </div>\n        <div>\n          <FormGroup\n            label=\"Default Source Chapter\"\n            labelInfo=\"(configurable later on)\"\n            labelFor=\"source-chapter\"\n          >\n            <HTMLSelect\n              id=\"source-chapter\"\n              options={sourceChapterOptions}\n              value={courseConfig.sourceChapter}\n              onChange={e => {\n                setCourseConfig({\n                  ...courseConfig,\n                  sourceChapter: parseInt(e.target.value)\n                });\n              }}\n              fill\n            />\n          </FormGroup>\n          <FormGroup\n            label=\"Default Source Variant\"\n            labelInfo=\"(configurable later on)\"\n            labelFor=\"source-variant\"\n          >\n            <HTMLSelect\n              id=\"source-variant\"\n              options={sourceVariantOptions(courseConfig.sourceChapter!)}\n              value={courseConfig.sourceVariant}\n              onChange={e => {\n                setCourseConfig({\n                  ...courseConfig,\n                  sourceVariant: e.target.value as Variant\n                });\n              }}\n              fill\n            />\n          </FormGroup>\n        </div>\n        <div className=\"create-course-button-container\">\n          <Button text=\"Create Course\" onClick={submitHandler} />\n        </div>\n      </div>\n    </Dialog>\n  );\n};\n\nexport default DropdownCreateCourse;\n","import { Classes, Dialog } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport * as React from 'react';\n\nimport Markdown from '../Markdown';\nimport { Links } from '../utils/Constants';\nimport { useTypedSelector } from '../utils/Hooks';\n\ntype DialogProps = {\n  isOpen: boolean;\n  onClose: () => void;\n};\n\nconst DropdownHelp: React.SFC<DialogProps> = props => {\n  const moduleHelpText = useTypedSelector(store => store.session.moduleHelpText);\n\n  return (\n    <Dialog\n      className=\"help\"\n      icon={IconNames.ERROR}\n      isCloseButtonShown={true}\n      isOpen={props.isOpen}\n      onClose={props.onClose}\n      title=\"Help\"\n    >\n      <div className={Classes.DIALOG_BODY}>\n        {moduleHelpText ? (\n          <Markdown content={moduleHelpText} openLinksInNewWindow />\n        ) : (\n          <>\n            <p>\n              We recommend recent updates of the browsers <b>Google Chrome</b>,{' '}\n              <b>Microsoft Edge</b>, or <b>Mozilla Firefox</b> to visit the Source Academy.\n            </p>\n            <p>\n              If you encounter issues with the Source Academy using these browsers, please use the\n              issue system of the{' '}\n              <a href={Links.githubIssues}>Source Academy frontend repository on GitHub</a>.\n            </p>\n          </>\n        )}\n      </div>\n    </Dialog>\n  );\n};\nexport default DropdownHelp;\n","import { Classes, Dialog, FormGroup, HTMLSelect, Icon, PopoverPosition } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport { useContext, useMemo } from 'react';\n\nimport { EditorBinding, WorkspaceSettingsContext } from '../WorkspaceSettingsContext';\n\ntype DialogProps = {\n  isOpen: boolean;\n  onClose: () => void;\n};\n\nconst DropdownSettings: React.FC<DialogProps> = props => {\n  const [workspaceSettings, setWorkspaceSettings] = useContext(WorkspaceSettingsContext)!;\n\n  const options = useMemo(\n    () => [\n      {\n        label: 'None',\n        value: EditorBinding.NONE\n      },\n      {\n        label: 'Vim',\n        value: EditorBinding.VIM\n      },\n      {\n        label: 'Emacs',\n        value: EditorBinding.EMACS\n      }\n    ],\n    []\n  );\n\n  const handleEditorBindingChange: React.ChangeEventHandler<HTMLSelectElement> = e => {\n    setWorkspaceSettings({\n      ...workspaceSettings,\n      // Typecast to EditorBinding here is ok since the HTMLSelect only contains 'EditorBinding' options\n      editorBinding: e.target.value as EditorBinding\n    });\n  };\n\n  return (\n    <Dialog\n      className=\"settings\"\n      icon={IconNames.COG}\n      isCloseButtonShown={true}\n      isOpen={props.isOpen}\n      onClose={props.onClose}\n      title=\"Settings\"\n    >\n      <div className={Classes.DIALOG_BODY}>\n        <FormGroup label=\"Editor Binding: \" labelFor=\"editor-binding\" inline>\n          <HTMLSelect\n            id=\"editor-binding\"\n            options={options}\n            value={workspaceSettings.editorBinding}\n            onChange={handleEditorBindingChange}\n          />\n          <Tooltip2\n            position={PopoverPosition.TOP}\n            className=\"form-field-help-text\"\n            content={\n              \"Optional editor bindings for advanced users. Set to 'None' for default text editor behaviour.\"\n            }\n          >\n            <Icon icon=\"help\" />\n          </Tooltip2>\n        </FormGroup>\n      </div>\n    </Dialog>\n  );\n};\n\nexport default DropdownSettings;\n","import { Menu, MenuItem, Position } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Popover2 } from '@blueprintjs/popover2';\nimport React, { useState } from 'react';\n\nimport { UpdateCourseConfiguration, UserCourse } from '../application/types/SessionTypes';\nimport ControlButton from '../ControlButton';\nimport Profile from '../profile/Profile';\nimport DropdownAbout from './DropdownAbout';\nimport DropdownCourses from './DropdownCourses';\nimport DropdownCreateCourse from './DropdownCreateCourse';\nimport DropdownHelp from './DropdownHelp';\nimport DropdownSettings from './DropdownSettings';\n\ntype DropdownProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleLogOut: () => void;\n  handleCreateCourse: (courseConfig: UpdateCourseConfiguration) => void;\n};\n\ntype StateProps = {\n  name?: string;\n  courses: UserCourse[];\n  courseId?: number;\n};\n\nconst Dropdown: React.FC<DropdownProps> = props => {\n  const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n  const [isAboutOpen, setIsAboutOpen] = useState(false);\n  const [isHelpOpen, setIsHelpOpen] = useState(false);\n  const [isProfileOpen, setIsProfileOpen] = useState(false);\n  const [isMyCoursesOpen, setIsMyCoursesOpen] = useState(false);\n  const [isCreateCourseOpen, setIsCreateCourseOpen] = useState(false);\n\n  function menu(props: DropdownProps) {\n    const profile =\n      props.name && props.courseId != null ? (\n        <MenuItem icon={IconNames.USER} onClick={toggleProfileOpen} text={titleCase(props.name)} />\n      ) : null;\n\n    const myCourses = props.name ? (\n      <MenuItem icon={IconNames.PROPERTIES} onClick={toggleMyCoursesOpen} text=\"My Courses\" />\n    ) : null;\n\n    const createCourse = props.name ? (\n      <MenuItem icon={IconNames.ADD} onClick={toggleCreateCourseOpen} text=\"Create Course\" />\n    ) : null;\n\n    const logout = props.name ? (\n      <MenuItem icon={IconNames.LOG_OUT} text=\"Logout\" onClick={props.handleLogOut} />\n    ) : null;\n\n    return (\n      <Menu>\n        {profile}\n        {myCourses}\n        {createCourse}\n        <MenuItem icon={IconNames.COG} onClick={toggleSettingsOpen} text=\"Settings\" />\n        <MenuItem icon={IconNames.HELP} onClick={toggleAboutOpen} text=\"About\" />\n        <MenuItem icon={IconNames.ERROR} onClick={toggleHelpOpen} text=\"Help\" />\n        {logout}\n      </Menu>\n    );\n  }\n\n  const toggleSettingsOpen = () => {\n    setIsSettingsOpen(oldValue => !oldValue);\n  };\n\n  const toggleAboutOpen = () => {\n    setIsAboutOpen(oldValue => !oldValue);\n  };\n\n  const toggleHelpOpen = () => setIsHelpOpen(oldValue => !oldValue);\n\n  const toggleProfileOpen = () => setIsProfileOpen(oldValue => !oldValue);\n\n  const toggleMyCoursesOpen = () => setIsMyCoursesOpen(oldValue => !oldValue);\n\n  const toggleCreateCourseOpen = () => setIsCreateCourseOpen(oldValue => !oldValue);\n\n  return (\n    <>\n      <Popover2 content={menu(props)} inheritDarkTheme={false} placement={Position.BOTTOM}>\n        <ControlButton icon={IconNames.CARET_DOWN} />\n      </Popover2>\n      <DropdownSettings isOpen={isSettingsOpen} onClose={toggleSettingsOpen} />\n      <DropdownAbout isOpen={isAboutOpen} onClose={toggleAboutOpen} />\n      <DropdownHelp isOpen={isHelpOpen} onClose={toggleHelpOpen} />\n      {props.name ? (\n        <DropdownCourses\n          isOpen={isMyCoursesOpen}\n          onClose={toggleMyCoursesOpen}\n          courses={props.courses}\n          courseId={props.courseId}\n        />\n      ) : null}\n      {props.name ? (\n        <DropdownCreateCourse\n          isOpen={isCreateCourseOpen}\n          onClose={toggleCreateCourseOpen}\n          handleCreateCourse={props.handleCreateCourse}\n        />\n      ) : null}\n      {props.name ? <Profile isOpen={isProfileOpen} onClose={toggleProfileOpen} /> : null}\n    </>\n  );\n};\n\nconst titleCase = (str: string) =>\n  str.replace(/\\w\\S*/g, wrd => wrd.charAt(0).toUpperCase() + wrd.substr(1).toLowerCase());\n\nexport default Dropdown;\n","import { Alignment, Classes, Icon, Navbar, NavbarGroup } from '@blueprintjs/core';\nimport { IconName, IconNames } from '@blueprintjs/icons';\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport { AssessmentType } from 'src/commons/assessment/AssessmentTypes';\nimport { assessmentTypeLink } from 'src/commons/utils/ParamParseHelper';\n\nimport { Role } from '../../application/ApplicationTypes';\nimport NotificationBadgeContainer from '../../notificationBadge/NotificationBadgeContainer';\nimport { filterNotificationsByType } from '../../notificationBadge/NotificationBadgeHelper';\n\ntype OwnProps = {\n  courseId: number;\n  role: Role;\n  assessmentTypes?: AssessmentType[];\n};\n\nconst AcademyNavigationBar: React.FunctionComponent<OwnProps> = props => (\n  <Navbar className=\"NavigationBar secondary-navbar\">\n    <NavbarGroup align={Alignment.LEFT}>\n      {props.assessmentTypes?.map((assessmentType, idx) => (\n        <NavLink\n          to={`/courses/${props.courseId}/${assessmentTypeLink(assessmentType)}`}\n          activeClassName={Classes.ACTIVE}\n          className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n          key={idx}\n        >\n          <Icon icon={icons[idx]} />\n          <div className=\"navbar-button-text hidden-xs hidden-sm\">{assessmentType}</div>\n          <NotificationBadgeContainer\n            notificationFilter={filterNotificationsByType(assessmentType)}\n            disableHover={true}\n          />\n        </NavLink>\n      ))}\n    </NavbarGroup>\n    {props.role === Role.Admin || props.role === Role.Staff ? (\n      <NavbarGroup align={Alignment.RIGHT}>\n        <NavLink\n          to={`/courses/${props.courseId}/groundcontrol`}\n          activeClassName={Classes.ACTIVE}\n          className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n        >\n          <Icon icon={IconNames.SATELLITE} />\n          <div className=\"navbar-button-text hidden-xs hidden-sm\">Ground Control</div>\n        </NavLink>\n\n        <NavLink\n          to={`/courses/${props.courseId}/dashboard`}\n          activeClassName={Classes.ACTIVE}\n          className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n        >\n          <Icon icon={IconNames.GLOBE} />\n          <div className=\"navbar-button-text hidden-xs hidden-sm\">Dashboard</div>\n        </NavLink>\n\n        <NavLink\n          to={`/courses/${props.courseId}/sourcereel`}\n          activeClassName={Classes.ACTIVE}\n          className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n        >\n          <Icon icon={IconNames.MOBILE_VIDEO} />\n          <div className=\"navbar-button-text hidden-xs hidden-sm hidden-md\">Sourcereel</div>\n        </NavLink>\n\n        {props.role === Role.Admin && (\n          <NavLink\n            to={`/courses/${props.courseId}/xpcalculation`}\n            activeClassName={Classes.ACTIVE}\n            className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n          >\n            <Icon icon={IconNames.CALCULATOR} />\n            <div className=\"navbar-button-text hidden-xs hidden-sm\">XP Calculation</div>\n          </NavLink>\n        )}\n\n        <NavLink\n          to={`/courses/${props.courseId}/grading`}\n          activeClassName={Classes.ACTIVE}\n          className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n        >\n          <Icon icon={IconNames.ENDORSED} />\n          <div className=\"navbar-button-text hidden-xs hidden-sm hidden-md\">Grading</div>\n          <NotificationBadgeContainer\n            notificationFilter={filterNotificationsByType('Grading')}\n            disableHover={true}\n          />\n        </NavLink>\n\n        <NavLink\n          to={`/courses/${props.courseId}/storysimulator`}\n          activeClassName={Classes.ACTIVE}\n          className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n        >\n          <Icon icon={IconNames.CROWN} />\n          <div className=\"navbar-button-text hidden-xs hidden-sm hidden-md\">Story Simulator</div>\n        </NavLink>\n\n        {props.role === Role.Admin && (\n          <NavLink\n            to={`/courses/${props.courseId}/adminpanel`}\n            activeClassName={Classes.ACTIVE}\n            className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n          >\n            <Icon icon={IconNames.SETTINGS} />\n            <div className=\"navbar-button-text hidden-xs hidden-sm hidden-md hidden-lg\">\n              Admin Panel\n            </div>\n          </NavLink>\n        )}\n      </NavbarGroup>\n    ) : null}\n  </Navbar>\n);\n\nexport const icons: IconName[] = [\n  IconNames.FLAME,\n  IconNames.LIGHTBULB,\n  IconNames.PREDICTIVE_ANALYSIS,\n  IconNames.COMPARISON,\n  IconNames.MANUAL,\n  IconNames.GRAPH,\n  IconNames.LAB_TEST,\n  IconNames.CALCULATOR\n];\n\nexport default AcademyNavigationBar;\n","import { Classes, Drawer, Icon } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport { Role } from 'src/commons/application/ApplicationTypes';\nimport Constants from 'src/commons/utils/Constants';\nimport { assessmentTypeLink } from 'src/commons/utils/ParamParseHelper';\n\nimport { AssessmentType } from '../../assessment/AssessmentTypes';\nimport NotificationBadgeContainer from '../../notificationBadge/NotificationBadgeContainer';\nimport { filterNotificationsByType } from '../../notificationBadge/NotificationBadgeHelper';\nimport { icons } from './AcademyNavigationBar';\n\ntype NavigationBarMobileSideMenuProps = DrawerProps & OwnProps;\n\ntype DrawerProps = {\n  name?: string;\n  role?: Role;\n  isOpen: boolean;\n  onClose: () => void;\n  handleGitHubLogIn: () => void;\n  handleGitHubLogOut: () => void;\n};\n\ntype OwnProps = {\n  enableAchievements?: boolean;\n  enableSourcecast?: boolean;\n  assessmentTypes?: AssessmentType[];\n  courseId?: number;\n};\n\nconst NavigationBarMobileSideMenu: React.FC<NavigationBarMobileSideMenuProps> = props => (\n  <Drawer\n    isOpen={props.isOpen}\n    position=\"left\"\n    onClose={props.onClose}\n    title=\"\"\n    className={Classes.DARK}\n  >\n    {props.role ? (\n      props.assessmentTypes?.map((assessmentType, idx) => (\n        <NavLink\n          to={`/courses/${props.courseId}/${assessmentTypeLink(assessmentType)}`}\n          activeClassName={Classes.ACTIVE}\n          className={classNames(\n            'NavigationBar__link__mobile',\n            Classes.BUTTON,\n            Classes.MINIMAL,\n            Classes.LARGE\n          )}\n          onClick={props.onClose}\n          key={idx}\n        >\n          <Icon icon={icons[idx]} />\n          <div>{assessmentType}</div>\n          <NotificationBadgeContainer\n            notificationFilter={filterNotificationsByType(assessmentType)}\n            disableHover={true}\n          />\n        </NavLink>\n      ))\n    ) : (\n      <></>\n    )}\n\n    {props.role && props.enableSourcecast && (\n      <NavLink\n        activeClassName={Classes.ACTIVE}\n        className={classNames(\n          'NavigationBar__link__mobile',\n          Classes.BUTTON,\n          Classes.MINIMAL,\n          Classes.LARGE\n        )}\n        to={`/courses/${props.courseId}/sourcecast`}\n        onClick={props.onClose}\n      >\n        <Icon icon={IconNames.MUSIC} />\n        <div>Sourcecast</div>\n      </NavLink>\n    )}\n\n    {props.role && (\n      <NavLink\n        activeClassName={Classes.ACTIVE}\n        className={classNames(\n          'NavigationBar__link__mobile',\n          Classes.BUTTON,\n          Classes.MINIMAL,\n          Classes.LARGE\n        )}\n        to=\"/c-slang-frontend\"\n        onClick={props.onClose}\n      >\n        <Icon icon={IconNames.CODE} />\n        <div>Playground</div>\n      </NavLink>\n    )}\n\n    {Constants.enableGitHubAssessments && (\n      <NavLink\n        activeClassName={Classes.ACTIVE}\n        className={classNames(\n          'NavigationBar__link_mobile',\n          Classes.BUTTON,\n          Classes.MINIMAL,\n          Classes.LARGE\n        )}\n        to=\"/githubassessments\"\n        onClick={props.onClose}\n      >\n        <Icon icon={IconNames.BRIEFCASE} />\n        <div className=\"navbar-button-text\">Classroom</div>\n      </NavLink>\n    )}\n    {props.name && (\n      <NavLink\n        activeClassName={Classes.ACTIVE}\n        className={classNames(\n          'NavigationBar__link_mobile',\n          Classes.BUTTON,\n          Classes.MINIMAL,\n          Classes.LARGE\n        )}\n        to={`/sicpjs/`}\n        onClick={props.onClose}\n      >\n        <Icon icon={IconNames.BOOK} />\n        <div className=\"navbar-button-text\">SICP JS</div>\n      </NavLink>\n    )}\n    {props.role && props.enableAchievements && (\n      <NavLink\n        activeClassName={Classes.ACTIVE}\n        className={classNames(\n          'NavigationBar__link__mobile',\n          Classes.BUTTON,\n          Classes.MINIMAL,\n          Classes.LARGE\n        )}\n        to={`/courses/${props.courseId}/achievements`}\n        onClick={props.onClose}\n      >\n        <Icon icon={IconNames.MOUNTAIN} />\n        <div>Achievements</div>\n      </NavLink>\n    )}\n  </Drawer>\n);\n\nexport default NavigationBarMobileSideMenu;\n","import {\n  Alignment,\n  Button,\n  Classes,\n  Drawer,\n  FocusStyleManager,\n  Icon,\n  Navbar,\n  NavbarDivider,\n  NavbarGroup,\n  NavbarHeading,\n  Position\n} from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Popover2 } from '@blueprintjs/popover2';\nimport classNames from 'classnames';\nimport { Location } from 'history';\nimport * as React from 'react';\nimport { match, NavLink, Route, Switch, useLocation } from 'react-router-dom';\n\nimport { Role } from '../application/ApplicationTypes';\nimport { UpdateCourseConfiguration, UserCourse } from '../application/types/SessionTypes';\nimport { AssessmentType } from '../assessment/AssessmentTypes';\nimport Dropdown from '../dropdown/Dropdown';\nimport NotificationBadgeContainer from '../notificationBadge/NotificationBadgeContainer';\nimport { filterNotificationsByType } from '../notificationBadge/NotificationBadgeHelper';\nimport Constants from '../utils/Constants';\nimport { useResponsive } from '../utils/Hooks';\nimport { assessmentTypeLink } from '../utils/ParamParseHelper';\nimport AcademyNavigationBar, { icons } from './subcomponents/AcademyNavigationBar';\nimport NavigationBarMobileSideMenu from './subcomponents/NavigationBarMobileSideMenu';\n\ntype NavigationBarProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleLogOut: () => void;\n  handleGitHubLogIn: () => void;\n  handleGitHubLogOut: () => void;\n  handleCreateCourse: (courseConfig: UpdateCourseConfiguration) => void;\n};\n\ntype StateProps = {\n  role?: Role;\n  name?: string;\n  courses: UserCourse[];\n  courseId?: number;\n  courseShortName?: string;\n  enableAchievements?: boolean;\n  enableSourcecast?: boolean;\n  assessmentTypes?: AssessmentType[];\n};\n\nconst matchSourcecastAchievement = /^\\/courses\\/\\d+\\/(sourcecast|achievements)/;\nconst matchExceptSourcecastAchievement = (match: match | null, location: Location) => {\n  if (!match) {\n    return false;\n  }\n\n  if (matchSourcecastAchievement.test(location.pathname)) {\n    return false;\n  }\n\n  return true;\n};\n\nconst NavigationBar: React.FC<NavigationBarProps> = props => {\n  const [mobileSideMenuOpen, setMobileSideMenuOpen] = React.useState(false);\n  const { isMobileBreakpoint } = useResponsive();\n  const location = useLocation();\n\n  FocusStyleManager.onlyShowFocusOnTabs();\n\n  // Handles both the desktop and mobile versions of the playground-only left navbar group\n  const playgroundOnlyNavbarLeft = Constants.enableGitHubAssessments ? (\n    isMobileBreakpoint ? (\n      <>\n        <NavbarGroup align={Alignment.LEFT}>\n          <Button\n            onClick={() => setMobileSideMenuOpen(!mobileSideMenuOpen)}\n            icon={IconNames.MENU}\n            large={true}\n            minimal={true}\n          />\n          <NavLink\n            className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n            to=\"/\"\n          >\n            <Icon icon={IconNames.SYMBOL_DIAMOND} />\n            <NavbarHeading style={{ paddingBottom: '0px' }}>Source Academy</NavbarHeading>\n          </NavLink>\n          <Drawer\n            isOpen={mobileSideMenuOpen}\n            position=\"left\"\n            onClose={() => setMobileSideMenuOpen(false)}\n            title=\"\"\n            className={Classes.DARK}\n          >\n            <NavLink\n              activeClassName={Classes.ACTIVE}\n              className={classNames(\n                'NavigationBar__link__mobile',\n                Classes.BUTTON,\n                Classes.MINIMAL,\n                Classes.LARGE\n              )}\n              to=\"/c-slang-frontend\"\n              onClick={() => setMobileSideMenuOpen(false)}\n            >\n              <Icon icon={IconNames.CODE} />\n              <div>Playground</div>\n            </NavLink>\n            <NavLink\n              activeClassName={Classes.ACTIVE}\n              className={classNames(\n                'NavigationBar__link__mobile',\n                Classes.BUTTON,\n                Classes.MINIMAL,\n                Classes.LARGE\n              )}\n              to=\"/githubassessments/missions\"\n              onClick={() => setMobileSideMenuOpen(false)}\n            >\n              <Icon icon={IconNames.BRIEFCASE} />\n              <div>Classroom</div>\n            </NavLink>\n          </Drawer>\n        </NavbarGroup>\n      </>\n    ) : (\n      <NavbarGroup align={Alignment.LEFT}>\n        <NavLink\n          activeClassName={Classes.ACTIVE}\n          className={classNames('NavigationBar__link__mobile', Classes.BUTTON, Classes.MINIMAL)}\n          to=\"/c-slang-frontend\"\n        >\n          <Icon icon={IconNames.CODE} />\n          <div>Playground</div>\n        </NavLink>\n        <NavLink\n          activeClassName={Classes.ACTIVE}\n          className={classNames('NavigationBar__link__mobile', Classes.BUTTON, Classes.MINIMAL)}\n          to=\"/githubassessments\"\n        >\n          <Icon icon={IconNames.BRIEFCASE} />\n          <div>Classroom</div>\n        </NavLink>\n      </NavbarGroup>\n    )\n  ) : (\n    <NavbarGroup align={Alignment.LEFT}>\n      <NavLink\n        activeClassName={Classes.ACTIVE}\n        className={classNames('NavigationBar__link__mobile', Classes.BUTTON, Classes.MINIMAL)}\n        to=\"/c-slang-frontend\"\n      >\n        <Icon icon={IconNames.CODE} />\n        <div>Playground</div>\n      </NavLink>\n    </NavbarGroup>\n  );\n\n  // Handles the Source Academy @ NUS left mobile navbar group\n  const mobileNavbarLeft = (\n    <NavbarGroup align={Alignment.LEFT}>\n      {(props.role || Constants.enableGitHubAssessments) && (\n        <Button\n          onClick={() => setMobileSideMenuOpen(!mobileSideMenuOpen)}\n          icon={IconNames.MENU}\n          large={true}\n          minimal={true}\n        />\n      )}\n\n      <NavLink\n        className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n        activeClassName={Classes.ACTIVE}\n        to={props.courseId == null ? '/welcome' : `/courses/${props.courseId}`}\n      >\n        <Icon icon={IconNames.SYMBOL_DIAMOND} />\n        <NavbarHeading style={{ paddingBottom: '0px' }}>\n          {props.courseShortName || 'Source Academy @ NUS'}\n        </NavbarHeading>\n      </NavLink>\n\n      {(props.role || Constants.enableGitHubAssessments) && (\n        <NavigationBarMobileSideMenu\n          name={props.name}\n          role={props.role}\n          courseId={props.courseId}\n          enableAchievements={props.enableAchievements}\n          enableSourcecast={props.enableSourcecast}\n          assessmentTypes={props.assessmentTypes}\n          isOpen={mobileSideMenuOpen}\n          onClose={() => setMobileSideMenuOpen(false)}\n          handleGitHubLogIn={() => props.handleGitHubLogIn}\n          handleGitHubLogOut={() => props.handleGitHubLogOut}\n        />\n      )}\n    </NavbarGroup>\n  );\n\n  const desktopNavbarLeftPopoverContent = (\n    <Navbar>\n      <NavbarGroup>\n        {props.assessmentTypes?.map((assessmentType, idx) => (\n          <NavLink\n            to={`/courses/${props.courseId}/${assessmentTypeLink(assessmentType)}`}\n            activeClassName={Classes.ACTIVE}\n            className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n            key={assessmentType}\n          >\n            <Icon icon={icons[idx]} />\n            <div className=\"navbar-button-text\">{assessmentType}</div>\n            <NotificationBadgeContainer\n              notificationFilter={filterNotificationsByType(assessmentType)}\n              disableHover={true}\n            />\n          </NavLink>\n        ))}\n      </NavbarGroup>\n    </Navbar>\n  );\n\n  const desktopLogoButton = (\n    <NavLink\n      activeClassName={Classes.ACTIVE}\n      className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n      to={props.courseId == null ? '/welcome' : `/courses/${props.courseId}`}\n      isActive={matchExceptSourcecastAchievement}\n    >\n      <Icon icon={IconNames.SYMBOL_DIAMOND} />\n      <NavbarHeading style={{ paddingBottom: '0px' }}>\n        {props.courseShortName || 'Source Academy @ NUS'}\n      </NavbarHeading>\n    </NavLink>\n  );\n\n  const enableDesktopPopoverIn = [\n    '/playground',\n    '/contributors',\n    `/courses/${props.courseId}/sourcecast`,\n    `/courses/${props.courseId}/achievements`\n  ];\n  const enableDesktopPopover =\n    props.courseId != null && !!enableDesktopPopoverIn.find(x => location.pathname.startsWith(x));\n\n  // Handles the Source Academy @ NUS left desktop navbar group\n  const desktopNavbarLeft = (\n    <NavbarGroup align={Alignment.LEFT}>\n      {enableDesktopPopover ? (\n        <Popover2\n          position={Position.BOTTOM_RIGHT}\n          interactionKind=\"hover\"\n          content={desktopNavbarLeftPopoverContent}\n          popoverClassName={'desktop-navbar-popover'}\n        >\n          {desktopLogoButton}\n        </Popover2>\n      ) : (\n        desktopLogoButton\n      )}\n\n      {props.role && props.enableSourcecast && (\n        <NavLink\n          activeClassName={Classes.ACTIVE}\n          className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n          to={`/courses/${props.courseId}/sourcecast`}\n        >\n          <Icon icon={IconNames.MUSIC} />\n          <div className=\"navbar-button-text\">Sourcecast</div>\n        </NavLink>\n      )}\n      {props.role && (\n        <NavLink\n          activeClassName={Classes.ACTIVE}\n          className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n          to=\"/c-slang-frontend\"\n        >\n          <Icon icon={IconNames.CODE} />\n          <div className=\"navbar-button-text\">Playground</div>\n        </NavLink>\n      )}\n      {Constants.enableGitHubAssessments && (\n        <NavLink\n          activeClassName={Classes.ACTIVE}\n          className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n          to=\"/githubassessments\"\n        >\n          <Icon icon={IconNames.BRIEFCASE} />\n          <div className=\"navbar-button-text\">Classroom</div>\n        </NavLink>\n      )}\n      {props.name}\n      {props.role && props.enableAchievements && (\n        <NavLink\n          activeClassName={Classes.ACTIVE}\n          className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n          to={`/courses/${props.courseId}/achievements`}\n        >\n          <Icon icon={IconNames.MOUNTAIN} />\n          <div className=\"navbar-button-text\">Achievements</div>\n        </NavLink>\n      )}\n    </NavbarGroup>\n  );\n\n  const commonNavbarRight = (\n    <NavbarGroup align={Alignment.RIGHT}>\n      <NavLink\n        activeClassName={Classes.ACTIVE}\n        className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n        to=\"/contributors\"\n      >\n        <Icon icon={IconNames.HEART} />\n      </NavLink>\n\n      <div className=\"visible-xs\">\n        <NavbarDivider className=\"thin-divider\" />\n      </div>\n      <div className=\"hidden-xs\">\n        <NavbarDivider className=\"default-divider\" />\n      </div>\n\n      <Dropdown\n        handleLogOut={props.handleLogOut}\n        handleCreateCourse={props.handleCreateCourse}\n        courses={props.courses}\n        courseId={props.courseId}\n        name={props.name}\n      />\n    </NavbarGroup>\n  );\n\n  return (\n    <>\n      <Navbar className={classNames('NavigationBar', 'primary-navbar', Classes.DARK)}>\n        {Constants.playgroundOnly\n          ? playgroundOnlyNavbarLeft\n          : isMobileBreakpoint\n          ? mobileNavbarLeft\n          : desktopNavbarLeft}\n        {commonNavbarRight}\n      </Navbar>\n\n      <Switch>\n        <Route path=\"/c-slang-frontend\" />\n        <Route path=\"/githubassessments\" />\n        <Route path=\"/contributors\" />\n        <Route path=\"/courses/:courseId/sourcecast\" />\n        <Route path=\"/courses/:courseId/achievements\" />\n        <Route>\n          {!Constants.playgroundOnly && props.role && !isMobileBreakpoint && (\n            <AcademyNavigationBar\n              role={props.role}\n              assessmentTypes={props.assessmentTypes}\n              courseId={props.courseId!}\n            />\n          )}\n        </Route>\n      </Switch>\n    </>\n  );\n};\n\nexport default NavigationBar;\n","import { Button, Classes, Dialog, H4, Intent } from '@blueprintjs/core';\nimport moment from 'moment';\nimport * as React from 'react';\nimport { Redirect, Route, RouteComponentProps, Switch } from 'react-router';\n\nimport Academy from '../../pages/academy/Academy';\nimport Contributors from '../../pages/contributors/Contributors';\nimport Disabled from '../../pages/disabled/Disabled';\nimport GitHubClassroom from '../../pages/githubAssessments/GitHubClassroom';\nimport GitHubCallback from '../../pages/githubCallback/GitHubCallback';\nimport Login from '../../pages/login/Login';\nimport MissionControlContainer from '../../pages/missionControl/MissionControlContainer';\nimport Playground from '../../pages/playground/PlaygroundContainer';\nimport Welcome from '../../pages/welcome/Welcome';\nimport { AssessmentConfiguration } from '../assessment/AssessmentTypes';\nimport NavigationBar from '../navigationBar/NavigationBar';\nimport Constants from '../utils/Constants';\nimport { useLocalStorageState } from '../utils/Hooks';\nimport { defaultWorkspaceSettings, WorkspaceSettingsContext } from '../WorkspaceSettingsContext';\nimport { Role } from './ApplicationTypes';\nimport { UpdateCourseConfiguration, UserCourse } from './types/SessionTypes';\n\nexport type ApplicationProps = DispatchProps & StateProps & RouteComponentProps<{}>;\n\nexport type DispatchProps = {\n  handleLogOut: () => void;\n  handleGitHubLogIn: () => void;\n  handleGitHubLogOut: () => void;\n  fetchUserAndCourse: () => void;\n  handleCreateCourse: (courseConfig: UpdateCourseConfiguration) => void;\n  updateCourseResearchAgreement: (agreedToResearch: boolean) => void;\n};\n\nexport type StateProps = {\n  role?: Role;\n  name?: string;\n  courses: UserCourse[];\n  courseId?: number;\n  courseShortName?: string;\n  enableAchievements?: boolean;\n  enableSourcecast?: boolean;\n  assessmentConfigurations?: AssessmentConfiguration[];\n  agreedToResearch?: boolean | null;\n};\n\nconst loginPath = <Route path=\"/login\" component={Login} key=\"login\" />;\n\nconst Application: React.FC<ApplicationProps> = props => {\n  const intervalId = React.useRef<number | undefined>(undefined);\n  const [isDisabled, setIsDisabled] = React.useState(computeDisabledState());\n  const isMobile = /iPhone|iPad|Android/.test(navigator.userAgent);\n  const isPWA = window.matchMedia('(display-mode: standalone)').matches; // Checks if user is accessing from the PWA\n  const browserDimensions = React.useRef({ height: 0, width: 0 });\n\n  const [workspaceSettings, setWorkspaceSettings] = useLocalStorageState(\n    Constants.workspaceSettingsLocalStorageKey,\n    defaultWorkspaceSettings\n  );\n\n  const isLoggedIn = typeof props.name === 'string';\n  const isCourseLoaded = isLoggedIn && typeof props.role === 'string';\n\n  // Effect to fetch the latest user info and course configurations from the backend on refresh,\n  // if the user was previously logged in\n  React.useEffect(() => {\n    if (props.name) {\n      props.fetchUserAndCourse();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  React.useEffect(() => {\n    if (Constants.disablePeriods.length > 0) {\n      intervalId.current = window.setInterval(() => {\n        const disabled = computeDisabledState();\n        if (isDisabled !== disabled) {\n          setIsDisabled(disabled);\n        }\n      }, 5000);\n    }\n\n    return () => {\n      if (intervalId.current) {\n        window.clearInterval(intervalId.current);\n      }\n    };\n  }, [isDisabled]);\n\n  /**\n   * The following effect prevents the mobile browser interface from hiding on scroll by setting the\n   * application height to the window's innerHeight, even after orientation changes. This ensures that\n   * the app UI does not break due to the hiding of the browser interface when the user is not on the PWA.\n   *\n   * Note: When the soft keyboard is up on Android devices, the viewport height decreases and triggers\n   * the 'resize' event. The conditional in orientationChangeHandler checks specifically for this, and\n   * does not update the application height when the Android keyboard triggers the resize event. IOS\n   * devices are not affected.\n   */\n  React.useEffect(() => {\n    const orientationChangeHandler = () => {\n      if (\n        !(\n          window.innerHeight < browserDimensions.current.height &&\n          window.innerWidth === browserDimensions.current.width\n        )\n      ) {\n        // If it is not an Android soft keyboard triggering the resize event, update the application height.\n        document.documentElement.style.setProperty(\n          '--application-height',\n          window.innerHeight + 'px'\n        );\n      }\n      browserDimensions.current = { height: window.innerHeight, width: window.innerWidth };\n    };\n\n    if (!isPWA && isMobile) {\n      orientationChangeHandler();\n      window.addEventListener('resize', orientationChangeHandler);\n    }\n\n    return () => {\n      if (!isPWA && isMobile) {\n        window.removeEventListener('resize', orientationChangeHandler);\n      }\n    };\n  }, [isPWA, isMobile]);\n\n  // Paths common to both deployments\n  const commonPaths = [\n    <Route path=\"/contributors\" component={Contributors} key=\"contributors\" />,\n    <Route path=\"/callback/github\" component={GitHubCallback} key=\"githubCallback\" />,\n    Constants.enableGitHubAssessments ? (\n      <Route\n        path=\"/githubassessments\"\n        render={() => (\n          <GitHubClassroom\n            handleGitHubLogIn={props.handleGitHubLogIn}\n            handleGitHubLogOut={props.handleGitHubLogOut}\n          />\n        )}\n        key=\"githubAssessments\"\n      />\n    ) : null\n  ];\n\n  const isDisabledEffective = !['staff', 'admin'].includes(props.role!) && isDisabled;\n  return (\n    <WorkspaceSettingsContext.Provider value={[workspaceSettings, setWorkspaceSettings]}>\n      <div className=\"Application\">\n        <NavigationBar\n          handleLogOut={props.handleLogOut}\n          handleGitHubLogIn={props.handleGitHubLogIn}\n          handleGitHubLogOut={props.handleGitHubLogOut}\n          handleCreateCourse={props.handleCreateCourse}\n          role={props.role}\n          name={props.name}\n          courses={props.courses}\n          courseId={props.courseId}\n          courseShortName={props.courseShortName}\n          enableAchievements={props.enableAchievements}\n          enableSourcecast={props.enableSourcecast}\n          assessmentTypes={React.useMemo(\n            () => props.assessmentConfigurations?.map(c => c.type),\n            [props.assessmentConfigurations]\n          )}\n        />\n        <div className=\"Application__main\">\n          {isDisabledEffective && (\n            <Switch>\n              {!Constants.playgroundOnly && loginPath}\n              {/* if not logged in, and we're not a playground-only deploy, then redirect to login (for staff) */}\n              {!isCourseLoaded && !Constants.playgroundOnly\n                ? [\n                    <Route path=\"/courses\" render={redirectToLogin} key={0} />,\n                    <Route exact={true} path=\"/\" render={redirectToLogin} key={1} />\n                  ]\n                : []}\n              <Route>\n                <Disabled reason={typeof isDisabled === 'string' ? isDisabled : undefined} />\n              </Route>\n            </Switch>\n          )}\n          {!isDisabledEffective && Constants.playgroundOnly && (\n            <Switch>\n              {commonPaths}\n              <Route path=\"/\" component={Playground} />\n              <Route exact={true} path=\"/\">\n                <Redirect to=\"/\" />\n              </Route>\n              <Route component={Playground} />\n            </Switch>\n          )}\n          {!isDisabledEffective && !Constants.playgroundOnly && (\n            <Switch>\n              {loginPath}\n              {commonPaths}\n              <Route path={'/courses/:courseId(\\\\d+)?'} render={toAcademy(props)} />\n              <Route path=\"/welcome\" render={ensureUserAndRouteTo(props, <Welcome />)} />\n              <Route\n                path={'/mission-control/:assessmentId(-?\\\\d+)?/:questionId(\\\\d+)?'}\n                component={MissionControlContainer}\n              />\n              <Route\n                path=\"/c-slang-frontend\"\n                render={ensureUserAndRoleAndRouteTo(props, <Playground />)}\n              />\n\n              <Redirect\n                from=\"/\"\n                exact={true}\n                to={props.courseId != null ? `/courses/${props.courseId}` : '/welcome'}\n              />\n              {props.courseId != null && [\n                <Redirect\n                  from=\"/sourcecast/:splat?\"\n                  to={`/courses/${props.courseId}/sourcecast/:splat?`}\n                  key=\"legacy-sourcecast\"\n                />,\n                <Redirect\n                  from=\"/achievements/:splat?\"\n                  to={`/courses/${props.courseId}/achievements/:splat?`}\n                  key=\"legacy-achievements\"\n                />,\n                <Redirect\n                  from=\"/academy/:splat?\"\n                  to={`/courses/${props.courseId}/:splat?`}\n                  key=\"legacy-academy\"\n                />\n              ]}\n              <Route component={Playground} />\n            </Switch>\n          )}\n        </div>\n\n        {/* agreedToResearch has a default value of undefined in the store.\n            It will take on null/true/false when the backend returns. */}\n        {Constants.showResearchPrompt && props.agreedToResearch === null && (\n          <div className=\"research-prompt\">\n            <Dialog\n              className={Classes.DARK}\n              title=\"Agreement to Participate in Educational Research\"\n              canOutsideClickClose={false}\n              canEscapeKeyClose={false}\n              isCloseButtonShown={false}\n              isOpen\n            >\n              <div className={Classes.DIALOG_BODY}>\n                <H4>Welcome to your new Source Academy @ NUS course!</H4>\n                <div>\n                  Here at Source Academy @ NUS, our mission is to bring out the beauty and fun in\n                  programming and the ideas behind programming, and to make these ideas universally\n                  accessible. This includes educational research!\n                </div>\n                <br />\n                <div>\n                  We collect programs that students run in Source Academy @ NUS and store them\n                  anonymously for our research. You are free to opt out of this collection, with no\n                  penalty for you whatsoever. Contact your course instructor if you have questions\n                  or concerns about this research.\n                </div>\n              </div>\n              <div className={Classes.DIALOG_FOOTER}>\n                <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n                  <Button\n                    text=\"I would like to opt out\"\n                    onClick={() => props.updateCourseResearchAgreement(false)}\n                  />\n                  <Button\n                    text=\"I consent!\"\n                    intent={Intent.SUCCESS}\n                    onClick={() => props.updateCourseResearchAgreement(true)}\n                  />\n                </div>\n              </div>\n            </Dialog>\n          </div>\n        )}\n      </div>\n    </WorkspaceSettingsContext.Provider>\n  );\n};\n\nconst redirectToLogin = () => <Redirect to=\"/login\" />;\nconst redirectToWelcome = () => <Redirect to=\"/welcome\" />;\n\n/**\n * A user routes to /academy,\n *  1. If the user is logged in, render the Academy component\n *  2. If the user is not logged in, redirect to /login\n */\nconst toAcademy = ({ name, role }: ApplicationProps) =>\n  name === undefined ? redirectToLogin : role === undefined ? redirectToWelcome : () => <Academy />;\n\n/**\n * Routes a user to the specified route,\n *  1. If the user is logged in, render the specified component\n *  2. If the user is not logged in, redirect to /login\n */\nconst ensureUserAndRouteTo = ({ name }: ApplicationProps, to: JSX.Element) =>\n  name === undefined ? redirectToLogin : () => to;\n\n/**\n * Routes a user to the specified route,\n *  1. If the user is logged in and has a latest viewed course, render the\n *     specified component\n *  2. If the user is not logged in, redirect to /login\n *  3. If the user is logged in, but does not have a course, redirect to /welcome\n */\nconst ensureUserAndRoleAndRouteTo = ({ name, role }: ApplicationProps, to: JSX.Element) =>\n  name === undefined ? redirectToLogin : role === undefined ? redirectToWelcome : () => to;\n\nfunction computeDisabledState() {\n  const now = moment();\n  for (const { start, end, reason } of Constants.disablePeriods) {\n    if (start.isBefore(now) && end.isAfter(now)) {\n      return reason || true;\n    }\n  }\n  return false;\n}\n\nexport default Application;\n","import { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { withRouter } from 'react-router';\nimport { bindActionCreators, Dispatch } from 'redux';\nimport { createCourse } from 'src/features/academy/AcademyActions';\n\nimport { logOut } from './actions/CommonsActions';\nimport {\n  fetchUserAndCourse,\n  loginGitHub,\n  logoutGitHub,\n  updateCourseResearchAgreement\n} from './actions/SessionActions';\nimport Application, { DispatchProps, StateProps } from './Application';\nimport { OverallState } from './ApplicationTypes';\n\n/**\n * Provides the title of the application for display.\n * An object with the relevant properties must be\n * returned instead of an object of type @type {IApplicationProps},\n * as the routing properties of @type {RouteComponentProps} are\n * provided using the withRouter() method below.\n */\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => ({\n  role: state.session.role,\n  name: state.session.name,\n  courses: state.session.courses,\n  courseId: state.session.courseId,\n  courseShortName: state.session.courseShortName,\n  enableAchievements: state.session.enableAchievements,\n  enableSourcecast: state.session.enableSourcecast,\n  assessmentConfigurations: state.session.assessmentConfigurations,\n  agreedToResearch: state.session.agreedToResearch\n});\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleLogOut: logOut,\n      handleGitHubLogIn: loginGitHub,\n      handleGitHubLogOut: logoutGitHub,\n      fetchUserAndCourse: fetchUserAndCourse,\n      handleCreateCourse: createCourse,\n      updateCourseResearchAgreement: updateCourseResearchAgreement\n    },\n    dispatch\n  );\n\nconst ApplicationContainer = withRouter(connect(mapStateToProps, mapDispatchToProps)(Application));\n\nexport default ApplicationContainer;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://cra.link/PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL || '', window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL || ''}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://cra.link/PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      // Check for updates every 5 minutes\n      setInterval(() => {\n        try {\n          registration.update();\n        } catch {}\n      }, 300_000);\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://cra.link/PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import { BFSRequire, configure } from 'browserfs';\nimport { ApiError } from 'browserfs/dist/node/core/api_error';\nimport { FSModule } from 'browserfs/dist/node/core/FS';\nimport React, { createContext, ReactNode, useState } from 'react';\n\nexport const FileSystemContext = createContext<FSModule | undefined>(undefined);\n\ntype FileSystemProviderProps = {\n  children: ReactNode;\n};\n\nconst FileSystemProvider: React.FC<FileSystemProviderProps> = ({ children }) => {\n  const [fileSystem, setFileSystem] = useState<FSModule>();\n\n  configure(\n    {\n      fs: 'MountableFileSystem',\n      options: {\n        '/playground': {\n          fs: 'IndexedDB',\n          options: {\n            storeName: 'playground'\n          }\n        }\n      }\n    },\n    (err: ApiError | null | undefined) => {\n      if (err) {\n        console.error(err);\n      }\n      setFileSystem(BFSRequire('fs'));\n    }\n  );\n\n  return <FileSystemContext.Provider value={fileSystem}>{children}</FileSystemContext.Provider>;\n};\n\nexport default FileSystemProvider;\n","import 'src/styles/index.scss';\n\nimport * as Sentry from '@sentry/browser';\n// import { setModulesStaticURL } from 'c-slang/dist/modules/moduleLoader';\nimport { render } from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { Router } from 'react-router-dom';\nimport ApplicationContainer from 'src/commons/application/ApplicationContainer';\nimport Constants, { Links } from 'src/commons/utils/Constants';\nimport { history } from 'src/commons/utils/HistoryHelper';\nimport { showWarningMessage } from 'src/commons/utils/NotificationsHelper';\nimport { register as registerServiceWorker } from 'src/commons/utils/RegisterServiceWorker';\nimport { triggerSyncLogs } from 'src/features/eventLogging/client';\nimport { store } from 'src/pages/createStore';\n\nimport FileSystemProvider from './pages/fileSystem/FileSystemProvider';\n\nif (Constants.sentryDsn) {\n  Sentry.init({\n    dsn: Constants.sentryDsn,\n    environment: Constants.sourceAcademyEnvironment,\n    release: `cadet-frontend@${Constants.sourceAcademyVersion}`\n  });\n  const userId = store.getState().session.userId;\n  Sentry.setUser(typeof userId !== 'undefined' ? { id: userId.toString() } : null);\n}\n\nconst rootContainer = document.getElementById('root') as HTMLElement;\n(window as any).__REDUX_STORE__ = store; // need this for slang's display\nconsole.log(\n  `%cSource Academy ${Constants.sourceAcademyEnvironment}-${Constants.sourceAcademyVersion}; ` +\n    `Please visit ${Links.githubIssues} to report bugs or issues.`,\n  'font-weight: bold;'\n);\n\n// setModulesStaticURL(Constants.moduleBackendUrl);\n// console.log(`Using module backend: ${Constants.moduleBackendUrl}`);\n\nrender(\n  <Provider store={store}>\n    <FileSystemProvider>\n      <Router history={history}>\n        <ApplicationContainer />\n      </Router>\n    </FileSystemProvider>\n  </Provider>,\n  rootContainer\n);\n\nregisterServiceWorker({\n  onUpdate: () => {\n    showWarningMessage(\n      'A new version of Source Academy is available. Please refresh the browser.',\n      0\n    );\n  }\n});\n\nif (Constants.cadetLoggerUrl) {\n  // Seriously: registerServiceWorker onSuccess and onUpdate are separate paths.\n  // Neither of them actually fire in localhost...\n  const sync = () => triggerSyncLogs(store.getState().session.accessToken);\n  navigator.serviceWorker.ready.then(() => {\n    setInterval(sync, Constants.cadetLoggerInterval);\n  });\n}\n","export const SYNC_LOGS = 'SYNC_LOGS';\n\nexport function triggerSyncLogs(accessToken?: string) {\n  if (!accessToken) {\n    return;\n  }\n  navigator.serviceWorker.controller?.postMessage({ type: SYNC_LOGS, accessToken });\n}\n","import { Button, Icon, IconName, Intent } from '@blueprintjs/core';\nimport React from 'react';\n\ntype ButtonOptions = {\n  className: string;\n  fullWidth: boolean;\n  iconColor?: string;\n  iconOnRight: boolean;\n  intent: Intent;\n  minimal: boolean;\n  type?: 'submit' | 'reset' | 'button';\n};\n\ntype ControlButtonProps = {\n  label?: string;\n  icon?: IconName;\n  onClick?: () => void;\n  options?: Partial<ButtonOptions>;\n  isDisabled?: boolean;\n};\n\nconst defaultOptions = {\n  className: '',\n  fullWidth: false,\n  iconOnRight: false,\n  intent: Intent.NONE,\n  minimal: true\n};\n\nconst ControlButton: React.FC<ControlButtonProps> = ({\n  label = '',\n  icon,\n  onClick,\n  options = {},\n  isDisabled = false\n}) => {\n  const buttonOptions: ButtonOptions = { ...defaultOptions, ...options };\n  const iconElement = icon && <Icon icon={icon} color={buttonOptions.iconColor} />;\n\n  return (\n    <Button\n      disabled={isDisabled}\n      fill={buttonOptions.fullWidth}\n      intent={buttonOptions.intent}\n      minimal={buttonOptions.minimal}\n      className={buttonOptions.className}\n      type={buttonOptions.type}\n      onClick={onClick}\n      icon={!buttonOptions.iconOnRight && iconElement}\n      rightIcon={buttonOptions.iconOnRight && iconElement}\n    >\n      {label}\n    </Button>\n  );\n};\n\nexport default ControlButton;\n","export const SAVE_CANVAS = 'SAVE_CANVAS';\n\nexport const assessmentRegExp = ':assessmentId(\\\\d+)?/:questionId(\\\\d+)?';\nexport const gradingRegExp = ':submissionId(\\\\d+)?/:questionId(\\\\d+)?';\n\nexport const CREATE_COURSE = 'CREATE_COURSE';\nexport const ADD_NEW_USERS_TO_COURSE = 'ADD_NEW_USERS_TO_COURSE';\n\nexport type AcademyState = {\n  readonly gameCanvas?: HTMLCanvasElement;\n};\n","import { action } from 'typesafe-actions';\n\nimport { PersistenceFile } from '../persistence/PersistenceTypes';\nimport {\n  CHANGE_QUERY_STRING,\n  GENERATE_LZ_STRING,\n  PLAYGROUND_UPDATE_GITHUB_SAVE_INFO,\n  PLAYGROUND_UPDATE_PERSISTENCE_FILE,\n  SHORTEN_URL,\n  UPDATE_SHORT_URL\n} from './PlaygroundTypes';\n\nexport const generateLzString = () => action(GENERATE_LZ_STRING);\n\nexport const shortenURL = (keyword: string) => action(SHORTEN_URL, keyword);\n\nexport const updateShortURL = (shortURL: string) => action(UPDATE_SHORT_URL, shortURL);\n\nexport const changeQueryString = (queryString: string) => action(CHANGE_QUERY_STRING, queryString);\n\nexport const playgroundUpdatePersistenceFile = (file?: PersistenceFile) =>\n  action(PLAYGROUND_UPDATE_PERSISTENCE_FILE, file);\n\nexport const playgroundUpdateGitHubSaveInfo = (\n  repoName: string,\n  filePath: string,\n  lastSaved: Date\n) => action(PLAYGROUND_UPDATE_GITHUB_SAVE_INFO, { repoName, filePath, lastSaved });\n","import { WorkspaceState } from '../../../commons/workspace/WorkspaceTypes';\nimport {\n  CodeDelta,\n  Input,\n  PlaybackData,\n  PlaybackStatus,\n  SourcecastData\n} from '../SourceRecorderTypes';\n\nexport const FETCH_SOURCECAST_INDEX = 'FETCH_SOURCECAST_INDEX';\nexport const SET_IS_EDITOR_READONLY = 'SET_IS_EDITOR_READONLY';\nexport const UPDATE_SOURCECAST_INDEX = 'UPDATE_SOURCECAST_INDEX';\n\ntype SourcecastWorkspaceAttr = {\n  readonly audioUrl: string;\n  readonly codeDeltasToApply: CodeDelta[] | null;\n  readonly currentPlayerTime: number;\n  readonly description: string | null;\n  readonly inputToApply: Input | null;\n  readonly playbackData: PlaybackData;\n  readonly playbackDuration: number;\n  readonly playbackStatus: PlaybackStatus;\n  readonly sourcecastIndex: SourcecastData[] | null;\n  readonly title: string | null;\n  readonly uid: string | null;\n};\nexport type SourcecastWorkspaceState = SourcecastWorkspaceAttr & WorkspaceState;\n","import { Context } from 'c-slang';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport { action } from 'typesafe-actions';\n\nimport { SET_IS_EDITOR_READONLY } from '../../features/sourceRecorder/sourcecast/SourcecastTypes';\nimport { SALanguage } from '../application/ApplicationTypes';\nimport { ExternalLibraryName } from '../application/types/ExternalTypes';\nimport { HIGHLIGHT_LINE } from '../application/types/InterpreterTypes';\nimport { Library } from '../assessment/AssessmentTypes';\nimport { Position } from '../editor/EditorTypes';\nimport { NOTIFY_PROGRAM_EVALUATED } from '../sideContent/SideContentTypes';\nimport {\n  ADD_HTML_CONSOLE_ERROR,\n  BEGIN_CLEAR_CONTEXT,\n  BROWSE_REPL_HISTORY_DOWN,\n  BROWSE_REPL_HISTORY_UP,\n  CHANGE_EXEC_TIME,\n  CHANGE_EXTERNAL_LIBRARY,\n  CHANGE_SIDE_CONTENT_HEIGHT,\n  CHANGE_STEP_LIMIT,\n  CHANGE_SUBLANGUAGE,\n  CHAPTER_SELECT,\n  CHECK_EDITOR,\n  CLEAR_REPL_INPUT,\n  CLEAR_REPL_OUTPUT,\n  CLEAR_REPL_OUTPUT_LAST,\n  EditorTabState,\n  END_CLEAR_CONTEXT,\n  EVAL_EDITOR,\n  EVAL_EDITOR_AND_TESTCASES,\n  EVAL_REPL,\n  EVAL_TESTCASE,\n  MOVE_CURSOR,\n  NAV_DECLARATION,\n  PLAYGROUND_EXTERNAL_SELECT,\n  PROMPT_AUTOCOMPLETE,\n  RESET_TESTCASE,\n  RESET_WORKSPACE,\n  SEND_REPL_INPUT_TO_OUTPUT,\n  TOGGLE_EDITOR_AUTORUN,\n  TOGGLE_USING_SUBST,\n  UPDATE_ACTIVE_EDITOR_TAB,\n  UPDATE_CURRENT_ASSESSMENT_ID,\n  UPDATE_CURRENT_SUBMISSION_ID,\n  UPDATE_EDITOR_BREAKPOINTS,\n  UPDATE_EDITOR_VALUE,\n  UPDATE_HAS_UNSAVED_CHANGES,\n  UPDATE_REPL_VALUE,\n  UPDATE_SUBLANGUAGE,\n  UPDATE_WORKSPACE,\n  WorkspaceLocation,\n  WorkspaceState\n} from './WorkspaceTypes';\n\nexport const browseReplHistoryDown = (workspaceLocation: WorkspaceLocation) =>\n  action(BROWSE_REPL_HISTORY_DOWN, { workspaceLocation });\n\nexport const browseReplHistoryUp = (workspaceLocation: WorkspaceLocation) =>\n  action(BROWSE_REPL_HISTORY_UP, { workspaceLocation });\n\nexport const changeExternalLibrary = (newExternal: string, workspaceLocation: WorkspaceLocation) =>\n  action(CHANGE_EXTERNAL_LIBRARY, { newExternal, workspaceLocation });\n\nexport const changeExecTime = (execTime: number, workspaceLocation: WorkspaceLocation) =>\n  action(CHANGE_EXEC_TIME, { execTime, workspaceLocation });\n\nexport const changeSideContentHeight = (height: number, workspaceLocation: WorkspaceLocation) =>\n  action(CHANGE_SIDE_CONTENT_HEIGHT, { height, workspaceLocation });\n\nexport const changeStepLimit = (stepLimit: number, workspaceLocation: WorkspaceLocation) =>\n  action(CHANGE_STEP_LIMIT, { stepLimit, workspaceLocation });\n\nexport const chapterSelect = (\n  chapter: Chapter,\n  variant: Variant,\n  workspaceLocation: WorkspaceLocation\n) =>\n  action(CHAPTER_SELECT, {\n    chapter,\n    variant,\n    workspaceLocation\n  });\n\nexport const externalLibrarySelect = (\n  externalLibraryName: ExternalLibraryName,\n  workspaceLocation: WorkspaceLocation,\n  initialise?: boolean\n) =>\n  action(PLAYGROUND_EXTERNAL_SELECT, {\n    externalLibraryName,\n    workspaceLocation,\n    initialise: initialise || false\n  });\n\nexport const toggleEditorAutorun = (workspaceLocation: WorkspaceLocation) =>\n  action(TOGGLE_EDITOR_AUTORUN, { workspaceLocation });\n\n/**\n * Starts the process to clear the c-slang Context\n * at a specified workspace location.\n *\n * This action is to be handled by saga, in order to\n * call upon side effects such as loading libraries in\n * the global scope.\n *\n * @param library the Library that the context shall be using\n * @param workspaceLocation the location of the workspace\n *\n * @see Library in assessmentShape.ts\n */\nexport const beginClearContext = (\n  workspaceLocation: WorkspaceLocation,\n  library: Library,\n  shouldInitLibrary: boolean\n) =>\n  action(BEGIN_CLEAR_CONTEXT, {\n    library,\n    workspaceLocation,\n    shouldInitLibrary\n  });\n\nexport const clearReplInput = (workspaceLocation: WorkspaceLocation) =>\n  action(CLEAR_REPL_INPUT, { workspaceLocation });\n\nexport const clearReplOutput = (workspaceLocation: WorkspaceLocation) =>\n  action(CLEAR_REPL_OUTPUT, { workspaceLocation });\n\nexport const clearReplOutputLast = (workspaceLocation: WorkspaceLocation) =>\n  action(CLEAR_REPL_OUTPUT_LAST, { workspaceLocation });\n\n/**\n * Finishes the process to clear the c-slang Context\n * at a specified workspace location.\n *\n * This action is to be handled in the reducer, to call the reset on the\n * Context in the state.\n *\n * @param library the Library that the context shall be using\n * @param workspaceLocation the location of the workspace\n *\n * @see Library in assessmentShape.ts\n */\nexport const endClearContext = (library: Library, workspaceLocation: WorkspaceLocation) =>\n  action(END_CLEAR_CONTEXT, {\n    library,\n    workspaceLocation\n  });\n\nexport const evalEditor = (workspaceLocation: WorkspaceLocation) =>\n  action(EVAL_EDITOR, { workspaceLocation });\n\nexport const checkEditor = (workspaceLocation: WorkspaceLocation) => \n  action(CHECK_EDITOR, { workspaceLocation });\n\n\nexport const evalRepl = (workspaceLocation: WorkspaceLocation) => \n  action(EVAL_REPL, { workspaceLocation });\n  \n\nexport const evalTestcase = (workspaceLocation: WorkspaceLocation, testcaseId: number) =>\n  action(EVAL_TESTCASE, { workspaceLocation, testcaseId });\n\nexport const runAllTestcases = (workspaceLocation: WorkspaceLocation) =>\n  action(EVAL_EDITOR_AND_TESTCASES, { workspaceLocation });\n\nexport const updateActiveEditorTab = (\n  workspaceLocation: WorkspaceLocation,\n  activeEditorTabOptions?: Partial<EditorTabState>\n) => action(UPDATE_ACTIVE_EDITOR_TAB, { workspaceLocation, activeEditorTabOptions });\n\nexport const updateEditorValue = (newEditorValue: string, workspaceLocation: WorkspaceLocation) =>\n  action(UPDATE_EDITOR_VALUE, { newEditorValue, workspaceLocation });\n\nexport const setEditorBreakpoint = (breakpoints: string[], workspaceLocation: WorkspaceLocation) =>\n  action(UPDATE_EDITOR_BREAKPOINTS, { breakpoints, workspaceLocation });\n\nexport const highlightEditorLine = (\n  highlightedLines: number[],\n  workspaceLocation: WorkspaceLocation\n) => action(HIGHLIGHT_LINE, { highlightedLines, workspaceLocation });\n\nexport const updateReplValue = (newReplValue: string, workspaceLocation: WorkspaceLocation) =>\n  action(UPDATE_REPL_VALUE, { newReplValue, workspaceLocation });\n\nexport const sendReplInputToOutput = (newOutput: string, workspaceLocation: WorkspaceLocation) =>\n  action(SEND_REPL_INPUT_TO_OUTPUT, {\n    type: 'code',\n    workspaceLocation,\n    value: newOutput\n  });\n\nexport const resetTestcase = (workspaceLocation: WorkspaceLocation, index: number) =>\n  action(RESET_TESTCASE, { workspaceLocation, index });\n\nexport const navigateToDeclaration = (\n  workspaceLocation: WorkspaceLocation,\n  cursorPosition: Position\n) => action(NAV_DECLARATION, { workspaceLocation, cursorPosition });\n\nexport const moveCursor = (workspaceLocation: WorkspaceLocation, cursorPosition: Position) =>\n  action(MOVE_CURSOR, { workspaceLocation, cursorPosition });\n\n/**\n * Resets a workspace to its default properties.\n *\n * @param workspaceLocation the workspace to be reset\n * @param workspaceOptions an object with any number of properties\n *   in IWorkspaceState, that will take precedence over the default\n *   values. For example, one can use this to specify a particular\n *   editorValue.\n */\nexport const resetWorkspace = (\n  workspaceLocation: WorkspaceLocation,\n  workspaceOptions?: Partial<WorkspaceState>\n) =>\n  action(RESET_WORKSPACE, {\n    workspaceLocation,\n    workspaceOptions\n  });\n\nexport const updateWorkspace = (\n  workspaceLocation: WorkspaceLocation,\n  workspaceOptions?: Partial<WorkspaceState>\n) =>\n  action(UPDATE_WORKSPACE, {\n    workspaceLocation,\n    workspaceOptions\n  });\n\nexport const setIsEditorReadonly = (\n  workspaceLocation: WorkspaceLocation,\n  isEditorReadonly: boolean\n) =>\n  action(SET_IS_EDITOR_READONLY, {\n    workspaceLocation,\n    isEditorReadonly: isEditorReadonly\n  });\n\nexport const updateCurrentAssessmentId = (assessmentId: number, questionId: number) =>\n  action(UPDATE_CURRENT_ASSESSMENT_ID, {\n    assessmentId,\n    questionId\n  });\n\nexport const updateCurrentSubmissionId = (submissionId: number, questionId: number) =>\n  action(UPDATE_CURRENT_SUBMISSION_ID, {\n    submissionId,\n    questionId\n  });\n\nexport const updateHasUnsavedChanges = (\n  workspaceLocation: WorkspaceLocation,\n  hasUnsavedChanges: boolean\n) =>\n  action(UPDATE_HAS_UNSAVED_CHANGES, {\n    workspaceLocation,\n    hasUnsavedChanges\n  });\n\nexport const changeSublanguage = (sublang: SALanguage) => action(CHANGE_SUBLANGUAGE, { sublang });\n\nexport const updateSublanguage = (sublang: SALanguage) => action(UPDATE_SUBLANGUAGE, { sublang });\n\nexport const promptAutocomplete = (\n  workspaceLocation: WorkspaceLocation,\n  row: number,\n  column: number,\n  callback: any // TODO: define a type for this\n) =>\n  action(PROMPT_AUTOCOMPLETE, {\n    workspaceLocation,\n    row,\n    column,\n    callback\n  });\n\nexport const notifyProgramEvaluated = (\n  result: any,\n  lastDebuggerResult: any,\n  code: string,\n  context: Context,\n  workspaceLocation?: WorkspaceLocation\n) =>\n  action(NOTIFY_PROGRAM_EVALUATED, {\n    result,\n    lastDebuggerResult,\n    code,\n    context,\n    workspaceLocation\n  });\n\nexport const toggleUsingSubst = (usingSubst: boolean, workspaceLocation: WorkspaceLocation) =>\n  action(TOGGLE_USING_SUBST, { usingSubst, workspaceLocation });\n\nexport const addHtmlConsoleError = (errorMsg: string, workspaceLocation: WorkspaceLocation) =>\n  action(ADD_HTML_CONSOLE_ERROR, { errorMsg, workspaceLocation });\n","export const LOG_OUT = 'LOG_OUT';\n","import { Button, Classes, Menu, MenuItem } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { ItemListRenderer, ItemRenderer, Select } from '@blueprintjs/select';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport React from 'react';\n\nimport {\n  defaultLanguages,\n  SALanguage,\n  sourceLanguages,\n  styliseSublanguage\n} from '../application/ApplicationTypes';\n\ntype ControlBarChapterSelectProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleChapterSelect?: (i: SALanguage, e?: React.SyntheticEvent<HTMLElement>) => void;\n};\n\ntype StateProps = {\n  sourceChapter: Chapter;\n  sourceVariant: Variant;\n  disabled?: boolean;\n};\n\nconst chapterListRenderer: ItemListRenderer<SALanguage> = ({ itemsParentRef, renderItem }) => {\n  const defaultChoices = defaultLanguages.map(renderItem);\n  return (\n    <Menu ulRef={itemsParentRef}>\n      {defaultChoices}\n    </Menu>\n  );\n};\n\nconst chapterRenderer: ItemRenderer<SALanguage> = (lang, { handleClick }) => (\n  <MenuItem key={lang.displayName} onClick={handleClick} text={lang.displayName} />\n);\n\nconst ChapterSelectComponent = Select.ofType<SALanguage>();\n\nexport const ControlBarChapterSelect: React.FC<ControlBarChapterSelectProps> = ({\n  sourceChapter,\n  sourceVariant,\n  handleChapterSelect = () => {},\n  disabled = false\n}) => {\n  return (\n    <ChapterSelectComponent\n      items={sourceLanguages}\n      onItemSelect={handleChapterSelect}\n      itemRenderer={chapterRenderer}\n      itemListRenderer={chapterListRenderer}\n      filterable={false}\n      disabled={disabled}\n    >\n      <Button\n        className={Classes.MINIMAL}\n        text={styliseSublanguage(sourceChapter, sourceVariant)}\n        rightIcon={disabled ? null : IconNames.DOUBLE_CARET_VERTICAL}\n        disabled={disabled}\n      />\n    </ChapterSelectComponent>\n  );\n};\n","import { Position } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport React from 'react';\n\nimport ControlButton from '../ControlButton';\n\ntype ControlButtonRunButtonProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleEditorEval: () => void;\n};\n\ntype StateProps = {\n  key: string;\n  color?: string;\n  className?: string;\n};\n\nexport const ControlBarRunButton: React.FC<ControlButtonRunButtonProps> = props => {\n  return (\n    <Tooltip2 content=\"...or press shift-enter in the editor\" placement={Position.TOP}>\n      <ControlButton\n        label=\"Run\"\n        icon={IconNames.PLAY}\n        onClick={props.handleEditorEval}\n        options={{ iconColor: props.color, className: props.className }}\n      />\n    </Tooltip2>\n  );\n};\n","import React from 'react';\n\nexport enum EditorBinding {\n  NONE = '',\n  VIM = 'vim',\n  EMACS = 'emacs'\n}\n\nexport type WorkspaceSettings = {\n  editorBinding: EditorBinding;\n};\n\nexport const defaultWorkspaceSettings: WorkspaceSettings = {\n  editorBinding: EditorBinding.NONE\n};\n\n/**\n * The WorkspaceSettingsContext stores the local storage-based application settings.\n *\n * The local storage state is initialized in Application.tsx via the useLocalStorageState hook.\n */\nexport const WorkspaceSettingsContext = React.createContext<\n  [WorkspaceSettings, React.Dispatch<React.SetStateAction<WorkspaceSettings>>] | null\n>(null);\n","export const CHANGE_DATE_ASSESSMENT = 'CHANGE_DATE_ASSESSMENT';\nexport const DELETE_ASSESSMENT = 'DELETE_ASSESSMENT';\nexport const PUBLISH_ASSESSMENT = 'PUBLISH_ASSESSMENT';\nexport const UPLOAD_ASSESSMENT = 'UPLOAD_ASSESSMENT';\n","export const PERSISTENCE_OPEN_PICKER = 'PERSISTENCE_OPEN_PICKER';\nexport const PERSISTENCE_SAVE_FILE_AS = 'PERSISTENCE_SAVE_FILE_AS';\nexport const PERSISTENCE_SAVE_FILE = 'PERSISTENCE_SAVE_FILE';\nexport const PERSISTENCE_INITIALISE = 'PERSISTENCE_INITIALISE';\n\nexport type PersistenceState = 'INACTIVE' | 'SAVED' | 'DIRTY';\n\nexport type PersistenceFile = {\n  id: string;\n  name: string;\n  lastSaved?: Date;\n};\n","import { Octokit } from '@octokit/rest';\nimport {\n  GetResponseDataTypeFromEndpointMethod,\n  GetResponseTypeFromEndpointMethod\n} from '@octokit/types';\nimport { Chapter } from 'c-slang/dist/types';\nimport { isEqual } from 'lodash';\n\nimport { IMCQQuestion, Testcase } from '../assessment/AssessmentTypes';\nimport { showWarningMessage } from '../utils/NotificationsHelper';\nimport { MissionData, MissionMetadata, MissionRepoData, TaskData } from './GitHubMissionTypes';\n\nexport const maximumTasksPerMission = 20;\n\nconst jsonStringify = (object: any) => JSON.stringify(object, null, 4);\nconst convertTestsToSaveableJson = (tests: Testcase[]) => {\n  const saveableTests = tests.map((test: Testcase) => {\n    return {\n      answer: test.answer,\n      program: test.program,\n      score: test.score ? test.score : 0,\n      type: test.type ? test.type : 'public'\n    };\n  });\n  return jsonStringify(saveableTests);\n};\nconst identity = (content: any) => content;\n\n// 1) fileName: the name of the file corresponding to the named property\n// 2) isDefaultValue: function should return true if the input value is the default value of the property\n// 3) fromStringConverter: a function to be applied to raw text data to convert it into the property\n// 4) toStringConverter: a function to be applied to the property to convert it to raw text data\nconst taskDataPropertyTable = {\n  taskDescription: {\n    fileName: 'Problem.md',\n    isDefaultValue: (value: string) => value === '',\n    fromStringConverter: identity,\n    toStringConverter: identity\n  },\n  starterCode: {\n    fileName: 'StarterCode.js',\n    isDefaultValue: (value: string) => value === '',\n    fromStringConverter: identity,\n    toStringConverter: identity\n  },\n  savedCode: {\n    fileName: 'SavedCode.js',\n    isDefaultValue: (value: string) => value === '',\n    fromStringConverter: identity,\n    toStringConverter: identity\n  },\n  testPrepend: {\n    fileName: 'TestPrepend.js',\n    isDefaultValue: (value: string) => value === '',\n    fromStringConverter: identity,\n    toStringConverter: identity\n  },\n  testPostpend: {\n    fileName: 'TestPostpend.js',\n    isDefaultValue: (value: string) => value === '',\n    fromStringConverter: identity,\n    toStringConverter: identity\n  },\n  testCases: {\n    fileName: 'TestCases.json',\n    isDefaultValue: (value: Testcase[]) => value.length === 0,\n    fromStringConverter: JSON.parse,\n    toStringConverter: convertTestsToSaveableJson\n  }\n};\n\n/**\n * Retrieves mission information - such as the briefings, questions, metadata etc. from a GitHub Repository.\n *\n * @param missionRepoData Repository information where the mission is stored\n * @param octokit The Octokit instance for the authenticated user\n */\nexport async function getMissionData(missionRepoData: MissionRepoData, octokit: Octokit) {\n  const briefingStringPromise = getContentAsString(\n    missionRepoData.repoOwner,\n    missionRepoData.repoName,\n    'README.md',\n    octokit\n  );\n\n  const metadataStringPromise = getContentAsString(\n    missionRepoData.repoOwner,\n    missionRepoData.repoName,\n    '.metadata',\n    octokit\n  );\n\n  const tasksDataPromise = getTasksData(\n    missionRepoData.repoOwner,\n    missionRepoData.repoName,\n    octokit\n  );\n\n  const [briefingString, metadataString, tasksData] = await Promise.all([\n    briefingStringPromise,\n    metadataStringPromise,\n    tasksDataPromise\n  ]);\n  const missionMetadata = convertMetadataStringToMissionMetadata(metadataString);\n\n  const newMissionData: MissionData = {\n    missionRepoData: missionRepoData,\n    missionBriefing: briefingString,\n    missionMetadata: missionMetadata,\n    tasksData: tasksData\n  };\n\n  return newMissionData;\n}\n\n/**\n * Retrieves information regarding each task in the Mission from the GitHub repository.\n *\n * @param repoOwner The owner of the mission repository\n * @param repoName The name of the mission repository\n * @param octokit The Octokit instance for the authenticated user\n */\nasync function getTasksData(repoOwner: string, repoName: string, octokit: Octokit) {\n  const questions: TaskData[] = [];\n\n  if (octokit === undefined) {\n    return questions;\n  }\n\n  // Get files in root\n  type GetContentResponse = GetResponseTypeFromEndpointMethod<typeof octokit.repos.getContent>;\n  const rootFolderContents: GetContentResponse = await octokit.repos.getContent({\n    owner: repoOwner,\n    repo: repoName,\n    path: ''\n  });\n\n  type GetContentData = GetResponseDataTypeFromEndpointMethod<typeof octokit.repos.getContent>;\n  const files: GetContentData = rootFolderContents.data;\n\n  if (!Array.isArray(files)) {\n    return questions;\n  }\n\n  const promises = [];\n\n  for (let i = 1; i <= maximumTasksPerMission; i++) {\n    const questionFolderName = 'Q' + i;\n\n    // We make the assumption that there are no gaps in question numbering\n    // If the question does not exist, we may break\n    if (files.find(file => file.name === questionFolderName) === undefined) {\n      break;\n    }\n\n    promises.push(\n      octokit.repos\n        .getContent({\n          owner: repoOwner,\n          repo: repoName,\n          path: questionFolderName\n        })\n        .then((folderContents: GetContentResponse) => {\n          if (!Array.isArray(folderContents.data)) {\n            return;\n          }\n\n          const folderContentsAsArray = folderContents.data as any[];\n          const folderContentFileNames = folderContentsAsArray.map(\n            (file: any) => file.name as string\n          );\n\n          const properties = Object.keys(taskDataPropertyTable);\n\n          const filteredProperties = properties.filter((property: string) =>\n            folderContentFileNames.includes(taskDataPropertyTable[property].fileName)\n          );\n\n          const promises = filteredProperties.map(async (property: string) => {\n            const fileName = taskDataPropertyTable[property].fileName;\n\n            const stringContent = await getContentAsString(\n              repoOwner,\n              repoName,\n              questionFolderName + '/' + fileName,\n              octokit\n            );\n\n            return taskDataPropertyTable[property].fromStringConverter(stringContent);\n          });\n\n          return Promise.all(promises).then((stringContents: string[]) => {\n            const taskData: TaskData = {\n              questionNumber: i,\n              taskDescription: '',\n              starterCode: '',\n              savedCode: '',\n              testPrepend: '',\n              testPostpend: '',\n              testCases: []\n            };\n\n            for (let i = 0; i < stringContents.length; i++) {\n              taskData[filteredProperties[i]] = stringContents[i];\n            }\n\n            if (taskData.savedCode === '') {\n              taskData.savedCode = taskData.starterCode;\n            }\n\n            questions.push(taskData);\n          });\n        })\n        .catch(err => {\n          showWarningMessage('Error occurred while trying to retrieve file content', 1000);\n          console.error(err);\n        })\n    );\n  }\n  await Promise.all(promises);\n  questions.sort((a, b) => a.questionNumber - b.questionNumber);\n\n  return questions;\n}\n\n/**\n * Retrieves content from a single file on GitHub and returns it in string form.\n *\n * @param repoOwner The owner of the mission repository\n * @param repoName The name of the mission repository\n * @param filepath The path to the file to be retrieved\n * @param octokit The Octokit instance for the authenticated user\n */\nexport async function getContentAsString(\n  repoOwner: string,\n  repoName: string,\n  filepath: string,\n  octokit: Octokit\n) {\n  let contentString = '';\n\n  if (octokit === undefined) {\n    return contentString;\n  }\n\n  try {\n    type GetContentResponse = GetResponseTypeFromEndpointMethod<typeof octokit.repos.getContent>;\n    const fileInfo: GetContentResponse = await octokit.repos.getContent({\n      owner: repoOwner,\n      repo: repoName,\n      path: filepath\n    });\n\n    contentString = Buffer.from((fileInfo.data as any).content, 'base64').toString();\n  } catch (err) {\n    showWarningMessage('Error occurred while trying to retrieve file content', 1000);\n    console.error(err);\n  }\n\n  return contentString;\n}\n\n/**\n * Converts the contents of the '.metadata' file into a MissionMetadata object.\n *\n * @param metadataString The file contents of the '.metadata' file of a mission repository\n */\nfunction convertMetadataStringToMissionMetadata(metadataString: string) {\n  try {\n    return JSON.parse(metadataString) as MissionMetadata;\n  } catch (err) {\n    console.error(err);\n    return {\n      sourceVersion: Chapter.CALC\n    } as MissionMetadata;\n  }\n}\n\nfunction convertMissionMetadataToMetadataString(missionMetadata: MissionMetadata) {\n  return jsonStringify(missionMetadata);\n}\n\n/**\n * Discovers files to be changed when saving to an existing GitHub repository\n * Return value is an array in the format [filenameToContentMap, foldersToDelete]\n * filenameToContentMap is an object whose key-value pairs are filenames and their new contents\n * foldersToDelete is an array containing the names of folders\n * @param missionMetadata The current MissionMetadata\n * @param cachedMissionMetadata The cached MissionMetadata\n * @param briefingContent The current briefing\n * @param cachedBriefingContent The cached briefing\n * @param taskList The current taskList\n * @param cachedTaskList The cached taskList\n * @param isTeacherMode If this is true, any changes to the saved code will be made to starter code instead\n */\nexport function discoverFilesToBeChangedWithMissionRepoData(\n  missionMetadata: MissionMetadata,\n  cachedMissionMetadata: MissionMetadata,\n  briefingContent: string,\n  cachedBriefingContent: string,\n  taskList: TaskData[],\n  cachedTaskList: TaskData[],\n  isTeacherMode: boolean\n): [any, string[]] {\n  const filenameToContentMap = {};\n  const foldersToDelete: string[] = [];\n\n  if (missionMetadata !== cachedMissionMetadata) {\n    filenameToContentMap['.metadata'] = convertMissionMetadataToMetadataString(missionMetadata);\n  }\n\n  if (briefingContent !== cachedBriefingContent) {\n    filenameToContentMap['README.md'] = briefingContent;\n  }\n\n  let i = 0;\n  while (i < taskList.length) {\n    const taskNumber = i + 1;\n    const questionFolderName = 'Q' + taskNumber;\n\n    if (taskNumber > cachedTaskList.length) {\n      // Look for files to create\n      filenameToContentMap[questionFolderName + '/StarterCode.js'] = taskList[i].savedCode;\n      filenameToContentMap[questionFolderName + '/Problem.md'] = taskList[i].taskDescription;\n\n      const propertiesToCheck = ['testCases', 'testPrepend', 'testPostpend'];\n\n      for (const propertyName of propertiesToCheck) {\n        const currentValue = taskList[i][propertyName];\n        const isDefaultValue = taskDataPropertyTable[propertyName].isDefaultValue(currentValue);\n\n        if (!isDefaultValue) {\n          const onRepoFileName =\n            questionFolderName + '/' + taskDataPropertyTable[propertyName].fileName;\n          const stringContent = taskDataPropertyTable[propertyName].toStringConverter(\n            taskList[i][propertyName]\n          );\n\n          filenameToContentMap[onRepoFileName] = stringContent;\n        }\n      }\n    } else {\n      // Look for files to edit\n      const propertiesToCheck = Object.keys(taskDataPropertyTable);\n\n      for (const propertyName of propertiesToCheck) {\n        const currentValue = taskList[i][propertyName];\n        const cachedValue = cachedTaskList[i][propertyName];\n\n        if (!isEqual(currentValue, cachedValue)) {\n          const onRepoFileName =\n            questionFolderName + '/' + taskDataPropertyTable[propertyName].fileName;\n          const stringContent = taskDataPropertyTable[propertyName].toStringConverter(\n            taskList[i][propertyName]\n          );\n\n          filenameToContentMap[onRepoFileName] = stringContent;\n        }\n      }\n\n      if (\n        isTeacherMode &&\n        filenameToContentMap[questionFolderName + '/' + taskDataPropertyTable['savedCode'].fileName]\n      ) {\n        // replace changes to savedCode with changes to starterCode\n        const savedCodeValue =\n          filenameToContentMap[\n            questionFolderName + '/' + taskDataPropertyTable['savedCode'].fileName\n          ];\n        delete filenameToContentMap[\n          questionFolderName + '/' + taskDataPropertyTable['savedCode'].fileName\n        ];\n        filenameToContentMap[\n          questionFolderName + '/' + taskDataPropertyTable['starterCode'].fileName\n        ] = savedCodeValue;\n      }\n    }\n    i++;\n  }\n\n  while (i < cachedTaskList.length) {\n    const taskNumber = i + 1;\n    foldersToDelete.push('Q' + taskNumber);\n    i++;\n  }\n\n  return [filenameToContentMap, foldersToDelete];\n}\n\n/**\n * Discovers files to be changed when saving to a new GitHub repository\n * @param missionMetadata The current MissionMetadata\n * @param briefingContent The current briefing\n * @param taskList The current taskList\n */\nexport function discoverFilesToBeCreatedWithoutMissionRepoData(\n  missionMetadata: MissionMetadata,\n  briefingContent: string,\n  taskList: TaskData[]\n) {\n  const filenameToContentMap = {};\n  filenameToContentMap['.metadata'] = convertMissionMetadataToMetadataString(missionMetadata);\n  filenameToContentMap['README.md'] = briefingContent;\n\n  const propertiesToCheck = ['testCases', 'testPrepend', 'testPostpend'];\n\n  for (let i = 0; i < taskList.length; i++) {\n    const taskNumber = i + 1;\n    const questionFolderName = 'Q' + taskNumber;\n\n    filenameToContentMap[questionFolderName + '/' + taskDataPropertyTable['starterCode'].fileName] =\n      taskList[i].savedCode;\n    filenameToContentMap[\n      questionFolderName + '/' + taskDataPropertyTable['taskDescription'].fileName\n    ] = taskList[i].taskDescription;\n\n    propertiesToCheck.forEach((propertyName: string) => {\n      const currentValue = taskList[i][propertyName];\n      const isDefaultValue = taskDataPropertyTable[propertyName].isDefaultValue(currentValue);\n\n      if (!isDefaultValue) {\n        const onRepoFileName =\n          questionFolderName + '/' + taskDataPropertyTable[propertyName].fileName;\n        const stringContent = taskDataPropertyTable[propertyName].toStringConverter(\n          taskList[i][propertyName]\n        );\n\n        filenameToContentMap[onRepoFileName] = stringContent;\n      }\n    });\n  }\n\n  return filenameToContentMap;\n}\n\n/**\n * Checks if the textual contents of a GitHub-hosted file is for an MCQ question, and converts it if so\n * returns an array of 2 values, a boolean and an IMCQQuestion\n * The boolean specifies whether the input corresponded to an MCQQuestion\n * The IMCQQuestion is only meaningful if the boolean is true, and contains the converted information\n * @param possibleMCQText The text to be checked and converted\n */\nexport function convertToMCQQuestionIfMCQText(possibleMCQText: string): [boolean, IMCQQuestion] {\n  let isMCQText = false;\n  const mcqQuestion = {\n    answer: 0,\n    choices: [],\n    solution: -1,\n    type: 'mcq',\n    content: '',\n    grade: 0,\n    id: 0,\n    library: { chapter: Chapter.CALC, external: { name: 'NONE', symbols: [] }, globals: [] },\n    maxGrade: 0,\n    xp: 0,\n    maxXp: 0\n  } as IMCQQuestion;\n\n  const trimmedText = possibleMCQText.trim();\n\n  if (trimmedText.substring(0, 3).toLowerCase() === 'mcq') {\n    isMCQText = true;\n  }\n\n  if (isMCQText) {\n    const onlyQuestionInformation = trimmedText.substring(3, trimmedText.length);\n    try {\n      const intermediateObject = JSON.parse(onlyQuestionInformation);\n\n      const studentAnswer = intermediateObject.answer;\n      const intermediateChoices = intermediateObject.choices as any[];\n      const choices = intermediateChoices.map((question: { option: string; hint: string }) => {\n        return {\n          content: question.option,\n          hint: question.hint\n        };\n      });\n      const solution = intermediateObject.solution;\n\n      mcqQuestion.answer = studentAnswer;\n      mcqQuestion.choices = choices;\n      mcqQuestion.solution = solution;\n    } catch (err) {\n      isMCQText = false;\n    }\n  }\n\n  return [isMCQText, mcqQuestion];\n}\n\n/**\n * Converts an IMCQQuestion object into textual contents to be saved to a GitHub repository\n * @param mcq The IMCQQuestion object\n */\nexport function convertIMCQQuestionToMCQText(mcq: IMCQQuestion) {\n  const studentAnswer = mcq.answer;\n  const choices = mcq.choices.map((choice: { content: string; hint: string | null }) => {\n    return {\n      option: choice.content,\n      hint: choice.hint\n    };\n  });\n  const solution = mcq.solution;\n\n  const json = {\n    choices: choices,\n    answer: studentAnswer,\n    solution: solution\n  };\n\n  return 'MCQ\\n' + jsonStringify(json);\n}\n","export const FETCH_GROUP_GRADING_SUMMARY = 'FETCH_GROUP_GRADING_SUMMARY';\nexport const UPDATE_GROUP_GRADING_SUMMARY = 'UPDATE_GROUP_GRADING_SUMMARY';\n\nexport type DashboardState = {\n  gradingSummary: GradingSummary;\n};\n\n/**\n * As we are dynamically rendering the ag-grid table based on the number of assessment types in\n * the course, we cannot properly type the fields in GradingSummary.\n *\n * In short, cols contains the keys to each object in rows, and corresponds to the display order of ag-grid columns.\n */\nexport type GradingSummary = {\n  cols: string[];\n  rows: Object[];\n};\n","import { Octokit } from '@octokit/rest';\nimport { Chapter, Variant } from 'c-slang/dist/types';\n\nimport { Grading, GradingOverview } from '../../../features/grading/GradingTypes';\nimport { Device, DeviceSession } from '../../../features/remoteExecution/RemoteExecutionTypes';\nimport {\n  Assessment,\n  AssessmentConfiguration,\n  AssessmentOverview\n} from '../../assessment/AssessmentTypes';\nimport { MissionRepoData } from '../../githubAssessments/GitHubMissionTypes';\nimport { Notification } from '../../notificationBadge/NotificationBadgeTypes';\nimport { GameState, Role, Story } from '../ApplicationTypes';\n\nexport const FETCH_AUTH = 'FETCH_AUTH';\nexport const FETCH_USER_AND_COURSE = 'FETCH_USER_AND_COURSE';\nexport const FETCH_COURSE_CONFIG = 'FETCH_COURSE_CONFIG';\nexport const FETCH_ASSESSMENT = 'FETCH_ASSESSMENT';\nexport const FETCH_ASSESSMENT_ADMIN = 'FETCH_ASSESSMENT_ADMIN';\nexport const FETCH_ASSESSMENT_OVERVIEWS = 'FETCH_ASSESSMENT_OVERVIEWS';\nexport const FETCH_ALL_USER_XP = 'FETCH_ALL_USER_XP';\nexport const FETCH_TOTAL_XP = 'FETCH_TOTAL_XP';\nexport const FETCH_TOTAL_XP_ADMIN = 'FETCH_TOTAL_XP_ADMIN';\nexport const FETCH_GRADING = 'FETCH_GRADING';\nexport const FETCH_GRADING_OVERVIEWS = 'FETCH_GRADING_OVERVIEWS';\nexport const LOGIN = 'LOGIN';\nexport const LOGOUT_GOOGLE = 'LOGOUT_GOOGLE';\nexport const LOGIN_GITHUB = 'LOGIN_GITHUB';\nexport const LOGOUT_GITHUB = 'LOGOUT_GITHUB';\nexport const SET_TOKENS = 'SET_TOKENS';\nexport const SET_USER = 'SET_USER';\nexport const SET_COURSE_CONFIGURATION = 'SET_COURSE_CONFIGURATION';\nexport const SET_COURSE_REGISTRATION = 'SET_COURSE_REGISTRATION';\nexport const SET_ASSESSMENT_CONFIGURATIONS = 'SET_ASSESSMENT_CONFIGURATIONS';\nexport const SET_ADMIN_PANEL_COURSE_REGISTRATIONS = 'SET_ADMIN_PANEL_COURSE_REGISTRATIONS';\nexport const SET_GOOGLE_USER = 'SET_GOOGLE_USER';\nexport const SET_GITHUB_ASSESSMENT = 'SET_GITHUB_ASSESSMENT';\nexport const SET_GITHUB_OCTOKIT_OBJECT = 'SET_GITHUB_OCTOKIT_OBJECT';\nexport const SET_GITHUB_ACCESS_TOKEN = 'SET_GITHUB_ACCESS_TOKEN';\nexport const SUBMIT_ANSWER = 'SUBMIT_ANSWER';\nexport const SUBMIT_ASSESSMENT = 'SUBMIT_ASSESSMENT';\nexport const SUBMIT_GRADING = 'SUBMIT_GRADING';\nexport const SUBMIT_GRADING_AND_CONTINUE = 'SUBMIT_GRADING_AND_CONTINUE';\nexport const REAUTOGRADE_SUBMISSION = 'REAUTOGRADE_SUBMISSION';\nexport const REAUTOGRADE_ANSWER = 'REAUTOGRADE_ANSWER';\nexport const REMOVE_GITHUB_OCTOKIT_OBJECT_AND_ACCESS_TOKEN =\n  'REMOVE_GITHUB_OCTOKIT_OBJECT_AND_ACCESS_TOKEN';\nexport const UNSUBMIT_SUBMISSION = 'UNSUBMIT_SUBMISSION';\nexport const UPDATE_ASSESSMENT_OVERVIEWS = 'UPDATE_ASSESSMENT_OVERVIEWS';\nexport const UPDATE_TOTAL_XP = 'UPDATE_TOTAL_XP';\nexport const UPDATE_ALL_USER_XP = 'UPDATE_ALL_USER_XP';\nexport const UPDATE_ASSESSMENT = 'UPDATE_ASSESSMENT';\nexport const UPDATE_GRADING_OVERVIEWS = 'UPDATE_GRADING_OVERVIEWS';\nexport const UPDATE_GRADING = 'UPDATE_GRADING';\nexport const FETCH_NOTIFICATIONS = 'FETCH_NOTIFICATIONS';\nexport const ACKNOWLEDGE_NOTIFICATIONS = 'ACKNOWLEDGE_NOTIFICATIONS';\nexport const UPDATE_NOTIFICATIONS = 'UPDATE_NOTIFICATIONS';\nexport const UPDATE_LATEST_VIEWED_COURSE = 'UPDATE_LATEST_VIEWED_COURSE';\nexport const UPDATE_COURSE_CONFIG = 'UPDATE_COURSE_CONFIG';\nexport const FETCH_ASSESSMENT_CONFIGS = 'FETCH_ASSESSMENT_CONFIGS';\nexport const UPDATE_ASSESSMENT_CONFIGS = 'UPDATE_ASSESSMENT_CONFIGS';\nexport const DELETE_ASSESSMENT_CONFIG = 'DELETE_ASSESSMENT_CONFIG';\nexport const FETCH_ADMIN_PANEL_COURSE_REGISTRATIONS = 'FETCH_ADMIN_PANEL_COURSE_REGISTRATIONS';\nexport const UPDATE_USER_ROLE = 'UPDATE_USER_ROLE';\nexport const UPDATE_COURSE_RESEARCH_AGREEMENT = 'UPDATE_COURSE_RESEARCH_AGREEMENT';\nexport const DELETE_USER_COURSE_REGISTRATION = 'DELETE_USER_COURSE_REGISTRATION';\n\nexport const UPLOAD_KEYSTROKE_LOGS = 'UPLOAD_KEYSTROKE_LOGS';\nexport const UPLOAD_UNSENT_LOGS = 'UPLOAD_UNSENT_LOGS';\n\nexport type SessionState = {\n  // Tokens\n  readonly accessToken?: string;\n  readonly refreshToken?: string;\n\n  // User\n  readonly userId?: number;\n  readonly name?: string;\n  readonly courses: UserCourse[];\n\n  // Course Registration\n  readonly courseRegId?: number;\n  readonly role?: Role;\n  readonly group: string | null;\n  readonly gameState: GameState;\n  readonly courseId?: number;\n  readonly xp: number;\n  readonly allUserXp: string[][] | undefined;\n  readonly story: Story;\n\n  // Course Configuration\n  readonly courseName?: string;\n  readonly courseShortName?: string;\n  readonly viewable?: boolean;\n  readonly enableGame?: boolean;\n  readonly enableAchievements?: boolean;\n  readonly enableSourcecast?: boolean;\n  readonly sourceChapter?: number;\n  readonly sourceVariant?: Variant;\n  readonly moduleHelpText?: string;\n  readonly assetsPrefix?: string;\n\n  readonly assessmentConfigurations?: AssessmentConfiguration[];\n  readonly userCourseRegistrations?: AdminPanelCourseRegistration[];\n\n  // For research data collection\n  readonly agreedToResearch?: boolean | null;\n  readonly sessionId: number;\n\n  readonly assessmentOverviews?: AssessmentOverview[];\n  readonly assessments: Map<number, Assessment>;\n  readonly gradingOverviews?: GradingOverview[];\n  readonly gradings: Map<number, Grading>;\n  readonly notifications: Notification[];\n  readonly googleUser?: string;\n  readonly githubAssessment?: MissionRepoData;\n  readonly githubOctokitObject: { octokit: Octokit | undefined };\n  readonly githubAccessToken?: string;\n  readonly remoteExecutionDevices?: Device[];\n  readonly remoteExecutionSession?: DeviceSession;\n};\n\nexport type Tokens = {\n  accessToken: string;\n  refreshToken: string;\n};\n\nexport type UserCourse = {\n  courseId: number;\n  courseName: string;\n  courseShortName: string;\n  role: Role;\n  viewable: boolean;\n};\n\nexport type User = {\n  userId: number;\n  name: string;\n  courses: UserCourse[];\n};\n\nexport type CourseRegistration = {\n  courseRegId: number;\n  role: Role;\n  group: string | null;\n  gameState?: GameState;\n  courseId: number;\n  xp: number;\n  story?: Story;\n  agreedToResearch: boolean | null;\n};\n\nexport type CourseConfiguration = {\n  courseName: string;\n  courseShortName: string;\n  viewable: boolean;\n  enableGame: boolean;\n  enableAchievements: boolean;\n  enableSourcecast: boolean;\n  sourceChapter: Chapter;\n  sourceVariant: Variant;\n  moduleHelpText: string;\n  assetsPrefix: string;\n};\n\nexport type AdminPanelCourseRegistration = {\n  courseRegId: number;\n  courseId: number;\n  name?: string;\n  username: string;\n  role: Role;\n  group?: string;\n};\n\nexport type UpdateCourseConfiguration = Partial<CourseConfiguration>;\n","import { IconNames } from '@blueprintjs/icons';\nimport React from 'react';\n\nimport ControlButton from '../ControlButton';\n\ntype ControlBarPreviousButtonProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  onClick?(): any;\n};\n\ntype StateProps = {\n  key: string;\n  questionProgress: [number, number] | null;\n};\n\nexport const ControlBarPreviousButton: React.FC<ControlBarPreviousButtonProps> = props => {\n  return props.questionProgress![0] <= 1 ? null : (\n    <ControlButton label=\"Previous\" icon={IconNames.ARROW_LEFT} onClick={props.onClick} />\n  );\n};\n","import React from 'react';\n\nimport ControlButton from '../ControlButton';\n\n/**\n * @prop questionProgress a tuple of (current question number, question length) where\n *   the current question number is 1-based.\n */\ntype ControlBarQuestionViewButtonProps = {\n  questionProgress: [number, number] | null;\n};\n\nexport const ControlBarQuestionViewButton: React.FC<ControlBarQuestionViewButtonProps> = ({\n  questionProgress\n}) => {\n  return (\n    <ControlButton\n      label={`Question ${questionProgress![0]} of ${questionProgress![1]}  `}\n      isDisabled\n    />\n  );\n};\n","import { cloneDeep, uniq } from 'lodash';\nimport { v4 } from 'uuid';\n\nimport {\n  AchievementGoal,\n  AchievementItem,\n  AchievementStatus,\n  defaultGoalProgress,\n  GoalDefinition,\n  GoalProgress,\n  GoalType\n} from '../../../features/achievement/AchievementTypes';\nimport { showDangerMessage } from '../../utils/NotificationsHelper';\nimport { isExpired, isReleased } from './DateHelper';\n\n/**\n * An AchievementNode item encapsulates all important information of an achievement item\n *\n * @param {AchievementItem} achievement the achievement item\n * @param {Date | undefined} displayDeadline deadline displayed on the achievement card\n * @param {number} xp attained XP of the achievement\n * @param {number} progressFrac progress percentage in fraction. It is always between 0 to 1, both inclusive.\n * @param {AchievementStatus} status the achievement status\n * @param {Set<string>} children a set of immediate prerequisites uuid\n * @param {Set<string>} descendant a set of all descendant prerequisites uuid (including immediate prerequisites)\n * @param {Set<string>} parents a set of all immediate parent uuid\n */\nclass AchievementNode {\n  public achievement: AchievementItem;\n  public displayDeadline?: Date;\n  public xp: number;\n  public progressFrac: number;\n  public status: AchievementStatus;\n  public children: Set<string>;\n  public descendant: Set<string>;\n  public parents: Set<string>;\n\n  constructor(achievement: AchievementItem) {\n    const { deadline, prerequisiteUuids } = achievement;\n\n    this.achievement = achievement;\n    this.displayDeadline = deadline;\n    this.xp = 0;\n    this.progressFrac = 0;\n    this.status = AchievementStatus.ACTIVE;\n    this.children = new Set(prerequisiteUuids);\n    this.descendant = new Set(prerequisiteUuids);\n    this.parents = new Set();\n  }\n}\n\n/**\n * The AchievementInferencer consumes achievements and goals, then infers useful React props\n *\n * Note: The inferencer is responsible for assigning new UUIDs to AchievementItem and AchievementGoal\n */\nclass AchievementInferencer {\n  private nodeList: Map<string, AchievementNode> = new Map(); // key = achievementUuid, value = AchievementNode\n  private goalList: Map<string, AchievementGoal> = new Map(); // key = goalUuid, value = AchievementGoal\n  private textToUuid: Map<string, string> = new Map(); // key = goalText, value = goalUuid\n  private titleToUuid: Map<string, string> = new Map(); // key = achievementTitle, value = achievementUuid\n  private achievementsToDelete: string[] = [];\n  private goalsToDelete: string[] = [];\n\n  constructor(achievements: AchievementItem[], goals: AchievementGoal[]) {\n    this.nodeList = this.constructNodeList(achievements);\n    this.goalList = this.constructGoalList(goals);\n    this.processNodes();\n    this.processGoals();\n  }\n\n  /**\n   * Invalid Goal for the getters to return if the goal does not exist in the goalList\n   */\n  private invalidGoal: AchievementGoal = {\n    uuid: 'invalid',\n    text: 'invalid',\n    achievementUuids: [],\n    meta: { type: GoalType.MANUAL, targetCount: 0 },\n    count: 0,\n    targetCount: 0,\n    completed: false\n  };\n\n  /**\n   * Invalid Achievement for the getters to return if the goal does not exist in the goalList\n   */\n  private invalidAchievement: AchievementItem = {\n    uuid: 'invalid',\n    title: 'invalid',\n    xp: 0,\n    isVariableXp: false,\n    deadline: undefined,\n    release: undefined,\n    isTask: false,\n    position: 0,\n    prerequisiteUuids: [],\n    goalUuids: [],\n    cardBackground: 'invalid',\n    view: { coverImage: 'invalid', description: 'invalid', completionText: 'invalid' }\n  };\n\n  /**\n   * Returns an array of AchievementItem\n   */\n  public getAllAchievements() {\n    return [...this.nodeList.values()].map(node => node.achievement);\n  }\n\n  /**\n   * Returns an array of AchievementItem that have been released\n   */\n  public getAllReleasedAchievements() {\n    return [...this.nodeList.values()]\n      .filter(node => node.status !== AchievementStatus.UNRELEASED)\n      .map(node => node.achievement);\n  }\n\n  public getAllCompletedAchievements() {\n    return [...this.nodeList.values()]\n      .filter(node => node.status === AchievementStatus.COMPLETED)\n      .map(node => node.achievement);\n  }\n\n  /**\n   * Returns an array of achievementUuid\n   */\n  public getAllAchievementUuids() {\n    return [...this.nodeList.keys()];\n  }\n\n  /**\n   * Returns an array of AchievementGoal\n   */\n  public getAllGoals() {\n    return [...this.goalList.values()];\n  }\n\n  /**\n   * Returns an array of goalUuid\n   */\n  public getAllGoalUuids() {\n    return [...this.goalList.keys()];\n  }\n\n  /**\n   * Returns true if achievement exists\n   */\n  public hasAchievement(uuid: string) {\n    return this.nodeList.has(uuid);\n  }\n\n  /**\n   * Returns true if the achievement is a prerequisite of another achievement\n   *\n   * @param uuid Achievement uuid\n   */\n  public isPrerequisite(uuid: string) {\n    const node = this.nodeList.get(uuid);\n    return node ? node.parents.size > 0 : false;\n  }\n\n  /**\n   * Returns the AchievementItem\n   * Returns an invalid achievement item if the achievement is not in the map\n   *\n   * @param uuid Achievement Uuid\n   */\n  public getAchievement(uuid: string) {\n    const node = this.nodeList.get(uuid);\n    return node ? node.achievement : this.invalidAchievement;\n  }\n\n  /**\n   * Returns true if goal exists\n   */\n  public hasGoal(uuid: string) {\n    return this.goalList.has(uuid);\n  }\n\n  /**\n   * Returns the AchievementGoal\n   * Returns an invalid goal if the goal is not in the map\n   *\n   * @param uuid Goal Uuid\n   */\n  public getGoal(uuid: string) {\n    return this.goalList.get(uuid) || this.invalidGoal;\n  }\n\n  /**\n   * Returns the GoalDefinition\n   *\n   * @param uuid Goal Uuid\n   */\n  public getGoalDefinition(uuid: string) {\n    return this.getGoal(uuid) as GoalDefinition;\n  }\n\n  public getGoalProgress(uuid: string) {\n    return this.getGoal(uuid) as GoalProgress;\n  }\n\n  /**\n   * Returns the position of the achievement\n   *\n   * @param uuid Achievement Uuid\n   */\n  public getAchievementPositionByUuid(uuid: string) {\n    return this.getAchievement(uuid).position;\n  }\n\n  /**\n   * Returns the uuids of the achievements that were deleted\n   */\n  public getAchievementsToDelete() {\n    return this.achievementsToDelete;\n  }\n\n  /**\n   * Returns the uuids of the goals that were deleted\n   */\n  public getGoalsToDelete() {\n    return this.goalsToDelete;\n  }\n\n  /**\n   * Resets the array so the same achievement/goal is not deleted twice\n   */\n  public resetToDelete() {\n    this.achievementsToDelete = [];\n    this.goalsToDelete = [];\n  }\n\n  /**\n   * Returns an array of achievements that use the goal\n   *\n   * @param goalUuid UUID of the goal in question\n   */\n  public getAchievementsByGoal(goalUuid: string) {\n    return this.getGoal(goalUuid).achievementUuids;\n  }\n\n  public listSortedAchievementUuids() {\n    return this.getAllAchievements()\n      .sort((a, b) => a.position - b.position)\n      .map(achievement => achievement.uuid);\n  }\n\n  /**\n   * Returns true if the goal is invalid\n   *\n   * @param goal An AchievementGoal\n   */\n  public isInvalidGoal(goal: AchievementGoal) {\n    return goal === this.invalidGoal;\n  }\n\n  /**\n   * Returns true if the achievement is invalid\n   *\n   * @param achievement An AchievementItem\n   */\n  public isInvalidAchievement(achievement: AchievementItem) {\n    return achievement === this.invalidAchievement;\n  }\n\n  /**\n   * Inserts a new AchievementItem into the Inferencer,\n   * then returns the newly assigned achievementUuid\n   *\n   * @param achievement the AchievementItem\n   */\n  public insertAchievement(achievement: AchievementItem) {\n    // first, generate a new unique uuid\n    let newUuid = v4();\n    // a small overhead to truly guarantee uniqueness\n    while (this.nodeList.has(newUuid)) {\n      newUuid = v4();\n    }\n\n    // then assign the new unique uuid by overwriting the achievement item supplied by param\n    // and insert it into nodeList\n    achievement.uuid = newUuid;\n\n    this.nodeList.set(newUuid, new AchievementNode(achievement));\n\n    // finally, process the nodeList\n    this.processNodes();\n    this.normalizePositions(achievement.uuid, achievement.position);\n\n    return newUuid;\n  }\n\n  /**\n   * Inserts a new AchievementItem into the Inferencer,\n   * then returns the newly assigned achievementUuid.\n   * Used for inserting assessment achievements on the fly.\n   *\n   * @param achievement the AchievementItem\n   */\n  public insertFakeAchievement(achievement: AchievementItem) {\n    // and insert it into nodeList\n    this.nodeList.set(achievement.uuid, new AchievementNode(achievement));\n\n    // finally, process the nodeList\n    this.processNodes();\n    this.normalizePositions(achievement.uuid, achievement.position);\n\n    return achievement.uuid;\n  }\n\n  /**\n   * Inserts a new GoalDefinition into the Inferencer,\n   * then returns the newly assigned goalUuid\n   *\n   * @param definition the GoalDefinition\n   */\n  public insertGoalDefinition(definition: GoalDefinition) {\n    // first, generate a new unique uuid by finding the max uuid\n    let newUuid = v4();\n    // a small overhead to truly guarantee uniqueness\n    while (this.goalList.has(newUuid)) {\n      newUuid = v4();\n    }\n\n    // then assign the new unique uuid by overwriting the goal item supplied by param\n    // and insert it into goalList\n    definition.uuid = newUuid;\n    this.goalList.set(newUuid, { ...definition, ...defaultGoalProgress });\n\n    // finally, process the goalList\n    this.processGoals();\n\n    return newUuid;\n  }\n\n  /**\n   * Inserts a new GoalDefinition into the Inferencer,\n   * then returns the newly assigned goalUuid\n   * Used for inserting assessment goals on the fly\n   *\n   * @param definition the GoalDefinition\n   * @param complete whether the goal should be marked as completed or not\n   */\n  public insertFakeGoalDefinition(definition: GoalDefinition, complete: boolean) {\n    // then assign the new unique uuid by overwriting the goal item supplied by param\n    // and insert it into goalList\n    if (complete) {\n      this.goalList.set(definition.uuid, {\n        ...definition,\n        count: 1,\n        targetCount: 1,\n        completed: true\n      });\n    } else {\n      this.goalList.set(definition.uuid, {\n        ...definition,\n        count: 0,\n        targetCount: 1,\n        completed: false\n      });\n    }\n\n    // finally, process the goalList\n    this.processGoals();\n\n    return definition.uuid;\n  }\n\n  /**\n   * Updates the AchievementItem in the Inferencer\n   *\n   * @param achievement the AchievementItem\n   */\n  public modifyAchievement(achievement: AchievementItem) {\n    // directly replace the AchievementNode in nodeList\n    this.nodeList.set(achievement.uuid, new AchievementNode(achievement));\n\n    // then, process the nodeList\n    this.processNodes();\n    this.normalizePositions(achievement.uuid, achievement.position);\n  }\n\n  /**\n   * Updates the GoalDefinition in the Inferencer\n   *\n   * @param definition the GoalDefinition\n   */\n  public modifyGoalDefinition(definition: GoalDefinition) {\n    // directly replace the GoalDefinition in goalList\n    this.goalList.set(definition.uuid, { ...definition, ...defaultGoalProgress });\n\n    // then, process the nodeList and goalList\n    this.processNodes();\n    this.processGoals();\n  }\n\n  public modifyGoalProgress(progress: GoalProgress) {\n    const goal = this.getGoal(progress.uuid);\n    if (this.isInvalidGoal(goal)) {\n      return;\n    }\n    this.goalList.set(progress.uuid, { ...goal, ...progress });\n\n    const achievementUuids = goal.achievementUuids;\n    for (const uuid in achievementUuids) {\n      const node = this.nodeList.get(uuid);\n      if (node) {\n        this.generateXp(node);\n        this.generateProgressFrac(node);\n        this.generateStatus(node);\n      }\n    }\n  }\n\n  /**\n   * Removes the AchievementItem from the Inferencer\n   *\n   * @param targetUuid Achievement Uuid\n   */\n  public removeAchievement(targetUuid: string) {\n    const hasTarget = (node: AchievementNode) => node.children.has(targetUuid);\n\n    const sanitizeNode = (node: AchievementNode) => {\n      const newPrerequisiteUuids = node.achievement.prerequisiteUuids.filter(\n        uuid => uuid !== targetUuid\n      );\n      node.achievement.prerequisiteUuids = newPrerequisiteUuids;\n\n      return new AchievementNode(node.achievement);\n    };\n\n    // first, remove achievement from node list\n    this.nodeList.delete(targetUuid);\n    // then, remove reference of the target in other achievement's prerequisite\n    this.nodeList.forEach((node, uuid) => {\n      if (hasTarget(node)) {\n        this.nodeList.set(uuid, sanitizeNode(node));\n      }\n    });\n\n    // add the achievement to the list of things to delete\n    this.achievementsToDelete.push(targetUuid);\n\n    // finally, process the nodeList\n    this.processNodes();\n    this.normalizePositions();\n  }\n\n  /**\n   * Removes the GoalDefinition from the Inferencer\n   *\n   * @param targetUuid Goal Uuid\n   */\n  public removeGoalDefinition(targetUuid: string) {\n    const findTargetIndex = (node: AchievementNode) =>\n      node.achievement.goalUuids.findIndex(uuid => uuid === targetUuid);\n\n    const sanitizeNode = (node: AchievementNode) => {\n      const targetIndex = findTargetIndex(node);\n      if (targetIndex !== -1) {\n        node.achievement.goalUuids.splice(targetIndex, 1);\n      }\n    };\n\n    // first, remove goal from goal list\n    this.goalList.delete(targetUuid);\n    // then, remove the goalUuid from all achievement goalUuids\n    this.nodeList.forEach(node => sanitizeNode(node));\n\n    // add the goal to the list of things to delete\n    this.goalsToDelete.push(targetUuid);\n\n    // finally, process the nodeList and goalList\n    this.processNodes();\n    this.processGoals();\n  }\n\n  /**\n   * Returns an array of achievementUuid that isTask or is completed\n   */\n  public listTaskUuids() {\n    return this.getAllAchievements()\n      .filter(achievement => achievement.isTask || this.isCompleted(achievement))\n      .map(task => task.uuid);\n  }\n\n  /**\n   * Returns an array of achievementId that isTask or is completed sorted by position\n   */\n  public listSortedTaskUuids() {\n    return this.getAllAchievements()\n      .filter(achievement => achievement.isTask || this.isCompleted(achievement))\n      .sort((taskA, taskB) => taskA.position - taskB.position)\n      .map(sortedTask => sortedTask.uuid);\n  }\n\n  /**\n   * Returns an array of achievementId that isTask or is completed sorted by position\n   */\n  public listSortedReleasedTaskUuids() {\n    return this.getAllReleasedAchievements()\n      .filter(achievement => achievement.isTask || this.isCompleted(achievement))\n      .sort((taskA, taskB) => taskA.position - taskB.position)\n      .map(sortedTask => sortedTask.uuid);\n  }\n\n  /**\n   * Returns an array of achievementId sorted by position\n   */\n  public listAllSortedAchievementUuids() {\n    return this.getAllAchievements()\n      .sort((taskA, taskB) => taskA.position - taskB.position)\n      .map(sortedTask => sortedTask.uuid);\n  }\n\n  /**\n   * Returns whether an achievement is completed or not.\n   *\n   * NOTE: It might be better (more efficient) to simply have a completed proporty on each achievement.\n   */\n  public isCompleted(achievement: AchievementItem) {\n    const goalLength = achievement.goalUuids.length;\n    const prereqLength = achievement.prerequisiteUuids.length;\n\n    // an achievement with no goals and prerequisites should not be considered complete\n    if (goalLength === 0 && prereqLength === 0) {\n      return false;\n    }\n\n    // if any of the goals are not complete, return false\n    for (let i = 0; i < goalLength; i++) {\n      if (!this.getGoal(achievement.goalUuids[i]).completed) {\n        return false;\n      }\n    }\n    // if any of the prereqs are not complete, return false\n    for (let i = 0; i < prereqLength; i++) {\n      if (!this.isCompleted(this.getAchievement(achievement.prerequisiteUuids[i]))) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Returns an array of AchievementGoal which belongs to the achievement\n   *\n   * @param uuid Achievement Uuid\n   */\n  public listGoals(uuid: string) {\n    const { goalUuids } = this.getAchievement(uuid);\n    return goalUuids.map(goalUuid => this.getGoal(goalUuid));\n  }\n\n  /**\n   * Returns an array of AchievementGoal which belongs to the prerequisites of the achievement\n   *\n   * @param uuid Achievement Uuid\n   */\n  public listPrerequisiteGoals(uuid: string) {\n    const childGoalUuids: string[] = [];\n    for (const childUuid of this.getImmediateChildren(uuid)) {\n      const { goalUuids } = this.getAchievement(childUuid);\n      goalUuids.forEach(goalUuid => childGoalUuids.push(goalUuid));\n    }\n\n    return childGoalUuids.map(goalUuid => this.getGoal(goalUuid));\n  }\n\n  /**\n   * Returns the Goal Uuid associate to the Goal Text or undefined\n   *\n   * @param text goalText\n   */\n  public getUuidByText(text: string) {\n    return this.textToUuid.get(text);\n  }\n\n  /**\n   * Returns the Goal Text associate to the Goal Uuid or undefined\n   *\n   * @param text goalUuid\n   */\n  public getTextByUuid(uuid: string) {\n    return this.getGoal(uuid).text;\n  }\n\n  /**\n   * Returns the Achievement Uuid associate to the Achievement Title or undefined\n   *\n   * @param title achievementTitle\n   */\n  public getUuidByTitle(title: string) {\n    return this.titleToUuid.get(title);\n  }\n\n  /**\n   * Returns the Achievement Title associate to the Achievement Uuid or undefined\n   *\n   * @param text achievementUuid\n   */\n  public getTitleByUuid(uuid: string) {\n    return this.getAchievement(uuid).title;\n  }\n\n  /**\n   * Returns XP earned from the achievement\n   *\n   * @param uuid Achievement Uuid\n   */\n  public getAchievementXp(uuid: string) {\n    const achievement = this.getAchievement(uuid);\n    if (achievement.isVariableXp) {\n      return this.listGoals(achievement.uuid).reduce((xp, goal) => xp + goal.count, 0);\n    } else {\n      return achievement.xp;\n    }\n  }\n\n  /**\n   * Returns total XP earned from all achievements\n   */\n  public getTotalXp() {\n    return this.getAllCompletedAchievements().reduce(\n      (totalXp, achievement) => totalXp + this.getAchievementXp(achievement.uuid),\n      0\n    );\n  }\n\n  /**\n   * Returns the achievement progress percentage in fraction\n   *\n   * @param uuid Achievement Uuid\n   */\n  public getProgressFrac(uuid: string) {\n    return this.nodeList.has(uuid) ? this.nodeList.get(uuid)!.progressFrac : 0;\n  }\n\n  /**\n   * Returns the achievement status\n   *\n   * @param uuid Achievement Uuid\n   */\n  public getStatus(uuid: string) {\n    return this.nodeList.has(uuid) ? this.nodeList.get(uuid)!.status : AchievementStatus.ACTIVE;\n  }\n\n  /**\n   * Returns the achievement display deadline\n   *\n   * @param uuid Achievement Uuid\n   */\n  public getDisplayDeadline(uuid: string) {\n    return this.nodeList.has(uuid) ? this.nodeList.get(uuid)!.displayDeadline : undefined;\n  }\n\n  /**\n   * Returns true if the child is a prerequisite of parent achievement\n   *\n   * @param uuid Parent Achievement Uuid\n   * @param childUuid Child Achievement Uuid\n   */\n  public isImmediateChild(uuid: string, childUuid: string) {\n    return this.nodeList.has(uuid) ? this.nodeList.get(uuid)!.children.has(childUuid) : false;\n  }\n\n  /**\n   * Returns a set of prerequisite uuid\n   *\n   * @param uuid Achievement Uuid\n   */\n  public getImmediateChildren(uuid: string) {\n    return this.nodeList.has(uuid) ? this.nodeList.get(uuid)!.children : new Set<string>();\n  }\n\n  /**\n   * Returns true if an achievement is a descendant of ancestor achievement\n   *\n   * @param uuid Ancestor Achievement Uuid\n   * @param childUuid Descendant Achievement Uuid\n   */\n  public isDescendant(uuid: string, childUuid: string) {\n    return this.nodeList.has(uuid) ? this.nodeList.get(uuid)!.descendant.has(childUuid) : false;\n  }\n\n  /**\n   * Returns a set of descendant uuid\n   *\n   * @param uuid Achievement Uuid\n   */\n  public getDescendants(uuid: string) {\n    return this.nodeList.has(uuid) ? this.nodeList.get(uuid)!.descendant : new Set<string>();\n  }\n\n  /**\n   * Returns the total XP of the achievement and all its descendants\n   *\n   * @param uuid Achievement uuid\n   */\n  public getDescendantXp(uuid: string) {\n    let totalXp = this.getAchievementXp(uuid);\n\n    this.getDescendants(uuid).forEach(descendantUuid => {\n      if (this.isCompleted(this.getAchievement(descendantUuid))) {\n        totalXp += this.getAchievementXp(descendantUuid);\n      }\n    });\n\n    return totalXp;\n  }\n\n  /**\n   * Returns a list of achievementUuid that may be a prerequisite of the achievement\n   *\n   * @param uuid Achievement Uuid\n   */\n  public listAvailablePrerequisiteUuids(uuid: string) {\n    return this.getAllAchievementUuids().filter(\n      target =>\n        target !== uuid && !this.isDescendant(uuid, target) && !this.isDescendant(target, uuid)\n    );\n  }\n\n  /**\n   * Recalculates the AchievementNode data of each achievements, O(N) operation\n   */\n  private processNodes() {\n    this.titleToUuid = new Map();\n\n    this.nodeList.forEach(node => {\n      const { title, uuid } = node.achievement;\n      this.titleToUuid.set(title, uuid);\n\n      node.achievement.prerequisiteUuids = uniq(node.achievement.prerequisiteUuids);\n      node.achievement.goalUuids = uniq(node.achievement.goalUuids);\n\n      this.generateParentReference(node);\n      this.generateDescendant(node);\n      this.generateDisplayDeadline(node);\n      this.generateXp(node);\n      this.generateProgressFrac(node);\n      this.generateStatus(node);\n    });\n  }\n\n  private processGoals() {\n    this.textToUuid = new Map();\n\n    this.goalList.forEach(goal => {\n      const { text, uuid } = goal;\n      this.textToUuid.set(text, uuid);\n      goal.achievementUuids = uniq(goal.achievementUuids);\n    });\n  }\n\n  /**\n   * Returns a new nodeList constructed based on achievements\n   *\n   * @param achievements an array of AchievementItem\n   */\n  private constructNodeList(achievements: AchievementItem[]) {\n    const nodeList = new Map<string, AchievementNode>();\n    achievements.forEach(achievement =>\n      nodeList.set(achievement.uuid, new AchievementNode(cloneDeep(achievement)))\n    );\n    return nodeList;\n  }\n\n  /**\n   * Returns a new goalList constructed based on goals\n   *\n   * @param goals an array of AchievementGoal\n   */\n  private constructGoalList(goals: AchievementGoal[]) {\n    const goalList = new Map<string, AchievementGoal>();\n    goals.forEach(goal => goalList.set(goal.uuid, cloneDeep(goal)));\n    return goalList;\n  }\n\n  /**\n   * Mark immediate children's parent as this node\n   *\n   * @param node The AchievementNode\n   */\n  private generateParentReference(node: AchievementNode) {\n    // Mark immediate childeren\n    for (const childUuid of node.children) {\n      this.nodeList.get(childUuid)?.parents.add(node.achievement.uuid);\n    }\n  }\n\n  /**\n   * Recursively append grandchildren's uuid to children, O(N) operation\n   *\n   * @param node the AchievementNode\n   */\n  private generateDescendant(node: AchievementNode) {\n    for (const childUuid of node.descendant) {\n      if (childUuid === node.achievement.uuid) {\n        const { title } = node.achievement;\n        // Note: not the best error handling practice, but as long as admin verifies the\n        // data in AchievementPreview and do not publish new achievements with circular\n        // dependency error, it should be suffice\n        showDangerMessage(`Circular dependency detected in achievement ${title}`, 30000);\n      }\n      for (const grandchildUuid of this.getDescendants(childUuid)) {\n        // Newly added grandchild is appended to the back of the set.\n        node.descendant.add(grandchildUuid);\n        // Hence the great grandchildren will be added when the iterator reaches there\n      }\n    }\n  }\n\n  /**\n   * Set the node's display deadline by comparing with all descendants' deadlines\n   *\n   * Displays the closest unexpired deadline of all descendants. If none (e.g. descendant\n   * deadlines are expired or undefined), then display the node's own deadline\n   *\n   * @param node the AchievementNode\n   */\n  private generateDisplayDeadline(node: AchievementNode) {\n    // Comparator of two deadlines\n    const compareDeadlines = (\n      displayDeadline: Date | undefined,\n      currentDeadline: Date | undefined\n    ) => {\n      if (currentDeadline === undefined || isExpired(currentDeadline)) {\n        // currentDeadline undefined or expired, nothing change\n        return displayDeadline;\n      } else if (displayDeadline === undefined) {\n        return currentDeadline;\n      } else {\n        // currentDeadline unexpired, displayDeadline may or may not expired\n        // hence display the closest unexpired deadline\n        return isExpired(displayDeadline) || currentDeadline < displayDeadline\n          ? currentDeadline\n          : displayDeadline;\n      }\n    };\n\n    // Temporary array of all descendants' deadlines\n    const descendantDeadlines: (Date | undefined)[] = [];\n    for (const childUuid of node.descendant) {\n      const childDeadline = this.getAchievement(childUuid).deadline;\n      descendantDeadlines.push(childDeadline);\n    }\n\n    // Reduces the temporary array to a single Date value\n    node.displayDeadline = descendantDeadlines.reduce(compareDeadlines, node.displayDeadline);\n  }\n\n  /**\n   * Calculates the achievement attained XP\n   *\n   * @param node the AchievementNode\n   */\n  private generateXp(node: AchievementNode) {\n    const { goalUuids, isVariableXp } = node.achievement;\n    const allGoalsCompleted = goalUuids.reduce(\n      (completion, goalUuid) => completion && this.getGoal(goalUuid).completed,\n      true\n    );\n    node.xp = allGoalsCompleted\n      ? isVariableXp\n        ? goalUuids.reduce((xp, goalUuid) => xp + this.getGoal(goalUuid).count, 0)\n        : node.achievement.xp\n      : 0;\n  }\n\n  /**\n   * Calculates the achievement progress percentage between [0..1]\n   *\n   * @param node the AchievementNode\n   */\n  private generateProgressFrac(node: AchievementNode) {\n    const { goalUuids } = node.achievement;\n    if (goalUuids.length === 0) {\n      node.progressFrac = 0;\n    } else {\n      const num = goalUuids.reduce((count, goalUuid) => count + this.getGoal(goalUuid).count, 0);\n      const denom = goalUuids.reduce(\n        (count, goalUuid) => count + this.getGoal(goalUuid).targetCount,\n        0\n      );\n      node.progressFrac = Math.min(denom === 0 ? 0 : num / denom, 1);\n    }\n  }\n\n  /**\n   * Generates the achievement status\n   *\n   * AchievementStatus.COMPLETED if contains goals and all goals completed\n   * AchievementStatus.ACTIVE if has at least 1 active descendant\n   * AchievementStatus.EXPIRED if none of the above\n   *\n   * @param node the AchievementNode\n   */\n  private generateStatus(node: AchievementNode) {\n    // checks if the achievement's goals and prereqs are complete\n    const achievementCompleted = this.isCompleted(node.achievement);\n\n    const hasReleased = isReleased(node.achievement.release);\n    const hasUnexpiredDeadline = !isExpired(node.displayDeadline);\n\n    node.status = achievementCompleted\n      ? AchievementStatus.COMPLETED\n      : hasReleased\n      ? hasUnexpiredDeadline\n        ? AchievementStatus.ACTIVE\n        : AchievementStatus.EXPIRED\n      : AchievementStatus.UNRELEASED;\n  }\n\n  /**\n   * Reassign the achievement position number without changing their orders.\n   * If anchorUuid and anchorPosition is supplied, the anchor achievement is\n   * guaranteed to have its position set at anchorPosition.\n   *\n   * @param anchorUuid anchor achievementUuid\n   * @param anchorPosition anchor position\n   */\n  private normalizePositions(anchorUuid?: string, anchorPosition?: number) {\n    let newPosition = 1;\n    this.getAllAchievements()\n      .filter(achievement => achievement.isTask)\n      .filter(achievement => achievement.position >= 0) // force negative position tasks to show up on top\n      .sort((taskA, taskB) => taskA.position - taskB.position)\n      .forEach(sortedTask => (sortedTask.position = newPosition++));\n    this.getAllAchievements()\n      .filter(achievement => !achievement.isTask)\n      .forEach(nonTask => (nonTask.position = 0));\n\n    // If some achievement got misplaced at the anchorPosition, swap it\n    // back with the anchor achievement\n    if (anchorUuid && anchorPosition && anchorPosition !== 0) {\n      const anchorAchievement = this.getAchievement(anchorUuid);\n      const newPosition = anchorAchievement.position;\n      if (newPosition !== anchorPosition) {\n        const misplacedAchievement = this.getAllAchievements().find(\n          achievement => achievement.position === anchorPosition\n        );\n        if (misplacedAchievement) {\n          misplacedAchievement.position = newPosition;\n          anchorAchievement.position = anchorPosition;\n        }\n      }\n    }\n  }\n}\n\nexport default AchievementInferencer;\n","import React from 'react';\nimport Draggable, { DraggableEventHandler } from 'react-draggable';\n\nimport Repl, { ReplProps } from '../repl/Repl';\n\ntype DraggableReplProps = {\n  position: { x: number; y: number };\n  onDrag: DraggableEventHandler;\n  disabled: boolean;\n  replProps: ReplProps;\n};\n\nconst DraggableRepl: React.FC<DraggableReplProps> = (props: DraggableReplProps) => {\n  return (\n    <Draggable\n      axis=\"y\"\n      handle=\"#dragHandle\"\n      position={props.position}\n      bounds={{ top: -500, left: 0, right: 0, bottom: 0 }}\n      onDrag={props.onDrag}\n      disabled={props.disabled}\n    >\n      <div className=\"mobile-draggable\">\n        {!props.disabled ? (\n          <div className=\"handle enabled\" id=\"dragHandle\">\n            {['1', '2', '3'].map(i => (\n              <div className=\"circle\" key={i} />\n            ))}\n          </div>\n        ) : (\n          <div className=\"handle disabled\" id=\"draghandle\">\n            {['1', '2', '3'].map(i => (\n              <div className=\"circle\" key={i} />\n            ))}\n          </div>\n        )}\n        <div className=\"REPL-content\">\n          <Repl {...props.replProps} />\n        </div>\n      </div>\n    </Draggable>\n  );\n};\n\nexport default DraggableRepl;\n","import { Ace } from 'ace-builds';\nimport React from 'react';\nimport Draggable, { DraggableEvent, DraggableEventHandler } from 'react-draggable';\nimport Keyboard from 'react-simple-keyboard';\n\nexport type MobileKeyboardProps = OwnProps;\n\ntype OwnProps = {\n  targetKeyboardInput: Ace.Editor | null;\n};\n\nconst MobileKeyboard: React.FC<MobileKeyboardProps> = props => {\n  const [isKeyboardShown, setIsKeyoardShown] = React.useState(false);\n  const [buttonContent, setButtonContent] = React.useState('');\n  const [keyboardPosition, setKeyboardPosition] = React.useState({ x: 0, y: 0 });\n  const [selectedIndex, setSelectedIndex] = React.useState(1);\n\n  const onDrag: DraggableEventHandler = (\n    e: DraggableEvent,\n    position: { x: number; y: number }\n  ): void => {\n    setKeyboardPosition(position);\n  };\n\n  const handlePreventDefault = (event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n    event.preventDefault();\n  };\n\n  const handleHiding = (event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n    if (isKeyboardShown) {\n      //do hiding\n      document.getElementById('mobile-keyboard-toggle')!.style.setProperty('display', 'none');\n      document.getElementById('mobile-floating-toggle')!.style.setProperty('width', '42px');\n      document.getElementById('mobile-floating-toggle')!.style.setProperty('opacity', '0.6');\n      setButtonContent('');\n      setIsKeyoardShown(false);\n    } else {\n      //do showing\n      document.getElementById('mobile-keyboard-toggle')!.style.setProperty('display', 'flex');\n      document.getElementById('mobile-floating-toggle')!.style.setProperty('width', '99%');\n      document.getElementById('mobile-floating-toggle')!.style.setProperty('opacity', '1');\n      setButtonContent('');\n      setIsKeyoardShown(true);\n    }\n  };\n\n  const handleRowToggle = (event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n    setSelectedIndex((selectedIndex + 1) % 3);\n    const keyboardClass = document.getElementsByClassName('simple-keyboard-shortcut');\n    Array.from(keyboardClass as HTMLCollectionOf<HTMLElement>)[0].style.top =\n      -selectedIndex * 45 + 'px';\n  };\n\n  const handleKeyPress = (button: string) => {\n    if (!props.targetKeyboardInput) {\n      return;\n    }\n    const editor = props.targetKeyboardInput;\n    if (button === '{arrowleft}') {\n      editor.navigateLeft();\n    } else if (button === '{arrowright}') {\n      editor.navigateRight();\n    } else if (button === '{bksp}') {\n      editor.remove('left');\n    } else if (button === '{tab}') {\n      editor.insert('\\t');\n    } else if (['+', '-', '*', '/', '%', '=>', '===', '&&', '||'].includes(button)) {\n      editor.insert(' ' + button + ' ');\n    } else {\n      editor.insert(button);\n    }\n  };\n\n  const keyboardProps = {\n    onKeyPress: handleKeyPress,\n    baseClass: 'simple-keyboard-shortcut',\n    layout: {\n      default: [\n        '{ } ( ) \" \\' _ => ;',\n        '{tab} && || ! < > = ===',\n        '+ - * / % // {arrowleft} {arrowright}'\n      ]\n    },\n    buttonTheme: [\n      {\n        class: 'mobile-navigation',\n        buttons: '{arrowleft} {arrowright}'\n      },\n      {\n        class: 'big-buttons',\n        buttons: '=== &&'\n      }\n    ],\n    theme: 'hg-theme-default',\n    preventMouseDownDefault: true,\n    disableCaretPositioning: false\n  };\n\n  return (\n    <Draggable\n      axis=\"y\"\n      handle=\"#floating-dragHandle\"\n      position={keyboardPosition}\n      bounds={{ top: -200, left: 0, right: 0, bottom: +200 }}\n      onDrag={onDrag}\n    >\n      <div className=\"mobile-floating-keyboard\" id=\"mobile-floating-toggle\">\n        <button\n          className=\"mobile-floating-toggle\"\n          onClick={handleHiding}\n          onMouseDown={handlePreventDefault}\n        >\n          {buttonContent}\n        </button>\n\n        <div className=\"mobile-keyboard-toggle-container\" id=\"mobile-keyboard-toggle\">\n          <div className=\"mobile-keyboard-container\">\n            <Keyboard {...keyboardProps} />\n          </div>\n          <button\n            className=\"mobile-keyboard-row-toggle\"\n            onClick={handleRowToggle}\n            onMouseDown={handlePreventDefault}\n          >\n            \n          </button>\n        </div>\n\n        <div id=\"floating-dragHandle\">:</div>\n      </div>\n    </Draggable>\n  );\n};\n\nexport default MobileKeyboard;\n","import { Button, Classes } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Popover2 } from '@blueprintjs/popover2';\nimport classNames from 'classnames';\n\nimport { ControlBarProps } from '../../controlBar/ControlBar';\n\nconst MobileControlBar: React.FC<ControlBarProps> = props => {\n  const controlBarMenu = (\n    <div className=\"mobile-control-bar\">\n      {props.editorButtons}\n      {props.flowButtons}\n      {props.editingWorkspaceButtons}\n    </div>\n  );\n\n  return (\n    <Popover2 content={controlBarMenu} autoFocus={false}>\n      <Button\n        icon={IconNames.COG}\n        className={classNames(Classes.MINIMAL, 'mobile-control-bar-button')}\n      />\n    </Popover2>\n  );\n};\n\nexport default MobileControlBar;\n","import { Classes, Icon, Tab, Tabs } from '@blueprintjs/core';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport classNames from 'classnames';\nimport React from 'react';\n\nimport { ControlBarProps } from '../../controlBar/ControlBar';\nimport GenericSideContent, {\n  generateIconId,\n  GenericSideContentProps\n} from '../../sideContent/GenericSideContent';\nimport { SideContentTab, SideContentType } from '../../sideContent/SideContentTypes';\nimport { propsAreEqual } from '../../utils/MemoizeHelper';\nimport { WorkspaceLocation } from '../../workspace/WorkspaceTypes';\nimport MobileControlBar from './MobileControlBar';\n\nexport type MobileSideContentProps = Omit<GenericSideContentProps, 'renderFunction'> &\n  Required<Pick<GenericSideContentProps, 'onChange'>> &\n  StateProps &\n  MobileControlBarProps;\n\ntype StateProps = {\n  selectedTabId: SideContentType;\n  renderActiveTabPanelOnly?: boolean;\n};\n\ntype MobileControlBarProps = {\n  mobileControlBarProps: ControlBarProps;\n};\n\nconst renderTab = (tab: SideContentTab, isIOS: boolean, workspaceLocation?: WorkspaceLocation) => {\n  const iconSize = 20;\n  const tabId = tab.id === undefined ? tab.label : tab.id;\n  const tabTitle: JSX.Element = (\n    <Tooltip2\n      content={tab.label}\n      onOpening={() => {\n        // Handles iOS hover requiring double taps to press the button\n        if (isIOS) {\n          document.getElementById(generateIconId(tabId))?.click();\n        }\n      }}\n    >\n      <div className=\"side-content-tooltip\" id={generateIconId(tabId)}>\n        <Icon icon={tab.iconName} iconSize={iconSize} />\n      </div>\n    </Tooltip2>\n  );\n\n  return (\n    <Tab\n      key={tabId}\n      id={tabId}\n      title={tabTitle}\n      disabled={tab.disabled}\n      className=\"side-content-tab\"\n    />\n  );\n};\n\nconst MobileSideContent: React.FC<MobileSideContentProps> = React.memo(\n  ({ selectedTabId, renderActiveTabPanelOnly, mobileControlBarProps, ...otherProps }) => {\n    const isIOS = /iPhone|iPod/.test(navigator.platform);\n\n    /**\n     * renderedPanels is not memoized since a change in selectedTabId (when changing tabs)\n     * would force React.useMemo to recompute the nullary function anyway\n     */\n    const renderedPanels = (dynamicTabs: SideContentTab[]) => {\n      // TODO: Fix the CSS of all the panels (e.g. subst_visualizer)\n      const renderPanel = (tab: SideContentTab, workspaceLocation?: WorkspaceLocation) => {\n        if (!tab.body) return;\n\n        const tabBody: JSX.Element = workspaceLocation\n          ? {\n              ...tab.body,\n              props: {\n                ...tab.body.props,\n                workspaceLocation\n              }\n            }\n          : tab.body;\n\n        // Render the other panels only when their corresponding tab is selected\n        return (\n          <div\n            className={\n              tab.id === selectedTabId ? 'mobile-selected-panel' : 'mobile-unselected-panel'\n            }\n            key={tab.id}\n          >\n            {tabBody}\n          </div>\n        );\n      };\n\n      return dynamicTabs.map(tab => renderPanel(tab, otherProps.workspaceLocation));\n    };\n\n    return (\n      <GenericSideContent\n        {...otherProps}\n        renderFunction={(dynamicTabs, changeTabsCallback) => {\n          return (\n            <>\n              {renderedPanels(dynamicTabs)}\n              <div className=\"mobile-tabs-container\">\n                <Tabs\n                  id=\"mobile-side-content\"\n                  onChange={changeTabsCallback}\n                  renderActiveTabPanelOnly={renderActiveTabPanelOnly}\n                  selectedTabId={selectedTabId}\n                  className={classNames(Classes.DARK, 'mobile-side-content')}\n                >\n                  {dynamicTabs.map(tab => renderTab(tab, isIOS, otherProps.workspaceLocation))}\n\n                  {/* Render the bottom ControlBar 'Cog' button only in the Playground or Sicp Workspace */}\n                  {(otherProps.workspaceLocation === 'playground' ||\n                    otherProps.workspaceLocation === 'sicp') && (\n                    <MobileControlBar {...mobileControlBarProps} />\n                  )}\n                </Tabs>\n              </div>\n            </>\n          );\n        }}\n      />\n    );\n  },\n  propsAreEqual\n);\n\nexport default MobileSideContent;\n","import { FocusStyleManager } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Ace } from 'ace-builds';\nimport React from 'react';\nimport { DraggableEvent } from 'react-draggable';\nimport { useMediaQuery } from 'react-responsive';\nimport { Prompt } from 'react-router';\n\nimport ControlBar from '../controlBar/ControlBar';\nimport EditorContainer, { EditorContainerProps } from '../editor/EditorContainer';\nimport McqChooser, { McqChooserProps } from '../mcqChooser/McqChooser';\nimport { ReplProps } from '../repl/Repl';\nimport { SideBarTab } from '../sideBar/SideBar';\nimport { SideContentTab, SideContentType } from '../sideContent/SideContentTypes';\nimport DraggableRepl from './DraggableRepl';\nimport MobileKeyboard from './MobileKeyboard';\nimport MobileSideContent, { MobileSideContentProps } from './mobileSideContent/MobileSideContent';\n\nexport type MobileWorkspaceProps = StateProps;\n\ntype StateProps = {\n  editorContainerProps?: EditorContainerProps; // Either editorProps or mcqProps must be provided\n  hasUnsavedChanges?: boolean; // Not used in Playground\n  mcqProps?: McqChooserProps; // Not used in Playground\n  replProps: ReplProps;\n  sideBarProps: {\n    tabs: SideBarTab[];\n  };\n  mobileSideContentProps: MobileSideContentProps;\n};\n\nconst MobileWorkspace: React.FC<MobileWorkspaceProps> = props => {\n  const isAndroid = /Android/.test(navigator.userAgent);\n  const isPortrait = useMediaQuery({ orientation: 'portrait' });\n  const [draggableReplPosition, setDraggableReplPosition] = React.useState({ x: 0, y: 0 });\n\n  // For disabling draggable Repl when in stepper tab\n  const [isDraggableReplDisabled, setIsDraggableReplDisabled] = React.useState(false);\n\n  // Get rid of the focus border on blueprint components\n  FocusStyleManager.onlyShowFocusOnTabs();\n\n  // Handles the panel height when the mobile top controlbar is rendered in the Assessment Workspace\n  React.useEffect(() => {\n    if (props.mobileSideContentProps.workspaceLocation === 'assessment') {\n      document.documentElement.style.setProperty(\n        '--mobile-panel-height',\n        'calc(100% - 100px - 1.1rem)'\n      );\n    }\n\n    return () => {\n      document.documentElement.style.setProperty('--mobile-panel-height', 'calc(100% - 70px)');\n    };\n    // This effect should only trigger once during the initial rendering of the workspace\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  /**\n   * The following effect prevents the bottom MobileSideContent tabs from floating above the\n   * soft keyboard on Android devices. This is due to the viewport height changing when the soft\n   * keyboard is up on Android devices. IOS devices are not affected.\n   */\n  React.useEffect(() => {\n    if (isPortrait && isAndroid) {\n      document.documentElement.style.setProperty('overflow', 'auto');\n      const metaViewport = document.querySelector('meta[name=viewport]');\n      metaViewport!.setAttribute(\n        'content',\n        'height=' + window.innerHeight + ', width=device-width'\n      );\n    }\n\n    // Reset above CSS and hides draggable Repl on orientation change\n    return () => {\n      if (isAndroid) {\n        document.documentElement.style.setProperty('overflow', 'hidden');\n        const metaViewport = document.querySelector('meta[name=viewport]');\n        metaViewport!.setAttribute(\n          'content',\n          'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'\n        );\n      }\n      handleHideRepl();\n    };\n  }, [isPortrait, isAndroid]);\n\n  const [targetKeyboardInput, setTargetKeyboardInput] = React.useState<Ace.Editor | null>(null);\n\n  const clearTargetKeyboardInput = () => setTargetKeyboardInput(null);\n\n  const enableMobileKeyboardForEditor = (props: EditorContainerProps): EditorContainerProps => {\n    const onFocus = (event: any, editor?: Ace.Editor) => {\n      if (props.onFocus) {\n        props.onFocus(event, editor);\n      }\n      if (!editor) {\n        return;\n      }\n      setTargetKeyboardInput(editor);\n    };\n    const onBlur = (event: any, editor?: Ace.Editor) => {\n      if (props.onBlur) {\n        props.onBlur(event, editor);\n      }\n      clearTargetKeyboardInput();\n    };\n    return {\n      ...props,\n      onFocus,\n      onBlur\n    };\n  };\n\n  const enableMobileKeyboardForRepl = (props: ReplProps): ReplProps => {\n    const onFocus = (editor: Ace.Editor) => {\n      if (props.onFocus) {\n        props.onFocus(editor);\n      }\n      setTargetKeyboardInput(editor);\n    };\n    const onBlur = () => {\n      if (props.onBlur) {\n        props.onBlur();\n      }\n      clearTargetKeyboardInput();\n    };\n    return {\n      ...props,\n      onFocus,\n      onBlur\n    };\n  };\n\n  const createWorkspaceInput = () => {\n    if (props.editorContainerProps) {\n      const editorContainerProps = {\n        ...props.editorContainerProps\n      };\n      if (editorContainerProps.editorVariant === 'sourcecast') {\n        editorContainerProps.setDraggableReplPosition = () => handleShowRepl(-100);\n      }\n      return <EditorContainer {...enableMobileKeyboardForEditor(props.editorContainerProps)} />;\n    } else {\n      return <McqChooser {...props.mcqProps!} />;\n    }\n  };\n\n  /**\n   * The following 3 'react-draggable' handlers include the updating of CSS variable:\n   * '--mobile-repl-height'.\n   *\n   * 'position: absolute' for the 'react-draggable' component is used in conjunction with the\n   * modification of the mobile browser's meta viewport height to ensure that the draggable\n   * component (and bottom MobileSideContentTabs) remain at the bottom of the screen when the\n   * keyboard is up on Android devices. This is because viewport height changes by default when\n   * the keyboard is up on Android devices, causing unexpected UI distortions. IOS devices do\n   * not have this problem.\n   * ('position: fixed' does not work as the element would then be positioned relative to the\n   * browser window, and would still be 'pushed up' by the keyboard)\n   *\n   * Since 'position: absolute' elements take up 'full space', we have to dynamically update the\n   * height of the entire draggable component ('--mobile-repl-height') to ensure that the draggable\n   * component is 'properly closed' and does not continue to display content underneath the\n   * MobileSideContentTabs.\n   *\n   * This also ensures proper scrolling of overflowing Repl outputs inside the dynamically resizing\n   * draggable component.\n   */\n  const onDrag = (e: DraggableEvent, position: { x: number; y: number }): void => {\n    document.documentElement.style.setProperty(\n      '--mobile-repl-height',\n      Math.max(-position.y, 0) + 'px'\n    );\n    setDraggableReplPosition(position);\n  };\n\n  const handleShowRepl = (offset: number) => {\n    document.documentElement.style.setProperty('--mobile-repl-height', Math.max(-offset, 0) + 'px');\n    setDraggableReplPosition({ x: 0, y: offset });\n  };\n\n  const handleHideRepl = () => {\n    setDraggableReplPosition({ x: 0, y: 0 });\n    document.documentElement.style.setProperty('--mobile-repl-height', '0px');\n  };\n\n  const handleTabChangeForRepl = (newTabId: SideContentType, prevTabId: SideContentType) => {\n    // Evaluate program upon pressing the run tab.\n    if (newTabId === SideContentType.mobileEditorRun) {\n      props.editorContainerProps?.handleEditorEval();\n    }\n\n    // Show the REPL upon pressing the run tab if the previous tab is not listed below.\n    if (\n      newTabId === SideContentType.mobileEditorRun &&\n      !(\n        prevTabId === SideContentType.substVisualizer ||\n        prevTabId === SideContentType.autograder ||\n        prevTabId === SideContentType.testcases\n      )\n    ) {\n      handleShowRepl(-300);\n    } else {\n      handleHideRepl();\n    }\n\n    // Disable draggable REPL when on the files & stepper tab.\n    if (\n      newTabId === SideContentType.files ||\n      newTabId === SideContentType.substVisualizer ||\n      (prevTabId === SideContentType.substVisualizer &&\n        newTabId === SideContentType.mobileEditorRun)\n    ) {\n      setIsDraggableReplDisabled(true);\n    } else {\n      setIsDraggableReplDisabled(false);\n    }\n  };\n\n  // Convert sidebar tabs with a side content tab ID into side content tabs.\n  const sideBarTabs: SideContentTab[] = props.sideBarProps.tabs.filter(tab => tab.id !== undefined);\n\n  const mobileEditorTab: SideContentTab = React.useMemo(\n    () => ({\n      label: 'Editor',\n      iconName: IconNames.EDIT,\n      body: null,\n      id: SideContentType.mobileEditor\n    }),\n    []\n  );\n\n  const mobileRunTab: SideContentTab = React.useMemo(\n    () => ({\n      label: 'Run',\n      iconName: IconNames.PLAY,\n      body: null,\n      id: SideContentType.mobileEditorRun\n    }),\n    []\n  );\n\n  const updatedMobileSideContentProps = () => {\n    return {\n      ...props.mobileSideContentProps,\n      onChange: (\n        newTabId: SideContentType,\n        prevTabId: SideContentType,\n        event: React.MouseEvent<HTMLElement>\n      ) => {\n        props.mobileSideContentProps.onChange(newTabId, prevTabId, event);\n        handleTabChangeForRepl(newTabId, prevTabId);\n      },\n      tabs: {\n        beforeDynamicTabs: [\n          ...sideBarTabs,\n          mobileEditorTab,\n          ...props.mobileSideContentProps.tabs.beforeDynamicTabs\n        ],\n        afterDynamicTabs: [...props.mobileSideContentProps.tabs.afterDynamicTabs, mobileRunTab]\n      }\n    };\n  };\n\n  const inAssessmentWorkspace =\n    props.mobileSideContentProps.workspaceLocation === 'assessment' ||\n    props.mobileSideContentProps.workspaceLocation === 'githubAssessment';\n\n  return (\n    <div className=\"workspace mobile-workspace\">\n      {props.hasUnsavedChanges ? (\n        <Prompt\n          message={'You have changes that may not be saved. Are you sure you want to leave?'}\n        />\n      ) : null}\n\n      {/* Render the top ControlBar when it is the Assessment Workspace */}\n      {inAssessmentWorkspace && (\n        <ControlBar {...props.mobileSideContentProps.mobileControlBarProps} />\n      )}\n\n      <div>\n        <div className=\"mobile-editor-panel\">{createWorkspaceInput()}</div>\n        <MobileSideContent {...updatedMobileSideContentProps()} />\n      </div>\n\n      <DraggableRepl\n        key=\"repl\"\n        position={draggableReplPosition}\n        onDrag={onDrag}\n        disabled={isDraggableReplDisabled}\n        replProps={enableMobileKeyboardForRepl(props.replProps)}\n      />\n\n      <MobileKeyboard targetKeyboardInput={targetKeyboardInput} />\n    </div>\n  );\n};\n\nexport default MobileWorkspace;\n","import { IconNames } from '@blueprintjs/icons';\nimport React from 'react';\n\nimport ControlButton from '../ControlButton';\n\ntype ControlBarReturnToAcademyButtonProps = {\n  onClick?(): any;\n};\n\nexport const ControlBarReturnToAcademyButton: React.FC<ControlBarReturnToAcademyButtonProps> = ({\n  onClick\n}) => {\n  return (\n    <ControlButton\n      label=\"Return to Academy\"\n      icon={IconNames.ARROW_RIGHT}\n      onClick={onClick}\n      options={{ iconOnRight: true }}\n    />\n  );\n};\n","import { IconNames } from '@blueprintjs/icons';\nimport React from 'react';\n\nimport ControlButton from '../ControlButton';\nimport { ControlBarReturnToAcademyButton } from './ControlBarReturnToAcademyButton';\n\ntype ControlBarNextButtonProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  onClickNext?(): any;\n  onClickReturn?(): any;\n};\n\ntype StateProps = {\n  key: string;\n  questionProgress: [number, number] | null;\n};\n\nexport const ControlBarNextButton: React.FC<ControlBarNextButtonProps> = props => {\n  return props.questionProgress![0] === props.questionProgress![1] ? (\n    <ControlBarReturnToAcademyButton onClick={props.onClickReturn} key=\"return_to_academy\" />\n  ) : (\n    <ControlButton\n      label=\"Next\"\n      icon={IconNames.ARROW_RIGHT}\n      onClick={props.onClickNext}\n      options={{ iconOnRight: true }}\n    />\n  );\n};\n","import React from 'react';\nimport { RefObject } from 'react';\n\nimport { IVisible } from '../EnvVisualizerTypes';\n\n/**\n * class to implement the IVisible interface, used by both compact and non-compact components.\n */\nexport abstract class Visible implements IVisible {\n  protected _x: number = 0;\n  protected _y: number = 0;\n  protected _width: number = 0;\n  protected _height: number = 0;\n  protected _isDrawn: boolean = false;\n  x(): number {\n    return this._x;\n  }\n  y(): number {\n    return this._y;\n  }\n  width(): number {\n    return this._width;\n  }\n  height(): number {\n    return this._height;\n  }\n  isDrawn(): boolean {\n    return this._isDrawn;\n  }\n  reset(): void {\n    this._isDrawn = false;\n  }\n  ref: RefObject<any> = React.createRef();\n  abstract draw(key?: number): React.ReactNode;\n}\n","/** configs for dimensions */\nexport enum CompactConfig {\n  CanvasMinHeight = 300,\n  CanvasMinWidth = 300,\n  CanvasPaddingX = 30,\n  CanvasPaddingY = 30,\n\n  LevelPaddingX = 10,\n  LevelPaddingY = 10,\n\n  FrameMinWidth = 100,\n  FramePaddingX = 20,\n  FramePaddingY = 30,\n  FrameMarginX = 30,\n  FrameMarginY = 10,\n  FrameCornerRadius = 3,\n\n  FnRadius = 15,\n  FnInnerRadius = 3,\n  FnTooltipOpacity = 0.3,\n\n  DataMinWidth = 20,\n  DataUnitWidth = 40,\n  DataUnitHeight = 40,\n  DataCornerRadius = 3,\n  DataHitStrokeWidth = 5,\n\n  TextPaddingX = 10,\n  TextPaddingY = 30,\n  TextMargin = 5,\n  TextMinWidth = 30,\n  FontFamily = 'monospace, monospace',\n  FontSize = 15,\n  FontStyle = 'normal',\n  FontVariant = 'normal',\n\n  HoveredColor = '#32CD32',\n\n  ArrowHeadSize = 10,\n  ArrowStrokeWidth = 1,\n  ArrowHitStrokeWidth = 5,\n  ArrowHoveredStrokeWidth = 2,\n  ArrowCornerRadius = 40,\n\n  SA_WHITE = '#999999',\n  SA_BLUE = '#2c3e50',\n  PRINT_BACKGROUND = 'white',\n\n  ConstantColon = ':= ',\n  VariableColon = ': ',\n  Ellipsis = '',\n\n  UnassignedData = '',\n  GlobalFrameDefaultText = ':::pre-declared names::',\n  GlobalEnvId = '-1'\n}\n\nexport const ShapeDefaultProps = {\n  preventDefault: false\n};\n","/** configs for dimensions */\nexport enum Config {\n  CanvasMinHeight = 300,\n  CanvasMinWidth = 300,\n  CanvasPaddingX = 30,\n  CanvasPaddingY = 30,\n\n  LevelPaddingX = 10,\n  LevelPaddingY = 10,\n\n  FrameMinWidth = 100,\n  FramePaddingX = 20,\n  FramePaddingY = 30,\n  FrameMarginX = 60,\n  FrameMarginY = 100,\n  FrameCornerRadius = 3,\n\n  FnRadius = 15,\n  FnInnerRadius = 3,\n  FnTooltipOpacity = 0.6,\n\n  DataMinWidth = 20,\n  DataUnitWidth = 40,\n  DataUnitPaddingY = 40,\n  DataUnitPaddingX = 50,\n  DataUnitHeight = 40,\n  DataCornerRadius = 3,\n  DataHitStrokeWidth = 5,\n  DataGroupMaxDist = 500,\n\n  TextPaddingX = 10,\n  TextPaddingY = 20,\n  TextMargin = 5,\n  TextMinWidth = 30,\n  FontFamily = 'monospace, monospace',\n  FontSize = 15,\n  FontStyle = 'normal',\n  FontVariant = 'normal',\n\n  HoveredColor = '#32CD32',\n\n  ArrowHeadSize = 10,\n  ArrowStrokeWidth = 1,\n  ArrowHitStrokeWidth = 5,\n  ArrowHoveredStrokeWidth = 2,\n  ArrowUnhoveredOpacity = 0.8,\n  ArrowCornerRadius = 10,\n  ArrowMinHeight = 100,\n  ArrowNumLanes = 5,\n  ArrowLaneInterval = 1, // lane for next arrow = previous lane + lane interval % num lanes.\n  FrameArrowStrokeWidth = 2,\n  FrameArrowHoveredStrokeWidth = 2.5,\n  MaxExportWidth = 20000,\n  MaxExportHeight = 12000,\n\n  SA_WHITE = '#999999',\n  SA_BLUE = '#2c3e50',\n  PRINT_BACKGROUND = 'white',\n\n  ConstantColon = ':= ',\n  VariableColon = ': ',\n  Ellipsis = '',\n\n  UnassignedData = '',\n  GlobalFrameDefaultText = ':::pre-declared names::',\n  GlobalEnvId = '-1'\n}\n\nexport const ShapeDefaultProps = {\n  preventDefault: false\n};\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport React from 'react';\nimport { Group, Label as KonvaLabel, Tag as KonvaTag, Text as KonvaText } from 'react-konva';\n\nimport EnvVisualizer from '../EnvVisualizer';\nimport { Config, ShapeDefaultProps } from '../EnvVisualizerConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { Data, IHoverable } from '../EnvVisualizerTypes';\nimport { getTextWidth, setHoveredCursor, setUnhoveredCursor } from '../EnvVisualizerUtils';\nimport { Frame } from './Frame';\nimport { Visible } from './Visible';\n\nexport interface TextOptions {\n  maxWidth: number;\n  fontSize: number;\n  fontFamily: string;\n  fontStyle: string;\n  fontVariant: string;\n  isStringIdentifiable: boolean;\n}\n\nexport const defaultOptions: TextOptions = {\n  maxWidth: Number.MAX_VALUE, // maximum width this text should be\n  fontFamily: Config.FontFamily.toString(), // default is Arial\n  fontSize: Number(Config.FontSize), // in pixels. Default is 12\n  fontStyle: Config.FontStyle.toString(), // can be normal, bold, or italic. Default is normal\n  fontVariant: Config.FontVariant.toString(), // can be normal or small-caps. Default is normal\n  isStringIdentifiable: false // if true, contain strings within double quotation marks \"\". Default is false\n};\n\n/** this class encapsulates a string to be drawn onto the canvas */\nexport class Text extends Visible implements IHoverable {\n  readonly _hoveredWidth: number;\n\n  readonly partialStr: string; // truncated string representation of data\n  readonly fullStr: string; // full string representation of data\n\n  readonly options: TextOptions = defaultOptions;\n  readonly frame?: Frame;\n\n  constructor(\n    readonly data: Data,\n    x: number,\n    y: number,\n    /** additional options (for customization of text) */\n    options: Partial<TextOptions> = {},\n    frame?: Frame\n  ) {\n    super();\n    this._x = x;\n    this._y = y;\n    this.frame = frame;\n    this.options = { ...this.options, ...options };\n\n    const { fontSize, fontStyle, fontFamily, maxWidth, isStringIdentifiable } = this.options;\n\n    this.fullStr = this.partialStr = isStringIdentifiable\n      ? JSON.stringify(data) || String(data)\n      : String(data);\n    this._height = fontSize;\n\n    const widthOf = (s: string) => getTextWidth(s, `${fontStyle} ${fontSize}px ${fontFamily}`);\n    this._hoveredWidth = widthOf(this.partialStr);\n    if (this._hoveredWidth > maxWidth) {\n      let truncatedText = Config.Ellipsis.toString();\n      let i = 0;\n      while (widthOf(this.partialStr.substring(0, i) + Config.Ellipsis.toString()) < maxWidth) {\n        truncatedText = this.partialStr.substring(0, i++) + Config.Ellipsis.toString();\n      }\n      this._width = widthOf(truncatedText);\n      this.partialStr = truncatedText;\n    } else {\n      this._width = Math.max(Config.TextMinWidth, widthOf(this.partialStr));\n    }\n  }\n\n  hoveredWidth(): number {\n    return this._hoveredWidth;\n  }\n  updatePosition = (x: number, y: number) => {\n    this._x = x;\n    this._y = y;\n  };\n  onMouseEnter = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    if (EnvVisualizer.getPrintableMode()) return;\n    setHoveredCursor(currentTarget);\n    this.ref.current.moveToTop();\n    this.ref.current.show();\n    currentTarget.getLayer()?.draw();\n  };\n\n  onMouseLeave = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    if (EnvVisualizer.getPrintableMode()) return;\n    setUnhoveredCursor(currentTarget);\n    this.ref.current.hide();\n    currentTarget.getLayer()?.draw();\n  };\n\n  draw(): React.ReactNode {\n    const props = {\n      fontFamily: this.options.fontFamily,\n      fontSize: this.options.fontSize,\n      fontStyle: this.options.fontStyle,\n      fill: EnvVisualizer.getPrintableMode()\n        ? Config.SA_BLUE.toString()\n        : Config.SA_WHITE.toString()\n    };\n    return (\n      <Group key={Layout.key++} onMouseEnter={this.onMouseEnter} onMouseLeave={this.onMouseLeave}>\n        <KonvaLabel x={this.x()} y={this.y()}>\n          <KonvaText {...ShapeDefaultProps} key={Layout.key++} text={this.partialStr} {...props} />\n        </KonvaLabel>\n        <KonvaLabel x={this.x()} y={this.y()} ref={this.ref} visible={false} listening={false}>\n          <KonvaTag\n            {...ShapeDefaultProps}\n            fill={EnvVisualizer.getPrintableMode() ? 'white' : 'black'}\n            opacity={0.5}\n            listening={false}\n          />\n          <KonvaText\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            text={this.fullStr}\n            {...props}\n            listening={false}\n          />\n        </KonvaLabel>\n      </Group>\n    );\n  }\n}\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport { Arrow as KonvaArrow, Group as KonvaGroup, Path as KonvaPath } from 'react-konva';\n\nimport EnvVisualizer from '../../EnvVisualizer';\nimport { Config, ShapeDefaultProps } from '../../EnvVisualizerConfig';\nimport { Layout } from '../../EnvVisualizerLayout';\nimport { IHoverable, IVisible, StepsArray } from '../../EnvVisualizerTypes';\nimport {\n  setHoveredCursor,\n  setHoveredStyle,\n  setUnhoveredCursor,\n  setUnhoveredStyle\n} from '../../EnvVisualizerUtils';\nimport { Frame } from '../Frame';\nimport { Text } from '../Text';\nimport { Visible } from '../Visible';\n\n/** this class encapsulates an arrow to be drawn between 2 points */\nexport class GenericArrow<Source extends IVisible, Target extends IVisible>\n  extends Visible\n  implements IHoverable\n{\n  points: number[] = [];\n  source: Source;\n  target: Target | undefined;\n\n  private _path: string = '';\n  private selected: boolean = false;\n  readonly unhovered_opacity: number = Config.ArrowUnhoveredOpacity;\n  readonly hovered_opacity: number = 1;\n\n  constructor(source: Source) {\n    super();\n    this.source = source;\n    this._x = source.x();\n    this._y = source.y();\n  }\n  path() {\n    return this._path;\n  }\n  to(target: Target): GenericArrow<Source, Target> {\n    this.target = target;\n    this._width = Math.abs(target.x() - this.source.x());\n    this._height = Math.abs(target.y() - this.source.y());\n    return this;\n  }\n  isSelected(): boolean {\n    return this.selected;\n  }\n  /**\n   * Calculates the steps that this arrows takes.\n   * The arrow is decomposed into numerous straight line segments, each of which we\n   * can consider as a step of dx in the x direction and of dy in the y direction.\n   * The line segment is thus defined by 2 points (x, y) and (x + dx, y + dy)\n   * where (x, y) is the ending coordinate of the previous line segment.\n   * This function returns an array of such steps, represented by an array of functions\n   *  [ (x, y) => [x + dx1, y + dy1], (x, y) => [x + dx2, y + dy2], ... ].\n   * From this, we can retrieve the points that make up the arrow as such:\n   * (from.x from.y), (from.x + dx1, from.y + dy1), (from.x + dx1 + dx2, from.y + dy1 + dy2), ..\n   *\n   * Note that the functions need not be of the form (x, y) => [x + dx, y + dy];\n   * (x, y) => [to.x, to.y] is valid as well, and is used to specify a step to the ending coordinates\n   *\n   * @return an array of steps represented by functions\n   */\n  protected calculateSteps(): StepsArray {\n    const to = this.target;\n    if (!to) return [];\n    return [() => [to.x(), to.y()]];\n  }\n  getStrokeWidth(): number {\n    return Number(Config.ArrowStrokeWidth);\n  }\n  onMouseEnter(e: KonvaEventObject<MouseEvent>) {\n    setHoveredCursor(e.target);\n    setHoveredStyle(e.currentTarget, {\n      strokeWidth: Number(Config.ArrowHoveredStrokeWidth)\n    });\n    this.ref.current.opacity = this.unhovered_opacity;\n  }\n  onClick({ currentTarget }: KonvaEventObject<MouseEvent>) {\n    this.selected = !this.selected;\n    if (!this.isSelected()) {\n      if (\n        !(this.source instanceof Text && this.source.frame?.isSelected()) &&\n        !(this.source instanceof Frame && this.source.isSelected())\n      ) {\n        setUnhoveredStyle(currentTarget, {\n          strokeWidth: this.getStrokeWidth()\n        });\n        this.ref.current.opacity = this.unhovered_opacity;\n      } else {\n        setHoveredStyle(currentTarget, {\n          strokeWidth: Number(Config.ArrowHoveredStrokeWidth) * this.unhovered_opacity\n        });\n        this.ref.current.opacity = this.hovered_opacity;\n      }\n    }\n  }\n  onMouseLeave(e: KonvaEventObject<MouseEvent>) {\n    setUnhoveredCursor(e.target);\n    if (!this.isSelected()) {\n      if (\n        (this.source instanceof Text && this.source.frame?.isSelected()) ||\n        (this.source instanceof Frame && this.source.isSelected())\n      ) {\n        setHoveredStyle(e.currentTarget, {\n          strokeWidth: Number(Config.ArrowHoveredStrokeWidth) * this.unhovered_opacity\n        });\n        this.ref.current.opacity = this.hovered_opacity;\n      } else {\n        setUnhoveredStyle(e.currentTarget, {\n          strokeWidth: this.getStrokeWidth()\n        });\n        this.ref.current.opacity = this.unhovered_opacity;\n      }\n    }\n  }\n  draw() {\n    const points = this.calculateSteps().reduce<Array<number>>(\n      (points, step) => [...points, ...step(points[points.length - 2], points[points.length - 1])],\n      [this.source.x(), this.source.y()]\n    );\n    points.splice(0, 2);\n\n    let path = '';\n    // starting point\n    path += `M ${points[0]} ${points[1]} `;\n    if (points.length === 4) {\n      // end the path if the line only has starting and ending coordinates\n      path += `L ${points[2]} ${points[3]} `;\n    } else {\n      let n = 0;\n      while (n < points.length - 4) {\n        const [xa, ya, xb, yb, xc, yc] = points.slice(n, n + 6);\n        const dx1 = (xb - xa) / 2;\n        const dx2 = (xc - xb) / 2;\n        const dy1 = (yb - ya) / 2;\n        const dy2 = (yc - yb) / 2;\n        const r1 = Math.sqrt(Math.pow(dx1, 2) + Math.pow(dy1, 2)) / 2;\n        const r2 = Math.sqrt(Math.pow(dx2, 2) + Math.pow(dy2, 2)) / 2;\n        const br = Math.min(Config.ArrowCornerRadius, r1, r2);\n        const x1 = xb - (br * dx1) / r1;\n        const y1 = yb - (br * dy1) / r1;\n        const x2 = xb + (br * dx2) / r2;\n        const y2 = yb + (br * dy2) / r2;\n\n        // draw quadratic curves over corners\n        path += `L ${x1} ${y1} Q ${xb} ${yb} ${x2} ${y2} `;\n        n += 2;\n      }\n    }\n    // end path\n    path += `L ${points[points.length - 2]} ${points[points.length - 1]} `;\n    this._path = path;\n    return (\n      <KonvaGroup\n        key={Layout.key++}\n        ref={this.ref}\n        onMouseEnter={e => this.onMouseEnter(e)}\n        onMouseLeave={e => this.onMouseLeave(e)}\n        onClick={e => this.onClick(e)}\n        opacity={this.unhovered_opacity}\n      >\n        <KonvaPath\n          {...ShapeDefaultProps}\n          stroke={\n            EnvVisualizer.getPrintableMode()\n              ? Config.SA_BLUE.toString()\n              : Config.SA_WHITE.toString()\n          }\n          strokeWidth={this.getStrokeWidth()}\n          hitStrokeWidth={Number(Config.ArrowHitStrokeWidth)}\n          data={path}\n          key={Layout.key++}\n        />\n        <KonvaArrow\n          {...ShapeDefaultProps}\n          points={points.slice(points.length - 4)}\n          fill={\n            EnvVisualizer.getPrintableMode()\n              ? Config.SA_BLUE.toString()\n              : Config.SA_WHITE.toString()\n          }\n          strokeEnabled={false}\n          pointerWidth={Number(Config.ArrowHeadSize)}\n          pointerLength={Number(Config.ArrowHeadSize)}\n          key={Layout.key++}\n        />\n      </KonvaGroup>\n    );\n  }\n}\n","import { KonvaEventObject } from 'konva/lib/Node';\n\nimport { Config } from '../../EnvVisualizerConfig';\nimport { StepsArray } from '../../EnvVisualizerTypes';\nimport { setHoveredStyle, setUnhoveredStyle } from '../../EnvVisualizerUtils';\nimport { ArrowLane } from '../ArrowLane';\nimport { Frame } from '../Frame';\nimport { GenericArrow } from './GenericArrow';\n\n/** this class encapsulates an GenericArrow to be drawn between 2 points */\nexport class ArrowFromFrame extends GenericArrow<Frame, Frame> {\n  protected calculateSteps() {\n    const target = this.target;\n    if (!target) return [];\n\n    const steps: StepsArray = [(x, y) => [x + Config.FramePaddingX, y]];\n    const differentiateByParentFrame = true;\n    if (target instanceof Frame) {\n      // To differentiate frames pointing to different parent frames\n      if (differentiateByParentFrame) {\n        steps.push((x, y) => [\n          x,\n          ArrowLane.getHorizontalLaneAfterSource(target, y).getPosition(target)\n        ]);\n      } else {\n        steps.push((x, y) => [x, y - Config.FrameMarginY]);\n      }\n      steps.push((x, y) => [target.x() + Config.FramePaddingX, y]);\n    }\n\n    steps.push((x, y) => [target.x() + Config.FramePaddingX, target.y() + target.height()]);\n    return steps;\n  }\n\n  getStrokeWidth(): number {\n    return Number(Config.FrameArrowStrokeWidth);\n  }\n\n  onClick(e: KonvaEventObject<MouseEvent>) {\n    super.onClick(e);\n    setHoveredStyle(e.currentTarget, {\n      strokeWidth: Number(Config.FrameArrowHoveredStrokeWidth)\n    });\n  }\n\n  onMouseEnter(e: KonvaEventObject<MouseEvent>) {\n    super.onMouseEnter(e);\n    setHoveredStyle(e.currentTarget, {\n      strokeWidth: Number(Config.FrameArrowHoveredStrokeWidth)\n    });\n  }\n\n  onMouseLeave(e: KonvaEventObject<MouseEvent>) {\n    super.onMouseLeave(e);\n    if (this.isSelected() || (this.source as Frame).isSelected()) {\n      setHoveredStyle(e.currentTarget, {\n        strokeWidth: Number(Config.FrameArrowStrokeWidth)\n      });\n    } else {\n      setUnhoveredStyle(e.currentTarget, {\n        strokeWidth: Number(Config.FrameArrowStrokeWidth)\n      });\n    }\n  }\n}\n","import React, { RefObject } from 'react';\nimport { Rect } from 'react-konva';\n\nimport EnvVisualizer from '../EnvVisualizer';\nimport { Config, ShapeDefaultProps } from '../EnvVisualizerConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { Data } from '../EnvVisualizerTypes';\nimport { ArrayValue } from './values/ArrayValue';\nimport { Visible } from './Visible';\n\n/** this classes encapsulates an empty array */\nexport class ArrayEmptyUnit extends Visible {\n  readonly value: null = null;\n\n  readonly data: Data = [];\n  ref: RefObject<any> = React.createRef();\n\n  constructor(readonly parent: ArrayValue) {\n    super();\n    this._x = this.parent.x();\n    this._y = this.parent.y();\n    this._height = this.parent.height();\n    this._width = this.parent.width();\n  }\n\n  updatePosition = () => {\n    this._x = this.parent.x();\n    this._y = this.parent.y();\n  };\n\n  draw(): React.ReactNode {\n    return (\n      <Rect\n        {...ShapeDefaultProps}\n        key={Layout.key++}\n        x={this.x()}\n        y={this.y()}\n        width={this.width()}\n        height={this.height()}\n        stroke={\n          EnvVisualizer.getPrintableMode() ? Config.SA_BLUE.toString() : Config.SA_WHITE.toString()\n        }\n        ref={this.ref}\n      />\n    );\n  }\n}\n","import { Config } from '../../EnvVisualizerConfig';\nimport { StepsArray } from '../../EnvVisualizerTypes';\nimport { ArrowLane } from '../ArrowLane';\nimport { Frame } from '../Frame';\nimport { FnValue } from '../values/FnValue';\nimport { GlobalFnValue } from '../values/GlobalFnValue';\nimport { GenericArrow } from './GenericArrow';\n\n/** this class encapsulates an GenericArrow to be drawn between 2 points */\nexport class ArrowFromFn extends GenericArrow<FnValue | GlobalFnValue, Frame> {\n  protected calculateSteps() {\n    const source = this.source;\n    const target = this.target;\n    if (!target) return [];\n\n    const steps: StepsArray = [(x, y) => [x + Config.FnRadius * 3, y]];\n\n    if (target.y() < source.y() && source.y() < target.y() + target.height()) {\n      steps.push((x, y) => [x, y - Config.FnRadius * 2]);\n      steps.push((x, y) => [target.x() + (source.x() < target.x() ? 0 : target.width()), y]);\n    } else {\n      steps.push((x, y) => [x, y - Config.FnRadius * 2]);\n      steps.push((x, y) => [\n        ArrowLane.getVerticalLaneBeforeTarget(source, x).getPosition(source),\n        y\n      ]);\n      steps.push((x, y) => [\n        x,\n        ArrowLane.getHorizontalLaneBeforeTarget(target, y).getPosition(target)\n      ]);\n      steps.push((x, y) => [target.x() + (target.x() < x ? target.width() : 0), y]);\n      steps.push((x, y) => [x, target.y() + (target.y() < source.y() ? target.height() : 0)]);\n    }\n\n    return steps;\n  }\n}\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport React from 'react';\n\nimport { Data, IHoverable, ReferenceType } from '../../EnvVisualizerTypes';\nimport { Visible } from '../Visible';\n\n/** the value of a `Binding` or an `ArrayUnit` */\nexport abstract class Value extends Visible implements IHoverable {\n  abstract onMouseEnter(e: KonvaEventObject<MouseEvent>): void;\n  abstract onMouseLeave(e: KonvaEventObject<MouseEvent>): void;\n\n  /** draw logic */\n  abstract draw(key?: number): React.ReactNode;\n  /** add reference (binding / array unit) to this value */\n  addReference(newReference: ReferenceType): void {\n    this.referencedBy.push(newReference);\n  }\n  abstract updatePosition(pos?: { x: number; y: number }): void;\n\n  /** references to this value */\n  abstract referencedBy: ReferenceType[];\n  /** the underlying data of this value */\n  abstract readonly data: Data;\n}\n","import { Environment } from 'c-slang/dist/types';\nimport { KonvaEventObject } from 'konva/lib/Node';\nimport React, { RefObject } from 'react';\nimport {\n  Circle,\n  Group,\n  Label as KonvaLabel,\n  Tag as KonvaTag,\n  Text as KonvaText\n} from 'react-konva';\n\nimport EnvVisualizer from '../../EnvVisualizer';\nimport { Config, ShapeDefaultProps } from '../../EnvVisualizerConfig';\nimport { Layout } from '../../EnvVisualizerLayout';\nimport { EnvTreeNode, FnTypes, IHoverable, ReferenceType } from '../../EnvVisualizerTypes';\nimport {\n  getBodyText,\n  getNonEmptyEnv,\n  getParamsText,\n  getTextWidth,\n  setHoveredStyle,\n  setUnhoveredStyle\n} from '../../EnvVisualizerUtils';\nimport { ArrowFromFn } from '../arrows/ArrowFromFn';\nimport { GenericArrow } from '../arrows/GenericArrow';\nimport { Binding } from '../Binding';\nimport { Frame } from '../Frame';\nimport { GlobalFnValue } from './GlobalFnValue';\nimport { Value } from './Value';\n\n/** this class encapsulates a JS Slang function (not from the global frame) that\n *  contains extra props such as environment and fnName */\nexport class FnValue extends Value implements IHoverable {\n  centerX: number;\n  readonly tooltipWidth: number;\n  readonly exportTooltipWidth: number;\n  readonly radius: number = Config.FnRadius;\n  readonly innerRadius: number = Config.FnInnerRadius;\n\n  /** name of this function */\n  readonly fnName: string;\n  readonly paramsText: string;\n  readonly bodyText: string;\n  readonly exportBodyText: string;\n  readonly tooltip: string;\n  readonly exportTooltip: string;\n  private selected: boolean = false;\n  private _arrow: GenericArrow<FnValue | GlobalFnValue, Frame> | undefined;\n\n  /** the parent/enclosing environment of this fn value */\n  readonly enclosingEnvNode: EnvTreeNode;\n  readonly ref: RefObject<any> = React.createRef();\n  readonly labelRef: RefObject<any> = React.createRef();\n\n  constructor(\n    /** underlying JS Slang function (contains extra props) */\n    readonly data: FnTypes,\n    /** what this value is being referenced by */\n    readonly referencedBy: ReferenceType[]\n  ) {\n    super();\n    Layout.memoizeValue(this);\n\n    // derive the coordinates from the main reference (binding / array unit)\n    const mainReference = this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x = mainReference.frame.x() + mainReference.frame.width() + Config.FrameMarginX / 4;\n      this._y = mainReference.y();\n      this.centerX = this._x + this.radius * 2;\n    } else {\n      if (mainReference.isLastUnit) {\n        this._x = mainReference.x() + Config.DataUnitWidth * 2;\n        this._y = mainReference.y() + Config.DataUnitHeight / 2 - this.radius;\n      } else {\n        this._x = mainReference.x();\n        this._y = mainReference.y() + mainReference.parent.height() + Config.DataUnitHeight;\n      }\n      this.centerX = this._x + Config.DataUnitWidth / 2;\n      this._x = this.centerX - this.radius * 2;\n    }\n    this._y += this.radius;\n\n    this._width = this.radius * 4;\n    this._height = this.radius * 2;\n\n    this.enclosingEnvNode = Layout.environmentTree.getTreeNode(\n      getNonEmptyEnv(this.data.environment) as Environment\n    ) as EnvTreeNode;\n    this.fnName = this.data.functionName;\n\n    this.paramsText = `params: (${getParamsText(this.data)})`;\n    this.bodyText = `body: ${getBodyText(this.data)}`;\n    this.exportBodyText =\n      (this.bodyText.length > 23 ? this.bodyText.slice(0, 20) : this.bodyText)\n        .split('\\n')\n        .slice(0, 2)\n        .join('\\n') + ' ...';\n    this.tooltip = `${this.paramsText}\\n${this.bodyText}`;\n    this.exportTooltip = `${this.paramsText}\\n${this.exportBodyText}`;\n    this.tooltipWidth = Math.max(getTextWidth(this.paramsText), getTextWidth(this.bodyText));\n    this.exportTooltipWidth = Math.max(\n      getTextWidth(this.paramsText),\n      getTextWidth(this.exportBodyText)\n    );\n  }\n\n  isSelected(): boolean {\n    return this.selected;\n  }\n  arrow(): GenericArrow<FnValue | GlobalFnValue, Frame> | undefined {\n    return this._arrow;\n  }\n  updatePosition(): void {\n    const mainReference =\n      this.referencedBy.find(\n        x => x instanceof Binding && (x as Binding).frame.envTreeNode === this.enclosingEnvNode\n      ) || this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x = mainReference.frame.x() + mainReference.frame.width() + Config.FrameMarginX / 4;\n      this._y = mainReference.y();\n      this.centerX = this._x + this.radius * 2;\n    } else {\n      if (mainReference.isLastUnit) {\n        this._x = mainReference.x() + Config.DataUnitWidth * 2;\n        this._y = mainReference.y() + Config.DataUnitHeight / 2 - this.radius;\n      } else {\n        this._x = mainReference.x();\n        this._y = mainReference.y() + mainReference.parent.height() + Config.DataUnitHeight;\n      }\n      this.centerX = this._x + Config.DataUnitWidth / 2;\n      this._x = this.centerX - this.radius * 2;\n    }\n    this._y += this.radius;\n  }\n  reset(): void {\n    super.reset();\n    this.referencedBy.length = 0;\n  }\n  onMouseEnter = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    if (EnvVisualizer.getPrintableMode()) return;\n    this.labelRef.current.moveToTop();\n    this.labelRef.current.show();\n    setHoveredStyle(currentTarget);\n  };\n\n  onMouseLeave = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    if (EnvVisualizer.getPrintableMode()) return;\n    if (!this.selected) {\n      this.labelRef.current.hide();\n      setUnhoveredStyle(currentTarget);\n    } else {\n      const container = currentTarget.getStage()?.container();\n      container && (container.style.cursor = 'default');\n    }\n  };\n  onClick = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    if (EnvVisualizer.getPrintableMode()) return;\n    this.selected = !this.selected;\n    if (!this.selected) {\n      this.labelRef.current.hide();\n      setUnhoveredStyle(currentTarget);\n    } else {\n      this.labelRef.current.show();\n      setHoveredStyle(currentTarget);\n    }\n  };\n\n  draw(): React.ReactNode {\n    this._isDrawn = true;\n    this._arrow =\n      this.enclosingEnvNode.frame && new ArrowFromFn(this).to(this.enclosingEnvNode.frame);\n    return (\n      <React.Fragment key={Layout.key++}>\n        <Group\n          onMouseEnter={e => this.onMouseEnter(e)}\n          onMouseLeave={e => this.onMouseLeave(e)}\n          onClick={e => this.onClick(e)}\n          ref={this.ref}\n        >\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX - this.radius}\n            y={this.y()}\n            radius={this.radius}\n            stroke={\n              EnvVisualizer.getPrintableMode()\n                ? Config.SA_BLUE.toString()\n                : Config.SA_WHITE.toString()\n            }\n          />\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX - this.radius}\n            y={this.y()}\n            radius={this.innerRadius}\n            fill={\n              EnvVisualizer.getPrintableMode()\n                ? Config.SA_BLUE.toString()\n                : Config.SA_WHITE.toString()\n            }\n          />\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX + this.radius}\n            y={this.y()}\n            radius={this.radius}\n            stroke={\n              EnvVisualizer.getPrintableMode()\n                ? Config.SA_BLUE.toString()\n                : Config.SA_WHITE.toString()\n            }\n          />\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX + this.radius}\n            y={this.y()}\n            radius={this.innerRadius}\n            fill={\n              EnvVisualizer.getPrintableMode()\n                ? Config.SA_BLUE.toString()\n                : Config.SA_WHITE.toString()\n            }\n          />\n        </Group>\n        {EnvVisualizer.getPrintableMode() ? (\n          <KonvaLabel\n            x={this.x() + this.width() + Config.TextPaddingX * 2}\n            y={this.y() - Config.TextPaddingY}\n            visible={true}\n            ref={this.labelRef}\n          >\n            <KonvaTag stroke=\"black\" fill={'white'} opacity={Number(Config.FnTooltipOpacity)} />\n            <KonvaText\n              text={this.exportTooltip}\n              fontFamily={Config.FontFamily.toString()}\n              fontSize={Number(Config.FontSize)}\n              fontStyle={Config.FontStyle.toString()}\n              fill={Config.SA_BLUE.toString()}\n              padding={5}\n            />\n          </KonvaLabel>\n        ) : (\n          <KonvaLabel\n            x={this.x() + this.width() + Config.TextPaddingX * 2}\n            y={this.y() - Config.TextPaddingY}\n            visible={false}\n            ref={this.labelRef}\n          >\n            <KonvaTag stroke=\"black\" fill={'black'} opacity={Number(Config.FnTooltipOpacity)} />\n            <KonvaText\n              text={this.tooltip}\n              fontFamily={Config.FontFamily.toString()}\n              fontSize={Number(Config.FontSize)}\n              fontStyle={Config.FontStyle.toString()}\n              fill={Config.SA_WHITE.toString()}\n              padding={5}\n            />\n          </KonvaLabel>\n        )}\n        {this._arrow?.draw()}\n      </React.Fragment>\n    );\n  }\n}\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport React, { RefObject } from 'react';\nimport {\n  Circle,\n  Group,\n  Label as KonvaLabel,\n  Tag as KonvaTag,\n  Text as KonvaText\n} from 'react-konva';\n\nimport EnvVisualizer from '../../EnvVisualizer';\nimport { Config, ShapeDefaultProps } from '../../EnvVisualizerConfig';\nimport { Layout } from '../../EnvVisualizerLayout';\nimport { ReferenceType } from '../../EnvVisualizerTypes';\nimport {\n  getBodyText,\n  getParamsText,\n  getTextWidth,\n  setHoveredStyle,\n  setUnhoveredStyle\n} from '../../EnvVisualizerUtils';\nimport { ArrowFromFn } from '../arrows/ArrowFromFn';\nimport { GenericArrow } from '../arrows/GenericArrow';\nimport { Binding } from '../Binding';\nimport { Frame } from '../Frame';\nimport { FnValue } from './FnValue';\nimport { Value } from './Value';\n\n/** this encapsulates a function from the global frame\n * (which has no extra props such as environment or fnName) */\nexport class GlobalFnValue extends Value {\n  centerX: number;\n  readonly tooltipWidth: number;\n  readonly exportTooltipWidth: number;\n  readonly radius: number = Config.FnRadius;\n  readonly innerRadius: number = Config.FnInnerRadius;\n  private _arrow: GenericArrow<FnValue | GlobalFnValue, Frame> | undefined;\n\n  readonly paramsText: string;\n  readonly bodyText: string;\n  readonly exportBodyText: string;\n  readonly tooltip: string;\n  readonly exportTooltip: string;\n  private selected: boolean = false;\n\n  readonly ref: RefObject<any> = React.createRef();\n  readonly labelRef: RefObject<any> = React.createRef();\n\n  constructor(\n    /** underlying function */\n    readonly data: () => any,\n    /** what this value is being referenced by */\n    readonly referencedBy: ReferenceType[]\n  ) {\n    super();\n    Layout.memoizeValue(this);\n\n    // derive the coordinates from the main reference (binding / array unit)\n    const mainReference = this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x = mainReference.frame.x() + mainReference.frame.width() + Config.FrameMarginX / 4;\n      this._y = mainReference.y();\n      this.centerX = this._x + this.radius * 2;\n    } else {\n      if (mainReference.isLastUnit) {\n        this._x = mainReference.x() + Config.DataUnitWidth * 2;\n        this._y = mainReference.y() + Config.DataUnitHeight / 2 - this.radius;\n      } else {\n        this._x = mainReference.x();\n        this._y = mainReference.y() + mainReference.parent.height() + Config.DataUnitHeight;\n      }\n      this.centerX = this._x + Config.DataUnitWidth / 2;\n      this._x = this.centerX - this.radius * 2;\n    }\n    this._y += this.radius;\n\n    this._width = this.radius * 4;\n    this._height = this.radius * 2;\n\n    this.paramsText = `params: ${getParamsText(this.data)}`;\n    this.bodyText = `body: ${getBodyText(this.data)}`;\n    this.exportBodyText =\n      (this.bodyText.length > 23 ? this.bodyText.slice(0, 20) : this.bodyText)\n        .split('\\n')\n        .slice(0, 2)\n        .join('\\n') + ' ...';\n    this.tooltip = `${this.paramsText}\\n${this.bodyText}`;\n    this.exportTooltip = `${this.paramsText}\\n${this.exportBodyText}`;\n    this.tooltipWidth =\n      Math.max(getTextWidth(this.paramsText), getTextWidth(this.bodyText)) + Config.TextPaddingX;\n    this.exportTooltipWidth = Math.max(\n      getTextWidth(this.paramsText),\n      getTextWidth(this.exportBodyText)\n    );\n  }\n\n  isSelected(): boolean {\n    return this.selected;\n  }\n  arrow(): GenericArrow<FnValue | GlobalFnValue, Frame> | undefined {\n    return this._arrow;\n  }\n\n  updatePosition(): void {\n    const mainReference = this.referencedBy.find(x => x instanceof Binding) || this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x = mainReference.frame.x() + mainReference.frame.width() + Config.FrameMarginX / 4;\n      this._y = mainReference.y();\n      this.centerX = this._x + this.radius * 2;\n    } else {\n      if (mainReference.isLastUnit) {\n        this._x = mainReference.x() + Config.DataUnitWidth * 2;\n        this._y = mainReference.y() + Config.DataUnitHeight / 2 - this.radius;\n      } else {\n        this._x = mainReference.x();\n        this._y = mainReference.y() + mainReference.parent.height() + Config.DataUnitHeight;\n      }\n      this.centerX = this._x + Config.DataUnitWidth / 2;\n      this._x = this.centerX - this.radius * 2;\n    }\n    this._y += this.radius;\n  }\n\n  onMouseEnter = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    if (EnvVisualizer.getPrintableMode()) return;\n    this.labelRef.current.show();\n    setHoveredStyle(currentTarget);\n  };\n\n  onMouseLeave = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    if (EnvVisualizer.getPrintableMode()) return;\n    if (!this.selected) {\n      this.labelRef.current.hide();\n      setUnhoveredStyle(currentTarget);\n    } else {\n      const container = currentTarget.getStage()?.container();\n      container && (container.style.cursor = 'default');\n    }\n  };\n  onClick = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    if (EnvVisualizer.getPrintableMode()) return;\n    this.selected = !this.selected;\n    if (!this.selected) {\n      this.labelRef.current.hide();\n      setUnhoveredStyle(currentTarget);\n    } else {\n      this.labelRef.current.show();\n      setHoveredStyle(currentTarget);\n    }\n  };\n\n  draw(): React.ReactNode {\n    this._isDrawn = true;\n    this._arrow =\n      Layout.globalEnvNode.frame && new ArrowFromFn(this).to(Layout.globalEnvNode.frame);\n    return (\n      <React.Fragment key={Layout.key++}>\n        <Group\n          onMouseEnter={e => this.onMouseEnter(e)}\n          onMouseLeave={e => this.onMouseLeave(e)}\n          onClick={e => this.onClick(e)}\n          ref={this.ref}\n        >\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX - this.radius}\n            y={this.y()}\n            radius={this.radius}\n            stroke={\n              EnvVisualizer.getPrintableMode()\n                ? Config.SA_BLUE.toString()\n                : Config.SA_WHITE.toString()\n            }\n          />\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX - this.radius}\n            y={this.y()}\n            radius={this.innerRadius}\n            fill={\n              EnvVisualizer.getPrintableMode()\n                ? Config.SA_BLUE.toString()\n                : Config.SA_WHITE.toString()\n            }\n          />\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX + this.radius}\n            y={this.y()}\n            radius={this.radius}\n            stroke={\n              EnvVisualizer.getPrintableMode()\n                ? Config.SA_BLUE.toString()\n                : Config.SA_WHITE.toString()\n            }\n          />\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX + this.radius}\n            y={this.y()}\n            radius={this.innerRadius}\n            fill={\n              EnvVisualizer.getPrintableMode()\n                ? Config.SA_BLUE.toString()\n                : Config.SA_WHITE.toString()\n            }\n          />\n        </Group>\n        {EnvVisualizer.getPrintableMode() ? (\n          <KonvaLabel\n            x={this.x() + this.width() + Config.TextPaddingX * 2}\n            y={this.y() - Config.TextPaddingY}\n            visible={true}\n            ref={this.labelRef}\n          >\n            <KonvaTag stroke=\"black\" fill={'white'} opacity={Number(Config.FnTooltipOpacity)} />\n            <KonvaText\n              text={this.exportTooltip}\n              fontFamily={Config.FontFamily.toString()}\n              fontSize={Number(Config.FontSize)}\n              fontStyle={Config.FontStyle.toString()}\n              fill={Config.SA_BLUE.toString()}\n              padding={5}\n            />\n          </KonvaLabel>\n        ) : (\n          <KonvaLabel\n            x={this.x() + this.width() + Config.TextPaddingX * 2}\n            y={this.y() - Config.TextPaddingY}\n            visible={false}\n            ref={this.labelRef}\n          >\n            <KonvaTag stroke=\"black\" fill={'black'} opacity={Number(Config.FnTooltipOpacity)} />\n            <KonvaText\n              text={this.tooltip}\n              fontFamily={Config.FontFamily.toString()}\n              fontSize={Number(Config.FontSize)}\n              fontStyle={Config.FontStyle.toString()}\n              fill={Config.SA_WHITE.toString()}\n              padding={5}\n            />\n          </KonvaLabel>\n        )}\n        {this._arrow?.draw()}\n      </React.Fragment>\n    );\n  }\n}\n","import { Config } from '../../EnvVisualizerConfig';\nimport { IVisible, StepsArray } from '../../EnvVisualizerTypes';\nimport { ArrayUnit } from '../ArrayUnit';\nimport { ArrowLane } from '../ArrowLane';\nimport { ArrayValue } from '../values/ArrayValue';\nimport { FnValue } from '../values/FnValue';\nimport { GlobalFnValue } from '../values/GlobalFnValue';\nimport { Value } from '../values/Value';\nimport { GenericArrow } from './GenericArrow';\n\n/** this class encapsulates an GenericArrow to be drawn between 2 points */\nexport class ArrowFromArrayUnit extends GenericArrow<ArrayUnit, Value> {\n  private static emergeFromTopOrBottom(steps: StepsArray, from: ArrayUnit, to: IVisible) {\n    // Move up if target above source or to the right with same vertical position.\n    // Moves up slightly more if target is to the right.\n    steps.push((x, y) => [\n      x,\n      y +\n        (to.y() > from.y() || (to.y() === from.y() && to.x() <= from.x()) ? 0.9 : -0.9) *\n          Config.DataUnitHeight\n    ]);\n  }\n  protected calculateSteps() {\n    const source = this.source as ArrayUnit;\n    const target = this.target;\n    if (!target) return [];\n\n    const steps: StepsArray = [\n      (x, y) => [x + Config.DataUnitWidth / 2, y + Config.DataUnitHeight / 2]\n    ];\n    if (target instanceof FnValue || target instanceof GlobalFnValue) {\n      if (Math.abs(target.y() - source.y()) < Config.DataUnitHeight * 2) {\n        ArrowFromArrayUnit.emergeFromTopOrBottom(steps, source, target);\n\n        steps.push(() => [target.centerX + Config.FnRadius * 2 + Config.FnRadius, target.y()]);\n        steps.push((x, y) => [x - Config.FnRadius, y]);\n      } else {\n        steps.push(() => [target.centerX + Config.FnRadius * 2, target.y()]);\n      }\n    } else if (target instanceof ArrayValue) {\n      if (source.parent === target) {\n        steps.push((x, y) => [x, y - (Config.DataUnitHeight * 3) / 4]);\n        steps.push((x, y) => [x + Config.DataUnitHeight / 3, y]);\n        steps.push((x, y) => [x, y + Config.DataUnitHeight / 4]);\n      } else if (\n        source.isLastUnit &&\n        target.x() - source.x() <= Config.DataUnitWidth * 3 &&\n        target.x() > source.x() &&\n        target.level === source.parent.level\n      ) {\n        // pointing to next element in list.\n        steps.push(() => [target.x(), target.y() + Config.DataUnitHeight / 2]);\n      } else {\n        ArrowFromArrayUnit.emergeFromTopOrBottom(steps, source, target);\n\n        const potentialVerticalLaneX = ArrowLane.getVerticalLaneAfterSource(\n          target,\n          source.x()\n        ).getPosition(target);\n        // move to vertical lane only if lane exists between source and target\n        if ((potentialVerticalLaneX - source.x()) * (potentialVerticalLaneX - target.x()) < 0) {\n          steps.push((x, y) => [potentialVerticalLaneX, y]);\n        }\n        // move to horizontal lane only if lane exists between source and target\n        const potentialHorizontalLaneY = ArrowLane.getHorizontalLaneBeforeTarget(\n          target,\n          source.y()\n        ).getPosition(target);\n        if ((potentialHorizontalLaneY - source.y()) * (potentialHorizontalLaneY - target.y()) < 0) {\n          steps.push((x, y) => {\n            return (potentialHorizontalLaneY - y) * (potentialHorizontalLaneY - target.y()) > 0\n              ? [x, y]\n              : [x, ArrowLane.getHorizontalLaneBeforeTarget(target, y).getPosition(target)];\n          });\n        }\n\n        // Move to x position closer to array on horizontal lane\n        steps.push((x, y) => {\n          let newX: number;\n          let yDiff = target.y() + Config.DataUnitHeight / 2 - y;\n          const newY =\n            target.y() + Config.DataUnitHeight / 2 - (Math.sign(yDiff) * Config.DataUnitHeight) / 2;\n          yDiff = newY - y;\n          if (x < target.x() - Config.DataUnitWidth) {\n            // move right up to the point diagonally to the left of the start of the array.\n            newX = Math.max(x + Config.DataUnitWidth, target.x() - Math.abs(yDiff));\n          } else if (\n            x >=\n            target.x() + target.units.length * Config.DataUnitWidth + Config.DataUnitWidth\n          ) {\n            // move left up to the point diagonally to the right of the end of the array.\n            newX = target.x() + target.units.length * Config.DataUnitWidth;\n            newX = Math.min(x - Config.DataUnitWidth, newX + Math.abs(yDiff));\n          } else {\n            // if current point of arrow is somewhere above / below array, move halfway to corner of some arrayunit.\n            if (x < target.x()) {\n              newX = target.x();\n            } else if (\n              x >=\n              target.x() + target.units.length * Config.DataUnitWidth + Config.DataUnitWidth\n            ) {\n              newX = target.x() + target.units.length * Config.DataUnitWidth + Config.DataUnitWidth;\n            } else {\n              const index = Math.floor((x - target.x()) / Config.DataUnitWidth);\n              newX = target.x() + Config.DataUnitWidth * index;\n            }\n            return [(x + newX) / 2, (y + newY) / 2];\n          }\n          return [newX, y];\n        });\n        // Move to corner of some arrayunit.\n        steps.push((x, y) => {\n          const index = Math.floor((x - target.x()) / Config.DataUnitWidth);\n          const yDiff = target.y() + Config.DataUnitHeight / 2 - y;\n          const newY =\n            target.y() + Config.DataUnitHeight / 2 - (Math.sign(yDiff) * Config.DataUnitHeight) / 2;\n          if (x < target.x()) {\n            return [target.x(), newY];\n          } else if (x >= target.x() + target.units.length * Config.DataUnitWidth) {\n            return [target.x() + target.units.length * Config.DataUnitWidth, newY];\n          } else {\n            return [target.x() + Config.DataUnitWidth * index, newY];\n          }\n        });\n      }\n    } else {\n      // this shouldn't happen.\n      steps.push(() => [target.x(), target.y()]);\n    }\n    return steps;\n  }\n}\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport React, { RefObject } from 'react';\nimport { Shape } from 'react-konva';\n\nimport { ShapeDefaultProps } from '../../EnvVisualizerConfig';\n\ninterface Props {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  cornerRadius: { upperLeft: number; lowerLeft: number; upperRight: number; lowerRight: number };\n  stroke: string;\n  fillEnabled: boolean;\n  hitStrokeWidth: number;\n  forwardRef: RefObject<any>;\n  onMouseEnter?: ({ currentTarget }: KonvaEventObject<MouseEvent>) => void;\n  onMouseLeave?: ({ currentTarget }: KonvaEventObject<MouseEvent>) => void;\n  onClick?: ({ currentTarget }: KonvaEventObject<MouseEvent>) => void;\n}\n\n/**\n * Represents Rectangle with rounded corners, for boundary of arrays (compact and non-compact).\n */\nexport const RoundedRect: React.FC<Props> = ({\n  x,\n  y,\n  width,\n  height,\n  cornerRadius,\n  forwardRef,\n  ...props\n}) => {\n  return (\n    <Shape\n      sceneFunc={(context, shape) => {\n        const { upperLeft, lowerLeft, upperRight, lowerRight } = cornerRadius;\n        context.beginPath();\n        context.moveTo(x + upperLeft, y);\n        context.lineTo(x + width - upperRight, y);\n        context.quadraticCurveTo(x + width, y, x + width, y + upperRight);\n        context.lineTo(x + width, y + height - lowerRight);\n        context.quadraticCurveTo(x + width, y + height, x + width - lowerRight, y + height);\n        context.lineTo(x + lowerLeft, y + height);\n        context.quadraticCurveTo(x, y + height, x, y + height - lowerLeft);\n        context.lineTo(x, y + upperLeft);\n        context.quadraticCurveTo(x, y, x + upperLeft, y);\n        context.closePath();\n        // (!) Konva specific method, it is very important\n        context.fillStrokeShape(shape);\n      }}\n      {...ShapeDefaultProps}\n      ref={forwardRef}\n      {...props}\n    />\n  );\n};\n","import React from 'react';\nimport { Line as KonvaLine } from 'react-konva';\n\nimport EnvVisualizer from '../EnvVisualizer';\nimport { Config, ShapeDefaultProps } from '../EnvVisualizerConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { ReferenceType } from '../EnvVisualizerTypes';\nimport { Visible } from './Visible';\n\n/** this classes encapsulates a null value in Source pairs or arrays */\nexport class ArrayNullUnit extends Visible {\n  arrayUnit: ReferenceType;\n  referencedBy: ReferenceType[];\n\n  constructor(referencedBy: ReferenceType[]) {\n    super();\n    this.referencedBy = referencedBy;\n    this.arrayUnit = referencedBy[0];\n    this._x = this.arrayUnit.x();\n    this._y = this.arrayUnit.y();\n    this._height = this.arrayUnit.height();\n    this._width = this.arrayUnit.width();\n  }\n\n  updatePosition = () => {\n    this._x = this.arrayUnit.x();\n    this._y = this.arrayUnit.y();\n  };\n\n  draw(): React.ReactNode {\n    return (\n      <KonvaLine\n        {...ShapeDefaultProps}\n        key={Layout.key++}\n        points={[this.x(), this.y() + this.height(), this.x() + this.width(), this.y()]}\n        stroke={\n          EnvVisualizer.getPrintableMode() ? Config.SA_BLUE.toString() : Config.SA_WHITE.toString()\n        }\n        hitStrokeWidth={Number(Config.DataHitStrokeWidth)}\n        ref={this.ref}\n        listening={false}\n      />\n    );\n  }\n}\n","import React from 'react';\n\nimport { Config } from '../../EnvVisualizerConfig';\nimport { Layout } from '../../EnvVisualizerLayout';\nimport { PrimitiveTypes, ReferenceType } from '../../EnvVisualizerTypes';\nimport { getTextWidth, isNull } from '../../EnvVisualizerUtils';\nimport { ArrayNullUnit } from '../ArrayNullUnit';\nimport { Binding } from '../Binding';\nimport { Text } from '../Text';\nimport { Value } from './Value';\n\n/** this classes encapsulates a primitive value in Source: number, string or null */\nexport class PrimitiveValue extends Value {\n  /** the text to be rendered */\n  readonly text: Text | ArrayNullUnit;\n\n  constructor(\n    /** data */\n    readonly data: PrimitiveTypes,\n    /** what this value is being referenced by */\n    readonly referencedBy: ReferenceType[]\n  ) {\n    super();\n\n    // derive the coordinates from the main reference (binding / array unit)\n    const mainReference = this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x = mainReference.x() + getTextWidth(mainReference.keyString) + Config.TextPaddingX;\n      this._y = mainReference.y();\n      this.text = new Text(this.data, this._x, this._y, { isStringIdentifiable: true });\n    } else {\n      const maxWidth = mainReference.width();\n      const textWidth = Math.min(getTextWidth(String(this.data)), maxWidth);\n      this._x = mainReference.x() + (mainReference.width() - textWidth) / 2;\n      this._y = mainReference.y() + (mainReference.height() - Config.FontSize) / 2;\n      this.text = isNull(this.data)\n        ? new ArrayNullUnit([mainReference])\n        : new Text(this.data, this.x(), this.y(), {\n            maxWidth: maxWidth,\n            isStringIdentifiable: true\n          });\n    }\n\n    this._width = this.text.width();\n    this._height = this.text.height();\n  }\n\n  reset(): void {\n    super.reset();\n    this.referencedBy.length = 0;\n  }\n  updatePosition = () => {\n    const mainReference = this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x = mainReference.x() + getTextWidth(mainReference.keyString) + Config.TextPaddingX;\n      this._y = mainReference.y();\n    } else {\n      const maxWidth = mainReference.width();\n      const textWidth = Math.min(getTextWidth(String(this.data)), maxWidth);\n      this._x = mainReference.x() + (mainReference.width() - textWidth) / 2;\n      this._y = mainReference.y() + (mainReference.height() - Config.FontSize) / 2;\n    }\n    this.text instanceof Text\n      ? this.text.updatePosition(this.x(), this.y())\n      : this.text.updatePosition();\n  };\n  onMouseEnter(): void {}\n  onMouseLeave(): void {}\n\n  draw(): React.ReactNode {\n    this._isDrawn = true;\n    return <React.Fragment key={Layout.key++}>{this.text.draw()}</React.Fragment>;\n  }\n}\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport React from 'react';\n\nimport EnvVisualizer from '../EnvVisualizer';\nimport { Config } from '../EnvVisualizerConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { Data } from '../EnvVisualizerTypes';\nimport { setHoveredStyle, setUnhoveredStyle } from '../EnvVisualizerUtils';\nimport { ArrowFromArrayUnit } from './arrows/ArrowFromArrayUnit';\nimport { GenericArrow } from './arrows/GenericArrow';\nimport { RoundedRect } from './shapes/RoundedRect';\nimport { ArrayValue } from './values/ArrayValue';\nimport { FnValue } from './values/FnValue';\nimport { GlobalFnValue } from './values/GlobalFnValue';\nimport { PrimitiveValue } from './values/PrimitiveValue';\nimport { Value } from './values/Value';\nimport { Visible } from './Visible';\n\n/** this class encapsulates a single unit (box) of array to be rendered.\n *  this unit is part of an ArrayValue */\nexport class ArrayUnit extends Visible {\n  readonly value: Value;\n\n  /** check if this is the first unit in the array */\n  readonly isFirstUnit: boolean;\n  /** check if this is the last unit in the array */\n  readonly isLastUnit: boolean;\n  /** check if this unit is the main reference of the value */\n  readonly isMainReference: boolean;\n  /** check if the value is already drawn */\n\n  parent: ArrayValue;\n  arrow: GenericArrow<ArrayUnit, Value> | undefined = undefined;\n\n  constructor(\n    /** index of this unit in its parent */\n    readonly idx: number,\n    /** the value this unit contains*/\n    readonly data: Data,\n    /** parent of this unit */\n    parent: ArrayValue\n  ) {\n    super();\n    this.parent = parent;\n    this._x = this.parent.x() + this.idx * Config.DataUnitWidth;\n    this._y = this.parent.y();\n    this._height = Config.DataUnitHeight;\n    this._width = Config.DataUnitWidth;\n    this.isFirstUnit = this.idx === 0;\n    this.isLastUnit = this.idx === this.parent.data.length - 1;\n    this.value = Layout.createValue(this.data, this);\n    this.isMainReference = this.value.referencedBy.length > 1;\n  }\n\n  updatePosition = () => {\n    this._x = this.parent.x() + this.idx * Config.DataUnitWidth;\n    this._y = this.parent.y();\n    this.value instanceof PrimitiveValue && this.value.updatePosition();\n  };\n\n  onMouseEnter = () => {\n    this.parent.units.forEach(u => {\n      setHoveredStyle(u.ref.current);\n    });\n  };\n\n  onMouseLeave = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    if (!this.parent.isSelected()) {\n      this.parent.units.forEach(u => {\n        setUnhoveredStyle(u.ref.current);\n      });\n    } else {\n      const container = currentTarget.getStage()?.container();\n      container && (container.style.cursor = 'default');\n    }\n  };\n\n  onClick = () => {\n    this.parent.onClick();\n  };\n\n  draw(): React.ReactNode {\n    if (this._isDrawn) return null;\n    this._isDrawn = true;\n\n    const cornerRadius = {\n      upperLeft: 0,\n      lowerLeft: 0,\n      upperRight: 0,\n      lowerRight: 0\n    };\n\n    if (this.isFirstUnit)\n      cornerRadius.upperLeft = cornerRadius.lowerLeft = Number(Config.DataCornerRadius);\n    if (this.isLastUnit)\n      cornerRadius.upperRight = cornerRadius.lowerRight = Number(Config.DataCornerRadius);\n    if (!(this.value instanceof PrimitiveValue)) {\n      this.arrow = new ArrowFromArrayUnit(this).to(this.value);\n      this.parent.addArrow(this.arrow);\n      if (this.value instanceof ArrayValue) {\n        this.value.addArrow(this.arrow);\n      }\n    }\n\n    return (\n      <React.Fragment key={Layout.key++}>\n        <RoundedRect\n          key={Layout.key++}\n          x={this.x()}\n          y={this.y()}\n          width={this.width()}\n          height={this.height()}\n          stroke={\n            EnvVisualizer.getPrintableMode()\n              ? Config.SA_BLUE.toString()\n              : Config.SA_WHITE.toString()\n          }\n          hitStrokeWidth={Number(Config.DataHitStrokeWidth)}\n          fillEnabled={false}\n          forwardRef={this.ref}\n          cornerRadius={cornerRadius}\n          onClick={this.onClick}\n          onMouseEnter={this.onMouseEnter}\n          onMouseLeave={this.onMouseLeave}\n        />\n        {!(this.value instanceof FnValue || this.value instanceof GlobalFnValue) &&\n          this.value.draw()}\n        {this.arrow && this.arrow.draw()}\n      </React.Fragment>\n    );\n  }\n}\n","import React, { RefObject } from 'react';\nimport { Group, Rect } from 'react-konva';\n\nimport { Config } from '../../EnvVisualizerConfig';\nimport { Layout } from '../../EnvVisualizerLayout';\nimport { Data, ReferenceType } from '../../EnvVisualizerTypes';\nimport { setUnhoveredStyle } from '../../EnvVisualizerUtils';\nimport { ArrayEmptyUnit } from '../ArrayEmptyUnit';\nimport { ArrayLevel } from '../ArrayLevel';\nimport { ArrayUnit } from '../ArrayUnit';\nimport { ArrowFromText } from '../arrows/ArrowFromText';\nimport { GenericArrow } from '../arrows/GenericArrow';\nimport { Binding } from '../Binding';\nimport { Text } from '../Text';\nimport { Value } from './Value';\n\n/** this class encapsulates an array value in source,\n *  defined as a JS array with not 2 elements */\nexport class ArrayValue extends Value {\n  /** array of units this array is made of */\n  units: ArrayUnit[] = [];\n  private emptyUnit: ArrayEmptyUnit | undefined = undefined;\n  level: ArrayLevel | undefined;\n  private _arrows: (GenericArrow<Text, ArrayValue> | GenericArrow<ArrayUnit, Value>)[] = [];\n  private selected: boolean = false;\n  ref: RefObject<any> = React.createRef();\n  parentArray: ArrayValue | undefined = undefined;\n  arrayLevelY: number = -1;\n\n  constructor(\n    /** underlying values this array contains */\n    readonly data: Data[],\n    /** what this value is being referenced by */\n    readonly referencedBy: ReferenceType[]\n  ) {\n    super();\n    Layout.memoizeValue(this);\n\n    // derive the coordinates from the main reference (binding / array unit)\n    const mainReference = this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x = mainReference.frame.x() + mainReference.frame.width() + Config.FrameMarginX;\n      this._y = mainReference.y();\n    } else {\n      this.parentArray = mainReference.parent;\n      if (mainReference.isLastUnit) {\n        this._x = mainReference.x() + Config.DataUnitWidth * 2;\n        this._y = mainReference.y();\n      } else {\n        this._x = mainReference.x();\n        this._y = mainReference.y() + mainReference.parent.height() + Config.DataUnitHeight;\n      }\n    }\n\n    this._width = this.data.length * Config.DataUnitWidth + Config.DataMinWidth;\n    this._height = Config.DataUnitHeight;\n\n    // initialize array units from the last index\n    for (let i = this.data.length - 1; i >= 0; i--) {\n      const unit = new ArrayUnit(i, this.data[i], this);\n      this.units = [unit, ...this.units];\n    }\n  }\n  onMouseEnter(): void {}\n  onMouseLeave(): void {}\n  isSelected(): boolean {\n    return this.selected;\n  }\n  arrows(): (GenericArrow<Text, ArrayValue> | GenericArrow<ArrayUnit, Value>)[] {\n    return this._arrows;\n  }\n  reset(): void {\n    super.reset();\n    this.units.map(x => x.reset());\n    this.referencedBy.length = 0;\n    this._arrows = [];\n  }\n\n  onClick = () => {\n    this.selected = !this.selected;\n    if (!this.selected) {\n      this.units.forEach(u => {\n        setUnhoveredStyle(u.ref.current);\n      });\n      this.emptyUnit && setUnhoveredStyle(this.emptyUnit.ref.current);\n    }\n  };\n\n  setLevel(arrLevel: ArrayLevel, level: number): void {\n    this.level = arrLevel;\n    this.arrayLevelY = level;\n  }\n\n  updatePosition(pos: { x: number; y: number } = { x: -1, y: -1 }): void {\n    this._x = pos.x > 0 ? pos.x : this._x;\n    this._y = pos.y > 0 ? pos.y : this._y;\n    this.units.forEach(unit => {\n      unit.updatePosition();\n    });\n  }\n\n  addArrow = (arrow: GenericArrow<Text, ArrayValue> | GenericArrow<ArrayUnit, Value>) => {\n    this._arrows.push(arrow);\n  };\n\n  draw(): React.ReactNode {\n    if (this.isDrawn()) {\n      return null;\n    }\n    this._isDrawn = true;\n    this._arrows = (this.referencedBy.filter(x => x instanceof Binding) as Binding[]).map(x => {\n      const arrow: GenericArrow<Text, ArrayValue> = new ArrowFromText<ArrayValue>(x.key).to(this);\n      x.frame.trackObjects(this);\n      x.frame.trackObjects(arrow);\n      return arrow;\n    }) as GenericArrow<Text, ArrayValue>[];\n    if (this.units.length === 0) {\n      this.emptyUnit = new ArrayEmptyUnit(this);\n    }\n    return (\n      <Group key={Layout.key++} ref={this.ref}>\n        {this._arrows.map(arrow => arrow.draw())}\n        {this.units.length > 0 && this.units.map(unit => unit.draw())}\n        {this.emptyUnit && this.emptyUnit.draw()}\n        <Rect width={this.width()} height={this.height()} />\n      </Group>\n    );\n  }\n}\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport React from 'react';\nimport { Group, Rect } from 'react-konva';\n\nimport EnvVisualizer from '../EnvVisualizer';\nimport { Config, ShapeDefaultProps } from '../EnvVisualizerConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { Env, EnvTreeNode, IHoverable } from '../EnvVisualizerTypes';\nimport {\n  getNonEmptyEnv,\n  getTextWidth,\n  isDummyKey,\n  isPrimitiveData,\n  isUnassigned,\n  setHoveredCursor,\n  setHoveredStyle,\n  setUnhoveredCursor,\n  setUnhoveredStyle\n} from '../EnvVisualizerUtils';\nimport { ArrowFromFrame } from './arrows/ArrowFromFrame';\nimport { GenericArrow } from './arrows/GenericArrow';\nimport { Binding } from './Binding';\nimport { Level } from './Level';\nimport { Text } from './Text';\nimport { ArrayValue } from './values/ArrayValue';\nimport { Visible } from './Visible';\n\nconst frameNames = new Map([\n  ['global', 'Global'],\n  ['programEnvironment', 'Program'],\n  ['forLoopEnvironment', 'Body of for-loop'],\n  ['forBlockEnvironment', 'Control variable of for-loop'],\n  ['blockEnvironment', 'Block'],\n  ['functionBodyEnvironment', 'Function Body']\n]);\n\n/** this class encapsulates a frame of key-value bindings to be drawn on canvas */\nexport class Frame extends Visible implements IHoverable {\n  /** total height = frame height + frame title height */\n  totalHeight: number;\n  /** width of this frame + max width of the bound values */\n  totalWidth: number;\n  totalHoveredWidth: number;\n\n  /** the bindings this frame contains */\n  readonly bindings: Binding[] = [];\n  /** name of this frame to display */\n  readonly name: Text;\n  /** the level in which this frame resides */\n  level: Level | undefined;\n  /** environment associated with this frame */\n  environment: Env;\n  /** the parent/enclosing frame of this frame (the frame above it) */\n  readonly parentFrame: Frame | undefined;\n  static maxXCoord: number = -1;\n  static maxX: number = Config.CanvasPaddingX.valueOf();\n  static cumWidths: number[] = [Config.CanvasPaddingX.valueOf()];\n  static heights: number[] = [Config.CanvasPaddingY.valueOf()];\n  offsetY: number;\n  /** set of values to highlight when frame is over. */\n  private values: Visible[] = [];\n  private selected: boolean = false;\n\n  constructor(\n    /** environment tree node that contains this frame */\n    readonly envTreeNode: EnvTreeNode,\n    /** the frame to the left of this frame, on the same level. used for calculating this frame's position */\n    readonly xCoord: number,\n    readonly yCoord: number\n  ) {\n    super();\n    this._width = Config.FrameMinWidth;\n    this.level = envTreeNode.level as Level;\n    this.environment = envTreeNode.environment;\n    this.parentFrame = envTreeNode.parent?.frame;\n    this.xCoord = xCoord;\n    this.yCoord = yCoord;\n    Frame.maxXCoord = Math.max(xCoord, Frame.maxXCoord);\n    this._x = xCoord === 0 ? Config.CanvasPaddingX : Frame.cumWidths[xCoord];\n\n    this.name = new Text(\n      frameNames.get(this.environment.name) || this.environment.name,\n      this.x(),\n      this.level.y(),\n      { maxWidth: this.width() }\n    );\n    this.offsetY = this.name.height() + Config.TextPaddingY / 3;\n    this._y = this.level.y() + this.offsetY;\n    this._width = Config.FramePaddingX * 2;\n    this.totalWidth = this.width();\n    this.totalHoveredWidth = this.totalWidth;\n    this._height = Config.FramePaddingY * 2;\n    this.totalHeight = this.height() + this.name.height() + Config.TextPaddingY / 2;\n    this.update(envTreeNode);\n  }\n\n  /**\n   * Find the frame x-coordinate given a x-position.\n   * @param x absolute position\n   * @returns Largest x-coordinate smaller than or equal to a given x position.\n   */\n  static lastXCoordBelow(x: number) {\n    let l = Frame.cumWidths.length;\n    while (l--) {\n      if (Frame.cumWidths[l] <= x) {\n        return l;\n      }\n    }\n    return 0;\n  }\n\n  trackObjects(value: Visible): boolean {\n    const exists: boolean = this.values.includes(value);\n    !exists && this.values.push(value);\n    return !exists;\n  }\n\n  /**\n   * update absolute position of frame and its bindings.\n   * @param x Target x-position\n   * @param y Target y-position\n   */\n  updatePosition = (x: number, y: number) => {\n    this._x = x;\n    this._y = y + this.offsetY;\n    this.name.updatePosition(this.x(), y);\n    this.bindings.forEach(binding => {\n      binding.updatePosition(this.x(), y);\n    });\n  };\n\n  update = (envTreeNode: EnvTreeNode) => {\n    this.level = envTreeNode.level as Level;\n    this.environment = envTreeNode.environment;\n    this.offsetY = this.name.height() + Config.TextPaddingY / 3;\n    this._y = this.level.y() + this.offsetY;\n    // width of the frame = max width of the bindings in the frame + frame padding * 2\n    let maxBindingWidth = 0;\n    for (const [key, data] of Object.entries(this.environment.head)) {\n      const bindingWidth =\n        Math.max(Config.TextMinWidth, getTextWidth(key + Config.ConstantColon)) +\n        Config.TextPaddingX +\n        (isUnassigned(data)\n          ? Math.max(Config.TextMinWidth, getTextWidth(Config.UnassignedData.toString()))\n          : isPrimitiveData(data)\n          ? Math.max(Config.TextMinWidth, getTextWidth(String(data)))\n          : 0);\n      maxBindingWidth = Math.max(maxBindingWidth, bindingWidth);\n    }\n    this._width = maxBindingWidth + Config.FramePaddingX * 2;\n    this.values = [];\n\n    // initializes bindings (keys + values)\n    let prevBinding: Binding | null = null;\n    let totalWidth = this._width;\n    let exportWidth = this._width;\n    this.totalHoveredWidth = Math.max(totalWidth, this.name.hoveredWidth());\n\n    const descriptors = Object.getOwnPropertyDescriptors(this.environment.head);\n    const entries = [];\n    const dummyEntries = [];\n    for (const entry of Object.entries(descriptors)) {\n      if (isDummyKey(entry[0])) {\n        const actualEnv = getNonEmptyEnv(entry[1].value.environment);\n        if (\n          this.environment.id === Config.GlobalEnvId ||\n          (actualEnv && actualEnv.id === this.environment.id)\n        ) {\n          dummyEntries.push(entry);\n        }\n      } else {\n        entries.push(entry);\n      }\n    }\n    entries.push(...dummyEntries);\n\n    for (const [key, data] of entries) {\n      const currBinding: Binding = new Binding(key, data.value, this, prevBinding, !data.writable);\n      if (\n        this.bindings.findIndex(\n          v =>\n            v.value === currBinding.value &&\n            (currBinding.isDummyBinding || v.keyString === currBinding.keyString)\n        ) === -1\n      ) {\n        this.bindings.push(currBinding);\n        prevBinding = currBinding;\n        totalWidth = Math.max(totalWidth, currBinding.width() + Config.FramePaddingX);\n        exportWidth = Math.max(exportWidth, currBinding.exportWidth() + Config.FramePaddingX);\n        this.totalHoveredWidth = Math.max(\n          this.totalHoveredWidth,\n          currBinding.hoveredWidth() + Config.FramePaddingX\n        );\n      }\n    }\n\n    if (EnvVisualizer.getPrintableMode()) {\n      this.totalWidth = exportWidth;\n    } else {\n      this.totalWidth = totalWidth;\n    }\n\n    // derive the height of the frame from the the position of the last binding\n    this._height = prevBinding\n      ? prevBinding.y() + prevBinding.height() + Config.FramePaddingY - this.y()\n      : Config.FramePaddingY * 2;\n    this.totalHeight = this.height() + this.name.height() + Config.TextPaddingY / 2;\n    const nextX =\n      Frame.cumWidths[this.xCoord] + this.totalWidth + Config.FrameMarginX + Config.FnRadius;\n    Frame.cumWidths[this.xCoord + 1] =\n      Frame.cumWidths[this.xCoord + 1] === undefined\n        ? nextX\n        : Math.max(Frame.cumWidths[this.xCoord + 1], nextX);\n    Frame.maxX = Math.max(\n      Frame.maxX,\n      Frame.cumWidths[this.xCoord] +\n        (EnvVisualizer.getPrintableMode() ? this.totalWidth : this.totalHoveredWidth),\n      Frame.cumWidths[Frame.cumWidths.length - 1]\n    );\n    Frame.heights[this.yCoord] = Math.max(Frame.heights[this.yCoord] || 0, this.totalHeight);\n  };\n\n  static reset = () => {\n    Frame.maxX = Config.CanvasPaddingX.valueOf();\n    Frame.maxXCoord = -1;\n    Frame.cumWidths = [Config.CanvasPaddingX.valueOf()];\n    Frame.heights = [Config.CanvasPaddingY.valueOf()];\n  };\n\n  isSelected = () => {\n    return this.selected;\n  };\n\n  onMouseEnter = () => {\n    setHoveredCursor(this.ref.current);\n    setHoveredStyle(this.ref.current);\n    this.bindings.forEach(x => {\n      const arrow = x.getArrow();\n      arrow && setHoveredStyle(arrow.ref.current);\n    });\n    this.values.forEach(x => {\n      x && setHoveredStyle(x.ref.current);\n    });\n  };\n\n  onMouseLeave = () => {\n    setUnhoveredCursor(this.ref.current);\n    if (!this.selected) {\n      setUnhoveredStyle(this.ref.current);\n      this.bindings.forEach(x => {\n        const arrow = x.getArrow();\n        arrow && !arrow.isSelected() && setUnhoveredStyle(arrow.ref.current);\n      });\n      this.values.forEach(x => {\n        if (!(x instanceof ArrayValue) || !x.isSelected()) {\n          x && setUnhoveredStyle(x.ref.current);\n        }\n      });\n    }\n  };\n\n  /**\n   * Highlights frame and\n   */\n  onClick = (e: KonvaEventObject<MouseEvent>) => {\n    this.selected = !this.selected;\n    if (!this.selected) {\n      setUnhoveredStyle(this.ref.current);\n      this.bindings.forEach(x => {\n        const arrow = x.getArrow();\n        arrow && !arrow.isSelected() && setUnhoveredStyle(arrow.ref.current);\n      });\n      this.values.forEach(x => {\n        if (!(x instanceof ArrayValue) || !x.isSelected()) {\n          x && setUnhoveredStyle(x.ref.current);\n        }\n      });\n    } else {\n      setHoveredStyle(this.ref.current);\n      this.bindings.forEach(x => {\n        const arrow = x.getArrow();\n        arrow && setHoveredStyle(arrow.ref.current);\n      });\n      this.values.forEach(x => {\n        x && setHoveredStyle(x.ref.current);\n      });\n    }\n  };\n\n  draw(): React.ReactNode {\n    let arrowToParentFrame: GenericArrow<Frame, Frame> | undefined = undefined;\n    if (this.parentFrame !== undefined) {\n      arrowToParentFrame = new ArrowFromFrame(this).to(this.parentFrame);\n      this.trackObjects(arrowToParentFrame);\n    }\n    return (\n      <Group key={Layout.key++} ref={this.ref}>\n        {arrowToParentFrame && arrowToParentFrame.draw()}\n        {this.bindings.map(binding => !(binding.data instanceof ArrayValue) && binding.draw())}\n        {this.name.draw()}\n        <Rect\n          {...ShapeDefaultProps}\n          x={this.x()}\n          y={this.y()}\n          width={this.width()}\n          height={this.height()}\n          stroke={\n            EnvVisualizer.getPrintableMode()\n              ? Config.SA_BLUE.toString()\n              : Config.SA_WHITE.toString()\n          }\n          cornerRadius={Number(Config.FrameCornerRadius)}\n          key={Layout.key++}\n          onClick={e => this.onClick(e)}\n          onMouseEnter={() => this.onMouseEnter()}\n          onMouseLeave={() => this.onMouseLeave()}\n        />\n      </Group>\n    );\n  }\n}\n","import React from 'react';\n\nimport { Visible } from './Visible';\n\n/** this class encapsulates a level of frames to be drawn with the same y values */\nexport abstract class Level extends Visible {\n  protected constructor(\n    /** the level of this */\n    readonly parentLevel: Level | null\n  ) {\n    super();\n  }\n\n  abstract setY(y: number): any;\n\n  abstract draw(): React.ReactNode;\n}\n","import React from 'react';\nimport { Group, Rect } from 'react-konva';\n\nimport { Config, ShapeDefaultProps } from '../EnvVisualizerConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { FrameLevel } from './FrameLevel';\nimport { Level } from './Level';\nimport { ArrayValue } from './values/ArrayValue';\nimport { Value } from './values/Value';\n\n/** this class encapsulates a level of arrays to be drawn between two frame levels */\nexport class ArrayLevel extends Level {\n  private _minX: number = Infinity;\n  private _count: number = 0;\n  position: [x: number, y: number][][] = [[]];\n\n  // Prevent new arrays from being placed above existing arrays in the array level\n  private _rowCount: number = 0;\n\n  /** all the frames in this level */\n  readonly arrays: ArrayValue[] = [];\n\n  constructor(\n    /** the level of this */\n    readonly parentLevel: FrameLevel\n  ) {\n    super(parentLevel);\n    this._x = Config.CanvasPaddingX;\n    this._y = 0;\n    this._width = 0;\n    this._rowCount = 0;\n  }\n\n  minX(): number {\n    return this._minX;\n  }\n  count(): number {\n    return this._count;\n  }\n  getNumLanes = (): number => {\n    return this._rowCount;\n  };\n\n  /**\n   * Inserts array into ArrayLevel. Handles overlaps\n   * @param array\n   * @param x desired x-position of array\n   */\n  addArray = (array: ArrayValue, x: number) => {\n    x = x || 0;\n    // set highest allowed y-position to highest existing y-position in group of arrays connected to array.\n\n    let level = array.parentArray?.arrayLevelY ?? 0;\n    let width = 0;\n    let tail: Value = array;\n    const visitedTail: Value[] = [];\n    while (tail instanceof ArrayValue) {\n      if (visitedTail.includes(tail)) {\n        break;\n      }\n      visitedTail.push(tail);\n      width += Config.DataUnitPaddingX + tail.units.length * Config.DataUnitWidth;\n      if (tail.units.length > 0 && tail.units[tail.units.length - 1].value instanceof ArrayValue) {\n        tail = tail.units[tail.units.length - 1].value;\n      }\n    }\n    // Determine the highest allowed y-position for new array\n    positions: for (const positions of this.position.slice(level)) {\n      for (const position of positions) {\n        // Prevent new arrays from being created above existing arrays in level\n        if (position[0] < x + width + Config.DataMinWidth && position[1] > x) {\n          level++;\n          continue positions;\n        }\n      }\n      break;\n    }\n    this._minX = Math.min(x, this._minX);\n    this._count++;\n    this._rowCount = Math.max(this._rowCount, level);\n    this.position[level] = this.position[level] || [];\n    this.position[level].push([x, x + array.width() + Config.DataUnitWidth / 2]);\n    this.position[level].sort((a, b) => a[0] - b[0]);\n    const arrayMargin = Config.DataUnitPaddingY;\n    const curY = this._y + level * Config.DataUnitHeight + (level + 1) * arrayMargin;\n    array.updatePosition({ x, y: curY });\n    array.setLevel(this, level);\n    this._height = Math.max(this._height, curY + arrayMargin);\n    this.arrays.push(array);\n    this._width = Math.max(this._width, x + array.width());\n  };\n\n  setY = (y: number) => {\n    this.arrays.forEach(array => {\n      return array.updatePosition({ x: array.x(), y: array.y() - this.y() + y });\n    });\n    this._y = y;\n  };\n\n  reset = () => {\n    this._minX = Infinity;\n    this._count = 0;\n  };\n\n  draw(): React.ReactNode {\n    return (\n      <Group key={Layout.key++} ref={this.ref}>\n        <Rect\n          {...ShapeDefaultProps}\n          x={this.x()}\n          y={this.y()}\n          width={this.width()}\n          height={this.height()}\n          key={Layout.key++}\n          listening={false}\n        />\n        {this.arrays.map(array => array.draw())}\n      </Group>\n    );\n  }\n}\n","import React from 'react';\nimport { Group, Rect } from 'react-konva';\n\nimport { Config, ShapeDefaultProps } from '../EnvVisualizerConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { EnvTreeNode } from '../EnvVisualizerTypes';\nimport { ArrayLevel } from './ArrayLevel';\nimport { Frame } from './Frame';\nimport { Level } from './Level';\n\n/** this class encapsulates a level of frames to be drawn with the same y values */\nexport class FrameLevel extends Level {\n  static maxXcoord: number = 0;\n  static maxYcoord: number = 0;\n  lastXcoord: number;\n  readonly yCoord: number;\n\n  /** all the frames in this level */\n  readonly frames: Frame[] = [];\n\n  constructor(\n    /** the level of this */\n    readonly parentLevel: ArrayLevel | null\n  ) {\n    super(parentLevel);\n    this._x = Config.CanvasPaddingX;\n    this._y = 0;\n    this._width = 0;\n    this.lastXcoord = -1;\n    this.yCoord = FrameLevel.maxYcoord++;\n  }\n\n  height(): number {\n    return Frame.heights[this.yCoord] + Config.FrameMarginY;\n  }\n\n  /**\n   * Insert the next frame into this FrameLevel.\n   * If node.xCoord is specified and is valid (right of existing frames on level), uses it.\n   * else, places the frame to the right of the last frame on level.\n   * (calculate xCoord of frames, and addFrames in order from left to right and top to bottom.)\n   * @param node\n   */\n  addFrame = (node: EnvTreeNode) => {\n    // use the node's xCoord if its set and to right of last frame in level, else use put at right of last frame in level.\n    const coordinate = Math.max(node.xCoord ?? 0, FrameLevel.maxXcoord, this.lastXcoord + 1);\n    this.lastXcoord = coordinate;\n    FrameLevel.maxXcoord = Math.max(FrameLevel.maxXcoord, coordinate);\n    node.level = this;\n    if (this.frames[coordinate] !== undefined) {\n      this.frames[coordinate].update(node);\n    } else {\n      this.frames[coordinate] = new Frame(node, coordinate, this.yCoord);\n      node.frame = this.frames[coordinate];\n    }\n    this._width = Frame.maxX;\n  };\n\n  /**\n   * set y-position of frame level, and updates y-position of all frames in level\n   * @param y target y-coordinate\n   */\n  setY = (y: number) => {\n    this._y = y;\n    this.frames.forEach(frame => {\n      frame.updatePosition(frame.x(), y);\n    });\n  };\n\n  static reset = () => {\n    FrameLevel.maxXcoord = 0;\n    FrameLevel.maxYcoord = 0;\n  };\n\n  draw(): React.ReactNode {\n    return (\n      <Group key={Layout.key++} ref={this.ref}>\n        <Rect\n          {...ShapeDefaultProps}\n          x={this.x()}\n          y={this.y()}\n          width={this.width()}\n          height={this.height()}\n          key={Layout.key++}\n          listening={false}\n        />\n        {this.frames.reverse().map(frame => frame.draw())}\n      </Group>\n    );\n  }\n}\n","import React from 'react';\nimport { Group, Rect } from 'react-konva';\n\nimport { Config, ShapeDefaultProps } from '../EnvVisualizerConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { EnvTreeNode } from '../EnvVisualizerTypes';\nimport { getNextChildren } from '../EnvVisualizerUtils';\nimport { ArrayLevel } from './ArrayLevel';\nimport { ArrayUnit } from './ArrayUnit';\nimport { ArrowLane } from './ArrowLane';\nimport { Binding } from './Binding';\nimport { Frame } from './Frame';\nimport { FrameLevel } from './FrameLevel';\nimport { Level } from './Level';\nimport { ArrayValue } from './values/ArrayValue';\nimport { Visible } from './Visible';\n\n/**\n * Grid class encapsulates a grid of frames to be drawn.\n * Grid contains alternating layers of ArrayLevel and FrameLevel.\n */\nexport class Grid extends Visible {\n  /** list of all levels */\n  frameLevels: FrameLevel[];\n  arrayLevels: ArrayLevel[];\n  levels: Level[];\n  widths: number[];\n  static cumHeights: number[];\n\n  constructor(\n    /** the environment tree nodes */\n    readonly envTreeNodes: EnvTreeNode[][]\n  ) {\n    super();\n    this._x = 0;\n    this._y = 0;\n    this.frameLevels = [];\n    this.arrayLevels = [];\n    this.levels = [];\n    this.widths = [];\n    Grid.cumHeights = [];\n    this._height = 0;\n    this._width = 0;\n    this.update(envTreeNodes);\n  }\n\n  destroy = () => {\n    this.frameLevels.forEach(l => l.ref.current.destroyChildren());\n  };\n\n  /**\n   * Processes updates to Layout.environmentTree.\n   * @param envTreeNodes an array of different arrays of EnvTreeNodes corresponding to a single level.\n   */\n  update(envTreeNodes: EnvTreeNode[][]) {\n    Frame.reset();\n    FrameLevel.reset();\n    ArrowLane.reset();\n    this.arrayLevels.forEach(x => x.reset());\n    this.frameLevels = [];\n    this.arrayLevels = [];\n    this.levels = [];\n    const nodes: Array<[number, EnvTreeNode]> = envTreeNodes.reduce((result, nodes, i) => {\n      if (i === 0) {\n        this.frameLevels[i] = new FrameLevel(null);\n        this.arrayLevels[i] = new ArrayLevel(this.frameLevels[i]);\n      } else {\n        this.frameLevels[i] = new FrameLevel(this.arrayLevels[i - 1]);\n        this.arrayLevels[i] = new ArrayLevel(this.frameLevels[i]);\n      }\n      this.levels.push(this.frameLevels[i]);\n      this.levels.push(this.arrayLevels[i]);\n      return [...result, ...nodes.map<[number, EnvTreeNode]>(node => [i, node])];\n    }, new Array<[number, EnvTreeNode]>());\n\n    nodes.sort((a, b) => parseInt(a[1].environment.id) - parseInt(b[1].environment.id));\n    this.widths = [];\n    Grid.cumHeights = [];\n    // Compute the x coordinate of each frame by the max of 1 + the last xcoord of all frames before that frame on the same level\n    // and the xcoord of its immediate parent\n    const grid: (EnvTreeNode | undefined)[][] = [];\n    nodes.forEach(node => {\n      // children frame not to left of parent.\n      grid[node[0]] = grid[node[0]] ?? [];\n      node[1].xCoord = Math.max(\n        grid[node[0]].length - 1 + 1,\n        (node[1] as EnvTreeNode).parent?.xCoord ?? 0\n      );\n      grid[node[0]][node[1].xCoord] = node[1];\n      if (node[1].parent) {\n        let currentNode = node[1];\n        let level = node[0];\n        let updatedParent = true;\n        // if current frame is the first child of its parent frame and none of the frames to the left of the current frame\n        // is pointing to any frame to the right of the parent frame, shift the parent frame above the current frame\n        // (and move all frames to its right.) This will not violate the rule that all frames mustn't be at the left of its parent frame\n        // since the parent frame will not be at the right of the current frame, and any children frame of frames to the right of the parent frame\n        // will be created to right of those frames.\n        while (updatedParent) {\n          const parentNode = currentNode.parent;\n          if (\n            parentNode.xCoord &&\n            parentNode.children.flatMap(x => getNextChildren(x as EnvTreeNode))[0] === currentNode\n          ) {\n            if (currentNode.xCoord === undefined || parentNode.xCoord === undefined) {\n              updatedParent = false;\n            } else {\n              const diff: number = currentNode.xCoord - parentNode.xCoord;\n              const oldParentCoord = parentNode.xCoord;\n              if (\n                diff > 0 &&\n                grid[level]\n                  .slice(oldParentCoord, currentNode.xCoord)\n                  .every(\n                    x =>\n                      x === undefined ||\n                      parseInt(x.parent.environment.id ?? 0) < parseInt(parentNode.environment.id)\n                  )\n              ) {\n                grid[level - 1].slice(oldParentCoord).forEach(x => {\n                  if (x !== undefined) {\n                    x.xCoord = x.xCoord ? x.xCoord + diff : x.xCoord;\n                  }\n                });\n                grid[level - 1] = [\n                  ...grid[level - 1].slice(0, oldParentCoord),\n                  ...Array(diff).fill(undefined),\n                  ...grid[level - 1].slice(oldParentCoord)\n                ];\n                level = level - 1;\n                currentNode = parentNode;\n              } else {\n                updatedParent = false;\n              }\n            }\n          } else {\n            updatedParent = false;\n          }\n        }\n      }\n    });\n    // ordered by increasing y coord (since frame guaranteed to be to the right of its parent, and all frames are sorted by frame id)\n    // followed by increasing xCoord\n    nodes.sort((a, b) => (a[1].xCoord ?? 0) - (b[1].xCoord ?? 0));\n    nodes.forEach(node => this.frameLevels[node[0]].addFrame(node[1]));\n\n    Layout.values.forEach((v, d, m) => {\n      if (v instanceof ArrayValue) {\n        let bindings = v.referencedBy.filter(r => r instanceof Binding) as Binding[];\n        let p: ArrayUnit = v.referencedBy.find(x => x instanceof ArrayUnit) as ArrayUnit;\n        const belongsToFrame = v.referencedBy[0] instanceof Binding;\n        while (bindings.length === 0) {\n          bindings = p.parent.referencedBy.filter(r => r instanceof Binding) as Binding[];\n          p = p.parent.referencedBy.find(x => x instanceof ArrayUnit) as ArrayUnit;\n        }\n\n        if (belongsToFrame) {\n          const y = (v.referencedBy[0] as Binding).frame.yCoord;\n          // array close to first declaration, aligned to the frame to its right for clarity.\n          const x =\n            Frame.cumWidths[(v.referencedBy[0] as Binding).frame.xCoord + 1] +\n            0.8 * Config.FrameMarginX;\n          // Alternative approach to move array closer to horizontal mean of bindings\n          // https://github.com/source-academy/frontend/blob/dcd34c1cb792b96123d9163d2e31c960bedf123d/src/features/envVisualizer/components/Grid.tsx#L109\n          this.arrayLevels[Math.floor(y)].addArray(v, x);\n        } else if (v.referencedBy[0] instanceof ArrayUnit) {\n          const y = v.referencedBy[0].parent.level?.parentLevel?.yCoord ?? 0;\n          const x =\n            v.referencedBy[0].x() +\n            (v.referencedBy[0] instanceof ArrayUnit && v.referencedBy[0].isLastUnit\n              ? Config.DataUnitWidth + Config.DataUnitPaddingX\n              : 0);\n          this.arrayLevels[Math.floor(y)].addArray(v, x);\n        }\n      }\n    });\n    // Put the array levels and frame levels at same vertical position.\n    // Requires all array's x-position to be at the right of all frames and its fn values.\n    Grid.cumHeights = this.levels.reduce(\n      (res, b, i) => {\n        let height;\n        if (i % 2 === 0) {\n          const arrayLevel = this.arrayLevels[Math.floor(i / 2)] as ArrayLevel;\n          height =\n            Frame.cumWidths[(b as FrameLevel).lastXcoord + 1] <= arrayLevel.minX()\n              ? 0\n              : Frame.heights[Math.floor(i / 2)] +\n                (Frame.heights[Math.floor(i / 2)] > 0\n                  ? Config.FrameMarginY / 2\n                  : Config.FrameMarginY / 2);\n        } else {\n          const frameLevel = this.frameLevels[Math.floor(i / 2)] as FrameLevel;\n          height =\n            Frame.heights[Math.floor(i / 2)] +\n            (Frame.heights[Math.floor(i / 2)] > 0 ? Config.FrameMarginY : 0);\n          if ((b as ArrayLevel).count() > 0) {\n            if (Frame.cumWidths[frameLevel.lastXcoord + 1] <= (b as ArrayLevel).minX()) {\n              height = Math.max(\n                height,\n                this.arrayLevels[Math.floor((i - 1) / 2)].height() +\n                  (this.arrayLevels[Math.floor((i - 1) / 2)].height() > 0\n                    ? Config.FrameMarginY\n                    : Config.FrameMarginY / 2)\n              );\n            } else {\n              height = this.arrayLevels[Math.floor((i - 1) / 2)].height() + Config.FrameMarginY;\n            }\n          }\n        }\n        return [...res, res[res.length - 1] + height];\n      },\n      [Config.CanvasPaddingY.valueOf()]\n    );\n    this.levels.forEach((level, i) => {\n      level.setY(Grid.cumHeights[i]);\n    });\n\n    // get the cumulative height of all the array and frame levels\n    this._height = Grid.cumHeights[Grid.cumHeights.length - 1];\n    // get the maximum width of all the array and frame levels\n    this._width =\n      Math.max(\n        this.frameLevels.reduce<number>((a, b) => Math.max(a, b.width()), 0),\n        this.arrayLevels.reduce<number>((a, b) => Math.max(a, b.width()), 0)\n      ) + Config.FrameMarginX;\n  }\n\n  /**\n   * Find the Grid y-coordinate given a x-position.\n   * @param y absolute position\n   * @returns Largest x-coordinate smaller than or equal to a given x position.\n   */\n  static lastYCoordBelow(y: number) {\n    let l = Grid.cumHeights.length;\n    while (l--) {\n      if (Grid.cumHeights[l] <= y) {\n        return l;\n      }\n    }\n    return 0;\n  }\n\n  draw(): React.ReactNode {\n    return (\n      <Group key={Layout.key++}>\n        <Rect\n          {...ShapeDefaultProps}\n          x={this.x()}\n          y={this.y()}\n          width={this.width()}\n          height={this.height()}\n          key={Layout.key++}\n          listening={false}\n        />\n        {this.arrayLevels.reverse().map(level => level.draw())}\n        {this.frameLevels.reverse().map(level => level.draw())}\n      </Group>\n    );\n  }\n}\n","import { Config } from '../EnvVisualizerConfig';\nimport { Data, IVisible } from '../EnvVisualizerTypes';\nimport { Frame } from './Frame';\nimport { Grid } from './Grid';\nimport { Value } from './values/Value';\n\n/** this class tracks the target objects for each lane. */\nexport class ArrowLane {\n  readonly id: number;\n  static verticalLanes: ArrowLane[] = [];\n  static horizontalLanes: ArrowLane[] = [];\n  static arrayLevelLanes: ArrowLane[] = [];\n  public objects: (Data | IVisible)[] = [];\n  public frames: Frame[] = [];\n  readonly isVertical: boolean = true;\n\n  constructor(coord: number, isVertical: boolean) {\n    this.id = coord;\n    this.isVertical = isVertical;\n  }\n\n  static reset = () => {\n    ArrowLane.verticalLanes = [];\n    ArrowLane.horizontalLanes = [];\n    ArrowLane.arrayLevelLanes = [];\n  };\n\n  static getVerticalLaneBeforeTarget = (target: IVisible, currentX: number): ArrowLane => {\n    // get the lane between currentX and target right before the target\n    let xCoord = Frame.lastXCoordBelow(target.x()) + (currentX > target.x() ? 0 : 1);\n    const x = Frame.cumWidths[xCoord];\n    if (target.x() > x && currentX > x) {\n      xCoord++;\n    }\n    if (ArrowLane.verticalLanes[xCoord] === undefined) {\n      ArrowLane.verticalLanes[xCoord] = new ArrowLane(xCoord, true);\n    }\n    return ArrowLane.verticalLanes[xCoord];\n  };\n\n  static getVerticalLaneAfterSource = (target: IVisible, currentX: number): ArrowLane => {\n    // get the lane between currentX and target right after currentX\n    let xCoord = Frame.lastXCoordBelow(currentX) + (currentX > target.x() ? 0 : 1);\n    const x = Frame.cumWidths[xCoord];\n    if (target.x() > x && currentX > x) {\n      xCoord++;\n    }\n    if (ArrowLane.verticalLanes[xCoord] === undefined) {\n      ArrowLane.verticalLanes[xCoord] = new ArrowLane(xCoord, true);\n    }\n    return ArrowLane.verticalLanes[xCoord];\n  };\n\n  static getHorizontalLaneBeforeTarget = (target: IVisible, currentY: number): ArrowLane => {\n    // get the horizontal lane between currentY and target right before target\n    const yCoord = Grid.lastYCoordBelow(target.y()) + (currentY > target.y() ? 1 : 0);\n    if (ArrowLane.horizontalLanes[yCoord] === undefined) {\n      ArrowLane.horizontalLanes[yCoord] = new ArrowLane(yCoord, false);\n    }\n    return ArrowLane.horizontalLanes[yCoord];\n  };\n\n  static getHorizontalLaneAfterSource = (target: IVisible, currentY: number): ArrowLane => {\n    // get the horizontal lane between currentY and target right after currentY\n    const yCoord = Grid.lastYCoordBelow(currentY) + (currentY > target.y() ? 0 : 1);\n    if (ArrowLane.horizontalLanes[yCoord] === undefined) {\n      ArrowLane.horizontalLanes[yCoord] = new ArrowLane(yCoord, false);\n    }\n    return ArrowLane.horizontalLanes[yCoord];\n  };\n\n  getPosition = (target: Value | IVisible): number => {\n    // this method of calculating the position of arrows can be improved,\n    // currently just tries to fit arrows into the padding of the frame/array levels, might be better\n    // to place the arrow lanes between the levels, so we can reduce the padding between levels.\n    // place frame arrows on bottom half of horizontal lanes\n    if (target instanceof Frame) {\n      let index = this.frames.indexOf(target);\n      if (index === -1) {\n        index = this.frames.push(target) - 1;\n      }\n      const lane: number = (index * Config.ArrowLaneInterval) % Config.ArrowNumLanes;\n      return (\n        Grid.cumHeights[this.id] -\n        Config.FrameMarginY * 0.45 -\n        (lane / Config.ArrowNumLanes) * Config.FrameMarginY * 0.35\n      );\n    } else {\n      let index = this.objects.indexOf(target instanceof Value ? target.data : target);\n      if (index === -1) {\n        index = this.objects.push(target instanceof Value ? target.data : target) - 1;\n      }\n      const lane: number = (index * Config.ArrowLaneInterval) % Config.ArrowNumLanes;\n      if (this.isVertical) {\n        return (\n          Frame.cumWidths[this.id] -\n          Config.FrameMarginX * 0.9 +\n          Config.FnRadius +\n          (lane / (Config.ArrowNumLanes + 1)) * Config.FrameMarginX * 0.7\n        );\n      } else {\n        if (this.id % 2 === 0) {\n          // arrow between array level (above) and above horizontal frame arows (below)\n          return (\n            Grid.cumHeights[this.id] -\n            Config.FrameMarginY * 0.1 -\n            (lane / Config.ArrowNumLanes) * Config.FrameMarginY * 0.35\n          );\n        } else {\n          // arrows below frame level and above array level\n          return (\n            Grid.cumHeights[this.id] -\n            Config.FrameMarginY * 0.1 -\n            (lane / Config.ArrowNumLanes) * Config.FrameMarginY * 0.35\n          );\n        }\n      }\n    }\n  };\n}\n","import { Config } from '../../EnvVisualizerConfig';\nimport { StepsArray } from '../../EnvVisualizerTypes';\nimport { ArrowLane } from '../ArrowLane';\nimport { Frame } from '../Frame';\nimport { Grid } from '../Grid';\nimport { Text } from '../Text';\nimport { ArrayValue } from '../values/ArrayValue';\nimport { FnValue } from '../values/FnValue';\nimport { GlobalFnValue } from '../values/GlobalFnValue';\nimport { Value } from '../values/Value';\nimport { GenericArrow } from './GenericArrow';\n\n/** this class encapsulates an GenericArrow to be drawn between 2 points */\nexport class ArrowFromText<V extends Value> extends GenericArrow<Text, V> {\n  protected calculateSteps() {\n    const source = this.source;\n    const target = this.target;\n    if (!target) return [];\n\n    const steps: StepsArray = [(x, y) => [x + source.width(), y + source.height() / 2]];\n    if (target instanceof ArrayValue) {\n      steps.push((x, y) => [x + Config.TextMargin + Config.TextPaddingX, y]); // Spacing to right of text in frame\n      steps.push((x, y) => {\n        const newX = ArrowLane.getVerticalLaneAfterSource(target, x).getPosition(target);\n        return newX < x\n          ? [x, y - Math.sign(source.y() - target.y()) * (source.height() + Config.TextMargin)]\n          : [x, y];\n      }); // if the potential vertical lane is to the left, loop above or below text to allow GenericArrow to move left.\n      steps.push((x, y) => [\n        ArrowLane.getVerticalLaneAfterSource(target, x).getPosition(target),\n        y\n      ]);\n      // move to horizontal lane only if lane exists between source and target\n      const potentialHorizontalLaneY = ArrowLane.getHorizontalLaneBeforeTarget(\n        target,\n        source.y()\n      ).getPosition(target);\n      if ((potentialHorizontalLaneY - source.y()) * (potentialHorizontalLaneY - target.y()) < 0) {\n        steps.push((x, y) => {\n          const newY = ArrowLane.getHorizontalLaneBeforeTarget(target, y).getPosition(target);\n          return (newY - y) * (newY - target.y()) > 0\n            ? [x, y]\n            : [x, ArrowLane.getHorizontalLaneBeforeTarget(target, y).getPosition(target)];\n        });\n      }\n\n      // Move to x position closer to array on horizontal lane\n      steps.push((x, y) => {\n        let newX: number;\n        let yDiff = target.y() + Config.DataUnitHeight / 2 - y;\n        yDiff = Math.abs(yDiff - (Math.sign(yDiff) * Config.DataUnitHeight) / 2);\n        if (x < target.x()) {\n          newX = Math.max(x + Config.DataUnitWidth, target.x() - yDiff);\n        } else if (x >= target.x() + target.units.length * Config.DataUnitWidth) {\n          newX = target.x() + target.units.length * Config.DataUnitWidth;\n          newX = Math.min(x - Config.DataUnitWidth, newX + yDiff);\n        } else {\n          // if current point of arrow is somewhere above / below array, move halfway to corner of some arrayunit.\n          const index = Math.floor((x - target.x()) / Config.DataUnitWidth);\n          newX = target.x() + Config.DataUnitWidth * index;\n          return [(x + newX) / 2, (y + target.y()) / 2];\n        }\n        return [newX, y];\n      });\n      // Move to array pointing to corner of some arrayunit\n      steps.push((x, y) => {\n        const index = Math.floor((x - target.x()) / Config.DataUnitWidth);\n        const yDiff = source.y() - (target.y() + Config.DataUnitHeight / 2);\n        const newY =\n          target.y() +\n          Config.DataUnitHeight / 2 +\n          ((Math.abs(yDiff) < Config.DataUnitHeight ? 0 : Math.sign(yDiff)) *\n            Config.DataUnitHeight) /\n            2;\n        if (x < target.x()) {\n          return [target.x(), newY];\n        } else if (x >= target.x() + target.units.length * Config.DataUnitWidth) {\n          return [target.x() + target.units.length * Config.DataUnitWidth, newY];\n        } else {\n          return [target.x() + Config.DataUnitWidth * index, newY];\n        }\n      });\n    } else if (target instanceof FnValue || target instanceof GlobalFnValue) {\n      if (target.x() < source.x()) {\n        // move target the left of current frame above the binding.\n        steps.push((x, y) => [x + Config.TextMargin, y]);\n        steps.push((x, y) => [x, y - Math.sign(source.y() - target.y()) * source.height()]);\n        if (\n          Grid.lastYCoordBelow(target.y()) === Grid.lastYCoordBelow(source.y()) &&\n          Frame.lastXCoordBelow(source.x()) === Frame.lastXCoordBelow(target.x()) + 1\n        ) {\n          // Move directly target object\n          steps.push((x, y) => [target.centerX + Config.FnRadius * 3, y]);\n          steps.push((x, y) => [x, target.y()]);\n          steps.push((x, y) => [x - Config.FnRadius, y]);\n        } else {\n          // vertical lane, horizontal lane, vertical lane,\n          steps.push((x, y) => [\n            ArrowLane.getVerticalLaneAfterSource(target, x).getPosition(target),\n            y\n          ]);\n          steps.push((x, y) => [\n            x,\n            ArrowLane.getHorizontalLaneBeforeTarget(target, y).getPosition(target)\n          ]);\n          steps.push((x, y) => [\n            ArrowLane.getVerticalLaneBeforeTarget(target, x).getPosition(target),\n            y\n          ]);\n          steps.push((x, y) => [x, target.y()]);\n          steps.push((x, y) => [target.centerX + Config.FnRadius * 2, y]);\n        }\n      } else {\n        if (\n          Grid.lastYCoordBelow(target.y()) === Grid.lastYCoordBelow(source.y()) &&\n          Frame.lastXCoordBelow(source.x()) === Frame.lastXCoordBelow(target.x())\n        ) {\n          steps.push((x, y) => [target.x(), y]);\n          steps.push((x, y) => [x, target.y()]);\n        } else {\n          steps.push((x, y) => [\n            ArrowLane.getVerticalLaneAfterSource(target, x).getPosition(target),\n            y\n          ]);\n          steps.push((x, y) => [\n            x,\n            ArrowLane.getHorizontalLaneBeforeTarget(target, y).getPosition(target)\n          ]);\n          steps.push((x, y) => [\n            ArrowLane.getVerticalLaneBeforeTarget(target, x).getPosition(target),\n            y\n          ]);\n          steps.push((x, y) => [x, target.y()]);\n          steps.push((x, y) => [target.centerX + Config.FnRadius * 2, y]);\n        }\n      }\n    } else {\n      steps.push((x, y) => [x, target.y()]);\n      steps.push((x, y) => [target.x(), y]);\n    }\n    return steps;\n  }\n}\n","import React from 'react';\n\nimport { Config } from '../../EnvVisualizerConfig';\nimport { Layout } from '../../EnvVisualizerLayout';\nimport { ReferenceType, UnassignedData } from '../../EnvVisualizerTypes';\nimport { getTextWidth } from '../../EnvVisualizerUtils';\nimport { Binding } from '../Binding';\nimport { Text } from '../Text';\nimport { Value } from './Value';\n\n/** this class encapsulates an unassigned value in Source, internally represented as a symbol */\nexport class UnassignedValue extends Value {\n  readonly data: UnassignedData = Symbol();\n  readonly text: Text;\n\n  constructor(readonly referencedBy: ReferenceType[]) {\n    super();\n\n    // derive the coordinates from the main reference (binding / array unit)\n    const mainReference = this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x = mainReference.x() + getTextWidth(mainReference.keyString) + Config.TextPaddingX;\n      this._y = mainReference.y();\n      this.text = new Text(Config.UnassignedData.toString(), this._x, this._y, {\n        isStringIdentifiable: false\n      });\n    } else {\n      const maxWidth = mainReference.width();\n      const textWidth = Math.min(getTextWidth(String(this.data)), maxWidth);\n      this._x = mainReference.x() + (mainReference.width() - textWidth) / 2;\n      this._y = mainReference.y() + (mainReference.height() - Config.FontSize) / 2;\n      this.text = new Text(Config.UnassignedData.toString(), this._x, this._y, {\n        maxWidth: maxWidth,\n        isStringIdentifiable: false\n      });\n    }\n\n    this._width = this.text.width();\n    this._height = this.text.height();\n  }\n\n  reset(): void {\n    super.reset();\n    this.referencedBy.length = 0;\n  }\n  updatePosition(): void {\n    const mainReference = this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x = mainReference.x() + getTextWidth(mainReference.keyString) + Config.TextPaddingX;\n      this._y = mainReference.y();\n    } else {\n      const maxWidth = mainReference.width();\n      const textWidth = Math.min(getTextWidth(String(this.data)), maxWidth);\n      this._x = mainReference.x() + (mainReference.width() - textWidth) / 2;\n      this._y = mainReference.y() + (mainReference.height() - Config.FontSize) / 2;\n    }\n    this.text.updatePosition(this._x, this._y);\n  }\n  onMouseEnter(): void {}\n  onMouseLeave(): void {}\n\n  draw(): React.ReactNode {\n    this._isDrawn = true;\n    return <React.Fragment key={Layout.key++}>{this.text.draw()}</React.Fragment>;\n  }\n}\n","import React from 'react';\n\nimport EnvVisualizer from '../EnvVisualizer';\nimport { Config } from '../EnvVisualizerConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { Data } from '../EnvVisualizerTypes';\nimport { isDummyKey, isMainReference } from '../EnvVisualizerUtils';\nimport { ArrowFromText } from './arrows/ArrowFromText';\nimport { GenericArrow } from './arrows/GenericArrow';\nimport { Frame } from './Frame';\nimport { Text } from './Text';\nimport { ArrayValue } from './values/ArrayValue';\nimport { FnValue } from './values/FnValue';\nimport { GlobalFnValue } from './values/GlobalFnValue';\nimport { PrimitiveValue } from './values/PrimitiveValue';\nimport { UnassignedValue } from './values/UnassignedValue';\nimport { Value } from './values/Value';\nimport { Visible } from './Visible';\n\n/** a `binding` is a key-value pair in a frame */\nexport class Binding extends Visible {\n  readonly offsetY: number;\n  /** The maximum width of binding when hovered or clicked (takes tooltip into consideration) */\n  readonly _hoveredWidth: number;\n  readonly isMainReference: boolean;\n\n  /** value associated with this binding */\n  readonly value: Value;\n  /** key of this binding */\n  readonly key: Text;\n  /**\n   * `true` if this is a dummy binding\n   * i.e. the value is anonymous\n   */\n  readonly isDummyBinding: boolean = false;\n  keyYOffset: number;\n  private arrow: GenericArrow<Text, Value> | undefined = undefined;\n  public getArrow = (): GenericArrow<Text, Value> | undefined => {\n    return this.arrow;\n  };\n\n  constructor(\n    /** the key of this binding */\n    readonly keyString: string,\n    /** the value of this binding */\n    readonly data: Data,\n    /** frame this binding is in */\n    readonly frame: Frame,\n    /** previous binding (the binding above it) */\n    readonly prevBinding: Binding | null,\n    readonly isConstant: boolean = false\n  ) {\n    super();\n    this.isDummyBinding = isDummyKey(this.keyString);\n\n    // derive the coordinates from the binding above it\n    if (this.prevBinding) {\n      this._x = this.prevBinding.x();\n      this.offsetY = this.prevBinding.offsetY + this.prevBinding.height() + Config.TextPaddingY;\n    } else {\n      this._x = this.frame.x() + Config.FramePaddingX;\n      this.offsetY = this.frame.y() + Config.FramePaddingY;\n    }\n    this._y = this.offsetY;\n\n    this.keyString += isConstant ? Config.ConstantColon : Config.VariableColon;\n    this.value = Layout.createValue(data, this);\n    this.isMainReference = isMainReference(this.value, this);\n    if (this.isMainReference) {\n      // Moves the function object next to the correct frame\n      this.value.updatePosition();\n    }\n    this.keyYOffset =\n      (this.value instanceof FnValue || this.value instanceof GlobalFnValue) && this.isMainReference\n        ? (this.value.height() - Config.FontSize) / 2\n        : 0;\n    this.key = new Text(this.keyString, this.x(), this.offsetY + this.keyYOffset, {}, frame);\n\n    // derive the width from the right bound of the value (either no extra space or width of function object.)\n    this._width =\n      !(this.value instanceof ArrayValue) && this.isMainReference\n        ? this.value.x() + this.value.width() - this.x()\n        : this.key.width();\n    this._hoveredWidth =\n      this._width +\n      (this.value instanceof FnValue || this.value instanceof GlobalFnValue\n        ? this.value.tooltipWidth\n        : 0);\n    this._height = Math.max(\n      this.key.height(),\n      (this.value instanceof FnValue || this.value instanceof GlobalFnValue) && this.isMainReference\n        ? this.value.height()\n        : 0\n    );\n\n    if (this.isDummyBinding && !this.isMainReference) {\n      if (this.prevBinding) {\n        this.offsetY = this.prevBinding.offsetY;\n        this._width = this.prevBinding.width();\n        this._height = this.prevBinding.height();\n      }\n    }\n    this._y = this.offsetY;\n  }\n  hoveredWidth(): number {\n    return EnvVisualizer.getPrintableMode()\n      ? this._hoveredWidth\n      : this._width +\n          (this.value instanceof FnValue || this.value instanceof GlobalFnValue\n            ? this.value.tooltipWidth\n            : 0);\n  }\n  exportWidth(): number {\n    return (\n      this._width +\n      (this.value instanceof FnValue || this.value instanceof GlobalFnValue\n        ? this.value.exportTooltipWidth\n        : 0)\n    );\n  }\n  /**\n   * update absolute position of binding and its value.\n   * @param x Target x-position\n   * @param y Target y-position\n   */\n  updatePosition = (x: number, y: number) => {\n    this._x = x + Config.FramePaddingX;\n    this._y = y + this.offsetY;\n    this.key.updatePosition(this.x(), this.y() + this.keyYOffset);\n    if (isMainReference(this.value, this)) {\n      this.value.updatePosition();\n    }\n  };\n\n  draw(): React.ReactNode {\n    if (\n      !(\n        this.isDummyBinding || // value is unreferenced in dummy binding\n        this.value instanceof PrimitiveValue ||\n        this.value instanceof UnassignedValue ||\n        this.value instanceof ArrayValue\n      )\n    ) {\n      this.arrow = new ArrowFromText(this.key).to(this.value);\n    }\n    return (\n      <React.Fragment key={Layout.key++}>\n        {this.isDummyBinding\n          ? null // omit the key since value is anonymous\n          : this.key.draw()}\n        {this.arrow && this.arrow.draw()}\n        {!(this.value instanceof ArrayValue) && this.isMainReference ? this.value.draw() : null}\n      </React.Fragment>\n    );\n  }\n}\n","import { Environment } from 'c-slang/dist/types';\nimport { Group } from 'konva/lib/Group';\nimport { Node } from 'konva/lib/Node';\nimport { Shape } from 'konva/lib/Shape';\nimport { cloneDeep } from 'lodash';\n\nimport { Value as CompactValue } from './compactComponents/values/Value';\nimport { Binding } from './components/Binding';\nimport { FnValue } from './components/values/FnValue';\nimport { GlobalFnValue } from './components/values/GlobalFnValue';\nimport { Value } from './components/values/Value';\nimport EnvVisualizer from './EnvVisualizer';\nimport { Config } from './EnvVisualizerConfig';\nimport {\n  CompactReferenceType,\n  Data,\n  EmptyObject,\n  Env,\n  EnvTree,\n  EnvTreeNode,\n  FnTypes,\n  PrimitiveTypes,\n  ReferenceType\n} from './EnvVisualizerTypes';\n\n// TODO: can make use of lodash\n/** Returns `true` if `x` is an object */\nexport function isObject(x: any): x is object {\n  return x === Object(x);\n}\n\n/** Returns `true` if `object` is empty */\nexport function isEmptyObject(object: Object): object is EmptyObject {\n  return Object.keys(object).length === 0;\n}\n\n/** Returns `true` if `object` is `Environment` */\nexport function isEnvironment(object: Object): object is Environment {\n  return 'head' in object && 'tail' in object && 'name' in object;\n}\n\n/** Returns `true` if `object` is `EnvTreeNode` */\nexport function isEnvTreeNode(object: Object): object is EnvTreeNode {\n  return 'parent' in object && 'children' in object;\n}\n\n/** Returns `true` if `object` is `EnvTree` */\nexport function isEnvTree(object: Object): object is EnvTree {\n  return 'root' in object;\n}\n\n/** Returns `true` if `env` is empty (that is, head of env is an empty object) */\nexport function isEmptyEnvironment(env: Env): env is Env & { head: EmptyObject } {\n  return env === null || isEmptyObject(env.head);\n}\n\n/** Returns `true` if `data` is a Javascript array */\nexport function isArray(data: Data): data is Data[] {\n  return Array.isArray(data);\n}\n\n/** Returns `true` if `x` is a Javascript function */\nexport function isFunction(x: any): x is () => any {\n  return x && {}.toString.call(x) === '[object Function]';\n}\n\n/** Returns `true` if `data` is a JS Slang function */\nexport function isFn(data: Data): data is FnTypes {\n  return isFunction(data) && 'environment' in data && 'functionName' in data;\n}\n\n/** Returns `true` if `x` is a JS Slang function in the global frame */\nexport function isGlobalFn(x: any): x is () => any {\n  return isFunction(x) && !isFn(x);\n}\n\n/** Returns `true` if `data` is null */\nexport function isNull(data: Data): data is null {\n  return data === null;\n}\n\n/** Returns `true` if `data` is undefined */\nexport function isUndefined(data: Data): data is undefined {\n  return data === undefined;\n}\n\n/** Returns `true` if `data` is a string */\nexport function isString(data: Data): data is string {\n  return typeof data === 'string';\n}\n\n/** Returns `true` if `data` is a number */\nexport function isNumber(data: Data): data is number {\n  return typeof data === 'number';\n}\n\n/** Returns `true` if `data` is a symbol */\nexport function isUnassigned(data: Data): data is symbol {\n  return typeof data === 'symbol';\n}\n\n/** Returns `true` if `data` is a boolean */\nexport function isBoolean(data: Data): data is boolean {\n  return typeof data === 'boolean';\n}\n\n/** Returns `true` if `data` is a primitive, defined as a null | data | number */\nexport function isPrimitiveData(data: Data): data is PrimitiveTypes {\n  return isUndefined(data) || isNull(data) || isString(data) || isNumber(data) || isBoolean(data);\n}\n\n/** Returns `true` if `reference` is the main reference of `value` */\nexport function isMainReference(value: Value, reference: ReferenceType) {\n  if (value instanceof FnValue) {\n    // chooses the frame of the enclosing environment, not necessarily the first in referencedBy.\n    return (\n      reference instanceof Binding &&\n      value.enclosingEnvNode === (reference as Binding).frame.envTreeNode &&\n      value.referencedBy.findIndex(x => x instanceof Binding && x === reference) !== -1\n    );\n  } else if (value instanceof GlobalFnValue) {\n    return value.referencedBy.find(x => x instanceof Binding) === reference;\n  } else {\n    return value.referencedBy[0] === reference;\n  }\n}\n\n/** Returns `true` if `reference` is the main reference of `value` */\nexport function isCompactMainReference(value: CompactValue, reference: CompactReferenceType) {\n  return value.referencedBy[0] === reference;\n}\n\n/** checks if `value` is a `number` */\n/** Returns `true` if `value` is a `number` */\nexport function isNumeric(value: string) {\n  return /^-?\\d+$/.test(value);\n}\n\n/**\n * Returns `true` if `key` is a dummy key.\n * dummy key is an integral unique id.\n */\nexport function isDummyKey(key: string) {\n  return isNumeric(key);\n}\n\n/**\n * Uses canvas.measureText to compute and return the width of the given text of given font in pixels.\n *\n * @param {string} text The text to be rendered.\n * @param {string} font The css font descriptor that text is to be rendered with (e.g. \"bold 14px verdana\").\n */\nexport function getTextWidth(\n  text: string,\n  font: string = `${Config.FontStyle} ${Config.FontSize}px ${Config.FontFamily}`\n): number {\n  const canvas = document.createElement('canvas');\n  const context = canvas.getContext('2d');\n\n  if (!context || !text) {\n    return 0;\n  }\n\n  context.font = font;\n  const longestLine = text\n    .split('\\n')\n    .reduce<string>(\n      (accText, currValue) =>\n        context.measureText(accText).width > context.measureText(currValue).width\n          ? accText\n          : currValue,\n      ''\n    );\n  const metrics = context.measureText(longestLine);\n  return metrics.width;\n}\n\n/** Returns the parameter string of the given function */\nexport function getParamsText(data: () => any): string {\n  if (isFn(data)) {\n    return data.node.params.map((node: any) => node.name).join(',');\n  } else {\n    const fnString = data.toString();\n    return fnString.substring(fnString.indexOf('('), fnString.indexOf('{')).trim();\n  }\n}\n\n/** Returns the body string of the given function */\nexport function getBodyText(data: () => any): string {\n  const fnString = data.toString();\n  if (isFn(data)) {\n    let body =\n      data.node.type === 'FunctionDeclaration' || fnString.substring(0, 8) === 'function'\n        ? fnString.substring(fnString.indexOf('{'))\n        : fnString.substring(fnString.indexOf('=') + 3);\n\n    if (body[0] !== '{') body = '{\\n  return ' + body + ';\\n}';\n    return body;\n  } else {\n    return fnString.substring(fnString.indexOf('{'));\n  }\n}\n\nexport function setHoveredCursor(target: Node | Group) {\n  const container = target.getStage()?.container();\n  container && (container.style.cursor = 'pointer');\n}\n\nexport function setUnhoveredCursor(target: Node | Group) {\n  const container = target.getStage()?.container();\n  container && (container.style.cursor = 'default');\n}\n\n/** Updates the styles of a Konva node and its children on hover, and then redraw the layer */\nexport function setHoveredStyle(target: Node | Group, hoveredAttrs: any = {}): void {\n  const nodes: (Group | Shape | Node)[] =\n    target instanceof Group ? Array.from(target.children || []) : [];\n  nodes.push(target);\n  nodes.forEach(node => {\n    node.setAttrs({\n      stroke: node.attrs.stroke ? Config.HoveredColor.toString() : node.attrs.stroke,\n      fill: node.attrs.fill ? Config.HoveredColor.toString() : node.attrs.fill,\n      ...hoveredAttrs\n    });\n  });\n}\n\n/** Updates the styles of a Konva node and its children on unhover, and then redraw the layer */\nexport function setUnhoveredStyle(target: Node | Group, unhoveredAttrs: any = {}): void {\n  const nodes: (Group | Shape | Node)[] =\n    target instanceof Group ? Array.from(target.children || []) : [];\n  nodes.push(target);\n\n  nodes.forEach(node => {\n    node.setAttrs({\n      stroke: node.attrs.stroke\n        ? EnvVisualizer.getPrintableMode()\n          ? Config.SA_BLUE.toString()\n          : Config.SA_WHITE.toString()\n        : node.attrs.stroke,\n      fill: node.attrs.fill\n        ? EnvVisualizer.getPrintableMode()\n          ? Config.SA_BLUE.toString()\n          : Config.SA_WHITE.toString()\n        : node.attrs.fill,\n      ...unhoveredAttrs\n    });\n  });\n}\n\n/** Extracts the non-empty tail environment from the given environment */\nexport function getNonEmptyEnv(environment: Env): Env {\n  if (environment === null) {\n    return null;\n  } else if (isEmptyEnvironment(environment)) {\n    return getNonEmptyEnv(environment.tail);\n  } else {\n    return environment;\n  }\n}\n\n/**\n * Finds the underlying `Environment` objects and copies property descriptors\n * from source frames to destination frames. Property descriptors are important for us\n * to distinguish between constants and variables.\n */\nexport function copyOwnPropertyDescriptors(source: any, destination: any) {\n  if (isFunction(source) || isPrimitiveData(source)) {\n    return;\n  }\n  if (isEnvTree(source) && isEnvTree(destination)) {\n    copyOwnPropertyDescriptors(source.root, destination.root);\n  } else if (isEnvTreeNode(source) && isEnvTreeNode(destination)) {\n    // recurse only on children and environment\n    copyOwnPropertyDescriptors(source.children, destination.children);\n    copyOwnPropertyDescriptors(source.environment, destination.environment);\n  } else if (isArray(source) && isArray(destination)) {\n    // recurse on array items\n    source.forEach((item, i) => copyOwnPropertyDescriptors(item, destination[i]));\n  } else if (isEnvironment(source) && isEnvironment(destination)) {\n    // copy descriptors from source frame to destination frame\n    Object.defineProperties(destination.head, Object.getOwnPropertyDescriptors(source.head));\n    // recurse on tail\n    copyOwnPropertyDescriptors(source.tail, destination.tail);\n  }\n}\n\n/**\n * Creates a deep clone of `EnvTree`\n *\n * TODO: move this function to EnvTree class\n * so we can invoke like so: environmentTree.deepCopy()\n */\nexport function deepCopyTree(value: EnvTree): EnvTree {\n  const clone = cloneDeep(value);\n  copyOwnPropertyDescriptors(value, clone);\n  return clone;\n}\n\nexport function getNextChildren(c: EnvTreeNode): EnvTreeNode[] {\n  if (isEmptyEnvironment(c.environment)) {\n    const nextChildren: EnvTreeNode[] = [];\n    c.children.forEach(gc => {\n      nextChildren.push(...getNextChildren(gc as EnvTreeNode));\n    });\n    return nextChildren;\n  } else {\n    return [c];\n  }\n}\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport { Arrow as KonvaArrow, Group as KonvaGroup, Path as KonvaPath } from 'react-konva';\n\nimport { Visible } from '../../components/Visible';\nimport EnvVisualizer from '../../EnvVisualizer';\nimport { CompactConfig, ShapeDefaultProps } from '../../EnvVisualizerCompactConfig';\nimport { Layout } from '../../EnvVisualizerLayout';\nimport { IVisible, StepsArray } from '../../EnvVisualizerTypes';\nimport { setHoveredStyle, setUnhoveredStyle } from '../../EnvVisualizerUtils';\n\n/** this class encapsulates an arrow to be drawn between 2 points */\nexport class GenericArrow<Source extends IVisible, Target extends IVisible> extends Visible {\n  private _path: string = '';\n  points: number[] = [];\n  source: Source;\n  target: Target | undefined;\n\n  constructor(from: Source) {\n    super();\n    this.source = from;\n    this.target = undefined;\n    this._x = from.x();\n    this._y = from.y();\n  }\n  path(): string {\n    return this._path;\n  }\n\n  to(to: Target): GenericArrow<Source, Target> {\n    this.target = to;\n    this._width = Math.abs(to.x() - this.source.x());\n    this._height = Math.abs(to.y() - this.source.y());\n    return this;\n  }\n\n  /**\n   * Calculates the steps that this arrows takes.\n   * The arrow is decomposed into numerous straight line segments, each of which we\n   * can consider as a step of dx in the x direction and of dy in the y direction.\n   * The line segment is thus defined by 2 points (x, y) and (x + dx, y + dy)\n   * where (x, y) is the ending coordinate of the previous line segment.\n   * This function returns an array of such steps, represented by an array of functions\n   *  [ (x, y) => [x + dx1, y + dy1], (x, y) => [x + dx2, y + dy2], ... ].\n   * From this, we can retrieve the points that make up the arrow as such:\n   * (from.x from.y), (from.x + dx1, from.y + dy1), (from.x + dx1 + dx2, from.y + dy1 + dy2), ..\n   *\n   * Note that the functions need not be of the form (x, y) => [x + dx, y + dy];\n   * (x, y) => [to.x, to.y] is valid as well, and is used to specify a step to the ending coordinates\n   *\n   * @return an array of steps represented by functions\n   */\n  protected calculateSteps(): StepsArray {\n    const to = this.target;\n    if (!to) return [];\n    return [() => [to.x(), to.y()]];\n  }\n\n  onMouseEnter = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    setHoveredStyle(currentTarget, {\n      strokeWidth: Number(CompactConfig.ArrowHoveredStrokeWidth)\n    });\n  };\n\n  onMouseLeave = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    setUnhoveredStyle(currentTarget, {\n      strokeWidth: Number(CompactConfig.ArrowStrokeWidth)\n    });\n  };\n  onClick() {}\n\n  draw() {\n    const points = this.calculateSteps().reduce<Array<number>>(\n      (points, step) => [...points, ...step(points[points.length - 2], points[points.length - 1])],\n      [this.source.x(), this.source.y()]\n    );\n    points.splice(0, 2);\n\n    // starting point\n    this._path += `M ${points[0]} ${points[1]} `;\n    if (points.length === 4) {\n      // end the path if the line only has starting and ending coordinates\n      this._path += `L ${points[2]} ${points[3]} `;\n    } else {\n      let n = 0;\n      while (n < points.length - 4) {\n        const [xa, ya, xb, yb, xc, yc] = points.slice(n, n + 6);\n        const dx1 = xb - xa;\n        const dx2 = xc - xb;\n        const dy1 = yb - ya;\n        const dy2 = yc - yb;\n        const br = Math.min(\n          CompactConfig.ArrowCornerRadius,\n          Math.max(Math.abs(dx1), Math.abs(dy1)) / 2,\n          Math.max(Math.abs(dx2), Math.abs(dy2)) / 2\n        );\n        const x1 = xb - br * Math.sign(dx1);\n        const y1 = yb - br * Math.sign(dy1);\n        const x2 = xb + br * Math.sign(dx2);\n        const y2 = yb + br * Math.sign(dy2);\n\n        // draw quadratic curves over corners\n        this._path += `L ${x1} ${y1} Q ${xb} ${yb} ${x2} ${y2}`;\n        n += 2;\n      }\n    }\n    // end path\n    this._path += `L ${points[points.length - 2]} ${points[points.length - 1]} `;\n    return (\n      <KonvaGroup\n        key={Layout.key++}\n        onMouseEnter={this.onMouseEnter}\n        onMouseLeave={this.onMouseLeave}\n      >\n        <KonvaPath\n          {...ShapeDefaultProps}\n          stroke={\n            EnvVisualizer.getPrintableMode()\n              ? CompactConfig.SA_BLUE.toString()\n              : CompactConfig.SA_WHITE.toString()\n          }\n          strokeWidth={Number(CompactConfig.ArrowStrokeWidth)}\n          hitStrokeWidth={Number(CompactConfig.ArrowHitStrokeWidth)}\n          data={this.path()}\n          key={Layout.key++}\n        />\n        <KonvaArrow\n          {...ShapeDefaultProps}\n          points={points.slice(points.length - 4)}\n          fill={\n            EnvVisualizer.getPrintableMode()\n              ? CompactConfig.SA_BLUE.toString()\n              : CompactConfig.SA_WHITE.toString()\n          }\n          strokeEnabled={false}\n          pointerWidth={Number(CompactConfig.ArrowHeadSize)}\n          key={Layout.key++}\n        />\n      </KonvaGroup>\n    );\n  }\n}\n","import { CompactConfig } from '../../EnvVisualizerCompactConfig';\nimport { StepsArray } from '../../EnvVisualizerTypes';\nimport { Frame } from '../Frame';\nimport { GenericArrow } from './GenericArrow';\n\n/** this class encapsulates an GenericArrow to be drawn between 2 points */\nexport class ArrowFromFrame extends GenericArrow<Frame, Frame> {\n  protected calculateSteps() {\n    const to = this.target;\n    if (!to) return [];\n\n    const steps: StepsArray = [(x, y) => [x + CompactConfig.FramePaddingX, y]];\n\n    if (to instanceof Frame) {\n      steps.push((x, y) => [x, y - CompactConfig.FrameMarginY]);\n      steps.push((x, y) => [to.x() + CompactConfig.FramePaddingX, y]);\n    }\n\n    steps.push((x, y) => [to.x() + CompactConfig.FramePaddingX, to.y() + to.height()]);\n    return steps;\n  }\n}\n","import React from 'react';\nimport { Rect } from 'react-konva';\n\nimport { Visible } from '../components/Visible';\nimport EnvVisualizer from '../EnvVisualizer';\nimport { CompactConfig, ShapeDefaultProps } from '../EnvVisualizerCompactConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { Data } from '../EnvVisualizerTypes';\nimport { ArrayValue } from './values/ArrayValue';\n\n/** this classes encapsulates an empty array */\nexport class ArrayEmptyUnit extends Visible {\n  readonly value: null = null;\n\n  readonly data: Data = [];\n\n  constructor(readonly parent: ArrayValue) {\n    super();\n    this._x = this.parent.x();\n    this._y = this.parent.y();\n    this._height = this.parent.height();\n    this._width = this.parent.width();\n  }\n  x(): number {\n    return this._x;\n  }\n  y(): number {\n    return this._y;\n  }\n  height(): number {\n    return this._height;\n  }\n  width(): number {\n    return this._width;\n  }\n  updatePosition = () => {\n    this._x = this.parent.x();\n    this._y = this.parent.y();\n  };\n  reset(): void {}\n\n  draw(): React.ReactNode {\n    return (\n      <Rect\n        {...ShapeDefaultProps}\n        key={Layout.key++}\n        x={this.x()}\n        y={this.y()}\n        width={this.width()}\n        height={this.height()}\n        stroke={\n          EnvVisualizer.getPrintableMode()\n            ? CompactConfig.SA_BLUE.toString()\n            : CompactConfig.SA_WHITE.toString()\n        }\n        ref={this.ref}\n      />\n    );\n  }\n}\n","import { CompactConfig } from '../../EnvVisualizerCompactConfig';\nimport { StepsArray } from '../../EnvVisualizerTypes';\nimport { Frame } from '../Frame';\nimport { FnValue } from '../values/FnValue';\nimport { GlobalFnValue } from '../values/GlobalFnValue';\nimport { GenericArrow } from './GenericArrow';\n\n/** this class encapsulates an GenericArrow to be drawn between 2 points */\nexport class ArrowFromFn extends GenericArrow<FnValue | GlobalFnValue, Frame> {\n  protected calculateSteps() {\n    const from = this.source;\n    const to = this.target;\n    if (!to) return [];\n\n    const steps: StepsArray = [(x, y) => [x + CompactConfig.FnRadius * 3, y]];\n\n    if (to.y() < from.y() && from.y() < to.y() + to.height()) {\n      steps.push((x, y) => [x, y - CompactConfig.FnRadius * 2]);\n      steps.push((x, y) => [to.x() + (from.x() < to.x() ? 0 : to.width()), y]);\n    } else {\n      steps.push(() => [to.x() + to.width() / 2, to.y() + (to.y() < from.y() ? to.height() : 0)]);\n    }\n\n    return steps;\n  }\n}\n","import React from 'react';\n\nimport { Visible } from '../../components/Visible';\nimport { CompactReferenceType, Data } from '../../EnvVisualizerTypes';\n\n/** the value of a `Binding` or an `ArrayUnit` */\nexport abstract class Value extends Visible {\n  /** draw logic */\n  abstract draw(): React.ReactNode;\n  /** add reference (binding / array unit) to this value */\n  addReference(newReference: CompactReferenceType): void {\n    this.referencedBy.push(newReference);\n  }\n  abstract updatePosition(pos?: { x: number; y: number }): void;\n\n  /** references to this value */\n  public referencedBy: CompactReferenceType[] = [];\n  /** the underlying data of this value */\n  abstract readonly data: Data;\n}\n","import { Environment } from 'c-slang/dist/types';\nimport { KonvaEventObject } from 'konva/lib/Node';\nimport React, { RefObject } from 'react';\nimport {\n  Circle,\n  Group,\n  Label as KonvaLabel,\n  Tag as KonvaTag,\n  Text as KonvaText\n} from 'react-konva';\n\nimport EnvVisualizer from '../../EnvVisualizer';\nimport { CompactConfig, ShapeDefaultProps } from '../../EnvVisualizerCompactConfig';\nimport { Layout } from '../../EnvVisualizerLayout';\nimport { CompactReferenceType, EnvTreeNode, FnTypes, IHoverable } from '../../EnvVisualizerTypes';\nimport {\n  getBodyText,\n  getNonEmptyEnv,\n  getParamsText,\n  getTextWidth,\n  setHoveredStyle,\n  setUnhoveredStyle\n} from '../../EnvVisualizerUtils';\nimport { ArrowFromFn } from '../arrows/ArrowFromFn';\nimport { Binding } from '../Binding';\nimport { Value } from './Value';\n\n/** this class encapsulates a JS Slang function (not from the global frame) that\n *  contains extra props such as environment and fnName */\nexport class FnValue extends Value implements IHoverable {\n  /** name of this function */\n  readonly radius: number = CompactConfig.FnRadius;\n  readonly innerRadius: number = CompactConfig.FnInnerRadius;\n  readonly tooltipWidth: number;\n  readonly centerX: number;\n\n  readonly fnName: string;\n  readonly paramsText: string;\n  readonly bodyText: string;\n  readonly exportBodyText: string;\n  readonly tooltip: string;\n  readonly exportTooltip: string;\n  readonly exportTooltipWidth: number;\n  private _arrow: ArrowFromFn | undefined;\n\n  /** the parent/enclosing environment of this fn value */\n  readonly enclosingEnvNode: EnvTreeNode;\n  readonly labelRef: RefObject<any> = React.createRef();\n\n  constructor(\n    /** underlying JS Slang function (contains extra props) */\n    readonly data: FnTypes,\n    /** what this value is being referenced by */\n    readonly referencedBy: CompactReferenceType[]\n  ) {\n    super();\n    Layout.memoizeCompactValue(this);\n\n    // derive the coordinates from the main reference (binding / array unit)\n    const mainReference = this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x =\n        mainReference.frame.x() + mainReference.frame.width() + CompactConfig.FrameMarginX / 4;\n      this._y = mainReference.y();\n      this.centerX = this._x + this.radius * 2;\n    } else {\n      if (mainReference.isLastUnit) {\n        this._x = mainReference.x() + CompactConfig.DataUnitWidth * 2;\n        this._y = mainReference.y() + CompactConfig.DataUnitHeight / 2 - this.radius;\n      } else {\n        this._x = mainReference.x();\n        this._y = mainReference.y() + mainReference.parent.height() + CompactConfig.DataUnitHeight;\n      }\n      this.centerX = this._x + CompactConfig.DataUnitWidth / 2;\n      this._x = this.centerX - this.radius * 2;\n    }\n    this._y += this.radius;\n\n    this._width = this.radius * 4;\n    this._height = this.radius * 2;\n\n    this.enclosingEnvNode = Layout.environmentTree.getTreeNode(\n      getNonEmptyEnv(this.data.environment) as Environment\n    ) as EnvTreeNode;\n    this.fnName = this.data.functionName;\n\n    this.paramsText = `params: (${getParamsText(this.data)})`;\n    this.bodyText = `body: ${getBodyText(this.data)}`;\n    this.exportBodyText =\n      (this.bodyText.length > 23 ? this.bodyText.slice(0, 20) : this.bodyText)\n        .split('\\n')\n        .slice(0, 2)\n        .join('\\n') + ' ...';\n    this.tooltip = `${this.paramsText}\\n${this.bodyText}`;\n    this.exportTooltip = `${this.paramsText}\\n${this.exportBodyText}`;\n    this.tooltipWidth = Math.max(getTextWidth(this.paramsText), getTextWidth(this.bodyText));\n    this.exportTooltipWidth = Math.max(\n      getTextWidth(this.paramsText),\n      getTextWidth(this.exportBodyText)\n    );\n  }\n\n  onMouseEnter = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    if (EnvVisualizer.getPrintableMode()) return;\n    this.ref.current.moveToTop();\n    this.labelRef.current.show();\n    setHoveredStyle(currentTarget);\n  };\n\n  onMouseLeave = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    if (EnvVisualizer.getPrintableMode()) return;\n    this.labelRef.current.hide();\n    setUnhoveredStyle(currentTarget);\n  };\n  updatePosition(): void {}\n  draw(): React.ReactNode {\n    this._arrow =\n      this.enclosingEnvNode.compactFrame &&\n      (new ArrowFromFn(this).to(this.enclosingEnvNode.compactFrame) as ArrowFromFn);\n    return (\n      <React.Fragment key={Layout.key++}>\n        <Group\n          onMouseEnter={e => this.onMouseEnter(e)}\n          onMouseLeave={e => this.onMouseLeave(e)}\n          ref={this.ref}\n        >\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX - this.radius}\n            y={this.y()}\n            radius={this.radius}\n            stroke={\n              EnvVisualizer.getPrintableMode()\n                ? CompactConfig.SA_BLUE.toString()\n                : CompactConfig.SA_WHITE.toString()\n            }\n          />\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX - this.radius}\n            y={this.y()}\n            radius={this.innerRadius}\n            fill={\n              EnvVisualizer.getPrintableMode()\n                ? CompactConfig.SA_BLUE.toString()\n                : CompactConfig.SA_WHITE.toString()\n            }\n          />\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX + this.radius}\n            y={this.y()}\n            radius={this.radius}\n            stroke={\n              EnvVisualizer.getPrintableMode()\n                ? CompactConfig.SA_BLUE.toString()\n                : CompactConfig.SA_WHITE.toString()\n            }\n          />\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX + this.radius}\n            y={this.y()}\n            radius={this.innerRadius}\n            fill={\n              EnvVisualizer.getPrintableMode()\n                ? CompactConfig.SA_BLUE.toString()\n                : CompactConfig.SA_WHITE.toString()\n            }\n          />\n        </Group>\n        {EnvVisualizer.getPrintableMode() ? (\n          <KonvaLabel\n            x={this.x() + this.width() + CompactConfig.TextPaddingX * 2}\n            y={this.y() - CompactConfig.TextPaddingY}\n            visible={true}\n            ref={this.labelRef}\n          >\n            <KonvaTag\n              stroke=\"black\"\n              fill={'white'}\n              opacity={Number(CompactConfig.FnTooltipOpacity)}\n            />\n            <KonvaText\n              text={this.exportTooltip}\n              fontFamily={CompactConfig.FontFamily.toString()}\n              fontSize={Number(CompactConfig.FontSize)}\n              fontStyle={CompactConfig.FontStyle.toString()}\n              fill={CompactConfig.SA_BLUE.toString()}\n              padding={5}\n            />\n          </KonvaLabel>\n        ) : (\n          <KonvaLabel\n            x={this.x() + this.width() + CompactConfig.TextPaddingX * 2}\n            y={this.y() - CompactConfig.TextPaddingY}\n            visible={false}\n            ref={this.labelRef}\n          >\n            <KonvaTag\n              stroke=\"black\"\n              fill={'black'}\n              opacity={Number(CompactConfig.FnTooltipOpacity)}\n            />\n            <KonvaText\n              text={this.tooltip}\n              fontFamily={CompactConfig.FontFamily.toString()}\n              fontSize={Number(CompactConfig.FontSize)}\n              fontStyle={CompactConfig.FontStyle.toString()}\n              fill={CompactConfig.SA_WHITE.toString()}\n              padding={5}\n            />\n          </KonvaLabel>\n        )}\n        {this._arrow?.draw()}\n      </React.Fragment>\n    );\n  }\n}\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport React, { RefObject } from 'react';\nimport {\n  Circle,\n  Group,\n  Label as KonvaLabel,\n  Tag as KonvaTag,\n  Text as KonvaText\n} from 'react-konva';\n\nimport EnvVisualizer from '../../EnvVisualizer';\nimport { CompactConfig, ShapeDefaultProps } from '../../EnvVisualizerCompactConfig';\nimport { Layout } from '../../EnvVisualizerLayout';\nimport { CompactReferenceType, IHoverable } from '../../EnvVisualizerTypes';\nimport {\n  getBodyText,\n  getParamsText,\n  getTextWidth,\n  setHoveredStyle,\n  setUnhoveredStyle\n} from '../../EnvVisualizerUtils';\nimport { ArrowFromFn } from '../arrows/ArrowFromFn';\nimport { Binding } from '../Binding';\nimport { Value } from './Value';\n\n/** this encapsulates a function from the global frame\n * (which has no extra props such as environment or fnName) */\nexport class GlobalFnValue extends Value implements IHoverable {\n  centerX: number;\n  readonly tooltipWidth: number;\n  readonly exportTooltipWidth: number;\n  readonly radius: number = CompactConfig.FnRadius;\n  readonly innerRadius: number = CompactConfig.FnInnerRadius;\n  private _arrow: ArrowFromFn | undefined;\n\n  readonly paramsText: string;\n  readonly bodyText: string;\n  readonly exportBodyText: string;\n  readonly tooltip: string;\n  readonly exportTooltip: string;\n  private selected: boolean = false;\n\n  readonly labelRef: RefObject<any> = React.createRef();\n\n  constructor(\n    /** underlying function */\n    readonly data: () => any,\n    /** what this value is being referenced by */\n    readonly referencedBy: CompactReferenceType[]\n  ) {\n    super();\n    Layout.memoizeCompactValue(this);\n\n    // derive the coordinates from the main reference (binding / array unit)\n    const mainReference = this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x =\n        mainReference.frame.x() + mainReference.frame.width() + CompactConfig.FrameMarginX / 4;\n      this._y = mainReference.y();\n      this.centerX = this._x + this.radius * 2;\n    } else {\n      if (mainReference.isLastUnit) {\n        this._x = mainReference.x() + CompactConfig.DataUnitWidth * 2;\n        this._y = mainReference.y() + CompactConfig.DataUnitHeight / 2 - this.radius;\n      } else {\n        this._x = mainReference.x();\n        this._y = mainReference.y() + mainReference.parent.height() + CompactConfig.DataUnitHeight;\n      }\n      this.centerX = this._x + CompactConfig.DataUnitWidth / 2;\n      this._x = this.centerX - this.radius * 2;\n    }\n    this._y += this.radius;\n\n    this._width = this.radius * 4;\n    this._height = this.radius * 2;\n\n    this.paramsText = `params: ${getParamsText(this.data)}`;\n    this.bodyText = `body: ${getBodyText(this.data)}`;\n    this.exportBodyText =\n      (this.bodyText.length > 23 ? this.bodyText.slice(0, 20) : this.bodyText)\n        .split('\\n')\n        .slice(0, 2)\n        .join('\\n') + ' ...';\n    this.tooltip = `${this.paramsText}\\n${this.bodyText}`;\n    this.exportTooltip = `${this.paramsText}\\n${this.exportBodyText}`;\n    this.tooltipWidth =\n      Math.max(getTextWidth(this.paramsText), getTextWidth(this.bodyText)) +\n      CompactConfig.TextPaddingX;\n    this.exportTooltipWidth = Math.max(\n      getTextWidth(this.paramsText),\n      getTextWidth(this.exportBodyText)\n    );\n  }\n  isSelected(): boolean {\n    return this.selected;\n  }\n  arrow(): ArrowFromFn | undefined {\n    return this._arrow;\n  }\n\n  updatePosition(): void {\n    const mainReference = this.referencedBy.find(x => x instanceof Binding) || this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x =\n        mainReference.frame.x() + mainReference.frame.width() + CompactConfig.FrameMarginX / 4;\n      this._y = mainReference.y();\n      this.centerX = this._x + this.radius * 2;\n    } else {\n      if (mainReference.isLastUnit) {\n        this._x = mainReference.x() + CompactConfig.DataUnitWidth * 2;\n        this._y = mainReference.y() + CompactConfig.DataUnitHeight / 2 - this.radius;\n      } else {\n        this._x = mainReference.x();\n        this._y = mainReference.y() + mainReference.parent.height() + CompactConfig.DataUnitHeight;\n      }\n      this.centerX = this._x + CompactConfig.DataUnitWidth / 2;\n      this._x = this.centerX - this.radius * 2;\n    }\n    this._y += this.radius;\n  }\n\n  onMouseEnter = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    if (EnvVisualizer.getPrintableMode()) return;\n    this.labelRef.current.show();\n    setHoveredStyle(currentTarget);\n  };\n\n  onMouseLeave = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    if (EnvVisualizer.getPrintableMode()) return;\n    if (!this.selected) {\n      this.labelRef.current.hide();\n      setUnhoveredStyle(currentTarget);\n    } else {\n      const container = currentTarget.getStage()?.container();\n      container && (container.style.cursor = 'default');\n    }\n  };\n  onClick = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    if (EnvVisualizer.getPrintableMode()) return;\n    this.selected = !this.selected;\n    if (!this.selected) {\n      this.labelRef.current.hide();\n      setUnhoveredStyle(currentTarget);\n    } else {\n      this.labelRef.current.show();\n      setHoveredStyle(currentTarget);\n    }\n  };\n\n  draw(): React.ReactNode {\n    this._isDrawn = true;\n    this._arrow =\n      Layout.globalEnvNode.compactFrame &&\n      (new ArrowFromFn(this).to(Layout.globalEnvNode.compactFrame) as ArrowFromFn);\n    return (\n      <React.Fragment key={Layout.key++}>\n        <Group\n          onMouseEnter={e => this.onMouseEnter(e)}\n          onMouseLeave={e => this.onMouseLeave(e)}\n          onClick={e => this.onClick(e)}\n          ref={this.ref}\n        >\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX - this.radius}\n            y={this.y()}\n            radius={this.radius}\n            stroke={\n              EnvVisualizer.getPrintableMode()\n                ? CompactConfig.SA_BLUE.toString()\n                : CompactConfig.SA_WHITE.toString()\n            }\n          />\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX - this.radius}\n            y={this.y()}\n            radius={this.innerRadius}\n            fill={\n              EnvVisualizer.getPrintableMode()\n                ? CompactConfig.SA_BLUE.toString()\n                : CompactConfig.SA_WHITE.toString()\n            }\n          />\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX + this.radius}\n            y={this.y()}\n            radius={this.radius}\n            stroke={\n              EnvVisualizer.getPrintableMode()\n                ? CompactConfig.SA_BLUE.toString()\n                : CompactConfig.SA_WHITE.toString()\n            }\n          />\n          <Circle\n            {...ShapeDefaultProps}\n            key={Layout.key++}\n            x={this.centerX + this.radius}\n            y={this.y()}\n            radius={this.innerRadius}\n            fill={\n              EnvVisualizer.getPrintableMode()\n                ? CompactConfig.SA_BLUE.toString()\n                : CompactConfig.SA_WHITE.toString()\n            }\n          />\n        </Group>\n        {EnvVisualizer.getPrintableMode() ? (\n          <KonvaLabel\n            x={this.x() + this.width() + CompactConfig.TextPaddingX * 2}\n            y={this.y() - CompactConfig.TextPaddingY}\n            visible={true}\n            ref={this.labelRef}\n          >\n            <KonvaTag\n              stroke=\"black\"\n              fill={'white'}\n              opacity={Number(CompactConfig.FnTooltipOpacity)}\n            />\n            <KonvaText\n              text={this.exportTooltip}\n              fontFamily={CompactConfig.FontFamily.toString()}\n              fontSize={Number(CompactConfig.FontSize)}\n              fontStyle={CompactConfig.FontStyle.toString()}\n              fill={CompactConfig.SA_BLUE.toString()}\n              padding={5}\n            />\n          </KonvaLabel>\n        ) : (\n          <KonvaLabel\n            x={this.x() + this.width() + CompactConfig.TextPaddingX * 2}\n            y={this.y() - CompactConfig.TextPaddingY}\n            visible={false}\n            ref={this.labelRef}\n          >\n            <KonvaTag\n              stroke=\"black\"\n              fill={'black'}\n              opacity={Number(CompactConfig.FnTooltipOpacity)}\n            />\n            <KonvaText\n              text={this.tooltip}\n              fontFamily={CompactConfig.FontFamily.toString()}\n              fontSize={Number(CompactConfig.FontSize)}\n              fontStyle={CompactConfig.FontStyle.toString()}\n              fill={CompactConfig.SA_WHITE.toString()}\n              padding={5}\n            />\n          </KonvaLabel>\n        )}\n        {Layout.globalEnvNode.compactFrame &&\n          new ArrowFromFn(this).to(Layout.globalEnvNode.compactFrame).draw()}\n      </React.Fragment>\n    );\n  }\n}\n","import { CompactConfig } from '../../EnvVisualizerCompactConfig';\nimport { StepsArray } from '../../EnvVisualizerTypes';\nimport { ArrayUnit } from '../ArrayUnit';\nimport { ArrayValue } from '../values/ArrayValue';\nimport { FnValue } from '../values/FnValue';\nimport { GlobalFnValue } from '../values/GlobalFnValue';\nimport { Value } from '../values/Value';\nimport { GenericArrow } from './GenericArrow';\n\n/** this class encapsulates an GenericArrow to be drawn between 2 points */\nexport class ArrowFromArrayUnit extends GenericArrow<ArrayUnit, Value> {\n  protected calculateSteps() {\n    const from = this.source;\n    const to = this.target;\n    if (!to) return [];\n\n    const steps: StepsArray = [\n      (x, y) => [x + CompactConfig.DataUnitWidth / 2, y + CompactConfig.DataUnitHeight / 2]\n    ];\n\n    if (to instanceof FnValue || to instanceof GlobalFnValue) {\n      steps.push(() => [from.x() < to.x() ? to.x() : to.centerX, to.y()]);\n    } else if (to instanceof ArrayValue) {\n      if (from.y() === to.y()) {\n        if (Math.abs(from.x() - to.x()) > CompactConfig.DataUnitWidth * 2) {\n          steps.push((x, y) => [x, y - CompactConfig.DataUnitHeight]);\n          steps.push(() => [\n            to.x() + CompactConfig.DataUnitWidth / 2,\n            to.y() - CompactConfig.DataUnitHeight / 2\n          ]);\n          steps.push((x, y) => [x, y + CompactConfig.DataUnitHeight / 2]);\n        } else {\n          steps.push(() => [to.x(), to.y() + CompactConfig.DataUnitHeight / 2]);\n        }\n      } else {\n        steps.push(() => [\n          to.x() + CompactConfig.DataUnitWidth / 2,\n          to.y() + (from.y() > to.y() ? CompactConfig.DataUnitHeight : 0)\n        ]);\n      }\n    }\n\n    return steps;\n  }\n}\n","import React from 'react';\nimport { Line as KonvaLine } from 'react-konva';\n\nimport { Visible } from '../components/Visible';\nimport EnvVisualizer from '../EnvVisualizer';\nimport { CompactConfig, ShapeDefaultProps } from '../EnvVisualizerCompactConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { CompactReferenceType, ReferenceType } from '../EnvVisualizerTypes';\n\n/** this classes encapsulates a null value in Source pairs or arrays */\nexport class ArrayNullUnit extends Visible {\n  arrayUnit: CompactReferenceType | ReferenceType;\n  referencedBy: (CompactReferenceType | ReferenceType)[];\n\n  constructor(referencedBy: (CompactReferenceType | ReferenceType)[]) {\n    super();\n    this.referencedBy = referencedBy;\n    this.arrayUnit = referencedBy[0];\n    this._x = this.arrayUnit.x();\n    this._y = this.arrayUnit.y();\n    this._height = this.arrayUnit.height();\n    this._width = this.arrayUnit.width();\n  }\n\n  updatePosition = () => {};\n\n  draw(): React.ReactNode {\n    return (\n      <KonvaLine\n        {...ShapeDefaultProps}\n        key={Layout.key++}\n        points={[this.x(), this.y() + this.height(), this.x() + this.width(), this.y()]}\n        stroke={\n          EnvVisualizer.getPrintableMode()\n            ? CompactConfig.SA_BLUE.toString()\n            : CompactConfig.SA_WHITE.toString()\n        }\n        hitStrokeWidth={Number(CompactConfig.DataHitStrokeWidth)}\n        ref={this.ref}\n        listening={false}\n      />\n    );\n  }\n}\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport React from 'react';\nimport { Label as KonvaLabel, Tag as KonvaTag, Text as KonvaText } from 'react-konva';\n\nimport { Visible } from '../components/Visible';\nimport { CompactConfig, ShapeDefaultProps } from '../EnvVisualizerCompactConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { Data, IHoverable } from '../EnvVisualizerTypes';\nimport { getTextWidth } from '../EnvVisualizerUtils';\n\nexport interface TextOptions {\n  maxWidth: number;\n  fontSize: number;\n  fontFamily: string;\n  fontStyle: string;\n  fontVariant: string;\n  isStringIdentifiable: boolean;\n}\n\nexport const defaultOptions: TextOptions = {\n  maxWidth: Number.MAX_VALUE, // maximum width this text should be\n  fontFamily: CompactConfig.FontFamily.toString(), // default is Arial\n  fontSize: Number(CompactConfig.FontSize), // in pixels. Default is 12\n  fontStyle: CompactConfig.FontStyle.toString(), // can be normal, bold, or italic. Default is normal\n  fontVariant: CompactConfig.FontVariant.toString(), // can be normal or small-caps. Default is normal\n  isStringIdentifiable: false // if true, contain strings within double quotation marks \"\". Default is false\n};\n\n/** this class encapsulates a string to be drawn onto the canvas */\nexport class Text extends Visible implements IHoverable {\n  readonly _height: number;\n  readonly _width: number;\n\n  readonly partialStr: string; // truncated string representation of data\n  readonly fullStr: string; // full string representation of data\n\n  readonly options: TextOptions = defaultOptions;\n\n  constructor(\n    readonly data: Data,\n    readonly _x: number,\n    readonly _y: number,\n    /** additional options (for customization of text) */\n    options: Partial<TextOptions> = {}\n  ) {\n    super();\n    this.options = { ...this.options, ...options };\n\n    const { fontSize, fontStyle, fontFamily, maxWidth, isStringIdentifiable } = this.options;\n\n    this.fullStr = this.partialStr = isStringIdentifiable\n      ? JSON.stringify(data) || String(data)\n      : String(data);\n    this._height = fontSize;\n\n    const widthOf = (s: string) => getTextWidth(s, `${fontStyle} ${fontSize}px ${fontFamily}`);\n    if (widthOf(this.partialStr) > maxWidth) {\n      let truncatedText = CompactConfig.Ellipsis.toString();\n      let i = 0;\n      while (\n        widthOf(this.partialStr.substring(0, i) + CompactConfig.Ellipsis.toString()) < maxWidth\n      ) {\n        truncatedText = this.partialStr.substring(0, i++) + CompactConfig.Ellipsis.toString();\n      }\n      this._width = widthOf(truncatedText);\n      this.partialStr = truncatedText;\n    } else {\n      this._width = Math.max(CompactConfig.TextMinWidth, widthOf(this.partialStr));\n    }\n  }\n\n  onMouseEnter = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    const container = currentTarget.getStage()?.container();\n    container && (container.style.cursor = 'pointer');\n    this.ref.current.moveToTop();\n    this.ref.current.show();\n    currentTarget.getLayer()?.draw();\n  };\n\n  onMouseLeave = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    const container = currentTarget.getStage()?.container();\n    container && (container.style.cursor = 'default');\n    this.ref.current.hide();\n    currentTarget.getLayer()?.draw();\n  };\n\n  draw(): React.ReactNode {\n    const props = {\n      fontFamily: this.options.fontFamily,\n      fontSize: this.options.fontSize,\n      fontStyle: this.options.fontStyle,\n      fill: CompactConfig.SA_WHITE.toString()\n    };\n    return (\n      <React.Fragment key={Layout.key++}>\n        <KonvaLabel\n          x={this.x()}\n          y={this.y()}\n          onMouseEnter={this.onMouseEnter}\n          onMouseLeave={this.onMouseLeave}\n        >\n          <KonvaText {...ShapeDefaultProps} key={Layout.key++} text={this.partialStr} {...props} />\n        </KonvaLabel>\n        <KonvaLabel\n          x={this.x()}\n          y={this.y()}\n          ref={this.ref}\n          visible={false}\n          onMouseEnter={this.onMouseEnter}\n          onMouseLeave={this.onMouseLeave}\n        >\n          <KonvaTag {...ShapeDefaultProps} fill={'black'} opacity={0.5} />\n          <KonvaText {...ShapeDefaultProps} key={Layout.key++} text={this.fullStr} {...props} />\n        </KonvaLabel>\n      </React.Fragment>\n    );\n  }\n}\n","import React from 'react';\n\nimport { CompactConfig } from '../../EnvVisualizerCompactConfig';\nimport { Layout } from '../../EnvVisualizerLayout';\nimport { CompactReferenceType, PrimitiveTypes } from '../../EnvVisualizerTypes';\nimport { getTextWidth, isNull } from '../../EnvVisualizerUtils';\nimport { ArrayNullUnit } from '../ArrayNullUnit';\nimport { Binding } from '../Binding';\nimport { Text } from '../Text';\nimport { Value } from './Value';\n\n/** this classes encapsulates a primitive value in Source: number, string or null */\nexport class PrimitiveValue extends Value {\n  /** the text to be rendered */\n  readonly text: Text | ArrayNullUnit;\n\n  constructor(\n    /** data */\n    readonly data: PrimitiveTypes,\n    /** what this value is being referenced by */\n    readonly referencedBy: CompactReferenceType[]\n  ) {\n    super();\n\n    // derive the coordinates from the main reference (binding / array unit)\n    const mainReference = this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x =\n        mainReference.x() + getTextWidth(mainReference.keyString) + CompactConfig.TextPaddingX;\n      this._y = mainReference.y();\n      this.text = new Text(this.data, this.x(), this.y(), { isStringIdentifiable: true });\n    } else {\n      const maxWidth = mainReference.width();\n      const textWidth = Math.min(getTextWidth(String(this.data)), maxWidth);\n      this._x = mainReference.x() + (mainReference.width() - textWidth) / 2;\n      this._y = mainReference.y() + (mainReference.height() - CompactConfig.FontSize) / 2;\n      this.text = isNull(this.data)\n        ? new ArrayNullUnit([mainReference])\n        : new Text(this.data, this.x(), this.y(), {\n            maxWidth: maxWidth,\n            isStringIdentifiable: true\n          });\n    }\n\n    this._width = this.text.width();\n    this._height = this.text.height();\n  }\n  updatePosition(): void {}\n  draw(): React.ReactNode {\n    return <React.Fragment key={Layout.key++}>{this.text.draw()}</React.Fragment>;\n  }\n}\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport React from 'react';\n\nimport { RoundedRect } from '../components/shapes/RoundedRect';\nimport { Visible } from '../components/Visible';\nimport EnvVisualizer from '../EnvVisualizer';\nimport { CompactConfig } from '../EnvVisualizerCompactConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { Data } from '../EnvVisualizerTypes';\nimport { setHoveredStyle, setUnhoveredStyle } from '../EnvVisualizerUtils';\nimport { Arrow } from './arrows/Arrow';\nimport { ArrowFromArrayUnit } from './arrows/ArrowFromArrayUnit';\nimport { ArrayValue } from './values/ArrayValue';\nimport { PrimitiveValue } from './values/PrimitiveValue';\nimport { Value } from './values/Value';\n\n/** this class encapsulates a single unit (box) of array to be rendered.\n *  this unit is part of an ArrayValue */\nexport class ArrayUnit extends Visible {\n  readonly value: Value;\n\n  /** check if this is the first unit in the array */\n  readonly isFirstUnit: boolean;\n  /** check if this is the last unit in the array */\n  readonly isLastUnit: boolean;\n  /** check if this unit is the main reference of the value */\n  readonly isMainReference: boolean;\n  parent: ArrayValue;\n  arrow: Arrow | undefined = undefined;\n\n  constructor(\n    /** index of this unit in its parent */\n    readonly idx: number,\n    /** the value this unit contains*/\n    readonly data: Data,\n    /** parent of this unit */\n    parent: ArrayValue\n  ) {\n    super();\n    this.parent = parent;\n    this._x = this.parent.x() + this.idx * CompactConfig.DataUnitWidth;\n    this._y = this.parent.y();\n    this._height = CompactConfig.DataUnitHeight;\n    this._width = CompactConfig.DataUnitWidth;\n    this.isFirstUnit = this.idx === 0;\n    this.isLastUnit = this.idx === this.parent.data.length - 1;\n    this.value = Layout.createCompactValue(this.data, this);\n    this.isMainReference = this.value.referencedBy.length > 1;\n  }\n\n  updatePosition = () => {};\n\n  onMouseEnter = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    setHoveredStyle(currentTarget);\n  };\n\n  onMouseLeave = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    setUnhoveredStyle(currentTarget);\n  };\n\n  draw(): React.ReactNode {\n    if (this.isDrawn()) return null;\n    this._isDrawn = true;\n\n    const cornerRadius = {\n      upperLeft: 0,\n      lowerLeft: 0,\n      upperRight: 0,\n      lowerRight: 0\n    };\n\n    if (this.isFirstUnit)\n      cornerRadius.upperLeft = cornerRadius.lowerLeft = Number(CompactConfig.DataCornerRadius);\n    if (this.isLastUnit)\n      cornerRadius.upperRight = cornerRadius.lowerRight = Number(CompactConfig.DataCornerRadius);\n\n    return (\n      <React.Fragment key={Layout.key++}>\n        <RoundedRect\n          key={Layout.key++}\n          x={this.x()}\n          y={this.y()}\n          width={this.width()}\n          height={this.height()}\n          stroke={\n            EnvVisualizer.getPrintableMode()\n              ? CompactConfig.SA_BLUE.toString()\n              : CompactConfig.SA_WHITE.toString()\n          }\n          hitStrokeWidth={Number(CompactConfig.DataHitStrokeWidth)}\n          fillEnabled={false}\n          onMouseEnter={this.onMouseEnter}\n          onMouseLeave={this.onMouseLeave}\n          cornerRadius={cornerRadius}\n          forwardRef={this.ref}\n        />\n        {this.value.draw()}\n        {this.value instanceof PrimitiveValue || new ArrowFromArrayUnit(this).to(this.value).draw()}\n      </React.Fragment>\n    );\n  }\n}\n","import React from 'react';\n\nimport { CompactConfig } from '../../EnvVisualizerCompactConfig';\nimport { Layout } from '../../EnvVisualizerLayout';\nimport { CompactReferenceType, Data } from '../../EnvVisualizerTypes';\nimport { ArrayEmptyUnit } from '../ArrayEmptyUnit';\nimport { ArrayUnit } from '../ArrayUnit';\nimport { Binding } from '../Binding';\nimport { PrimitiveValue } from './PrimitiveValue';\nimport { Value } from './Value';\n\n/** this class encapsulates an array value in source,\n *  defined as a JS array with not 2 elements */\nexport class ArrayValue extends Value {\n  /** array of units this array is made of */\n  units: ArrayUnit[] = [];\n\n  constructor(\n    /** underlying values this array contains */\n    readonly data: Data[],\n    /** what this value is being referenced by */\n    readonly referencedBy: CompactReferenceType[]\n  ) {\n    super();\n    Layout.memoizeCompactValue(this);\n\n    // derive the coordinates from the main reference (binding / array unit)\n    const mainReference = this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x = mainReference.frame.x() + mainReference.frame.width() + CompactConfig.FrameMarginX;\n      this._y = mainReference.y();\n    } else {\n      if (mainReference.isLastUnit) {\n        this._x = mainReference.x() + CompactConfig.DataUnitWidth * 2;\n        this._y = mainReference.y();\n      } else {\n        this._x = mainReference.x();\n        this._y = mainReference.y() + mainReference.parent.height() + CompactConfig.DataUnitHeight;\n      }\n    }\n\n    this._width = this.data.length * CompactConfig.DataUnitWidth + CompactConfig.DataMinWidth;\n    this._height = CompactConfig.DataUnitHeight;\n\n    // initialize array units from the last index\n    for (let i = this.data.length - 1; i >= 0; i--) {\n      const unit = new ArrayUnit(i, this.data[i], this);\n\n      // update the dimensions, so that children array values can derive their coordinates\n      // from these intermediate dimensions\n\n      // update the width\n      this._width = Math.max(\n        this.width(),\n        unit.value.width() +\n          (!(unit.value instanceof PrimitiveValue) && i === this.data.length - 1\n            ? (i + 1) * CompactConfig.DataUnitWidth + CompactConfig.DataUnitWidth\n            : i * CompactConfig.DataUnitWidth)\n      );\n\n      // update the height\n      this._height = Math.max(\n        this._height,\n        unit.value instanceof PrimitiveValue || unit.isMainReference\n          ? CompactConfig.DataUnitHeight\n          : unit.value.y() + unit.value.height() - unit.y()\n      );\n\n      this.units = [unit, ...this.units];\n    }\n  }\n  reset(): void {\n    super.reset();\n    this.units.map(x => x.reset());\n    this.referencedBy.length = 0;\n  }\n  updatePosition(): void {}\n\n  draw(): React.ReactNode {\n    if (this.isDrawn()) return null;\n    this._isDrawn = true;\n    return (\n      <React.Fragment key={Layout.key++}>\n        {this.units.length > 0\n          ? this.units.map(unit => unit.draw())\n          : new ArrayEmptyUnit(this).draw()}\n      </React.Fragment>\n    );\n  }\n}\n","import { CompactConfig } from '../../EnvVisualizerCompactConfig';\nimport { StepsArray } from '../../EnvVisualizerTypes';\nimport { Text } from '../Text';\nimport { ArrayValue } from '../values/ArrayValue';\nimport { Value } from '../values/Value';\nimport { GenericArrow } from './GenericArrow';\n\n/** this class encapsulates an GenericArrow to be drawn between 2 points */\nexport class ArrowFromText extends GenericArrow<Text, Value> {\n  protected calculateSteps() {\n    const from = this.source;\n    const to = this.target;\n    if (!to) return [];\n\n    const steps: StepsArray = [(x, y) => [x + from.width(), y + from.height() / 2]];\n\n    if (to.x() < from.x()) {\n      if (to instanceof ArrayValue) {\n        steps.push((x, y) => [x + CompactConfig.TextMargin, y]);\n        steps.push((x, y) => [x, to.y() - CompactConfig.DataUnitHeight / 3]);\n        steps.push((x, y) => [to.x() + CompactConfig.DataUnitWidth / 2, y]);\n        steps.push((x, y) => [x, to.y()]);\n      } else {\n        steps.push((x, y) => [x + CompactConfig.TextMargin, y]);\n        steps.push((x, y) => [x, y - from.height() / 2 - CompactConfig.TextMargin]);\n        steps.push((x, y) => [to.x() + to.width() + CompactConfig.ArrowHeadSize, y]);\n        steps.push((x, y) => [x, to.y()]);\n        steps.push((x, y) => [x - CompactConfig.ArrowHeadSize, y]);\n      }\n    } else {\n      steps.push((x, y) => [\n        to.x(),\n        to.y() + (to instanceof ArrayValue ? CompactConfig.DataUnitHeight / 2 : 0)\n      ]);\n    }\n\n    return steps;\n  }\n}\n","import React from 'react';\n\nimport { CompactConfig } from '../../EnvVisualizerCompactConfig';\nimport { Layout } from '../../EnvVisualizerLayout';\nimport { CompactReferenceType, UnassignedData } from '../../EnvVisualizerTypes';\nimport { getTextWidth } from '../../EnvVisualizerUtils';\nimport { Binding } from '../Binding';\nimport { Text } from '../Text';\nimport { Value } from './Value';\n\n/** this class encapsulates an unassigned value in Source, internally represented as a symbol */\nexport class UnassignedValue extends Value {\n  readonly data: UnassignedData = Symbol();\n  readonly text: Text;\n\n  constructor(readonly referencedBy: CompactReferenceType[]) {\n    super();\n\n    // derive the coordinates from the main reference (binding / array unit)\n    const mainReference = this.referencedBy[0];\n    if (mainReference instanceof Binding) {\n      this._x =\n        mainReference.x() + getTextWidth(mainReference.keyString) + CompactConfig.TextPaddingX;\n      this._y = mainReference.y();\n      this.text = new Text(CompactConfig.UnassignedData.toString(), this._x, this._y, {\n        isStringIdentifiable: false\n      });\n    } else {\n      const maxWidth = mainReference.width();\n      const textWidth = Math.min(getTextWidth(String(this.data)), maxWidth);\n      this._x = mainReference.x() + (mainReference.width() - textWidth) / 2;\n      this._y = mainReference.y() + (mainReference.height() - CompactConfig.FontSize) / 2;\n      this.text = new Text(CompactConfig.UnassignedData.toString(), this._x, this._y, {\n        maxWidth: maxWidth,\n        isStringIdentifiable: false\n      });\n    }\n\n    this._width = this.text.width();\n    this._height = this.text.height();\n  }\n\n  reset(): void {\n    super.reset();\n    this.referencedBy.length = 0;\n  }\n  updatePosition(): void {}\n\n  draw(): React.ReactNode {\n    this._isDrawn = true;\n    return <React.Fragment key={Layout.key++}>{this.text.draw()}</React.Fragment>;\n  }\n}\n","import React from 'react';\n\nimport { Visible } from '../components/Visible';\nimport { CompactConfig } from '../EnvVisualizerCompactConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { Data } from '../EnvVisualizerTypes';\nimport { isCompactMainReference, isDummyKey } from '../EnvVisualizerUtils';\nimport { ArrowFromText } from './arrows/ArrowFromText';\nimport { GenericArrow } from './arrows/GenericArrow';\nimport { Frame } from './Frame';\nimport { Text } from './Text';\nimport { ArrayValue } from './values/ArrayValue';\nimport { FnValue } from './values/FnValue';\nimport { GlobalFnValue } from './values/GlobalFnValue';\nimport { PrimitiveValue } from './values/PrimitiveValue';\nimport { UnassignedValue } from './values/UnassignedValue';\nimport { Value } from './values/Value';\n\n/** a `binding` is a key-value pair in a frame */\nexport class Binding extends Visible {\n  /** value associated with this binding */\n  readonly value: Value;\n  /** key of this binding */\n  readonly key: Text;\n  /**\n   * `true` if this is a dummy binding\n   * i.e. the value is anonymous\n   */\n  readonly isDummyBinding: boolean = false;\n  private arrow: GenericArrow<Text, Value> | undefined = undefined;\n  public getArrow = (): GenericArrow<Text, Value> | undefined => {\n    return this.arrow;\n  };\n\n  constructor(\n    /** the key of this binding */\n    readonly keyString: string,\n    /** the value of this binding */\n    readonly data: Data,\n    /** frame this binding is in */\n    readonly frame: Frame,\n    /** previous binding (the binding above it) */\n    readonly prevBinding: Binding | null,\n    readonly isConstant: boolean = false\n  ) {\n    super();\n    this.isDummyBinding = isDummyKey(this.keyString);\n\n    // derive the coordinates from the binding above it\n    if (this.prevBinding) {\n      this._x = this.prevBinding.x();\n      this._y = this.prevBinding.y() + this.prevBinding.height() + CompactConfig.TextPaddingY;\n    } else {\n      this._x = this.frame.x() + CompactConfig.FramePaddingX;\n      this._y = this.frame.y() + CompactConfig.FramePaddingY;\n    }\n\n    this.keyString += isConstant ? CompactConfig.ConstantColon : CompactConfig.VariableColon;\n    this.value = Layout.createCompactValue(data, this);\n\n    const keyYOffset =\n      this.value instanceof ArrayValue\n        ? (CompactConfig.DataUnitHeight - CompactConfig.FontSize) / 2\n        : (this.value.height() - CompactConfig.FontSize) / 2;\n\n    this.key = new Text(this.keyString, this.x(), this.y() + keyYOffset);\n\n    // derive the width from the right bound of the value\n    this._width = isCompactMainReference(this.value, this)\n      ? this.value.x() +\n        this.value.width() -\n        this.x() +\n        (this.value instanceof FnValue || this.value instanceof GlobalFnValue\n          ? this.value.tooltipWidth\n          : 0)\n      : this.key.width();\n\n    this._height = Math.max(this.key.height(), this.value.height());\n\n    if (this.isDummyBinding && !isCompactMainReference(this.value, this)) {\n      if (this.prevBinding) {\n        this._y = this.prevBinding.y();\n        this._width = this.prevBinding.width();\n        this._height = this.prevBinding.height();\n      }\n    }\n  }\n\n  draw(): React.ReactNode {\n    return (\n      <React.Fragment key={Layout.key++}>\n        {this.isDummyBinding\n          ? null // omit the key since value is anonymous\n          : this.key.draw()}\n        {this.isDummyBinding || // value is unreferenced in dummy binding\n        this.value instanceof PrimitiveValue ||\n        this.value instanceof UnassignedValue\n          ? null\n          : new ArrowFromText(this.key).to(this.value).draw()}\n        {isCompactMainReference(this.value, this) ? this.value.draw() : null}\n      </React.Fragment>\n    );\n  }\n}\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport React from 'react';\nimport { Group, Rect } from 'react-konva';\n\nimport { Visible } from '../components/Visible';\nimport EnvVisualizer from '../EnvVisualizer';\nimport { CompactConfig, ShapeDefaultProps } from '../EnvVisualizerCompactConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { Env, EnvTreeNode, IHoverable } from '../EnvVisualizerTypes';\nimport {\n  getNonEmptyEnv,\n  getTextWidth,\n  isDummyKey,\n  isPrimitiveData,\n  isUnassigned,\n  setHoveredStyle,\n  setUnhoveredStyle\n} from '../EnvVisualizerUtils';\nimport { ArrowFromFrame } from './arrows/ArrowFromFrame';\nimport { Binding } from './Binding';\nimport { Level } from './Level';\nimport { Text } from './Text';\n\nconst frameNames = new Map([\n  ['global', 'Global'],\n  ['programEnvironment', 'Program'],\n  ['forLoopEnvironment', 'Body of for-loop'],\n  ['forBlockEnvironment', 'Control variable of for-loop'],\n  ['blockEnvironment', 'Block'],\n  ['functionBodyEnvironment', 'Function Body']\n]);\n\n/** this class encapsulates a frame of key-value bindings to be drawn on canvas */\nexport class Frame extends Visible implements IHoverable {\n  /** total height = frame height + frame title height */\n  readonly totalHeight: number;\n  /** width of this frame + max width of the bound values */\n  readonly totalWidth: number;\n\n  /** the bindings this frame contains */\n  readonly bindings: Binding[] = [];\n  /** name of this frame to display */\n  readonly name: Text;\n  /** the level in which this frame resides */\n  readonly level: Level | undefined;\n  /** environment associated with this frame */\n  readonly environment: Env;\n  /** the parent/enclosing frame of this frame (the frame above it) */\n  readonly parentFrame: Frame | undefined;\n\n  constructor(\n    /** environment tree node that contains this frame */\n    readonly envTreeNode: EnvTreeNode,\n    /** the frame to the left of this frame, on the same level. used for calculating this frame's position */\n    readonly leftSiblingFrame: Frame | null\n  ) {\n    super();\n    this._width = CompactConfig.FrameMinWidth;\n    this.level = envTreeNode.compactLevel as Level;\n    this.environment = envTreeNode.environment;\n    this.parentFrame = envTreeNode.parent?.compactFrame;\n    this._x = this.level.x();\n    // derive the x coordinate from the left sibling frame\n    this.leftSiblingFrame &&\n      (this._x +=\n        this.leftSiblingFrame.x() + this.leftSiblingFrame.totalWidth + CompactConfig.FrameMarginX);\n\n    this.name = new Text(\n      frameNames.get(this.environment.name) || this.environment.name,\n      this.x(),\n      this.level.y(),\n      { maxWidth: this.width() }\n    );\n    this._y = this.level.y() + this.name.height() + CompactConfig.TextPaddingY / 2;\n\n    // width of the frame = max width of the bindings in the frame + frame padding * 2 (the left and right padding)\n    let maxBindingWidth = 0;\n    for (const [key, data] of Object.entries(this.environment.head)) {\n      const bindingWidth =\n        Math.max(CompactConfig.TextMinWidth, getTextWidth(key + CompactConfig.ConstantColon)) +\n        CompactConfig.TextPaddingX +\n        (isUnassigned(data)\n          ? Math.max(\n              CompactConfig.TextMinWidth,\n              getTextWidth(CompactConfig.UnassignedData.toString())\n            )\n          : isPrimitiveData(data)\n          ? Math.max(CompactConfig.TextMinWidth, getTextWidth(String(data)))\n          : 0);\n      maxBindingWidth = Math.max(maxBindingWidth, bindingWidth);\n    }\n    this._width = maxBindingWidth + CompactConfig.FramePaddingX * 2;\n\n    // initializes bindings (keys + values)\n    let prevBinding: Binding | null = null;\n    let totalWidth = this._width;\n\n    const descriptors = Object.getOwnPropertyDescriptors(this.environment.head);\n    const entries = [];\n    const dummyEntries = [];\n    for (const entry of Object.entries(descriptors)) {\n      if (isDummyKey(entry[0])) {\n        const actualEnv = getNonEmptyEnv(entry[1].value.environment);\n        if (\n          this.environment.id === CompactConfig.GlobalEnvId ||\n          (actualEnv && actualEnv.id === this.environment.id)\n        ) {\n          dummyEntries.push(entry);\n        }\n      } else {\n        entries.push(entry);\n      }\n    }\n    entries.push(...dummyEntries);\n\n    for (const [key, data] of entries) {\n      const currBinding: Binding = new Binding(key, data.value, this, prevBinding, !data.writable);\n      this.bindings.push(currBinding);\n      prevBinding = currBinding;\n      totalWidth = Math.max(totalWidth, currBinding.width() + CompactConfig.FramePaddingX);\n    }\n    this.totalWidth = totalWidth;\n\n    // derive the height of the frame from the the position of the last binding\n    this._height = prevBinding\n      ? prevBinding.y() + prevBinding.height() + CompactConfig.FramePaddingY - this.y()\n      : CompactConfig.FramePaddingY * 2;\n\n    this.totalHeight = this.height() + this.name.height() + CompactConfig.TextPaddingY / 2;\n  }\n\n  onMouseEnter = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    setHoveredStyle(currentTarget);\n  };\n\n  onMouseLeave = ({ currentTarget }: KonvaEventObject<MouseEvent>) => {\n    setUnhoveredStyle(currentTarget);\n  };\n\n  draw(): React.ReactNode {\n    return (\n      <Group key={Layout.key++}>\n        {this.name.draw()}\n        <Rect\n          {...ShapeDefaultProps}\n          x={this.x()}\n          y={this.y()}\n          width={this.width()}\n          height={this.height()}\n          stroke={\n            EnvVisualizer.getPrintableMode()\n              ? CompactConfig.SA_BLUE.toString()\n              : CompactConfig.SA_WHITE.toString()\n          }\n          cornerRadius={Number(CompactConfig.FrameCornerRadius)}\n          onMouseEnter={this.onMouseEnter}\n          onMouseLeave={this.onMouseLeave}\n          key={Layout.key++}\n        />\n        {this.bindings.map(binding => binding.draw())}\n        {this.parentFrame && new ArrowFromFrame(this).to(this.parentFrame).draw()}\n      </Group>\n    );\n  }\n}\n","import React from 'react';\nimport { Group, Rect } from 'react-konva';\n\nimport { Visible } from '../components/Visible';\nimport { CompactConfig, ShapeDefaultProps } from '../EnvVisualizerCompactConfig';\nimport { Layout } from '../EnvVisualizerLayout';\nimport { EnvTreeNode } from '../EnvVisualizerTypes';\nimport { Frame } from './Frame';\n\n/** this class encapsulates a level of frames to be drawn with the same y values */\nexport class Level extends Visible {\n  /** all the frames in this level */\n  readonly frames: Frame[] = [];\n\n  constructor(\n    /** the level of this */\n    readonly parentLevel: Level | null,\n    /** the environment tree nodes contained in this level */\n    readonly envTreeNodes: EnvTreeNode[]\n  ) {\n    super();\n    this._x = CompactConfig.CanvasPaddingX;\n    this._y = CompactConfig.CanvasPaddingY;\n    this.parentLevel && (this._y += this.parentLevel.height() + this.parentLevel.y());\n    let prevFrame: Frame | null = null;\n    envTreeNodes.forEach(e => {\n      e.compactLevel = this;\n      const newFrame = new Frame(e, prevFrame);\n      e.compactFrame = newFrame;\n      this.frames.push(newFrame);\n      prevFrame = newFrame;\n    });\n\n    // get the max height of all the frames in this level\n    this._height = this.frames.reduce<number>(\n      (maxHeight, frame) => Math.max(maxHeight, frame.totalHeight),\n      0\n    );\n    const lastFrame = this.frames[this.frames.length - 1];\n    // derive the width of this level from the last frame\n    this._width = lastFrame.x() + lastFrame.totalWidth - this.x() + CompactConfig.LevelPaddingX;\n  }\n\n  destroy() {\n    this.ref.current.destroyChildren();\n  }\n\n  draw(): React.ReactNode {\n    return (\n      <Group key={Layout.key++} ref={this.ref}>\n        <Rect\n          {...ShapeDefaultProps}\n          x={this.x()}\n          y={this.y()}\n          width={this.width()}\n          height={this.height()}\n          key={Layout.key++}\n          listening={false}\n        />\n        {this.frames.map(frame => frame.draw())}\n      </Group>\n    );\n  }\n}\n","import { Button, ButtonGroup, Checkbox } from '@blueprintjs/core';\nimport { Frame } from 'c-slang/dist/types';\nimport React, { RefObject } from 'react';\nimport { Layer, Rect, Stage } from 'react-konva';\n\nimport { Level as CompactLevel } from './compactComponents/Level';\nimport { ArrayValue as CompactArrayValue } from './compactComponents/values/ArrayValue';\nimport { FnValue as CompactFnValue } from './compactComponents/values/FnValue';\nimport { GlobalFnValue as CompactGlobalFnValue } from './compactComponents/values/GlobalFnValue';\nimport { PrimitiveValue as CompactPrimitiveValue } from './compactComponents/values/PrimitiveValue';\nimport { UnassignedValue as CompactUnassignedValue } from './compactComponents/values/UnassignedValue';\nimport { Value as CompactValue } from './compactComponents/values/Value';\nimport { Grid } from './components/Grid';\nimport { ArrayValue } from './components/values/ArrayValue';\nimport { FnValue } from './components/values/FnValue';\nimport { GlobalFnValue } from './components/values/GlobalFnValue';\nimport { PrimitiveValue } from './components/values/PrimitiveValue';\nimport { UnassignedValue } from './components/values/UnassignedValue';\nimport { Value } from './components/values/Value';\nimport EnvVisualizer from './EnvVisualizer';\nimport { Config, ShapeDefaultProps } from './EnvVisualizerConfig';\nimport {\n  CompactReferenceType,\n  Data,\n  EnvTree,\n  EnvTreeNode,\n  ReferenceType\n} from './EnvVisualizerTypes';\nimport {\n  deepCopyTree,\n  getNextChildren,\n  isArray,\n  isDummyKey,\n  isFn,\n  isFunction,\n  isGlobalFn,\n  isPrimitiveData,\n  isUnassigned\n} from './EnvVisualizerUtils';\n\n/** this class encapsulates the logic for calculating the layout */\nexport class Layout {\n  /** the height of the stage */\n  static nonCompactHeight: number;\n  /** the width of the non-compact stage */\n  static nonCompactWidth: number;\n  /** the width of the compact stage */\n  static compactWidth: number;\n  /** the height of the compact stage */\n  static compactHeight: number;\n  /** the visible height of the stage */\n  static visibleHeight: number = window.innerHeight;\n  /** the visible width of the stage */\n  static visibleWidth: number = window.innerWidth;\n  /** total height of stage */\n  static stageHeight: number = window.innerHeight;\n  /** total width of stage */\n  static stageWidth: number = window.innerWidth;\n  /** the unique key assigned to each node */\n  static key: number = 0;\n\n  /** the environment tree */\n  static environmentTree: EnvTree;\n  /** the global environment */\n  static globalEnvNode: EnvTreeNode;\n  /** grid of frames */\n  static grid: Grid;\n  static compactLevels: CompactLevel[] = [];\n\n  /** memoized values */\n  static values = new Map<Data, Value>();\n  static compactValues = new Map<Data, CompactValue>();\n  /** memoized layout */\n  static prevLayout: React.ReactNode;\n  static currentDark: React.ReactNode;\n  static currentLight: React.ReactNode;\n  static currentCompactDark: React.ReactNode;\n  static currentCompactLight: React.ReactNode;\n  static stageRef: RefObject<any> = React.createRef();\n  // buffer for faster rendering of diagram when scrolling\n  static invisiblePaddingVertical: number = 300;\n  static invisiblePaddingHorizontal: number = 300;\n  static scrollContainerRef: RefObject<any> = React.createRef();\n\n  static updateDimensions(width: number, height: number) {\n    // update the size of the scroll container and stage given the width and height of the sidebar content.\n    Layout.visibleWidth = width;\n    Layout.visibleHeight = height;\n    if (\n      Layout.stageRef.current !== null &&\n      (Math.min(Layout.width(), window.innerWidth) > Layout.stageWidth ||\n        Math.min(Layout.height(), window.innerHeight) > Layout.stageHeight)\n    ) {\n      Layout.currentLight = undefined;\n      Layout.currentDark = undefined;\n      Layout.currentCompactLight = undefined;\n      Layout.currentCompactDark = undefined;\n      Layout.stageWidth = Math.min(Layout.width(), window.innerWidth);\n      Layout.stageHeight = Math.min(Layout.height(), window.innerHeight);\n      Layout.stageRef.current.width(Layout.stageWidth);\n      Layout.stageRef.current.height(Layout.stageHeight);\n      EnvVisualizer.redraw();\n    }\n    if (Layout.stageHeight > Layout.visibleHeight) {\n    }\n    Layout.invisiblePaddingVertical =\n      Layout.stageHeight > Layout.visibleHeight\n        ? (Layout.stageHeight - Layout.visibleHeight) / 2\n        : 0;\n    Layout.invisiblePaddingHorizontal =\n      Layout.stageWidth > Layout.visibleWidth ? (Layout.stageWidth - Layout.visibleWidth) / 2 : 0;\n\n    const container: HTMLElement | null = this.scrollContainerRef.current as HTMLDivElement;\n    if (container) {\n      container.style.width = `${Layout.visibleWidth}px`;\n      container.style.height = `${Layout.visibleHeight}px`;\n    }\n  }\n\n  /** processes the runtime context from JS Slang */\n  static setContext(envTree: EnvTree): void {\n    Layout.currentLight = undefined;\n    Layout.currentDark = undefined;\n    Layout.currentCompactLight = undefined;\n    Layout.currentCompactDark = undefined;\n    // clear/initialize data and value arrays\n    Layout.values.forEach((v, d) => {\n      v.reset();\n    });\n    Layout.values.clear();\n    Layout.compactValues.forEach((v, d) => {\n      v.reset();\n    });\n    Layout.compactValues.clear();\n    Layout.key = 0;\n    // deep copy so we don't mutate the context\n    Layout.environmentTree = deepCopyTree(envTree);\n    Layout.globalEnvNode = Layout.environmentTree.root;\n\n    // remove program environment and merge bindings into global env\n    Layout.removeProgramEnv();\n    // remove global functions that are not referenced in the program\n    Layout.removeUnreferencedGlobalFns();\n    // initialize levels and frames\n    Layout.initializeGrid();\n\n    // calculate height and width by considering lowest and widest level\n    if (EnvVisualizer.getCompactLayout()) {\n      const lastLevel = Layout.compactLevels[Layout.compactLevels.length - 1];\n      Layout.compactHeight = Math.max(\n        Config.CanvasMinHeight,\n        lastLevel.y() + lastLevel.height() + Config.CanvasPaddingY\n      );\n\n      Layout.compactWidth = Math.max(\n        Config.CanvasMinWidth,\n        Layout.compactLevels.reduce<number>(\n          (maxWidth, level) => Math.max(maxWidth, level.width()),\n          0\n        ) +\n          Config.CanvasPaddingX * 2\n      );\n    } else {\n      Layout.nonCompactHeight = Math.max(\n        Config.CanvasMinHeight,\n        this.grid.height() + Config.CanvasPaddingY\n      );\n      Layout.nonCompactWidth = Math.max(\n        Config.CanvasMinWidth,\n        this.grid.width() + Config.CanvasPaddingX * 2\n      );\n    }\n  }\n\n  /** remove program environment containing predefined functions */\n  private static removeProgramEnv() {\n    if (!Layout.globalEnvNode.children) return;\n\n    const programEnvNode = Layout.globalEnvNode.children[0];\n    const globalEnvNode = Layout.globalEnvNode;\n\n    // merge programEnvNode bindings into globalEnvNode\n    globalEnvNode.environment.head = {\n      ...programEnvNode.environment.head,\n      ...globalEnvNode.environment.head\n    };\n\n    // update globalEnvNode children\n    if (programEnvNode.children) {\n      globalEnvNode.resetChildren(programEnvNode.children);\n    }\n\n    // go through new bindings and update functions to be global functions\n    // by removing extra props such as functionName\n    for (const value of Object.values(globalEnvNode.environment.head)) {\n      if (isFn(value)) {\n        delete (value as { functionName?: string }).functionName;\n      }\n    }\n  }\n\n  /** remove any global functions not referenced elsewhere in the program */\n  private static removeUnreferencedGlobalFns(): void {\n    const referencedGlobalFns = new Set<() => any>();\n    const visitedData = new Set<Data[]>();\n    const findGlobalFnReferences = (envNode: EnvTreeNode): void => {\n      for (const data of Object.values(envNode.environment.head)) {\n        if (isGlobalFn(data)) {\n          referencedGlobalFns.add(data);\n        } else if (isArray(data)) {\n          findGlobalFnReferencesInData(data);\n        }\n      }\n      if (envNode.children) {\n        envNode.children.forEach(findGlobalFnReferences);\n      }\n    };\n\n    const findGlobalFnReferencesInData = (data: Data[]): void => {\n      data.forEach(d => {\n        if (isGlobalFn(d)) {\n          referencedGlobalFns.add(d);\n        } else if (isArray(d) && !visitedData.has(d)) {\n          visitedData.add(d);\n          findGlobalFnReferencesInData(d);\n        }\n      });\n    };\n\n    if (Layout.globalEnvNode.children) {\n      Layout.globalEnvNode.children.forEach(findGlobalFnReferences);\n    }\n\n    const newFrame: Frame = {};\n    for (const [key, data] of Object.entries(Layout.globalEnvNode.environment.head)) {\n      if (referencedGlobalFns.has(data) || isDummyKey(key)) {\n        newFrame[key] = data;\n      }\n    }\n\n    Layout.globalEnvNode.environment.head = {\n      [Config.GlobalFrameDefaultText]: Symbol(),\n      ...newFrame\n    };\n  }\n\n  public static width(): number {\n    return EnvVisualizer.getCompactLayout() ? Layout.compactWidth : Layout.nonCompactWidth;\n  }\n\n  public static height(): number {\n    return EnvVisualizer.getCompactLayout() ? Layout.compactHeight : Layout.nonCompactHeight;\n  }\n\n  /** initializes grid */\n  private static initializeGrid(): void {\n    if (EnvVisualizer.getCompactLayout()) {\n      this.compactLevels = [];\n      let frontier: EnvTreeNode[] = [Layout.globalEnvNode];\n      let prevLevel: CompactLevel | null = null;\n      let currLevel: CompactLevel;\n\n      while (frontier.length > 0) {\n        currLevel = new CompactLevel(prevLevel, frontier);\n        this.compactLevels.push(currLevel);\n        const nextFrontier: EnvTreeNode[] = [];\n\n        frontier.forEach(e => {\n          e.children.forEach(c => {\n            const nextChildren = getNextChildren(c as EnvTreeNode);\n            nextChildren.forEach(c => (c.parent = e));\n            nextFrontier.push(...nextChildren);\n          });\n        });\n\n        prevLevel = currLevel;\n        frontier = nextFrontier;\n      }\n    } else {\n      const frontiers: EnvTreeNode[][] = [];\n      let frontier = [Layout.globalEnvNode];\n\n      while (frontier.length > 0) {\n        frontiers.push(frontier);\n\n        const nextFrontier: EnvTreeNode[] = [];\n\n        frontier.forEach(e => {\n          e.children.forEach(c => {\n            const nextChildren = getNextChildren(c as EnvTreeNode);\n            nextChildren.forEach(c => (c.parent = e));\n            nextFrontier.push(...nextChildren);\n          });\n        });\n\n        frontier = nextFrontier;\n      }\n      if (this.grid === undefined) {\n        this.grid = new Grid(frontiers);\n      } else {\n        this.grid.update(frontiers);\n      }\n    }\n  }\n\n  /** memoize `Value` (used to detect circular references in non-primitive `Value`) */\n  static memoizeValue(value: Value): void {\n    Layout.values.set(value.data, value);\n  }\n\n  /** create an instance of the corresponding `Value` if it doesn't already exists,\n   *  else, return the existing value */\n  static createValue(data: Data, reference: ReferenceType): Value {\n    if (isUnassigned(data)) {\n      return new UnassignedValue([reference]);\n    } else if (isPrimitiveData(data)) {\n      return new PrimitiveValue(data, [reference]);\n    } else {\n      // try to find if this value is already created\n      const existingValue = Layout.values.get(data);\n      if (existingValue) {\n        existingValue.addReference(reference);\n        return existingValue;\n      }\n\n      // else create a new one\n      let newValue: Value = new PrimitiveValue(null, [reference]);\n      if (isArray(data)) {\n        newValue = new ArrayValue(data, [reference]);\n      } else if (isFunction(data)) {\n        if (isFn(data)) {\n          // normal JS Slang function\n          newValue = new FnValue(data, [reference]);\n        } else {\n          // function from the global env (has no extra props such as env, fnName)\n          newValue = new GlobalFnValue(data, [reference]);\n        }\n      }\n\n      return newValue;\n    }\n  }\n\n  /** memoize `Value` (used to detect circular references in non-primitive `Value`) */\n  static memoizeCompactValue(value: CompactValue): void {\n    Layout.compactValues.set(value.data, value);\n  }\n\n  /** create an instance of the corresponding `Value` if it doesn't already exists,\n   *  else, return the existing value */\n  static createCompactValue(data: Data, reference: CompactReferenceType): CompactValue {\n    if (isUnassigned(data)) {\n      return new CompactUnassignedValue([reference]);\n    } else if (isPrimitiveData(data)) {\n      return new CompactPrimitiveValue(data, [reference]);\n    } else {\n      // try to find if this value is already created\n      const existingValue = Layout.compactValues.get(data);\n      if (existingValue) {\n        existingValue.addReference(reference);\n        return existingValue;\n      }\n\n      // else create a new one\n      let newValue: CompactValue = new CompactPrimitiveValue(null, [reference]);\n      if (isArray(data)) {\n        newValue = new CompactArrayValue(data, [reference]);\n      } else if (isFunction(data)) {\n        if (isFn(data)) {\n          // normal JS Slang function\n          newValue = new CompactFnValue(data, [reference]);\n        } else {\n          // function from the global env (has no extra props such as env, fnName)\n          newValue = new CompactGlobalFnValue(data, [reference]);\n        }\n      }\n\n      return newValue;\n    }\n  }\n\n  /**\n   * Scrolls diagram to top left, and saves the diagram as multiple images of width < MaxExportWidth.\n   */\n  static exportImage = () => {\n    const container: HTMLElement | null = this.scrollContainerRef.current as HTMLDivElement;\n    container.scrollTo({ left: 0, top: 0 });\n    Layout.handleScrollPosition(0, 0);\n    const height = Layout.height();\n    const width = Layout.width();\n    const horizontalImages = Math.ceil(width / Config.MaxExportWidth);\n    const verticalImages = Math.ceil(height / Config.MaxExportHeight);\n    const download_images = () => {\n      const download_next = (n: number) => {\n        if (n >= horizontalImages * verticalImages) {\n          return;\n        }\n        const x = n % horizontalImages;\n        const y = Math.floor(n / horizontalImages);\n        const a = document.createElement('a');\n        a.style.display = 'none';\n        a.href = this.stageRef.current.toDataURL({\n          x: x * Config.MaxExportWidth + Layout.invisiblePaddingHorizontal,\n          y: y * Config.MaxExportHeight + Layout.invisiblePaddingVertical,\n          width: Math.min(width - x * Config.MaxExportWidth, Config.MaxExportWidth),\n          height: Math.min(height - y * Config.MaxExportHeight, Config.MaxExportHeight),\n          mimeType: 'image/jpeg'\n        });\n\n        a.download = `diagram_${x}_${y}.jpg`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        setTimeout(function () {\n          download_next(n + 1);\n        }, 1000);\n      };\n      // Initiate the first download.\n      download_next(0);\n    };\n    download_images();\n  };\n\n  /** Calculate the test to be displayed for button to save the images.*/\n  private static saveButtonText(): String {\n    return `Save ${\n      Layout.width() > Config.MaxExportWidth || Layout.height() > Config.MaxExportHeight\n        ? Math.ceil(Layout.width() / Config.MaxExportWidth) *\n            Math.ceil(Layout.height() / Config.MaxExportHeight) +\n          ' images'\n        : 'image'\n    }`;\n  }\n\n  /**\n   * Calculates the required transformation for the stage given the scroll-container div scroll position.\n   * @param x x position of the scroll container\n   * @param y y position of the scroll container\n   */\n  private static handleScrollPosition(x: number, y: number) {\n    const dx = x - Layout.invisiblePaddingHorizontal;\n    const dy = y - Layout.invisiblePaddingVertical;\n    this.stageRef.current.container().style.transform = 'translate(' + dx + 'px, ' + dy + 'px)';\n    this.stageRef.current.x(-dx);\n    this.stageRef.current.y(-dy);\n  }\n\n  static draw(): React.ReactNode {\n    if (Layout.key !== 0) {\n      return Layout.prevLayout;\n    } else {\n      const layout = (\n        <div className={'sa-env-visualizer'}>\n          <div\n            id=\"scroll-container\"\n            ref={Layout.scrollContainerRef}\n            onScroll={e =>\n              Layout.handleScrollPosition(e.currentTarget.scrollLeft, e.currentTarget.scrollTop)\n            }\n            style={{\n              width: Layout.visibleWidth,\n              height: Layout.visibleHeight,\n              overflow: 'auto',\n              margin: '10px'\n            }}\n          >\n            <div\n              id=\"large-container\"\n              style={{\n                width: Layout.width(),\n                height: Layout.height(),\n                overflow: 'hidden',\n                backgroundColor: EnvVisualizer.getPrintableMode()\n                  ? Config.PRINT_BACKGROUND.toString()\n                  : Config.SA_BLUE.toString()\n              }}\n            >\n              <div style={{ right: 40, position: 'absolute', display: 'flex', alignSelf: 'right' }}>\n                <ButtonGroup vertical>\n                  <Button\n                    large={true}\n                    outlined={true}\n                    style={{\n                      backgroundColor: EnvVisualizer.getPrintableMode()\n                        ? Config.PRINT_BACKGROUND.toString()\n                        : Config.SA_BLUE.toString(),\n                      opacity: 0.8,\n                      borderColor: EnvVisualizer.getPrintableMode()\n                        ? Config.SA_BLUE.toString()\n                        : Config.PRINT_BACKGROUND.toString()\n                    }}\n                    onMouseUp={() => {\n                      EnvVisualizer.toggleCompactLayout();\n                      EnvVisualizer.redraw();\n                    }}\n                  >\n                    <Checkbox\n                      checked={!EnvVisualizer.getCompactLayout()}\n                      label=\"Experimental\"\n                      style={{\n                        marginBottom: '0px',\n                        color: EnvVisualizer.getPrintableMode()\n                          ? Config.SA_BLUE.toString()\n                          : Config.PRINT_BACKGROUND.toString()\n                      }}\n                    />\n                  </Button>\n                  <Button\n                    large={true}\n                    outlined={true}\n                    style={{\n                      backgroundColor: EnvVisualizer.getPrintableMode()\n                        ? Config.PRINT_BACKGROUND.toString()\n                        : Config.SA_BLUE.toString(),\n                      opacity: 0.8,\n                      borderColor: EnvVisualizer.getPrintableMode()\n                        ? Config.SA_BLUE.toString()\n                        : Config.PRINT_BACKGROUND.toString()\n                    }}\n                    onMouseUp={() => {\n                      EnvVisualizer.togglePrintableMode();\n                      EnvVisualizer.redraw();\n                    }}\n                  >\n                    <Checkbox\n                      checked={EnvVisualizer.getPrintableMode()}\n                      label=\"Printable\"\n                      style={{\n                        marginBottom: '0px',\n                        color: EnvVisualizer.getPrintableMode()\n                          ? Config.SA_BLUE.toString()\n                          : Config.PRINT_BACKGROUND.toString()\n                      }}\n                    />\n                  </Button>\n                  <Button\n                    outlined={true}\n                    text={Layout.saveButtonText()}\n                    large={true}\n                    onClick={this.exportImage}\n                    style={{\n                      color: EnvVisualizer.getPrintableMode()\n                        ? Config.SA_BLUE.toString()\n                        : Config.PRINT_BACKGROUND.toString(),\n                      backgroundColor: EnvVisualizer.getPrintableMode()\n                        ? Config.PRINT_BACKGROUND.toString()\n                        : Config.SA_BLUE.toString(),\n                      opacity: 0.8,\n                      borderColor: EnvVisualizer.getPrintableMode()\n                        ? Config.SA_BLUE.toString()\n                        : Config.PRINT_BACKGROUND.toString()\n                    }}\n                  />\n                </ButtonGroup>\n              </div>\n              <Stage width={Layout.stageWidth} height={Layout.stageHeight} ref={this.stageRef}>\n                <Layer>\n                  <Rect\n                    {...ShapeDefaultProps}\n                    x={0}\n                    y={0}\n                    width={Layout.width()}\n                    height={Layout.height()}\n                    fill={\n                      EnvVisualizer.getPrintableMode()\n                        ? Config.PRINT_BACKGROUND.toString()\n                        : Config.SA_BLUE.toString()\n                    }\n                    key={Layout.key++}\n                    listening={false}\n                  />\n                  {!EnvVisualizer.getCompactLayout() && Layout.grid.draw()}\n                  {EnvVisualizer.getCompactLayout() &&\n                    Layout.compactLevels.map(level => level.draw())}\n                </Layer>\n              </Stage>\n            </div>\n          </div>\n        </div>\n      );\n      Layout.prevLayout = layout;\n      if (EnvVisualizer.getCompactLayout()) {\n        if (EnvVisualizer.getPrintableMode()) {\n          Layout.currentCompactLight = layout;\n        } else {\n          Layout.currentCompactDark = layout;\n        }\n      } else {\n        if (EnvVisualizer.getPrintableMode()) {\n          Layout.currentLight = layout;\n        } else {\n          Layout.currentDark = layout;\n        }\n      }\n\n      return layout;\n    }\n  }\n}\n","import { Context } from 'c-slang';\nimport React from 'react';\n\nimport { Layout } from './EnvVisualizerLayout';\nimport { EnvTree } from './EnvVisualizerTypes';\nimport { deepCopyTree } from './EnvVisualizerUtils';\n\ntype SetVis = (vis: React.ReactNode) => void;\n\n/** Environment Visualizer is exposed from this class */\nexport default class EnvVisualizer {\n  /** callback function to update the visualization state in the SideContentEnvVis component */\n  private static setVis: SetVis;\n  private static printableMode: boolean = false;\n  private static compactLayout: boolean = true;\n  private static environmentTree: EnvTree;\n  public static togglePrintableMode(): void {\n    EnvVisualizer.printableMode = !EnvVisualizer.printableMode;\n  }\n  public static toggleCompactLayout(): void {\n    EnvVisualizer.compactLayout = !EnvVisualizer.compactLayout;\n  }\n  public static getPrintableMode(): boolean {\n    return EnvVisualizer.printableMode;\n  }\n  public static getCompactLayout(): boolean {\n    return EnvVisualizer.compactLayout;\n  }\n\n  /** SideContentEnvVis initializes this onMount with the callback function */\n  static init(setVis: SetVis, width: number, height: number) {\n    Layout.visibleHeight = height;\n    Layout.visibleWidth = width;\n    this.setVis = setVis;\n  }\n\n  static clear() {\n    Layout.values.clear();\n    Layout.compactValues.clear();\n  }\n\n  /** updates the visualization state in the SideContentEnvVis component based on\n   * the JS Slang context passed in */\n  static drawEnv(context: Context) {\n    // store environmentTree at last breakpoint.\n    EnvVisualizer.environmentTree = deepCopyTree(context.runtime.environmentTree as EnvTree);\n    if (!this.setVis) throw new Error('env visualizer not initialized');\n\n    Layout.setContext(context.runtime.environmentTree as EnvTree);\n    this.setVis(Layout.draw());\n    Layout.updateDimensions(Layout.visibleWidth, Layout.visibleHeight);\n\n    // icon to blink\n    const icon = document.getElementById('env_visualizer-icon');\n    icon && icon.classList.add('side-content-tab-alert');\n  }\n\n  static redraw() {\n    if (this.environmentTree) {\n      // checks if the required diagram exists, and updates the dom node using setVis\n      if (\n        EnvVisualizer.getCompactLayout() &&\n        EnvVisualizer.getPrintableMode() &&\n        Layout.currentCompactLight !== undefined\n      ) {\n        this.setVis(Layout.currentCompactLight);\n      } else if (\n        EnvVisualizer.getCompactLayout() &&\n        !EnvVisualizer.getPrintableMode() &&\n        Layout.currentCompactDark !== undefined\n      ) {\n        this.setVis(Layout.currentCompactDark);\n      } else if (\n        !EnvVisualizer.getCompactLayout() &&\n        EnvVisualizer.getPrintableMode() &&\n        Layout.currentLight !== undefined\n      ) {\n        this.setVis(Layout.currentLight);\n      } else if (\n        !EnvVisualizer.getCompactLayout() &&\n        !EnvVisualizer.getPrintableMode() &&\n        Layout.currentDark !== undefined\n      ) {\n        this.setVis(Layout.currentDark);\n      } else {\n        Layout.setContext(EnvVisualizer.environmentTree);\n        this.setVis(Layout.draw());\n      }\n      Layout.updateDimensions(Layout.visibleWidth, Layout.visibleHeight);\n    }\n  }\n\n  static updateDimensions(width: number, height: number) {\n    if (Layout.stageRef != null && width !== null && height !== null) {\n      Layout.updateDimensions(width, height);\n    }\n  }\n}\n","import { Chapter, Variant } from 'c-slang/dist/types';\nimport moment, { Moment } from 'moment';\n\nfunction isTrue(value?: string, defaultTo?: boolean): boolean {\n  return typeof value === 'undefined' && typeof defaultTo !== 'undefined'\n    ? defaultTo\n    : typeof value === 'string' && value.toUpperCase() === 'TRUE';\n}\n\nconst isTest = process.env.NODE_ENV === 'test';\n\nconst sourceAcademyVersion = process.env.REACT_APP_VERSION || 'local';\nconst sourceAcademyEnvironment = process.env.REACT_APP_ENVIRONMENT || 'dev';\nconst sourceAcademyDeploymentName = process.env.REACT_APP_DEPLOYMENT_NAME || 'Source Academy';\nconst showResearchPrompt = isTest || isTrue(process.env.REACT_APP_SHOW_RESEARCH_PROMPT);\nconst backendUrl = process.env.REACT_APP_BACKEND_URL;\nconst cadetLoggerUrl = isTest ? undefined : process.env.REACT_APP_CADET_LOGGER;\nconst cadetLoggerInterval = parseInt(process.env.REACT_APP_CADET_LOGGER_INTERVAL || '10000', 10);\nconst useBackend = !isTest && isTrue(process.env.REACT_APP_USE_BACKEND);\nconst defaultSourceChapter = Chapter.CALC;\nconst defaultSourceVariant = Variant.DEFAULT;\nconst defaultQuestionId = 0;\nconst maxBrowseIndex = 50;\nconst mobileBreakpoint = 768;\nconst urlShortenerBase = process.env.REACT_APP_URL_SHORTENER_BASE;\nconst urlShortenerSignature = process.env.REACT_APP_URL_SHORTENER_SIGNATURE;\nconst moduleBackendUrl = process.env.REACT_APP_MODULE_BACKEND_URL || 'modules';\nconst sharedbBackendUrl = process.env.REACT_APP_SHAREDB_BACKEND_URL || '';\nconst playgroundOnly = !isTest && isTrue(process.env.REACT_APP_PLAYGROUND_ONLY, true);\nconst enableGitHubAssessments = isTest || isTrue(process.env.REACT_APP_ENABLE_GITHUB_ASSESSMENTS);\nconst sentryDsn = process.env.REACT_APP_SENTRY_DSN;\nconst googleClientId = process.env.REACT_APP_GOOGLE_CLIENT_ID;\nconst googleApiKey = process.env.REACT_APP_GOOGLE_API_KEY;\nconst googleAppId = process.env.REACT_APP_GOOGLE_APP_ID;\nconst githubClientId = process.env.REACT_APP_GITHUB_CLIENT_ID || '';\nconst githubOAuthProxyUrl = process.env.REACT_APP_GITHUB_OAUTH_PROXY_URL || '';\nconst sicpBackendUrl =\n  process.env.REACT_APP_SICPJS_BACKEND_URL || 'https://sicp.sourceacademy.org/';\nconst workspaceSettingsLocalStorageKey = 'workspace-settings';\n\n// For achievements feature (CA - Continual Assessment)\n// TODO: remove dependency of the ca levels on the env file\nconst caFulfillmentLevel = isTest\n  ? 24\n  : parseInt(process.env.REACT_APP_CA_FULFILLMENT_LEVEL || '0');\n\nconst authProviders: Map<string, { name: string; endpoint: string; isDefault: boolean }> =\n  new Map();\n\nfor (let i = 1; ; ++i) {\n  const id = process.env[`REACT_APP_OAUTH2_PROVIDER${i}`];\n  if (!id) {\n    break;\n  }\n\n  const name = process.env[`REACT_APP_OAUTH2_PROVIDER${i}_NAME`] || 'Unnamed provider';\n  const endpoint = process.env[`REACT_APP_OAUTH2_PROVIDER${i}_ENDPOINT`] || '';\n\n  authProviders.set(id, { name, endpoint, isDefault: i === 1 });\n}\n\nconst disablePeriods: Array<{ start: Moment; end: Moment; reason?: string }> = [];\n\nif (!isTest) {\n  for (let i = 1; ; ++i) {\n    const startStr = process.env[`REACT_APP_DISABLE${i}_START`];\n    const endStr = process.env[`REACT_APP_DISABLE${i}_END`];\n    if (!startStr || !endStr) {\n      break;\n    }\n    const reason = process.env[`REACT_APP_DISABLE${i}_REASON`];\n    const start = moment(startStr);\n    const end = moment(endStr);\n    if (end.isBefore(start) || moment().isAfter(end)) {\n      continue;\n    }\n    disablePeriods.push({ start, end, reason });\n  }\n}\n\nexport enum Links {\n  githubIssues = 'https://github.com/source-academy/frontend/issues',\n  githubOrg = 'https://github.com/source-academy',\n  about = 'https://about.sourceacademy.org',\n\n  moduleDetails = 'https://www.comp.nus.edu.sg/~cs1101s',\n  luminus = 'https://luminus.nus.edu.sg/modules/41d42e9a-5880-43b5-8ee6-75f5a41355e3/announcements/active',\n  piazza = 'https://piazza.com/class/kas136yscf8605',\n\n  resourcesForEducators = 'https://about.sourceacademy.org/educator/README.html',\n  resourcesForLearners = 'https://about.sourceacademy.org/learner/README.html',\n\n  sourceAcademyAssets = 'https://source-academy-assets.s3-ap-southeast-1.amazonaws.com/',\n  sourceDocs = 'https://docs.sourceacademy.org/',\n  techSVC = 'mailto:techsvc@comp.nus.edu.sg',\n  techSVCNumber = '6516 2736',\n  textbook = 'https://sourceacademy.org/sicpjs/',\n  playground = 'https://sourceacademy.org/playground',\n  textbookChapter2_2 = 'https://sourceacademy.org/sicpjs/2.2',\n  textbookChapter3_2 = 'https://sourceacademy.org/sicpjs/3.2',\n  aceHotkeys = 'https://github.com/ajaxorg/ace/wiki/Default-Keyboard-Shortcuts',\n  sourceHotkeys = 'https://github.com/source-academy/frontend/wiki/Source-Academy-Keyboard-Shortcuts',\n\n  source_1 = 'https://docs.sourceacademy.org/source_1/',\n  source_1_Lazy = 'https://docs.sourceacademy.org/source_1_lazy/',\n  source_1_Wasm = 'https://docs.sourceacademy.org/source_1_wasm/',\n  source_2 = 'https://docs.sourceacademy.org/source_2/',\n  source_2_Lazy = 'https://docs.sourceacademy.org/source_2_lazy/',\n  source_3 = 'https://docs.sourceacademy.org/source_3/',\n  source_3_Concurrent = 'https://docs.sourceacademy.org/source_3_concurrent/',\n  source_3_Nondet = 'https://docs.sourceacademy.org/source_3_non-det/',\n  source_4 = 'https://docs.sourceacademy.org/source_4/',\n  source_4_Gpu = 'https://docs.sourceacademy.org/source_4_gpu/',\n  ecmaScript_2021 = 'https://262.ecma-international.org/12.0/'\n}\n\nconst Constants = {\n  sourceAcademyVersion,\n  sourceAcademyEnvironment,\n  sourceAcademyDeploymentName,\n  showResearchPrompt,\n  backendUrl,\n  cadetLoggerUrl,\n  useBackend,\n  defaultSourceChapter,\n  defaultSourceVariant,\n  defaultQuestionId,\n  maxBrowseIndex,\n  mobileBreakpoint,\n  urlShortenerBase,\n  urlShortenerSignature,\n  moduleBackendUrl,\n  authProviders,\n  playgroundOnly,\n  enableGitHubAssessments,\n  sentryDsn,\n  googleClientId,\n  googleApiKey,\n  googleAppId,\n  githubClientId,\n  githubOAuthProxyUrl,\n  sharedbBackendUrl,\n  disablePeriods,\n  cadetLoggerInterval,\n  sicpBackendUrl,\n  workspaceSettingsLocalStorageKey,\n  caFulfillmentLevel\n};\n\nexport default Constants;\n","import { action } from 'typesafe-actions';\n\nimport {\n  CHANGE_DATE_ASSESSMENT,\n  DELETE_ASSESSMENT,\n  PUBLISH_ASSESSMENT,\n  UPLOAD_ASSESSMENT\n} from './GroundControlTypes';\n\nexport const changeDateAssessment = (id: number, openAt: string, closeAt: string) =>\n  action(CHANGE_DATE_ASSESSMENT, { id, openAt, closeAt });\n\nexport const deleteAssessment = (id: number) => action(DELETE_ASSESSMENT, id);\n\nexport const publishAssessment = (togglePublishTo: boolean, id: number) =>\n  action(PUBLISH_ASSESSMENT, { id, togglePublishTo });\n\nexport const uploadAssessment = (file: File, forceUpdate: boolean, assessmentConfigId: number) =>\n  action(UPLOAD_ASSESSMENT, { file, forceUpdate, assessmentConfigId });\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport { DebuggerContext, WorkspaceLocation } from '../workspace/WorkspaceTypes';\nimport { ModuleSideContent, SideContentTab, SideContentType } from './SideContentTypes';\n\nconst currentlyActiveTabsLabel: Map<WorkspaceLocation, string[]> = new Map<\n  WorkspaceLocation,\n  string[]\n>();\n\n/**\n * Returns an array of SideContentTabs to be spawned\n * @param debuggerContext - DebuggerContext object from redux store\n */\nexport const getDynamicTabs = (debuggerContext: DebuggerContext): SideContentTab[] => {\n  const tabsToSpawn = getModuleTabs(debuggerContext).filter(tab => tab.toSpawn(debuggerContext));\n  // Convert ModuleSideContent to SideContentTab.\n  const spawnedTabs: SideContentTab[] = [\n    ...tabsToSpawn.map(tab => ({\n      ...tab,\n      body: tab.body(debuggerContext),\n      // set tab.id as module\n      id: SideContentType.module\n    }))\n  ];\n  // only set if debuggerContext.workspaceLocation is not undefined\n  if (debuggerContext.workspaceLocation) {\n    currentlyActiveTabsLabel.set(\n      debuggerContext.workspaceLocation,\n      spawnedTabs.map(tab => tab.label)\n    );\n  }\n  return spawnedTabs;\n};\n\n/**\n * Extracts included Modules' side contents from DebuggerContext.\n * @param debuggerContext - DebuggerContext object from redux store\n */\nexport const getModuleTabs = (debuggerContext: DebuggerContext): ModuleSideContent[] => {\n  // Check if c-slang's context object is null\n  if (debuggerContext.context == null) {\n    return [];\n  }\n\n  // Get module contexts\n  const rawModuleContexts = debuggerContext.context.moduleContexts;\n  if (rawModuleContexts == null) {\n    return [];\n  }\n\n  // Pass React into functions\n  const moduleTabs: ModuleSideContent[] = Object.values(rawModuleContexts).flatMap(\n    context => context.tabs?.map((tab: any) => tab(React, ReactDOM)) ?? []\n  );\n\n  return moduleTabs;\n};\n","import { TabId } from '@blueprintjs/core';\nimport React from 'react';\n\nimport { useTypedSelector } from '../utils/Hooks';\nimport { DebuggerContext, WorkspaceLocation } from '../workspace/WorkspaceTypes';\nimport { getDynamicTabs } from './SideContentHelper';\nimport { SideContentTab, SideContentType } from './SideContentTypes';\n\n/**\n * Generates an icon id given a TabId.\n * Used to set and remove the 'side-content-tab-alert' style to the tabs.\n */\nexport const generateIconId = (tabId: TabId) => `${tabId}-icon`;\n\n/**\n * @property onChange A function that is called whenever the\n * active tab is changed by the user.\n *\n * @property tabs An array of SideContentTabs.\n *  The tabs will be rendered in order of the array.\n *  If this array is empty, no tabs will be rendered.\n */\nexport type GenericSideContentProps = DispatchProps &\n  StateProps & {\n    renderFunction: (\n      dynamicTabs: SideContentTab[],\n      changeTabsCallback: (\n        newTabId: SideContentType,\n        prevTabId: SideContentType,\n        event: React.MouseEvent<HTMLElement>\n      ) => void\n    ) => React.ReactElement;\n  };\n\ntype DispatchProps = {\n  // Optional due to uncontrolled tab component in EditingWorkspace\n  onChange?: (\n    newTabId: SideContentType,\n    prevTabId: SideContentType,\n    event: React.MouseEvent<HTMLElement>\n  ) => void;\n};\n\ntype StateProps = {\n  tabs: {\n    beforeDynamicTabs: SideContentTab[];\n    afterDynamicTabs: SideContentTab[];\n  };\n  workspaceLocation?: WorkspaceLocation;\n};\n\nconst GenericSideContent = (props: GenericSideContentProps) => {\n  const { tabs, onChange } = props;\n  const [dynamicTabs, setDynamicTabs] = React.useState(\n    tabs.beforeDynamicTabs.concat(tabs.afterDynamicTabs)\n  );\n\n  // Fetch debuggerContext from store\n  const debuggerContext = useTypedSelector(\n    state => props.workspaceLocation && state.workspaces[props.workspaceLocation].debuggerContext\n  );\n  React.useEffect(() => {\n    const allActiveTabs = tabs.beforeDynamicTabs\n      .concat(getDynamicTabs(debuggerContext || ({} as DebuggerContext)))\n      .concat(tabs.afterDynamicTabs);\n    setDynamicTabs(allActiveTabs);\n  }, [tabs, debuggerContext]);\n\n  const changeTabsCallback = React.useCallback(\n    (\n      newTabId: SideContentType,\n      prevTabId: SideContentType,\n      event: React.MouseEvent<HTMLElement>\n    ): void => {\n      /**\n       * Remove the 'side-content-tab-alert' class that causes tabs flash.\n       * To be run when tabs are changed.\n       * Currently this style is only used for the \"Env Visualizer\" tab.\n       */\n      const resetAlert = (prevTabId: TabId) => {\n        const iconId = generateIconId(prevTabId);\n        const icon = document.getElementById(iconId);\n\n        // The new selected tab will still have the \"side-content-tab-alert\" class, but the CSS hides it\n        if (icon) {\n          icon.classList.remove('side-content-tab-alert');\n        }\n      };\n\n      if (onChange === undefined) {\n        resetAlert(prevTabId);\n      } else {\n        onChange(newTabId, prevTabId, event);\n        resetAlert(prevTabId);\n      }\n    },\n    [onChange]\n  );\n\n  return props.renderFunction(dynamicTabs, changeTabsCallback);\n};\n\nexport default GenericSideContent;\n","import { SourceError, Variant } from 'c-slang/dist/types';\n\nimport { ExternalLibrary, ExternalLibraryName } from '../application/types/ExternalTypes';\n\nexport const FETCH_ASSESSMENT_OVERVIEWS = 'FETCH_ASSESSMENT_OVERVIEWS';\nexport const SUBMIT_ASSESSMENT = 'SUBMIT_ASSESSMENT';\n\nexport enum AssessmentStatuses {\n  attempting = 'attempting',\n  attempted = 'attempted',\n  not_attempted = 'not_attempted',\n  submitted = 'submitted'\n}\nexport type AssessmentStatus = keyof typeof AssessmentStatuses;\n\nexport type AssessmentWorkspaceParams = {\n  assessmentId?: string;\n  questionId?: string;\n};\n\nexport enum GradingStatuses {\n  excluded = 'excluded',\n  graded = 'graded',\n  grading = 'grading',\n  none = 'none'\n}\nexport type GradingStatus = keyof typeof GradingStatuses;\n\nexport type AssessmentType = string;\n\nexport enum TestcaseTypes {\n  // These are rendered in full by the Mission Autograder\n  public = 'public',\n  // These are rendered with a placeholder by the Autograder\n  opaque = 'opaque',\n  // These should only exist in the grading workspace for submissions\n  secret = 'secret'\n}\nexport type TestcaseType = keyof typeof TestcaseTypes;\n\nexport enum QuestionTypes {\n  programming = 'programming',\n  mcq = 'mcq',\n  voting = 'voting'\n}\nexport type QuestionType = keyof typeof QuestionTypes;\n\n/*\nW* Used to display information regarding an assessment in the UI.\n*\n * @property closeAt an ISO 8601 compliant date string specifiying when\n *   the assessment closes\n * @property openAt an ISO 8601 compliant date string specifiying when\n *   the assessment opens\n */\nexport type AssessmentOverview = {\n  type: AssessmentType;\n  isManuallyGraded: boolean;\n  closeAt: string;\n  coverImage: string;\n  fileName?: string; // For mission control\n  gradingStatus: GradingStatus;\n  id: number;\n  isPublished?: boolean;\n  maxXp: number;\n  number?: string; // For mission control\n  openAt: string;\n  private?: boolean;\n  reading?: string; // For mission control\n  shortSummary: string;\n  status: AssessmentStatus;\n  story: string | null;\n  title: string;\n  xp: number;\n};\n\n/*\n * Used when an assessment is being actively attempted/graded.\n */\nexport type Assessment = {\n  type: AssessmentType;\n  globalDeployment?: Library; // For mission control\n  graderDeployment?: Library; // For mission control\n  id: number;\n  longSummary: string;\n  missionPDF: string;\n  title: string;\n  questions: Question[];\n};\n\nexport type AssessmentConfiguration = {\n  assessmentConfigId: number;\n  type: AssessmentType;\n  isManuallyGraded: boolean;\n  displayInDashboard: boolean;\n  hoursBeforeEarlyXpDecay: number;\n  earlySubmissionXp: number;\n};\n\nexport interface IProgrammingQuestion extends BaseQuestion {\n  answer: string | null;\n  autogradingResults: AutogradingResult[];\n  graderTemplate?: string;\n  prepend: string;\n  postpend: string;\n  solutionTemplate: string;\n  testcases: Testcase[];\n  testcasesPrivate?: Testcase[]; // For mission control\n  type: 'programming';\n}\n\nexport interface IMCQQuestion extends BaseQuestion {\n  answer: number | null;\n  choices: MCQChoice[];\n  solution?: number;\n  type: 'mcq';\n}\n\nexport interface IContestVotingQuestion extends BaseQuestion {\n  answer: ContestEntry[];\n  prepend: string;\n  postpend: string;\n  contestEntries: ContestEntry[];\n  contestLeaderboard: ContestEntry[];\n  type: 'voting';\n}\n\nexport type BaseQuestion = {\n  answer: string | number | ContestEntry[] | null;\n  comments?: string;\n  content: string;\n  editorValue?: string;\n  gradedAt?: string;\n  grader?: {\n    name: string;\n    id: number;\n  };\n  graderLibrary?: Library; // For mission control\n  id: number;\n  library: Library;\n  maxXp: number;\n  type: QuestionType;\n  xp: number;\n  blocking?: boolean; // Determines whether the learner can progress to the next question without passing local testcases\n  // TODO: The blocking field is made optional now as the Question type is being shared with GitHub Assessments, which has not implemented\n  // the question-level blocking feature. Is to be made compulsory after this is implemented in GitHub Assessments\n};\n\nexport type Question = IProgrammingQuestion | IMCQQuestion | IContestVotingQuestion;\n\nexport type Library = {\n  variant?: Variant;\n  execTimeMs?: number;\n  external: ExternalLibrary;\n  globals: Array<{\n    0: string;\n    1: any;\n    2?: string; // For mission control\n  }>;\n  moduleParams?: any;\n};\n\nexport type Testcase = {\n  answer: string; // the correct answer to the testcase\n  errors?: SourceError[]; // errors raised by interpreter during execution\n  program: string; // the program to be appended to the student's code\n  result?: any; // the result from the execution of the testcase\n  score: number;\n  type: TestcaseType;\n};\n\nexport type ContestEntry = {\n  submission_id: number;\n  answer: ContestEntryCodeAnswer; //contest entry program to be input into editor\n  score?: number;\n  final_score?: number;\n  student_name?: string;\n};\n\nexport type ContestEntryCodeAnswer = {\n  code: string;\n};\n\nexport type MCQChoice = {\n  content: string;\n  hint: string | null;\n};\n\nexport type AutogradingResult = {\n  resultType: string;\n  expected?: string; // the correct answer for the testcase\n  actual?: string; // the received answer from the student's code\n  errors?: AutogradingError[];\n};\n\nexport type AutogradingError = {\n  errorType: string;\n  line?: number;\n  location?: string;\n  errorLine?: string;\n  errorExplanation?: string;\n  errorMessage?: string;\n};\n\nexport const emptyLibrary = (): Library => {\n  return {\n    external: {\n      name: 'NONE' as ExternalLibraryName,\n      symbols: []\n    },\n    globals: []\n  };\n};\n\nexport const normalLibrary = (): Library => {\n  return {\n    external: {\n      name: 'NONE' as ExternalLibraryName,\n      symbols: []\n    },\n    globals: []\n  };\n};\n\nexport const overviewTemplate = (): AssessmentOverview => {\n  return {\n    type: 'Missions',\n    isManuallyGraded: true,\n    closeAt: '2100-12-01T00:00+08',\n    coverImage: 'https://fakeimg.pl/300/',\n    id: -1,\n    maxXp: 0,\n    openAt: '2000-01-01T00:00+08',\n    title: 'Insert title here',\n    reading: '',\n    shortSummary: 'Insert short summary here',\n    status: AssessmentStatuses.not_attempted,\n    story: 'mission',\n    xp: 0,\n    gradingStatus: 'none'\n  };\n};\n\nexport const programmingTemplate = (): IProgrammingQuestion => {\n  return {\n    autogradingResults: [],\n    answer: '// [Marking Scheme]\\n// 1 mark for correct answer',\n    content: 'Enter content here',\n    id: 0,\n    library: emptyLibrary(),\n    graderLibrary: emptyLibrary(),\n    prepend: '',\n    solutionTemplate: '//This is a mock solution template',\n    postpend: '',\n    testcases: [],\n    testcasesPrivate: [],\n    type: 'programming',\n    xp: 0,\n    maxXp: 0,\n    blocking: false\n  };\n};\n\nexport const testcaseTemplate = (): Testcase => {\n  return {\n    type: TestcaseTypes.public,\n    answer: '',\n    score: 0,\n    program: ''\n  };\n};\n\nexport const mcqTemplate = (): IMCQQuestion => {\n  return {\n    answer: 3,\n    content: 'This is a mock MCQ question',\n    choices: [\n      {\n        content: 'A',\n        hint: null\n      },\n      {\n        content: 'B',\n        hint: null\n      },\n      {\n        content: 'C',\n        hint: null\n      },\n      {\n        content: 'D',\n        hint: null\n      }\n    ],\n    id: 2,\n    library: emptyLibrary(),\n    graderLibrary: emptyLibrary(),\n    type: 'mcq',\n    solution: 0,\n    xp: 0,\n    maxXp: 0,\n    blocking: false\n  };\n};\n\nexport const assessmentTemplate = (): Assessment => {\n  return {\n    type: 'Missions',\n    globalDeployment: normalLibrary(),\n    graderDeployment: emptyLibrary(),\n    id: -1,\n    longSummary: 'Insert mission briefing here',\n    missionPDF: 'www.google.com',\n    questions: [programmingTemplate()],\n    title: 'Insert title here'\n  };\n};\n","import { UpdateCourseConfiguration } from 'src/commons/application/types/SessionTypes';\nimport { UsernameRoleGroup } from 'src/pages/academy/adminPanel/subcomponents/AddUserPanel';\nimport { action } from 'typesafe-actions';\n\nimport { ADD_NEW_USERS_TO_COURSE, CREATE_COURSE, SAVE_CANVAS } from './AcademyTypes';\n\nexport const saveCanvas = (canvas: HTMLCanvasElement) => action(SAVE_CANVAS, canvas);\n\nexport const createCourse = (courseConfig: UpdateCourseConfiguration) =>\n  action(CREATE_COURSE, courseConfig);\n\nexport const addNewUsersToCourse = (users: UsernameRoleGroup[], provider: string) =>\n  action(ADD_NEW_USERS_TO_COURSE, { users, provider });\n","export default __webpack_public_path__ + \"static/media/default_cover_image.e2be0724.jpg\";","import { IconNames } from '@blueprintjs/icons';\nimport React from 'react';\n\nimport ControlButton from '../ControlButton';\n\ntype ControlBarResetButtonProps = {\n  onClick?(): any;\n};\n\nexport const ControlBarResetButton: React.FC<ControlBarResetButtonProps> = ({ onClick }) => {\n  return <ControlButton label=\"Reset\" icon={IconNames.REPEAT} onClick={onClick} />;\n};\n","import { Intent } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport React from 'react';\n\nimport ControlButton from '../ControlButton';\n\ntype ControlBarSaveButtonProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  onClickSave?(): any;\n};\n\ntype StateProps = {\n  key: string;\n  hasUnsavedChanges?: boolean;\n};\n\nexport const ControlButtonSaveButton: React.FC<ControlBarSaveButtonProps> = props => {\n  const saveButtonOpts = props.hasUnsavedChanges ? { intent: Intent.WARNING, minimal: false } : {};\n\n  return (\n    <ControlButton\n      label=\"Save\"\n      icon={IconNames.FLOPPY_DISK}\n      onClick={props.onClickSave}\n      options={saveButtonOpts}\n    />\n  );\n};\n","import { action } from 'typesafe-actions';\n\nimport { WorkspaceLocation } from '../../../commons/workspace/WorkspaceTypes';\nimport { SourcecastData } from '../SourceRecorderTypes';\nimport { FETCH_SOURCECAST_INDEX, UPDATE_SOURCECAST_INDEX } from './SourcecastTypes';\n\nexport const fetchSourcecastIndex = (workspaceLocation: WorkspaceLocation) =>\n  action(FETCH_SOURCECAST_INDEX, {\n    workspaceLocation\n  });\n\nexport const updateSourcecastIndex = (\n  index: SourcecastData[],\n  workspaceLocation: WorkspaceLocation\n) =>\n  action(UPDATE_SOURCECAST_INDEX, {\n    index,\n    workspaceLocation\n  });\n","/**\n * Represents the config used to draw the drawings.\n */\nexport const Config = {\n  StrokeWidth: 2,\n  Stroke: 'white',\n  Fill: 'white',\n\n  BoxWidth: 45,\n  BoxMinWidth: 15, // Set to half of BoxHeight for empty arrays following EnvVisualizerConfig\n  BoxHeight: 30,\n  BoxSpacingX: 50,\n  BoxSpacingY: 60,\n\n  DistanceX: 45 / 2, // Half of box width\n  DistanceY: 60,\n  CircleRadiusLarge: 15,\n  CircleRadiusSmall: 4,\n\n  ArrowPointerOffsetHorizontal: 13, // Pixels to offset the arrow head by\n  ArrowPointerOffsetVertical: -5, // Pixels to offset the arrow head by\n  ArrowPointerSize: 5,\n  ArrowMarginTop: 15,\n  ArrowMarginBottom: 15,\n  ArrowMarginHorizontal: 15,\n\n  MaxTextLength: 20\n};\n","// list.js: Supporting lists in the Scheme style, using pairs made\n//          up of two-element JavaScript array (vector)\n\n// Author: Martin Henz\n\n// Note: this library is used in the externalLibs of the frontend.\n// It is distinct from the LISTS library of Source 2, which contains\n// primitive and predeclared functions from Chapter 2 of SICP JS.\n\n// 'use strict'\n// array test works differently for Rhino and\n// the Firefox environment (especially Web Console)\nexport function array_test(x) {\n  if (Array.isArray === undefined) {\n    return x instanceof Array;\n  } else {\n    return Array.isArray(x);\n  }\n}\n\n// pair constructs a pair using a two-element array\n// LOW-LEVEL FUNCTION, NOT SOURCE\nexport function pair(x, xs) {\n  return [x, xs];\n}\n\n// is_pair returns true iff arg is a two-element array\n// LOW-LEVEL FUNCTION, NOT SOURCE\nexport function is_pair(x) {\n  return array_test(x) && x.length === 2;\n}\n\n// head returns the first component of the given pair,\n// throws an exception if the argument is not a pair\n// LOW-LEVEL FUNCTION, NOT SOURCE\nexport function head(xs) {\n  if (is_pair(xs)) {\n    return xs[0];\n  } else {\n    throw new Error('head(xs) expects a pair as argument xs, but encountered ' + xs);\n  }\n}\n\n// tail returns the second component of the given pair\n// throws an exception if the argument is not a pair\n// LOW-LEVEL FUNCTION, NOT SOURCE\nexport function tail(xs) {\n  if (is_pair(xs)) {\n    return xs[1];\n  } else {\n    throw new Error('tail(xs) expects a pair as argument xs, but encountered ' + xs);\n  }\n}\n\n// is_null returns true if arg is exactly null\n// LOW-LEVEL FUNCTION, NOT SOURCE\nexport function is_null(xs) {\n  return xs === null;\n}\n\n// is_list recurses down the list and checks that it ends with the empty list []\n// does not throw Value exceptions\n// LOW-LEVEL FUNCTION, NOT SOURCE\nexport function is_list(xs) {\n  for (; ; xs = tail(xs)) {\n    if (is_null(xs)) {\n      return true;\n    } else if (!is_pair(xs)) {\n      return false;\n    }\n  }\n}\n\n// list makes a list out of its arguments\n// LOW-LEVEL FUNCTION, NOT SOURCE\nexport function list() {\n  let the_list = null;\n  for (let i = arguments.length - 1; i >= 0; i--) {\n    the_list = pair(arguments[i], the_list);\n  }\n  return the_list;\n}\n\n// list_to_vector returns vector that contains the elements of the argument list\n// in the given order.\n// list_to_vector throws an exception if the argument is not a list\n// LOW-LEVEL FUNCTION, NOT SOURCE\nexport function list_to_vector(lst) {\n  const vector = [];\n  while (!is_null(lst)) {\n    vector.push(head(lst));\n    lst = tail(lst);\n  }\n  return vector;\n}\n\n// vector_to_list returns a list that contains the elements of the argument vector\n// in the given order.\n// vector_to_list throws an exception if the argument is not a vector\n// LOW-LEVEL FUNCTION, NOT SOURCE\nexport function vector_to_list(vector) {\n  let result = null;\n  for (let i = vector.length - 1; i >= 0; i = i - 1) {\n    result = pair(vector[i], result);\n  }\n  return result;\n}\n\n// returns the length of a given argument list\n// throws an exception if the argument is not a list\nexport function length(xs) {\n  let i = 0;\n  while (!is_null(xs)) {\n    i += 1;\n    xs = tail(xs);\n  }\n  return i;\n}\n\n// map applies first arg f to the elements of the second argument,\n// assumed to be a list.\n// f is applied element-by-element:\n// map(f,[1,[2,[]]]) results in [f(1),[f(2),[]]]\n// map throws an exception if the second argument is not a list,\n// and if the second argument is a non-empty list and the first\n// argument is not a function.\n// tslint:disable-next-line:ban-types\nexport function map(f, xs) {\n  return is_null(xs) ? null : pair(f(head(xs)), map(f, tail(xs)));\n}\n\n// build_list takes a non-negative integer n as first argument,\n// and a function fun as second argument.\n// build_list returns a list of n elements, that results from\n// applying fun to the numbers from 0 to n-1.\n// tslint:disable-next-line:ban-types\nexport function build_list(n, fun) {\n  if (typeof n !== 'number' || n < 0 || Math.floor(n) !== n) {\n    throw new Error(\n      'build_list(n, fun) expects a positive integer as argument n, but encountered ' + n\n    );\n  }\n\n  // tslint:disable-next-line:ban-types\n  function build(i, alreadyBuilt) {\n    if (i < 0) {\n      return alreadyBuilt;\n    } else {\n      return build(i - 1, pair(fun(i), alreadyBuilt));\n    }\n  }\n\n  return build(n - 1, null);\n}\n\n// for_each applies first arg fun to the elements of the list passed as\n// second argument. fun is applied element-by-element:\n// for_each(fun,[1,[2,[]]]) results in the calls fun(1) and fun(2).\n// for_each returns true.\n// for_each throws an exception if the second argument is not a list,\n// and if the second argument is a non-empty list and the\n// first argument is not a function.\n// tslint:disable-next-line:ban-types\nexport function for_each(fun, xs) {\n  if (!is_list(xs)) {\n    throw new Error('for_each expects a list as argument xs, but encountered ' + xs);\n  }\n  for (; !is_null(xs); xs = tail(xs)) {\n    fun(head(xs));\n  }\n  return true;\n}\n\n// reverse reverses the argument list\n// reverse throws an exception if the argument is not a list.\nexport function reverse(xs) {\n  if (!is_list(xs)) {\n    throw new Error('reverse(xs) expects a list as argument xs, but encountered ' + xs);\n  }\n  let result = null;\n  for (; !is_null(xs); xs = tail(xs)) {\n    result = pair(head(xs), result);\n  }\n  return result;\n}\n\n// append first argument list and second argument list.\n// In the result, the [] at the end of the first argument list\n// is replaced by the second argument list\n// append throws an exception if the first argument is not a list\nexport function append(xs, ys) {\n  if (is_null(xs)) {\n    return ys;\n  } else {\n    return pair(head(xs), append(tail(xs), ys));\n  }\n}\n\n// member looks for a given first-argument element in a given\n// second argument list. It returns the first postfix sublist\n// that starts with the given element. It returns [] if the\n// element does not occur in the list\nexport function member(v, xs) {\n  for (; !is_null(xs); xs = tail(xs)) {\n    if (head(xs) === v) {\n      return xs;\n    }\n  }\n  return null;\n}\n\n// removes the first occurrence of a given first-argument element\n// in a given second-argument list. Returns the original list\n// if there is no occurrence.\nexport function remove(v, xs) {\n  if (is_null(xs)) {\n    return null;\n  } else {\n    if (v === head(xs)) {\n      return tail(xs);\n    } else {\n      return pair(head(xs), remove(v, tail(xs)));\n    }\n  }\n}\n\n// Similar to remove. But removes all instances of v instead of just the first\nexport function remove_all(v, xs) {\n  if (is_null(xs)) {\n    return null;\n  } else {\n    if (v === head(xs)) {\n      return remove_all(v, tail(xs));\n    } else {\n      return pair(head(xs), remove_all(v, tail(xs)));\n    }\n  }\n}\n\n// for backwards-compatibility\n// equal computes the structural equality\n// over its arguments\nexport function equal(item1, item2) {\n  if (is_pair(item1) && is_pair(item2)) {\n    return equal(head(item1), head(item2)) && equal(tail(item1), tail(item2));\n  } else {\n    return item1 === item2;\n  }\n}\n\n// assoc treats the second argument as an association,\n// a list of (index,value) pairs.\n// assoc returns the first (index,value) pair whose\n// index equal (using structural equality) to the given\n// first argument v. Returns false if there is no such\n// pair\nexport function assoc(v, xs) {\n  if (is_null(xs)) {\n    return false;\n  } else if (equal(v, head(head(xs)))) {\n    return head(xs);\n  } else {\n    return assoc(v, tail(xs));\n  }\n}\n\n// filter returns the sublist of elements of given list xs\n// for which the given predicate function returns true.\n// tslint:disable-next-line:ban-types\nexport function filter(pred, xs) {\n  if (is_null(xs)) {\n    return xs;\n  } else {\n    if (pred(head(xs))) {\n      return pair(head(xs), filter(pred, tail(xs)));\n    } else {\n      return filter(pred, tail(xs));\n    }\n  }\n}\n\n// enumerates numbers starting from start,\n// using a step size of 1, until the number\n// exceeds end.\nexport function enum_list(start, end) {\n  if (typeof start !== 'number') {\n    throw new Error(\n      'enum_list(start, end) expects a number as argument start, but encountered ' + start\n    );\n  }\n  if (typeof end !== 'number') {\n    throw new Error(\n      'enum_list(start, end) expects a number as argument start, but encountered ' + end\n    );\n  }\n  if (start > end) {\n    return null;\n  } else {\n    return pair(start, enum_list(start + 1, end));\n  }\n}\n\n// Returns the item in list lst at index n (the first item is at position 0)\nexport function list_ref(xs, n) {\n  if (typeof n !== 'number' || n < 0 || Math.floor(n) !== n) {\n    throw new Error(\n      'list_ref(xs, n) expects a positive integer as argument n, but encountered ' + n\n    );\n  }\n  for (; n > 0; --n) {\n    xs = tail(xs);\n  }\n  return head(xs);\n}\n\n// accumulate applies given operation op to elements of a list\n// in a right-to-left order, first apply op to the last element\n// and an initial element, resulting in r1, then to the\n// second-last element and r1, resulting in r2, etc, and finally\n// to the first element and r_n-1, where n is the length of the\n// list.\n// accumulate(op,zero,list(1,2,3)) results in\n// op(1, op(2, op(3, zero)))\nexport function accumulate(op, initial, sequence) {\n  if (is_null(sequence)) {\n    return initial;\n  } else {\n    return op(head(sequence), accumulate(op, initial, tail(sequence)));\n  }\n}\n\n// set_head(xs,x) changes the head of given pair xs to be x,\n// throws an exception if the argument is not a pair\n// LOW-LEVEL FUNCTION, NOT SOURCE\nexport function set_head(xs, x) {\n  if (is_pair(xs)) {\n    xs[0] = x;\n    return undefined;\n  } else {\n    throw new Error('set_head(xs,x) expects a pair as argument xs, but encountered ' + xs);\n  }\n}\n\n// set_tail(xs,x) changes the tail of given pair xs to be x,\n// throws an exception if the argument is not a pair\n// LOW-LEVEL FUNCTION, NOT SOURCE\nexport function set_tail(xs, x) {\n  if (is_pair(xs)) {\n    xs[1] = x;\n    return undefined;\n  } else {\n    throw new Error('set_tail(xs,x) expects a pair as argument xs, but encountered ' + xs);\n  }\n}\n","import { Config } from './Config';\nimport { Data, EmptyList, List, Pair } from './dataVisualizerTypes';\nimport { is_list, is_pair } from './list';\n\n/**\n *  Returns data in text form, fitted into the box.\n *  If not possible to fit data, return undefined. A number will be assigned and logged in the console.\n */\nexport function toText(data: Data, full: boolean = false): string | undefined {\n  if (full) {\n    return '' + data;\n  } else {\n    const type = typeof data;\n    if ((type === 'function' || type === 'object') && data !== null) {\n      return undefined;\n    } else if (type === 'string') {\n      const dataString = data + '';\n      const str = dataString.substring(0, Config.MaxTextLength);\n      return `\"${str}${dataString.length > Config.MaxTextLength ? '...' : ''}\"`;\n    } else {\n      return `${data}`;\n    }\n  }\n}\n\nexport function isArray(data: Data): data is Array<Data> {\n  return Array.isArray(data);\n}\n\nexport function isFunction(data: Data): data is Function {\n  return typeof data === 'function';\n}\n\nexport function isPair(data: Data): data is Pair {\n  return is_pair(data);\n}\n\nexport function isList(data: Data): data is List {\n  return is_list(data);\n}\n\nexport function isEmptyList(data: Data): data is EmptyList {\n  return data === null;\n}\n\nexport { head, tail } from './list';\n","import React from 'react';\nimport { Arrow } from 'react-konva';\n\nimport { Config } from '../Config';\n\ntype ArrowConfig = { from: { x: number; y: number }; to: { x: number; y: number } };\n\n/**\n * Represents an arrow used to connect a parent node and a child node.\n *\n * Used with ArrayDrawable and FunctionDrawable.\n */\nexport class ArrowDrawable extends React.PureComponent<ArrowConfig> {\n  render() {\n    return (\n      <Arrow\n        key={this.props + ''}\n        points={[\n          this.props.from.x,\n          this.props.from.y,\n          this.props.to.x + Config.ArrowPointerOffsetHorizontal,\n          this.props.to.y + Config.ArrowPointerOffsetVertical\n        ]}\n        pointerWidth={Config.ArrowPointerSize}\n        pointerLength={Config.ArrowPointerSize}\n        fill={Config.Fill}\n        stroke={Config.Stroke}\n        strokeWidth={Config.StrokeWidth}\n        preventDefault={false}\n      ></Arrow>\n    );\n  }\n}\n","import { PureComponent } from 'react';\nimport { Arrow } from 'react-konva';\n\nimport { Config } from '../Config';\n\ntype ArrowConfig = { from: { x: number; y: number }; to: { x: number; y: number } };\n\n/**\n * Represents an arrow used to connect a parent node and a child node that has been drawn before,\n * that is positioned to the top left of the parent node.\n *\n */\nexport class BackwardArrowDrawable extends PureComponent<ArrowConfig> {\n  /**\n   *  Connects a box to a previously known box, the arrow path is more complicated.\n   *\n   *  After coming out of the starting box, it moves to the left,\n   *  Then goes to the correct y-value and turns to reach the top of the end box.\n   *  It then directly points to the end box. All turnings are 90 degress.\n   *\n   *        \n   *       \n   *  \n   */\n  render() {\n    // The starting coordinate is the centre of the starting box\n    // The ending coordinate is along the top edge of the ending box, and Config.ArrowSpaceHorizontal pixels from the left edge\n    const bottomY = this.props.from.y + Config.BoxHeight / 2 + Config.ArrowMarginBottom;\n\n    // The x coordinate of the left most part of the backward arrow\n    const leftX = this.props.to.x - Config.ArrowMarginHorizontal;\n\n    // The y coordinate of the top most part of the backward arrow\n    const topY = this.props.to.y - Config.ArrowMarginTop;\n\n    const path = [\n      this.props.from.x,\n      this.props.from.y,\n      this.props.from.x,\n      bottomY,\n      leftX,\n      bottomY,\n      leftX,\n      topY,\n      this.props.to.x + Config.ArrowPointerOffsetHorizontal,\n      topY,\n      this.props.to.x + Config.ArrowPointerOffsetHorizontal,\n      this.props.to.y + Config.ArrowPointerOffsetVertical\n    ];\n    return (\n      <Arrow\n        points={path}\n        pointerLength={Config.ArrowPointerSize}\n        pointerWidth={Config.ArrowPointerSize}\n        fill={Config.Fill}\n        stroke={Config.Stroke}\n        strokeWidth={Config.StrokeWidth}\n        preventDefault={false}\n      ></Arrow>\n    );\n  }\n}\n","export class TreeNode {\n  public children: TreeNode[] | null;\n\n  constructor() {\n    this.children = null;\n  }\n}\n","import { TreeNode } from './BaseTreeNode';\nimport { DrawableTreeNode } from './DrawableTreeNode';\n\n/**\n * Represents a node that is already parsed earlier in the tree.\n */\nexport class AlreadyParsedTreeNode extends TreeNode {\n  public actualNode: DrawableTreeNode;\n\n  constructor(actualNode: DrawableTreeNode) {\n    super();\n    this.actualNode = actualNode;\n  }\n}\n","import { Data } from '../dataVisualizerTypes';\nimport { TreeNode } from './BaseTreeNode';\n\n/**\n * Represents node corresponding to a data object (neither pair nor function).\n */\nexport class DataTreeNode extends TreeNode {\n  public readonly data: Data;\n\n  constructor(data: Data) {\n    super();\n    this.data = data;\n  }\n}\n","import { TreeNode } from './BaseTreeNode';\n\n/**\n * Represents a node whose drawable should be cached.\n *\n * Concrete implementations: ArrayTreeNode, FunctionTreeNode\n */\nexport abstract class DrawableTreeNode extends TreeNode {\n  protected _drawable?: JSX.Element;\n  public drawableX?: number;\n  public drawableY?: number;\n\n  get drawable() {\n    return this._drawable;\n  }\n\n  /**\n   * Creates a Konva object representing the drawable. Should be called only once.\n   * Subsequent references of the drawable to be obtained using the drawable getter.\n   *\n   * @param x The x position of the drawable.\n   * @param y The y position of the drawable.\n   * @param parentX The x position of the parent.\n   * @param parentY The y position of the parent.\n   */\n  abstract createDrawable(x: number, y: number, parentX: number, parentY: number): JSX.Element;\n}\n","import React from 'react';\nimport { Line } from 'react-konva';\n\nimport { Config } from '../Config';\n\ntype NullProps = {\n  x: number;\n  y: number;\n};\n\n/**\n *  Represents the diagonal line drawn over the tail of a pair\n *  when the tail is an empty box.\n *\n *  Used in conjunction with ArrayDrawable.\n */\nexport class NullDrawable extends React.PureComponent<NullProps> {\n  render() {\n    return (\n      <Line\n        x={this.props.x}\n        y={this.props.y}\n        points={[0, Config.BoxHeight, Config.BoxWidth, 0]}\n        strokeWidth={Config.StrokeWidth - 1}\n        stroke={Config.Stroke}\n        preventDefault={false}\n      />\n    );\n  }\n}\n","import React from 'react';\nimport { Group, Line, Rect, Text } from 'react-konva';\n\nimport { Config } from '../Config';\nimport DataVisualizer from '../dataVisualizer';\nimport { isEmptyList, isList, toText } from '../dataVisualizerUtils';\nimport { DataTreeNode, TreeNode } from '../tree/TreeNode';\nimport { NullDrawable } from './NullDrawable';\n\ntype ArrayProps = {\n  nodes: TreeNode[];\n  x: number;\n  y: number;\n};\n\n/**\n *  Represents an array in a tree.\n */\nexport class ArrayDrawable extends React.PureComponent<ArrayProps> {\n  render() {\n    const createChildText = (node: DataTreeNode, index: number) => {\n      const nodeValue = node.data;\n      if (!isList(nodeValue)) {\n        const textValue: string | undefined = toText(nodeValue);\n        const textToDisplay = textValue ?? '*' + DataVisualizer.displaySpecialContent(node);\n        return (\n          <Text\n            key={'' + nodeValue + index}\n            text={textToDisplay}\n            align={'center'}\n            width={Config.BoxWidth}\n            x={Config.BoxWidth * index}\n            y={Math.floor((Config.BoxHeight - 1.2 * 12) / 2)}\n            fontStyle={textValue === undefined ? 'italic' : 'normal'}\n            fill={'white'}\n            preventDefault={false}\n          />\n        );\n      } else if (isEmptyList(nodeValue)) {\n        const props = {\n          x: index * Config.BoxWidth,\n          y: 0\n        };\n        return <NullDrawable key={index} {...props} />;\n      } else {\n        return null;\n      }\n    };\n\n    return (\n      <Group x={this.props.x} y={this.props.y}>\n        {/* Outer rectangle */}\n        <Rect\n          width={Math.max(Config.BoxWidth * this.props.nodes.length, Config.BoxMinWidth)}\n          height={Config.BoxHeight}\n          strokeWidth={Config.StrokeWidth}\n          stroke={Config.Stroke}\n          fill={'#17181A'}\n          preventDefault={false}\n        />\n        {/* Vertical lines in the box */}\n        {this.props.nodes.length > 1 &&\n          Array.from(Array(this.props.nodes.length - 1), (e, i) => {\n            return (\n              <Line\n                key={'line' + i}\n                points={[Config.BoxWidth * (i + 1), 0, Config.BoxWidth * (i + 1), Config.BoxHeight]}\n                strokeWidth={Config.StrokeWidth}\n                stroke={Config.Stroke}\n                preventDefault={false}\n              />\n            );\n          })}\n        {this.props.nodes.map(\n          (child, index) => child instanceof DataTreeNode && createChildText(child, index)\n        )}\n      </Group>\n    );\n  }\n}\n","import React from 'react';\nimport { Circle, Group } from 'react-konva';\n\nimport { Config } from '../Config';\n\ntype FunctionProps = {\n  x: number;\n  y: number;\n};\n\n/**\n * Represents a function object drawn using two circles.\n */\nexport class FunctionDrawable extends React.PureComponent<FunctionProps> {\n  render() {\n    return (\n      <Group {...this.props}>\n        {/* Left circle */}\n        <Circle\n          radius={Config.CircleRadiusLarge}\n          strokeWidth={Config.StrokeWidth}\n          stroke={Config.Stroke}\n          x={Config.CircleRadiusLarge}\n          y={Config.CircleRadiusLarge}\n          preventDefault={false}\n        />\n\n        {/* Right circle */}\n        <Circle\n          radius={Config.CircleRadiusLarge}\n          strokeWidth={Config.StrokeWidth}\n          stroke={Config.Stroke}\n          x={Config.CircleRadiusLarge * 3 + Config.StrokeWidth}\n          y={Config.CircleRadiusLarge}\n          preventDefault={false}\n        />\n\n        {/* Left dot */}\n        <Circle\n          radius={Config.CircleRadiusSmall}\n          strokeWidth={Config.StrokeWidth}\n          stroke={Config.Fill}\n          fill={Config.Fill}\n          x={Config.CircleRadiusLarge}\n          y={Config.CircleRadiusLarge}\n          preventDefault={false}\n        />\n\n        {/* Right dot */}\n        <Circle\n          radius={Config.CircleRadiusSmall}\n          strokeWidth={Config.StrokeWidth}\n          stroke={Config.Stroke}\n          fill={Config.Fill}\n          x={Config.CircleRadiusLarge * 3 + Config.StrokeWidth}\n          y={Config.CircleRadiusLarge}\n          preventDefault={false}\n        />\n      </Group>\n    );\n  }\n}\n","import { Group } from 'react-konva';\n\nimport { Config } from '../Config';\nimport { ArrowDrawable, FunctionDrawable } from '../drawable/Drawable';\nimport { DrawableTreeNode } from './DrawableTreeNode';\n\n/**\n * Represents a node corresponding to a Source (and Javascript) function.\n */\nexport class FunctionTreeNode extends DrawableTreeNode {\n  createDrawable(x: number, y: number, parentX: number, parentY: number): JSX.Element {\n    this._drawable = (\n      <Group key={x + ', ' + y}>\n        <FunctionDrawable {...{ x, y }}></FunctionDrawable>\n        {(parentX !== x || parentY !== y) && (\n          <ArrowDrawable\n            {...{\n              from: {\n                x: parentX + Config.BoxWidth / 2,\n                y: parentY + Config.BoxHeight / 2\n              },\n              to: {\n                x,\n                y\n              }\n            }}\n          ></ArrowDrawable>\n        )}\n      </Group>\n    );\n\n    this.drawableX = x;\n    this.drawableY = y;\n\n    return this._drawable;\n  }\n}\n","import { Group } from 'react-konva';\n\nimport { Config } from '../Config';\nimport { ArrayDrawable, ArrowDrawable } from '../drawable/Drawable';\nimport { DrawableTreeNode } from './DrawableTreeNode';\n\n/**\n * Represents a node corresponding to a Source pair or array.\n */\nexport class ArrayTreeNode extends DrawableTreeNode {\n  createDrawable(x: number, y: number, parentX: number, parentY: number): JSX.Element {\n    const arrayProps = { nodes: this.children ?? [], x, y };\n    const arrayDrawable = <ArrayDrawable {...arrayProps}></ArrayDrawable>;\n\n    this._drawable = (\n      <Group key={x + ', ' + y}>\n        {arrayDrawable}\n        {(parentX !== x || parentY !== y) && (\n          <ArrowDrawable\n            {...{\n              from: {\n                x: parentX + Config.BoxWidth / 2,\n                y: parentY + Config.BoxHeight / 2\n              },\n              to: {\n                x,\n                y\n              }\n            }}\n          ></ArrowDrawable>\n        )}\n      </Group>\n    );\n    this.drawableX = x;\n    this.drawableY = y;\n    return this._drawable;\n  }\n}\n","import Konva from 'konva';\nimport { Layer, Text } from 'react-konva';\n\nimport { Config } from '../Config';\nimport { Data, Pair } from '../dataVisualizerTypes';\nimport { isArray, isFunction, toText } from '../dataVisualizerUtils';\nimport { ArrowDrawable } from '../drawable/ArrowDrawable';\nimport { BackwardArrowDrawable } from '../drawable/BackwardArrowDrawable';\nimport { AlreadyParsedTreeNode } from './AlreadyParsedTreeNode';\nimport {\n  ArrayTreeNode,\n  DataTreeNode,\n  DrawableTreeNode,\n  FunctionTreeNode,\n  TreeNode\n} from './TreeNode';\n\n/**\n *  A tree object built based on the given Data, Function or Array of\n *  data/functions/arrays.\n */\nexport class Tree {\n  private _rootNode: TreeNode;\n  private nodes: DrawableTreeNode[];\n\n  /**\n   * Constructs a tree given a root node and a list of nodes.\n   * @param rootNode The root node of the tree.\n   * @param nodes The memoized nodes of the tree in list form.\n   */\n  constructor(rootNode: TreeNode, nodes: DrawableTreeNode[]) {\n    this._rootNode = rootNode;\n    this.nodes = nodes;\n  }\n\n  /**\n   * The root node of the tree.\n   */\n  get rootNode(): TreeNode {\n    return this._rootNode;\n  }\n\n  /**\n   * Returns the memoized node of the given id.\n   * @param id The id of the node.\n   */\n  getNodeById(id: number): DrawableTreeNode {\n    return this.nodes[id];\n  }\n\n  static fromSourceStructure(tree: Data): Tree {\n    let nodeCount = 0;\n\n    function constructNode(structure: Data): TreeNode {\n      const alreadyDrawnNode = visitedStructures.get(structure);\n      if (alreadyDrawnNode !== undefined) {\n        return new AlreadyParsedTreeNode(alreadyDrawnNode);\n      }\n      return isArray(structure)\n        ? constructTree(structure)\n        : isFunction(structure)\n        ? constructFunction(structure)\n        : constructData(structure);\n    }\n\n    /**\n     * Returns a node representing the given tree as a pair.\n     * Also memoizes the pair object, for the case where the\n     * pair appears multiple times in the data structure.\n     * @param tree The Source tree to construct a node for.\n     */\n    function constructTree(tree: Array<Data>) {\n      const node = new ArrayTreeNode();\n\n      visitedStructures.set(tree, node);\n      treeNodes[nodeCount] = node;\n      nodeCount++;\n\n      // Done like that instead of in constructor to prevent infinite recursion\n      node.children = tree.map(constructNode);\n\n      return node;\n    }\n\n    /**\n     * Returns a node representing the given function.\n     * Also memoizes the function object, for the case where the\n     * function appears multiple times in the data structure.\n     * @param func The function to construct a node for.\n     */\n    function constructFunction(func: Function) {\n      const node = new FunctionTreeNode();\n\n      // memoise current function\n      visitedStructures.set(func, node);\n      treeNodes[nodeCount] = node;\n      nodeCount++;\n\n      return node;\n    }\n\n    /**\n     * Returns a node representing the given data.\n     * Anything except functions and pairs are considered data, including empty lists.\n     * @param data The data to construct a node for.\n     */\n    function constructData(data: Data) {\n      return new DataTreeNode(data);\n    }\n\n    const visitedStructures: Map<Function | Pair | Array<Data>, DrawableTreeNode> = new Map(); // detects cycles\n    const treeNodes: DrawableTreeNode[] = [];\n    const rootNode = constructNode(tree);\n\n    return new Tree(rootNode, treeNodes);\n  }\n\n  draw(): TreeDrawer {\n    return new TreeDrawer(this);\n  }\n}\n\n/**\n *  Drawer function of a tree\n */\nclass TreeDrawer {\n  private tree: Tree;\n\n  private drawables: JSX.Element[];\n  private nodeWidths: Map<TreeNode, number>;\n  public width: number = 0;\n  public height: number = 0;\n\n  // Used to account for backward arrow\n  private minX = 0;\n  private minY = 0;\n\n  constructor(tree: Tree) {\n    this.tree = tree;\n    this.drawables = [];\n    this.nodeWidths = new Map();\n  }\n\n  /**\n   *  Draws a tree at x, y, by calling drawNode on the root at x, y.\n   */\n  draw(x: number, y: number): JSX.Element {\n    if (this.tree.rootNode instanceof DataTreeNode) {\n      const text = toText(this.tree.rootNode.data);\n      const textConfig = {\n        text: text,\n        align: 'center',\n        fontStyle: 'normal',\n        fontSize: 20,\n        fill: Config.Stroke\n      };\n      const konvaText = new Konva.Text(textConfig);\n      this.width = konvaText.width();\n      this.height = konvaText.height();\n      return (\n        <Layer>\n          <Text {...textConfig} />\n        </Layer>\n      );\n    } else {\n      this.drawNode(this.tree.rootNode, x, y, x, y);\n      this.width = this.getNodeWidth(this.tree.rootNode) - this.minX;\n      this.height = this.getNodeHeight(this.tree.rootNode) - this.minY + Config.StrokeWidth;\n      return (\n        <Layer key={x + ', ' + y} offsetX={this.minX} offsetY={this.minY}>\n          {this.drawables}\n        </Layer>\n      );\n    }\n  }\n\n  /**\n   *  Draws the box for the pair representing the tree, then recursively draws its children.\n   *  A slash is drawn for empty lists.\n   *\n   *  If a child node has been drawn previously, an arrow is drawn pointing to the children,\n   *  instead of drawing the child node again.\n   * @param node The node to draw.\n   * @param x The x position to draw at.\n   * @param y The y position to draw at.\n   * @param parentX The x position of the parent. If there is no parent, it is the same as x.\n   * @param parentY The y position of the parent. If there is no parent, it is the same as y.\n   */\n  drawNode(node: TreeNode, x: number, y: number, parentX: number, parentY: number) {\n    if (node instanceof AlreadyParsedTreeNode) {\n      // if its child is part of a cycle and it's been drawn, link back to that node instead\n      const drawnNode = node.actualNode;\n      const arrowProps = {\n        from: {\n          x: parentX + Config.BoxWidth / 2,\n          y: parentY + Config.BoxHeight / 2\n        },\n        to: {\n          x: drawnNode.drawableX!,\n          y: drawnNode.drawableY!\n        }\n      };\n\n      const isBackwardArrow = arrowProps.from.y >= arrowProps.to.y;\n\n      let arrow: JSX.Element;\n\n      if (isBackwardArrow) {\n        // Update the minX and minY, in case overflow to the top or left happens\n        this.minX = Math.min(\n          this.minX,\n          drawnNode.drawableX! - Config.ArrowMarginHorizontal - Config.StrokeWidth / 2\n        );\n        this.minY = Math.min(\n          this.minY,\n          drawnNode.drawableY! - Config.ArrowMarginTop - Config.StrokeWidth / 2\n        );\n        arrow = (\n          <BackwardArrowDrawable key={'Arrow (back)' + parentX + x + parentY + y} {...arrowProps} />\n        );\n      } else {\n        arrow = <ArrowDrawable key={'Arrow' + parentX + x + parentY + y} {...arrowProps} />;\n      }\n      this.drawables.push(arrow);\n    }\n\n    if (!(node instanceof DrawableTreeNode)) return;\n\n    // draws the content\n    if (node instanceof FunctionTreeNode) {\n      const drawable = node.createDrawable(x, y, parentX, parentY);\n      this.drawables.push(drawable);\n    } else if (node instanceof ArrayTreeNode) {\n      const drawable = node.createDrawable(x, y, parentX, parentY);\n      this.drawables.push(drawable);\n\n      // if it has children, draw them\n      // const width = this.getNodeWidth(node);\n      let leftX = x;\n      node.children?.forEach((childNode, index) => {\n        const childY = childNode instanceof AlreadyParsedTreeNode ? y : y + Config.DistanceY;\n        this.drawNode(childNode, leftX, childY, x + Config.BoxWidth * index, y);\n        const childNodeWidth = this.getNodeWidth(childNode);\n        leftX += childNodeWidth ? childNodeWidth + Config.DistanceX : 0;\n      });\n    }\n  }\n\n  /**\n   * Returns the width taken up by the node in pixels.\n   * @param node The node to calculate the width of.\n   */\n  getNodeWidth(node: TreeNode): number {\n    if (node instanceof DataTreeNode || node instanceof AlreadyParsedTreeNode) {\n      return 0;\n    } else if (node instanceof FunctionTreeNode) {\n      return Config.CircleRadiusLarge * 4 + 2 * Config.StrokeWidth;\n    } else if (node instanceof ArrayTreeNode) {\n      if (this.nodeWidths.has(node)) {\n        return this.nodeWidths.get(node) ?? 0;\n      } else if (node.children != null) {\n        const childrenWidths = node.children\n          .map(node => this.getNodeWidth(node))\n          .filter(x => x > 0);\n        const childrenWidth =\n          childrenWidths.length > 0 ? childrenWidths.reduce((x, y) => x + y + Config.DistanceX) : 0;\n        const nodeWidth = Math.max(\n          node.children.length * Config.BoxWidth + Config.StrokeWidth,\n          childrenWidth,\n          Config.BoxMinWidth + Config.StrokeWidth\n        );\n        this.nodeWidths.set(node, nodeWidth);\n        return nodeWidth;\n      } else {\n        return 0;\n      }\n    } else {\n      return 0;\n    }\n  }\n\n  /**\n   * Returns the height taken up by the node in pixels.\n   * @param node The node to calculate the width of.\n   */\n  getNodeHeight(node: TreeNode): number {\n    if (node instanceof DataTreeNode) {\n      return 0;\n    } else if (node instanceof FunctionTreeNode) {\n      return Config.BoxHeight;\n    } else if (node instanceof AlreadyParsedTreeNode) {\n      return Config.ArrowMarginBottom;\n    } else if (node instanceof ArrayTreeNode) {\n      // Height of array node is BoxHeight + StrokeWidth / 2 + max(childrenHeights)\n      return (\n        (node.children ?? [])\n          .map(child => {\n            const childHeight = this.getNodeHeight(child);\n            return childHeight + (child instanceof DrawableTreeNode ? Config.DistanceY / 2 : 0);\n          })\n          .filter(height => height > 0)\n          .reduce((x, y) => Math.max(x, y), 0) + Config.BoxHeight\n      );\n    } else {\n      return 0;\n    }\n  }\n}\n","import { Stage } from 'react-konva';\n\nimport { Config } from './Config';\nimport { Data, Step } from './dataVisualizerTypes';\nimport { Tree } from './tree/Tree';\nimport { DataTreeNode } from './tree/TreeNode';\n\n/**\n * The data visualizer class.\n * Exposes three function: init, drawData, and clear.\n *\n * init is used by SideContentDataVisualizer as a hook.\n * drawData is the draw_data function in source.\n * clear is used by WorkspaceSaga to reset the visualizer after every \"Run\" button press\n */\nexport default class DataVisualizer {\n  private static empty(step: Step[]) {}\n  private static setSteps: (step: Step[]) => void = DataVisualizer.empty;\n  private static _instance = new DataVisualizer();\n\n  private steps: Step[] = [];\n  private nodeLabel = 0;\n  private nodeToLabelMap: Map<DataTreeNode, number> = new Map();\n\n  private constructor() {}\n\n  public static init(setSteps: (step: Step[]) => void): void {\n    DataVisualizer.setSteps = setSteps;\n  }\n\n  public static drawData(structures: Data[]): void {\n    if (!DataVisualizer.setSteps) {\n      throw new Error('Data visualizer not initialized');\n    }\n    DataVisualizer._instance.addStep(structures);\n    DataVisualizer.setSteps(DataVisualizer._instance.steps);\n  }\n\n  public static clear(): void {\n    DataVisualizer._instance = new DataVisualizer();\n    DataVisualizer.setSteps(DataVisualizer._instance.steps);\n  }\n\n  public static displaySpecialContent(dataNode: DataTreeNode): number {\n    return DataVisualizer._instance.displaySpecialContent(dataNode);\n  }\n\n  private displaySpecialContent(dataNode: DataTreeNode): number {\n    if (this.nodeToLabelMap.has(dataNode)) {\n      return this.nodeToLabelMap.get(dataNode) ?? 0;\n    } else {\n      console.log('*' + this.nodeLabel + ': ' + dataNode.data);\n      this.nodeToLabelMap.set(dataNode, this.nodeLabel);\n      return this.nodeLabel++;\n    }\n  }\n\n  private addStep(structures: Data[]) {\n    const step = structures.map(this.createDrawing);\n    this.steps.push(step);\n  }\n\n  /**\n   *  For student use. Draws a structure by converting it into a tree object, attempts to draw on the canvas,\n   *  Then shift it to the left end.\n   */\n  private createDrawing(xs: Data): JSX.Element {\n    const treeDrawer = Tree.fromSourceStructure(xs).draw();\n\n    // To account for overflow to the left side due to a backward arrow\n    // const leftMargin = Config.ArrowMarginHorizontal + Config.StrokeWidth;\n    const leftMargin = Config.StrokeWidth / 2;\n\n    // To account for overflow to the top due to a backward arrow\n    const topMargin = Config.StrokeWidth / 2;\n\n    const layer = treeDrawer.draw(leftMargin, topMargin);\n    return (\n      <Stage key={xs} width={treeDrawer.width + leftMargin} height={treeDrawer.height + topMargin}>\n        {layer}\n      </Stage>\n    );\n  }\n}\n","import { Chapter, Language, SourceError, Variant } from 'c-slang/dist/types';\n\nimport { AcademyState } from '../../features/academy/AcademyTypes';\nimport { AchievementState } from '../../features/achievement/AchievementTypes';\nimport { DashboardState } from '../../features/dashboard/DashboardTypes';\nimport { Grading } from '../../features/grading/GradingTypes';\nimport { PlaygroundState } from '../../features/playground/PlaygroundTypes';\nimport { PlaybackStatus, RecordingStatus } from '../../features/sourceRecorder/SourceRecorderTypes';\nimport { Assessment } from '../assessment/AssessmentTypes';\nimport Constants from '../utils/Constants';\nimport { createContext } from '../utils/JsSlangHelper';\nimport {\n  DebuggerContext,\n  WorkspaceLocation,\n  WorkspaceManagerState,\n  WorkspaceState\n} from '../workspace/WorkspaceTypes';\nimport { ExternalLibraryName } from './types/ExternalTypes';\nimport { SessionState } from './types/SessionTypes';\n\nexport type OverallState = {\n  readonly academy: AcademyState;\n  readonly achievement: AchievementState;\n  readonly application: ApplicationState;\n  readonly playground: PlaygroundState;\n  readonly session: SessionState;\n  readonly workspaces: WorkspaceManagerState;\n  readonly dashboard: DashboardState;\n};\n\nexport type ApplicationState = {\n  readonly environment: ApplicationEnvironment;\n};\n\nexport type Story = {\n  story: string;\n  playStory: boolean;\n};\n\nexport type GameState = {\n  collectibles: { [id: string]: string };\n  completed_quests: string[];\n};\n\n/**\n * An output while the program is still being run in the interpreter. As a\n * result, there are no return values or SourceErrors yet. However, there could\n * have been calls to display (console.log) that need to be printed out.\n */\nexport type RunningOutput = {\n  type: 'running';\n  consoleLogs: string[];\n};\n\n/**\n * An output which reflects the program which the user had entered. Not a true\n * Output from the interpreter, but simply there to let he user know what had\n * been entered.\n */\nexport type CodeOutput = {\n  type: 'code';\n  value: string;\n};\n\n/**\n * An output which represents a program being run successfully, i.e. with a\n * return value at the end. A program can have either a return value, or errors,\n * but not both.\n */\nexport type ResultOutput = {\n  type: 'result';\n  value: any;\n  consoleLogs: string[];\n  runtime?: number;\n  isProgram?: boolean;\n};\n\n/**\n * An output which represents a program being run unsuccessfully, i.e. with\n * errors at the end. A program can have either a return value, or errors, but\n * not both.\n */\nexport type ErrorOutput = {\n  type: 'errors';\n  errors: SourceError[];\n  consoleLogs: string[];\n};\n\nexport type InterpreterOutput = RunningOutput | CodeOutput | ResultOutput | ErrorOutput;\n\nexport enum ApplicationEnvironment {\n  Development = 'development',\n  Production = 'production',\n  Test = 'test'\n}\n\nexport enum Role {\n  Student = 'student',\n  Staff = 'staff',\n  Admin = 'admin'\n}\n\n/**\n * Defines the languages available for use on Source Academy,\n * including Source sublanguages and other languages e.g. full JS.\n * For external libraries, see ExternalLibrariesTypes.ts\n */\nexport interface SALanguage extends Language {\n  displayName: string;\n}\n\nconst variantDisplay: Map<Variant, string> = new Map([\n  [Variant.DEFAULT, 'calc']\n]);\n\n\nexport const styliseSublanguage = (chapter: Chapter, variant: Variant = Variant.DEFAULT) => {\n  return `Source \\xa7${chapter}${\n    variantDisplay.has(variant) ? ` ${variantDisplay.get(variant)}` : ''\n  }`;\n};\n\nexport const sublanguages: Language[] = [\n  { chapter: Chapter.CALC, variant: Variant.DEFAULT }\n];\n\nexport const sourceLanguages: SALanguage[] = sublanguages.map(sublang => {\n  return {\n    ...sublang,\n    displayName: styliseSublanguage(sublang.chapter, sublang.variant)\n  };\n});\n\nexport const defaultLanguages = sourceLanguages.filter(\n  sublang => sublang.variant === Variant.DEFAULT\n);\n\nexport const variantLanguages = sourceLanguages.filter(\n  sublang => sublang.variant !== Variant.DEFAULT\n);\n\nexport const isSourceLanguage = (chapter: Chapter) =>\n  [Chapter.CALC].includes(chapter);\n\nconst currentEnvironment = (): ApplicationEnvironment => {\n  switch (process.env.NODE_ENV) {\n    case 'development':\n      return ApplicationEnvironment.Development;\n    case 'production':\n      return ApplicationEnvironment.Production;\n    default:\n      return ApplicationEnvironment.Test;\n  }\n};\n\nexport const defaultAcademy: AcademyState = {\n  gameCanvas: undefined\n};\n\nexport const defaultApplication: ApplicationState = {\n  environment: currentEnvironment()\n};\n\nexport const defaultDashboard: DashboardState = {\n  gradingSummary: {\n    cols: [],\n    rows: []\n  }\n};\n\nexport const defaultAchievement: AchievementState = {\n  achievements: [],\n  goals: [],\n  users: [],\n  assessmentOverviews: []\n};\n\nexport const defaultPlayground: PlaygroundState = {\n  githubSaveInfo: { repoName: '', filePath: '' }\n};\n\nexport const defaultEditorValue = \n`// Example Program:\n// The Tower of Hanoi is a mathematical game or puzzle consisting of \n// three rods and a number of disks of various diameters, which can \n// slide onto any rod. The objective of the puzzle is to move the \n// entire stack from the first rod to the last rod.\n// (visit https://en.wikipedia.org/wiki/Tower_of_Hanoi for the game rules)\n\n#include <stdio.h>\n\nvoid move(int n, char from_rod, char to_rod, char aux_rod) {\n    if (n == 1) {\n        printf(\"move disk %d from rod %c to rod %c\\\\n\", n, from_rod, to_rod);\n        return;\n    }\n    move(n-1, from_rod, aux_rod, to_rod);\n    printf(\"move disk %d from rod %c to rod %c\\\\n\", n, from_rod, to_rod);\n    move(n-1, aux_rod, to_rod, from_rod);\n}\n\nint main() {\n    int n = -1;\n    printf(\"Enter the number of disks: \");\n    while (n <= 0) {\n        scanf(\"%d\", &n);\n        if (n <= 0) {\n           printf(\"Must enter a positive number: \");\n        }\n    }\n    move(n, 'A', 'C', 'B');\n    return 0;\n}\n`;\n\n/**\n * Create a default IWorkspaceState for 'resetting' a workspace.\n * Takes in parameters to set the c-slang library and chapter.\n *\n * @param workspaceLocation the location of the workspace, used for context\n */\nexport const createDefaultWorkspace = (workspaceLocation: WorkspaceLocation): WorkspaceState => ({\n  autogradingResults: [],\n  context: createContext<WorkspaceLocation>(\n    [],\n    workspaceLocation,\n    Constants.defaultSourceVariant\n  ),\n  activeEditorTabIndex: 0,\n  editorTabs: [\n    {\n      value: ['playground', 'sourcecast', 'githubAssessments'].includes(workspaceLocation)\n        ? defaultEditorValue\n        : '',\n      prependValue: '',\n      postpendValue: '',\n      highlightedLines: [],\n      breakpoints: []\n    }\n  ],\n  editorSessionId: '',\n  isEditorReadonly: false,\n  editorTestcases: [],\n  externalLibrary: ExternalLibraryName.NONE,\n  execTime: 1500,\n  output: [],\n  replHistory: {\n    browseIndex: null,\n    records: [],\n    originalValue: ''\n  },\n  replValue: '',\n  sharedbConnected: false,\n  stepLimit: 1000,\n  globals: [],\n  isEditorAutorun: false,\n  isRunning: false,\n  isDebugging: false,\n  enableDebugging: true,\n  debuggerContext: {} as DebuggerContext\n});\n\nexport const defaultWorkspaceManager: WorkspaceManagerState = {\n  assessment: {\n    ...createDefaultWorkspace('assessment'),\n    currentAssessment: undefined,\n    currentQuestion: undefined,\n    hasUnsavedChanges: false\n  },\n  grading: {\n    ...createDefaultWorkspace('grading'),\n    currentSubmission: undefined,\n    currentQuestion: undefined,\n    hasUnsavedChanges: false\n  },\n  playground: {\n    ...createDefaultWorkspace('playground'),\n    usingSubst: false\n  },\n  sourcecast: {\n    ...createDefaultWorkspace('sourcecast'),\n    audioUrl: '',\n    codeDeltasToApply: null,\n    currentPlayerTime: 0,\n    description: null,\n    inputToApply: null,\n    playbackData: {\n      init: {\n        editorValue: '',\n        chapter: Chapter.CALC,\n        externalLibrary: ExternalLibraryName.NONE\n      },\n      inputs: []\n    },\n    playbackDuration: 0,\n    playbackStatus: PlaybackStatus.paused,\n    sourcecastIndex: null,\n    title: null,\n    uid: null\n  },\n  sourcereel: {\n    ...createDefaultWorkspace('sourcereel'),\n    playbackData: {\n      init: {\n        editorValue: '',\n        chapter: Chapter.CALC,\n        externalLibrary: ExternalLibraryName.NONE\n      },\n      inputs: []\n    },\n    recordingStatus: RecordingStatus.notStarted,\n    timeElapsedBeforePause: 0,\n    timeResumed: 0\n  },\n  sicp: {\n    ...createDefaultWorkspace('sicp'),\n    usingSubst: false\n  },\n  githubAssessment: {\n    ...createDefaultWorkspace('githubAssessment'),\n    hasUnsavedChanges: false\n  }\n};\n\nexport const defaultSession: SessionState = {\n  courses: [],\n  group: null,\n  gameState: {\n    completed_quests: [],\n    collectibles: {}\n  },\n  xp: 0,\n  allUserXp: undefined,\n  story: {\n    story: '',\n    playStory: false\n  },\n  assessments: new Map<number, Assessment>(),\n  assessmentOverviews: undefined,\n  agreedToResearch: undefined,\n  sessionId: Date.now(),\n  githubOctokitObject: { octokit: undefined },\n  gradingOverviews: undefined,\n  gradings: new Map<number, Grading>(),\n  notifications: []\n};\n\nexport const defaultState: OverallState = {\n  academy: defaultAcademy,\n  achievement: defaultAchievement,\n  application: defaultApplication,\n  dashboard: defaultDashboard,\n  playground: defaultPlayground,\n  session: defaultSession,\n  workspaces: defaultWorkspaceManager\n};\n","import Constants from '../utils/Constants';\n\nconst protocolMap = {\n  'http:': 'ws:',\n  'https:': 'wss:'\n};\n\nexport function getSessionUrl(sessionId: string, ws?: boolean): string {\n  const url = new URL(sessionId, Constants.sharedbBackendUrl);\n  if (ws) {\n    url.protocol = protocolMap[url.protocol];\n  }\n  return url.toString();\n}\n\nexport async function checkSessionIdExists(sessionId: string): Promise<boolean> {\n  const resp = await fetch(getSessionUrl(sessionId));\n\n  return resp && resp.ok;\n}\n\nexport async function createNewSession(initial: string): Promise<string> {\n  const resp = await fetch(Constants.sharedbBackendUrl, {\n    method: 'POST',\n    body: initial,\n    headers: { 'Content-Type': 'text/plain' }\n  });\n\n  if (!resp || !resp.ok) {\n    throw new Error(\n      resp ? `Could not create new session: ${await resp.text()}` : 'Unknown error creating session'\n    );\n  }\n\n  return resp.text();\n}\n","export const SET_EDITOR_SESSION_ID = 'SET_EDITOR_SESSION_ID';\nexport const SET_SHAREDB_CONNECTED = 'SET_SHAREDB_CONNECTED';\n","import { action } from 'typesafe-actions'; // EDITING\n\nimport { WorkspaceLocation } from '../workspace/WorkspaceTypes';\nimport { SET_EDITOR_SESSION_ID, SET_SHAREDB_CONNECTED } from './CollabEditingTypes';\n\nexport const setEditorSessionId = (workspaceLocation: WorkspaceLocation, editorSessionId: string) =>\n  action(SET_EDITOR_SESSION_ID, {\n    workspaceLocation,\n    editorSessionId\n  });\n\n/**\n * Sets ShareDB connection status.\n *\n * @param workspaceLocation the workspace to be reset\n * @param connected whether we are connected to ShareDB\n */\nexport const setSharedbConnected = (workspaceLocation: WorkspaceLocation, connected: boolean) =>\n  action(SET_SHAREDB_CONNECTED, { workspaceLocation, connected });\n","import { IconName } from '@blueprintjs/core';\n\nimport { DebuggerContext } from '../workspace/WorkspaceTypes';\n\nexport const NOTIFY_PROGRAM_EVALUATED = 'NOTIFY_PROGRAM_EVALUATED';\n\nexport enum SideContentType {\n  autograder = 'autograder',\n  briefing = 'briefing',\n  contestVoting = 'contest_voting',\n  contestLeaderboard = 'contest_leaderboard',\n  dataVisualizer = 'data_visualizer',\n  editorGrading = 'editor_grading',\n  editorAutograder = 'editor_autograder',\n  editorBriefing = 'editor_briefing',\n  editorGlobalDeployment = 'editor_global_deployment',\n  editorGlobalGraderDeployment = 'editor_global_grader_deployment',\n  editorLocalDeployment = 'editor_local_deployment',\n  editorLocalGraderDeployment = 'editor_local_grader_deployment',\n  editorManageQuestion = 'editor_manage_question',\n  editorQuestionOverview = 'editor_question_overview',\n  editorQuestionTemplate = 'editor_question_template',\n  envVisualizer = 'env_visualizer',\n  files = 'files',\n  grading = 'grading',\n  introduction = 'introduction',\n  module = 'module',\n  questionOverview = 'question_overview',\n  remoteExecution = 'remote_execution',\n  missionMetadata = 'mission_metadata',\n  mobileEditor = 'mobile_editor',\n  mobileEditorRun = 'mobile_editor_run',\n  sourcereel = 'sourcereel',\n  substVisualizer = 'subst_visualiser',\n  testcases = 'testcases',\n  toneMatrix = 'tone_matrix',\n  htmlDisplay = 'html_display'\n}\n\n/**\n * @property label A string that will appear as the tooltip.\n *\n * @property iconName BlueprintJS IconName element, used to render the\n *   icon which will be displayed over the SideContent panel.\n *\n * @property body The element to be rendered in the SideContent panel\n *  when the tab is selected. If null, the panel will not be rendered.\n *\n * @property id A string/number that will be used as the tab ID and key.\n *  If id is undefined, id will be set to label by the renderTab function.\n *\n * @property disabled Set this property to true to disable a tab. The\n * corresponding tab label will still be rendered on hover, but the\n * tab will be greyed out and cannot be selected. Default value: false.\n */\nexport type SideContentTab = {\n  label: string;\n  iconName: IconName;\n  body: JSX.Element | null;\n  id?: SideContentType;\n  disabled?: boolean;\n};\n\n/**\n * Used for modules that dynamically spawn when imported\n *\n * @property label A string that will appear as the tooltip.\n *\n * @property iconName BlueprintJS IconName element, used to render the\n *   icon which will be displayed over the SideContent panel.\n *\n * @property body The element to be rendered in the SideContent panel\n *  when the tab is selected.\n *\n * @property toSpawn function that returns boolean to determine if\n * side content tab should appear\n */\nexport type ModuleSideContent = {\n  label: string;\n  iconName: IconName;\n  body: (props: any) => JSX.Element;\n  toSpawn: (context: DebuggerContext) => boolean;\n};\n","import { action } from 'typesafe-actions'; // EDITED\n\nimport { LOG_OUT } from '../types/CommonsTypes';\n\nexport const logOut = () => action(LOG_OUT);\n","import { Octokit } from '@octokit/rest';\n\n/**\n * Returns an instance to Octokit created using the authentication token\n */\nexport function generateOctokitInstance(authToken: string) {\n  const octokit = new Octokit({\n    auth: authToken,\n    userAgent: 'Source Academy Playground',\n    baseUrl: 'https://api.github.com',\n    log: {\n      debug: () => {},\n      info: () => {},\n      warn: console.warn,\n      error: console.error\n    },\n    request: {\n      agent: undefined,\n      fetch: undefined,\n      timeout: 0\n    }\n  });\n\n  return octokit;\n}\n","import { Classes } from '@blueprintjs/core';\nimport classNames from 'classnames';\nimport React from 'react';\n\nexport type ControlBarProps = {\n  editorButtons: Array<JSX.Element | null>;\n  flowButtons?: Array<JSX.Element | null>;\n  editingWorkspaceButtons?: Array<JSX.Element | null>;\n};\n\nconst ControlBar: React.FC<ControlBarProps> = props => {\n  const editorControl = (\n    <div className={classNames('ControlBar_editor', Classes.BUTTON_GROUP)}>\n      {props.editorButtons}\n    </div>\n  );\n\n  const flowControl = props.flowButtons && (\n    <div className={classNames('ControlBar_flow', Classes.BUTTON_GROUP)}>{props.flowButtons}</div>\n  );\n\n  const editingWorkspaceControl = (\n    <div className={classNames('ControlBar_editingWorkspace', Classes.BUTTON_GROUP)}>\n      {props.editingWorkspaceButtons}\n    </div>\n  );\n\n  return (\n    <div className=\"ControlBar\">\n      {editorControl}\n      {flowControl}\n      {editingWorkspaceControl}\n    </div>\n  );\n};\n\nexport default ControlBar;\n","import { AssessmentOverview } from 'src/commons/assessment/AssessmentTypes';\n\nimport { BooleanExpression } from './ExpressionTypes';\n\nexport const ADD_EVENT = 'ADD_EVENT';\nexport const BULK_UPDATE_ACHIEVEMENTS = 'BULK_UPDATE_ACHIEVEMENTS';\nexport const BULK_UPDATE_GOALS = 'BULK_UPDATE_GOALS';\nexport const EDIT_ACHIEVEMENT = 'EDIT_ACHIEVEMENT';\nexport const EDIT_GOAL = 'EDIT_GOAL';\nexport const HANDLE_EVENT = 'HANDLE_EVENT';\nexport const GET_ACHIEVEMENTS = 'GET_ACHIEVEMENTS';\nexport const GET_GOALS = 'GET_GOALS';\nexport const GET_OWN_GOALS = 'GET_OWN_GOALS';\nexport const GET_USER_ASSESSMENT_OVERVIEWS = 'GET_USER_ASSESSMENT_OVERVIEWS';\nexport const GET_USERS = 'GET_USERS';\nexport const REMOVE_ACHIEVEMENT = 'REMOVE_ACHIEVEMENT';\nexport const REMOVE_GOAL = 'REMOVE_GOAL';\nexport const SAVE_ACHIEVEMENTS = 'SAVE_ACHIEVEMENTS';\nexport const SAVE_GOALS = 'SAVE_GOALS';\nexport const SAVE_USER_ASSESSMENT_OVERVIEWS = 'SAVE_USER_ASSESSMENT_OVERVIEWS';\nexport const SAVE_USERS = 'SAVE_USERS';\nexport const UPDATE_GOAL_PROGRESS = 'UPDATE_GOAL_PROGRESS';\nexport const UPDATE_OWN_GOAL_PROGRESS = 'UPDATE_OWN_GOAL_PROGRESS';\n\nexport enum AchievementStatus {\n  ACTIVE = 'ACTIVE', // deadline not over and not completed\n  COMPLETED = 'COMPLETED', // completed, regardless of deadline\n  EXPIRED = 'EXPIRED', // deadline over and not completed\n  UNRELEASED = 'UNRELEASED' // release date not reached yet\n}\n\nexport enum FilterStatus {\n  ALL = 'ALL', // show all achievements\n  ACTIVE = 'ACTIVE', // show active achievements only\n  COMPLETED = 'COMPLETED' // show completed achievements only\n}\n\n/**\n * Information of an achievement item\n *\n * @param {string} uuid unique uuid of the achievement item\n * @param {string} title title of the achievement\n * @param {number} xp the xp gained when completing the achievement\n * @param {boolean} isVariableXp the xp gained from the achievement is the sum of its goal counts\n * @param {Date} deadline Optional, the deadline of the achievement\n * @param {Date} release Optional, the release date of the achievement\n * @param {boolean} isTask if true, the achievement is rendered as an achievement task\n * @param {number} position ordering of the achievement task, 0 for non-task\n * @param {string[]} prerequisiteUuids an array of prerequisite uuids\n * @param {string[]} goalUuids an array of goal uuids\n * @param {string} cardBackground background image URL of the achievement card\n * @param {AchievementView} view the achievement view\n */\nexport type AchievementItem = {\n  uuid: string;\n  title: string;\n  xp: number;\n  isVariableXp: boolean;\n  deadline?: Date;\n  release?: Date;\n  isTask: boolean;\n  position: number;\n  prerequisiteUuids: string[];\n  goalUuids: string[];\n  cardBackground: string;\n  view: AchievementView;\n};\n\nexport type AchievementGoal = GoalDefinition & GoalProgress;\n\n/**\n * Information of an achievement goal definition\n *\n * @param {string} uuid unique uuid of the goal\n * @param {string} text goal description\n * @param {string[]} achievementUuids an array of achievement uuids that use this goal\n * @param {GoalMeta} meta contains meta data relevant to the goal type\n */\nexport type GoalDefinition = {\n  uuid: string;\n  text: string;\n  achievementUuids: string[];\n  meta: GoalMeta;\n};\n\n/**\n * Information of an achievement goal progress\n *\n * @param {string} uuid unique uuid of the goal\n * @param {number} xp student's current XP of the goal\n * @param {number} maxXp maximum attainable XP of the goal (computed by server)\n * @param {boolean} completed student's completion status of the goal\n */\nexport type GoalProgress = {\n  uuid: string;\n  count: number;\n  targetCount: number;\n  completed: boolean;\n};\n\nexport const defaultGoalProgress = {\n  count: 0,\n  targetCount: 1,\n  completed: false\n};\n\nexport enum GoalType {\n  MANUAL = 'Manual',\n  EVENT = 'Event',\n  ASSESSMENT = 'Assessment (unsupported)',\n  BINARY = 'Binary (unsupported)'\n}\n\nexport enum EventType {\n  NONE = 'None', // This is just for the purposes of a default value\n  RUN_CODE = 'Run Code',\n  ERROR = 'Error',\n  RUN_TESTCASE = 'Run Testcase'\n}\n\nexport type GoalMeta = AssessmentMeta | BinaryMeta | ManualMeta | EventMeta;\n\nexport type AssessmentMeta = {\n  type: GoalType.ASSESSMENT;\n  assessmentNumber: number;\n  requiredCompletionFrac: number; // between [0..1]\n};\n\nexport type BinaryMeta = {\n  type: GoalType.BINARY;\n  condition: BooleanExpression;\n  targetCount: number;\n};\n\nexport type ManualMeta = {\n  type: GoalType.MANUAL;\n  targetCount: number;\n};\n\nexport type EventMeta = {\n  type: GoalType.EVENT;\n  eventNames: EventType[];\n  targetCount: number;\n  release?: Date;\n  deadline?: Date;\n  observeFrom?: Date;\n  observeTo?: Date;\n};\n\n/**\n * Information of an achievement view\n *\n * @param {string} coverImage cover image URL\n * @param {string} description fixed text that displays under title\n * @param {string} completionText text that displays after student completes the achievement\n */\nexport type AchievementView = {\n  coverImage: string;\n  description: string;\n  completionText: string;\n};\n\nexport type AchievementUser = {\n  name?: string;\n  username: string;\n  courseRegId: number;\n  group: string;\n};\n\nexport type AchievementState = {\n  achievements: AchievementItem[];\n  goals: AchievementGoal[];\n  users: AchievementUser[];\n  assessmentOverviews: AssessmentOverview[];\n};\n","import { Button, Card, Intent } from '@blueprintjs/core';\nimport * as React from 'react';\n\nimport { IMCQQuestion } from '../assessment/AssessmentTypes';\nimport Markdown from '../Markdown';\nimport { showSuccessMessage, showWarningMessage } from '../utils/NotificationsHelper';\n\nexport type McqChooserProps = {\n  mcq: IMCQQuestion;\n  handleMCQSubmit: (choiceId: number) => void;\n};\n\nclass McqChooser extends React.PureComponent<McqChooserProps, {}> {\n  public render() {\n    const options = this.props.mcq.choices.map((choice, i) => (\n      <Button\n        key={i}\n        className=\"mcq-option col-xs-12\"\n        active={i === this.props.mcq.answer}\n        intent={this.getButtonIntent(i, this.props.mcq.answer, this.props.mcq.solution)}\n        onClick={this.onButtonClickFactory(i)}\n        minimal={true}\n      >\n        <Markdown content={choice.content} />\n      </Button>\n    ));\n    return (\n      <div className=\"MCQChooser row\">\n        <Card className=\"mcq-content-parent col-xs-12 middle-xs\">\n          <div className=\"row mcq-options-parent between-xs\">{options}</div>\n        </Card>\n      </div>\n    );\n  }\n\n  /**\n   * A function to generate an onClick function that causes\n   * and mcq submission with a given answer id.\n   *\n   * Post-condition: the local state will be updated to store the\n   * mcq option selected, and a notification will be displayed with\n   * a hint, if the question is ungraded.\n   *\n   * @param i the id of the answer\n   */\n  private onButtonClickFactory = (i: number) => (e: any) => {\n    if (i !== this.props.mcq.answer) {\n      this.props.handleMCQSubmit(i);\n    }\n    const shouldDisplayMessage = this.props.mcq.solution !== null && this.props.mcq.choices[i].hint;\n    if (shouldDisplayMessage) {\n      const hintElement = (\n        <Markdown className=\"markdown-notification\" content={this.props.mcq.choices[i].hint!} />\n      );\n      if (i === this.props.mcq.solution) {\n        showSuccessMessage(hintElement, 4000);\n      } else {\n        showWarningMessage(hintElement, 4000);\n      }\n    }\n  };\n\n  /**\n   * Handles the logic for what intent an MCQ option should show up as.\n   * This is dependent on the presence of an actual solution (for ungraded assessments),\n   * the current selection, and whether the selected option is active.\n   *\n   * @param currentOption the current button key, corresponding to a choice ID\n   * @param chosenOption the mcq option that is chosen in the state, i.e what should show up as \"selected\"\n   * @param solution the solution to the mcq, if any\n   */\n  private getButtonIntent = (\n    currentOption: number,\n    chosenOption: number | null,\n    solution?: number\n  ): Intent => {\n    const active = currentOption === chosenOption;\n    const correctOptionSelected = active && solution !== undefined && currentOption === solution;\n    if (solution === undefined) {\n      return Intent.NONE;\n    } else if (active && correctOptionSelected) {\n      return Intent.SUCCESS;\n    } else if (active && !correctOptionSelected) {\n      return Intent.DANGER;\n    } else {\n      return Intent.NONE;\n    }\n  };\n}\n\nexport default McqChooser;\n","import { Card, Pre } from '@blueprintjs/core';\nimport { Ace } from 'ace-builds';\nimport { parseError } from 'c-slang';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport * as React from 'react';\n\nimport { InterpreterOutput } from '../application/ApplicationTypes';\nimport { ExternalLibraryName } from '../application/types/ExternalTypes';\nimport { OutputProps } from './ReplTypes';\n\nconst ESCAPE_CHARACTERS = {\n  '\\\\a': 'a',\n  '\\\\b': '\\b',\n  '\\\\f': '\\f',\n  '\\\\n': '\\n',\n  '\\\\r': '\\r',\n  '\\\\t': '\\t',\n  '\\\\v': '\\v',\n  \"\\\\'\": \"'\",\n  '\\\\\"': '\"',\n  '\\\\?': '?',\n  '\\\\\\\\': '\\\\'\n}\n\nfunction restoreEscapeCharacters(original: string): string {\n  let result = original\n  for (const toReplace in ESCAPE_CHARACTERS) {\n    result = result.replaceAll(toReplace, ESCAPE_CHARACTERS[toReplace])\n  }\n  return result\n}\n\nexport type ReplProps = DispatchProps & StateProps & OwnProps;\n\ntype StateProps = {\n  output: InterpreterOutput[];\n  replValue: string;\n  hidden?: boolean;\n  inputHidden?: boolean;\n  usingSubst?: boolean;\n  sourceChapter: Chapter;\n  sourceVariant: Variant;\n  externalLibrary: ExternalLibraryName;\n  disableScrolling?: boolean;\n};\n\ntype DispatchProps = {\n  handleBrowseHistoryDown: () => void;\n  handleBrowseHistoryUp: () => void;\n  handleReplEval: () => void;\n  handleReplValueChange: (newCode: string) => void;\n  onFocus?: (editor: Ace.Editor) => void;\n  onBlur?: () => void;\n};\n\ntype OwnProps = {\n  replButtons: Array<JSX.Element | null>;\n};\n\nconst Repl: React.FC<ReplProps> = (props: ReplProps) => {\n  const cards = props.output.map((slice, index) => (\n    <Output\n      output={slice}\n      key={index}\n      usingSubst={props.usingSubst ?? false}\n    />\n  ));\n  return (\n    <div className=\"Repl\" style={{ display: props.hidden ? 'none' : undefined }}>\n      <div className=\"repl-output-parent\">\n        {cards}\n      </div>\n    </div>\n  );\n};\n\nexport const Output: React.FC<OutputProps> = (props: OutputProps) => {\n  console.log(props)\n  switch (props.output.type) {\n    case 'code':\n      return (\n        <Card>\n          <Pre className=\"code-output\">{props.output.value}</Pre>\n        </Card>\n      );\n    case 'running':\n      return (\n        <Card>\n          <Pre className=\"log-output\">{props.output.consoleLogs.join('\\n')}</Pre>\n        </Card>\n      );\n    case 'result':\n      // We check if we are using Stepper, so we can process the REPL results properly\n      if (props.usingSubst && props.output.value instanceof Array) {\n        return (\n          <Card>\n            <Pre className=\"log-output\">Check out the Stepper tab!</Pre>\n          </Card>\n        );\n      } else if (props.output.consoleLogs.length === 0) {\n        return (\n          <Card>\n            <Pre className=\"result-output\">{restoreEscapeCharacters(props.output.value)}</Pre>\n          </Card>\n        );\n      } else {\n        return (\n          <Card>\n            <Pre className=\"log-output\">{props.output.consoleLogs.join('\\n')}</Pre>\n            <Pre className=\"result-output\">{props.output.value}</Pre>\n          </Card>\n        );\n      }\n    case 'errors':\n      if (props.output.consoleLogs.length === 0) {\n        return (\n          <Card>\n            <Pre className=\"error-output\">{parseError(props.output.errors)}</Pre>\n          </Card>\n        );\n      } else {\n        return (\n          <Card>\n            <Pre className=\"log-output\">{props.output.consoleLogs.join('\\n')}</Pre>\n            <br />\n            <Pre className=\"error-output\">{parseError(props.output.errors)}</Pre>\n          </Card>\n        );\n      }\n    default:\n      return <Card>''</Card>;\n  }\n};\n\n/* Override handler, so does not trigger when focus is in editor */\n// const handlers = {\n//   goGreen: () => {}\n// };\n\nexport default Repl;\n","import * as _ from 'lodash';\n\n/**\n * Performs a deep comparison between the previous & next props state\n * to determine if they are equivalent. For use with the `React.memo`\n * higher order component.\n *\n * @param prevProps The previous state of the props passed into a component.\n * @param nextProps The next state of the props passed into a component\n */\nexport const propsAreEqual = <T>(prevProps: T, nextProps: T): boolean =>\n  _.isEqual(prevProps, nextProps);\n","import { Card, Classes, Elevation, Pre } from '@blueprintjs/core';\nimport { parseError } from 'c-slang';\nimport { stringify } from 'c-slang/dist/utils/stringify';\nimport classNames from 'classnames';\nimport * as React from 'react';\n\nimport { Testcase, TestcaseTypes } from '../assessment/AssessmentTypes';\nimport { WorkspaceLocation } from '../workspace/WorkspaceTypes';\n\ntype SideContentTestcaseCardProps = DispatchProps & StateProps & OwnProps;\n\ntype DispatchProps = {\n  handleTestcaseEval: (testcaseId: number) => void;\n};\n\ntype StateProps = {\n  index: number;\n  testcase: Testcase;\n};\n\ntype OwnProps = {\n  workspaceLocation: WorkspaceLocation;\n};\n\nconst SideContentTestcaseCard: React.FunctionComponent<SideContentTestcaseCardProps> = props => {\n  const { index, testcase, handleTestcaseEval } = props;\n\n  const extraClasses = React.useMemo(() => {\n    const isEvaluated = testcase.result !== undefined || testcase.errors;\n    const isEqual = stringify(testcase.result) === testcase.answer;\n\n    return {\n      correct: isEvaluated && isEqual,\n      wrong: isEvaluated && !isEqual,\n      // opaque and secret testcases will be greyed in the GradingWorkspace\n      secret: testcase.type === TestcaseTypes.secret || testcase.type === TestcaseTypes.opaque\n    };\n  }, [testcase]);\n\n  const handleRunTestcase = React.useCallback(() => {\n    handleTestcaseEval(index);\n  }, [index, handleTestcaseEval]);\n\n  /**\n   * Note: There are 3 testcase types in the backend: public, opaque, secret\n   *\n   * Public testcases are always sent from the backend, and displayed for both\n   * students and staff/ admin in the AssessmentWorkspace and/ or GradingWorkspace.\n   *\n   * Opaque testcases are always sent from the backend, and are 'hidden' with a\n   * placeholder cell in the AssessmentWorkspace, but displayed in the\n   * GradingWorkspace albeit with grey CSS styling.\n   *\n   * Secret testcases are only sent from the backend when the grading endpoint is\n   * accessed (i.e. NOT sent in the AssessmentWorkspace). Thus they are only seen\n   * in the GradingWorkspace albeit with grey CSS styling, which is only accessible\n   * by staff/ admin.\n   *\n   * Extra info: The GitHubAssessmentWorkspace uses this testcase card component even\n   * though they only have public testcases (as of July 2021). Thus all testcases will\n   * be rendered in the GitHubAssessmentWorkspace for students.\n   */\n  return (\n    <div className={classNames('AutograderCard', extraClasses)}>\n      <Card className={Classes.INTERACTIVE} elevation={Elevation.ONE} onClick={handleRunTestcase}>\n        {testcase.type === TestcaseTypes.opaque && props.workspaceLocation === 'assessment' ? (\n          // Render a placeholder cell in place of the actual testcase data for opaque testcases\n          <Pre className=\"testcase-placeholder\">Hidden testcase</Pre>\n        ) : (\n          <>\n            <Pre className=\"testcase-program\">{testcase.program}</Pre>\n            <Pre className=\"testcase-expected\">{testcase.answer}</Pre>\n            <Pre className=\"testcase-actual\">\n              {testcase.errors\n                ? parseError(testcase.errors)\n                : testcase.result !== undefined\n                ? stringify(testcase.result)\n                : 'No Answer'}\n            </Pre>\n          </>\n        )}\n      </Card>\n    </div>\n  );\n};\n\nexport default SideContentTestcaseCard;\n","import { Button, Checkbox, MenuItem, NumericInput } from '@blueprintjs/core';\nimport { ItemPredicate, ItemRenderer, Select } from '@blueprintjs/select';\nimport { useContext, useEffect, useState } from 'react';\nimport { AchievementContext } from 'src/features/achievement/AchievementConstants';\nimport {\n  AchievementGoal,\n  AchievementUser,\n  GoalProgress\n} from 'src/features/achievement/AchievementTypes';\n\nimport { showSuccessMessage, showWarningMessage } from '../utils/NotificationsHelper';\n\ntype AchievementManualEditorProps = {\n  hiddenState: [boolean, any];\n  userState: [AchievementUser | undefined, any];\n  studio: string;\n  users: AchievementUser[];\n  getUsers: () => void;\n  updateGoalProgress: (studentCourseRegId: number, progress: GoalProgress) => void;\n};\n\nconst GoalSelect = Select.ofType<AchievementGoal>();\nconst goalRenderer: ItemRenderer<AchievementGoal> = (goal, { handleClick }) => (\n  <MenuItem key={goal.uuid} onClick={handleClick} text={goal.text} />\n);\nconst goalPredicate: ItemPredicate<AchievementGoal> = (query, item) =>\n  item.text.toLowerCase().includes(query.toLowerCase());\n\nconst UserSelect = Select.ofType<AchievementUser>();\nconst userRenderer: ItemRenderer<AchievementUser> = (user, { handleClick }) => (\n  <MenuItem key={user.courseRegId} onClick={handleClick} text={user.name || user.username} />\n);\nconst userPredicate: ItemPredicate<AchievementUser> = (query, item) =>\n  [item.name, item.username, item.group].reduce(\n    (acc: boolean, x) => (x ? acc || x.toLowerCase().includes(query.toLowerCase()) : acc),\n    false\n  );\n\nexport function updateGoalProcessed() {\n  showSuccessMessage('Goal updated');\n}\n\nfunction AchievementManualEditor(props: AchievementManualEditorProps) {\n  const { userState, hiddenState, studio, getUsers, updateGoalProgress } = props;\n  const users =\n    studio === 'Staff'\n      ? // The name can be null for users who have yet to log in. We push these to the back of the array.\n        [...props.users].sort(\n          (user1, user2) =>\n            user1.name != null && user2.name != null\n              ? user1.name.localeCompare(user2.name)\n              : user1.name == null\n              ? 1 // user1.name is null, user1 > user2\n              : -1 // user2.name is null, user1 < user2\n        )\n      : props.users\n          .filter(user => user.group === studio)\n          .sort(\n            (user1, user2) =>\n              user1.name != null && user2.name != null\n                ? user1.name.localeCompare(user2.name)\n                : user1.name == null\n                ? 1 // user1.name is null, user1 > user2\n                : -1 // user2.name is null, user1 < user2\n          );\n\n  useEffect(getUsers, [getUsers]);\n\n  const inferencer = useContext(AchievementContext);\n  const manualAchievements: AchievementGoal[] = inferencer\n    .getAllGoals()\n    .filter(goals => goals.meta.type === 'Manual');\n\n  const [goal, changeGoal] = useState<AchievementGoal | undefined>(undefined);\n  const [selectedUser, changeSelectedUser] = userState;\n  const [count, changeCount] = useState<number>(0);\n  const [viewHidden, changeViewHidden] = hiddenState;\n\n  const updateGoal = () => {\n    if (goal && selectedUser) {\n      const progress: GoalProgress = {\n        uuid: goal.uuid,\n        count: count < 0 ? 0 : Math.floor(count),\n        targetCount: goal.targetCount,\n        completed: count >= goal.targetCount\n      };\n      updateGoalProgress(selectedUser.courseRegId, progress);\n    } else {\n      !goal && showWarningMessage('Goal not selected');\n      !selectedUser && showWarningMessage('User not selected');\n    }\n  };\n\n  return (\n    <div className=\"achievement-manual-editor\">\n      <h3>User: </h3>\n      <UserSelect\n        filterable={true}\n        items={users}\n        itemRenderer={userRenderer}\n        itemPredicate={userPredicate}\n        onItemSelect={changeSelectedUser}\n        noResults={<MenuItem disabled={true} text=\"No matching user\" />}\n      >\n        <Button\n          outlined={true}\n          text={selectedUser ? selectedUser.name || selectedUser.username : 'No User Selected'}\n          color=\"White\"\n        />\n      </UserSelect>\n\n      <h3>Goal: </h3>\n      <GoalSelect\n        filterable={true}\n        items={manualAchievements}\n        itemRenderer={goalRenderer}\n        itemPredicate={goalPredicate}\n        onItemSelect={changeGoal}\n        noResults={<MenuItem disabled={true} text=\"No matching goal\" />}\n      >\n        <Button outlined={true} text={goal ? goal.text : 'No Goal Selected'} color=\"White\" />\n      </GoalSelect>\n\n      <h3>Count: </h3>\n      <NumericInput\n        value={count}\n        min={0}\n        allowNumericCharactersOnly={true}\n        minorStepSize={null}\n        placeholder=\"Count\"\n        onValueChange={changeCount}\n      />\n\n      <h3> </h3>\n      <Button outlined={true} text=\"Update Goal\" onClick={updateGoal} intent=\"primary\" />\n\n      <h3> </h3>\n      <Checkbox\n        checked={viewHidden}\n        label=\"View Hidden Achievements\"\n        onChange={() => changeViewHidden(!viewHidden)}\n      />\n    </div>\n  );\n}\n\nexport default AchievementManualEditor;\n","import { action } from 'typesafe-actions';\n\nimport {\n  FETCH_GROUP_GRADING_SUMMARY,\n  GradingSummary,\n  UPDATE_GROUP_GRADING_SUMMARY\n} from './DashboardTypes';\n\nexport const fetchGroupGradingSummary = () => action(FETCH_GROUP_GRADING_SUMMARY);\n\nexport const updateGroupGradingSummary = (gradingSummary: GradingSummary) =>\n  action(UPDATE_GROUP_GRADING_SUMMARY, gradingSummary);\n","import { stringify } from 'c-slang/dist/utils/stringify';\n\ntype DisplayBufferCallback = (log: string) => void;\n\ntype ConsoleOverloadMethod<T> = (bufferCallback: DisplayBufferCallback) => (args: T) => void;\n\n// TODO add other overloads\n// - e.g. \"warn\"/\"debug\"/\"time\"/\"timeEnd\"\ninterface ConsoleOverload {\n  log: ConsoleOverloadMethod<any[]>;\n}\n\nexport const consoleOverloads: ConsoleOverload = {\n  log:\n    (bufferCallback: DisplayBufferCallback) =>\n    (...args: any[]) => {\n      bufferCallback(args.map(log => (typeof log === 'string' ? log : stringify(log))).join(' '));\n    }\n};\n","import { WorkspaceLocation } from '../workspace/WorkspaceTypes';\nimport { consoleOverloads } from './ConsoleOverload';\n\nclass BufferService {\n  private buffer: string[];\n  private workspaceLocation: WorkspaceLocation | undefined;\n\n  constructor() {\n    this.buffer = [];\n  }\n\n  public dump(): string[] {\n    const bufferCopy = [...this.buffer];\n    this.resetBuffer();\n    return bufferCopy;\n  }\n\n  public push(log: string, workspaceLocation: WorkspaceLocation): void {\n    this.handleWorkspaceChange(workspaceLocation);\n    this.buffer.push(log);\n  }\n\n  public attachConsole(workspaceLocation: WorkspaceLocation): () => void {\n    const bufferCallback = (log: string) => this.push(log, workspaceLocation);\n    const defaultConsole = {};\n    Object.entries(consoleOverloads).forEach(([method, overload]) => {\n      defaultConsole[method] = console[method];\n      console[method] = overload(bufferCallback);\n    });\n\n    return () => {\n      Object.entries(consoleOverloads).forEach(([method]) => {\n        console[method] = defaultConsole[method];\n      });\n    };\n  }\n\n  private handleWorkspaceChange(newWorkspace: WorkspaceLocation): void {\n    if (!this.hasWorkspace() || newWorkspace !== this.workspaceLocation) {\n      this.workspaceLocation = newWorkspace;\n      this.resetBuffer();\n    }\n  }\n\n  private hasWorkspace(): boolean {\n    return Boolean(this.workspaceLocation);\n  }\n\n  private resetBuffer(): void {\n    this.buffer = [];\n  }\n}\n\n// Singleton\nconst DisplayBufferService: BufferService = new BufferService();\nexport default DisplayBufferService;\n","import { Context } from 'c-slang';\n\nimport { GitHubAssessmentWorkspaceState } from '../../features/githubAssessment/GitHubAssessmentTypes';\nimport { SourcecastWorkspaceState } from '../../features/sourceRecorder/sourcecast/SourcecastTypes';\nimport { SourcereelWorkspaceState } from '../../features/sourceRecorder/sourcereel/SourcereelTypes';\nimport { InterpreterOutput } from '../application/ApplicationTypes';\nimport { ExternalLibraryName } from '../application/types/ExternalTypes';\nimport { AutogradingResult, Testcase } from '../assessment/AssessmentTypes';\nimport { HighlightedLines, Position } from '../editor/EditorTypes';\n\nexport const ADD_HTML_CONSOLE_ERROR = 'ADD_HTML_CONSOLE_ERROR';\nexport const BEGIN_CLEAR_CONTEXT = 'BEGIN_CLEAR_CONTEXT';\nexport const BROWSE_REPL_HISTORY_DOWN = 'BROWSE_REPL_HISTORY_DOWN';\nexport const BROWSE_REPL_HISTORY_UP = 'BROWSE_REPL_HISTORY_UP';\nexport const CHANGE_EXEC_TIME = 'CHANGE_EXEC_TIME';\nexport const CHANGE_EXTERNAL_LIBRARY = 'CHANGE_EXTERNAL_LIBRARY';\nexport const CHANGE_SIDE_CONTENT_HEIGHT = 'CHANGE_SIDE_CONTENT_HEIGHT';\nexport const CHANGE_STEP_LIMIT = 'CHANGE_STEP_LIMIT';\nexport const CHAPTER_SELECT = 'CHAPTER_SELECT';\nexport const CLEAR_REPL_INPUT = 'CLEAR_REPL_INPUT';\nexport const CLEAR_REPL_OUTPUT = 'CLEAR_REPL_OUTPUT';\nexport const CLEAR_REPL_OUTPUT_LAST = 'CLEAR_REPL_OUTPUT_LAST';\nexport const END_CLEAR_CONTEXT = 'END_CLEAR_CONTEXT';\nexport const EVAL_EDITOR = 'EVAL_EDITOR';\nexport const CHECK_EDITOR = 'CHECK_EDITOR';\nexport const EVAL_REPL = 'EVAL_REPL';\nexport const PROMPT_AUTOCOMPLETE = 'PROMPT_AUTOCOMPLETE';\nexport const EVAL_SILENT = 'EVAL_SILENT';\nexport const EVAL_TESTCASE = 'EVAL_TESTCASE';\nexport const EVAL_EDITOR_AND_TESTCASES = 'EVAL_EDITOR_AND_TESTCASES';\nexport const MOVE_CURSOR = 'MOVE_CURSOR';\nexport const NAV_DECLARATION = 'NAV_DECLARATION';\nexport const PLAYGROUND_EXTERNAL_SELECT = 'PLAYGROUND_EXTERNAL_SELECT ';\nexport const RESET_TESTCASE = 'RESET_TESTCASE';\nexport const RESET_WORKSPACE = 'RESET_WORKSPACE';\nexport const SEND_REPL_INPUT_TO_OUTPUT = 'SEND_REPL_INPUT_TO_OUTPUT';\nexport const TOGGLE_EDITOR_AUTORUN = 'TOGGLE_EDITOR_AUTORUN';\nexport const TOGGLE_USING_SUBST = 'TOGGLE_USING_SUBST';\nexport const UPDATE_CURRENT_ASSESSMENT_ID = 'UPDATE_CURRENT_ASSESSMENT_ID';\nexport const UPDATE_CURRENT_SUBMISSION_ID = 'UPDATE_CURRENT_SUBMISSION_ID';\nexport const UPDATE_ACTIVE_EDITOR_TAB = 'UPDATE_ACTIVE_EDITOR_TAB';\nexport const UPDATE_EDITOR_VALUE = 'UPDATE_EDITOR_VALUE';\nexport const UPDATE_EDITOR_BREAKPOINTS = 'UPDATE_EDITOR_BREAKPOINTS';\nexport const UPDATE_HAS_UNSAVED_CHANGES = 'UPDATE_HAS_UNSAVED_CHANGES';\nexport const UPDATE_REPL_VALUE = 'UPDATE_REPL_VALUE';\nexport const UPDATE_WORKSPACE = 'UPDATE_WORKSPACE';\nexport const UPDATE_SUBLANGUAGE = 'UPDATE_SUBLANGUAGE';\nexport const CHANGE_SUBLANGUAGE = 'CHANGE_SUBLANGUAGE';\n\nexport type WorkspaceLocation = keyof WorkspaceManagerState;\n\ntype AssessmentWorkspaceAttr = {\n  readonly currentAssessment?: number;\n  readonly currentQuestion?: number;\n  readonly hasUnsavedChanges: boolean;\n};\ntype AssessmentWorkspaceState = AssessmentWorkspaceAttr & WorkspaceState;\n\ntype GradingWorkspaceAttr = {\n  readonly currentSubmission?: number;\n  readonly currentQuestion?: number;\n  readonly hasUnsavedChanges: boolean;\n};\ntype GradingWorkspaceState = GradingWorkspaceAttr & WorkspaceState;\n\ntype PlaygroundWorkspaceAttr = {\n  readonly usingSubst: boolean;\n};\nexport type PlaygroundWorkspaceState = PlaygroundWorkspaceAttr & WorkspaceState;\n\nexport type SicpWorkspaceState = PlaygroundWorkspaceState;\n\nexport type WorkspaceManagerState = {\n  readonly assessment: AssessmentWorkspaceState;\n  readonly grading: GradingWorkspaceState;\n  readonly playground: PlaygroundWorkspaceState;\n  readonly sourcecast: SourcecastWorkspaceState;\n  readonly sourcereel: SourcereelWorkspaceState;\n  readonly sicp: SicpWorkspaceState;\n  readonly githubAssessment: GitHubAssessmentWorkspaceState;\n};\n\nexport type EditorTabState = {\n  readonly value: string;\n  readonly prependValue: string;\n  readonly postpendValue: string;\n  readonly highlightedLines: HighlightedLines[];\n  readonly breakpoints: string[];\n  readonly newCursorPosition?: Position;\n};\n\nexport type WorkspaceState = {\n  readonly autogradingResults: AutogradingResult[];\n  readonly context: Context;\n  readonly activeEditorTabIndex: number | null;\n  readonly editorTabs: EditorTabState[];\n  readonly editorSessionId: string;\n  readonly editorTestcases: Testcase[];\n  readonly execTime: number;\n  readonly isRunning: boolean;\n  readonly isDebugging: boolean;\n  readonly enableDebugging: boolean;\n  readonly isEditorAutorun: boolean;\n  readonly isEditorReadonly: boolean;\n  readonly output: InterpreterOutput[];\n  readonly externalLibrary: ExternalLibraryName;\n  readonly replHistory: ReplHistory;\n  readonly replValue: string;\n  readonly sharedbConnected: boolean;\n  readonly sideContentHeight?: number;\n  readonly stepLimit: number;\n  readonly globals: Array<[string, any]>;\n  readonly debuggerContext: DebuggerContext;\n};\n\ntype ReplHistory = {\n  browseIndex: null | number; // [0, 49] if browsing, else null\n  records: string[];\n  originalValue: string;\n};\n\nexport type DebuggerContext = {\n  result: any;\n  lastDebuggerResult: any;\n  code: string;\n  context: Context;\n  workspaceLocation?: WorkspaceLocation;\n};\n","import {\n  AchievementGoal,\n  AchievementItem,\n  GoalDefinition,\n  GoalMeta,\n  GoalType\n} from '../../../features/achievement/AchievementTypes';\n\nexport const backendifyGoalDefinition = (goal: GoalDefinition) => ({\n  targetCount: goal.meta.type === GoalType.ASSESSMENT ? 1 : goal.meta.targetCount,\n  meta: goal.meta,\n  text: goal.text,\n  type: goal.meta.type,\n  uuid: goal.uuid\n});\n\nexport const frontendifyAchievementGoal = (goal: any) =>\n  ({\n    uuid: goal.uuid || '',\n    text: goal.text || '',\n    achievementUuids: goal.achievementUuids,\n    meta: (goal.meta.type === 'Event'\n      ? {\n          ...goal.meta,\n          release: goal.meta.release ? new Date(goal.meta.release) : undefined,\n          deadline: goal.meta.deadline ? new Date(goal.meta.deadline) : undefined,\n          observeFrom: goal.meta.observeFrom ? new Date(goal.meta.observeFrom) : undefined,\n          observeTo: goal.meta.observeTo ? new Date(goal.meta.observeTo) : undefined\n        }\n      : goal.meta) as GoalMeta,\n    count: goal.count,\n    targetCount: goal.targetCount,\n    completed: goal.count >= goal.targetCount\n  } as AchievementGoal);\n\nexport const frontendifyAchievementItem = (achievement: any) =>\n  ({\n    uuid: achievement.uuid || '',\n    title: achievement.title || '',\n    xp: achievement.xp,\n    isVariableXp: achievement.isVariableXp,\n    deadline: achievement.deadline === null ? undefined : new Date(achievement.deadline),\n    release: achievement.release === null ? undefined : new Date(achievement.release),\n    isTask: achievement.isTask,\n    position: achievement.position,\n    prerequisiteUuids: achievement.prerequisiteUuids,\n    goalUuids: achievement.goalUuids,\n    cardBackground: achievement.cardBackground || '',\n    view: {\n      coverImage: achievement.view.coverImage || '',\n      completionText: achievement.view.completionText || '',\n      description: achievement.view.description || ''\n    }\n  } as AchievementItem);\n\nexport const backendifyAchievementItem = (achievement: AchievementItem) => ({\n  ...achievement,\n  deadline: achievement.deadline ? achievement.deadline : null,\n  release: achievement.release ? achievement.release : null\n});\n","import { call } from 'redux-saga/effects';\n\nimport {\n  AchievementGoal,\n  AchievementItem,\n  AchievementUser,\n  GoalDefinition,\n  GoalProgress\n} from '../../features/achievement/AchievementTypes';\nimport { GradingSummary } from '../../features/dashboard/DashboardTypes';\nimport { Grading, GradingOverview, GradingQuestion } from '../../features/grading/GradingTypes';\nimport {\n  Device,\n  WebSocketEndpointInformation\n} from '../../features/remoteExecution/RemoteExecutionTypes';\nimport { PlaybackData, SourcecastData } from '../../features/sourceRecorder/SourceRecorderTypes';\nimport { UsernameRoleGroup } from '../../pages/academy/adminPanel/subcomponents/AddUserPanel';\nimport { store } from '../../pages/createStore';\nimport {\n  backendifyAchievementItem,\n  backendifyGoalDefinition,\n  frontendifyAchievementGoal,\n  frontendifyAchievementItem\n} from '../achievement/utils/AchievementBackender';\nimport { Role } from '../application/ApplicationTypes';\nimport { ExternalLibraryName } from '../application/types/ExternalTypes';\nimport {\n  AdminPanelCourseRegistration,\n  CourseConfiguration,\n  CourseRegistration,\n  Tokens,\n  UpdateCourseConfiguration,\n  User\n} from '../application/types/SessionTypes';\nimport {\n  Assessment,\n  AssessmentConfiguration,\n  AssessmentOverview,\n  ContestEntry,\n  GradingStatus,\n  IContestVotingQuestion,\n  IProgrammingQuestion,\n  QuestionType,\n  QuestionTypes\n} from '../assessment/AssessmentTypes';\nimport { Notification } from '../notificationBadge/NotificationBadgeTypes';\nimport { actions } from '../utils/ActionsHelper';\nimport { castLibrary } from '../utils/CastBackend';\nimport Constants from '../utils/Constants';\nimport { showWarningMessage } from '../utils/NotificationsHelper';\n\n/**\n * @property accessToken - backend access token\n * @property errorMessage - message to showWarningMessage on failure\n * @property body - request body, for HTTP POST\n * @property noContentType - set to true when sending multipart data\n * @property noHeaderAccept - if Accept: application/json should be omitted\n * @property refreshToken - backend refresh token\n * @property shouldRefresh - if should attempt to refresh access token\n *\n * If shouldRefresh, accessToken and refreshToken are required.\n */\ntype RequestOptions = {\n  accessToken?: string;\n  errorMessage?: string;\n  body?: object;\n  noContentType?: boolean;\n  noHeaderAccept?: boolean;\n  refreshToken?: string;\n  shouldAutoLogout?: boolean;\n  shouldRefresh?: boolean;\n};\n\n/**\n * POST /auth/login\n */\nexport const postAuth = async (\n  code: string,\n  providerId: string,\n  clientId?: string,\n  redirectUri?: string\n): Promise<Tokens | null> => {\n  const resp = await request('auth/login', 'POST', {\n    body: {\n      code,\n      provider: providerId,\n      ...(clientId ? { client_id: clientId } : {}),\n      ...(redirectUri ? { redirect_uri: redirectUri } : {})\n    },\n    errorMessage: 'Could not login. Please contact the module administrator.'\n  });\n  if (!resp) {\n    return null;\n  }\n  const tokens = await resp.json();\n  return {\n    accessToken: tokens.access_token,\n    refreshToken: tokens.refresh_token\n  };\n};\n\n/**\n * POST /auth/refresh\n */\nconst postRefresh = async (refreshToken: string): Promise<Tokens | null> => {\n  const resp = await request('auth/refresh', 'POST', {\n    body: { refresh_token: refreshToken }\n  });\n  if (!resp) {\n    return null;\n  }\n\n  const tokens = await resp.json();\n\n  return {\n    accessToken: tokens.access_token,\n    refreshToken: tokens.refresh_token\n  };\n};\n\n/**\n * GET /user\n */\nexport const getUser = async (\n  tokens: Tokens\n): Promise<{\n  user: User | null;\n  courseRegistration: CourseRegistration | null;\n  courseConfiguration: CourseConfiguration | null;\n  assessmentConfigurations: AssessmentConfiguration[] | null;\n}> => {\n  const resp = await request('user', 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n  if (!resp || !resp.ok) {\n    return {\n      user: null,\n      courseRegistration: null,\n      courseConfiguration: null,\n      assessmentConfigurations: null\n    };\n  }\n\n  return await resp.json();\n};\n\n/**\n * GET /user/latest_viewed_course\n */\nexport const getLatestCourseRegistrationAndConfiguration = async (\n  tokens: Tokens\n): Promise<{\n  courseRegistration: CourseRegistration | null;\n  courseConfiguration: CourseConfiguration | null;\n  assessmentConfigurations: AssessmentConfiguration[] | null;\n}> => {\n  const resp = await request('user/latest_viewed_course', 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n  if (!resp || !resp.ok) {\n    return {\n      courseRegistration: null,\n      courseConfiguration: null,\n      assessmentConfigurations: null\n    };\n  }\n\n  return await resp.json();\n};\n\n/**\n * PUT /user/latest_viewed_course\n */\nexport const putLatestViewedCourse = async (\n  tokens: Tokens,\n  courseId: number\n): Promise<Response | null> => {\n  const resp = await request(`user/latest_viewed_course`, 'PUT', {\n    ...tokens,\n    body: { courseId: courseId },\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * PUT /courses/{courseId}/user/research_agreement\n */\nexport const putCourseResearchAgreement = async (\n  tokens: Tokens,\n  agreedToResearch: boolean\n): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/user/research_agreement`, 'PUT', {\n    ...tokens,\n    body: { agreedToResearch },\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * POST /config/create\n */\nexport const postCreateCourse = async (\n  tokens: Tokens,\n  courseConfig: UpdateCourseConfiguration\n): Promise<Response | null> => {\n  const resp = await request(`config/create`, 'POST', {\n    ...tokens,\n    body: { ...courseConfig },\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * GET /courses/{courseId}/config\n */\nexport const getCourseConfig = async (tokens: Tokens): Promise<CourseConfiguration | null> => {\n  const resp = await request(`${courseId()}/config`, 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n\n  if (!resp || !resp.ok) {\n    return null;\n  }\n\n  return resp.json();\n};\n\n/**\n * GET /courses/{courseId}/achievements\n *\n * Will be updated after a separate db for student progress is ready\n */\nexport const getAchievements = async (tokens: Tokens): Promise<AchievementItem[] | null> => {\n  const resp = await request(`${courseId()}/achievements`, 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n\n  if (!resp || !resp.ok) {\n    return null; // invalid accessToken _and_ refreshToken\n  }\n\n  const achievements = await resp.json();\n\n  return achievements.map((achievement: any) => frontendifyAchievementItem(achievement));\n};\n\n/**\n * GET /courses/{courseId}/admin/users/{studentCourseRegId}/goals\n */\nexport const getGoals = async (\n  tokens: Tokens,\n  studentCourseRegId: number\n): Promise<AchievementGoal[] | null> => {\n  const resp = await request(`${courseId()}/admin/users/${studentCourseRegId}/goals`, 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n\n  if (!resp || !resp.ok) {\n    return null;\n  }\n\n  const achievementGoals = await resp.json();\n\n  return achievementGoals.map((goal: any) => frontendifyAchievementGoal(goal));\n};\n\n/**\n * GET /courses/{courseId}/self/goals\n */\nexport const getOwnGoals = async (tokens: Tokens): Promise<AchievementGoal[] | null> => {\n  const resp = await request(`${courseId()}/self/goals`, 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n\n  if (!resp || !resp.ok) {\n    return null; // invalid accessToken _and_ refreshToken\n  }\n\n  const achievementGoals = await resp.json();\n\n  return achievementGoals.map((goal: any) => frontendifyAchievementGoal(goal));\n};\n\n/**\n * GET /courses/{courseId}/admin/users\n */\nexport const getAllUsers = async (tokens: Tokens): Promise<AchievementUser[] | null> => {\n  const resp = await request(`${courseId()}/admin/users`, 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n\n  if (!resp || !resp.ok) {\n    return null; // invalid accessToken _and_ refreshToken\n  }\n\n  const users = await resp.json();\n\n  return users.map(\n    (user: any): AchievementUser => ({\n      name: user.name,\n      courseRegId: user.courseRegId,\n      group: user.group,\n      username: user.username\n    })\n  );\n};\n\n/**\n * PUT /courses/{courseId}/admin/achievements\n */\nexport async function bulkUpdateAchievements(\n  achievements: AchievementItem[],\n  tokens: Tokens\n): Promise<Response | null> {\n  const resp = await request(`${courseId()}/admin/achievements`, 'PUT', {\n    accessToken: tokens.accessToken,\n    body: { achievements: achievements.map(achievement => backendifyAchievementItem(achievement)) },\n    noHeaderAccept: true,\n    refreshToken: tokens.refreshToken,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n  // TODO: confirmation notification\n}\n\n/**\n * PUT /courses/{courseId}/admin/goals\n */\nexport async function bulkUpdateGoals(\n  goals: GoalDefinition[],\n  tokens: Tokens\n): Promise<Response | null> {\n  const resp = await request(`${courseId()}/admin/goals`, 'PUT', {\n    accessToken: tokens.accessToken,\n    body: {\n      goals: goals.map(goal => backendifyGoalDefinition(goal))\n    },\n    noHeaderAccept: true,\n    refreshToken: tokens.refreshToken,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n  // TODO: confirmation notification\n}\n\n/**\n * POST /courses/{courseId}/self/goals/{goalUuid}/progress\n */\nexport const updateOwnGoalProgress = async (\n  progress: GoalProgress,\n  tokens: Tokens\n): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/self/goals/${progress.uuid}/progress`, 'POST', {\n    ...tokens,\n    body: { progress: progress },\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * POST /courses/{courseId}/admin/users/{studentCourseRegId}/goals/{goalUuid}/progress\n */\nexport const updateGoalProgress = async (\n  studentCourseRegId: number,\n  progress: GoalProgress,\n  tokens: Tokens\n): Promise<Response | null> => {\n  const resp = await request(\n    `${courseId()}/admin/users/${studentCourseRegId}/goals/${progress.uuid}/progress`,\n    'POST',\n    {\n      ...tokens,\n      body: { progress: progress },\n      noHeaderAccept: true,\n      shouldAutoLogout: false,\n      shouldRefresh: true\n    }\n  );\n\n  return resp;\n};\n\n/**\n * DELETE /courses/{courseId}/admin/achievements/{achievementUuid}\n */\nexport const removeAchievement = async (uuid: string, tokens: Tokens): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/admin/achievements/${uuid}`, 'DELETE', {\n    ...tokens,\n    body: { uuid: uuid },\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * DELETE /courses/{courseId}/admin/goals/{goalUuid}\n */\nexport const removeGoal = async (uuid: string, tokens: Tokens): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/admin/goals/${uuid}`, 'DELETE', {\n    ...tokens,\n    body: { uuid: uuid },\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * GET /courses/{courseId}/assessments\n */\nexport const getAssessmentOverviews = async (\n  tokens: Tokens\n): Promise<AssessmentOverview[] | null> => {\n  const resp = await request(`${courseId()}/assessments`, 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n  if (!resp || !resp.ok) {\n    return null; // invalid accessToken _and_ refreshToken\n  }\n  const assessmentOverviews = await resp.json();\n  return assessmentOverviews.map((overview: any) => {\n    overview.gradingStatus = computeGradingStatus(\n      overview.isManuallyGraded,\n      overview.status,\n      overview.gradedCount,\n      overview.questionCount\n    );\n    delete overview.gradedCount;\n    delete overview.questionCount;\n\n    return overview as AssessmentOverview;\n  });\n};\n\n/**\n * GET /courses/{courseId}/user/total_xp\n */\nexport const getTotalXp = async (tokens: Tokens, courseRegId?: number): Promise<number | null> => {\n  let resp;\n  if (courseRegId !== undefined) {\n    // If courseRegId is provided, get the total XP of a specific student\n    resp = await request(`${courseId()}/admin/users/${courseRegId}/total_xp`, 'GET', {\n      ...tokens,\n      shouldRefresh: true\n    });\n  } else {\n    // Otherwise, get the total XP of the current user\n    resp = await request(`${courseId()}/user/total_xp`, 'GET', {\n      ...tokens,\n      shouldRefresh: true\n    });\n  }\n\n  if (!resp || !resp.ok) {\n    return null; // invalid accessToken _and_ refreshToken\n  }\n  const totalXp = await resp.json();\n  return totalXp;\n};\n\n/**\n * GET /courses/{courseId}/admin/users/total_xp\n */\nexport const getAllUserXp = async (tokens: Tokens): Promise<number | null> => {\n  const resp = await request(`${courseId()}/admin/users/total_xp`, 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n  if (!resp || !resp.ok) {\n    return null; // invalid accessToken _and_ refreshToken\n  }\n  const totalXp = await resp.json();\n  return totalXp;\n};\n\n/**\n * GET /courses/{courseId}/admin/users/{course_reg_id}/assessments\n */\nexport const getUserAssessmentOverviews = async (\n  courseRegId: number,\n  tokens: Tokens\n): Promise<AssessmentOverview[] | null> => {\n  const resp = await request(`${courseId()}/admin/users/${courseRegId}/assessments`, 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n  if (!resp || !resp.ok) {\n    return null; // invalid accessToken _and_ refreshToken\n  }\n  const assessmentOverviews = await resp.json();\n  return assessmentOverviews.map((overview: any) => {\n    overview.gradingStatus = computeGradingStatus(\n      overview.isManuallyGraded,\n      overview.status,\n      overview.gradedCount,\n      overview.questionCount\n    );\n    delete overview.gradedCount;\n    delete overview.questionCount;\n\n    return overview as AssessmentOverview;\n  });\n};\n\n/**\n * GET /courses/{courseId}/assessments/{assessmentId}\n * Note: if assessment is password-protected, a corresponding unlock request will be sent to\n * POST /courses/{courseId}/assessments/{assessmentId}/unlock\n */\nexport const getAssessment = async (\n  assessmentId: number,\n  tokens: Tokens,\n  courseRegId?: number\n): Promise<Assessment | null> => {\n  let resp;\n  if (courseRegId !== undefined) {\n    // If courseRegId is provided, we are getting the assessment for another user as an admin\n    resp = await request(\n      `${courseId()}/admin/users/${courseRegId}/assessments/${assessmentId}`,\n      'GET',\n      {\n        ...tokens,\n        shouldRefresh: true\n      }\n    );\n  } else {\n    // Otherwise, we are getting the assessment for the current user\n    resp = await request(`${courseId()}/assessments/${assessmentId}`, 'GET', {\n      ...tokens,\n      shouldAutoLogout: false,\n      shouldRefresh: true\n    });\n  }\n\n  // Attempt to load password-protected assessment\n  while (resp && resp.status === 403) {\n    const input = window.prompt('Please enter password.', '');\n    if (!input) {\n      resp = null;\n      window.history.back();\n      return null;\n    }\n\n    resp = await request(`${courseId()}/assessments/${assessmentId}/unlock`, 'POST', {\n      ...tokens,\n      body: {\n        password: input\n      },\n      shouldAutoLogout: false,\n      shouldRefresh: true\n    });\n  }\n\n  if (!resp || !resp.ok) {\n    return null;\n  }\n\n  const assessment = (await resp.json()) as Assessment;\n\n  assessment.questions = assessment.questions.map(q => {\n    if (q.type === QuestionTypes.programming) {\n      const question = q as IProgrammingQuestion;\n      question.autogradingResults = question.autogradingResults || [];\n      question.prepend = question.prepend || '';\n      question.postpend = question.postpend || '';\n      question.testcases = question.testcases || [];\n      q = question;\n    }\n\n    if (q.type === QuestionTypes.voting) {\n      const question = q as IContestVotingQuestion;\n      question.prepend = question.prepend || '';\n      question.postpend = question.postpend || '';\n    }\n\n    // If the backend returns :nil (null) for grader, then the question is not graded\n    // Delete the grader and gradedAt attributes\n    if (q.grader === null) {\n      delete q.grader;\n      delete q.gradedAt;\n    }\n\n    // Make library.external.name uppercase\n    q.library.external.name = q.library.external.name.toUpperCase() as ExternalLibraryName;\n    // Make globals into an Array of (string, value)\n    q.library.globals = Object.entries(q.library.globals as object).map(entry => {\n      try {\n        entry[1] = (window as any).eval(entry[1]);\n      } catch (e) {}\n      return entry;\n    });\n\n    return q;\n  });\n  return assessment;\n};\n\n/**\n * POST /courses/{courseId}/assessments/question/{questionId}/answer\n */\nexport const postAnswer = async (\n  id: number,\n  answer: string | number | ContestEntry[],\n  tokens: Tokens\n): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/assessments/question/${id}/answer`, 'POST', {\n    ...tokens,\n    body: typeof answer == 'object' ? { answer: answer } : { answer: `${answer}` },\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n  return resp;\n};\n\n/**\n * POST /courses/{courseId}/assessments/{assessmentId}/submit\n */\nexport const postAssessment = async (id: number, tokens: Tokens): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/assessments/${id}/submit`, 'POST', {\n    ...tokens,\n    noHeaderAccept: true,\n    shouldAutoLogout: false, // 400 if some questions unattempted\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/*\n * GET /courses/{courseId}/admin/grading\n */\nexport const getGradingOverviews = async (\n  tokens: Tokens,\n  group: boolean\n): Promise<GradingOverview[] | null> => {\n  const resp = await request(`${courseId()}/admin/grading?group=${group}`, 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n  if (!resp) {\n    return null; // invalid accessToken _and_ refreshToken\n  }\n  const gradingOverviews = await resp.json();\n  return gradingOverviews\n    .map((overview: any) => {\n      const gradingOverview: GradingOverview = {\n        assessmentId: overview.assessment.id,\n        assessmentName: overview.assessment.title,\n        assessmentType: overview.assessment.type,\n        studentId: overview.student.id,\n        studentName: overview.student.name,\n        submissionId: overview.id,\n        submissionStatus: overview.status,\n        groupName: overview.student.groupName,\n        groupLeaderId: overview.student.groupLeaderId,\n        // Grading Status\n        gradingStatus: 'none',\n        questionCount: overview.assessment.questionCount,\n        gradedCount: overview.gradedCount,\n        // XP\n        initialXp: overview.xp,\n        xpAdjustment: overview.xpAdjustment,\n        currentXp: overview.xp + overview.xpAdjustment,\n        maxXp: overview.assessment.maxXp,\n        xpBonus: overview.xpBonus\n      };\n      gradingOverview.gradingStatus = computeGradingStatus(\n        overview.assessment.isManuallyGraded,\n        gradingOverview.submissionStatus,\n        gradingOverview.gradedCount,\n        gradingOverview.questionCount\n      );\n      return gradingOverview;\n    })\n    .sort((subX: GradingOverview, subY: GradingOverview) =>\n      subX.assessmentId !== subY.assessmentId\n        ? subY.assessmentId - subX.assessmentId\n        : subY.submissionId - subX.submissionId\n    );\n};\n\n/**\n * GET /courses/{courseId}/admin/grading/{submissionId}\n */\nexport const getGrading = async (submissionId: number, tokens: Tokens): Promise<Grading | null> => {\n  const resp = await request(`${courseId()}/admin/grading/${submissionId}`, 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n\n  if (!resp) {\n    return null;\n  }\n\n  const gradingResult = await resp.json();\n  const grading: Grading = gradingResult.map((gradingQuestion: any) => {\n    const { student, question, grade } = gradingQuestion;\n    const result = {\n      question: {\n        answer: question.answer,\n        autogradingResults: question.autogradingResults || [],\n        choices: question.choices,\n        content: question.content,\n        id: question.id,\n        library: castLibrary(question.library),\n        solution: gradingQuestion.solution || question.solution || null,\n        solutionTemplate: question.solutionTemplate,\n        prepend: question.prepend || '',\n        postpend: question.postpend || '',\n        testcases: question.testcases || [],\n        type: question.type as QuestionType,\n        maxXp: question.maxXp\n      },\n      student,\n      grade: {\n        xp: grade.xp,\n        xpAdjustment: grade.xpAdjustment,\n        comments: grade.comments\n      }\n    } as GradingQuestion;\n\n    if (gradingQuestion.grade.grader !== null) {\n      result.grade.grader = gradingQuestion.grade.grader;\n      result.grade.gradedAt = gradingQuestion.grade.gradedAt;\n    }\n\n    return result;\n  });\n\n  return grading;\n};\n\n/**\n * POST /courses/{courseId}/admin/grading/{submissionId}/{questionId}\n */\nexport const postGrading = async (\n  submissionId: number,\n  questionId: number,\n  xpAdjustment: number,\n  tokens: Tokens,\n  comments?: string\n): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/admin/grading/${submissionId}/${questionId}`, 'POST', {\n    ...tokens,\n    body: {\n      grading: {\n        xpAdjustment,\n        comments\n      }\n    },\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * POST /courses/{courseId}/admin/grading/{submissionId}/autograde\n */\nexport const postReautogradeSubmission = async (\n  submissionId: number,\n  tokens: Tokens\n): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/admin/grading/${submissionId}/autograde`, 'POST', {\n    ...tokens,\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * POST /courses/{courseId}/admin/grading/{submissionId}/{questionId}/autograde\n */\nexport const postReautogradeAnswer = async (\n  submissionId: number,\n  questionId: number,\n  tokens: Tokens\n): Promise<Response | null> => {\n  const resp = await request(\n    `${courseId()}/admin/grading/${submissionId}/${questionId}/autograde`,\n    'POST',\n    {\n      ...tokens,\n      noHeaderAccept: true,\n      shouldAutoLogout: false,\n      shouldRefresh: true\n    }\n  );\n\n  return resp;\n};\n\n/**\n * POST /courses/{courseId}/admin/grading/{submissionId}/unsubmit\n */\nexport const postUnsubmit = async (\n  submissionId: number,\n  tokens: Tokens\n): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/admin/grading/${submissionId}/unsubmit`, 'POST', {\n    ...tokens,\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * GET /courses/{courseId}/notifications\n */\nexport const getNotifications = async (tokens: Tokens): Promise<Notification[]> => {\n  const resp: Response | null = await request(`${courseId()}/notifications`, 'GET', {\n    ...tokens,\n    shouldAutoLogout: false\n  });\n\n  let notifications: Notification[] = [];\n\n  if (!resp || !resp.ok) {\n    return notifications;\n  }\n\n  const result = await resp.json();\n\n  notifications = result.map((notification: any) => {\n    return {\n      id: notification.id,\n      type: notification.type,\n      assessment_id: notification.assessment_id || undefined,\n      assessment_type: notification.assessment ? notification.assessment.type : undefined,\n      assessment_title: notification.assessment ? notification.assessment.title : undefined,\n      submission_id: notification.submission_id || undefined\n    } as Notification;\n  });\n\n  return notifications;\n};\n\n/**\n * POST /courses/{courseId}/notifications/acknowledge\n */\nexport const postAcknowledgeNotifications = async (\n  tokens: Tokens,\n  ids: number[]\n): Promise<Response | null> => {\n  const resp: Response | null = await request(`${courseId()}/notifications/acknowledge`, 'POST', {\n    ...tokens,\n    body: { notificationIds: ids },\n    shouldAutoLogout: false\n  });\n\n  return resp;\n};\n\n/**\n * GET /courses/{courseId}/sourcecast\n */\nexport const getSourcecastIndex = async (tokens: Tokens): Promise<SourcecastData[] | null> => {\n  const resp = await request(`${courseId()}/sourcecast`, 'GET', {\n    ...tokens,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n  if (!resp || !resp.ok) {\n    return null;\n  }\n\n  return await resp.json();\n};\n\n/**\n * POST /courses/{courseId}/admin/sourcecast\n */\nexport const postSourcecast = async (\n  title: string,\n  description: string,\n  uid: string,\n  audio: Blob,\n  playbackData: PlaybackData,\n  tokens: Tokens\n): Promise<Response | null> => {\n  const formData = new FormData();\n  const filename = Date.now().toString() + '.wav';\n  formData.append('sourcecast[title]', title);\n  formData.append('sourcecast[description]', description);\n  formData.append('sourcecast[uid]', uid);\n  formData.append('sourcecast[audio]', audio, filename);\n  formData.append('sourcecast[playbackData]', JSON.stringify(playbackData));\n  const resp = await request(`${courseId()}/admin/sourcecast`, 'POST', {\n    ...tokens,\n    body: formData,\n    noContentType: true,\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * DELETE /courses/{courseId}/admin/sourcecast/{sourcecastId}\n */\nexport const deleteSourcecastEntry = async (\n  id: number,\n  tokens: Tokens\n): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/admin/sourcecast/${id}`, 'DELETE', {\n    ...tokens,\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * POST /courses/{courseId}/admin/assessments/{assessmentId}\n */\nexport const updateAssessment = async (\n  id: number,\n  body: { openAt?: string; closeAt?: string; isPublished?: boolean },\n  tokens: Tokens\n): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/admin/assessments/${id}`, 'POST', {\n    ...tokens,\n    body: body,\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * DELETE /courses/{courseId}/admin/assessments/{assessmentId}\n */\nexport const deleteAssessment = async (id: number, tokens: Tokens): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/admin/assessments/${id}`, 'DELETE', {\n    ...tokens,\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * POST /courses/{courseId}/admin/assessments\n */\nexport const uploadAssessment = async (\n  file: File,\n  tokens: Tokens,\n  forceUpdate: boolean,\n  assessmentConfigId: number\n): Promise<Response | null> => {\n  const formData = new FormData();\n  formData.append('assessment[file]', file);\n  formData.append('forceUpdate', String(forceUpdate));\n  formData.append('assessmentConfigId', String(assessmentConfigId));\n  const resp = await request(`${courseId()}/admin/assessments`, 'POST', {\n    ...tokens,\n    body: formData,\n    noContentType: true,\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * GET /courses/{courseId}/admin/grading/summary\n */\nexport const getGradingSummary = async (tokens: Tokens): Promise<GradingSummary | null> => {\n  const resp = await request(`${courseId()}/admin/grading/summary`, 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n  if (!resp || !resp.ok) {\n    return null;\n  }\n\n  return await resp.json();\n};\n\n/**\n * PUT /courses/{courseId}/admin/config\n */\nexport const putCourseConfig = async (\n  tokens: Tokens,\n  courseConfig: UpdateCourseConfiguration\n): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/admin/config`, 'PUT', {\n    ...tokens,\n    body: courseConfig,\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * GET /courses/{courseId}/admin/config/assessment_configs\n */\nexport const getAssessmentConfigs = async (\n  tokens: Tokens\n): Promise<AssessmentConfiguration[] | null> => {\n  const resp = await request(`${courseId()}/admin/config/assessment_configs`, 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n  if (!resp || !resp.ok) {\n    return null;\n  }\n\n  return await resp.json();\n};\n\n/**\n * PUT /courses/{courseId}/admin/config/assessment_configs\n */\nexport const putAssessmentConfigs = async (\n  tokens: Tokens,\n  assessmentConfigs: AssessmentConfiguration[],\n  overrideCourseId?: number\n): Promise<Response | null> => {\n  const resp = await request(\n    `${\n      overrideCourseId != null ? `courses/${overrideCourseId}` : courseId()\n    }/admin/config/assessment_configs`,\n    'PUT',\n    {\n      ...tokens,\n      body: { assessmentConfigs },\n      noHeaderAccept: true,\n      shouldAutoLogout: false,\n      shouldRefresh: true\n    }\n  );\n\n  return resp;\n};\n\n/**\n * DELETE /courses/{courseId}/admin/config/assessment_config/{assessmentConfigId}\n */\nexport const removeAssessmentConfig = async (\n  tokens: Tokens,\n  assessmentConfig: AssessmentConfiguration\n): Promise<Response | null> => {\n  const resp = await request(\n    `${courseId()}/admin/config/assessment_config/${assessmentConfig.assessmentConfigId}`,\n    'DELETE',\n    {\n      ...tokens,\n      noHeaderAccept: true,\n      shouldAutoLogout: false,\n      shouldRefresh: true\n    }\n  );\n\n  return resp;\n};\n\n/**\n * GET /courses/{courseId}/admin/users\n */\nexport const getUserCourseRegistrations = async (\n  tokens: Tokens\n): Promise<AdminPanelCourseRegistration[] | null> => {\n  const resp = await request(`${courseId()}/admin/users`, 'GET', {\n    ...tokens,\n    shouldRefresh: true\n  });\n  if (!resp || !resp.ok) {\n    return null;\n  }\n\n  return await resp.json();\n};\n\n/**\n * PUT /courses/{courseId}/admin/users\n */\nexport const putNewUsers = async (\n  tokens: Tokens,\n  users: UsernameRoleGroup[],\n  provider: string\n): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/admin/users`, 'PUT', {\n    ...tokens,\n    body: { users, provider },\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * PUT /courses/{courseId}/admin/users/{courseRegId}/role\n */\nexport const putUserRole = async (\n  tokens: Tokens,\n  courseRegId: number,\n  role: Role\n): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/admin/users/${courseRegId}/role`, 'PUT', {\n    ...tokens,\n    body: { role },\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * DELETE /courses/{courseId}/admin/users/{courseRegId}\n */\nexport const removeUserCourseRegistration = async (\n  tokens: Tokens,\n  courseRegId: number\n): Promise<Response | null> => {\n  const resp = await request(`${courseId()}/admin/users/${courseRegId}`, 'DELETE', {\n    ...tokens,\n    noHeaderAccept: true,\n    shouldAutoLogout: false,\n    shouldRefresh: true\n  });\n\n  return resp;\n};\n\n/**\n * GET /devices\n */\nexport async function fetchDevices(tokens: Tokens): Promise<Device | null> {\n  const resp = await request(`devices`, 'GET', {\n    accessToken: tokens.accessToken,\n    refreshToken: tokens.refreshToken,\n    shouldRefresh: true\n  });\n\n  return resp && resp.ok ? resp.json() : null;\n}\n\n/**\n * GET /devices/:id/ws_endpoint\n */\nexport async function getDeviceWSEndpoint(\n  device: Device,\n  tokens: Tokens\n): Promise<WebSocketEndpointInformation | null> {\n  const resp = await request(`devices/${device.id}/ws_endpoint`, 'GET', {\n    accessToken: tokens.accessToken,\n    refreshToken: tokens.refreshToken,\n    shouldRefresh: true,\n    shouldAutoLogout: false\n  });\n\n  return resp && resp.ok ? resp.json() : null;\n}\n\n/**\n * POST /devices\n */\nexport async function registerDevice(device: Omit<Device, 'id'>, tokens?: Tokens): Promise<Device> {\n  tokens = fillTokens(tokens);\n  const resp = await request(`devices`, 'POST', {\n    accessToken: tokens.accessToken,\n    refreshToken: tokens.refreshToken,\n    shouldRefresh: true,\n    shouldAutoLogout: false,\n    body: device\n  });\n\n  if (!resp) {\n    throw new Error('Unknown error occurred.');\n  }\n\n  if (!resp.ok) {\n    const message = await resp.text();\n    throw new Error(`Failed to register: ${message}`);\n  }\n\n  return resp.json();\n}\n\n/**\n * POST /devices/:id\n */\nexport async function editDevice(\n  device: Pick<Device, 'id' | 'title'>,\n  tokens?: Tokens\n): Promise<boolean> {\n  tokens = fillTokens(tokens);\n  const resp = await request(`devices/${device.id}`, 'POST', {\n    accessToken: tokens.accessToken,\n    refreshToken: tokens.refreshToken,\n    shouldRefresh: true,\n    shouldAutoLogout: false,\n    body: { title: device.title }\n  });\n\n  if (!resp) {\n    throw new Error('Unknown error occurred.');\n  }\n\n  if (!resp.ok) {\n    const message = await resp.text();\n    throw new Error(`Failed to edit: ${message}`);\n  }\n\n  return true;\n}\n\n/**\n * DELETE /devices/:id\n */\nexport async function deleteDevice(device: Pick<Device, 'id'>, tokens?: Tokens): Promise<boolean> {\n  tokens = fillTokens(tokens);\n  const resp = await request(`devices/${device.id}`, 'DELETE', {\n    accessToken: tokens.accessToken,\n    refreshToken: tokens.refreshToken,\n    shouldRefresh: true\n  });\n\n  if (!resp) {\n    throw new Error('Unknown error occurred.');\n  }\n\n  if (!resp.ok) {\n    const message = await resp.text();\n    throw new Error(`Failed to delete: ${message}`);\n  }\n\n  return true;\n}\n\nfunction fillTokens(tokens?: Tokens): Tokens {\n  tokens = tokens || getTokensFromStore();\n  if (!tokens) {\n    throw new Error('Not logged in.');\n  }\n  return tokens;\n}\n\nfunction getTokensFromStore(): Tokens | undefined {\n  const { accessToken, refreshToken } = store.getState().session;\n  return accessToken && refreshToken ? { accessToken, refreshToken } : undefined;\n}\n\n/**\n * @returns {(Response|null)} Response if successful, otherwise null.\n *\n * @see @type{RequestOptions} for options to this function.\n *\n * If opts.shouldRefresh, an initial response status of < 200 or > 299 will\n * cause this function to call postRefresh to attempt to setToken with fresh\n * tokens.\n *\n * If fetch throws an error, or final response has status code < 200 or > 299,\n * this function will cause the user to logout.\n */\nexport const request = async (\n  path: string,\n  method: string,\n  opts: RequestOptions\n): Promise<Response | null> => {\n  const headers = new Headers();\n  if (!opts.noHeaderAccept) {\n    headers.append('Accept', 'application/json');\n  }\n  if (opts.accessToken) {\n    headers.append('Authorization', `Bearer ${opts.accessToken}`);\n  }\n\n  const fetchOpts: any = { method, headers };\n  if (opts.body) {\n    if (opts.noContentType) {\n      // Content Type is not needed for sending multipart data\n      fetchOpts.body = opts.body;\n    } else {\n      headers.append('Content-Type', 'application/json');\n      fetchOpts.body = JSON.stringify(opts.body);\n    }\n  }\n\n  try {\n    const resp = await fetch(`${Constants.backendUrl}/v2/${path}`, fetchOpts);\n\n    // response.ok is (200 <= response.status <= 299)\n    // response.status of > 299 does not raise error; so deal with in in the try clause\n    if (opts.shouldRefresh && resp && resp.status === 401) {\n      const newTokens = await postRefresh(opts.refreshToken!);\n      store.dispatch(actions.setTokens(newTokens!));\n      const newOpts = {\n        ...opts,\n        accessToken: newTokens!.accessToken,\n        shouldRefresh: false\n      };\n      return request(path, method, newOpts);\n    }\n\n    if (resp && !resp.ok && opts.shouldAutoLogout === false) {\n      // this clause is mostly for SUBMIT_ANSWER; show an error message instead\n      // and ask student to manually logout, so that they have a chance to save\n      // their answers\n      return resp;\n    }\n\n    if (!resp.ok) {\n      showWarningMessage(\n        opts.errorMessage\n          ? opts.errorMessage\n          : `Error while communicating with backend: ${resp.status} ${resp.statusText}${\n              resp.status === 401 || resp.status === 403\n                ? '; try logging in again, after manually saving any work.'\n                : ''\n            }`\n      );\n      return null;\n    }\n\n    return resp;\n  } catch (e) {\n    showWarningMessage(\n      opts.errorMessage\n        ? opts.errorMessage\n        : 'Error while communicating with backend; check your network?'\n    );\n\n    return null;\n  }\n};\n\n/**\n * Handles display of warning notifications for failed HTTP requests, i.e. those with no response\n * or a HTTP error status code (not 2xx).\n *\n * @param {(Response|null)} resp Result of the failed HTTP request\n */\nexport function* handleResponseError(resp: Response | null): any {\n  // Default: check if the response is null\n  if (!resp) {\n    yield call(showWarningMessage, \"Couldn't reach our servers. Are you online?\");\n    return;\n  }\n\n  let respText = yield resp.text();\n\n  if (respText.length > 100 && resp.status) {\n    // This happens when error is not properly handled in backend\n    // Hence returning status code instead for bug reporting\n    respText = `Something went wrong (got ${resp.status} response)`;\n  }\n\n  yield call(showWarningMessage, respText);\n}\n\nconst computeGradingStatus = (\n  isManuallyGraded: boolean,\n  submissionStatus: any,\n  numGraded: number,\n  numQuestions: number\n): GradingStatus =>\n  // isGraded refers to whether the assessment type is graded or not, as specified in\n  // the respective assessment configuration\n  isManuallyGraded && submissionStatus === 'submitted'\n    ? numGraded === 0\n      ? 'none'\n      : numGraded === numQuestions\n      ? 'graded'\n      : 'grading'\n    : 'excluded';\n\nconst courseId: () => string = () => {\n  const id = store.getState().session.courseId;\n  if (id) {\n    return `courses/${id}`;\n  } else {\n    // TODO: Rewrite this logic\n    showWarningMessage(`No course selected!`, 1000);\n    throw new Error(`No course selected`);\n  }\n};\n","import { ExternalLibraryName } from '../application/types/ExternalTypes';\nimport { Library } from '../assessment/AssessmentTypes';\n\n/**\n * Casts a library returned by an API call to a\n * Library used in the frontend.\n */\nexport const castLibrary = (lib: any): Library => ({\n  external: {\n    /** external names are lowercase for API results */\n    name: lib.external.name.toUpperCase() as ExternalLibraryName,\n    symbols: lib.external.symbols\n  },\n  // backend provides `null` if these fields are not set, but frontend wants undefined (for defaulting)\n  execTimeMs: lib.execTimeMs == null ? undefined : lib.execTimeMs,\n  variant: lib.variant == null ? undefined : lib.variant,\n  /** globals are passed as an object, mapping symbol name -> value */\n  globals: Object.entries(lib.globals as object).map(entry => {\n    /** The value that is passed is evaluated into an actual JS value */\n    try {\n      entry[1] = (window as any).eval(entry[1]);\n    } catch (e) {}\n    return entry;\n  })\n});\n","import React, { RefObject } from 'react';\nimport { TypedUseSelectorHook, useSelector } from 'react-redux';\nimport { useMediaQuery } from 'react-responsive';\n\nimport { OverallState } from '../application/ApplicationTypes';\nimport Constants from './Constants';\nimport { readLocalStorage, setLocalStorage } from './LocalStorageHelper';\n\n/**\n * This hook sends a request to the backend to fetch the initial state of the field\n *\n * @param requestFn The function that creates a request\n * @param defaultValue T\n */\nexport function useRequest<T>(requestFn: () => Promise<T>, defaultValue: T) {\n  const [value, setValue] = React.useState<T>(defaultValue);\n\n  React.useEffect(() => {\n    (async () => {\n      const fetchedValue = await requestFn();\n      setValue(fetchedValue);\n    })();\n  }, [requestFn]);\n\n  return { value, setValue };\n}\n\n/**\n * This hook creates an input prop that can\n * be attached as props for text fields.\n * When attached as prop, any change in the text field\n * will cause the value of the hook to change\n *\n * @param defaultValue default value of input field\n */\nexport function useInput<T>(defaultValue: T) {\n  const [value, setValue] = React.useState<T>(defaultValue);\n\n  return {\n    value,\n    setValue,\n    inputProps: {\n      value,\n      onChange: (event: any) => {\n        setValue(event.target.value);\n      }\n    }\n  };\n}\n\n/**\n * This hook usage is similar to React.useState, the only difference\n * being that the state is also written to local storage at the specified key on state updates.\n *\n * When calling this hook, the value will take on the stored value in local storage (if any).\n * If this key-value does not exist in local storage yet, the default value will be used.\n */\nexport function useLocalStorageState<T>(\n  key: string,\n  defaultValue: T\n): [T, React.Dispatch<React.SetStateAction<T>>] {\n  const [value, setValue] = React.useState<T>(readLocalStorage(key, defaultValue));\n\n  React.useEffect(() => {\n    setLocalStorage(key, value);\n  }, [key, value]);\n\n  return [value, setValue];\n}\n\n/** Typed version of useSelector. Use this instead of the useSelector hook. */\nexport const useTypedSelector: TypedUseSelectorHook<OverallState> = useSelector;\n/**\n * Dynamically returns the dimensions (width & height) of an HTML element, updating whenever the\n * element is loaded or resized.\n *\n * @param ref A reference to the underlying HTML element.\n */\n\nexport const useDimensions = (ref: RefObject<HTMLElement>): [width: number, height: number] => {\n  const [width, setWidth] = React.useState<number>(0);\n  const [height, setHeight] = React.useState<number>(0);\n\n  const resizeObserver = React.useMemo(\n    () =>\n      new ResizeObserver((entries: ResizeObserverEntry[], observer: ResizeObserver) => {\n        if (entries.length !== 1) {\n          throw new Error(\n            'Expected only a single HTML element to be observed by the ResizeObserver.'\n          );\n        }\n        const contentRect = entries[0].contentRect;\n        setWidth(contentRect.width);\n        setHeight(contentRect.height);\n      }),\n    []\n  );\n\n  React.useEffect(() => {\n    const htmlElement = ref.current;\n    if (htmlElement === null) {\n      return;\n    }\n    resizeObserver.observe(htmlElement);\n    return () => resizeObserver.disconnect();\n  }, [ref, resizeObserver]);\n\n  return [width, height];\n};\n\n/**\n * Returns whether the current view falls under mobile\n * or desktop as defined by the constants file.\n */\nexport const useResponsive = () => {\n  const isMobileBreakpoint = useMediaQuery({ maxWidth: Constants.mobileBreakpoint });\n  return { isMobileBreakpoint };\n};\n","export const readLocalStorage = (key: string, defaultValue?: any) => {\n  const localStorageValue = window.localStorage.getItem(key);\n  return localStorageValue ? JSON.parse(localStorageValue) : defaultValue;\n};\n\nexport const setLocalStorage = (key: string, value: any) => {\n  window.localStorage.setItem(key, JSON.stringify(value));\n};\n","import { Ace } from 'ace-builds/ace';\nimport { Chapter } from 'c-slang/dist/types';\n\nimport { ExternalLibraryName } from '../../commons/application/types/ExternalTypes';\nimport { Position } from '../../commons/editor/EditorTypes';\nimport { SideContentType } from '../../commons/sideContent/SideContentTypes';\n\nexport const SAVE_SOURCECAST_DATA = 'SAVE_SOURCECAST_DATA';\nexport const SET_CURRENT_PLAYER_TIME = 'SET_CURRENT_PLAYER_TIME';\nexport const SET_CODE_DELTAS_TO_APPLY = 'SET_CODE_DELTAS_TO_APPLY';\nexport const SET_INPUT_TO_APPLY = 'SET_INPUT_TO_APPLY';\nexport const SET_SOURCECAST_DATA = 'SET_SOURCECAST_DATA';\nexport const SET_SOURCECAST_PLAYBACK_DURATION = 'SET_SOURCECAST_PLAYBACK_DURATION';\nexport const SET_SOURCECAST_PLAYBACK_STATUS = 'SET_SOURCECAST_PLAYBACK_STATUS';\n\nexport type InputTypeShape = {\n  activeTabChange: SideContentType;\n  chapterSelect: number;\n  cursorPositionChange: Position;\n  codeDelta: CodeDelta;\n  externalLibrarySelect: ExternalLibraryName;\n  forcePause: null;\n  keyboardCommand: KeyboardCommand;\n  selectionRangeData: SelectionData;\n};\n\nexport enum KeyboardCommand {\n  run = 'run'\n}\n\nexport enum PlaybackStatus {\n  forcedPaused = 'forcedPaused',\n  playing = 'playing',\n  paused = 'paused'\n}\n\nexport type CodeDelta = Ace.Delta;\n\nexport type SelectionRange = Ace.Range;\n\nexport type SelectionData = {\n  range: SelectionRange;\n  isBackwards: boolean;\n};\n\n// Refer: https://stackoverflow.com/questions/55758713/match-pair-for-keyof-and-valueof-an-interface\nexport type Input = keyof InputTypeShape extends infer K\n  ? K extends keyof InputTypeShape\n    ? { time: number; type: K; data: InputTypeShape[K] }\n    : never\n  : never;\n\nexport type PlaybackData = {\n  init: {\n    chapter: Chapter;\n    externalLibrary: ExternalLibraryName;\n    editorValue: string;\n  };\n  inputs: Input[];\n};\n\nexport type SourcecastData = {\n  title: string;\n  description: string;\n  uid: string;\n  inserted_at: string;\n  updated_at: string;\n  playbackData: string;\n  id: number;\n  uploader: {\n    id: number;\n    name: string;\n  };\n  url: string;\n};\n\nexport enum RecordingStatus {\n  notStarted = 'notStarted',\n  recording = 'recording',\n  paused = 'paused',\n  finished = 'finished'\n}\n","import { action } from 'typesafe-actions'; // EDITED\n\nimport { Grading, GradingOverview } from '../../../features/grading/GradingTypes';\nimport {\n  Assessment,\n  AssessmentConfiguration,\n  AssessmentOverview,\n  ContestEntry\n} from '../../assessment/AssessmentTypes';\nimport { MissionRepoData } from '../../githubAssessments/GitHubMissionTypes';\nimport {\n  Notification,\n  NotificationFilterFunction\n} from '../../notificationBadge/NotificationBadgeTypes';\nimport { generateOctokitInstance } from '../../utils/GitHubPersistenceHelper';\nimport { Role } from '../ApplicationTypes';\nimport {\n  ACKNOWLEDGE_NOTIFICATIONS,\n  AdminPanelCourseRegistration,\n  CourseRegistration,\n  DELETE_ASSESSMENT_CONFIG,\n  DELETE_USER_COURSE_REGISTRATION,\n  FETCH_ADMIN_PANEL_COURSE_REGISTRATIONS,\n  FETCH_ALL_USER_XP,\n  FETCH_ASSESSMENT,\n  FETCH_ASSESSMENT_ADMIN,\n  FETCH_ASSESSMENT_CONFIGS,\n  FETCH_ASSESSMENT_OVERVIEWS,\n  FETCH_AUTH,\n  FETCH_COURSE_CONFIG,\n  FETCH_GRADING,\n  FETCH_GRADING_OVERVIEWS,\n  FETCH_NOTIFICATIONS,\n  FETCH_TOTAL_XP,\n  FETCH_TOTAL_XP_ADMIN,\n  FETCH_USER_AND_COURSE,\n  LOGIN,\n  LOGIN_GITHUB,\n  LOGOUT_GITHUB,\n  LOGOUT_GOOGLE,\n  REAUTOGRADE_ANSWER,\n  REAUTOGRADE_SUBMISSION,\n  REMOVE_GITHUB_OCTOKIT_OBJECT_AND_ACCESS_TOKEN,\n  SET_ADMIN_PANEL_COURSE_REGISTRATIONS,\n  SET_ASSESSMENT_CONFIGURATIONS,\n  SET_COURSE_CONFIGURATION,\n  SET_COURSE_REGISTRATION,\n  SET_GITHUB_ACCESS_TOKEN,\n  SET_GITHUB_ASSESSMENT,\n  SET_GITHUB_OCTOKIT_OBJECT,\n  SET_GOOGLE_USER,\n  SET_TOKENS,\n  SET_USER,\n  SUBMIT_ANSWER,\n  SUBMIT_ASSESSMENT,\n  SUBMIT_GRADING,\n  SUBMIT_GRADING_AND_CONTINUE,\n  Tokens,\n  UNSUBMIT_SUBMISSION,\n  UPDATE_ALL_USER_XP,\n  UPDATE_ASSESSMENT,\n  UPDATE_ASSESSMENT_CONFIGS,\n  UPDATE_ASSESSMENT_OVERVIEWS,\n  UPDATE_COURSE_CONFIG,\n  UPDATE_COURSE_RESEARCH_AGREEMENT,\n  UPDATE_GRADING,\n  UPDATE_GRADING_OVERVIEWS,\n  UPDATE_LATEST_VIEWED_COURSE,\n  UPDATE_NOTIFICATIONS,\n  UPDATE_TOTAL_XP,\n  UPDATE_USER_ROLE,\n  UpdateCourseConfiguration,\n  User\n} from '../types/SessionTypes';\n\nexport const fetchAuth = (code: string, providerId?: string) =>\n  action(FETCH_AUTH, { code, providerId });\n\nexport const fetchUserAndCourse = () => action(FETCH_USER_AND_COURSE);\n\nexport const fetchCourseConfig = () => action(FETCH_COURSE_CONFIG);\n\nexport const fetchAssessment = (assessmentId: number) => action(FETCH_ASSESSMENT, assessmentId);\n\nexport const fetchAssessmentAdmin = (assessmentId: number, courseRegId: number) =>\n  action(FETCH_ASSESSMENT_ADMIN, { assessmentId, courseRegId });\n\nexport const fetchAssessmentOverviews = () => action(FETCH_ASSESSMENT_OVERVIEWS);\n\nexport const fetchTotalXp = () => action(FETCH_TOTAL_XP);\n\nexport const fetchTotalXpAdmin = (courseRegId: number) => action(FETCH_TOTAL_XP_ADMIN, courseRegId);\n\nexport const fetchAllUserXp = () => action(FETCH_ALL_USER_XP);\n\nexport const fetchGrading = (submissionId: number) => action(FETCH_GRADING, submissionId);\n\n/**\n * @param filterToGroup - param when set to true, only shows submissions under the group\n * of the grader\n */\nexport const fetchGradingOverviews = (filterToGroup = true) =>\n  action(FETCH_GRADING_OVERVIEWS, filterToGroup);\n\nexport const login = (providerId: string) => action(LOGIN, providerId);\n\nexport const logoutGoogle = () => action(LOGOUT_GOOGLE);\n\nexport const loginGitHub = () => action(LOGIN_GITHUB);\n\nexport const logoutGitHub = () => action(LOGOUT_GITHUB);\n\nexport const setTokens = ({ accessToken, refreshToken }: Tokens) =>\n  action(SET_TOKENS, {\n    accessToken,\n    refreshToken\n  });\n\nexport const setUser = (user: User) => action(SET_USER, user);\n\nexport const setCourseConfiguration = (courseConfiguration: UpdateCourseConfiguration) =>\n  action(SET_COURSE_CONFIGURATION, courseConfiguration);\n\nexport const setCourseRegistration = (courseRegistration: Partial<CourseRegistration>) =>\n  action(SET_COURSE_REGISTRATION, courseRegistration);\n\nexport const setAssessmentConfigurations = (assessmentConfigurations: AssessmentConfiguration[]) =>\n  action(SET_ASSESSMENT_CONFIGURATIONS, assessmentConfigurations);\n\nexport const setAdminPanelCourseRegistrations = (\n  courseRegistrations: AdminPanelCourseRegistration[]\n) => action(SET_ADMIN_PANEL_COURSE_REGISTRATIONS, courseRegistrations);\n\nexport const setGoogleUser = (user?: string) => action(SET_GOOGLE_USER, user);\n\nexport const setGitHubAssessment = (missionRepoData: MissionRepoData) =>\n  action(SET_GITHUB_ASSESSMENT, missionRepoData);\n\nexport const setGitHubOctokitObject = (authToken?: string) =>\n  action(SET_GITHUB_OCTOKIT_OBJECT, generateOctokitInstance(authToken || ''));\n\nexport const setGitHubAccessToken = (authToken?: string) =>\n  action(SET_GITHUB_ACCESS_TOKEN, authToken);\n\nexport const removeGitHubOctokitObjectAndAccessToken = () =>\n  action(REMOVE_GITHUB_OCTOKIT_OBJECT_AND_ACCESS_TOKEN);\n\nexport const submitAnswer = (id: number, answer: string | number | ContestEntry[]) =>\n  action(SUBMIT_ANSWER, {\n    id,\n    answer\n  });\n\nexport const submitAssessment = (id: number) => action(SUBMIT_ASSESSMENT, id);\n\nexport const submitGrading = (\n  submissionId: number,\n  questionId: number,\n  xpAdjustment: number = 0,\n  comments?: string\n) =>\n  action(SUBMIT_GRADING, {\n    submissionId,\n    questionId,\n    xpAdjustment,\n    comments\n  });\n\nexport const submitGradingAndContinue = (\n  submissionId: number,\n  questionId: number,\n  xpAdjustment: number = 0,\n  comments?: string\n) =>\n  action(SUBMIT_GRADING_AND_CONTINUE, {\n    submissionId,\n    questionId,\n    xpAdjustment,\n    comments\n  });\n\nexport const reautogradeSubmission = (submissionId: number) =>\n  action(REAUTOGRADE_SUBMISSION, submissionId);\n\nexport const reautogradeAnswer = (submissionId: number, questionId: number) =>\n  action(REAUTOGRADE_ANSWER, { submissionId, questionId });\n\nexport const updateAssessmentOverviews = (overviews: AssessmentOverview[]) =>\n  action(UPDATE_ASSESSMENT_OVERVIEWS, overviews);\n\nexport const updateTotalXp = (totalXp: number) => action(UPDATE_TOTAL_XP, totalXp);\n\nexport const updateAllUserXp = (allUserXp: string[][]) => action(UPDATE_ALL_USER_XP, allUserXp);\n\nexport const updateAssessment = (assessment: Assessment) => action(UPDATE_ASSESSMENT, assessment);\n\nexport const updateGradingOverviews = (overviews: GradingOverview[]) =>\n  action(UPDATE_GRADING_OVERVIEWS, overviews);\n\n/**\n * An extra id parameter is included here because of\n * no id for Grading.\n */\nexport const updateGrading = (submissionId: number, grading: Grading) =>\n  action(UPDATE_GRADING, {\n    submissionId,\n    grading\n  });\n\nexport const unsubmitSubmission = (submissionId: number) =>\n  action(UNSUBMIT_SUBMISSION, {\n    submissionId\n  });\n\n/**\n * Notification actions\n */\n\nexport const fetchNotifications = () => action(FETCH_NOTIFICATIONS);\n\nexport const acknowledgeNotifications = (withFilter?: NotificationFilterFunction) =>\n  action(ACKNOWLEDGE_NOTIFICATIONS, {\n    withFilter\n  });\n\nexport const updateNotifications = (notifications: Notification[]) =>\n  action(UPDATE_NOTIFICATIONS, notifications);\n\nexport const updateLatestViewedCourse = (courseId: number) =>\n  action(UPDATE_LATEST_VIEWED_COURSE, { courseId });\n\nexport const updateCourseConfig = (courseConfiguration: UpdateCourseConfiguration) =>\n  action(UPDATE_COURSE_CONFIG, courseConfiguration);\n\nexport const fetchAssessmentConfigs = () => action(FETCH_ASSESSMENT_CONFIGS);\n\nexport const updateAssessmentConfigs = (assessmentConfigs: AssessmentConfiguration[]) =>\n  action(UPDATE_ASSESSMENT_CONFIGS, assessmentConfigs);\n\nexport const deleteAssessmentConfig = (assessmentConfig: AssessmentConfiguration) =>\n  action(DELETE_ASSESSMENT_CONFIG, assessmentConfig);\n\nexport const fetchAdminPanelCourseRegistrations = () =>\n  action(FETCH_ADMIN_PANEL_COURSE_REGISTRATIONS);\n\nexport const updateUserRole = (courseRegId: number, role: Role) =>\n  action(UPDATE_USER_ROLE, { courseRegId, role });\n\nexport const deleteUserCourseRegistration = (courseRegId: number) =>\n  action(DELETE_USER_COURSE_REGISTRATION, { courseRegId });\n\nexport const updateCourseResearchAgreement = (agreedToResearch: boolean) =>\n  action(UPDATE_COURSE_RESEARCH_AGREEMENT, { agreedToResearch });\n","import React from 'react';\n\nimport AchievementInferencer from '../../commons/achievement/utils/AchievementInferencer';\nimport { Links } from '../../commons/utils/Constants';\nimport { FilterStatus } from './AchievementTypes';\n\nexport const AchievementContext = React.createContext(new AchievementInferencer([], []));\n\nexport enum DeadlineColors {\n  RED = '#f00',\n  BLACK = '#000'\n}\n\nexport enum FilterColors {\n  BLUE = '#4df',\n  WHITE = '#fff'\n}\n\nexport const achievementAssets = `${Links.sourceAcademyAssets}achievement`;\nexport const backgroundUrl = `${achievementAssets}/view-background`;\nexport const cardBackgroundUrl = `${achievementAssets}/card-background`;\nexport const coverImageUrl = `${achievementAssets}/cover-image`;\n\n// Keeping these urls in as comments in case future changes want to use them\n\nexport const getAbilityBackground = () => {\n  return {\n    background: `url(${backgroundUrl}/exploration.png) no-repeat center/cover`\n  };\n  /*\n  switch (ability) {\n    case AchievementAbility.CORE:\n      return {\n        background: `url(${backgroundUrl}/core.png) no-repeat center/cover`\n      };\n    case AchievementAbility.EFFORT:\n      return {\n        background: `url(${backgroundUrl}/effort.png) no-repeat center/cover`\n      };\n    case AchievementAbility.EXPLORATION:\n      return {\n        background: `url(${backgroundUrl}/exploration.png) no-repeat center/cover`\n      };\n    case AchievementAbility.COMMUNITY:\n      return {\n        background: `url(${backgroundUrl}/community.png) no-repeat center/cover`\n      };\n    case AchievementAbility.FLEX:\n      return {\n        background: `url(${backgroundUrl}/flex.png) no-repeat center/cover`\n      };\n    default:\n      return {\n        background: ``\n      };\n  }\n  */\n};\n\nexport const getAbilityColor = () => {\n  return '#9ce'; // blue\n  /*\n  switch (ability) {\n    case AchievementAbility.CORE:\n      return '#fb0'; // gold\n    case AchievementAbility.EFFORT:\n      return '#bf6'; // green\n    case AchievementAbility.EXPLORATION:\n      return '#9ce'; // blue\n    case AchievementAbility.COMMUNITY:\n      return '#f68'; // pink\n    case AchievementAbility.FLEX:\n      return '#fff'; // white\n    default:\n      return '';\n  }\n  */\n};\n\nexport const getAbilityGlow = () => ({\n  border: `1px solid ${getAbilityColor()}`,\n  boxShadow: `0 0 10px ${getAbilityColor()}`\n});\n/*\n  ability === AchievementAbility.FLEX\n    ? {\n        border: `1px solid ${getAbilityColor(ability)}`,\n        boxShadow: `\n          0 0 10px #ff0,   \n          -1px 0 9px #f0f, \n          1px 0 9px #0ff`\n      }\n    : {\n        border: `1px solid ${getAbilityColor(ability)}`,\n        boxShadow: `0 0 10px ${getAbilityColor(ability)}`\n      };\n  */\n\nexport const getFilterColor = (globalStatus: FilterStatus, ownStatus: FilterStatus) =>\n  globalStatus === ownStatus ? FilterColors.BLUE : FilterColors.WHITE;\n\n// Make selected achievement + view glow\nexport const handleGlow = (uuid: string, focusUuid: string) =>\n  uuid === focusUuid ? getAbilityGlow() : undefined;\n\nexport const xpPerLevel = 1000;\n","import { Classes } from '@blueprintjs/core';\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport { Converter } from 'showdown';\n\ntype MarkdownProps = {\n  className?: string;\n  content: string;\n  openLinksInNewWindow?: boolean;\n  simplifiedAutoLink?: boolean;\n  strikethrough?: boolean;\n  tasklists?: boolean;\n};\n\nconst Markdown: React.FC<MarkdownProps> = props => {\n  const converter = new Converter({\n    tables: true,\n    simplifiedAutoLink: props.simplifiedAutoLink,\n    strikethrough: props.strikethrough,\n    tasklists: props.tasklists,\n    openLinksInNewWindow: props.openLinksInNewWindow\n  });\n\n  return (\n    <div\n      className={classNames(props.className ? props.className : 'md', Classes.RUNNING_TEXT)}\n      dangerouslySetInnerHTML={{ __html: converter.makeHtml(props.content) }}\n    />\n  );\n};\n\nexport default React.memo(Markdown);\n","import { NonIdealState, Spinner } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Octokit } from '@octokit/rest';\nimport { GetResponseDataTypeFromEndpointMethod } from '@octokit/types';\nimport * as React from 'react';\nimport { useEffect, useState } from 'react';\nimport { Redirect, Route, Switch, useLocation } from 'react-router-dom';\nimport { useTypedSelector } from 'src/commons/utils/Hooks';\n\nimport ContentDisplay from '../../commons/ContentDisplay';\nimport { MissionRepoData } from '../../commons/githubAssessments/GitHubMissionTypes';\nimport GitHubAssessmentsNavigationBar from '../../commons/navigationBar/subcomponents/GitHubAssessmentsNavigationBar';\nimport { showWarningMessage } from '../../commons/utils/NotificationsHelper';\nimport { assessmentTypeLink } from '../../commons/utils/ParamParseHelper';\nimport GitHubAssessmentListing from './GitHubAssessmentListing';\nimport GitHubAssessmentWorkspaceContainer from './GitHubAssessmentWorkspaceContainer';\nimport GitHubClassroomWelcome from './GitHubClassroomWelcome';\n\ntype DispatchProps = {\n  handleGitHubLogIn: () => void;\n  handleGitHubLogOut: () => void;\n};\n\n/**\n * A page that lists the missions available to the authenticated user.\n * This page should only be reachable if using a GitHub-hosted deployment.\n */\nconst GitHubClassroom: React.FC<DispatchProps> = props => {\n  const location = useLocation<{\n    courses: string[] | undefined;\n    assessmentTypeOverviews: GHAssessmentTypeOverview[] | undefined;\n    selectedCourse: string | undefined;\n  }>();\n  const octokit: Octokit | undefined = useTypedSelector(\n    store => store.session.githubOctokitObject\n  ).octokit;\n  const [courses, setCourses] = useState<string[] | undefined>(location.state?.courses);\n  const [selectedCourse, setSelectedCourse] = useState<string>(\n    location.state?.selectedCourse || ''\n  );\n  const [assessmentTypeOverviews, setAssessmentTypeOverviews] = useState<\n    GHAssessmentTypeOverview[] | undefined\n  >(location.state?.assessmentTypeOverviews);\n  const types = assessmentTypeOverviews?.map(overview => overview.typeName);\n\n  useEffect(() => {\n    if (octokit === undefined) {\n      return;\n    }\n\n    if (!courses) {\n      fetchCourses(octokit, setCourses, setSelectedCourse, setAssessmentTypeOverviews);\n    }\n  }, [courses, octokit]);\n\n  const changeCourseHandler = React.useCallback(\n    (e: any) => {\n      if (octokit === undefined) {\n        return;\n      }\n\n      fetchAssessmentOverviews(octokit, e.target.innerText, setAssessmentTypeOverviews);\n      setSelectedCourse(e.target.innerText);\n    },\n    [octokit, setSelectedCourse, setAssessmentTypeOverviews]\n  );\n\n  const refreshAssessmentOverviews = () => {\n    if (octokit === undefined) {\n      return;\n    }\n\n    fetchAssessmentOverviews(octokit, selectedCourse, setAssessmentTypeOverviews);\n  };\n\n  const redirectToLogin = () => <Redirect to=\"/githubassessments/login\" />;\n  const redirectToAssessments = () => (\n    <Redirect\n      to={{\n        // Types should exist whenever we redirect to assessments as this redirect is only called\n        // when a course exists. Unless the course.json is configured wrongly.\n        pathname: `/githubassessments/${assessmentTypeLink(types ? types[0] : 'welcome')}`,\n        state: {\n          courses: courses,\n          assessmentTypeOverviews: assessmentTypeOverviews,\n          selectedCourse: selectedCourse\n        }\n      }}\n    />\n  );\n\n  return (\n    <div className=\"Academy\" style={{ overflow: 'hidden' }}>\n      <GitHubAssessmentsNavigationBar\n        changeCourseHandler={changeCourseHandler}\n        handleGitHubLogIn={props.handleGitHubLogIn}\n        handleGitHubLogOut={() => {\n          props.handleGitHubLogOut();\n          setCourses(undefined);\n          setAssessmentTypeOverviews(undefined);\n          setSelectedCourse('');\n        }}\n        octokit={octokit}\n        courses={courses}\n        selectedCourse={selectedCourse}\n        types={types}\n        assessmentTypeOverviews={assessmentTypeOverviews}\n      />\n      <Switch>\n        <Route\n          path=\"/githubassessments/login\"\n          render={() => {\n            return octokit && (!courses || (courses.length > 0 && !assessmentTypeOverviews)) ? (\n              <ContentDisplay\n                display={<NonIdealState description=\"Loading...\" icon={<Spinner />} />}\n                loadContentDispatch={() => {}}\n              />\n            ) : octokit && courses && courses.length === 0 ? (\n              <Redirect to=\"/githubassessments/welcome\" />\n            ) : octokit ? (\n              redirectToAssessments()\n            ) : (\n              <ContentDisplay\n                display={\n                  <NonIdealState\n                    description=\"Please sign in to GitHub.\"\n                    icon={IconNames.WARNING_SIGN}\n                  />\n                }\n                loadContentDispatch={() => {}}\n              />\n            );\n          }}\n        />\n        <Route\n          path=\"/githubassessments/welcome\"\n          component={() => (octokit ? <GitHubClassroomWelcome /> : redirectToLogin())}\n        />\n        <Route path=\"/githubassessments/editor\" component={GitHubAssessmentWorkspaceContainer} />\n        {octokit\n          ? types?.map((type, idx) => {\n              const filteredAssessments = assessmentTypeOverviews\n                ? assessmentTypeOverviews[idx].assessments\n                : undefined;\n              return (\n                <Route\n                  path={`/githubassessments/${assessmentTypeLink(type)}`}\n                  render={() => (\n                    <GitHubAssessmentListing\n                      assessmentOverviews={filteredAssessments}\n                      refreshAssessmentOverviews={refreshAssessmentOverviews}\n                    />\n                  )}\n                  key={idx}\n                />\n              );\n            })\n          : null}\n        <Route\n          render={\n            octokit && courses && courses.length > 0 ? redirectToAssessments : redirectToLogin\n          }\n        />\n      </Switch>\n    </div>\n  );\n};\n\n/**\n * Retrieves list of organizations for the authenticated user.\n *\n * @param octokit The Octokit instance for the authenticated user\n * @param setCourses The React setter function for an array of courses string names\n * @param setSelectedCourse The React setter function for string name of selected course\n */\nasync function fetchCourses(\n  octokit: Octokit,\n  setCourses: (courses: string[]) => void,\n  setSelectedCourse: (course: string) => void,\n  setAssessmentTypeOverviews: (assessmentTypeOverviews: GHAssessmentTypeOverview[]) => void\n) {\n  const courses: string[] = [];\n  const results = (await octokit.orgs.listForAuthenticatedUser({ per_page: 100 })).data;\n  const orgs = results.filter(org => org.login.includes('source-academy-course')); // filter only organisations with 'source-academy-course' in name\n  orgs.forEach(org => {\n    courses.push(org.login.replace('source-academy-course-', ''));\n  });\n  setCourses(courses);\n  if (courses.length > 0) {\n    setSelectedCourse(courses[0]);\n    fetchAssessmentOverviews(octokit, courses[0], setAssessmentTypeOverviews);\n  }\n}\n\nexport type GHAssessmentTypeOverview = {\n  typeName: string;\n  assessments: GHAssessmentOverview[];\n};\n\nexport type GHAssessmentOverview = {\n  title: string;\n  coverImage: string;\n  webSummary: string;\n  missionRepoData: MissionRepoData;\n  dueDate: Date;\n  link?: string;\n};\n\ntype GitHubAssessment = {\n  id: string;\n  title: string;\n  openAt: string;\n  closeAt: string;\n  published: string;\n  coverImage: string;\n  shortSummary: string;\n  acceptLink: string;\n  repoPrefix: string;\n};\n\nasync function fetchAssessmentOverviews(\n  octokit: Octokit,\n  selectedCourse: string,\n  setAssessmentTypeOverviews: (assessmentTypeOverviews: GHAssessmentTypeOverview[]) => void\n) {\n  const userLogin = (await octokit.users.getAuthenticated()).data.login;\n  const orgLogin = 'source-academy-course-'.concat(selectedCourse);\n  type ListForAuthenticatedUserData = GetResponseDataTypeFromEndpointMethod<\n    typeof octokit.repos.listForAuthenticatedUser\n  >;\n  const userRepos: ListForAuthenticatedUserData = (\n    await octokit.repos.listForAuthenticatedUser({ per_page: 100 })\n  ).data;\n  const courseRepos = userRepos.filter(repo => repo.owner!.login === orgLogin);\n  const courseInfoRepo = courseRepos.find(repo => repo.name.includes('course-info'));\n\n  if (courseInfoRepo === undefined) {\n    showWarningMessage('The course-info repository cannot be located.', 2000);\n    return;\n  }\n\n  const files = (\n    await octokit.repos.getContent({\n      owner: courseInfoRepo.owner!.login,\n      repo: courseInfoRepo.name,\n      path: ''\n    })\n  ).data;\n\n  if (Array.isArray(files)) {\n    if (files.find(file => file.name === 'course-info.json')) {\n      const result = await octokit.repos.getContent({\n        owner: courseInfoRepo.owner!.login,\n        repo: courseInfoRepo.name,\n        path: 'course-info.json'\n      });\n\n      const courseInfo = JSON.parse(Buffer.from((result.data as any).content, 'base64').toString());\n\n      courseInfo.types.forEach((type: { typeName: string; assessments: [GitHubAssessment] }) => {\n        const assessmentOverviews: GHAssessmentOverview[] = [];\n        type.assessments.forEach((assessment: GitHubAssessment) => {\n          if (!assessment.published) {\n            return;\n          }\n\n          const prefixLogin = assessment.repoPrefix + '-' + userLogin;\n          const missionRepo = userRepos.find(repo => repo.name === prefixLogin);\n\n          let createdAt = new Date();\n          let acceptLink = undefined;\n          if (missionRepo === undefined) {\n            acceptLink = assessment.acceptLink;\n          } else {\n            if (missionRepo.created_at !== null) {\n              createdAt = new Date(missionRepo.created_at);\n            }\n          }\n\n          assessmentOverviews.push({\n            title: assessment.title,\n            coverImage: assessment.coverImage,\n            webSummary: assessment.shortSummary,\n            missionRepoData: {\n              repoOwner: courseInfoRepo.owner!.login,\n              repoName: prefixLogin,\n              dateOfCreation: createdAt\n            },\n            dueDate: new Date(assessment.closeAt),\n            link: acceptLink\n          });\n\n          assessmentOverviews.sort((a, b) => (a.dueDate <= b.dueDate ? -1 : 1));\n        });\n        (type as any).assessments = assessmentOverviews;\n      });\n      setAssessmentTypeOverviews(courseInfo.types);\n    } else {\n      showWarningMessage('The course-info.json file cannot be located.', 2000);\n      return;\n    }\n  }\n}\n\nexport default GitHubClassroom;\n","import {\n  Button,\n  Card,\n  Elevation,\n  H4,\n  H6,\n  Icon,\n  NonIdealState,\n  Spinner,\n  Text\n} from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { useMemo } from 'react';\nimport { useResponsive } from 'src/commons/utils/Hooks';\n\nimport defaultCoverImage from '../../assets/default_cover_image.jpg';\nimport ContentDisplay from '../../commons/ContentDisplay';\nimport Markdown from '../../commons/Markdown';\nimport { history } from '../../commons/utils/HistoryHelper';\nimport { GHAssessmentOverview } from './GitHubClassroom';\n\ntype GitHubAssessmentListingProps = {\n  assessmentOverviews?: GHAssessmentOverview[];\n  refreshAssessmentOverviews: () => void;\n};\n\n/**\n * A page that lists the missions available to the authenticated user.\n * This page should only be reachable if using a GitHub-hosted deployment.\n */\nconst GitHubAssessmentListing: React.FC<GitHubAssessmentListingProps> = props => {\n  const { isMobileBreakpoint } = useResponsive();\n\n  let display: JSX.Element;\n\n  const createAssessmentButton = useMemo(\n    () => (\n      <Button icon={IconNames.ADD} onClick={() => history.push(`/githubassessments/editor`)}>\n        Create a New Assessment!\n      </Button>\n    ),\n    []\n  );\n\n  const refreshButton = useMemo(\n    () => (\n      <Button icon={IconNames.REFRESH} onClick={props.refreshAssessmentOverviews}>\n        Refresh Assessments\n      </Button>\n    ),\n    [props.refreshAssessmentOverviews]\n  );\n\n  if (!props.assessmentOverviews) {\n    display = (\n      <>\n        {createAssessmentButton}\n        <NonIdealState description=\"Fetching assessment...\" icon={<Spinner />} />\n      </>\n    );\n  } else if (props.assessmentOverviews.length === 0) {\n    display = (\n      <>\n        {createAssessmentButton}\n        {refreshButton}\n        <NonIdealState title=\"There are no assessments.\" icon={IconNames.FLAME} />\n      </>\n    );\n  } else {\n    // Create cards\n    const cards = props.assessmentOverviews.map(element =>\n      convertAssessmentOverviewToCard(element, isMobileBreakpoint)\n    );\n    display = (\n      <>\n        {createAssessmentButton}\n        {refreshButton}\n        {cards}\n      </>\n    );\n  }\n\n  return (\n    <div className=\"Assessment\" style={{ overflow: 'auto' }}>\n      <ContentDisplay display={display} loadContentDispatch={() => {}} />\n    </div>\n  );\n};\n\n/**\n * Maps from a BrowsableMission object to a JSX card that can be displayed on the Mission Listing.\n *\n * @param missionRepo The BrowsableMission representation of a single mission repository\n * @param isMobileBreakpoint Whether we are using mobile breakpoint\n */\nfunction convertAssessmentOverviewToCard(\n  assessmentOverview: GHAssessmentOverview,\n  isMobileBreakpoint: boolean\n) {\n  const ratio = isMobileBreakpoint ? 5 : 3;\n  const ownerSlashName =\n    assessmentOverview.missionRepoData.repoOwner +\n    '/' +\n    assessmentOverview.missionRepoData.repoName;\n  const dueDate = assessmentOverview.dueDate.toDateString();\n\n  const hasDueDate = new Date(8640000000000000) > assessmentOverview.dueDate;\n  const isOverdue = new Date() > assessmentOverview.dueDate;\n\n  const assessmentNotAccepted = assessmentOverview.link !== undefined;\n  let buttonText = 'Open';\n  let handleClick = () => history.push(`/githubassessments/editor`, assessmentOverview);\n\n  if (assessmentNotAccepted) {\n    buttonText = 'Accept';\n    handleClick = () => window.open(assessmentOverview.link);\n  } else if (isOverdue) {\n    buttonText = 'Review Answers';\n  }\n\n  return (\n    <div key={ownerSlashName}>\n      <Card className=\"row listing\" elevation={Elevation.ONE}>\n        <div className={`col-xs-${String(ratio)} listing-picture`}>\n          <img\n            alt=\"Assessment\"\n            className={`cover-image-${assessmentOverview.title}`}\n            src={assessmentOverview.coverImage ? assessmentOverview.coverImage : defaultCoverImage}\n          />\n        </div>\n\n        <div className={`col-xs-${String(12 - ratio)} listing-text`}>\n          <div className=\"listing-header\">\n            <Text ellipsize={true}>\n              <H4 className=\"listing-title\">{assessmentOverview.title}</H4>\n              <H6>{ownerSlashName}</H6>\n            </Text>\n          </div>\n\n          <div className=\"listing-description\">\n            <Markdown content={assessmentOverview.webSummary} />\n          </div>\n\n          <div className=\"listing-footer\">\n            <Text className=\"listing-due-date\">\n              <Icon className=\"listing-due-icon\" iconSize={12} icon={IconNames.TIME} />\n              {hasDueDate ? 'Due: ' + dueDate : 'No due date'}\n            </Text>\n            <div className=\"listing-button\">\n              <Button icon={IconNames.PLAY} minimal={true} onClick={handleClick}>\n                <span className=\"custom-hidden-xxxs\">{buttonText}</span>\n              </Button>\n            </div>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n\nexport default GitHubAssessmentListing;\n","import { Card, H2, H4, UL } from '@blueprintjs/core';\n\nconst GitHubClassroomWelcome: React.FC = () => {\n  return (\n    <div className=\"github-welcome\">\n      <Card className=\"github-welcome-content\">\n        <div style={{ marginTop: '20px', display: 'flex', justifyContent: 'center' }}>\n          <div>\n            <H2>Welcome to Source Academy with GitHub Classroom!</H2>\n            <br />\n            <H4>Source Academy does not find any course information for this account.</H4>\n            <div style={{ display: 'flex', justifyContent: 'center' }}>\n              <UL style={{ textAlign: 'justify' }}>\n                <li>\n                  If you are enrolled in a Source Academy course that uses GitHub Classroom, check\n                  with the course staff to make sure your account is added to the course.\n                </li>\n                <li>\n                  If you are looking for a course to join, check{' '}\n                  <a href=\"https://about.sourceacademy.org/learner/README.html\">here</a> to find a\n                  course that suits your needs.\n                </li>\n              </UL>\n            </div>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n};\n\nexport default GitHubClassroomWelcome;\n","import { IconNames } from '@blueprintjs/icons';\n\nimport ControlButton from '../../ControlButton';\n\ntype ControlBarDisplayMCQButtonProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  displayMCQInEditor: () => void;\n  displayTextInEditor: () => void;\n};\n\ntype StateProps = {\n  mcqDisplayed: boolean;\n  key: string;\n};\n\nexport const ControlBarDisplayMCQButton: React.FC<ControlBarDisplayMCQButtonProps> = props => {\n  const label = props.mcqDisplayed ? 'Show MCQ Text' : 'Hide MCQ Text';\n  const behaviour = props.mcqDisplayed ? props.displayTextInEditor : props.displayMCQInEditor;\n\n  return <ControlButton label={label} icon={IconNames.REFRESH} onClick={behaviour} />;\n};\n","import { IconNames } from '@blueprintjs/icons';\n\nimport ControlButton from '../../ControlButton';\nimport { maximumTasksPerMission } from '../../githubAssessments/GitHubMissionDataUtils';\nimport { showWarningMessage } from '../../utils/NotificationsHelper';\n\nexport type ControlBarTaskAddButtonProps = {\n  addNewQuestion: () => void;\n  numberOfTasks: number;\n  key: string;\n};\n\nexport const ControlBarTaskAddButton: React.FC<ControlBarTaskAddButtonProps> = props => {\n  function onClickAdd() {\n    if (props.numberOfTasks === maximumTasksPerMission) {\n      showWarningMessage(\n        'Cannot have more than ' + maximumTasksPerMission + ' Tasks in a Mission!'\n      );\n      return;\n    }\n\n    props.addNewQuestion();\n  }\n\n  return <ControlButton label=\"Add Task\" icon={IconNames.ADD} onClick={onClickAdd} />;\n};\n","import { IconNames } from '@blueprintjs/icons';\n\nimport ControlButton from '../../ControlButton';\nimport { showSimpleConfirmDialog } from '../../utils/DialogHelper';\nimport { showWarningMessage } from '../../utils/NotificationsHelper';\n\nexport type ControlBarTaskDeleteButtonProps = {\n  deleteCurrentQuestion: () => void;\n  numberOfTasks: number;\n  key: string;\n};\n\nexport const ControlBarTaskDeleteButton: React.FC<ControlBarTaskDeleteButtonProps> = props => {\n  async function onClickDelete() {\n    if (props.numberOfTasks <= 1) {\n      showWarningMessage('Cannot delete the only remaining task!');\n      return;\n    }\n\n    const confirmDelete = await showSimpleConfirmDialog({\n      contents: (\n        <div>\n          <p>Warning: you are about to delete a task.</p>\n          <p>This action cannot be undone.</p>\n          <p>Please click 'Confirm' to continue, or 'Cancel' to go back.</p>\n        </div>\n      ),\n      negativeLabel: 'Cancel',\n      positiveIntent: 'primary',\n      positiveLabel: 'Confirm'\n    });\n\n    if (confirmDelete) {\n      props.deleteCurrentQuestion();\n    }\n  }\n\n  return (\n    <ControlButton label=\"Delete Current Task\" icon={IconNames.DELETE} onClick={onClickDelete} />\n  );\n};\n","import { AnchorButton, Button, Classes, Dialog, InputGroup, Intent } from '@blueprintjs/core';\nimport classNames from 'classnames';\nimport React, { useState } from 'react';\n\nimport { showWarningMessage } from '../utils/NotificationsHelper';\n\nexport type GitHubMissionCreateDialogResolution = {\n  confirmSave: boolean;\n  repoName: string;\n};\n\nexport type GitHubMissionCreateDialogProps = {\n  filesToCreate: string[];\n  userLogin: string;\n  resolveDialog: (arg: GitHubMissionCreateDialogResolution) => void;\n};\n\nexport const GitHubMissionCreateDialog: React.FC<GitHubMissionCreateDialogProps> = props => {\n  const [repositoryName, setrepositoryName] = useState('sa-new-mission-repository');\n\n  return (\n    <Dialog className=\"missionBrowser\" isOpen={true}>\n      <div className={classNames('githubDialogHeader', Classes.DIALOG_HEADER)}>\n        <h3>Please confirm your save</h3>\n      </div>\n      <div className={classNames('githubDialogBody', Classes.DIALOG_BODY)}>\n        <div>\n          <h4>This will create a repository owned by {props.userLogin} with the title:</h4>\n          <InputGroup\n            onChange={handleTitleChange}\n            placeholder={'Enter Repository Title'}\n            value={repositoryName}\n          />\n        </div>\n        <div>\n          <h4>This repository will be created with following files:</h4>\n          {props.filesToCreate.map(filepath => (\n            <li key={filepath}>{filepath}</li>\n          ))}\n        </div>\n      </div>\n\n      <div className={classNames(Classes.DIALOG_FOOTER)}>\n        <div className={classNames(Classes.DIALOG_FOOTER_ACTIONS)}>\n          <Button onClick={handleClose}>Close</Button>\n          <AnchorButton onClick={handleConfirm} intent={Intent.PRIMARY}>\n            Confirm\n          </AnchorButton>\n        </div>\n      </div>\n    </Dialog>\n  );\n\n  function handleTitleChange(event: any) {\n    setrepositoryName(event.target.value);\n  }\n\n  function handleClose() {\n    props.resolveDialog({\n      confirmSave: false,\n      repoName: ''\n    });\n  }\n\n  function handleConfirm() {\n    if (repositoryName === '') {\n      showWarningMessage('Cannot create repository without title!', 2000);\n      return;\n    }\n\n    props.resolveDialog({\n      confirmSave: true,\n      repoName: repositoryName\n    });\n  }\n};\n","import { TextArea } from '@blueprintjs/core';\nimport React, { useEffect } from 'react';\n\nimport Markdown from '../../Markdown';\n\nexport type SideContentMarkdownEditorProps = {\n  allowEdits: boolean;\n  content: string;\n  setContent: (content: string) => void;\n};\n\nconst SideContentMarkdownEditor: React.FC<SideContentMarkdownEditorProps> = props => {\n  const [editorModeOn, setEditorModeOn] = React.useState(false);\n  const allowEdits = props.allowEdits;\n\n  const node = React.useRef() as any;\n\n  useEffect(() => {\n    function handleClick(event: any) {\n      if (!allowEdits) {\n        return;\n      }\n\n      if (node.current && !node.current.contains(event.target)) {\n        setEditorModeOn(false);\n      }\n\n      if (node.current && node.current.contains(event.target)) {\n        setEditorModeOn(true);\n      }\n    }\n\n    document.addEventListener('mousedown', handleClick);\n    return () => {\n      document.removeEventListener('mousedown', handleClick);\n    };\n  }, [allowEdits]);\n\n  return (\n    <div ref={node}>\n      {editorModeOn ? (\n        <TextArea\n          onChange={onEditorChange}\n          fill={true}\n          growVertically={true}\n          defaultValue={props.content}\n        />\n      ) : (\n        <Markdown content={props.content} openLinksInNewWindow={true} />\n      )}\n    </div>\n  );\n\n  function onEditorChange(event: any) {\n    props.setContent(event.target.value);\n  }\n};\n\nexport default SideContentMarkdownEditor;\n","import { Label } from '@blueprintjs/core';\nimport { Chapter } from 'c-slang/dist/types';\nimport React from 'react';\n\nimport { SALanguage } from '../../application/ApplicationTypes';\nimport { ControlBarChapterSelect } from '../../controlBar/ControlBarChapterSelect';\nimport { MissionMetadata } from '../../githubAssessments/GitHubMissionTypes';\nimport Constants from '../../utils/Constants';\n\nexport type SideContentMissionEditorProps = {\n  missionMetadata: MissionMetadata;\n  setMissionMetadata: (missionMetadata: MissionMetadata) => void;\n};\n\nconst SideContentMissionEditor: React.FC<SideContentMissionEditorProps> = props => {\n  return (\n    <div className=\"SideContentMissionEditor\">\n      <div className=\"SideContentMissionEditorRow\">\n        <div className=\"SideContentMissionEditorLabelColumn\">\n          <Label>Source Version</Label>\n        </div>\n        <div className=\"SideContentMissionEditorOptionColumn\">\n          <ControlBarChapterSelect\n            sourceChapter={props.missionMetadata.sourceVersion}\n            sourceVariant={Constants.defaultSourceVariant}\n            key=\"chapter\"\n            disabled={false}\n            handleChapterSelect={handleChapterSelect}\n          />\n        </div>\n      </div>\n    </div>\n  );\n\n  function setMissionMetadataWrapper<T>(changedProperty: string, newValue: T) {\n    const newMetadata = Object.assign({}, props.missionMetadata);\n    newMetadata[changedProperty] = newValue;\n    props.setMissionMetadata(newMetadata);\n  }\n\n  function handleChapterSelect(i: SALanguage, e?: React.SyntheticEvent<HTMLElement>) {\n    setMissionMetadataWrapper<Chapter>('sourceVersion', i.chapter);\n  }\n};\n\nexport default SideContentMissionEditor;\n","import React from 'react';\n\nimport SideContentMarkdownEditor from './SideContentMarkdownEditor';\n\nexport type SideContentTaskEditorProps = {\n  allowEdits: boolean;\n  currentTaskNumber: number;\n  taskDescriptions: any[];\n  setTaskDescriptions: (newList: any[]) => void;\n};\n\nconst SideContentTaskEditor: React.FC<SideContentTaskEditorProps> = props => {\n  const taskIndex = props.currentTaskNumber - 1;\n  const taskDescriptions = props.taskDescriptions;\n  const setTaskDescriptions = props.setTaskDescriptions;\n\n  const indexOutOfRange =\n    taskIndex < 0 || taskIndex >= taskDescriptions.length || taskDescriptions.length === 0;\n\n  const taskBriefing = indexOutOfRange\n    ? 'Welcome to Mission Mode! This is where the Task Briefing for each question will appear!'\n    : taskDescriptions[taskIndex];\n\n  const taskBriefingSetter = React.useCallback(\n    (newDescription: string) => {\n      if (indexOutOfRange) {\n        return;\n      }\n\n      const newTaskDescriptions = taskDescriptions.map(desc => desc);\n      newTaskDescriptions[taskIndex] = newDescription;\n      setTaskDescriptions(newTaskDescriptions);\n    },\n    [setTaskDescriptions, taskDescriptions, taskIndex, indexOutOfRange]\n  );\n\n  return (\n    <div>\n      <SideContentMarkdownEditor\n        allowEdits={props.allowEdits}\n        content={taskBriefing}\n        setContent={taskBriefingSetter}\n      />\n    </div>\n  );\n};\n\nexport default SideContentTaskEditor;\n","import { Button, Card, Classes, Elevation, InputGroup } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { parseError } from 'c-slang';\nimport { stringify } from 'c-slang/dist/utils/stringify';\nimport classNames from 'classnames';\nimport * as React from 'react';\n\nimport { Testcase, TestcaseTypes } from '../../assessment/AssessmentTypes';\n\ntype SideContentEditableTestcaseCardProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  setTestcaseProgram: (newProgram: string) => void;\n  setTestcaseExpectedResult: (newExpectedResult: string) => void;\n  handleTestcaseEval: (testcaseId: number) => void;\n  deleteTestcase: (testcaseId: number) => void;\n};\n\ntype StateProps = {\n  index: number;\n  testcase: Testcase;\n};\n\nconst SideContentEditableTestcaseCard: React.FunctionComponent<\n  SideContentEditableTestcaseCardProps\n> = props => {\n  const {\n    index,\n    testcase,\n    setTestcaseProgram,\n    setTestcaseExpectedResult,\n    handleTestcaseEval,\n    deleteTestcase\n  } = props;\n\n  // TODO (Refactor): testcase type seems unused in GitHub Assessments\n  const extraClasses = React.useMemo(() => {\n    const isEvaluated = testcase.result !== undefined || testcase.errors;\n    const isEqual = stringify(testcase.result) === testcase.answer;\n\n    return {\n      correct: isEvaluated && isEqual,\n      wrong: isEvaluated && !isEqual,\n      secret: testcase.type === TestcaseTypes.secret || testcase.type === TestcaseTypes.opaque\n    };\n  }, [testcase]);\n\n  const handleRunTestcase = React.useCallback(() => {\n    handleTestcaseEval(index);\n  }, [index, handleTestcaseEval]);\n\n  const testProgram = testcase.program;\n  const expectedAnswer = testcase.answer;\n\n  const playButton = (\n    <Button className=\"testcase-button\" icon={IconNames.PLAY} onClick={handleRunTestcase} />\n  );\n  const deleteButton = (\n    <Button\n      className=\"testcase-button\"\n      icon={IconNames.DELETE}\n      onClick={() => deleteTestcase(index)}\n    />\n  );\n\n  const answer = React.useMemo(() => {\n    let answer = 'No Answer';\n    if (testcase.errors) {\n      answer = parseError(testcase.errors);\n    } else {\n      if (testcase.result !== undefined) {\n        answer = stringify(testcase.result) as string;\n      }\n    }\n    return answer;\n  }, [testcase]);\n\n  return (\n    <div className={classNames('EditableAutograderCard', extraClasses)}>\n      <Card className={Classes.INTERACTIVE} elevation={Elevation.ONE}>\n        {\n          <>\n            <InputGroup\n              className=\"testcase-program\"\n              value={testProgram}\n              onChange={(event: any) => setTestcaseProgram(event.target.value)}\n            />\n            <InputGroup\n              className=\"testcase-expected\"\n              value={expectedAnswer}\n              onChange={(event: any) => setTestcaseExpectedResult(event.target.value)}\n            />\n            <InputGroup className=\"testcase-actual\" value={answer} readOnly={true} />\n          </>\n        }\n        {playButton}\n        {deleteButton}\n      </Card>\n    </div>\n  );\n};\n\nexport default SideContentEditableTestcaseCard;\n","import { Button, Collapse, Icon, PopoverPosition } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { Tooltip2 } from '@blueprintjs/popover2';\nimport * as React from 'react';\nimport AceEditor from 'react-ace';\n\nimport { Testcase } from '../../assessment/AssessmentTypes';\nimport ControlButton from '../../ControlButton';\nimport { showSimpleConfirmDialog } from '../../utils/DialogHelper';\nimport SideContentTestcaseCard from '../SideContentTestcaseCard';\nimport SideContentEditableTestcaseCard from './SideContentEditableTestcaseCard';\n\nexport type SideContentTestcaseEditorProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  handleTestcaseEval: (testcaseId: number) => void;\n  setTaskTestcases: (newTestcases: Testcase[]) => void;\n  setTestPrepend: (newTestPrepend: string) => void;\n  setTestPostpend: (newTestPostpend: string) => void;\n};\n\ntype StateProps = {\n  allowEdits: boolean;\n  testcases: Testcase[];\n  testPrepend: string;\n  testPostpend: string;\n};\n\nconst SideContentTestcaseEditor: React.FunctionComponent<\n  SideContentTestcaseEditorProps\n> = props => {\n  const [showsTestPrepend, setTestPrependShown] = React.useState<boolean>(true);\n  const [showsTestPostpend, setTestPostpendShown] = React.useState<boolean>(true);\n  const [showsTestcases, setTestcasesShown] = React.useState<boolean>(true);\n\n  const {\n    testcases,\n    testPrepend,\n    testPostpend,\n    allowEdits,\n    handleTestcaseEval,\n    setTaskTestcases,\n    setTestPrepend,\n    setTestPostpend\n  } = props;\n\n  const setTestcaseProgramSetterCreator = React.useCallback(\n    (testcaseId: number) => {\n      return (newProgram: string) => {\n        const newTestcases = testcases.map((testcase: Testcase) => Object.assign({}, testcase));\n        newTestcases[testcaseId].program = newProgram;\n        delete newTestcases[testcaseId].result;\n        setTaskTestcases(newTestcases);\n      };\n    },\n    [setTaskTestcases, testcases]\n  );\n\n  const setTestcaseExpectedResultSetterCreator = React.useCallback(\n    (testcaseId: number) => {\n      return (newExpectedResult: string) => {\n        const newTestcases = testcases.map((testcase: Testcase) => Object.assign({}, testcase));\n        newTestcases[testcaseId].answer = newExpectedResult;\n        delete newTestcases[testcaseId].result;\n        setTaskTestcases(newTestcases);\n      };\n    },\n    [setTaskTestcases, testcases]\n  );\n\n  const addTestcase = React.useCallback(() => {\n    const newTestcases = [...testcases];\n    newTestcases.push({\n      answer: '',\n      program: '',\n      score: 0,\n      type: 'public'\n    });\n    setTaskTestcases(newTestcases);\n  }, [testcases, setTaskTestcases]);\n\n  const deleteTestcase = React.useCallback(\n    async (testcaseId: number) => {\n      const confirmDelete = await showSimpleConfirmDialog({\n        title: 'confirm testcase deletion',\n        contents: 'Are you sure you want to delete this testcase? This cannot be undone.',\n        positiveLabel: 'Confirm',\n        negativeLabel: 'Cancel'\n      });\n\n      if (!confirmDelete) {\n        return;\n      }\n\n      const newTestcases = testcases.slice(0, testcaseId).concat(testcases.slice(testcaseId + 1));\n      setTaskTestcases(newTestcases);\n    },\n    [testcases, setTaskTestcases]\n  );\n\n  const convertToTestcaseCard = React.useCallback(\n    (testcase, index) => {\n      if (allowEdits) {\n        return (\n          <SideContentEditableTestcaseCard\n            key={index}\n            index={index}\n            testcase={testcase}\n            setTestcaseProgram={setTestcaseProgramSetterCreator(index)}\n            setTestcaseExpectedResult={setTestcaseExpectedResultSetterCreator(index)}\n            deleteTestcase={deleteTestcase}\n            handleTestcaseEval={handleTestcaseEval}\n          />\n        );\n      } else {\n        return (\n          <SideContentTestcaseCard\n            key={index}\n            index={index}\n            testcase={testcase}\n            handleTestcaseEval={handleTestcaseEval}\n            workspaceLocation=\"githubAssessment\"\n          />\n        );\n      }\n    },\n    [\n      allowEdits,\n      deleteTestcase,\n      handleTestcaseEval,\n      setTestcaseProgramSetterCreator,\n      setTestcaseExpectedResultSetterCreator\n    ]\n  );\n\n  const testcaseCards = React.useMemo(\n    () =>\n      testcases.length > 0 ? (\n        <div className=\"testcaseCards\">\n          {testcasesHeader}\n          {testcases.map((testcase, index) => convertToTestcaseCard(testcase, index))}\n        </div>\n      ) : (\n        <div className=\"noResults\">There are no testcases provided for this question.</div>\n      ),\n    [testcases, convertToTestcaseCard]\n  );\n\n  const createTestCaseButton = React.useMemo(\n    () => (\n      <Button\n        className=\"collapse-button\"\n        icon={IconNames.ADD}\n        minimal={true}\n        text={'Add a new testcase'}\n        onClick={addTestcase}\n      />\n    ),\n    [addTestcase]\n  );\n\n  const toggleTestPrepend = React.useCallback(() => {\n    setTestPrependShown(!showsTestPrepend);\n  }, [showsTestPrepend]);\n\n  const toggleTestPostpend = React.useCallback(() => {\n    setTestPostpendShown(!showsTestPostpend);\n  }, [showsTestPostpend]);\n\n  const toggleTestcases = React.useCallback(() => {\n    setTestcasesShown(!showsTestcases);\n  }, [showsTestcases]);\n\n  return (\n    <div className=\"Autograder\">\n      <Button\n        className=\"collapse-button\"\n        icon={showsTestcases ? IconNames.CARET_DOWN : IconNames.CARET_RIGHT}\n        minimal={true}\n        onClick={toggleTestcases}\n      >\n        <span>Testcases</span>\n        <Tooltip2 content={autograderTooltip} placement={PopoverPosition.LEFT}>\n          <Icon icon={IconNames.HELP} />\n        </Tooltip2>\n      </Button>\n      <Collapse isOpen={showsTestcases} keepChildrenMounted={true}>\n        <div className=\"testcaseeditor-subcomponent\">\n          {testcaseCards}\n          {allowEdits && createTestCaseButton}\n        </div>\n      </Collapse>\n\n      {allowEdits && collapseButton('Testcase Prepend', showsTestPrepend, toggleTestPrepend)}\n      {allowEdits && (\n        <Collapse isOpen={showsTestPrepend} keepChildrenMounted={true}>\n          <div className=\"testcaseeditor-subcomponent\">\n            {createEditor(testPrepend, (newValue: string) => setTestPrepend(newValue))}\n          </div>\n        </Collapse>\n      )}\n\n      {allowEdits && collapseButton('Testcase Postpend', showsTestPostpend, toggleTestPostpend)}\n      {allowEdits && (\n        <Collapse isOpen={showsTestPostpend} keepChildrenMounted={true}>\n          <div className=\"testcaseeditor-subcomponent\">\n            {createEditor(testPostpend, (newValue: string) => setTestPostpend(newValue))}\n          </div>\n        </Collapse>\n      )}\n    </div>\n  );\n};\n\nfunction createEditor(value: string, onChange: (newValue: string) => void) {\n  return (\n    <AceEditor\n      className=\"react-ace\"\n      fontSize={14}\n      highlightActiveLine={false}\n      mode=\"javascript\"\n      onChange={onChange}\n      theme=\"source\"\n      value={value}\n      width=\"100%\"\n      height=\"16rem\"\n    />\n  );\n}\n\nconst autograderTooltip = (\n  <div className=\"autograder-help-tooltip\">\n    <p>Click on each testcase below to execute it with the program in the editor.</p>\n    <p>\n      To execute all testcases at once, evaluate the program in the editor with this tab active.\n    </p>\n    <p>A green or red background indicates a passed or failed testcase respectively.</p>\n    <p>Private testcases (only visible to staff when grading) have a grey background.</p>\n  </div>\n);\n\nconst columnHeader = (colClass: string, colTitle: string) => (\n  <div className={colClass}>\n    {colTitle}\n    <Icon icon={IconNames.CARET_DOWN} />\n  </div>\n);\n\nconst testcasesHeader = (\n  <div className=\"testcases-header\">\n    {columnHeader('header-fn', 'Testcase')}\n    {columnHeader('header-expected', 'Expected result')}\n    {columnHeader('header-actual', 'Actual result')}\n  </div>\n);\n\nconst collapseButton = (label: string, isOpen: boolean, toggleFunc: () => void) => (\n  <ControlButton\n    label={label}\n    icon={isOpen ? IconNames.CARET_DOWN : IconNames.CARET_RIGHT}\n    onClick={toggleFunc}\n    options={{ className: 'collapse-button', minimal: true }}\n  />\n);\n\nexport default SideContentTestcaseEditor;\n","import { Chapter } from 'c-slang/dist/types';\n\nimport { IMCQQuestion } from '../../commons/assessment/AssessmentTypes';\nimport { MissionMetadata, TaskData } from '../../commons/githubAssessments/GitHubMissionTypes';\n\nexport const defaultMissionBriefing = `### Assignment Briefing (Click to Edit!)\nWelcome to Assignment Creator! This is where the Briefing for each assignment will appear.\n\nIf you are on the SourceAcademy website, you may edit **this section** by clicking on it. You can also add or delete questions through the control bar.\n\nThe text written here will show up as the \\`README.md\\` file on the GitHub repository.\n\nPlease also refer to our instructor's guide [here](https://github.com/source-academy/general/tree/master/instructor/github) to learn more about how to use this website.\n\n### Brief Markdown Cheatsheet\nEverything here is written in Markdown.\n\nThis means that you can **bolden** or *italicize* text by adding asterisks.\n\nPrograms can be formatted through the use of triple backticks:\n\\`\\`\\`\n// This is a program example\n\\`\\`\\`\nIf you want to in-line program snippets, rather than display it as a block, you can also use single backticks like \\`this\\`.\n\nLists can be created by adding dashes to the start of a line:\n- First element\n- Second element\n- Third element\n\n\nIt is also possible to embed images, like this:\n\n![an embedded image](https://avatars.githubusercontent.com/u/35620705?s=400&u=32f72fd1d65a0d6877ad1d5870ffa327dda754f1&v=4)\n\nIf you need a more detailed cheatsheet, please click [here](https://www.markdownguide.org/cheat-sheet/)!\n`;\n\nexport const defaultTaskDescription = `### Problem Description (Click to Edit!)\nWelcome to the Assignment Creator! This is where the problem description specific to each problem should be written.\n\nIf you are on the SourceAcademy website, you may edit **this section** by clicking on it. You can also add or delete questions through the control bar.\n\nIf you would like to add new questions outside of the website, simply duplicate this folder, and edit the \\`Problem.md\\` and \\`StarterCode.js\\` files accordingly. Make sure that the folders are named 'Q1', 'Q2', 'Q3' and so on.\n\nPlease also refer to our instructor's guide [here](https://github.com/source-academy/general/tree/master/instructor/github).\n\n### Brief Markdown Cheatsheet\nEverything here is written in Markdown.\n\nThis means that you can **bolden** or *italicize* text by adding asterisks.\n\nPrograms can be formatted through the use of triple backticks:\n\\`\\`\\`\n// This is a program example\n\\`\\`\\`\nIf you want to in-line program snippets, rather than display it as a block, you can also use single backticks like \\`this\\`.\n\nLists can be created by adding dashes to the start of a line:\n- First element\n- Second element\n- Third element\n\n\nIt is also possible to embed images, like this:\n\n![an embedded image](https://avatars.githubusercontent.com/u/35620705?s=400&u=32f72fd1d65a0d6877ad1d5870ffa327dda754f1&v=4)\n\nIf you need a more detailed cheatsheet, please click [here](https://www.markdownguide.org/cheat-sheet/)!\n`;\n\nexport const defaultStarterCode = '// Your program here!\\n';\n\nexport const defaultMissionMetadata = {\n  sourceVersion: Chapter.CALC\n} as MissionMetadata;\n\nexport const defaultTask = {\n  questionNumber: 0,\n  taskDescription: defaultTaskDescription,\n  starterCode: defaultStarterCode,\n  savedCode: defaultStarterCode,\n  testPrepend: '',\n  testPostpend: '',\n  testCases: []\n} as TaskData;\n\nexport const defaultMCQQuestion = {\n  answer: -1,\n  choices: [],\n  solution: -1,\n  type: 'mcq',\n  content: '',\n  grade: 0,\n  id: 0,\n  library: { chapter: Chapter.CALC, external: { name: 'NONE', symbols: [] }, globals: [] },\n  maxGrade: 0,\n  xp: 0,\n  maxXp: 0\n} as IMCQQuestion;\n","import {\n  Button,\n  Card,\n  Classes,\n  Dialog,\n  NonIdealState,\n  Spinner,\n  SpinnerSize\n} from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport { GetResponseTypeFromEndpointMethod } from '@octokit/types';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport classNames from 'classnames';\nimport { isEqual } from 'lodash';\nimport React, { useCallback, useEffect, useMemo } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { RouteComponentProps } from 'react-router';\nimport { useResponsive } from 'src/commons/utils/Hooks';\nimport {\n  browseReplHistoryDown,\n  browseReplHistoryUp,\n  changeSideContentHeight,\n  evalTestcase,\n  navigateToDeclaration,\n  promptAutocomplete,\n  runAllTestcases,\n  setEditorBreakpoint,\n  updateReplValue\n} from 'src/commons/workspace/WorkspaceActions';\n\nimport { InterpreterOutput } from '../../commons/application/ApplicationTypes';\nimport { ExternalLibraryName } from '../../commons/application/types/ExternalTypes';\nimport { Testcase } from '../../commons/assessment/AssessmentTypes';\nimport { ControlBarProps } from '../../commons/controlBar/ControlBar';\nimport { ControlBarChapterSelect } from '../../commons/controlBar/ControlBarChapterSelect';\nimport { ControlBarClearButton } from '../../commons/controlBar/ControlBarClearButton';\nimport { ControlBarEvalButton } from '../../commons/controlBar/ControlBarEvalButton';\nimport { ControlBarNextButton } from '../../commons/controlBar/ControlBarNextButton';\nimport { ControlBarPreviousButton } from '../../commons/controlBar/ControlBarPreviousButton';\nimport { ControlBarQuestionViewButton } from '../../commons/controlBar/ControlBarQuestionViewButton';\nimport { ControlBarResetButton } from '../../commons/controlBar/ControlBarResetButton';\nimport { ControlBarRunButton } from '../../commons/controlBar/ControlBarRunButton';\nimport { ControlButtonSaveButton } from '../../commons/controlBar/ControlBarSaveButton';\nimport { ControlBarDisplayMCQButton } from '../../commons/controlBar/github/ControlBarDisplayMCQButton';\nimport { ControlBarTaskAddButton } from '../../commons/controlBar/github/ControlBarTaskAddButton';\nimport { ControlBarTaskDeleteButton } from '../../commons/controlBar/github/ControlBarTaskDeleteButton';\nimport {\n  convertEditorTabStateToProps,\n  NormalEditorContainerProps\n} from '../../commons/editor/EditorContainer';\nimport { Position } from '../../commons/editor/EditorTypes';\nimport {\n  GitHubMissionCreateDialog,\n  GitHubMissionCreateDialogProps,\n  GitHubMissionCreateDialogResolution\n} from '../../commons/githubAssessments/GitHubMissionCreateDialog';\nimport {\n  convertIMCQQuestionToMCQText,\n  convertToMCQQuestionIfMCQText,\n  discoverFilesToBeChangedWithMissionRepoData,\n  discoverFilesToBeCreatedWithoutMissionRepoData,\n  getMissionData\n} from '../../commons/githubAssessments/GitHubMissionDataUtils';\nimport {\n  MissionData,\n  MissionMetadata,\n  MissionRepoData,\n  TaskData\n} from '../../commons/githubAssessments/GitHubMissionTypes';\nimport Markdown from '../../commons/Markdown';\nimport { MobileSideContentProps } from '../../commons/mobileWorkspace/mobileSideContent/MobileSideContent';\nimport MobileWorkspace, {\n  MobileWorkspaceProps\n} from '../../commons/mobileWorkspace/MobileWorkspace';\nimport SideContentMarkdownEditor from '../../commons/sideContent/githubAssessments/SideContentMarkdownEditor';\nimport SideContentMissionEditor from '../../commons/sideContent/githubAssessments/SideContentMissionEditor';\nimport SideContentTaskEditor from '../../commons/sideContent/githubAssessments/SideContentTaskEditor';\nimport SideContentTestcaseEditor from '../../commons/sideContent/githubAssessments/SideContentTestcaseEditor';\nimport { SideContentProps } from '../../commons/sideContent/SideContent';\nimport { SideContentTab, SideContentType } from '../../commons/sideContent/SideContentTypes';\nimport Constants from '../../commons/utils/Constants';\nimport { promisifyDialog, showSimpleConfirmDialog } from '../../commons/utils/DialogHelper';\nimport { history } from '../../commons/utils/HistoryHelper';\nimport { showWarningMessage } from '../../commons/utils/NotificationsHelper';\nimport Workspace, { WorkspaceProps } from '../../commons/workspace/Workspace';\nimport { EditorTabState, WorkspaceState } from '../../commons/workspace/WorkspaceTypes';\nimport { WorkspaceLocation } from '../../commons/workspace/WorkspaceTypes';\nimport {\n  checkIfFileCanBeSavedAndGetSaveType,\n  getGitHubOctokitInstance,\n  performCreatingSave,\n  performFolderDeletion,\n  performOverwritingSave\n} from '../../features/github/GitHubUtils';\nimport {\n  defaultMCQQuestion,\n  defaultMissionBriefing,\n  defaultMissionMetadata,\n  defaultTask\n} from './GitHubAssessmentDefaultValues';\nimport { GHAssessmentOverview } from './GitHubClassroom';\n\nexport type GitHubAssessmentWorkspaceProps = DispatchProps & StateProps & RouteComponentProps;\n\nexport type DispatchProps = {\n  handleChapterSelect: (chapter: Chapter, variant: Variant) => void;\n  handleEditorEval: () => void;\n  handleEditorValueChange: (val: string) => void;\n  handleReplEval: () => void;\n  handleReplOutputClear: () => void;\n  handleUpdateWorkspace: (options: Partial<WorkspaceState>) => void;\n  handleUpdateHasUnsavedChanges: (hasUnsavedChanges: boolean) => void;\n};\n\nexport type StateProps = {\n  activeEditorTabIndex: number | null;\n  editorTabs: EditorTabState[];\n  editorTestcases: Testcase[];\n  hasUnsavedChanges: boolean;\n  isRunning: boolean;\n  isDebugging: boolean;\n  enableDebugging: boolean;\n  output: InterpreterOutput[];\n  replValue: string;\n  sideContentHeight?: number;\n  sourceChapter: Chapter;\n};\n\nconst workspaceLocation: WorkspaceLocation = 'githubAssessment';\n\nconst GitHubAssessmentWorkspace: React.FC<GitHubAssessmentWorkspaceProps> = props => {\n  const dispatch = useDispatch();\n  const octokit = getGitHubOctokitInstance();\n\n  if (octokit === undefined) {\n    history.push('/githubassessments/login');\n  }\n\n  /**\n   * State variables relating to information we are concerned with saving\n   */\n  const [missionMetadata, setMissionMetadata] = React.useState(defaultMissionMetadata);\n  const [cachedMissionMetadata, setCachedMissionMetadata] = React.useState(defaultMissionMetadata);\n  const [hasUnsavedChangesToMetadata, setHasUnsavedChangesToMetadata] = React.useState(false);\n\n  const [briefingContent, setBriefingContent] = React.useState(defaultMissionBriefing);\n  const [cachedBriefingContent, setCachedBriefingContent] = React.useState(defaultMissionBriefing);\n  const [hasUnsavedChangesToBriefing, setHasUnsavedChangesToBriefing] = React.useState(false);\n\n  const [cachedTaskList, setCachedTaskList] = React.useState<TaskData[]>([]);\n  const [taskList, setTaskList] = React.useState<TaskData[]>([]);\n  const [hasUnsavedChangesToTasks, setHasUnsavedChangesToTasks] = React.useState(false);\n\n  /**\n   * State variables relating to the rendering and function of the workspace\n   */\n  const [summary, setSummary] = React.useState('');\n  const [currentTaskNumber, setCurrentTaskNumber] = React.useState(0);\n  const [isTeacherMode, setIsTeacherMode] = React.useState(false);\n  const [isLoading, setIsLoading] = React.useState(true);\n  const [currentTaskIsMCQ, setCurrentTaskIsMCQ] = React.useState(false);\n  const [displayMCQInEditor, setDisplayMCQInEditor] = React.useState(true);\n  const [mcqQuestion, setMCQQuestion] = React.useState(defaultMCQQuestion);\n  const [missionRepoData, setMissionRepoData] = React.useState<MissionRepoData | undefined>(\n    undefined\n  );\n  const assessmentOverview = props.location.state as GHAssessmentOverview;\n\n  const [showBriefingOverlay, setShowBriefingOverlay] = React.useState(false);\n  const [selectedTab, setSelectedTab] = React.useState(SideContentType.questionOverview);\n  const { isMobileBreakpoint } = useResponsive();\n\n  /**\n   * Unpacked properties\n   */\n  const hasUnsavedChanges = props.hasUnsavedChanges;\n  const editorTestcases = props.editorTestcases;\n  const handleEditorValueChange = props.handleEditorValueChange;\n  const handleUpdateWorkspace = props.handleUpdateWorkspace;\n  const handleUpdateHasUnsavedChanges = props.handleUpdateHasUnsavedChanges;\n  const handleReplOutputClear = props.handleReplOutputClear;\n\n  /**\n   * Should be called to change the task number, rather than using setCurrentTaskNumber\n   */\n  const changeStateDueToChangedTaskNumber = useCallback(\n    (newTaskNumber: number, currentTaskList: TaskData[]) => {\n      setCurrentTaskNumber(newTaskNumber);\n      const actualTaskIndex = newTaskNumber - 1;\n\n      handleUpdateWorkspace({\n        // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n        editorTabs: [\n          {\n            value: currentTaskList[actualTaskIndex].savedCode,\n            prependValue: currentTaskList[actualTaskIndex].testPrepend,\n            postpendValue: currentTaskList[actualTaskIndex].testPostpend,\n            highlightedLines: [],\n            breakpoints: []\n          }\n        ],\n        editorTestcases: currentTaskList[actualTaskIndex].testCases\n      });\n      handleReplOutputClear();\n\n      const [isMCQText, mcqQuestion] = convertToMCQQuestionIfMCQText(\n        currentTaskList[actualTaskIndex].savedCode\n      );\n\n      setCurrentTaskIsMCQ(isMCQText);\n      setMCQQuestion(mcqQuestion);\n    },\n    [handleUpdateWorkspace, handleReplOutputClear]\n  );\n\n  const setBriefingContentWrapper = useCallback(\n    (newBriefingContent: string) => {\n      setBriefingContent(newBriefingContent);\n      setHasUnsavedChangesToBriefing(newBriefingContent !== cachedBriefingContent);\n    },\n    [cachedBriefingContent]\n  );\n\n  const setMissionMetadataWrapper = useCallback(\n    (newMissionMetadata: MissionMetadata) => {\n      setMissionMetadata(newMissionMetadata);\n      setHasUnsavedChangesToMetadata(!isEqual(newMissionMetadata, cachedMissionMetadata));\n    },\n    [cachedMissionMetadata]\n  );\n\n  const setTaskListWrapper = useCallback(\n    (newTaskList: TaskData[]) => {\n      setTaskList(newTaskList);\n      setHasUnsavedChangesToTasks(!isEqual(newTaskList, cachedTaskList));\n    },\n    [cachedTaskList]\n  );\n\n  const setDisplayMCQInEditorWrapper = useCallback(\n    (shouldDisplayMCQ: boolean) => {\n      if (shouldDisplayMCQ) {\n        const [isMCQText, mcqQuestion] = convertToMCQQuestionIfMCQText(\n          taskList[currentTaskNumber - 1].savedCode\n        );\n        setCurrentTaskIsMCQ(isMCQText);\n        setMCQQuestion(mcqQuestion);\n      }\n\n      setDisplayMCQInEditor(shouldDisplayMCQ);\n    },\n    [taskList, currentTaskNumber]\n  );\n\n  // Forces a re-render when saveable information changes, keeps environment state in-sync with component state\n  const computedHasUnsavedChanges = useMemo(() => {\n    return hasUnsavedChangesToMetadata || hasUnsavedChangesToBriefing || hasUnsavedChangesToTasks;\n  }, [hasUnsavedChangesToMetadata, hasUnsavedChangesToBriefing, hasUnsavedChangesToTasks]);\n\n  useEffect(() => {\n    if (computedHasUnsavedChanges !== hasUnsavedChanges) {\n      handleUpdateHasUnsavedChanges(computedHasUnsavedChanges);\n    }\n  }, [computedHasUnsavedChanges, hasUnsavedChanges, handleUpdateHasUnsavedChanges]);\n\n  /**\n   * Sets up the workspace for when the user is retrieving Mission information from a GitHub repository\n   */\n  const setUpWithAssessmentOverview = useCallback(async () => {\n    if (octokit === undefined) return;\n\n    const missionRepoData = assessmentOverview.missionRepoData;\n\n    const missionDataPromise = getMissionData(missionRepoData, octokit);\n    const isTeacherModePromise = octokit.users.getAuthenticated().then((authenticatedUser: any) => {\n      const userLogin = authenticatedUser.data.login;\n      return userLogin === missionRepoData.repoOwner;\n    });\n\n    const promises = [missionDataPromise, isTeacherModePromise];\n\n    Promise.all(promises).then((promises: any[]) => {\n      setMissionRepoData(missionRepoData);\n\n      setHasUnsavedChangesToTasks(false);\n      setHasUnsavedChangesToBriefing(false);\n      setHasUnsavedChangesToMetadata(false);\n      handleUpdateHasUnsavedChanges(false);\n\n      const missionData: MissionData = promises[0];\n      setSummary(missionData.missionBriefing);\n\n      setMissionMetadata(missionData.missionMetadata);\n      setCachedMissionMetadata(missionData.missionMetadata);\n\n      setBriefingContent(missionData.missionBriefing);\n      setCachedBriefingContent(missionData.missionBriefing);\n\n      setTaskList(missionData.tasksData);\n      setCachedTaskList(\n        missionData.tasksData.map((taskData: TaskData) => Object.assign({}, taskData))\n      );\n\n      changeStateDueToChangedTaskNumber(1, missionData.tasksData);\n\n      const isTeacherMode: boolean = promises[1];\n      setIsTeacherMode(isTeacherMode);\n\n      setIsLoading(false);\n    });\n  }, [\n    assessmentOverview,\n    octokit,\n    changeStateDueToChangedTaskNumber,\n    handleUpdateHasUnsavedChanges\n  ]);\n\n  /**\n   * Sets up the workspace for when the user is creating a new Mission\n   */\n  const setUpWithoutAssessmentOverview = useCallback(() => {\n    setSummary(defaultMissionBriefing);\n\n    setMissionMetadata(defaultMissionMetadata);\n    setCachedMissionMetadata(defaultMissionMetadata);\n\n    setBriefingContent(defaultMissionBriefing);\n    setCachedBriefingContent(defaultMissionBriefing);\n\n    setTaskList([defaultTask]);\n    setCachedTaskList([defaultTask]);\n\n    setDisplayMCQInEditor(false);\n    changeStateDueToChangedTaskNumber(1, [defaultTask]);\n\n    setHasUnsavedChangesToTasks(false);\n    setHasUnsavedChangesToBriefing(false);\n    setHasUnsavedChangesToMetadata(false);\n    handleUpdateHasUnsavedChanges(false);\n\n    setIsTeacherMode(true);\n    setIsLoading(false);\n  }, [changeStateDueToChangedTaskNumber, handleUpdateHasUnsavedChanges]);\n\n  useEffect(() => {\n    if (assessmentOverview === undefined) {\n      setUpWithoutAssessmentOverview();\n    } else {\n      setUpWithAssessmentOverview();\n    }\n  }, [assessmentOverview, setUpWithAssessmentOverview, setUpWithoutAssessmentOverview]);\n\n  const briefingOverlay = (\n    <Dialog className=\"assessment-briefing\" isOpen={showBriefingOverlay}>\n      <Card>\n        <Markdown content={summary} />\n        <Button\n          className=\"assessment-briefing-button\"\n          onClick={() => setShowBriefingOverlay(false)}\n          text=\"Continue\"\n        />\n      </Card>\n    </Dialog>\n  );\n\n  /**\n   * Handles the changes to the taskList\n   */\n  const editCode = useCallback(\n    (taskNumber: number, newValue: string) => {\n      if (taskNumber > taskList.length) {\n        return;\n      }\n      const editedTaskList = taskList.map((taskData: TaskData) => Object.assign({}, taskData));\n      editedTaskList[taskNumber - 1] = {\n        ...editedTaskList[taskNumber - 1],\n        savedCode: newValue\n      };\n\n      setTaskListWrapper(editedTaskList);\n    },\n    [taskList, setTaskListWrapper]\n  );\n\n  const resetToTemplate = useCallback(() => {\n    const originalCode = taskList[currentTaskNumber - 1].starterCode;\n    handleEditorValueChange(originalCode);\n    editCode(currentTaskNumber, originalCode);\n  }, [currentTaskNumber, editCode, handleEditorValueChange, taskList]);\n\n  const conductSave = useCallback(\n    async (\n      changedFile: string,\n      newFileContent: string,\n      githubName: string | null,\n      githubEmail: string | null,\n      commitMessage: string\n    ) => {\n      const typedMissionRepoData = missionRepoData as MissionRepoData;\n\n      const { saveType } = await checkIfFileCanBeSavedAndGetSaveType(\n        octokit,\n        typedMissionRepoData.repoOwner,\n        typedMissionRepoData.repoName,\n        changedFile\n      );\n\n      if (saveType === 'Overwrite') {\n        await performOverwritingSave(\n          octokit,\n          typedMissionRepoData.repoOwner,\n          typedMissionRepoData.repoName,\n          changedFile,\n          githubName,\n          githubEmail,\n          commitMessage,\n          newFileContent\n        );\n      }\n\n      if (saveType === 'Create') {\n        await performCreatingSave(\n          octokit,\n          typedMissionRepoData.repoOwner,\n          typedMissionRepoData.repoName,\n          changedFile,\n          githubName,\n          githubEmail,\n          commitMessage,\n          newFileContent\n        );\n      }\n    },\n    [missionRepoData, octokit]\n  );\n\n  const conductDelete = useCallback(\n    async (\n      fileName: string,\n      githubName: string | null,\n      githubEmail: string | null,\n      commitMessage: string\n    ) => {\n      const typedMissionRepoData = missionRepoData as MissionRepoData;\n\n      await performFolderDeletion(\n        octokit,\n        typedMissionRepoData.repoOwner,\n        typedMissionRepoData.repoName,\n        fileName,\n        githubName,\n        githubEmail,\n        commitMessage\n      );\n    },\n    [missionRepoData, octokit]\n  );\n\n  /**\n   * To be used when the information to be saved corresponds to an existing GitHub repository\n   */\n  const saveWithMissionRepoData = useCallback(async () => {\n    if (octokit === undefined) {\n      showWarningMessage('Please sign in with GitHub!', 2000);\n      return;\n    }\n\n    const [filenameToContentMap, foldersToDelete] = discoverFilesToBeChangedWithMissionRepoData(\n      missionMetadata,\n      cachedMissionMetadata,\n      briefingContent,\n      cachedBriefingContent,\n      taskList,\n      cachedTaskList,\n      isTeacherMode\n    );\n    const changedFiles = Object.keys(filenameToContentMap);\n\n    type GetAuthenticatedResponse = GetResponseTypeFromEndpointMethod<\n      typeof octokit.users.getAuthenticated\n    >;\n    const authUser: GetAuthenticatedResponse = await octokit.users.getAuthenticated();\n    const githubName = authUser.data.name;\n    const githubEmail = authUser.data.email;\n    const commitMessage = '';\n\n    for (let i = 0; i < foldersToDelete.length; i++) {\n      await conductDelete(foldersToDelete[i], githubName, githubEmail, commitMessage);\n    }\n\n    for (let i = 0; i < changedFiles.length; i++) {\n      const filename = changedFiles[i];\n      const newFileContent = filenameToContentMap[filename];\n      await conductSave(filename, newFileContent, githubName, githubEmail, commitMessage);\n    }\n\n    setCachedTaskList(taskList);\n    setCachedBriefingContent(briefingContent);\n    setCachedMissionMetadata(missionMetadata);\n\n    setHasUnsavedChangesToTasks(false);\n    setHasUnsavedChangesToBriefing(false);\n    setHasUnsavedChangesToMetadata(false);\n  }, [\n    octokit,\n    isTeacherMode,\n    briefingContent,\n    missionMetadata,\n    taskList,\n    cachedTaskList,\n    cachedBriefingContent,\n    cachedMissionMetadata,\n    conductSave,\n    conductDelete\n  ]);\n\n  /**\n   * To be used when the information to be saved to a new GitHub repository\n   */\n  const saveWithoutMissionRepoData = useCallback(async () => {\n    if (octokit === undefined) {\n      showWarningMessage('Please sign in with GitHub!', 2000);\n      return;\n    }\n\n    const filenameToContentMap = discoverFilesToBeCreatedWithoutMissionRepoData(\n      missionMetadata,\n      briefingContent,\n      taskList\n    );\n\n    const changedFiles = Object.keys(filenameToContentMap).sort();\n    const authUser = await octokit.users.getAuthenticated();\n\n    const dialogResults = await promisifyDialog<\n      GitHubMissionCreateDialogProps,\n      GitHubMissionCreateDialogResolution\n    >(GitHubMissionCreateDialog, resolve => ({\n      filesToCreate: changedFiles,\n      userLogin: authUser.data.login,\n      resolveDialog: dialogResults => resolve(dialogResults)\n    }));\n\n    if (!dialogResults.confirmSave) {\n      return;\n    }\n\n    const githubName = authUser.data.name;\n    const githubEmail = authUser.data.email;\n    const repoName = dialogResults.repoName;\n    const repoOwner = authUser.data.login;\n\n    try {\n      await octokit.repos.createForAuthenticatedUser({\n        name: repoName\n      });\n\n      for (let i = 0; i < changedFiles.length; i++) {\n        const fileToCreate = changedFiles[i];\n        const fileContent = filenameToContentMap[fileToCreate];\n\n        await performCreatingSave(\n          octokit,\n          repoOwner,\n          repoName,\n          fileToCreate,\n          githubName,\n          githubEmail,\n          'Repository created from Source Academy',\n          fileContent\n        );\n      }\n\n      setCachedTaskList(taskList);\n      setCachedBriefingContent(briefingContent);\n      setCachedMissionMetadata(missionMetadata);\n\n      setHasUnsavedChangesToTasks(false);\n      setHasUnsavedChangesToBriefing(false);\n      setHasUnsavedChangesToMetadata(false);\n\n      setMissionRepoData({\n        repoOwner: repoOwner,\n        repoName: repoName,\n        dateOfCreation: new Date()\n      });\n    } catch (err) {\n      console.error(err);\n      showWarningMessage('Something went wrong while creating the repository!', 2000);\n    }\n  }, [briefingContent, missionMetadata, octokit, taskList]);\n\n  const onClickSave = useCallback(() => {\n    if (assessmentOverview !== undefined && new Date() > assessmentOverview.dueDate) {\n      showWarningMessage('It is past the due date for this assessment!');\n      return;\n    }\n\n    if (missionRepoData !== undefined) {\n      saveWithMissionRepoData();\n    } else {\n      saveWithoutMissionRepoData();\n    }\n  }, [assessmentOverview, missionRepoData, saveWithMissionRepoData, saveWithoutMissionRepoData]);\n\n  const onClickReset = useCallback(async () => {\n    const confirmReset = await showSimpleConfirmDialog({\n      contents: (\n        <div className={Classes.DIALOG_BODY}>\n          <Markdown content=\"Are you sure you want to reset the template?\" />\n          <Markdown content=\"*Note this will not affect the saved copy of your program, unless you save over it.*\" />\n        </div>\n      ),\n      negativeLabel: 'Cancel',\n      positiveIntent: 'primary',\n      positiveLabel: 'Confirm'\n    });\n\n    if (confirmReset) {\n      resetToTemplate();\n    }\n  }, [resetToTemplate]);\n\n  /**\n   * Checks to ensure that the user wants to discard their current changes\n   */\n  const shouldProceedToChangeTask = useCallback(\n    (\n      currentTaskNumber: number,\n      taskList: TaskData[],\n      cachedTaskList: TaskData[],\n      missionRepoData: MissionRepoData\n    ) => {\n      if (missionRepoData === undefined) {\n        return true;\n      }\n\n      const taskIndex = currentTaskNumber - 1;\n      if (!isEqual(taskList[taskIndex], cachedTaskList[taskIndex])) {\n        return window.confirm(\n          'You have unsaved changes to the current question. Are you sure you want to continue?'\n        );\n      }\n\n      return true;\n    },\n    []\n  );\n\n  const onClickPrevious = useCallback(() => {\n    if (\n      shouldProceedToChangeTask(\n        currentTaskNumber,\n        taskList,\n        cachedTaskList,\n        missionRepoData as MissionRepoData\n      )\n    ) {\n      let activeTaskList = taskList;\n      if (missionRepoData !== undefined) {\n        activeTaskList = cachedTaskList.map((taskData: TaskData) => Object.assign({}, taskData));\n        setTaskListWrapper(activeTaskList);\n      }\n      const newTaskNumber = currentTaskNumber - 1;\n      changeStateDueToChangedTaskNumber(newTaskNumber, activeTaskList);\n    }\n  }, [\n    currentTaskNumber,\n    taskList,\n    cachedTaskList,\n    missionRepoData,\n    setTaskListWrapper,\n    shouldProceedToChangeTask,\n    changeStateDueToChangedTaskNumber\n  ]);\n\n  const onClickNext = useCallback(() => {\n    if (\n      shouldProceedToChangeTask(\n        currentTaskNumber,\n        taskList,\n        cachedTaskList,\n        missionRepoData as MissionRepoData\n      )\n    ) {\n      let activeTaskList = taskList;\n      if (missionRepoData !== undefined) {\n        activeTaskList = cachedTaskList.map((taskData: TaskData) => Object.assign({}, taskData));\n        setTaskListWrapper(activeTaskList);\n      }\n      const newTaskNumber = currentTaskNumber + 1;\n      changeStateDueToChangedTaskNumber(newTaskNumber, activeTaskList);\n    }\n  }, [\n    currentTaskNumber,\n    taskList,\n    cachedTaskList,\n    missionRepoData,\n    setTaskListWrapper,\n    shouldProceedToChangeTask,\n    changeStateDueToChangedTaskNumber\n  ]);\n\n  const onClickReturn = useCallback(() => {\n    history.push('/githubassessments/missions');\n  }, []);\n\n  /**\n   * Handles toggling of relevant SideContentTabs when mobile breakpoint it hit\n   */\n  React.useEffect(() => {\n    if (\n      !isMobileBreakpoint &&\n      (selectedTab === SideContentType.mobileEditor ||\n        selectedTab === SideContentType.mobileEditorRun)\n    ) {\n      setSelectedTab(SideContentType.questionOverview);\n    }\n  }, [isMobileBreakpoint, props, selectedTab]);\n\n  const onEditorValueChange = React.useCallback(\n    val => {\n      handleEditorValueChange(val);\n      editCode(currentTaskNumber, val);\n    },\n    [currentTaskNumber, editCode, handleEditorValueChange]\n  );\n\n  const onChangeTabs = (\n    newTabId: SideContentType,\n    prevTabId: SideContentType,\n    event: React.MouseEvent<HTMLElement>\n  ) => {\n    if (newTabId === prevTabId) {\n      return;\n    }\n    setSelectedTab(newTabId);\n  };\n\n  /**\n   * handleEval used in both the Run button, and during 'shift-enter' in AceEditor\n   *\n   * However, AceEditor only binds commands on mount (https://github.com/securingsincity/react-ace/issues/684)\n   * Thus, we use a mutable ref to overcome the stale closure problem\n   */\n  const activeTab = React.useRef(selectedTab);\n  activeTab.current = selectedTab;\n  const handleEval = () => {\n    props.handleEditorEval();\n\n    // Run testcases when the GitHub testcases tab is selected\n    if (activeTab.current === SideContentType.testcases) {\n      dispatch(runAllTestcases(workspaceLocation));\n    }\n  };\n\n  const setTaskDescriptions = useCallback(\n    (newTaskDescriptions: string[]) => {\n      const newTaskList: TaskData[] = [];\n\n      for (let i = 0; i < taskList.length; i++) {\n        const nextElement = Object.assign({}, taskList[i]) as TaskData;\n        nextElement.taskDescription = newTaskDescriptions[i];\n        newTaskList.push(nextElement);\n      }\n\n      setTaskListWrapper(newTaskList);\n    },\n    [taskList, setTaskListWrapper]\n  );\n\n  const setTaskTestcases = useCallback(\n    (newTestcases: Testcase[]) => {\n      const editedTaskList = taskList.map((taskData: TaskData) => Object.assign({}, taskData));\n      editedTaskList[currentTaskNumber - 1] = {\n        ...editedTaskList[currentTaskNumber - 1],\n        testCases: newTestcases\n      };\n\n      handleUpdateWorkspace({\n        editorTestcases: editedTaskList[currentTaskNumber - 1].testCases\n      });\n\n      setTaskListWrapper(editedTaskList);\n    },\n    [currentTaskNumber, taskList, handleUpdateWorkspace, setTaskListWrapper]\n  );\n\n  const setTestPrepend = useCallback(\n    (newTestPrepend: string) => {\n      const editedTaskList = taskList.map((taskData: TaskData) => Object.assign({}, taskData));\n      editedTaskList[currentTaskNumber - 1] = {\n        ...editedTaskList[currentTaskNumber - 1],\n        testPrepend: newTestPrepend\n      };\n      setTaskListWrapper(editedTaskList);\n    },\n    [currentTaskNumber, taskList, setTaskListWrapper]\n  );\n\n  const setTestPostpend = useCallback(\n    (newTestPostpend: string) => {\n      const editedTaskList = taskList.map((taskData: TaskData) => Object.assign({}, taskData));\n      editedTaskList[currentTaskNumber - 1] = {\n        ...editedTaskList[currentTaskNumber - 1],\n        testPostpend: newTestPostpend\n      };\n      setTaskListWrapper(editedTaskList);\n    },\n    [currentTaskNumber, taskList, setTaskListWrapper]\n  );\n\n  const sideContentProps: (p: GitHubAssessmentWorkspaceProps) => SideContentProps = (\n    props: GitHubAssessmentWorkspaceProps\n  ) => {\n    const tabs: SideContentTab[] = [\n      {\n        label: 'Task',\n        iconName: IconNames.NINJA,\n        body: (\n          <SideContentTaskEditor\n            allowEdits={isTeacherMode}\n            currentTaskNumber={currentTaskNumber}\n            taskDescriptions={taskList.map(taskData => taskData.taskDescription)}\n            setTaskDescriptions={setTaskDescriptions}\n          />\n        ),\n        id: SideContentType.questionOverview\n      },\n      {\n        label: 'Briefing',\n        iconName: IconNames.BRIEFCASE,\n        body: (\n          <SideContentMarkdownEditor\n            allowEdits={isTeacherMode}\n            content={briefingContent}\n            setContent={setBriefingContentWrapper}\n          />\n        ),\n        id: SideContentType.briefing\n      }\n    ];\n\n    const taskIndex = currentTaskNumber - 1;\n    const testPrepend = taskList[taskIndex] ? taskList[taskIndex].testPrepend : '';\n    const testPostpend = taskList[taskIndex] ? taskList[taskIndex].testPostpend : '';\n    tabs.push({\n      label: 'Testcases',\n      iconName: IconNames.AIRPLANE,\n      body: (\n        <SideContentTestcaseEditor\n          allowEdits={isTeacherMode}\n          testcases={editorTestcases}\n          testPrepend={testPrepend}\n          testPostpend={testPostpend}\n          setTaskTestcases={setTaskTestcases}\n          setTestPrepend={setTestPrepend}\n          setTestPostpend={setTestPostpend}\n          handleTestcaseEval={testcaseId => dispatch(evalTestcase(workspaceLocation, testcaseId))}\n        />\n      ),\n      id: SideContentType.testcases\n    });\n\n    if (isTeacherMode) {\n      // Teachers have ability to edit mission metadata\n      tabs.push({\n        label: 'Mission Metadata',\n        iconName: IconNames.BUILD,\n        body: (\n          <SideContentMissionEditor\n            missionMetadata={missionMetadata}\n            setMissionMetadata={setMissionMetadataWrapper}\n          />\n        ),\n        id: SideContentType.missionMetadata\n      });\n    }\n\n    return {\n      selectedTabId: selectedTab,\n      tabs: {\n        beforeDynamicTabs: tabs,\n        afterDynamicTabs: []\n      },\n      onChange: onChangeTabs,\n      workspaceLocation: 'githubAssessment'\n    };\n  };\n\n  const addNewQuestion = () => {\n    const newTaskList = taskList\n      .slice(0, currentTaskNumber)\n      .concat([defaultTask])\n      .concat(taskList.slice(currentTaskNumber, taskList.length));\n    setTaskListWrapper(newTaskList);\n\n    const newTaskNumber = currentTaskNumber + 1;\n    changeStateDueToChangedTaskNumber(newTaskNumber, newTaskList);\n  };\n\n  const deleteCurrentQuestion = () => {\n    const deleteAtIndex = currentTaskNumber - 1;\n\n    const newTaskList = taskList\n      .slice(0, deleteAtIndex)\n      .concat(taskList.slice(currentTaskNumber, taskList.length));\n    setTaskListWrapper(newTaskList);\n\n    const newTaskNumber = currentTaskNumber === 1 ? currentTaskNumber : currentTaskNumber - 1;\n    changeStateDueToChangedTaskNumber(newTaskNumber, newTaskList);\n  };\n\n  const controlBarProps: () => ControlBarProps = () => {\n    const runButton = <ControlBarRunButton handleEditorEval={handleEval} key=\"run\" />;\n\n    const saveButton = (\n      <ControlButtonSaveButton\n        hasUnsavedChanges={hasUnsavedChanges}\n        key=\"save\"\n        onClickSave={onClickSave}\n      />\n    );\n\n    const resetButton = <ControlBarResetButton key=\"reset\" onClick={onClickReset} />;\n\n    const chapterSelect = (\n      <ControlBarChapterSelect\n        handleChapterSelect={() => {}}\n        sourceChapter={missionMetadata.sourceVersion}\n        sourceVariant={Constants.defaultSourceVariant}\n        disabled={true}\n        key=\"chapter\"\n      />\n    );\n\n    const nextButton = (\n      <ControlBarNextButton\n        onClickNext={onClickNext}\n        onClickReturn={onClickReturn}\n        questionProgress={[currentTaskNumber, taskList.length]}\n        key=\"next_question\"\n      />\n    );\n\n    const previousButton = (\n      <ControlBarPreviousButton\n        onClick={onClickPrevious}\n        questionProgress={[currentTaskNumber, taskList.length]}\n        key=\"previous_question\"\n      />\n    );\n\n    const questionView = (\n      <ControlBarQuestionViewButton\n        key=\"task_view\"\n        questionProgress={[currentTaskNumber, taskList.length]}\n      />\n    );\n\n    const editorButtons = !isMobileBreakpoint\n      ? [runButton, saveButton, resetButton, chapterSelect]\n      : [saveButton, resetButton];\n\n    if (isTeacherMode) {\n      const addTaskButton = (\n        <ControlBarTaskAddButton\n          addNewQuestion={addNewQuestion}\n          numberOfTasks={taskList.length}\n          key=\"add_task\"\n        />\n      );\n      const deleteTaskButton = (\n        <ControlBarTaskDeleteButton\n          deleteCurrentQuestion={deleteCurrentQuestion}\n          numberOfTasks={taskList.length}\n          key=\"delete_task\"\n        />\n      );\n      const showMCQButton = (\n        <ControlBarDisplayMCQButton\n          displayMCQInEditor={() => setDisplayMCQInEditorWrapper(true)}\n          displayTextInEditor={() => setDisplayMCQInEditorWrapper(false)}\n          mcqDisplayed={displayMCQInEditor}\n          key=\"display MCQ\"\n        />\n      );\n\n      editorButtons.push(addTaskButton, deleteTaskButton, showMCQButton);\n    }\n\n    const flowButtons = [previousButton, questionView, nextButton];\n\n    return {\n      editorButtons: editorButtons,\n      flowButtons: flowButtons\n    };\n  };\n\n  const mobileSideContentProps: () => MobileSideContentProps = () => {\n    const onChangeTabs = (\n      newTabId: SideContentType,\n      prevTabId: SideContentType,\n      event: React.MouseEvent<HTMLElement>\n    ) => {\n      if (newTabId === prevTabId) {\n        return;\n      }\n\n      // Do nothing when clicking the mobile 'Run' tab while on the testcases tab.\n      if (\n        !(prevTabId === SideContentType.testcases && newTabId === SideContentType.mobileEditorRun)\n      ) {\n        setSelectedTab(newTabId);\n      }\n    };\n\n    const sideContent = sideContentProps(props);\n\n    return {\n      mobileControlBarProps: {\n        ...controlBarProps()\n      },\n      ...sideContent,\n      onChange: onChangeTabs,\n      selectedTabId: selectedTab,\n      handleEditorEval: handleEval\n    };\n  };\n\n  const replButtons = () => {\n    const clearButton = (\n      <ControlBarClearButton handleReplOutputClear={handleReplOutputClear} key=\"clear_repl\" />\n    );\n\n    const evalButton = (\n      <ControlBarEvalButton\n        handleReplEval={props.handleReplEval}\n        isRunning={props.isRunning}\n        key=\"eval_repl\"\n      />\n    );\n\n    return [evalButton, clearButton];\n  };\n\n  const handleMCQSubmit = useCallback(\n    (choiceId: number) => {\n      if (!currentTaskIsMCQ) {\n        return;\n      }\n\n      const newMCQQuestion = Object.assign({}, mcqQuestion);\n      newMCQQuestion.answer = choiceId;\n\n      setMCQQuestion(newMCQQuestion);\n      editCode(currentTaskNumber, convertIMCQQuestionToMCQText(newMCQQuestion));\n    },\n    [currentTaskIsMCQ, currentTaskNumber, editCode, mcqQuestion]\n  );\n\n  const mcqProps = useMemo(() => {\n    return currentTaskIsMCQ && displayMCQInEditor\n      ? {\n          mcq: mcqQuestion,\n          handleMCQSubmit: handleMCQSubmit\n        }\n      : undefined;\n  }, [currentTaskIsMCQ, displayMCQInEditor, mcqQuestion, handleMCQSubmit]);\n\n  const editorContainerProps: NormalEditorContainerProps = {\n    editorVariant: 'normal',\n    editorTabs: props.editorTabs.map(convertEditorTabStateToProps),\n    editorSessionId: '',\n    handleDeclarationNavigate: (cursorPosition: Position) =>\n      dispatch(navigateToDeclaration(workspaceLocation, cursorPosition)),\n    handleEditorEval: handleEval,\n    handleEditorCheck: () => {},\n    handleEditorValueChange: onEditorValueChange,\n    handleUpdateHasUnsavedChanges: handleUpdateHasUnsavedChanges,\n    handleEditorUpdateBreakpoints: (breakpoints: string[]) =>\n      dispatch(setEditorBreakpoint(breakpoints, workspaceLocation)),\n    handlePromptAutocomplete: (row: number, col: number, callback: any) =>\n      dispatch(promptAutocomplete(workspaceLocation, row, col, callback)),\n    isEditorAutorun: false\n  };\n  const replProps = {\n    handleBrowseHistoryDown: () => dispatch(browseReplHistoryDown(workspaceLocation)),\n    handleBrowseHistoryUp: () => dispatch(browseReplHistoryUp(workspaceLocation)),\n    handleReplEval: props.handleReplEval,\n    handleReplValueChange: (newValue: string) =>\n      dispatch(updateReplValue(newValue, workspaceLocation)),\n    output: props.output,\n    replValue: props.replValue,\n    sourceChapter: missionMetadata.sourceVersion || Chapter.CALC,\n    sourceVariant: Variant.DEFAULT,\n    externalLibrary: ExternalLibraryName.NONE,\n    replButtons: replButtons()\n  };\n  const sideBarProps = {\n    tabs: []\n  };\n  const workspaceProps: WorkspaceProps = {\n    controlBarProps: controlBarProps(),\n    editorContainerProps: currentTaskIsMCQ && displayMCQInEditor ? undefined : editorContainerProps,\n    handleSideContentHeightChange: heightChange =>\n      dispatch(changeSideContentHeight(heightChange, workspaceLocation)),\n    hasUnsavedChanges: hasUnsavedChanges,\n    mcqProps: mcqProps,\n    sideBarProps: sideBarProps,\n    sideContentHeight: props.sideContentHeight,\n    sideContentProps: sideContentProps(props),\n    replProps: replProps\n  };\n  const mobileWorkspaceProps: MobileWorkspaceProps = {\n    editorContainerProps: currentTaskIsMCQ && displayMCQInEditor ? undefined : editorContainerProps,\n    replProps: replProps,\n    sideBarProps: sideBarProps,\n    hasUnsavedChanges: hasUnsavedChanges,\n    mcqProps: mcqProps,\n    mobileSideContentProps: mobileSideContentProps()\n  };\n\n  if (isLoading) {\n    return (\n      <div className={classNames('missionLoading', Classes.DARK)}>\n        <NonIdealState description=\"Loading\" icon={<Spinner size={SpinnerSize.LARGE} />} />\n      </div>\n    );\n  } else {\n    return (\n      <div className={classNames('WorkspaceParent', Classes.DARK)}>\n        {briefingOverlay}\n        {isMobileBreakpoint ? (\n          <MobileWorkspace {...mobileWorkspaceProps} />\n        ) : (\n          <Workspace {...workspaceProps} />\n        )}\n      </div>\n    );\n  }\n};\n\nexport default GitHubAssessmentWorkspace;\n","import { Chapter, Variant } from 'c-slang/dist/types';\nimport { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { withRouter } from 'react-router';\nimport { bindActionCreators, Dispatch } from 'redux';\n\nimport { OverallState } from '../../commons/application/ApplicationTypes';\nimport {\n  chapterSelect,\n  clearReplOutput,\n  evalEditor,\n  evalRepl,\n  updateEditorValue,\n  updateHasUnsavedChanges,\n  updateWorkspace\n} from '../../commons/workspace/WorkspaceActions';\nimport { WorkspaceLocation, WorkspaceState } from '../../commons/workspace/WorkspaceTypes';\nimport MissionEditor, { DispatchProps, StateProps } from './GitHubAssessmentWorkspace';\n\nconst mapStateToProps: MapStateToProps<StateProps, {}, OverallState> = state => {\n  return {\n    activeEditorTabIndex: state.workspaces.githubAssessment.activeEditorTabIndex,\n    editorTabs: state.workspaces.githubAssessment.editorTabs,\n    editorTestcases: state.workspaces.githubAssessment.editorTestcases,\n    hasUnsavedChanges: state.workspaces.githubAssessment.hasUnsavedChanges,\n    isRunning: state.workspaces.githubAssessment.isRunning,\n    isDebugging: state.workspaces.githubAssessment.isDebugging,\n    enableDebugging: state.workspaces.githubAssessment.enableDebugging,\n    output: state.workspaces.githubAssessment.output,\n    replValue: state.workspaces.githubAssessment.replValue,\n    sideContentHeight: state.workspaces.githubAssessment.sideContentHeight,\n    sourceChapter: Chapter.CALC\n  };\n};\n\nconst workspaceLocation: WorkspaceLocation = 'githubAssessment';\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = (dispatch: Dispatch) =>\n  bindActionCreators(\n    {\n      handleChapterSelect: (chapter: Chapter) =>\n        chapterSelect(chapter, Variant.DEFAULT, workspaceLocation),\n      handleEditorEval: () => evalEditor(workspaceLocation),\n      handleEditorValueChange: (val: string) => updateEditorValue(val, workspaceLocation),\n      handleReplEval: () => evalRepl(workspaceLocation),\n      handleReplOutputClear: () => clearReplOutput(workspaceLocation),\n      handleUpdateHasUnsavedChanges: (hasUnsavedChanges: boolean) =>\n        updateHasUnsavedChanges(workspaceLocation, hasUnsavedChanges),\n      handleUpdateWorkspace: (options: Partial<WorkspaceState>) =>\n        updateWorkspace(workspaceLocation, options)\n    },\n    dispatch\n  );\n\nconst GitHubAssessmentWorkspaceContainer = withRouter(\n  connect(mapStateToProps, mapDispatchToProps)(MissionEditor)\n);\n\nexport default GitHubAssessmentWorkspaceContainer;\n","import { ButtonGroup } from '@blueprintjs/core';\nimport { IconNames } from '@blueprintjs/icons';\nimport * as React from 'react';\nimport { useResponsive, useTypedSelector } from 'src/commons/utils/Hooks';\n\nimport ControlButton from '../../ControlButton';\n\nexport type ControlBarGitHubLoginButtonProps = {\n  onClickLogIn: () => void;\n  onClickLogOut: () => void;\n};\n\n/**\n * GitHub buttons to be used for the GitHub-hosted mission interface.\n *\n * @param props Component properties\n */\nexport const ControlBarGitHubLoginButton: React.FC<ControlBarGitHubLoginButtonProps> = props => {\n  const { isMobileBreakpoint } = useResponsive();\n  const isLoggedIn =\n    useTypedSelector(store => store.session.githubOctokitObject).octokit !== undefined;\n\n  const loginButton = isLoggedIn ? (\n    <ControlButton label=\"Log Out\" icon={IconNames.GIT_BRANCH} onClick={props.onClickLogOut} />\n  ) : (\n    <ControlButton label=\"Log In\" icon={IconNames.GIT_BRANCH} onClick={props.onClickLogIn} />\n  );\n\n  return <ButtonGroup large={!isMobileBreakpoint}>{loginButton}</ButtonGroup>;\n};\n","import {\n  Alignment,\n  Button,\n  Classes,\n  Icon,\n  InputGroup,\n  Menu,\n  MenuItem,\n  Navbar,\n  NavbarGroup\n} from '@blueprintjs/core';\nimport { IconName, IconNames } from '@blueprintjs/icons';\nimport { Popover2 } from '@blueprintjs/popover2';\nimport { Octokit } from '@octokit/rest';\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport { NavLink } from 'react-router-dom';\n\nimport { GHAssessmentTypeOverview } from '../../../pages/githubAssessments/GitHubClassroom';\nimport { ControlBarGitHubLoginButton } from '../../controlBar/github/ControlBarGitHubLoginButton';\nimport { assessmentTypeLink } from '../../utils/ParamParseHelper';\n\ntype GitHubAssessmentsNavigationBarProps = DispatchProps & StateProps;\n\ntype DispatchProps = {\n  changeCourseHandler: (e: any) => void;\n  handleGitHubLogIn: () => void;\n  handleGitHubLogOut: () => void;\n};\n\ntype StateProps = {\n  octokit?: Octokit;\n  courses?: string[];\n  selectedCourse: string;\n  types?: string[];\n  assessmentTypeOverviews?: GHAssessmentTypeOverview[];\n};\n\n/**\n * The white navbar for the website. Should only be displayed when using GitHub-hosted missions.\n */\nconst GitHubAssessmentsNavigationBar: React.FC<GitHubAssessmentsNavigationBarProps> = props => {\n  const handleClick = (e: any) => {\n    props.changeCourseHandler(e);\n  };\n\n  return (\n    <Navbar className=\"NavigationBar secondary-navbar\">\n      <NavbarGroup align={Alignment.LEFT}>\n        {props.types?.map((type, idx) => {\n          return (\n            <NavLink\n              key={type}\n              to={{\n                pathname: `/githubassessments/${assessmentTypeLink(type)}`,\n                state: {\n                  courses: props.courses,\n                  assessmentTypeOverviews: props.assessmentTypeOverviews,\n                  selectedCourse: props.selectedCourse\n                }\n              }}\n              activeClassName={Classes.ACTIVE}\n              className={classNames('NavigationBar__link', Classes.BUTTON, Classes.MINIMAL)}\n            >\n              <Icon icon={idx < 5 ? icons[idx] : icons[0]} />\n              <div className=\"navbar-button-text hidden-xs hidden-sm\">{type}</div>\n            </NavLink>\n          );\n        })}\n      </NavbarGroup>\n      <NavbarGroup align={Alignment.RIGHT}>\n        {props.octokit !== undefined && props.types && props.types.length > 0 && (\n          <InputGroup\n            key=\"courseselect\"\n            disabled={true}\n            leftElement={\n              <Popover2\n                content={\n                  <Menu>\n                    {props.courses?.map((course: string) => (\n                      <MenuItem key={course} onClick={handleClick} text={course} />\n                    ))}\n                  </Menu>\n                }\n                placement={'bottom-end'}\n              >\n                <Button minimal={true} rightIcon=\"caret-down\" aria-label=\"choose\" />\n              </Popover2>\n            }\n            placeholder={'Select Course'}\n            onChange={props.changeCourseHandler}\n            value={props.selectedCourse}\n          />\n        )}\n        <ControlBarGitHubLoginButton\n          key=\"loginlogout\"\n          onClickLogIn={props.handleGitHubLogIn}\n          onClickLogOut={props.handleGitHubLogOut}\n        />\n      </NavbarGroup>\n    </Navbar>\n  );\n};\n\nconst icons: IconName[] = [\n  IconNames.FLAME,\n  IconNames.LIGHTBULB,\n  IconNames.PREDICTIVE_ANALYSIS,\n  IconNames.COMPARISON,\n  IconNames.MANUAL\n];\n\nexport default GitHubAssessmentsNavigationBar;\n","/** history is created and exported here instead of in src/index.tsx as jest\n * would otherwise throw an error. See: https://stackoverflow.com/a/42611909/6910451\n */\nimport { createBrowserHistory } from 'history';\n\nexport const history = createBrowserHistory();\n","import { AssessmentType } from '../assessment/AssessmentTypes';\n\n/**\n * Converts an AssessmentType into a string for use in URLs.\n */\nexport const assessmentTypeLink = (assessmentType: AssessmentType): string =>\n  assessmentType.toLowerCase().replace(/\\W+/g, '_');\n\n/** Converts an optional string\n *  parameter into an integer or null value.\n *\n *  @param {string} str - An optional string to be\n *    converted to an integer.\n */\nexport const stringParamToInt = (str?: string): number | null => {\n  if (str === undefined) {\n    return null;\n  }\n  const num = parseInt(str, 10);\n  return Number.isInteger(num) ? num : null;\n};\n","export const BEGIN_INTERRUPT_EXECUTION = 'BEGIN_INTERRUPT_EXECUTION';\nexport const END_INTERRUPT_EXECUTION = 'END_INTERRUPT_EXECUTION';\nexport const EVAL_INTERPRETER_ERROR = 'EVAL_INTERPRETER_ERROR';\nexport const EVAL_INTERPRETER_SUCCESS = 'EVAL_INTERPRETER_SUCCESS';\nexport const EVAL_TESTCASE_FAILURE = 'EVAL_TESTCASE_FAILURE';\nexport const EVAL_TESTCASE_SUCCESS = 'EVAL_TESTCASE_SUCCESS';\nexport const HANDLE_CONSOLE_LOG = 'HANDLE_CONSOLE_LOG';\nexport const BEGIN_DEBUG_PAUSE = 'BEGIN_DEBUG_PAUSE';\nexport const END_DEBUG_PAUSE = 'END_DEBUG_PAUSE';\nexport const DEBUG_RESUME = 'DEBUG_RESUME';\nexport const DEBUG_RESET = 'DEBUG_RESET';\nexport const HIGHLIGHT_LINE = 'HIGHLIGHT_LINE';\n","import { SourceError, Value } from 'c-slang/dist/types';\nimport { action } from 'typesafe-actions';\n\nimport { WorkspaceLocation } from '../../workspace/WorkspaceTypes';\nimport {\n  BEGIN_DEBUG_PAUSE,\n  BEGIN_INTERRUPT_EXECUTION,\n  DEBUG_RESET,\n  DEBUG_RESUME,\n  END_DEBUG_PAUSE,\n  END_INTERRUPT_EXECUTION,\n  EVAL_INTERPRETER_ERROR,\n  EVAL_INTERPRETER_SUCCESS,\n  EVAL_TESTCASE_FAILURE,\n  EVAL_TESTCASE_SUCCESS,\n  HANDLE_CONSOLE_LOG\n} from '../types/InterpreterTypes';\n\nexport const handleConsoleLog = (workspaceLocation: WorkspaceLocation, ...logString: string[]) =>\n  action(HANDLE_CONSOLE_LOG, { logString, workspaceLocation });\n\nexport const evalInterpreterSuccess = (value: Value, workspaceLocation: WorkspaceLocation) =>\n  action(EVAL_INTERPRETER_SUCCESS, { type: 'result', value, workspaceLocation });\n\nexport const evalTestcaseSuccess = (\n  value: Value,\n  workspaceLocation: WorkspaceLocation,\n  index: number\n) => action(EVAL_TESTCASE_SUCCESS, { type: 'result', value, workspaceLocation, index });\n\nexport const evalTestcaseFailure = (\n  value: Value,\n  workspaceLocation: WorkspaceLocation,\n  index: number\n) => action(EVAL_TESTCASE_FAILURE, { type: 'errors', value, workspaceLocation, index });\n\nexport const evalInterpreterError = (errors: SourceError[], workspaceLocation: WorkspaceLocation, stdout: string = '') =>\n  action(EVAL_INTERPRETER_ERROR, { type: 'errors', errors, workspaceLocation, stdout });\n\nexport const beginInterruptExecution = (workspaceLocation: WorkspaceLocation) =>\n  action(BEGIN_INTERRUPT_EXECUTION, { workspaceLocation });\n\nexport const endInterruptExecution = (workspaceLocation: WorkspaceLocation) =>\n  action(END_INTERRUPT_EXECUTION, { workspaceLocation });\n\nexport const beginDebuggerPause = (workspaceLocation: WorkspaceLocation) =>\n  action(BEGIN_DEBUG_PAUSE, { workspaceLocation });\n\nexport const endDebuggerPause = (workspaceLocation: WorkspaceLocation) =>\n  action(END_DEBUG_PAUSE, { workspaceLocation });\n\nexport const debuggerResume = (workspaceLocation: WorkspaceLocation) =>\n  action(DEBUG_RESUME, { workspaceLocation });\n\nexport const debuggerReset = (workspaceLocation: WorkspaceLocation) =>\n  action(DEBUG_RESET, { workspaceLocation });\n","import {\n  Button,\n  Classes,\n  Dialog,\n  IButtonProps,\n  IconName,\n  IDialogProps,\n  Intent\n} from '@blueprintjs/core';\nimport classNames from 'classnames';\nimport * as React from 'react';\n\nexport interface ConfirmDialogProps<T> {\n  icon?: IconName;\n  title?: string;\n  contents?: React.ReactNode;\n  choices: Array<{ key: T; label: string; intent?: Intent; props?: IButtonProps }>;\n  largeButtons?: boolean;\n  escapeResponse?: T;\n  onResponse: (response: T) => void;\n  isOpen?: boolean;\n  props?: Omit<IDialogProps, 'isOpen'>;\n}\n\nexport function ConfirmDialog<T>(\n  props: ConfirmDialogProps<T>\n): React.ReactElement<ConfirmDialogProps<T>> {\n  const buttons = props.choices.map((choice, i) => (\n    <Button\n      key={i}\n      onClick={() => props.onResponse && props.onResponse(choice.key)}\n      intent={choice.intent}\n      fill={props.largeButtons}\n      className={classNames(props.largeButtons && 'large-button')}\n      {...choice.props}\n    >\n      {choice.label}\n    </Button>\n  ));\n  const { escapeResponse } = props;\n  const escapeHandler =\n    typeof escapeResponse === 'undefined'\n      ? undefined\n      : () => props.onResponse && props.onResponse(escapeResponse);\n  return (\n    <Dialog\n      className={classNames(Classes.DARK, 'ConfirmDialog')}\n      title={props.title}\n      isCloseButtonShown={typeof props.title === 'undefined' ? undefined : false}\n      canEscapeKeyClose={!!escapeHandler}\n      onClose={escapeHandler}\n      isOpen={props.isOpen}\n      icon={props.icon}\n      {...props.props}\n    >\n      <div className={Classes.DIALOG_BODY}>{props.contents}</div>\n      <div className={Classes.DIALOG_FOOTER}>\n        {props.largeButtons && buttons}\n        {!props.largeButtons && <div className={Classes.DIALOG_FOOTER_ACTIONS}>{buttons}</div>}\n      </div>\n    </Dialog>\n  );\n}\n","import { InputGroup, Intent } from '@blueprintjs/core';\nimport * as React from 'react';\n\nimport { ConfirmDialog, ConfirmDialogProps } from './ConfirmDialog';\n\nexport interface PromptDialogProps<T>\n  extends Omit<ConfirmDialogProps<T>, 'onResponse' | 'choices'> {\n  defaultValue?: string;\n  enterResponse?: T;\n  onResponse: (buttonResponse: T, value: string) => void;\n  validationFunction?: (value: string) => boolean;\n  choices: Array<ConfirmDialogProps<T>['choices'][0] & { disableOnInvalid?: boolean }>;\n}\n\nexport function PromptDialog<T>(\n  props: PromptDialogProps<T>\n): React.ReactElement<PromptDialogProps<T>> {\n  const { enterResponse, validationFunction } = props;\n  const inputRef = React.useRef<HTMLInputElement>(null);\n  const [isValid, setIsValid] = React.useState(\n    !validationFunction || validationFunction(props.defaultValue || '')\n  );\n  React.useEffect(() => {\n    if (!inputRef.current) {\n      return;\n    }\n\n    setIsValid(!validationFunction || validationFunction(inputRef.current.value));\n  }, [validationFunction]);\n\n  const returnResponse = (buttonResponse: T) => {\n    if (\n      buttonResponse === props.escapeResponse ||\n      !validationFunction ||\n      validationFunction(inputRef.current!.value)\n    ) {\n      props.onResponse(buttonResponse, inputRef.current?.value || '');\n    }\n  };\n\n  const choices: typeof props.choices = props.choices.map(choice => ({\n    ...choice,\n    props: {\n      ...choice.props,\n      disabled: choice.disableOnInvalid && !isValid\n    }\n  }));\n  const handleEnter = enterResponse\n    ? (e: React.KeyboardEvent<HTMLInputElement>) => {\n        if (e.keyCode === 13) {\n          returnResponse(enterResponse);\n        }\n      }\n    : undefined;\n  const handleValidate = validationFunction\n    ? (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (validationFunction(e.target.value) !== isValid) {\n          setIsValid(!isValid);\n        }\n      }\n    : undefined;\n  return (\n    <ConfirmDialog\n      {...props}\n      onResponse={returnResponse}\n      choices={choices}\n      contents={\n        <>\n          {props.contents}\n          <InputGroup\n            autoFocus\n            defaultValue={props.defaultValue}\n            inputRef={inputRef}\n            onKeyDown={handleEnter}\n            onChange={handleValidate}\n            intent={isValid ? Intent.NONE : Intent.DANGER}\n          />\n        </>\n      }\n    />\n  );\n}\n","import { IconName, Intent } from '@blueprintjs/core';\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\n\nimport { ConfirmDialog, ConfirmDialogProps } from '../dialogs/ConfirmDialog';\nimport { PromptDialog, PromptDialogProps } from '../dialogs/PromptDialog';\n\n// The below is based off the Blueprint Toaster:\n// https://github.com/palantir/blueprint/blob/develop/packages/core/src/components/toast/toaster.tsx\n\ninterface DialogHelperState {\n  dialog: ReturnType<typeof React.createElement> | null;\n  dialogOnClose: (() => void) | null;\n}\n\nclass DialogHelper extends React.PureComponent<{}, DialogHelperState> {\n  public state: DialogHelperState = {\n    dialog: null,\n    dialogOnClose: null\n  };\n\n  public static create(): DialogHelper {\n    const containerElement = document.createElement('div');\n    document.body.appendChild(containerElement);\n    const dialogHelper = ReactDOM.render<{}>(<DialogHelper />, containerElement) as DialogHelper;\n    if (dialogHelper == null) {\n      throw new Error('Could not create DialogHelper - are you in a React lifecycle method?');\n    }\n    return dialogHelper;\n  }\n\n  public show(dialog: DialogHelperState['dialog'], onClose?: () => void) {\n    this.setState(() => ({ dialog, dialogOnClose: onClose || null }));\n  }\n\n  public close() {\n    if (this.state.dialogOnClose) {\n      this.state.dialogOnClose();\n    }\n    this.setState(() => ({ dialog: null, dialogOnClose: null }));\n  }\n\n  public render() {\n    return this.state.dialog;\n  }\n}\n\nconst singleton = DialogHelper.create();\n\nexport function showDialog(dialog: DialogHelperState['dialog'], dialogOnClose?: () => void) {\n  singleton.show(dialog, dialogOnClose);\n}\n\nexport function closeDialog() {\n  singleton.close();\n}\n\nexport function promisifyDialog<P, R>(\n  DialogComponent: React.ComponentType<P>,\n  propFn: (resolve: (response: R) => void) => P\n): Promise<R> {\n  return new Promise<R>((resolve, reject) => {\n    showDialog(<DialogComponent {...propFn(resolve)} />, reject);\n  }).finally(closeDialog);\n}\n\nexport function showConfirmDialog<T>(\n  props: Omit<ConfirmDialogProps<T>, 'onResponse'> &\n    Partial<Pick<ConfirmDialogProps<T>, 'onResponse'>>\n): Promise<T> {\n  return promisifyDialog<ConfirmDialogProps<T>, T>(ConfirmDialog, resolve => ({\n    ...props,\n    onResponse: resolve,\n    isOpen: true\n  }));\n}\n\nexport interface SimpleConfirmDialogProps {\n  icon?: IconName;\n  title?: string;\n  contents?: React.ReactNode;\n  positiveLabel?: string;\n  positiveIntent?: Intent;\n  negativeLabel?: string;\n  props?: Partial<ConfirmDialogProps<boolean>>;\n}\n\nexport function showSimpleConfirmDialog(props: SimpleConfirmDialogProps): Promise<boolean> {\n  return showConfirmDialog<boolean>({\n    title: props.title,\n    contents: props.contents,\n    choices: [\n      { key: false, label: props.negativeLabel || 'No' },\n      {\n        key: true,\n        label: props.positiveLabel || 'Yes',\n        intent: props.positiveIntent || Intent.SUCCESS,\n        props: { type: 'submit' }\n      }\n    ],\n    escapeResponse: false,\n    icon: props.icon,\n    ...props.props\n  });\n}\n\nexport interface SimpleErrorDialogProps {\n  title?: string;\n  contents?: React.ReactNode;\n  label?: string;\n  props?: Partial<ConfirmDialogProps<boolean>>;\n}\n\nexport function showSimpleErrorDialog(props: SimpleErrorDialogProps): Promise<boolean> {\n  return showConfirmDialog<boolean>({\n    title: props.title,\n    contents: props.contents,\n    choices: [\n      {\n        key: true,\n        label: props.label || 'OK',\n        intent: Intent.PRIMARY,\n        props: { type: 'submit' }\n      }\n    ],\n    escapeResponse: false,\n    icon: 'error',\n    ...props.props\n  });\n}\n\nexport function showSimplePromptDialog(props: {\n  title?: string;\n  contents?: React.ReactNode;\n  positiveLabel?: string;\n  negativeLabel?: string;\n  props?: Partial<PromptDialogProps<boolean>>;\n}) {\n  return promisifyDialog<PromptDialogProps<boolean>, { buttonResponse: boolean; value: string }>(\n    PromptDialog,\n    resolve => ({\n      title: props.title,\n      contents: props.contents,\n      choices: [\n        { key: false, label: props.negativeLabel || 'Cancel' },\n        {\n          key: true,\n          label: props.positiveLabel || 'Accept',\n          intent: Intent.SUCCESS,\n          disableOnInvalid: true\n        }\n      ],\n      escapeResponse: false,\n      enterResponse: true,\n      onResponse: (buttonResponse, value) => resolve({ buttonResponse, value }),\n      isOpen: true,\n      ...props.props\n    })\n  );\n}\n","/**\n * Defined for displaying an external library.\n * @see Library the definition of a Library at AssessmentTypes.ts in an assessment.\n */\nexport type External = {\n  key: number;\n  name: ExternalLibraryName;\n  symbols: string[];\n};\n\nexport enum ExternalLibraryName {\n  NONE = 'NONE',\n  SOUNDS = 'SOUNDS',\n  EV3 = 'EV3' // Remote execution device library\n}\n\nexport type ExternalLibrary = {\n  name: ExternalLibraryName;\n  symbols: string[];\n};\n\n/**\n * Defines which external libraries are available for usage, and what\n * external symbols (exposed functions) are under them.\n */\n\nconst libEntries: Array<[ExternalLibraryName, string[]]> = [\n  [ExternalLibraryName.NONE, []],\n  [ExternalLibraryName.SOUNDS, []]\n];\n\nexport const externalLibraries: Map<string, string[]> = new Map(libEntries);\n","import { Octokit } from '@octokit/rest';\nimport {\n  GetResponseDataTypeFromEndpointMethod,\n  GetResponseTypeFromEndpointMethod\n} from '@octokit/types';\n\nimport { actions } from '../../commons/utils/ActionsHelper';\nimport { showSimpleConfirmDialog } from '../../commons/utils/DialogHelper';\nimport { showSuccessMessage, showWarningMessage } from '../../commons/utils/NotificationsHelper';\nimport { store } from '../../pages/createStore';\n\n/**\n * Exchanges the Access Code with the back-end to receive an Auth-Token\n *\n * @param {string} backendLink The address where the back-end microservice is deployed\n * @param {string} messageBody The message body. Must be URL-encoded\n * @return {Promise<Response>} A promise for a HTML response with an 'auth_token' field\n */\nexport async function exchangeAccessCode(\n  backendLink: string,\n  messageBody: string\n): Promise<Response> {\n  return await fetch(backendLink, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'\n    },\n    body: messageBody\n  });\n}\n\n/**\n * Returns the Octokit instance saved in session state.\n *\n * This function allows for mocking Octokit behaviour in tests.\n */\nexport function getGitHubOctokitInstance(): any {\n  const octokitObject = store.getState().session.githubOctokitObject;\n  if (octokitObject === undefined) {\n    return undefined;\n  } else {\n    return octokitObject.octokit;\n  }\n}\n\nexport async function checkIfFileCanBeOpened(\n  octokit: Octokit,\n  repoOwner: string,\n  repoName: string,\n  filePath: string\n) {\n  if (octokit === undefined) {\n    showWarningMessage('Please log in and try again', 2000);\n    return false;\n  }\n\n  if (filePath === '') {\n    showWarningMessage('Please select a file!', 2000);\n    return false;\n  }\n\n  type GetContentData = GetResponseDataTypeFromEndpointMethod<typeof octokit.repos.getContent>;\n  let files: GetContentData;\n\n  try {\n    type GetContentResponse = GetResponseTypeFromEndpointMethod<typeof octokit.repos.getContent>;\n    const results: GetContentResponse = await octokit.repos.getContent({\n      owner: repoOwner,\n      repo: repoName,\n      path: filePath\n    });\n\n    files = results.data;\n  } catch (err) {\n    showWarningMessage('Connection denied or file does not exist.', 2000);\n    console.error(err);\n    return false;\n  }\n\n  if (Array.isArray(files)) {\n    showWarningMessage(\"Can't open folder as a file!\", 2000);\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Returns an object containing 2 properties: 'canBeSaved' and 'saveType'.\n * 'canBeSaved' is a boolean that represents whether we should proceed with the save.\n * If the file can be saved, then 'saveType' is either 'Create' or 'Overwrite'.\n *\n * @param octokit The Octokit instance for the authenticated user\n * @param repoOwner The owner of the repository where the file is to be saved\n * @param repoName The name of the repository\n * @param filePath The filepath where the file will be saved to\n */\nexport async function checkIfFileCanBeSavedAndGetSaveType(\n  octokit: Octokit,\n  repoOwner: string,\n  repoName: string,\n  filePath: string\n) {\n  let saveType = '';\n\n  if (filePath === '') {\n    showWarningMessage('No file name given.', 2000);\n    return { canBeSaved: false, saveType: saveType };\n  }\n\n  if (octokit === undefined) {\n    showWarningMessage('Please log in and try again', 2000);\n    return { canBeSaved: false, saveType: saveType };\n  }\n\n  let files;\n\n  try {\n    type GetContentResponse = GetResponseTypeFromEndpointMethod<typeof octokit.repos.getContent>;\n    const results: GetContentResponse = await octokit.repos.getContent({\n      owner: repoOwner,\n      repo: repoName,\n      path: filePath\n    });\n\n    files = results.data;\n    saveType = 'Overwrite';\n  } catch (err) {\n    // 404 status means that the file could not be found.\n    // In this case, the dialog should still continue as the user should be given\n    // the option of creating a new file on their remote repository.\n    if (err.status !== 404) {\n      showWarningMessage('Connection denied or file does not exist.', 2000);\n      console.error(err);\n      return { canBeSaved: false, saveType: saveType };\n    }\n    saveType = 'Create';\n  }\n\n  if (Array.isArray(files)) {\n    showWarningMessage(\"Can't save over a folder!\", 2000);\n    return { canBeSaved: false, saveType: saveType };\n  }\n\n  return { canBeSaved: true, saveType: saveType };\n}\n\nexport async function checkIfUserAgreesToOverwriteEditorData() {\n  return await showSimpleConfirmDialog({\n    contents: (\n      <div>\n        <p>Warning: opening this file will overwrite the text data in the editor.</p>\n        <p>Please click 'Confirm' to continue, or 'Cancel' to go back.</p>\n      </div>\n    ),\n    negativeLabel: 'Cancel',\n    positiveIntent: 'primary',\n    positiveLabel: 'Confirm'\n  });\n}\n\nexport async function checkIfUserAgreesToPerformOverwritingSave() {\n  return await showSimpleConfirmDialog({\n    contents: (\n      <div>\n        <p>Warning: You are saving over an existing file in the repository.</p>\n        <p>Please click 'Confirm' to continue, or 'Cancel' to go back.</p>\n      </div>\n    ),\n    negativeLabel: 'Cancel',\n    positiveIntent: 'primary',\n    positiveLabel: 'Confirm'\n  });\n}\n\nexport async function openFileInEditor(\n  octokit: Octokit,\n  repoOwner: string,\n  repoName: string,\n  filePath: string\n) {\n  if (octokit === undefined) return;\n\n  type GetContentResponse = GetResponseTypeFromEndpointMethod<typeof octokit.repos.getContent>;\n  const results: GetContentResponse = await octokit.repos.getContent({\n    owner: repoOwner,\n    repo: repoName,\n    path: filePath\n  });\n\n  const content = (results.data as any).content;\n\n  if (content) {\n    const newEditorValue = Buffer.from(content, 'base64').toString();\n    store.dispatch(actions.updateEditorValue(newEditorValue, 'playground'));\n    store.dispatch(actions.playgroundUpdateGitHubSaveInfo(repoName, filePath, new Date()));\n    showSuccessMessage('Successfully loaded file!', 1000);\n  }\n}\n\nexport async function performOverwritingSave(\n  octokit: Octokit,\n  repoOwner: string,\n  repoName: string,\n  filePath: string,\n  githubName: string | null,\n  githubEmail: string | null,\n  commitMessage: string,\n  content: string\n) {\n  if (octokit === undefined) return;\n\n  githubEmail = githubEmail || 'No public email provided';\n  githubName = githubName || 'Source Academy User';\n  commitMessage = commitMessage || 'Changes made from Source Academy';\n  content = content || '';\n\n  const contentEncoded = Buffer.from(content, 'utf8').toString('base64');\n\n  try {\n    type GetContentResponse = GetResponseTypeFromEndpointMethod<typeof octokit.repos.getContent>;\n    const results: GetContentResponse = await octokit.repos.getContent({\n      owner: repoOwner,\n      repo: repoName,\n      path: filePath\n    });\n\n    type GetContentData = GetResponseDataTypeFromEndpointMethod<typeof octokit.repos.getContent>;\n    const files: GetContentData = results.data;\n\n    // Cannot save over folder\n    if (Array.isArray(files)) {\n      return;\n    }\n\n    const sha = files.sha;\n\n    await octokit.repos.createOrUpdateFileContents({\n      owner: repoOwner,\n      repo: repoName,\n      path: filePath,\n      message: commitMessage,\n      content: contentEncoded,\n      sha: sha,\n      committer: { name: githubName, email: githubEmail },\n      author: { name: githubName, email: githubEmail }\n    });\n    store.dispatch(actions.playgroundUpdateGitHubSaveInfo(repoName, filePath, new Date()));\n    showSuccessMessage('Successfully saved file!', 1000);\n  } catch (err) {\n    console.error(err);\n    showWarningMessage('Something went wrong when trying to save the file.', 1000);\n  }\n}\n\nexport async function performCreatingSave(\n  octokit: Octokit,\n  repoOwner: string,\n  repoName: string,\n  filePath: string,\n  githubName: string | null,\n  githubEmail: string | null,\n  commitMessage: string,\n  content: string\n) {\n  if (octokit === undefined) return;\n\n  githubEmail = githubEmail || 'No public email provided';\n  githubName = githubName || 'Source Academy User';\n  commitMessage = commitMessage || 'Changes made from Source Academy';\n  content = content || '';\n\n  const contentEncoded = Buffer.from(content, 'utf8').toString('base64');\n\n  try {\n    await octokit.repos.createOrUpdateFileContents({\n      owner: repoOwner,\n      repo: repoName,\n      path: filePath,\n      message: commitMessage,\n      content: contentEncoded,\n      committer: { name: githubName, email: githubEmail },\n      author: { name: githubName, email: githubEmail }\n    });\n    store.dispatch(actions.playgroundUpdateGitHubSaveInfo(repoName, filePath, new Date()));\n    showSuccessMessage('Successfully created file!', 1000);\n  } catch (err) {\n    console.error(err);\n    showWarningMessage('Something went wrong when trying to save the file.', 1000);\n  }\n}\n\nexport async function performFolderDeletion(\n  octokit: Octokit,\n  repoOwner: string,\n  repoName: string,\n  filePath: string,\n  githubName: string | null,\n  githubEmail: string | null,\n  commitMessage: string\n) {\n  if (octokit === undefined) return;\n\n  githubEmail = githubEmail || 'No public email provided';\n  githubName = githubName || 'Source Academy User';\n  commitMessage = commitMessage || 'Changes made from Source Academy';\n\n  try {\n    const results = await octokit.repos.getContent({\n      owner: repoOwner,\n      repo: repoName,\n      path: filePath\n    });\n\n    const files = results.data;\n\n    // This function must apply deletion to an entire folder\n    if (!Array.isArray(files)) {\n      showWarningMessage('Something went wrong when trying to delete the folder.', 1000);\n      return;\n    }\n\n    for (let i = 0; i < files.length; i++) {\n      const file = files[i];\n\n      await octokit.repos.deleteFile({\n        owner: repoOwner,\n        repo: repoName,\n        path: file.path,\n        message: commitMessage,\n        sha: file.sha\n      });\n    }\n\n    showSuccessMessage('Successfully deleted folder!', 1000);\n  } catch (err) {\n    console.error(err);\n    showWarningMessage('Something went wrong when trying to delete the folder.', 1000);\n  }\n}\n","import moment from 'moment';\n\nconst now = new Date();\n\nexport const isExpired = (deadline?: Date) => deadline !== undefined && deadline <= now;\n\nexport const isReleased = (release?: Date) => release === undefined || release <= now;\n\nexport const isWithinTimeRange = (fromTime?: Date, toTime?: Date) => {\n  // if bounds not specified, return true\n  if (fromTime === undefined && toTime === undefined) {\n    return true;\n  }\n\n  // express times as numbers\n  const now = new Date();\n  const currentTime = now.getHours() * 100 + now.getMinutes();\n  const leftBound =\n    fromTime === undefined ? undefined : fromTime.getHours() * 100 + fromTime.getMinutes();\n  const rightBound =\n    toTime === undefined ? undefined : toTime.getHours() * 100 + toTime.getMinutes();\n\n  if (leftBound === undefined) {\n    return currentTime <= rightBound!;\n  } else if (rightBound === undefined) {\n    return currentTime >= leftBound!;\n  } else if (leftBound >= rightBound) {\n    // happens when, for example, leftBound = 2300, rightBound = 0100\n    return currentTime <= rightBound || currentTime >= leftBound;\n  } else {\n    return currentTime <= rightBound && currentTime >= leftBound;\n  }\n};\n\nexport const timeFromExpired = (deadline?: Date) =>\n  deadline === undefined ? 0 : deadline.getTime() - now.getTime();\n\nexport const prettifyDate = (deadline?: Date) => {\n  if (deadline === undefined) return '';\n\n  return moment(deadline).format('D MMMM YYYY HH:mm');\n};\n\nexport const prettifyTime = (time?: Date) => {\n  if (time === undefined) return '';\n  return moment(time).format('HH:mm');\n};\n\n// Converts Date to deadline countdown\nexport const prettifyDeadline = (deadline?: Date) => {\n  if (deadline === undefined) {\n    return 'Unlimited';\n  } else if (isExpired(deadline)) {\n    return 'Expired';\n  }\n\n  const now = moment();\n\n  const weeksAway = Math.ceil(moment(deadline).diff(now, 'weeks', true));\n  const daysAway = Math.ceil(moment(deadline).diff(now, 'days', true));\n  const hoursAway = Math.ceil(moment(deadline).diff(now, 'hours', true));\n\n  let prettifiedDeadline = '';\n  if (weeksAway > 1) {\n    prettifiedDeadline = weeksAway + ' Weeks';\n  } else if (daysAway > 1) {\n    prettifiedDeadline = daysAway + ' Days';\n  } else if (hoursAway > 1) {\n    prettifiedDeadline = hoursAway + ' Hours';\n  } else {\n    prettifiedDeadline = '1 Hour';\n  }\n\n  return prettifiedDeadline;\n};\n","import { action } from 'typesafe-actions';\n\nimport {\n  PERSISTENCE_INITIALISE,\n  PERSISTENCE_OPEN_PICKER,\n  PERSISTENCE_SAVE_FILE,\n  PERSISTENCE_SAVE_FILE_AS,\n  PersistenceFile\n} from './PersistenceTypes';\n\nexport const persistenceOpenPicker = () => action(PERSISTENCE_OPEN_PICKER);\n\nexport const persistenceSaveFile = (file: PersistenceFile) => action(PERSISTENCE_SAVE_FILE, file);\n\nexport const persistenceSaveFileAs = () => action(PERSISTENCE_SAVE_FILE_AS);\n\nexport const persistenceInitialise = () => action(PERSISTENCE_INITIALISE);\n","import { action } from 'typesafe-actions';\n\nimport { WorkspaceLocation } from '../../commons/workspace/WorkspaceTypes';\nimport {\n  Device,\n  DeviceSession,\n  REMOTE_EXEC_CONNECT,\n  REMOTE_EXEC_DISCONNECT,\n  REMOTE_EXEC_FETCH_DEVICES,\n  REMOTE_EXEC_REPL_INPUT,\n  REMOTE_EXEC_RUN,\n  REMOTE_EXEC_UPDATE_DEVICES,\n  REMOTE_EXEC_UPDATE_SESSION\n} from './RemoteExecutionTypes';\n\nexport const remoteExecFetchDevices = () => action(REMOTE_EXEC_FETCH_DEVICES);\n\nexport const remoteExecUpdateDevices = (devices: Device[]) =>\n  action(REMOTE_EXEC_UPDATE_DEVICES, devices);\n\nexport const remoteExecUpdateSession = (session?: DeviceSession) =>\n  action(REMOTE_EXEC_UPDATE_SESSION, session);\n\nexport const remoteExecConnect = (workspace: WorkspaceLocation, device: Device) =>\n  action(REMOTE_EXEC_CONNECT, { workspace, device });\n\nexport const remoteExecDisconnect = () => action(REMOTE_EXEC_DISCONNECT);\n\nexport const remoteExecRun = (program: string) => action(REMOTE_EXEC_RUN, program);\n\nexport const remoteExecReplInput = (input: string) => action(REMOTE_EXEC_REPL_INPUT, input);\n","import { ActionType } from 'typesafe-actions';\n\nimport * as CommonsActions from '../../commons/application/actions/CommonsActions';\nimport * as InterpreterActions from '../../commons/application/actions/InterpreterActions';\nimport * as SessionActions from '../../commons/application/actions/SessionActions';\nimport * as CollabEditingActions from '../../commons/collabEditing/CollabEditingActions';\nimport * as WorkspaceActions from '../../commons/workspace/WorkspaceActions';\nimport * as AcademyActions from '../../features/academy/AcademyActions';\nimport * as AchievementActions from '../../features/achievement/AchievementActions';\nimport * as DashboardActions from '../../features/dashboard/DashboardActions';\nimport * as GroundControlActions from '../../features/groundControl/GroundControlActions';\nimport * as PersistenceActions from '../../features/persistence/PersistenceActions';\nimport * as PlaygroundActions from '../../features/playground/PlaygroundActions';\nimport * as RemoteExecutionActions from '../../features/remoteExecution/RemoteExecutionActions';\nimport * as SourcecastActions from '../../features/sourceRecorder/sourcecast/SourcecastActions';\nimport * as SourceRecorderActions from '../../features/sourceRecorder/SourceRecorderActions';\nimport * as SourcereelActions from '../../features/sourceRecorder/sourcereel/SourcereelActions';\n\nexport const actions = {\n  ...AchievementActions,\n  ...CommonsActions,\n  ...CollabEditingActions,\n  ...DashboardActions,\n  ...InterpreterActions,\n  ...PlaygroundActions,\n  ...SessionActions,\n  ...SourcecastActions,\n  ...SourceRecorderActions,\n  ...SourcereelActions,\n  ...WorkspaceActions,\n  ...GroundControlActions,\n  ...AcademyActions,\n  ...PersistenceActions,\n  ...RemoteExecutionActions\n};\n\nexport type SourceActionType = ActionType<typeof actions>;\n","import { WorkspaceState } from '../../../commons/workspace/WorkspaceTypes';\nimport { PlaybackData, RecordingStatus } from '../SourceRecorderTypes';\n\nexport const DELETE_SOURCECAST_ENTRY = 'DELETE_SOURCECAST_ENTRY';\nexport const RECORD_INIT = 'RECORD_INIT';\nexport const RECORD_INPUT = 'RECORD_INPUT';\nexport const RESET_INPUTS = 'RESET_INPUTS';\nexport const TIMER_PAUSE = 'TIMER_PAUSE';\nexport const TIMER_RESET = 'TIMER_RESET';\nexport const TIMER_RESUME = 'TIMER_RESUME';\nexport const TIMER_START = 'TIMER_START';\nexport const TIMER_STOP = 'TIMER_STOP';\n\ntype SourcereelWorkspaceAttr = {\n  readonly playbackData: PlaybackData;\n  readonly recordingStatus: RecordingStatus;\n  readonly timeElapsedBeforePause: number;\n  readonly timeResumed: number;\n};\nexport type SourcereelWorkspaceState = SourcereelWorkspaceAttr & WorkspaceState;\n","import { Reducer } from 'redux';\n\nimport { defaultAcademy } from '../../commons/application/ApplicationTypes';\nimport { LOG_OUT } from '../../commons/application/types/CommonsTypes';\nimport { SourceActionType } from '../../commons/utils/ActionsHelper';\nimport { AcademyState, SAVE_CANVAS } from './AcademyTypes';\n\nexport const AcademyReducer: Reducer<AcademyState> = (\n  state = defaultAcademy,\n  action: SourceActionType\n) => {\n  switch (action.type) {\n    case LOG_OUT:\n      return defaultAcademy;\n    case SAVE_CANVAS:\n      return {\n        ...state,\n        gameCanvas: action.payload\n      };\n    default:\n      return state;\n  }\n};\n","import { Reducer } from 'redux';\n\nimport { defaultAchievement } from '../../commons/application/ApplicationTypes';\nimport { SourceActionType } from '../../commons/utils/ActionsHelper';\nimport {\n  AchievementState,\n  SAVE_ACHIEVEMENTS,\n  SAVE_GOALS,\n  SAVE_USER_ASSESSMENT_OVERVIEWS,\n  SAVE_USERS\n} from './AchievementTypes';\n\nexport const AchievementReducer: Reducer<AchievementState> = (\n  state = defaultAchievement,\n  action: SourceActionType\n) => {\n  switch (action.type) {\n    case SAVE_ACHIEVEMENTS:\n      return {\n        ...state,\n        achievements: action.payload\n      };\n    case SAVE_GOALS:\n      return {\n        ...state,\n        goals: action.payload\n      };\n    case SAVE_USERS:\n      return {\n        ...state,\n        users: action.payload\n      };\n    case SAVE_USER_ASSESSMENT_OVERVIEWS:\n      return {\n        ...state,\n        assessmentOverviews: action.payload\n      };\n    default:\n      return state;\n  }\n};\n","import { Reducer } from 'redux';\n\nimport { defaultDashboard } from '../../commons/application/ApplicationTypes';\nimport { SourceActionType } from '../../commons/utils/ActionsHelper';\nimport { DashboardState, UPDATE_GROUP_GRADING_SUMMARY } from './DashboardTypes';\n\nexport const DashboardReducer: Reducer<DashboardState> = (\n  state = defaultDashboard,\n  action: SourceActionType\n) => {\n  switch (action.type) {\n    case UPDATE_GROUP_GRADING_SUMMARY:\n      return {\n        ...state,\n        gradingSummary: action.payload\n      };\n    default:\n      return state;\n  }\n};\n","import { Reducer } from 'redux';\n\nimport { defaultPlayground } from '../../commons/application/ApplicationTypes';\nimport { SourceActionType } from '../../commons/utils/ActionsHelper';\nimport {\n  CHANGE_QUERY_STRING,\n  PLAYGROUND_UPDATE_GITHUB_SAVE_INFO,\n  PLAYGROUND_UPDATE_PERSISTENCE_FILE,\n  PlaygroundState,\n  UPDATE_SHORT_URL\n} from './PlaygroundTypes';\n\nexport const PlaygroundReducer: Reducer<PlaygroundState> = (\n  state = defaultPlayground,\n  action: SourceActionType\n) => {\n  switch (action.type) {\n    case CHANGE_QUERY_STRING:\n      return {\n        ...state,\n        queryString: action.payload\n      };\n    case UPDATE_SHORT_URL:\n      return {\n        ...state,\n        shortURL: action.payload\n      };\n    case PLAYGROUND_UPDATE_GITHUB_SAVE_INFO:\n      return {\n        ...state,\n        githubSaveInfo: action.payload\n      };\n    case PLAYGROUND_UPDATE_PERSISTENCE_FILE:\n      return {\n        ...state,\n        persistenceFile: action.payload\n      };\n    default:\n      return state;\n  }\n};\n","import { SourceActionType } from '../../../commons/utils/ActionsHelper';\nimport {\n  SAVE_SOURCECAST_DATA,\n  SET_CODE_DELTAS_TO_APPLY,\n  SET_CURRENT_PLAYER_TIME,\n  SET_INPUT_TO_APPLY,\n  SET_SOURCECAST_DATA,\n  SET_SOURCECAST_PLAYBACK_DURATION,\n  SET_SOURCECAST_PLAYBACK_STATUS\n} from '../SourceRecorderTypes';\nimport { SourcecastWorkspaceState, UPDATE_SOURCECAST_INDEX } from './SourcecastTypes';\n\nexport const SourcecastReducer = (\n  state: SourcecastWorkspaceState,\n  action: SourceActionType\n): SourcecastWorkspaceState => {\n  switch (action.type) {\n    case SAVE_SOURCECAST_DATA:\n      return {\n        ...state,\n        title: action.payload.title,\n        description: action.payload.description,\n        uid: action.payload.uid,\n        audioUrl: action.payload.audioUrl,\n        playbackData: action.payload.playbackData\n      };\n    case SET_CURRENT_PLAYER_TIME:\n      return {\n        ...state,\n        currentPlayerTime: action.payload.playerTime\n      };\n    case SET_CODE_DELTAS_TO_APPLY:\n      return {\n        ...state,\n        codeDeltasToApply: action.payload.deltas\n      };\n    case SET_INPUT_TO_APPLY:\n      return {\n        ...state,\n        inputToApply: action.payload.inputToApply\n      };\n    case SET_SOURCECAST_DATA:\n      return {\n        ...state,\n        title: action.payload.title,\n        description: action.payload.description,\n        uid: action.payload.uid,\n        audioUrl: action.payload.audioUrl,\n        playbackData: action.payload.playbackData\n      };\n    case SET_SOURCECAST_PLAYBACK_DURATION:\n      return {\n        ...state,\n        playbackDuration: action.payload.duration\n      };\n    case SET_SOURCECAST_PLAYBACK_STATUS:\n      return {\n        ...state,\n        playbackStatus: action.payload.playbackStatus\n      };\n    case UPDATE_SOURCECAST_INDEX:\n      return {\n        ...state,\n        sourcecastIndex: action.payload.index\n      };\n    default:\n      return state;\n  }\n};\n","import { SourceActionType } from '../../../commons/utils/ActionsHelper';\nimport { RecordingStatus } from '../SourceRecorderTypes';\nimport {\n  RECORD_INIT,\n  RECORD_INPUT,\n  RESET_INPUTS,\n  SourcereelWorkspaceState,\n  TIMER_PAUSE,\n  TIMER_RESET,\n  TIMER_RESUME,\n  TIMER_START,\n  TIMER_STOP\n} from './SourcereelTypes';\n\nexport const SourcereelReducer = (state: SourcereelWorkspaceState, action: SourceActionType) => {\n  switch (action.type) {\n    case RECORD_INIT:\n      return {\n        ...state,\n        playbackData: {\n          init: action.payload.initData,\n          inputs: []\n        }\n      };\n    case RECORD_INPUT:\n      return {\n        ...state,\n        playbackData: {\n          ...state.playbackData,\n          inputs: [...state.playbackData.inputs, action.payload.input]\n        }\n      };\n    case RESET_INPUTS:\n      return {\n        ...state,\n        playbackData: {\n          ...state.playbackData,\n          inputs: action.payload.inputs\n        }\n      };\n    case TIMER_PAUSE:\n      return {\n        ...state,\n        recordingStatus: RecordingStatus.paused,\n        timeElapsedBeforePause:\n          state.timeElapsedBeforePause + action.payload.timeNow - state.timeResumed\n      };\n    case TIMER_RESET:\n      return {\n        ...state,\n        recordingStatus: RecordingStatus.notStarted,\n        timeElapsedBeforePause: 0,\n        timeResumed: 0\n      };\n    case TIMER_RESUME:\n      return {\n        ...state,\n        recordingStatus: RecordingStatus.recording,\n        timeElapsedBeforePause:\n          action.payload.timeBefore >= 0 ? action.payload.timeBefore : state.timeElapsedBeforePause,\n        timeResumed: action.payload.timeNow\n      };\n    case TIMER_START:\n      return {\n        ...state,\n        recordingStatus: RecordingStatus.recording,\n        timeElapsedBeforePause: 0,\n        timeResumed: action.payload.timeNow\n      };\n    case TIMER_STOP:\n      return {\n        ...state,\n        recordingStatus: RecordingStatus.finished,\n        timeElapsedBeforePause: 0,\n        timeResumed: 0\n      };\n    default:\n      return state;\n  }\n};\n","import { stringify } from 'c-slang/dist/utils/stringify';\nimport { Reducer } from 'redux';\n\nimport { SourcecastReducer } from '../../features/sourceRecorder/sourcecast/SourcecastReducer';\nimport { SET_IS_EDITOR_READONLY } from '../../features/sourceRecorder/sourcecast/SourcecastTypes';\nimport { SourcereelReducer } from '../../features/sourceRecorder/sourcereel/SourcereelReducer';\nimport {\n  CodeOutput,\n  createDefaultWorkspace,\n  defaultWorkspaceManager,\n  ErrorOutput,\n  InterpreterOutput,\n  ResultOutput\n} from '../application/ApplicationTypes';\nimport { LOG_OUT } from '../application/types/CommonsTypes';\nimport {\n  DEBUG_RESET,\n  DEBUG_RESUME,\n  END_DEBUG_PAUSE,\n  END_INTERRUPT_EXECUTION,\n  EVAL_INTERPRETER_ERROR,\n  EVAL_INTERPRETER_SUCCESS,\n  EVAL_TESTCASE_FAILURE,\n  EVAL_TESTCASE_SUCCESS,\n  HANDLE_CONSOLE_LOG,\n  HIGHLIGHT_LINE\n} from '../application/types/InterpreterTypes';\nimport { Testcase } from '../assessment/AssessmentTypes';\nimport { SET_EDITOR_SESSION_ID, SET_SHAREDB_CONNECTED } from '../collabEditing/CollabEditingTypes';\nimport { NOTIFY_PROGRAM_EVALUATED } from '../sideContent/SideContentTypes';\nimport { SourceActionType } from '../utils/ActionsHelper';\nimport Constants from '../utils/Constants';\nimport { createContext } from '../utils/JsSlangHelper';\nimport {\n  BROWSE_REPL_HISTORY_DOWN,\n  BROWSE_REPL_HISTORY_UP,\n  CHANGE_EXEC_TIME,\n  CHANGE_EXTERNAL_LIBRARY,\n  CHANGE_SIDE_CONTENT_HEIGHT,\n  CHANGE_STEP_LIMIT,\n  CLEAR_REPL_INPUT,\n  CLEAR_REPL_OUTPUT,\n  CLEAR_REPL_OUTPUT_LAST,\n  END_CLEAR_CONTEXT,\n  EVAL_EDITOR,\n  EVAL_REPL,\n  MOVE_CURSOR,\n  RESET_TESTCASE,\n  RESET_WORKSPACE,\n  SEND_REPL_INPUT_TO_OUTPUT,\n  TOGGLE_EDITOR_AUTORUN,\n  TOGGLE_USING_SUBST,\n  UPDATE_ACTIVE_EDITOR_TAB,\n  UPDATE_CURRENT_ASSESSMENT_ID,\n  UPDATE_CURRENT_SUBMISSION_ID,\n  UPDATE_EDITOR_BREAKPOINTS,\n  UPDATE_EDITOR_VALUE,\n  UPDATE_HAS_UNSAVED_CHANGES,\n  UPDATE_REPL_VALUE,\n  UPDATE_SUBLANGUAGE,\n  UPDATE_WORKSPACE,\n  WorkspaceLocation,\n  WorkspaceManagerState\n} from './WorkspaceTypes';\n\n/**\n * Takes in a IWorkspaceManagerState and maps it to a new state. The\n * pre-conditions are that\n *   - There exists an IWorkspaceState in the IWorkspaceManagerState of the key\n *     `location`.\n *   - `location` is defined (and exists) as a property 'workspaceLocation' in\n *     the action's payload.\n */\nexport const WorkspaceReducer: Reducer<WorkspaceManagerState> = (\n  state = defaultWorkspaceManager,\n  action: SourceActionType\n) => {\n  const workspaceLocation: WorkspaceLocation = (action as any).payload\n    ? (action as any).payload.workspaceLocation\n    : 'assessment';\n  let newOutput: InterpreterOutput[];\n  let lastOutput: InterpreterOutput;\n\n  switch (workspaceLocation) {\n    case 'sourcecast':\n      const sourcecastState = SourcecastReducer(state.sourcecast, action);\n      if (sourcecastState === state.sourcecast) {\n        break;\n      }\n      return {\n        ...state,\n        sourcecast: sourcecastState\n      };\n    case 'sourcereel':\n      const sourcereelState = SourcereelReducer(state.sourcereel, action);\n      if (sourcereelState === state.sourcereel) {\n        break;\n      }\n      return {\n        ...state,\n        sourcereel: sourcereelState\n      };\n    default:\n      break;\n  }\n\n  switch (action.type) {\n    case BROWSE_REPL_HISTORY_DOWN:\n      if (state[workspaceLocation].replHistory.browseIndex === null) {\n        // Not yet started browsing history, nothing to do\n        return state;\n      } else if (state[workspaceLocation].replHistory.browseIndex !== 0) {\n        // Browsing history, and still have earlier records to show\n        const newIndex = state[workspaceLocation].replHistory.browseIndex! - 1;\n        const newReplValue = state[workspaceLocation].replHistory.records[newIndex];\n        return {\n          ...state,\n          [workspaceLocation]: {\n            ...state[workspaceLocation],\n            replValue: newReplValue,\n            replHistory: {\n              ...state[workspaceLocation].replHistory,\n              browseIndex: newIndex\n            }\n          }\n        };\n      } else {\n        // Browsing history, no earlier records to show; return replValue to\n        // the last value when user started browsing\n        const newIndex = null;\n        const newReplValue = state[workspaceLocation].replHistory.originalValue;\n        const newRecords = state[workspaceLocation].replHistory.records.slice();\n        return {\n          ...state,\n          [workspaceLocation]: {\n            ...state[workspaceLocation],\n            replValue: newReplValue,\n            replHistory: {\n              browseIndex: newIndex,\n              records: newRecords,\n              originalValue: ''\n            }\n          }\n        };\n      }\n    case BROWSE_REPL_HISTORY_UP:\n      const lastRecords = state[workspaceLocation].replHistory.records;\n      const lastIndex = state[workspaceLocation].replHistory.browseIndex;\n      if (\n        lastRecords.length === 0 ||\n        (lastIndex !== null && lastRecords[lastIndex + 1] === undefined)\n      ) {\n        // There is no more later history to show\n        return state;\n      } else if (lastIndex === null) {\n        // Not yet started browsing, initialise the index & array\n        const newIndex = 0;\n        const newRecords = lastRecords.slice();\n        const originalValue = state[workspaceLocation].replValue;\n        const newReplValue = newRecords[newIndex];\n        return {\n          ...state,\n          [workspaceLocation]: {\n            ...state[workspaceLocation],\n            replValue: newReplValue,\n            replHistory: {\n              ...state[workspaceLocation].replHistory,\n              browseIndex: newIndex,\n              records: newRecords,\n              originalValue\n            }\n          }\n        };\n      } else {\n        // Browsing history, and still have later history to show\n        const newIndex = lastIndex + 1;\n        const newReplValue = lastRecords[newIndex];\n        return {\n          ...state,\n          [workspaceLocation]: {\n            ...state[workspaceLocation],\n            replValue: newReplValue,\n            replHistory: {\n              ...state[workspaceLocation].replHistory,\n              browseIndex: newIndex\n            }\n          }\n        };\n      }\n    case CHANGE_EXEC_TIME:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          execTime: action.payload.execTime\n        }\n      };\n    case CHANGE_SIDE_CONTENT_HEIGHT:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          sideContentHeight: action.payload.height\n        }\n      };\n    case CHANGE_STEP_LIMIT:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          stepLimit: action.payload.stepLimit\n        }\n      };\n    case CLEAR_REPL_INPUT:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          replValue: ''\n        }\n      };\n    case CLEAR_REPL_OUTPUT_LAST:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          output: state[workspaceLocation].output.slice(0, -1)\n        }\n      };\n    case CLEAR_REPL_OUTPUT:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          output: []\n        }\n      };\n    case END_CLEAR_CONTEXT:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          context: createContext<WorkspaceLocation>(\n            action.payload.library.external.symbols,\n            workspaceLocation,\n            action.payload.library.variant\n          ),\n          globals: action.payload.library.globals,\n          externalLibrary: action.payload.library.external.name\n        }\n      };\n    case SEND_REPL_INPUT_TO_OUTPUT:\n      // CodeOutput properties exist in parallel with workspaceLocation\n      newOutput = state[workspaceLocation].output.concat(action.payload as CodeOutput);\n      let newReplHistoryRecords: string[];\n      if (action.payload.value !== '') {\n        newReplHistoryRecords = [action.payload.value].concat(\n          state[workspaceLocation].replHistory.records\n        );\n      } else {\n        newReplHistoryRecords = state[workspaceLocation].replHistory.records;\n      }\n      if (newReplHistoryRecords.length > Constants.maxBrowseIndex) {\n        newReplHistoryRecords.pop();\n      }\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          output: newOutput,\n          replHistory: {\n            ...state[workspaceLocation].replHistory,\n            records: newReplHistoryRecords\n          }\n        }\n      };\n    case CHANGE_EXTERNAL_LIBRARY:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          externalLibrary: action.payload.newExternal\n        }\n      };\n    case HANDLE_CONSOLE_LOG:\n      /* Possible cases:\n       * (1) state[workspaceLocation].output === [], i.e. state[workspaceLocation].output[-1] === undefined\n       * (2) state[workspaceLocation].output[-1] is not RunningOutput\n       * (3) state[workspaceLocation].output[-1] is RunningOutput */\n      lastOutput = state[workspaceLocation].output[state[workspaceLocation].output.length - 1];\n      if (lastOutput === undefined || lastOutput.type !== 'running') {\n        // New block of output.\n        newOutput = state[workspaceLocation].output.concat({\n          type: 'running',\n          consoleLogs: [...action.payload.logString]\n        });\n      } else {\n        const updatedLastOutput = {\n          type: lastOutput.type,\n          consoleLogs: lastOutput.consoleLogs.concat(action.payload.logString)\n        };\n        newOutput = state[workspaceLocation].output.slice(0, -1);\n        newOutput.push(updatedLastOutput);\n      }\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          output: newOutput\n        }\n      };\n    case LOG_OUT:\n      // Preserve the playground workspace even after log out\n      const playgroundWorkspace = state.playground;\n      return {\n        ...defaultWorkspaceManager,\n        playground: playgroundWorkspace\n      };\n    case EVAL_EDITOR:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          isRunning: true,\n          isDebugging: false\n        }\n      };\n    case EVAL_REPL:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          isRunning: true\n        }\n      };\n    case EVAL_INTERPRETER_SUCCESS:\n      const execType = state[workspaceLocation].context.executionMethod;\n      const newOutputEntry: Partial<ResultOutput> = {\n        type: action.payload.type as 'result' | undefined,\n        value: execType === 'interpreter' ? action.payload.value : stringify(action.payload.value)\n      };\n\n      lastOutput = state[workspaceLocation].output.slice(-1)[0];\n      if (lastOutput !== undefined && lastOutput.type === 'running') {\n        newOutput = state[workspaceLocation].output.slice(0, -1).concat({\n          consoleLogs: lastOutput.consoleLogs,\n          ...newOutputEntry\n        } as ResultOutput);\n      } else {\n        newOutput = state[workspaceLocation].output.concat({\n          consoleLogs: [],\n          ...newOutputEntry\n        } as ResultOutput);\n      }\n\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          output: newOutput,\n          isRunning: false\n        }\n      };\n    case EVAL_TESTCASE_SUCCESS:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          editorTestcases: state[workspaceLocation].editorTestcases.map(\n            (testcase: Testcase, i: any) => {\n              if (i === action.payload.index) {\n                return {\n                  ...testcase,\n                  result: action.payload.value,\n                  errors: undefined\n                };\n              } else {\n                return testcase;\n              }\n            }\n          ),\n          isRunning: false\n        }\n      };\n    case EVAL_TESTCASE_FAILURE:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          editorTestcases: state[workspaceLocation].editorTestcases.map(\n            (testcase: Testcase, i: number) => {\n              if (i === action.payload.index) {\n                return {\n                  ...testcase,\n                  result: undefined,\n                  errors: action.payload.value\n                };\n              }\n              return testcase;\n            }\n          )\n        }\n      };\n    case EVAL_INTERPRETER_ERROR:\n      lastOutput = state[workspaceLocation].output.slice(-1)[0];\n      if (lastOutput !== undefined && lastOutput.type === 'running') {\n        newOutput = state[workspaceLocation].output.slice(0, -1).concat({\n          type: action.payload.type,\n          errors: action.payload.errors,\n          consoleLogs: action.payload.stdout ? [action.payload.stdout] : []\n        } as ErrorOutput);\n      } else {\n        newOutput = state[workspaceLocation].output.concat({\n          type: action.payload.type,\n          errors: action.payload.errors,\n          consoleLogs: []\n        } as ErrorOutput);\n      }\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          output: newOutput,\n          isRunning: false,\n          isDebugging: false\n        }\n      };\n    /**\n     * Called to signal the end of an interruption,\n     * i.e called after the interpreter is told to stop interruption,\n     * to cause UI changes.\n     */\n    case END_INTERRUPT_EXECUTION:\n      /**\n       * Set the isRunning property of the\n       * context to false, to ensure a re-render.\n       * Also in case the async c-slang interrupt()\n       * function does not finish interrupting before\n       * this action is called.\n       */\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          isRunning: false,\n          isDebugging: false\n        }\n      };\n    case END_DEBUG_PAUSE:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          isRunning: false,\n          isDebugging: true\n        }\n      };\n    case DEBUG_RESUME:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          isRunning: true,\n          isDebugging: false\n        }\n      };\n    case DEBUG_RESET:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          isRunning: false,\n          isDebugging: false\n        }\n      };\n    case RESET_TESTCASE:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          editorTestcases: state[workspaceLocation].editorTestcases.map(\n            (testcase: Testcase, i: any) => {\n              if (i === action.payload.index) {\n                return {\n                  ...testcase,\n                  result: undefined,\n                  errors: undefined\n                };\n              } else {\n                return testcase;\n              }\n            }\n          )\n        }\n      };\n\n    /**\n     * Resets the workspace to default settings,\n     * including the c-slang Context. Apply\n     * any specified settings (workspaceOptions)\n     */\n    case RESET_WORKSPACE:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          ...createDefaultWorkspace(workspaceLocation),\n          ...action.payload.workspaceOptions\n        }\n      };\n    /**\n     * Updates workspace without changing anything\n     * which has not been specified\n     */\n    case UPDATE_WORKSPACE:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          ...action.payload.workspaceOptions\n        }\n      };\n    case SET_EDITOR_SESSION_ID:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          editorSessionId: action.payload.editorSessionId\n        }\n      };\n\n    case SET_IS_EDITOR_READONLY:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          isEditorReadonly: action.payload.isEditorReadonly\n        }\n      };\n    case SET_SHAREDB_CONNECTED:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          sharedbConnected: action.payload.connected\n        }\n      };\n    case TOGGLE_EDITOR_AUTORUN:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          isEditorAutorun: !state[workspaceLocation].isEditorAutorun\n        }\n      };\n    case TOGGLE_USING_SUBST:\n      if (workspaceLocation === 'playground' || workspaceLocation === 'sicp') {\n        return {\n          ...state,\n          [workspaceLocation]: {\n            ...state[workspaceLocation],\n            usingSubst: action.payload.usingSubst\n          }\n        };\n      } else {\n        return state;\n      }\n    case UPDATE_CURRENT_ASSESSMENT_ID:\n      return {\n        ...state,\n        assessment: {\n          ...state.assessment,\n          currentAssessment: action.payload.assessmentId,\n          currentQuestion: action.payload.questionId\n        }\n      };\n    case UPDATE_CURRENT_SUBMISSION_ID:\n      return {\n        ...state,\n        grading: {\n          ...state.grading,\n          currentSubmission: action.payload.submissionId,\n          currentQuestion: action.payload.questionId\n        }\n      };\n    case UPDATE_ACTIVE_EDITOR_TAB:\n      const activeEditorTabIndex = state[workspaceLocation].activeEditorTabIndex;\n      // Do not modify the workspace state if there is no active editor tab.\n      if (activeEditorTabIndex === null) {\n        return state;\n      }\n      const updatedEditorTabs = [...state[workspaceLocation].editorTabs];\n      updatedEditorTabs[activeEditorTabIndex] = {\n        ...updatedEditorTabs[activeEditorTabIndex],\n        ...action.payload.activeEditorTabOptions\n      };\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          editorTabs: updatedEditorTabs\n        }\n      };\n    case UPDATE_EDITOR_BREAKPOINTS:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n          editorTabs: [\n            { ...state[workspaceLocation].editorTabs[0], breakpoints: action.payload.breakpoints }\n          ]\n        }\n      };\n    case UPDATE_EDITOR_VALUE:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n          editorTabs: [\n            { ...state[workspaceLocation].editorTabs[0], value: action.payload.newEditorValue }\n          ]\n        }\n      };\n    case HIGHLIGHT_LINE:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n          editorTabs: [\n            {\n              ...state[workspaceLocation].editorTabs[0],\n              highlightedLines: action.payload.highlightedLines\n            }\n          ]\n        }\n      };\n    case MOVE_CURSOR:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n          editorTabs: [\n            {\n              ...state[workspaceLocation].editorTabs[0],\n              newCursorPosition: action.payload.cursorPosition\n            }\n          ]\n        }\n      };\n    case UPDATE_REPL_VALUE:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          replValue: action.payload.newReplValue\n        }\n      };\n    case UPDATE_HAS_UNSAVED_CHANGES:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          hasUnsavedChanges: action.payload.hasUnsavedChanges\n        }\n      };\n    case UPDATE_SUBLANGUAGE:\n      return {\n        ...state,\n        playground: {\n          ...state.playground,\n          context: {\n            ...state.playground.context,\n            chapter: action.payload.sublang.chapter,\n            variant: action.payload.sublang.variant\n          }\n        }\n      };\n    case NOTIFY_PROGRAM_EVALUATED:\n      return {\n        ...state,\n        [workspaceLocation]: {\n          ...state[workspaceLocation],\n          debuggerContext: {\n            ...state[workspaceLocation].debuggerContext,\n            result: action.payload.result,\n            lastDebuggerResult: action.payload.lastDebuggerResult,\n            code: action.payload.code,\n            context: action.payload.context,\n            workspaceLocation: action.payload.workspaceLocation\n          }\n        }\n      };\n    default:\n      return state;\n  }\n};\n","import { Action, Reducer } from 'redux';\n\nimport { ApplicationState, defaultApplication } from './ApplicationTypes';\n\nexport const ApplicationReducer: Reducer<ApplicationState> = (\n  state = defaultApplication,\n  action: Action\n) => {\n  return state;\n};\n","import { Reducer } from 'redux';\n\nimport {\n  REMOTE_EXEC_UPDATE_DEVICES,\n  REMOTE_EXEC_UPDATE_SESSION\n} from '../../../features/remoteExecution/RemoteExecutionTypes';\nimport { SourceActionType } from '../../utils/ActionsHelper';\nimport { defaultSession } from '../ApplicationTypes';\nimport { LOG_OUT } from '../types/CommonsTypes';\nimport {\n  REMOVE_GITHUB_OCTOKIT_OBJECT_AND_ACCESS_TOKEN,\n  SessionState,\n  SET_ADMIN_PANEL_COURSE_REGISTRATIONS,\n  SET_ASSESSMENT_CONFIGURATIONS,\n  SET_COURSE_CONFIGURATION,\n  SET_COURSE_REGISTRATION,\n  SET_GITHUB_ACCESS_TOKEN,\n  SET_GITHUB_ASSESSMENT,\n  SET_GITHUB_OCTOKIT_OBJECT,\n  SET_GOOGLE_USER,\n  SET_TOKENS,\n  SET_USER,\n  UPDATE_ALL_USER_XP,\n  UPDATE_ASSESSMENT,\n  UPDATE_ASSESSMENT_OVERVIEWS,\n  UPDATE_GRADING,\n  UPDATE_GRADING_OVERVIEWS,\n  UPDATE_NOTIFICATIONS,\n  UPDATE_TOTAL_XP\n} from '../types/SessionTypes';\n\nexport const SessionsReducer: Reducer<SessionState> = (\n  state = defaultSession,\n  action: SourceActionType\n) => {\n  switch (action.type) {\n    case LOG_OUT:\n      return defaultSession;\n    case SET_GITHUB_ASSESSMENT:\n      return {\n        ...state,\n        githubAssessment: action.payload\n      };\n    case SET_GITHUB_OCTOKIT_OBJECT:\n      return {\n        ...state,\n        githubOctokitObject: { octokit: action.payload }\n      };\n    case SET_GITHUB_ACCESS_TOKEN:\n      return {\n        ...state,\n        githubAccessToken: action.payload\n      };\n    case SET_GOOGLE_USER:\n      return {\n        ...state,\n        googleUser: action.payload\n      };\n    case SET_TOKENS:\n      return {\n        ...state,\n        ...action.payload\n      };\n    case SET_USER:\n      return {\n        ...state,\n        ...action.payload\n      };\n    case SET_COURSE_CONFIGURATION:\n      return {\n        ...state,\n        ...action.payload\n      };\n    case SET_COURSE_REGISTRATION:\n      return {\n        ...state,\n        ...action.payload\n      };\n    case SET_ASSESSMENT_CONFIGURATIONS:\n      return {\n        ...state,\n        assessmentConfigurations: action.payload\n      };\n    case SET_ADMIN_PANEL_COURSE_REGISTRATIONS:\n      return {\n        ...state,\n        userCourseRegistrations: action.payload\n      };\n    case UPDATE_ASSESSMENT:\n      const newAssessments = new Map(state.assessments);\n      newAssessments.set(action.payload.id, action.payload);\n      return {\n        ...state,\n        assessments: newAssessments\n      };\n    case UPDATE_ASSESSMENT_OVERVIEWS:\n      return {\n        ...state,\n        assessmentOverviews: action.payload\n      };\n    case UPDATE_TOTAL_XP:\n      return { ...state, xp: action.payload };\n    case UPDATE_ALL_USER_XP:\n      return { ...state, allUserXp: action.payload };\n    case UPDATE_GRADING:\n      const newGradings = new Map(state.gradings);\n      newGradings.set(action.payload.submissionId, action.payload.grading);\n      return {\n        ...state,\n        gradings: newGradings\n      };\n    case UPDATE_GRADING_OVERVIEWS:\n      return {\n        ...state,\n        gradingOverviews: action.payload\n      };\n    case UPDATE_NOTIFICATIONS:\n      return {\n        ...state,\n        notifications: action.payload\n      };\n    case REMOTE_EXEC_UPDATE_DEVICES:\n      return {\n        ...state,\n        remoteExecutionDevices: action.payload\n      };\n    case REMOTE_EXEC_UPDATE_SESSION:\n      return {\n        ...state,\n        remoteExecutionSession: action.payload\n      };\n    case REMOVE_GITHUB_OCTOKIT_OBJECT_AND_ACCESS_TOKEN:\n      return {\n        ...state,\n        githubOctokitObject: { octokit: undefined },\n        githubAccessToken: undefined\n      };\n    default:\n      return state;\n  }\n};\n","import { combineReducers } from 'redux';\n\nimport { AcademyReducer as academy } from '../../../features/academy/AcademyReducer';\nimport { AchievementReducer as achievement } from '../../../features/achievement/AchievementReducer';\nimport { DashboardReducer as dashboard } from '../../../features/dashboard/DashboardReducer';\nimport { PlaygroundReducer as playground } from '../../../features/playground/PlaygroundReducer';\nimport { WorkspaceReducer as workspaces } from '../../workspace/WorkspaceReducer';\nimport { ApplicationReducer as application } from '../ApplicationReducer';\nimport { SessionsReducer as session } from './SessionsReducer';\n\nconst createRootReducer = () =>\n  combineReducers({\n    academy,\n    achievement,\n    application,\n    dashboard,\n    playground,\n    session,\n    workspaces\n  });\n\nexport default createRootReducer;\n","import { ExternalLibraryName } from '../application/types/ExternalTypes';\nimport {\n  Assessment,\n  AssessmentConfiguration,\n  AssessmentOverview,\n  AssessmentStatuses,\n  GradingStatuses,\n  IContestVotingQuestion,\n  IMCQQuestion,\n  IProgrammingQuestion,\n  Library,\n  TestcaseTypes\n} from '../assessment/AssessmentTypes';\n\nexport const mockAssessmentConfigurations: AssessmentConfiguration[][] = [\n  [\n    {\n      assessmentConfigId: 1,\n      type: 'Missions',\n      isManuallyGraded: true,\n      displayInDashboard: true,\n      hoursBeforeEarlyXpDecay: 48,\n      earlySubmissionXp: 200\n    },\n    {\n      assessmentConfigId: 2,\n      type: 'Quests',\n      isManuallyGraded: true,\n      displayInDashboard: true,\n      hoursBeforeEarlyXpDecay: 48,\n      earlySubmissionXp: 200\n    },\n    {\n      assessmentConfigId: 3,\n      type: 'Paths',\n      isManuallyGraded: true,\n      displayInDashboard: true,\n      hoursBeforeEarlyXpDecay: 48,\n      earlySubmissionXp: 200\n    },\n    {\n      assessmentConfigId: 4,\n      type: 'Contests',\n      isManuallyGraded: true,\n      displayInDashboard: true,\n      hoursBeforeEarlyXpDecay: 48,\n      earlySubmissionXp: 200\n    },\n    {\n      assessmentConfigId: 5,\n      type: 'Others',\n      isManuallyGraded: true,\n      displayInDashboard: true,\n      hoursBeforeEarlyXpDecay: 48,\n      earlySubmissionXp: 200\n    }\n  ],\n  [\n    {\n      assessmentConfigId: 1,\n      type: 'Mission Impossible',\n      isManuallyGraded: true,\n      displayInDashboard: true,\n      hoursBeforeEarlyXpDecay: 48,\n      earlySubmissionXp: 200\n    },\n    {\n      assessmentConfigId: 2,\n      type: 'Data Structures',\n      isManuallyGraded: true,\n      displayInDashboard: true,\n      hoursBeforeEarlyXpDecay: 48,\n      earlySubmissionXp: 200\n    },\n    {\n      assessmentConfigId: 3,\n      type: 'Algorithm Frenzy',\n      isManuallyGraded: true,\n      displayInDashboard: true,\n      hoursBeforeEarlyXpDecay: 48,\n      earlySubmissionXp: 200\n    }\n  ]\n];\n\nconst mockUnopenedAssessmentsOverviews: AssessmentOverview[] = [\n  {\n    type: 'Missions',\n    isManuallyGraded: true,\n    closeAt: '2048-06-18T05:24:26.026Z',\n    coverImage: 'https://fakeimg.pl/300/',\n    id: 1,\n    maxXp: 1000,\n    openAt: '2038-06-18T05:24:26.026Z',\n    title: 'An Odessey to Runes (Duplicate)',\n    shortSummary:\n      'This is a test for the UI of the unopened assessment overview. It links to the mock Mission 0',\n    status: AssessmentStatuses.not_attempted,\n    story: 'mission-1',\n    xp: 0,\n    gradingStatus: GradingStatuses.none\n  }\n];\n\nconst mockOpenedAssessmentsOverviews: AssessmentOverview[] = [\n  {\n    type: 'Missions',\n    isManuallyGraded: true,\n    closeAt: '2048-06-18T05:24:26.026Z',\n    coverImage: 'https://fakeimg.pl/300/',\n    id: 1,\n    maxXp: 1000,\n    openAt: '2018-06-18T05:24:26.026Z',\n    title: 'An Odessey to Runes',\n    shortSummary: `\n  *Lorem ipsum* dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor\n  incididunt ut labore et dolore magna aliqua.\n  \n  \\`\\`\\`\n  const a = 5;\n  \\`\\`\\`\n  \n  Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium\n  _doloremque laudantium_, totam rem aperiam, eaque ipsa quae ab illo inventore\n  [veritatis et quasi architecto](google.com) beatae vitae dicta sunt\n  \\`explicabo\\`.\n  \n  `,\n    status: AssessmentStatuses.attempted,\n    story: 'mission-1',\n    xp: 1,\n    gradingStatus: GradingStatuses.none\n  },\n  {\n    type: 'Missions',\n    isManuallyGraded: true,\n    closeAt: '2048-06-18T05:24:26.026Z',\n    coverImage: 'https://fakeimg.pl/350x200/?text=World&font=lobster',\n    id: 2,\n    maxXp: 1000,\n    openAt: '2018-07-18T05:24:26.026Z',\n    title: 'The Secret to Streams',\n    shortSummary:\n      'Once upon a time, Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin nec vulputate sapien. Fusce vel lacus fermentum, efficitur ipsum.',\n    status: AssessmentStatuses.attempting,\n    story: 'mission-2',\n    xp: 2,\n    gradingStatus: GradingStatuses.none\n  },\n  {\n    type: 'Quests',\n    isManuallyGraded: true,\n    closeAt: '2048-06-18T05:24:26.026Z',\n    coverImage: 'https://fakeimg.pl/350x200/?text=Hello',\n    id: 3,\n    maxXp: 1000,\n    openAt: '2018-07-18T05:24:26.026Z',\n    title: 'A sample Sidequest',\n    shortSummary:\n      'Once upon a time, Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin nec vulputate sapien. Fusce vel lacus fermentum, efficitur ipsum.',\n    status: AssessmentStatuses.not_attempted,\n    story: 'sidequest-2.1',\n    xp: 3,\n    gradingStatus: GradingStatuses.none\n  },\n  {\n    type: 'Paths',\n    isManuallyGraded: true,\n    closeAt: '2069-04-20T01:23:45.111Z',\n    coverImage: 'https://fakeimg.pl/700x400/417678,64/?text=%E3%83%91%E3%82%B9&font=noto',\n    id: 6,\n    maxXp: 200,\n    openAt: '2018-01-01T00:00:00.000Z',\n    title: 'Basic logic gates',\n    shortSummary:\n      'This mock path serves as a demonstration of the support provided for mock programming path functionality.',\n    status: AssessmentStatuses.not_attempted,\n    story: null,\n    xp: 0,\n    gradingStatus: GradingStatuses.excluded\n  },\n  {\n    type: 'Others',\n    isManuallyGraded: false,\n    closeAt: '2048-06-18T05:24:26.026Z',\n    coverImage: 'https://fakeimg.pl/350x200/?text=Hello',\n    id: 5,\n    maxXp: 1000,\n    openAt: '2018-07-18T05:24:26.026Z',\n    title: 'A sample Practical',\n    shortSummary:\n      'Once upon a time, Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin nec vulputate sapien. Fusce vel lacus fermentum, efficitur ipsum.',\n    status: AssessmentStatuses.not_attempted,\n    story: 'sidequest-2.1',\n    xp: 3,\n    gradingStatus: GradingStatuses.none,\n    private: true\n  }\n];\n\nconst mockClosedAssessmentOverviews: AssessmentOverview[] = [\n  {\n    type: 'Missions',\n    isManuallyGraded: true,\n    closeAt: '2008-06-18T05:24:26.026Z',\n    coverImage: 'https://fakeimg.pl/350x200/ff0000/000',\n    id: 4,\n    maxXp: 1000,\n    openAt: '2007-07-18T05:24:26.026Z',\n    title: 'A closed Mission',\n    shortSummary:\n      'This is a test for the grading status tooltip when the assessment is partially graded (undergoing manual grading). It should render as an orange clock.',\n    status: AssessmentStatuses.submitted,\n    story: 'mission-3',\n    xp: 800,\n    gradingStatus: GradingStatuses.grading\n  },\n  {\n    type: 'Quests',\n    isManuallyGraded: true,\n    closeAt: '2008-06-18T05:24:26.026Z',\n    coverImage: 'https://fakeimg.pl/350x200/ff0000,128/000,255',\n    id: 5,\n    maxXp: 1000,\n    openAt: '2007-07-18T05:24:26.026Z',\n    title: 'Closed (not graded) Sidequest',\n    shortSummary:\n      'This is a test for the grading status tooltip when the assessment is not graded. It should render as a red cross.',\n    status: AssessmentStatuses.submitted,\n    story: null,\n    xp: 500,\n    gradingStatus: GradingStatuses.none\n  },\n  {\n    type: 'Quests',\n    isManuallyGraded: true,\n    closeAt: '2008-06-18T05:24:26.026Z',\n    coverImage: 'https://fakeimg.pl/350x200/ff0000,128/000,255',\n    id: 5,\n    maxXp: 500,\n    openAt: '2007-07-18T05:24:26.026Z',\n    title: 'Closed (fully graded) Sidequest',\n    shortSummary:\n      'This is a test for the grading status tooltip when the assessment is fully graded. It should render as a green tick. This sidequest links to the mock Sidequest 4.',\n    status: AssessmentStatuses.submitted,\n    story: null,\n    xp: 150,\n    gradingStatus: GradingStatuses.graded\n  },\n  {\n    type: 'Quests',\n    isManuallyGraded: true,\n    closeAt: '2008-06-18T05:24:26.026Z',\n    coverImage: 'https://fakeimg.pl/350x200/ff0000/000',\n    id: 5,\n    maxXp: 0,\n    openAt: '2007-07-18T05:24:26.026Z',\n    title: 'Ungraded assessment',\n    shortSummary:\n      'This is a test for the grading status tooltip when the assessment does not require manual grading (e.g. paths and contests). It should render as a blue disable sign. This sidequest links to the mock Sidequest 4.',\n    status: AssessmentStatuses.submitted,\n    story: null,\n    xp: 100,\n    gradingStatus: GradingStatuses.excluded\n  }\n];\n\nexport const mockAssessmentOverviews = [\n  ...mockUnopenedAssessmentsOverviews,\n  ...mockOpenedAssessmentsOverviews,\n  ...mockClosedAssessmentOverviews\n];\n\nexport const mockLibrary: Library = {\n  external: {\n    name: ExternalLibraryName.NONE,\n    symbols: []\n  },\n  globals: []\n};\n\nexport const mockAssessmentQuestions: Array<IProgrammingQuestion | IMCQQuestion> = [\n  {\n    autogradingResults: [],\n    answer: null,\n    content: `\n  This question has an id of \\`0\\`.\n  \n  \\`\\`\\`\n  What's your favourite dinner food?\n  \\`\\`\\`\n  `,\n    id: 0,\n    library: mockLibrary,\n    prepend: `const pizza = \"pizza\";\n  const sushi = \"sushi\";\n  const chickenrice = \"chicken rice\";`,\n    postpend: \"// This is a mock Postpend! You shouldn't be able to see me!\",\n    testcases: [\n      {\n        type: TestcaseTypes.public,\n        program: `answer();`,\n        score: 1,\n        answer: `\"pizza\"`\n      },\n      {\n        type: TestcaseTypes.public,\n        program: `answer();`,\n        score: 1,\n        answer: `\"sushi\"`\n      },\n      {\n        type: TestcaseTypes.public,\n        program: `answer();`,\n        score: 1,\n        answer: `\"chicken rice\"`\n      }\n    ],\n    solutionTemplate: `function answer() {\n      // Write something here!\n  }\n  `,\n    type: 'programming',\n    xp: 0,\n    maxXp: 2,\n    blocking: false\n  },\n  {\n    autogradingResults: [],\n    answer: `function areaOfCircle(x) {\n      return square(x) * pi;\n  }\n  \n  function volumeOfSphere(x) {\n      return 4 / 3 * cube(x) * pi;\n  }`,\n    content: 'Hello and welcome to this assessment! This is the 1st question.',\n    id: 1,\n    library: mockLibrary,\n    prepend: `const square = x => x * x;\n  const cube = x => x * x * x;\n  const pi = 3.1415928;`,\n    postpend: '',\n    testcases: [\n      {\n        type: TestcaseTypes.public,\n        program: `areaOfCircle(5);`,\n        score: 1,\n        answer: `78.53982`\n      },\n      {\n        type: TestcaseTypes.public,\n        program: `volumeOfSphere(5);`,\n        score: 1,\n        answer: `523.5988`\n      }\n    ],\n    solutionTemplate: `function areaOfCircle(x) {\n      // return area of circle\n  }\n  \n  function volumeOfSphere(x) {\n      // return volume of sphere\n  }`,\n    type: 'programming',\n    xp: 0,\n    maxXp: 2,\n    blocking: false\n  },\n  {\n    answer: 3,\n    content:\n      'This is the 3rd question. Oddly enough, it is an ungraded MCQ question that uses the binary tree library! Option C has a null hint!',\n    choices: [\n      {\n        content: '**Option** `A`',\n        hint: '_hint_ A is `here`'\n      },\n      {\n        content: '### B',\n        hint: 'hint B'\n      },\n      {\n        content: 'C',\n        hint: null\n      },\n      {\n        content: 'D',\n        hint: 'hint D'\n      }\n    ],\n    id: 2,\n    library: mockLibrary,\n    type: 'mcq',\n    solution: 0,\n    xp: 0,\n    maxXp: 2,\n    blocking: false\n  },\n  {\n    answer: 3,\n    content:\n      'This is the 4th question. Oddly enough, it is a graded MCQ question that uses the binary tree library!',\n    choices: [\n      {\n        content: 'A',\n        hint: null\n      },\n      {\n        content: 'B',\n        hint: null\n      },\n      {\n        content: 'C',\n        hint: null\n      },\n      {\n        content: 'D',\n        hint: null\n      }\n    ],\n    id: 3,\n    library: mockLibrary,\n    type: 'mcq',\n    solution: undefined,\n    xp: 0,\n    maxXp: 2,\n    blocking: false\n  },\n  {\n    autogradingResults: [],\n    answer: null,\n    content: 'You have reached the last question! Have some fun with the tone matrix...',\n    id: 4,\n    library: mockLibrary,\n    prepend: '',\n    postpend: '',\n    testcases: [],\n    solutionTemplate: '5th question mock solution template',\n    type: 'programming',\n    xp: 0,\n    maxXp: 2,\n    blocking: false\n  }\n];\n\nexport const mockClosedAssessmentQuestions: Array<IProgrammingQuestion | IMCQQuestion> = [\n  {\n    answer: `function fibonacci(n) {\n      if (n <= 2) {\n          return 1;\n      } else {\n          return fibonacci(n-1) + fibonacci(n-2);\n      }\n  }`,\n    content: 'You can see autograding results!!!',\n    id: 0,\n    library: mockLibrary,\n    prepend: '',\n    postpend: \"// This is a mock Postpend! You shouldn't be able to see me!\",\n    testcases: [\n      {\n        type: TestcaseTypes.public,\n        program: `fibonacci(3);`,\n        score: 1,\n        answer: `2`\n      },\n      {\n        type: TestcaseTypes.public,\n        program: `fibonacci(4);`,\n        score: 1,\n        answer: `3`\n      },\n      {\n        type: TestcaseTypes.public,\n        program: `fibonacci(5);`,\n        score: 1,\n        answer: `5`\n      }\n    ],\n    solutionTemplate: `function fibonacci(n) {\n      // Your answer here\n  }`,\n    type: 'programming',\n    grader: {\n      name: 'avenger',\n      id: 1\n    },\n    gradedAt: '2038-06-18T05:24:26.026Z',\n    xp: 0,\n    maxXp: 2,\n    blocking: false,\n    comments: `Good job. You are awarded the full marks!\n  \n  ----\n  ## markdown test\n  \n  # header\n  \n  **bold**\n  \n  _italics_\n  \n  * list\n  \n  1. numbered list\n  \n  - [] checkboxes\n  \n  > quote\n  \n      code\n  \n  [link to Source Academy](https://sourceacademy.nus.edu.sg)  \n  \n  ![](image-url-goes-here)`,\n    autogradingResults: [\n      {\n        resultType: 'pass'\n      },\n      {\n        resultType: 'fail',\n        expected: '8',\n        actual: '5'\n      },\n      {\n        resultType: 'error',\n        errors: [\n          {\n            errorType: 'timeout'\n          },\n          {\n            errorType: 'syntax',\n            line: 1,\n            location: 'student',\n            errorLine: 'function fibonacci(n) {',\n            errorExplanation: 'Just kidding!'\n          }\n        ]\n      }\n    ]\n  },\n  {\n    answer: `function recurse(rune, n) {\n      return n <= 1 ? rune : make_cross(recurse(rune, n - 1));\n  }`,\n    content: 'This is a runes question - there are no testcases nor autograding results.',\n    id: 1,\n    library: mockLibrary,\n    prepend: '',\n    postpend: '',\n    testcases: [],\n    solutionTemplate: `function recurse(rune, n) {\n      // Your answer here\n  }`,\n    type: 'programming',\n    grader: {\n      name: 'some avenger',\n      id: 1\n    },\n    gradedAt: '2038-06-18T05:24:26.026Z',\n    xp: 0,\n    maxXp: 2,\n    blocking: false,\n    comments: `You open the Report Card, not knowing what to expect...\n  \n      ## WOW!\n      Amazing grasp of runes. We can now move on to the next assignment.\n      \n      <br/>\n      \n      Robot Dog: \\`woof\\`\n      \n      You look at the display of the robot dog.\n      \n          FEED ME\n      1. Bread\n      2. Water\n      \n      <br/>\n      \n      * I am hungry.\n      * I am thirsty.\n      \n      <br/>\n      <br/>\n          \n      New message from **Avenger**!\n      \n      > _Cadet, please meet me at Level X-05, outside the pod bay doors. There is an important mission awaiting us._\n      \n      > _May the [Source](https://sourceacademy.nus.edu.sg) be with you._\n      \n      > Best regards, Avocado A. Avenger\n      \n      #### Upcoming Tasks\n      - [] Meet Avenger Avenger at Level X-05\n      - [] Open the Pod Bay Doors`,\n    autogradingResults: []\n  }\n];\n\nexport const mockPathQuestions: Array<IProgrammingQuestion | IMCQQuestion> = [\n  {\n    answer: null,\n    content: 'As a recap: which of the following is not a valid logic gate?',\n    choices: [\n      {\n        content: 'XOR gate',\n        hint: 'This is the exclusive-OR gate!'\n      },\n      {\n        content: 'IF gate',\n        hint: 'Correct!'\n      },\n      {\n        content: 'AND gate',\n        hint: 'This logic gate exists!'\n      },\n      {\n        content: 'OR gate',\n        hint: 'This logic gate exists!'\n      }\n    ],\n    id: 0,\n    library: mockLibrary,\n    type: 'mcq',\n    solution: 1,\n    xp: 0,\n    maxXp: 0,\n    blocking: false\n  },\n  {\n    autogradingResults: [],\n    answer: null,\n    content: `An AND gate is a digital logic gate that implements logical conjunction on its inputs. It returns a single output that is HIGH (active) iff all the inputs to the AND gate are HIGH (active).\n  \n  In this question, let us model an AND gate as a function, and treat HIGH (active) inputs as the boolean value \\`true\\` and LOW (inactive) inputs as the boolean value \\`false\\`.\n  \n  As an AND gate is not restricted to exactly two inputs, our function shall be the same. Implement the function \\`AND(inputs)\\` which takes in the list \\`inputs\\` (a list of boolean values), and returns the output of the AND gate as a boolean. You may assume the list \\`inputs\\` is of minimum length 2.\n  \n  This question makes use of the sentinel function method to throw custom errors for each testcase.`,\n    id: 1,\n    library: mockLibrary,\n    prepend: `const OR = (x, y) => x || y;`,\n    postpend: `\n  const __AND = (xs) => {\n    if (AND(list(true, true)) === undefined) {\n      error('Your function is empty!');\n    } else {}\n    \n    const result = AND(xs);\n  \n    if (!is_boolean(result)) {\n      error('Your function does not return a boolean!');\n    } else {}\n    \n    if (equal(xs, list(true, false)) && result) {\n      error('Check the truth table for an AND gate again!');\n    } else if (equal(xs, list(true, true, false)) && result) {\n      error('Are you using all inputs in the list?');\n    } else if (equal(xs, list(true, true, true)) && !result) {\n      error('Are you sure your base case is correct?');\n    } else if (AND(list(true, true)) === AND(list(false, false))) {\n      error('Oi! Do not hardcode values!');\n    } else {\n      return result;\n    }\n  };`,\n    testcases: [\n      {\n        type: TestcaseTypes.public,\n        program: `__AND(list(true, false));`,\n        score: 0,\n        answer: `false`\n      },\n      {\n        type: TestcaseTypes.public,\n        program: `__AND(list(true, true, false));`,\n        score: 0,\n        answer: `false`\n      },\n      {\n        type: TestcaseTypes.public,\n        program: `__AND(list(true, OR(true, false), OR(true, true)));`,\n        score: 0,\n        answer: `true`\n      },\n      {\n        type: TestcaseTypes.opaque,\n        program: `__AND(list(true, OR(false, true), AND(list(true, false)), false));`,\n        score: 0,\n        answer: `false`\n      },\n      {\n        type: TestcaseTypes.opaque,\n        program: `__AND(list(true, OR(true, false), OR(true, AND(list(false, true))), true));`,\n        score: 0,\n        answer: `true`\n      }\n    ],\n    solutionTemplate: `function AND(inputs) {\n      // Your answer here!\n  }`,\n    type: 'programming',\n    xp: 0,\n    maxXp: 0,\n    blocking: false\n  },\n  {\n    autogradingResults: [],\n    answer: null,\n    content: `The XOR (exclusive-OR) gate is a digital logic gate that accepts two inputs and returns a single output that is HIGH (active) iff one of the inputs are HIGH (active), but not both.\n  \n  In this question, let us model the XOR gate as a function. Implement the function \\`XOR(x, y)\\` which takes two boolean inputs \\`x\\` and \\`y\\` and which returns the output of the XOR gate as a boolean.\n  \n  This question makes use of the wrapping container method to throw custom errors for each testcase.`,\n    id: 2,\n    library: mockLibrary,\n    prepend: ``,\n    postpend: `\n  const __XOR = (x, y) => {\n    if (XOR(false, false) === undefined) {\n      error('Your function is empty!');\n    } else {}\n    \n    const result = XOR(x, y);\n  \n    if (!is_boolean(result)) {\n      error('Your function does not return a boolean!');\n    } else {}\n    \n    if (((x && !y) || (y && !x)) && !result) {\n      error('Check your truth tables!');\n    } else if (XOR(false, false) === XOR(false, true)) {\n      error('Oi! Do not hardcode values!');\n    } else {\n      return result;\n    }\n  };`,\n    testcases: [\n      {\n        type: TestcaseTypes.public,\n        program: `__XOR(true, false);`,\n        score: 0,\n        answer: `true`\n      },\n      {\n        type: TestcaseTypes.public,\n        program: `__XOR(false, true);`,\n        score: 0,\n        answer: `true`\n      },\n      {\n        type: TestcaseTypes.opaque,\n        program: `__XOR(true, XOR(true, false));`,\n        score: 0,\n        answer: `false`\n      }\n    ],\n    solutionTemplate: `function XOR(x, y) {\n      // Your answer here!\n  }`,\n    type: 'programming',\n    xp: 0,\n    maxXp: 0,\n    blocking: false\n  },\n  {\n    autogradingResults: [],\n    answer: null,\n    content: `The NOR logic gate is special in that it is an _universal logic gate_, that is to say, they can be composed to form any other logic gate.\n  \n  Implement the AND logic gate **using ONLY the NOR logic gate**, as the \\`NOR_AND(x, y)\\` function that takes in two booleans as input.\n  \n  The \\`NOR\\` function modeled after a NOR gate is provided for you - it accepts two boolean values and returns \\`true\\` iff both inputs are \\`false\\`.`,\n    id: 3,\n    library: mockLibrary,\n    prepend: `\n  let counter = 0;\n  const NOR = (x, y) => {\n    counter = counter + 1;\n    return !(x || y);\n  };`,\n    postpend: `\n  const __NOR_AND = (x, y) => {\n    if (NOR_AND(false, false) === undefined) {\n      error('Your function is empty!');\n    } else {}\n    \n    counter = 0;\n    const result = NOR_AND(x, y);\n  \n    if (!is_boolean(result)) {\n      error('Your function does not return a boolean!');\n    } else {}\n    \n    if (!x && y && result) {\n      error('Check your truth tables!');\n    } else if (x && y && !result && counter > 0) {\n      error('Nope! Try again :)');\n    } else if (x && y && !result) {\n      error('...You did not use NOR and still got it wrong!');\n    } else if (x && y && result && counter !== 3) {\n      error('Did you use NOR in your solution? >:(');\n    } else if (x && !y && counter !== 6) {\n      error('Incorrect number of calls.');\n    } else {\n      return result;\n    }\n  };`,\n    testcases: [\n      {\n        type: TestcaseTypes.public,\n        program: `__NOR_AND(false, true);`,\n        score: 0,\n        answer: `false`\n      },\n      {\n        type: TestcaseTypes.public,\n        program: `__NOR_AND(true, true);`,\n        score: 0,\n        answer: `true`\n      },\n      {\n        type: TestcaseTypes.opaque,\n        program: `__NOR_AND(true, NOR_AND(false, true));`,\n        score: 0,\n        answer: `false`\n      }\n    ],\n    solutionTemplate: `function NOR_AND(x, y) {\n      // Your answer here!\n  }`,\n    type: 'programming',\n    xp: 0,\n    maxXp: 0,\n    blocking: false\n  }\n];\n\nconst mockContestEntryQuestion: Array<IContestVotingQuestion> = [\n  {\n    id: 0,\n    type: 'voting',\n    content: 'Sample Contest Voting Question',\n    xp: 0,\n    maxXp: 0,\n    answer: [],\n    prepend: '',\n    postpend: '',\n    contestEntries: [\n      {\n        submission_id: 1,\n        answer: { code: \"display('voting test')\" }\n      },\n      {\n        submission_id: 2,\n        answer: { code: 'function voting_test() { return true; }' }\n      }\n    ],\n    contestLeaderboard: [\n      {\n        submission_id: 1,\n        student_name: 'student_1',\n        answer: { code: \"display('leaderboard test')\" }\n      },\n      {\n        submission_id: 2,\n        student_name: 'student_2',\n        answer: { code: 'function leaderboard_test() { return true; }' }\n      }\n    ],\n    library: mockLibrary,\n    blocking: false\n  }\n];\n\n/*\n * A few Assessments to try out in workspaces.\n */\nexport const mockAssessments: Assessment[] = [\n  {\n    type: 'Missions',\n    id: 1,\n    longSummary:\n      'This is the mission briefing. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis vestibulum. Etiam in egestas dolor. Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum, vel ornare metus turpis sed justo. Vivamus at tellus sed ex convallis commodo at in lectus. Pellentesque pharetra pulvinar sapien pellentesque facilisis. Curabitur efficitur malesuada urna sed aliquam. Quisque massa metus, aliquam in sagittis non, cursus in sem. Morbi vel nunc at nunc pharetra lobortis. Aliquam feugiat ultricies ipsum vel sollicitudin. Vivamus nulla massa, hendrerit sit amet nibh quis, porttitor convallis nisi. ',\n    missionPDF: 'www.google.com',\n    questions: mockAssessmentQuestions,\n    title: 'An Odessey to Runes'\n  },\n  {\n    type: 'Missions',\n    id: 2,\n    longSummary:\n      'This is the mission briefing. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis vestibulum. Etiam in egestas dolor. Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum, vel ornare metus turpis sed justo. Vivamus at tellus sed ex convallis commodo at in lectus. Pellentesque pharetra pulvinar sapien pellentesque facilisis. Curabitur efficitur malesuada urna sed aliquam. Quisque massa metus, aliquam in sagittis non, cursus in sem. Morbi vel nunc at nunc pharetra lobortis. Aliquam feugiat ultricies ipsum vel sollicitudin. Vivamus nulla massa, hendrerit sit amet nibh quis, porttitor convallis nisi. ',\n    missionPDF: 'www.google.com',\n    questions: mockAssessmentQuestions,\n    title: 'The Secret to Streams'\n  },\n  {\n    type: 'Quests',\n    id: 3,\n    longSummary: `###This is the sidequest briefing.\n  \n  *Lorem ipsum* dolor sit amet, consectetur adipiscing elit.\n  \n  > Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin\n  enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis\n  vestibulum.\n  \n  - Etiam in egestas dolor.\n  - Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum,\n    vel ornare metus turpis sed justo.\n  - Vivamus at tellus sed ex convallis commodo at in lectus.\n  \n  \\`\\`\\`\n  Pellentesque\n  pharetra\n  pulvinar\n  sapien\n  \\`\\`\\``,\n    missionPDF: 'www.google.com',\n    questions: mockAssessmentQuestions,\n    title: 'A sample Sidequest'\n  },\n  {\n    type: 'Missions',\n    id: 4,\n    longSummary:\n      'This is the closed mission briefing. The save button should not be there. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis vestibulum. Etiam in egestas dolor. Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum, vel ornare metus turpis sed justo. Vivamus at tellus sed ex convallis commodo at in lectus. Pellentesque pharetra pulvinar sapien pellentesque facilisis. Curabitur efficitur malesuada urna sed aliquam. Quisque massa metus, aliquam in sagittis non, cursus in sem. Morbi vel nunc at nunc pharetra lobortis. Aliquam feugiat ultricies ipsum vel sollicitudin. Vivamus nulla massa, hendrerit sit amet nibh quis, porttitor convallis nisi. ',\n    missionPDF: 'www.google.com',\n    questions: mockClosedAssessmentQuestions,\n    title: 'A Closed Mission'\n  },\n  {\n    type: 'Quests',\n    id: 5,\n    longSummary:\n      'This is the closed sidequest briefing. The save button should not exist. This is a placeholder sidequest for testing rendering of grading statuses.',\n    missionPDF: 'www.google.com',\n    questions: mockClosedAssessmentQuestions,\n    title: 'A Closed Sidequest'\n  },\n  {\n    type: 'Paths',\n    id: 6,\n    longSummary: `### Basic logic gates\n  \n  This path is intended to demonstrate concepts from the lecture **Logic Circuits**. You are strongly encouraged to attempt this path to check your understanding, prior to the next Studio session. For this, you will be granted a small amount of XP!\n  \n  The path comprises 4 questions and is fully autograded and guided, and there are **no private test cases** - there will be no manual review by default. Please consult your Avenger if you require assistance!</TEXT>`,\n    missionPDF: 'www.google.com',\n    questions: mockPathQuestions,\n    title: 'A sample guided path'\n  },\n  // mock assessment used for testing contest voting assessments\n  {\n    type: 'Others',\n    id: 7,\n    title: 'A sample contest voting assessment',\n    longSummary: 'Vote for your favourite contest entries here!',\n    missionPDF: 'www.google.com',\n    questions: mockContestEntryQuestion\n  }\n];\n","import { Chapter, Variant } from 'c-slang/dist/types';\n\nimport { GameState, Role } from '../application/ApplicationTypes';\nimport {\n  AdminPanelCourseRegistration,\n  CourseConfiguration,\n  CourseRegistration,\n  User\n} from '../application/types/SessionTypes';\nimport { Notification, NotificationTypes } from '../notificationBadge/NotificationBadgeTypes';\n\n/**\n * Mock for fetching a role, given an access token. A null\n * value is returned for invalid tokens. Fetching a particular\n * role can be simluated using an optional paramter.\n *\n * @param accessToken a valid access token for the cadet backend.\n * @param mockRole a role to mock retrieval for.\n */\nexport const mockFetchRole = (accessToken: string, role: Role = Role.Staff): Role | null => {\n  return role;\n};\n\n/**\n * Represents the information for a student.\n * TODO move this to a separate file once API specs are confirmed.\n */\nexport type StudentInfo = {\n  id: number;\n  totalXP: number;\n};\n\nconst mockStudentInfo = [\n  {\n    id: 0,\n    totalXP: 69\n  },\n  {\n    id: 1,\n    totalXP: 1000\n  }\n];\n\nexport const mockUser: User = {\n  userId: 123,\n  name: 'DevAdmin',\n  courses: [\n    {\n      courseId: 1,\n      courseName: `CS1101S Programming Methodology (AY20/21 Sem 1)`,\n      courseShortName: `CS1101S`,\n      role: Role.Admin,\n      viewable: true\n    },\n    {\n      courseId: 2,\n      courseName: `CS2040S Data Structures and Algorithms (AY20/21 Sem 2)`,\n      courseShortName: `CS2040S`,\n      role: Role.Admin,\n      viewable: false\n    },\n    {\n      courseId: 3,\n      courseName: `CS2030S Programming Methodology II (AY21/22 Sem 1)`,\n      courseShortName: `CS2030S`,\n      role: Role.Staff,\n      viewable: false\n    }\n  ]\n};\n\nexport const mockCourseRegistrations: CourseRegistration[] = [\n  {\n    courseRegId: 1,\n    role: Role.Admin,\n    group: '1F',\n    gameState: {} as GameState,\n    courseId: 1,\n    xp: 0,\n    story: {\n      story: 'mission-1',\n      playStory: true\n    },\n    agreedToResearch: true\n  },\n  {\n    courseRegId: 2,\n    role: Role.Student,\n    group: '1F',\n    gameState: {} as GameState,\n    courseId: 2,\n    xp: 0,\n    story: {\n      story: 'mission-1',\n      playStory: true\n    },\n    agreedToResearch: true\n  }\n];\n\nexport const mockAdminPanelCourseRegistrations: AdminPanelCourseRegistration[] = [\n  {\n    courseRegId: 1,\n    courseId: 1,\n    name: 'DevAdmin',\n    username: 'test/admin',\n    role: Role.Admin\n  },\n  {\n    courseRegId: 3,\n    courseId: 1,\n    name: 'Dummy student',\n    username: 'test/student',\n    role: Role.Student\n  },\n  {\n    courseRegId: 4,\n    courseId: 1,\n    name: 'Dummy staff',\n    username: 'test/staff',\n    role: Role.Staff\n  }\n];\n\nexport const mockCourseConfigurations: CourseConfiguration[] = [\n  {\n    courseName: `CS1101S Programming Methodology (AY20/21 Sem 1)`,\n    courseShortName: `CS1101S`,\n    viewable: true,\n    enableGame: false,\n    enableAchievements: true,\n    enableSourcecast: true,\n    sourceChapter: Chapter.CALC,\n    sourceVariant: Variant.DEFAULT,\n    moduleHelpText: '',\n    assetsPrefix: ''\n  },\n  {\n    courseName: `CS2040S Data Structures and Algorithms (AY20/21 Sem 2)`,\n    courseShortName: `CS2040S`,\n    viewable: true,\n    enableGame: false,\n    enableAchievements: false,\n    enableSourcecast: false,\n    sourceChapter: Chapter.CALC,\n    sourceVariant: Variant.DEFAULT,\n    moduleHelpText: 'Help Text!',\n    assetsPrefix: ''\n  }\n];\n\n/**\n * Mock for fetching a trainer/admin's student information. A null value\n * is returned for invalid token or role.\n *\n * @param accessToken a valid access token for the cadet backend.\n */\nexport const mockFetchStudentInfo = (accessToken: string): StudentInfo[] | null => {\n  // mocks backend role fetching\n  const permittedRoles: Role[] = [Role.Admin, Role.Staff];\n  const role: Role | null = mockFetchRole(accessToken);\n  if (role === null || !permittedRoles.includes(role)) {\n    return null;\n  } else {\n    return mockStudentInfo;\n  }\n};\n\nexport const mockNotifications: Notification[] = [\n  {\n    id: 1,\n    type: NotificationTypes.deadline,\n    assessment_id: 3,\n    assessment_type: 'Quests',\n    assessment_title: 'The Secret to Streams'\n  },\n  {\n    id: 2,\n    type: NotificationTypes.autograded,\n    assessment_id: 4,\n    assessment_type: 'Missions',\n    assessment_title: 'A Closed Mission'\n  },\n  {\n    id: 3,\n    type: NotificationTypes.graded,\n    assessment_id: 4,\n    assessment_type: 'Missions',\n    assessment_title: 'A Closed Mission'\n  },\n  {\n    id: 4,\n    type: NotificationTypes.new,\n    assessment_id: 6,\n    assessment_type: 'Paths',\n    assessment_title: 'Basic Logic'\n  },\n  {\n    id: 5,\n    type: NotificationTypes.new,\n    assessment_id: 7,\n    assessment_type: 'Missions',\n    assessment_title: 'Symphony of the Winds'\n  },\n  {\n    id: 6,\n    type: NotificationTypes.submitted,\n    submission_id: 1,\n    assessment_type: 'Missions',\n    assessment_title: 'Mission 0'\n  },\n  {\n    id: 7,\n    type: NotificationTypes.submitted,\n    submission_id: 2,\n    assessment_type: 'Missions',\n    assessment_title: 'Mission 1'\n  },\n  {\n    id: 8,\n    type: NotificationTypes.submitted,\n    submission_id: 3,\n    assessment_type: 'Missions',\n    assessment_title: 'Mission 0'\n  }\n];\n","import { GradingSummary } from '../../features/dashboard/DashboardTypes';\nimport { Grading, GradingOverview } from '../../features/grading/GradingTypes';\nimport { Role } from '../application/ApplicationTypes';\nimport { Testcase, TestcaseTypes } from '../assessment/AssessmentTypes';\nimport { mockLibrary } from './AssessmentMocks';\nimport { mockFetchRole } from './UserMocks';\n\nexport const mockGradingOverviews: GradingOverview[] = [\n  {\n    xpAdjustment: 0,\n    assessmentType: 'Missions',\n    assessmentId: 0,\n    assessmentName: 'Mission 0 ',\n    currentXp: 69,\n    xpBonus: 10,\n    initialXp: 69,\n    maxXp: 100,\n    studentId: 0,\n    studentName: 'Al Gorithm',\n    submissionId: 1,\n    submissionStatus: 'submitted',\n    groupName: '1D',\n    gradingStatus: 'graded',\n    questionCount: 6,\n    gradedCount: 6\n  },\n  {\n    xpAdjustment: -2,\n    assessmentType: 'Missions',\n    assessmentId: 1,\n    assessmentName: 'Mission 1',\n    currentXp: -2,\n    xpBonus: 12,\n    initialXp: 0,\n    maxXp: 400,\n    studentId: 0,\n    studentName: 'Dee Sign',\n    submissionId: 2,\n    submissionStatus: 'submitted',\n    groupName: '1F',\n    gradingStatus: 'grading',\n    questionCount: 6,\n    gradedCount: 2\n  },\n  {\n    xpAdjustment: 4,\n    assessmentType: 'Missions',\n    assessmentId: 0,\n    assessmentName: 'Mission 0',\n    currentXp: 1000,\n    xpBonus: 12,\n    initialXp: 996,\n    maxXp: 1000,\n    studentId: 1,\n    studentName: 'May Trix',\n    submissionId: 3,\n    submissionStatus: 'submitted',\n    groupName: '1F',\n    gradingStatus: 'none',\n    questionCount: 6,\n    gradedCount: 0\n  }\n];\n\n/**\n * Mock for fetching a trainer/admin's student grading information.\n * A null value is returned for invalid token or role.\n *\n * @param accessToken a valid access token for the cadet backend.\n * @param group a boolean if true, only fetches submissions from the grader's group\n */\nexport const mockFetchGradingOverview = (\n  accessToken: string,\n  group: boolean\n): GradingOverview[] | null => {\n  // mocks backend role fetching\n  const permittedRoles: Role[] = [Role.Admin, Role.Staff];\n  const role: Role | null = mockFetchRole(accessToken);\n  if (role === null || !permittedRoles.includes(role)) {\n    return null;\n  } else {\n    return group\n      ? [mockGradingOverviews[0]]\n      : mockGradingOverviews.sort((subX: GradingOverview, subY: GradingOverview) =>\n          subX.assessmentId !== subY.assessmentId\n            ? subY.assessmentId - subX.assessmentId\n            : subY.submissionId - subX.submissionId\n        );\n  }\n};\n\nexport const mockTestcases: Testcase[] = [\n  { type: TestcaseTypes.public, program: `remainder(12, 7);`, score: 1, answer: `5` },\n  { type: TestcaseTypes.public, program: `remainder(6, 1);`, score: 2, answer: `0` },\n  { type: TestcaseTypes.opaque, program: `remainder(-15, 6);`, score: 2, answer: `-3` },\n  { type: TestcaseTypes.opaque, program: `remainder(17, 23) === 17;`, score: 2, answer: `true` }\n];\n\nexport const mockGrading: Grading = [\n  {\n    question: {\n      answer: `function remainder(n, d) {\n  return (n - d) < 0 ? n : remainder(n - d, d);\n}`,\n      content: `\nHello and welcome to this assessment! This is the *0th question*.\n\n\\`\\`\\`\n>>> import this\n\\`\\`\\`\n`,\n      prepend: '// THIS IS A PREPEND',\n      postpend: '// THIS IS A POSTPEND',\n      testcases: mockTestcases,\n      id: 0,\n      library: mockLibrary,\n      solutionTemplate: '0th question mock solution template',\n      solution: `This is how the 0th question is solved. [7 points]\n\nfunction remainder(n, d) {\n  return n % d;\n}`,\n      type: 'programming',\n      maxXp: 1000,\n      grader: {\n        name: 'avenger',\n        id: 1\n      },\n      gradedAt: '2038-06-18T05:24:26.026Z',\n      xp: 1,\n      autogradingResults: [\n        {\n          resultType: 'pass'\n        },\n        {\n          resultType: 'fail',\n          expected: '8',\n          actual: '5'\n        },\n        {\n          resultType: 'error',\n          errors: [\n            {\n              errorType: 'dummyErrorType'\n            }\n          ]\n        },\n        {\n          resultType: 'error',\n          errors: [\n            {\n              errorType: 'systemError',\n              errorMessage: \"Cannot read property 'getUniformLocation' of null\"\n            }\n          ]\n        },\n        {\n          resultType: 'error',\n          errors: [\n            {\n              errorType: 'timeout'\n            },\n            {\n              errorType: 'syntax',\n              line: 2,\n              location: 'student',\n              errorLine: 'return (n - d) < 0 ? n : remainder(n - d, d)',\n              errorExplanation: 'Missing semicolon at the end of statement'\n            }\n          ]\n        }\n      ],\n      blocking: false\n    },\n    grade: {\n      xpAdjustment: 0,\n      xp: 0,\n      comments: `Good job. You are awarded the full marks!\n\n----\n## markdown test\n\n# header\n\n**bold**\n\n_italics_\n\n* list\n\n1. numbered list\n\n- [] checkboxes\n\n> quote\n\n    code\n\n[link to Source Academy](https://sourceacademy.nus.edu.sg)\n\n![](image-url-goes-here)\n      `,\n      grader: {\n        name: 'HARTIN MENZ',\n        id: 100\n      },\n      gradedAt: '2019-08-16T13:26:32+00:00'\n    },\n    student: {\n      name: 'Al Gorithm',\n      id: 0\n    }\n  },\n  {\n    question: {\n      prepend: '',\n      postpend: '',\n      testcases: [],\n      answer: \"This student's answer to the 1st question\",\n      content: 'Hello and welcome to this assessment! This is the 1st question.',\n      id: 1,\n      library: mockLibrary,\n      solutionTemplate: '1st question mock solution template',\n      solution: null,\n      type: 'programming',\n      maxXp: 200,\n      grader: {\n        name: 'avenger',\n        id: 1\n      },\n      gradedAt: '2038-06-18T05:24:26.026Z',\n      xp: 1,\n      autogradingResults: [\n        {\n          resultType: 'pass'\n        },\n        {\n          resultType: 'fail',\n          expected: '8',\n          actual: '5'\n        },\n        {\n          resultType: 'error',\n          errors: [\n            {\n              errorType: 'timeout'\n            },\n            {\n              errorType: 'syntax',\n              line: 1,\n              location: 'student',\n              errorLine: 'function fibonacci(n) {',\n              errorExplanation: 'Just kidding!'\n            }\n          ]\n        }\n      ],\n      blocking: false\n    },\n    grade: {\n      xpAdjustment: 0,\n      xp: 100,\n      comments: `You open the Report Card, not knowing what to expect...\n\n## WOW!\nAmazing grasp of runes. We can now move on to the next assignment.\n\n<br/>\n\nRobot Dog: \\`woof\\`\n\nYou look at the display of the robot dog.\n\n    FEED ME\n1. Bread\n2. Water\n\n<br/>\n\n* I am hungry.\n* I am thirsty.\n\n<br/>\n<br/>\n\nNew message from **Avenger**!\n\n> _Cadet, please meet me at Level X-05, outside the pod bay doors. There is an important mission awaiting us._\n\n> _May the [Source](https://sourceacademy.nus.edu.sg) be with you._\n\n> Best regards, Avocado A. Avenger\n\n#### Upcoming Tasks\n- [] Meet Avenger Avenger at Level X-05\n- [] Open the Pod Bay Doors\n      `\n    },\n    student: {\n      name: 'Al Gorithm',\n      id: 0\n    }\n  },\n  {\n    question: {\n      // C is the answer\n      prepend: '',\n      postpend: '',\n      testcases: [],\n      answer: 3,\n      solution: 2,\n      content:\n        'Hello and welcome to this assessment! This is the 2nd question. Oddly enough, it is an MCQ question!',\n      choices: [\n        {\n          content: 'A',\n          hint: 'hint A'\n        },\n        {\n          content: 'B',\n          hint: 'hint B'\n        },\n        {\n          content: 'C',\n          hint: 'hint C'\n        },\n        {\n          content: 'D',\n          hint: 'hint D'\n        }\n      ],\n      id: 2,\n      library: mockLibrary,\n      type: 'mcq',\n      maxXp: 100,\n      grader: {\n        name: 'avenger',\n        id: 1\n      },\n      gradedAt: '2038-06-18T05:24:26.026Z',\n      xp: 1,\n      autogradingResults: [\n        {\n          resultType: 'pass'\n        },\n        {\n          resultType: 'fail',\n          expected: '8',\n          actual: '5'\n        },\n        {\n          resultType: 'error',\n          errors: [\n            {\n              errorType: 'timeout'\n            },\n            {\n              errorType: 'syntax',\n              line: 1,\n              location: 'student',\n              errorLine: 'function fibonacci(n) {',\n              errorExplanation: 'Just kidding!'\n            }\n          ]\n        }\n      ],\n      blocking: false\n    },\n    grade: {\n      xpAdjustment: 0,\n      xp: 50\n    },\n    student: {\n      name: 'Al Gorithm',\n      id: 0\n    }\n  }\n];\n\n/**\n * Mock for fetching a trainer/admin's student grading information.\n * A null value is returned for invalid token or role.\n *\n * @param accessToken a valid access token for the cadet backend.\n */\nexport const mockFetchGrading = (accessToken: string, submissionId: number): Grading | null => {\n  // mocks backend role fetching\n  const permittedRoles: Role[] = [Role.Admin, Role.Staff];\n  const role: Role | null = mockFetchRole(accessToken);\n  if (role === null || !permittedRoles.includes(role)) {\n    return null;\n  } else {\n    return mockGrading;\n  }\n};\n\nexport const mockGradingSummary: GradingSummary = {\n  cols: [\n    'group',\n    'avenger',\n    'ungradedMissions',\n    'submittedMissions',\n    'ungradedQuests',\n    'submittedQuests'\n  ],\n  rows: [\n    {\n      group: 'Mock Group 1',\n      avenger: 'John',\n      ungradedMissions: 123,\n      submittedMissions: 200,\n      ungradedQuests: 100,\n      submittedQuests: 117\n    },\n    {\n      group: 'Mock Group 2',\n      avenger: 'Molly',\n      ungradedMissions: 1232,\n      submittedMissions: 205430,\n      ungradedQuests: 345,\n      submittedQuests: 11547\n    },\n    {\n      group: 'Mock Group 3',\n      avenger: 'Lenny',\n      ungradedMissions: 1532,\n      submittedMissions: 22200,\n      ungradedQuests: 134500,\n      submittedQuests: 6777\n    }\n  ]\n};\n","import { SagaIterator } from 'redux-saga';\nimport { call, put, select, takeEvery } from 'redux-saga/effects';\n\nimport { FETCH_GROUP_GRADING_SUMMARY } from '../../features/dashboard/DashboardTypes';\nimport { Grading, GradingOverview, GradingQuestion } from '../../features/grading/GradingTypes';\nimport {\n  OverallState,\n  Role,\n  SALanguage,\n  styliseSublanguage\n} from '../application/ApplicationTypes';\nimport {\n  ACKNOWLEDGE_NOTIFICATIONS,\n  AdminPanelCourseRegistration,\n  FETCH_ADMIN_PANEL_COURSE_REGISTRATIONS,\n  FETCH_ASSESSMENT,\n  FETCH_AUTH,\n  FETCH_COURSE_CONFIG,\n  FETCH_GRADING,\n  FETCH_GRADING_OVERVIEWS,\n  FETCH_NOTIFICATIONS,\n  FETCH_USER_AND_COURSE,\n  SUBMIT_ANSWER,\n  SUBMIT_GRADING,\n  SUBMIT_GRADING_AND_CONTINUE,\n  Tokens,\n  UNSUBMIT_SUBMISSION,\n  UPDATE_ASSESSMENT_CONFIGS,\n  UPDATE_COURSE_CONFIG,\n  UPDATE_LATEST_VIEWED_COURSE\n} from '../application/types/SessionTypes';\nimport {\n  AssessmentOverview,\n  AssessmentStatuses,\n  FETCH_ASSESSMENT_OVERVIEWS,\n  Question,\n  SUBMIT_ASSESSMENT\n} from '../assessment/AssessmentTypes';\nimport {\n  Notification,\n  NotificationFilterFunction\n} from '../notificationBadge/NotificationBadgeTypes';\nimport { actions } from '../utils/ActionsHelper';\nimport { history } from '../utils/HistoryHelper';\nimport { showSuccessMessage, showWarningMessage } from '../utils/NotificationsHelper';\nimport { WorkspaceLocation } from '../workspace/WorkspaceTypes';\nimport {\n  mockAssessmentConfigurations,\n  mockAssessmentOverviews,\n  mockAssessments\n} from './AssessmentMocks';\nimport { mockFetchGrading, mockFetchGradingOverview, mockGradingSummary } from './GradingMocks';\nimport {\n  mockAdminPanelCourseRegistrations,\n  mockCourseConfigurations,\n  mockCourseRegistrations,\n  mockNotifications,\n  mockUser\n} from './UserMocks';\n\nexport function* mockBackendSaga(): SagaIterator {\n  yield takeEvery(FETCH_AUTH, function* (action: ReturnType<typeof actions.fetchAuth>) {\n    const tokens: Tokens = {\n      accessToken: 'accessToken',\n      refreshToken: 'refreshToken'\n    };\n\n    yield put(actions.setTokens(tokens));\n    yield mockGetUserAndCourse();\n    const courseId: number = yield select((state: OverallState) => state.session.courseId!);\n    yield history.push(`/courses/${courseId}`);\n  });\n\n  const mockGetUserAndCourse = function* () {\n    const user = { ...mockUser };\n    const courseRegistration = { ...mockCourseRegistrations[0] };\n    const courseConfiguration = { ...mockCourseConfigurations[0] };\n    const assessmentConfigurations = [...mockAssessmentConfigurations[0]];\n    const sublanguage: SALanguage = {\n      chapter: courseConfiguration.sourceChapter,\n      variant: courseConfiguration.sourceVariant,\n      displayName: styliseSublanguage(\n        courseConfiguration.sourceChapter,\n        courseConfiguration.sourceVariant\n      )\n    };\n\n    yield put(actions.setUser(user));\n    yield put(actions.setCourseRegistration(courseRegistration));\n    yield put(actions.setCourseConfiguration(courseConfiguration));\n    yield put(actions.setAssessmentConfigurations(assessmentConfigurations));\n    yield put(actions.updateSublanguage(sublanguage));\n  };\n\n  yield takeEvery(FETCH_USER_AND_COURSE, mockGetUserAndCourse);\n\n  yield takeEvery(FETCH_COURSE_CONFIG, function* () {\n    const courseConfiguration = { ...mockCourseConfigurations[0] };\n    yield put(actions.setCourseConfiguration(courseConfiguration));\n  });\n\n  yield takeEvery(FETCH_ASSESSMENT_OVERVIEWS, function* () {\n    yield put(actions.updateAssessmentOverviews([...mockAssessmentOverviews]));\n  });\n\n  yield takeEvery(FETCH_ASSESSMENT, function* (action: ReturnType<typeof actions.fetchAssessment>) {\n    const id = action.payload;\n    const assessment = mockAssessments[id - 1];\n    yield put(actions.updateAssessment({ ...assessment }));\n  });\n\n  yield takeEvery(SUBMIT_ANSWER, function* (action: ReturnType<typeof actions.submitAnswer>): any {\n    const questionId = action.payload.id;\n    const answer = action.payload.answer;\n    // Now, update the answer for the question in the assessment in the store\n    const assessmentId = yield select(\n      (state: OverallState) => state.workspaces.assessment.currentAssessment!\n    );\n    const assessment = yield select((state: OverallState) =>\n      state.session.assessments.get(assessmentId)\n    );\n    const newQuestions = assessment.questions.slice().map((question: Question) => {\n      if (question.id === questionId) {\n        question.answer = answer;\n      }\n      return question;\n    });\n    const newAssessment = {\n      ...assessment,\n      questions: newQuestions\n    };\n    yield put(actions.updateAssessment(newAssessment));\n    yield call(showSuccessMessage, 'Saved!', 1000);\n    return yield put(actions.updateHasUnsavedChanges('assessment' as WorkspaceLocation, false));\n  });\n\n  yield takeEvery(\n    SUBMIT_ASSESSMENT,\n    function* (action: ReturnType<typeof actions.submitAssessment>): any {\n      const assessmentId = action.payload;\n\n      // Update the status of the assessment overview in the store\n      const overviews: AssessmentOverview[] = yield select(\n        (state: OverallState) => state.session.assessmentOverviews\n      );\n      const newOverviews = overviews.map(overview => {\n        if (overview.id === assessmentId) {\n          return { ...overview, status: AssessmentStatuses.submitted };\n        }\n        return overview;\n      });\n\n      yield call(showSuccessMessage, 'Submitted!', 2000);\n      return yield put(actions.updateAssessmentOverviews(newOverviews));\n    }\n  );\n\n  yield takeEvery(\n    FETCH_GRADING_OVERVIEWS,\n    function* (action: ReturnType<typeof actions.fetchGradingOverviews>): any {\n      const accessToken = yield select((state: OverallState) => state.session.accessToken);\n      const filterToGroup = action.payload;\n      const gradingOverviews = yield call(() =>\n        mockFetchGradingOverview(accessToken, filterToGroup)\n      );\n      if (gradingOverviews !== null) {\n        yield put(actions.updateGradingOverviews([...gradingOverviews]));\n      }\n    }\n  );\n\n  yield takeEvery(FETCH_GRADING, function* (action: ReturnType<typeof actions.fetchGrading>): any {\n    const submissionId = action.payload;\n    const accessToken = yield select((state: OverallState) => state.session.accessToken);\n    const grading = yield call(() => mockFetchGrading(accessToken, submissionId));\n    if (grading !== null) {\n      yield put(actions.updateGrading(submissionId, [...grading]));\n    }\n  });\n\n  yield takeEvery(\n    UNSUBMIT_SUBMISSION,\n    function* (action: ReturnType<typeof actions.unsubmitSubmission>) {\n      const { submissionId } = action.payload;\n      const overviews: GradingOverview[] = yield select(\n        (state: OverallState) => state.session.gradingOverviews || []\n      );\n      const index = overviews.findIndex(\n        overview =>\n          overview.submissionId === submissionId && overview.submissionStatus === 'submitted'\n      );\n      if (index === -1) {\n        yield call(showWarningMessage, '400: Bad Request');\n        return;\n      }\n      const newOverviews = (overviews as GradingOverview[]).map(overview => {\n        if (overview.submissionId === submissionId) {\n          return { ...overview, submissionStatus: 'attempted' };\n        }\n        return overview;\n      });\n      yield call(showSuccessMessage, 'Unsubmit successful!', 1000);\n      yield put(actions.updateGradingOverviews(newOverviews));\n    }\n  );\n\n  const sendGrade = function* (\n    action: ReturnType<typeof actions.submitGrading | typeof actions.submitGradingAndContinue>\n  ): any {\n    const role: Role = yield select((state: OverallState) => state.session.role!);\n    if (role === Role.Student) {\n      return yield call(showWarningMessage, 'Only staff can submit answers.');\n    }\n\n    const { submissionId, questionId, xpAdjustment, comments } = action.payload;\n    // Now, update the grade for the question in the Grading in the store\n    const grading: Grading = yield select((state: OverallState) =>\n      state.session.gradings.get(submissionId)\n    );\n    const newGrading = grading.slice().map((gradingQuestion: GradingQuestion) => {\n      if (gradingQuestion.question.id === questionId) {\n        gradingQuestion.grade = {\n          xpAdjustment,\n          xp: gradingQuestion.grade.xp,\n          comments\n        };\n      }\n      return gradingQuestion;\n    });\n    yield put(actions.updateGrading(submissionId, newGrading));\n    yield call(showSuccessMessage, 'Submitted!', 1000);\n  };\n\n  const sendGradeAndContinue = function* (\n    action: ReturnType<typeof actions.submitGradingAndContinue>\n  ): any {\n    const { submissionId } = action.payload;\n    yield* sendGrade(action);\n\n    const [currentQuestion, courseId] = yield select((state: OverallState) => [\n      state.workspaces.grading.currentQuestion,\n      state.session.courseId!\n    ]);\n    /**\n     * Move to next question for grading: this only works because the\n     * SUBMIT_GRADING_AND_CONTINUE Redux action is currently only\n     * used in the Grading Workspace\n     *\n     * If the questionId is out of bounds, the componentDidUpdate callback of\n     * GradingWorkspace will cause a redirect back to '/courses/${courseId}/grading'\n     */\n    yield history.push(\n      `/courses/${courseId}/grading/${submissionId}/${(currentQuestion || 0) + 1}`\n    );\n  };\n\n  yield takeEvery(SUBMIT_GRADING, sendGrade);\n\n  yield takeEvery(SUBMIT_GRADING_AND_CONTINUE, sendGradeAndContinue);\n\n  yield takeEvery(\n    FETCH_NOTIFICATIONS,\n    function* (action: ReturnType<typeof actions.fetchNotifications>) {\n      yield put(actions.updateNotifications([...mockNotifications]));\n    }\n  );\n\n  yield takeEvery(\n    ACKNOWLEDGE_NOTIFICATIONS,\n    function* (action: ReturnType<typeof actions.acknowledgeNotifications>) {\n      const notificationFilter: NotificationFilterFunction | undefined = action.payload.withFilter;\n\n      const notifications: Notification[] = yield select(\n        (state: OverallState) => state.session.notifications\n      );\n\n      let notificationsToAcknowledge = notifications;\n\n      if (notificationFilter) {\n        notificationsToAcknowledge = notificationFilter(notifications);\n      }\n\n      if (notificationsToAcknowledge.length === 0) {\n        return;\n      }\n\n      const ids = notificationsToAcknowledge.map(n => n.id);\n\n      const newNotifications: Notification[] = notifications.filter(\n        notification => !ids.includes(notification.id)\n      );\n\n      yield put(actions.updateNotifications(newNotifications));\n    }\n  );\n\n  yield takeEvery(\n    UPDATE_LATEST_VIEWED_COURSE,\n    function* (action: ReturnType<typeof actions.updateLatestViewedCourse>) {\n      const { courseId } = action.payload;\n      const idx = courseId - 1; // zero-indexed\n\n      const courseConfiguration = { ...mockCourseConfigurations[idx] };\n      yield put(actions.setCourseConfiguration(courseConfiguration));\n      yield put(actions.setAssessmentConfigurations([...mockAssessmentConfigurations[idx]]));\n      yield put(actions.setCourseRegistration({ ...mockCourseRegistrations[idx] }));\n      yield put(\n        actions.updateSublanguage({\n          chapter: courseConfiguration.sourceChapter,\n          variant: courseConfiguration.sourceVariant,\n          displayName: styliseSublanguage(\n            courseConfiguration.sourceChapter,\n            courseConfiguration.sourceVariant\n          )\n        })\n      );\n      yield call(showSuccessMessage, `Switched to ${courseConfiguration.courseName}!`, 5000);\n    }\n  );\n\n  yield takeEvery(\n    UPDATE_COURSE_CONFIG,\n    function* (action: ReturnType<typeof actions.updateCourseConfig>) {\n      const courseConfig = action.payload;\n\n      yield put(actions.setCourseConfiguration(courseConfig));\n      yield call(showSuccessMessage, 'Updated successfully!', 1000);\n    }\n  );\n\n  yield takeEvery(\n    UPDATE_ASSESSMENT_CONFIGS,\n    function* (action: ReturnType<typeof actions.updateAssessmentConfigs>): any {\n      const assessmentConfig = action.payload;\n\n      yield put(actions.setAssessmentConfigurations(assessmentConfig));\n      yield call(showSuccessMessage, 'Updated successfully!', 1000);\n    }\n  );\n\n  yield takeEvery(\n    FETCH_ADMIN_PANEL_COURSE_REGISTRATIONS,\n    function* (action: ReturnType<typeof actions.fetchAdminPanelCourseRegistrations>) {\n      const courseRegistrations: AdminPanelCourseRegistration[] = [\n        ...mockAdminPanelCourseRegistrations\n      ];\n      yield put(actions.setAdminPanelCourseRegistrations(courseRegistrations));\n    }\n  );\n\n  yield takeEvery(FETCH_GROUP_GRADING_SUMMARY, function* () {\n    yield put(actions.updateGroupGradingSummary({ ...mockGradingSummary }));\n  });\n}\n","import {\n  AchievementGoal,\n  AchievementItem,\n  EventMeta,\n  EventType,\n  GoalProgress,\n  GoalType\n} from '../../../features/achievement/AchievementTypes';\nimport { showSuccessMessage } from '../../utils/NotificationsHelper';\nimport AchievementInferencer from './AchievementInferencer';\nimport { isExpired, isReleased, isWithinTimeRange } from './DateHelper';\n\nfunction eventShouldCount(meta: EventMeta): boolean {\n  // goal is not released, or has expired\n  if (isExpired(meta.deadline) || !isReleased(meta.release)) {\n    return false;\n  }\n  if (isWithinTimeRange(meta.observeFrom, meta.observeTo)) {\n    return true;\n  }\n  return false;\n}\n\nexport function incrementCount(goalUuid: string, inferencer: AchievementInferencer) {\n  const progress: GoalProgress = { ...inferencer.getGoalProgress(goalUuid) };\n  progress.count = progress.count + 1;\n  const wasCompleted = progress.completed;\n  progress.completed = progress.count >= progress.targetCount;\n\n  const incompleteAchievements: string[] = [];\n  if (!wasCompleted && progress.completed) {\n    const achievements: string[] = inferencer.getAchievementsByGoal(goalUuid);\n    for (const achievement of achievements) {\n      if (!inferencer.isCompleted(inferencer.getAchievement(achievement))) {\n        incompleteAchievements.push(achievement);\n      }\n    }\n  }\n\n  inferencer.modifyGoalProgress(progress);\n\n  for (const achievementUuid of incompleteAchievements) {\n    const achievement: AchievementItem = inferencer.getAchievement(achievementUuid);\n    if (inferencer.isCompleted(achievement)) {\n      showSuccessMessage('Completed acheivement: ' + achievement.title);\n    }\n  }\n}\n\nexport function goalIncludesEvents(goal: AchievementGoal, eventNames: EventType[]) {\n  if (goal.meta.type === GoalType.EVENT && eventShouldCount(goal.meta)) {\n    for (let i = 0; i < goal.meta.eventNames.length; i++) {\n      for (let j = 0; j < eventNames.length; j++) {\n        if (goal.meta.eventNames[i] === eventNames[j]) {\n          return true;\n        }\n      }\n    }\n  }\n  return false;\n}\n","import { ActionMatchingPattern } from '@redux-saga/types';\nimport * as Sentry from '@sentry/browser';\nimport {\n  ActionPattern,\n  ForkEffect,\n  HelperWorkerParameters,\n  takeEvery,\n  takeLatest,\n  takeLeading\n} from 'redux-saga/effects';\n\n// it's not possible to abstract the two functions into HOF over takeEvery and takeLatest\n// without stepping out of TypeScript's type system because the type system does not support\n// higher-kinded types (type parameters that take )\n\nfunction handleUncaughtError(error: any) {\n  if (process.env.NODE_ENV === 'development') {\n    // react-error-overlay is a \"special\" package that's automatically included\n    // in development mode by CRA\n\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    import('react-error-overlay').then(reo => reo.reportRuntimeError(error));\n  }\n  Sentry.captureException(error);\n  console.error(error);\n}\n\nfunction isIterator(obj: any) {\n  return obj && typeof obj.next === 'function' && typeof obj.throw === 'function';\n}\n\nexport function safeTakeEvery<P extends ActionPattern, A extends ActionMatchingPattern<P>>(\n  pattern: P,\n  worker: (action: A) => any\n): ForkEffect<never>;\nexport function safeTakeEvery<P extends ActionPattern, Fn extends (...args: any[]) => any>(\n  pattern: P,\n  worker: Fn,\n  ...args: HelperWorkerParameters<ActionMatchingPattern<P>, Fn>\n): ForkEffect<never> {\n  function* wrappedWorker(...args: HelperWorkerParameters<ActionMatchingPattern<P>, Fn>) {\n    try {\n      const result = worker(...args);\n      if (isIterator(result)) {\n        yield* result;\n      }\n    } catch (error) {\n      handleUncaughtError(error);\n    }\n  }\n  return takeEvery<P, typeof wrappedWorker>(pattern, wrappedWorker, ...args);\n}\n\nexport function safeTakeLatest<P extends ActionPattern, A extends ActionMatchingPattern<P>>(\n  pattern: P,\n  worker: (action: A) => any\n): ForkEffect<never>;\nexport function safeTakeLatest<P extends ActionPattern, Fn extends (...args: any[]) => any>(\n  pattern: P,\n  worker: Fn,\n  ...args: HelperWorkerParameters<ActionMatchingPattern<P>, Fn>\n): ForkEffect<never> {\n  function* wrappedWorker(...args: HelperWorkerParameters<ActionMatchingPattern<P>, Fn>) {\n    try {\n      const result = worker(...args);\n      if (isIterator(result)) {\n        yield* result;\n      }\n    } catch (error) {\n      handleUncaughtError(error);\n    }\n  }\n  return takeLatest<P, typeof wrappedWorker>(pattern, wrappedWorker, ...args);\n}\n\nexport function safeTakeLeading<P extends ActionPattern, A extends ActionMatchingPattern<P>>(\n  pattern: P,\n  worker: (action: A) => any\n): ForkEffect<never>;\nexport function safeTakeLeading<P extends ActionPattern, Fn extends (...args: any[]) => any>(\n  pattern: P,\n  worker: Fn,\n  ...args: HelperWorkerParameters<ActionMatchingPattern<P>, Fn>\n): ForkEffect<never> {\n  function* wrappedWorker(...args: HelperWorkerParameters<ActionMatchingPattern<P>, Fn>) {\n    try {\n      const result = worker(...args);\n      if (isIterator(result)) {\n        yield* result;\n      }\n    } catch (error) {\n      handleUncaughtError(error);\n    }\n  }\n  return takeLeading<P, typeof wrappedWorker>(pattern, wrappedWorker, ...args);\n}\n","import { SagaIterator } from 'redux-saga';\nimport { call, delay, put, select } from 'redux-saga/effects';\n\nimport {\n  AchievementGoal,\n  ADD_EVENT,\n  BULK_UPDATE_ACHIEVEMENTS,\n  BULK_UPDATE_GOALS,\n  EventType,\n  GET_ACHIEVEMENTS,\n  GET_GOALS,\n  GET_OWN_GOALS,\n  GET_USER_ASSESSMENT_OVERVIEWS,\n  GET_USERS,\n  HANDLE_EVENT,\n  REMOVE_ACHIEVEMENT,\n  REMOVE_GOAL,\n  UPDATE_GOAL_PROGRESS,\n  UPDATE_OWN_GOAL_PROGRESS\n} from '../../features/achievement/AchievementTypes';\nimport { updateGoalProcessed } from '../achievement/AchievementManualEditor';\nimport AchievementInferencer from '../achievement/utils/AchievementInferencer';\nimport { goalIncludesEvents, incrementCount } from '../achievement/utils/EventHandler';\nimport { OverallState } from '../application/ApplicationTypes';\nimport { Tokens } from '../application/types/SessionTypes';\nimport { actions } from '../utils/ActionsHelper';\nimport Constants from '../utils/Constants';\nimport {\n  bulkUpdateAchievements,\n  bulkUpdateGoals,\n  getAchievements,\n  getAllUsers,\n  getGoals,\n  getOwnGoals,\n  getUserAssessmentOverviews,\n  removeAchievement,\n  removeGoal,\n  updateGoalProgress,\n  updateOwnGoalProgress\n} from './RequestsSaga';\nimport { safeTakeEvery as takeEvery } from './SafeEffects';\n\nfunction selectTokens() {\n  return select((state: OverallState) => ({\n    accessToken: state.session.accessToken,\n    refreshToken: state.session.refreshToken\n  }));\n}\n\nexport default function* AchievementSaga(): SagaIterator {\n  yield takeEvery(\n    BULK_UPDATE_ACHIEVEMENTS,\n    function* (action: ReturnType<typeof actions.bulkUpdateAchievements>): any {\n      const tokens: Tokens = yield selectTokens();\n\n      const achievements = action.payload;\n\n      const resp = yield call(bulkUpdateAchievements, achievements, tokens);\n\n      if (!resp) {\n        return;\n      }\n    }\n  );\n\n  yield takeEvery(\n    BULK_UPDATE_GOALS,\n    function* (action: ReturnType<typeof actions.bulkUpdateGoals>): any {\n      const tokens: Tokens = yield selectTokens();\n\n      const goals = action.payload;\n\n      const resp = yield call(bulkUpdateGoals, goals, tokens);\n\n      if (!resp) {\n        return;\n      }\n    }\n  );\n\n  yield takeEvery(GET_ACHIEVEMENTS, function* (): any {\n    const tokens: Tokens = yield selectTokens();\n\n    const achievements = yield call(getAchievements, tokens);\n\n    if (achievements) {\n      yield put(actions.saveAchievements(achievements));\n    }\n  });\n\n  yield takeEvery(GET_GOALS, function* (action: ReturnType<typeof actions.getGoals>): any {\n    const tokens: Tokens = yield selectTokens();\n\n    const studentCourseRegId = action.payload;\n\n    const goals = yield call(getGoals, tokens, studentCourseRegId);\n\n    if (goals) {\n      yield put(actions.saveGoals(goals));\n    }\n  });\n\n  yield takeEvery(GET_OWN_GOALS, function* (action: ReturnType<typeof actions.getOwnGoals>): any {\n    const tokens: Tokens = yield selectTokens();\n\n    const goals = yield call(getOwnGoals, tokens);\n\n    if (goals) {\n      yield put(actions.saveGoals(goals));\n    }\n  });\n\n  yield takeEvery(GET_USERS, function* (action: ReturnType<typeof actions.getUsers>): any {\n    const tokens: Tokens = yield selectTokens();\n\n    const users = yield call(getAllUsers, tokens);\n\n    if (users) {\n      yield put(actions.saveUsers(users));\n    }\n  });\n\n  yield takeEvery(\n    REMOVE_ACHIEVEMENT,\n    function* (action: ReturnType<typeof actions.removeAchievement>): any {\n      const tokens: Tokens = yield selectTokens();\n\n      const achievement = action.payload;\n\n      const resp = yield call(removeAchievement, achievement, tokens);\n\n      if (!resp) {\n        return;\n      }\n    }\n  );\n\n  yield takeEvery(REMOVE_GOAL, function* (action: ReturnType<typeof actions.removeGoal>): any {\n    const tokens: Tokens = yield selectTokens();\n\n    const definition = action.payload;\n\n    const resp = yield call(removeGoal, definition, tokens);\n\n    if (!resp) {\n      return;\n    }\n  });\n\n  yield takeEvery(\n    UPDATE_OWN_GOAL_PROGRESS,\n    function* (action: ReturnType<typeof actions.updateOwnGoalProgress>): any {\n      const tokens: Tokens = yield selectTokens();\n\n      const progress = action.payload;\n\n      const resp = yield call(updateOwnGoalProgress, progress, tokens);\n\n      if (!resp) {\n        return;\n      }\n    }\n  );\n\n  yield takeEvery(\n    UPDATE_GOAL_PROGRESS,\n    function* (action: ReturnType<typeof actions.updateGoalProgress>): any {\n      const tokens: Tokens = yield selectTokens();\n\n      const { studentCourseRegId, progress } = action.payload;\n\n      const resp = yield call(updateGoalProgress, studentCourseRegId, progress, tokens);\n\n      if (!resp) {\n        return;\n      }\n      if (resp.ok) {\n        yield put(actions.getGoals(studentCourseRegId));\n        updateGoalProcessed();\n      }\n    }\n  );\n\n  let loggedEvents: EventType[][] = [];\n  let timeoutSet: boolean = false;\n  const updateInterval = 3000;\n\n  yield takeEvery(ADD_EVENT, function* (action: ReturnType<typeof actions.addEvent>): any {\n    const role = yield select((state: OverallState) => state.session.role);\n    const enableAchievements = yield select(\n      (state: OverallState) => state.session.enableAchievements\n    );\n    if (role && enableAchievements && !Constants.playgroundOnly) {\n      loggedEvents.push(action.payload);\n\n      if (!timeoutSet && role) {\n        // make sure that only one action every interval will handleEvent\n        timeoutSet = true;\n        yield delay(updateInterval);\n\n        timeoutSet = false;\n        yield put(actions.handleEvent(loggedEvents));\n        loggedEvents = [];\n      }\n    }\n  });\n\n  yield takeEvery(HANDLE_EVENT, function* (action: ReturnType<typeof actions.handleEvent>): any {\n    const tokens: Tokens = yield selectTokens();\n\n    // get the most recent list of achievements\n    const backendAchievements = yield call(getAchievements, tokens);\n    if (backendAchievements) {\n      yield put(actions.saveAchievements(backendAchievements));\n    }\n\n    // get the goals and their progress from the backend\n    const backendGoals = yield call(getOwnGoals, tokens);\n    if (backendGoals) {\n      yield put(actions.saveGoals(backendGoals));\n    } else {\n      // if there are no goals, handling events will do nothing\n      return;\n    }\n\n    const achievements = yield select((state: OverallState) => state.achievement.achievements);\n    const goals = yield select((state: OverallState) => state.achievement.goals);\n\n    const inferencer = new AchievementInferencer(achievements, goals);\n    const loggedEvents: EventType[][] = action.payload;\n\n    const updatedGoals = new Set<string>();\n\n    loggedEvents.forEach((events: EventType[]) => {\n      const eventGoalUuids = goals\n        .filter((goal: AchievementGoal) => goalIncludesEvents(goal, events))\n        .map((goal: AchievementGoal) => goal.uuid);\n      eventGoalUuids.forEach((uuid: string) => {\n        incrementCount(uuid, inferencer);\n        updatedGoals.add(uuid);\n      });\n    });\n\n    for (const uuid of updatedGoals) {\n      const resp = yield call(updateOwnGoalProgress, inferencer.getGoalProgress(uuid), tokens);\n\n      if (!resp) {\n        return;\n      }\n    }\n  });\n\n  yield takeEvery(\n    GET_USER_ASSESSMENT_OVERVIEWS,\n    function* (action: ReturnType<typeof actions.getUserAssessmentOverviews>): any {\n      const tokens: Tokens = yield selectTokens();\n\n      const assessmentOverviews = yield call(getUserAssessmentOverviews, action.payload, tokens);\n\n      if (assessmentOverviews) {\n        yield put(actions.saveUserAssessmentOverviews(assessmentOverviews));\n      }\n    }\n  );\n}\n","import Constants from './Constants';\n\nexport function computeEndpointUrl(providerId: string): string | undefined {\n  const ep = Constants.authProviders.get(providerId);\n  if (!ep) {\n    return undefined;\n  }\n  try {\n    const epUrl = new URL(ep.endpoint);\n    epUrl.searchParams.set('redirect_uri', computeRedirectUri(providerId)!);\n    return epUrl.toString();\n  } catch (e) {\n    // in dev, sometimes the endpoint is a dummy; allow that\n    return ep.endpoint || '';\n  }\n}\n\nexport function computeRedirectUri(providerId: string): string | undefined {\n  const ep = Constants.authProviders.get(providerId);\n  if (!ep) {\n    return undefined;\n  }\n  const port = window.location.port === '' ? '' : `:${window.location.port}`;\n  const callback = `${window.location.protocol}//${window.location.hostname}${port}/login${\n    ep.isDefault ? '' : '?provider=' + encodeURIComponent(providerId)\n  }`;\n  return callback;\n}\n\nexport function getClientId(providerId: string): string | undefined {\n  const ep = Constants.authProviders.get(providerId);\n  if (!ep) {\n    return undefined;\n  }\n  try {\n    const epUrl = new URL(ep.endpoint);\n    return epUrl.searchParams.get('client_id') || undefined;\n  } catch (e) {\n    // in dev, sometimes the endpoint is a dummy; allow that\n    return ep.endpoint || undefined;\n  }\n}\n\nexport function getDefaultProvider():\n  | [string, NonNullable<ReturnType<typeof Constants.authProviders.get>>]\n  | undefined {\n  return [...Constants.authProviders.entries()].find(([_, { isDefault }]) => isDefault);\n}\n","/*eslint no-eval: \"error\"*/\n/*eslint-env browser*/\nimport { SagaIterator } from 'redux-saga';\nimport { call, put, select } from 'redux-saga/effects';\nimport { ADD_NEW_USERS_TO_COURSE, CREATE_COURSE } from 'src/features/academy/AcademyTypes';\nimport { UsernameRoleGroup } from 'src/pages/academy/adminPanel/subcomponents/AddUserPanel';\n\nimport {\n  FETCH_GROUP_GRADING_SUMMARY,\n  GradingSummary\n} from '../../features/dashboard/DashboardTypes';\nimport { Grading, GradingOverview, GradingQuestion } from '../../features/grading/GradingTypes';\nimport {\n  CHANGE_DATE_ASSESSMENT,\n  DELETE_ASSESSMENT,\n  PUBLISH_ASSESSMENT,\n  UPLOAD_ASSESSMENT\n} from '../../features/groundControl/GroundControlTypes';\nimport { FETCH_SOURCECAST_INDEX } from '../../features/sourceRecorder/sourcecast/SourcecastTypes';\nimport {\n  SAVE_SOURCECAST_DATA,\n  SourcecastData\n} from '../../features/sourceRecorder/SourceRecorderTypes';\nimport { DELETE_SOURCECAST_ENTRY } from '../../features/sourceRecorder/sourcereel/SourcereelTypes';\nimport { OverallState, Role } from '../application/ApplicationTypes';\nimport {\n  ACKNOWLEDGE_NOTIFICATIONS,\n  AdminPanelCourseRegistration,\n  CourseConfiguration,\n  CourseRegistration,\n  DELETE_ASSESSMENT_CONFIG,\n  DELETE_USER_COURSE_REGISTRATION,\n  FETCH_ADMIN_PANEL_COURSE_REGISTRATIONS,\n  FETCH_ALL_USER_XP,\n  FETCH_ASSESSMENT,\n  FETCH_ASSESSMENT_ADMIN,\n  FETCH_ASSESSMENT_CONFIGS,\n  FETCH_AUTH,\n  FETCH_COURSE_CONFIG,\n  FETCH_GRADING,\n  FETCH_GRADING_OVERVIEWS,\n  FETCH_NOTIFICATIONS,\n  FETCH_TOTAL_XP,\n  FETCH_TOTAL_XP_ADMIN,\n  FETCH_USER_AND_COURSE,\n  REAUTOGRADE_ANSWER,\n  REAUTOGRADE_SUBMISSION,\n  SUBMIT_ANSWER,\n  SUBMIT_GRADING,\n  SUBMIT_GRADING_AND_CONTINUE,\n  Tokens,\n  UNSUBMIT_SUBMISSION,\n  UPDATE_ASSESSMENT_CONFIGS,\n  UPDATE_COURSE_CONFIG,\n  UPDATE_COURSE_RESEARCH_AGREEMENT,\n  UPDATE_LATEST_VIEWED_COURSE,\n  UPDATE_USER_ROLE,\n  UpdateCourseConfiguration,\n  User\n} from '../application/types/SessionTypes';\nimport {\n  Assessment,\n  AssessmentConfiguration,\n  AssessmentOverview,\n  AssessmentStatuses,\n  FETCH_ASSESSMENT_OVERVIEWS,\n  Question,\n  SUBMIT_ASSESSMENT\n} from '../assessment/AssessmentTypes';\nimport {\n  Notification,\n  NotificationFilterFunction\n} from '../notificationBadge/NotificationBadgeTypes';\nimport { actions } from '../utils/ActionsHelper';\nimport { computeRedirectUri, getClientId, getDefaultProvider } from '../utils/AuthHelper';\nimport { history } from '../utils/HistoryHelper';\nimport { showSuccessMessage, showWarningMessage } from '../utils/NotificationsHelper';\nimport { CHANGE_SUBLANGUAGE, WorkspaceLocation } from '../workspace/WorkspaceTypes';\nimport {\n  deleteAssessment,\n  deleteSourcecastEntry,\n  getAllUserXp,\n  getAssessment,\n  getAssessmentConfigs,\n  getAssessmentOverviews,\n  getCourseConfig,\n  getGrading,\n  getGradingOverviews,\n  getGradingSummary,\n  getLatestCourseRegistrationAndConfiguration,\n  getNotifications,\n  getSourcecastIndex,\n  getTotalXp,\n  getUser,\n  getUserCourseRegistrations,\n  handleResponseError,\n  postAcknowledgeNotifications,\n  postAnswer,\n  postAssessment,\n  postAuth,\n  postCreateCourse,\n  postGrading,\n  postReautogradeAnswer,\n  postReautogradeSubmission,\n  postSourcecast,\n  postUnsubmit,\n  putAssessmentConfigs,\n  putCourseConfig,\n  putCourseResearchAgreement,\n  putLatestViewedCourse,\n  putNewUsers,\n  putUserRole,\n  removeAssessmentConfig,\n  removeUserCourseRegistration,\n  updateAssessment,\n  uploadAssessment\n} from './RequestsSaga';\nimport { safeTakeEvery as takeEvery } from './SafeEffects';\n\nfunction selectTokens() {\n  return select((state: OverallState) => ({\n    accessToken: state.session.accessToken,\n    refreshToken: state.session.refreshToken\n  }));\n}\n\nfunction* BackendSaga(): SagaIterator {\n  yield takeEvery(FETCH_AUTH, function* (action: ReturnType<typeof actions.fetchAuth>): any {\n    const { code, providerId: payloadProviderId } = action.payload;\n\n    const providerId = payloadProviderId || (getDefaultProvider() || [null])[0];\n    if (!providerId) {\n      yield call(\n        showWarningMessage,\n        'Could not log in; invalid provider or no providers configured.'\n      );\n      return yield history.push('/');\n    }\n\n    const clientId = getClientId(providerId);\n    const redirectUrl = computeRedirectUri(providerId);\n\n    const tokens: Tokens | null = yield call(postAuth, code, providerId, clientId, redirectUrl);\n    if (!tokens) {\n      return yield history.push('/');\n    }\n    yield put(actions.setTokens(tokens));\n\n    // Note: courseRegistration, courseConfiguration and assessmentConfigurations\n    // are either all null OR all not null\n    const {\n      user,\n      courseRegistration,\n      courseConfiguration,\n      assessmentConfigurations\n    }: {\n      user: User | null;\n      courseRegistration: CourseRegistration | null;\n      courseConfiguration: CourseConfiguration | null;\n      assessmentConfigurations: AssessmentConfiguration[] | null;\n    } = yield call(getUser, tokens);\n\n    if (!user) {\n      return;\n    }\n\n    yield put(actions.setUser(user));\n\n    // Handle case where user does not have a latest viewed course in the backend\n    // but is enrolled in some course (this happens occationally due to e.g. removal from a course)\n    if (courseConfiguration === null && user.courses.length > 0) {\n      yield put(actions.updateLatestViewedCourse(user.courses[0].courseId));\n    }\n\n    if (courseRegistration && courseConfiguration && assessmentConfigurations) {\n      yield put(actions.setCourseRegistration(courseRegistration));\n      yield put(actions.setCourseConfiguration(courseConfiguration));\n      yield put(actions.setAssessmentConfigurations(assessmentConfigurations));\n      return yield history.push(`/courses/${courseRegistration.courseId}`);\n    }\n\n    return yield history.push(`/welcome`);\n  });\n\n  yield takeEvery(\n    FETCH_USER_AND_COURSE,\n    function* (action: ReturnType<typeof actions.fetchUserAndCourse>): any {\n      const tokens = yield selectTokens();\n\n      const {\n        user,\n        courseRegistration,\n        courseConfiguration,\n        assessmentConfigurations\n      }: {\n        user: User | null;\n        courseRegistration: CourseRegistration | null;\n        courseConfiguration: CourseConfiguration | null;\n        assessmentConfigurations: AssessmentConfiguration[] | null;\n      } = yield call(getUser, tokens);\n\n      if (!user) {\n        return;\n      }\n\n      yield put(actions.setUser(user));\n\n      // Handle case where user does not have a latest viewed course in the backend\n      // but is enrolled in some course (this happens occationally due to e.g. removal from a course)\n      if (courseConfiguration === null && user.courses.length > 0) {\n        yield put(actions.updateLatestViewedCourse(user.courses[0].courseId));\n      }\n\n      if (courseRegistration && courseConfiguration && assessmentConfigurations) {\n        yield put(actions.setCourseRegistration(courseRegistration));\n        yield put(actions.setCourseConfiguration(courseConfiguration));\n        yield put(actions.setAssessmentConfigurations(assessmentConfigurations));\n      }\n    }\n  );\n\n  yield takeEvery(FETCH_COURSE_CONFIG, function* () {\n    const tokens: Tokens = yield selectTokens();\n    const { config }: { config: CourseConfiguration | null } = yield call(getCourseConfig, tokens);\n    if (config) {\n      yield put(actions.setCourseConfiguration(config));\n    }\n  });\n\n  yield takeEvery(FETCH_ASSESSMENT_OVERVIEWS, function* () {\n    const tokens: Tokens = yield selectTokens();\n\n    const assessmentOverviews: AssessmentOverview[] | null = yield call(\n      getAssessmentOverviews,\n      tokens\n    );\n    if (assessmentOverviews) {\n      yield put(actions.updateAssessmentOverviews(assessmentOverviews));\n    }\n  });\n\n  yield takeEvery(FETCH_ALL_USER_XP, function* () {\n    const tokens: Tokens = yield selectTokens();\n\n    const res: { all_users_xp: string[][] } = yield call(getAllUserXp, tokens);\n    if (res) {\n      yield put(actions.updateAllUserXp(res.all_users_xp));\n    }\n  });\n\n  yield takeEvery(FETCH_TOTAL_XP, function* () {\n    const tokens: Tokens = yield selectTokens();\n\n    const res: { totalXp: number } = yield call(getTotalXp, tokens);\n    if (res) {\n      yield put(actions.updateTotalXp(res.totalXp));\n    }\n  });\n\n  yield takeEvery(\n    FETCH_TOTAL_XP_ADMIN,\n    function* (action: ReturnType<typeof actions.fetchTotalXpAdmin>) {\n      const tokens: Tokens = yield selectTokens();\n\n      const courseRegId = action.payload;\n\n      const res: { totalXp: number } = yield call(getTotalXp, tokens, courseRegId);\n      if (res) {\n        yield put(actions.updateTotalXp(res.totalXp));\n      }\n    }\n  );\n\n  yield takeEvery(FETCH_ASSESSMENT, function* (action: ReturnType<typeof actions.fetchAssessment>) {\n    const tokens: Tokens = yield selectTokens();\n\n    const assessmentId = action.payload;\n\n    const assessment: Assessment | null = yield call(getAssessment, assessmentId, tokens);\n    if (assessment) {\n      yield put(actions.updateAssessment(assessment));\n    }\n  });\n\n  yield takeEvery(\n    FETCH_ASSESSMENT_ADMIN,\n    function* (action: ReturnType<typeof actions.fetchAssessmentAdmin>) {\n      const tokens: Tokens = yield selectTokens();\n\n      const { assessmentId, courseRegId } = action.payload;\n\n      const assessment: Assessment | null = yield call(\n        getAssessment,\n        assessmentId,\n        tokens,\n        courseRegId\n      );\n      if (assessment) {\n        yield put(actions.updateAssessment(assessment));\n      }\n    }\n  );\n\n  yield takeEvery(SUBMIT_ANSWER, function* (action: ReturnType<typeof actions.submitAnswer>): any {\n    const tokens: Tokens = yield selectTokens();\n    const questionId = action.payload.id;\n    const answer = action.payload.answer;\n\n    const resp: Response | null = yield call(postAnswer, questionId, answer, tokens);\n    if (!resp || !resp.ok) {\n      return yield handleResponseError(resp);\n    }\n\n    yield call(showSuccessMessage, 'Saved!', 1000);\n\n    // Now, update the answer for the question in the assessment in the store\n    const assessmentId: number = yield select(\n      (state: OverallState) => state.workspaces.assessment.currentAssessment!\n    );\n    const assessment: any = yield select((state: OverallState) =>\n      state.session.assessments.get(assessmentId)\n    );\n    const newQuestions = assessment.questions.slice().map((question: Question) => {\n      if (question.id === questionId) {\n        return { ...question, answer };\n      }\n      return question;\n    });\n    const newAssessment = {\n      ...assessment,\n      questions: newQuestions\n    };\n\n    yield put(actions.updateAssessment(newAssessment));\n    return yield put(actions.updateHasUnsavedChanges('assessment' as WorkspaceLocation, false));\n  });\n\n  yield takeEvery(\n    SUBMIT_ASSESSMENT,\n    function* (action: ReturnType<typeof actions.submitAssessment>): any {\n      const tokens: Tokens = yield selectTokens();\n      const assessmentId = action.payload;\n\n      const resp: Response | null = yield call(postAssessment, assessmentId, tokens);\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      yield call(showSuccessMessage, 'Submitted!', 2000);\n\n      // Now, update the status of the assessment overview in the store\n      const overviews: AssessmentOverview[] = yield select(\n        (state: OverallState) => state.session.assessmentOverviews\n      );\n      const newOverviews = overviews.map(overview => {\n        if (overview.id === assessmentId) {\n          return { ...overview, status: AssessmentStatuses.submitted };\n        }\n        return overview;\n      });\n\n      return yield put(actions.updateAssessmentOverviews(newOverviews));\n    }\n  );\n\n  yield takeEvery(\n    FETCH_GRADING_OVERVIEWS,\n    function* (action: ReturnType<typeof actions.fetchGradingOverviews>) {\n      const tokens: Tokens = yield selectTokens();\n\n      const filterToGroup = action.payload;\n\n      const gradingOverviews: GradingOverview[] | null = yield call(\n        getGradingOverviews,\n        tokens,\n        filterToGroup\n      );\n      if (gradingOverviews) {\n        yield put(actions.updateGradingOverviews(gradingOverviews));\n      }\n    }\n  );\n\n  yield takeEvery(FETCH_GRADING, function* (action: ReturnType<typeof actions.fetchGrading>) {\n    const tokens: Tokens = yield selectTokens();\n    const id = action.payload;\n\n    const grading: Grading | null = yield call(getGrading, id, tokens);\n    if (grading) {\n      yield put(actions.updateGrading(id, grading));\n    }\n  });\n\n  /**\n   * Unsubmits the submission and updates the grading overviews of the new status.\n   */\n  yield takeEvery(\n    UNSUBMIT_SUBMISSION,\n    function* (action: ReturnType<typeof actions.unsubmitSubmission>): any {\n      const tokens: Tokens = yield selectTokens();\n      const { submissionId } = action.payload;\n\n      const resp: Response | null = yield postUnsubmit(submissionId, tokens);\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      const overviews: GradingOverview[] = yield select(\n        (state: OverallState) => state.session.gradingOverviews || []\n      );\n      const newOverviews = overviews.map(overview => {\n        if (overview.submissionId === submissionId) {\n          return { ...overview, submissionStatus: 'attempted' };\n        }\n        return overview;\n      });\n\n      yield call(showSuccessMessage, 'Unsubmit successful', 1000);\n      yield put(actions.updateGradingOverviews(newOverviews));\n    }\n  );\n\n  const sendGrade = function* (\n    action:\n      | ReturnType<typeof actions.submitGrading>\n      | ReturnType<typeof actions.submitGradingAndContinue>\n  ): any {\n    const role: Role = yield select((state: OverallState) => state.session.role!);\n    if (role === Role.Student) {\n      return yield call(showWarningMessage, 'Only staff can submit answers.');\n    }\n\n    const { submissionId, questionId, xpAdjustment, comments } = action.payload;\n    const tokens: Tokens = yield selectTokens();\n\n    const resp: Response | null = yield postGrading(\n      submissionId,\n      questionId,\n      xpAdjustment,\n      tokens,\n      comments\n    );\n    if (!resp || !resp.ok) {\n      return yield handleResponseError(resp);\n    }\n\n    yield call(showSuccessMessage, 'Submitted!', 1000);\n\n    // Now, update the grade for the question in the Grading in the store\n    const grading: Grading = yield select((state: OverallState) =>\n      state.session.gradings.get(submissionId)\n    );\n    const newGrading = grading.slice().map((gradingQuestion: GradingQuestion) => {\n      if (gradingQuestion.question.id === questionId) {\n        gradingQuestion.grade = {\n          xpAdjustment,\n          xp: gradingQuestion.grade.xp,\n          comments\n        };\n      }\n      return gradingQuestion;\n    });\n\n    yield put(actions.updateGrading(submissionId, newGrading));\n  };\n\n  const sendGradeAndContinue = function* (\n    action: ReturnType<typeof actions.submitGradingAndContinue>\n  ) {\n    yield* sendGrade(action);\n\n    const { submissionId } = action.payload;\n    const [currentQuestion, courseId]: [number | undefined, number] = yield select(\n      (state: OverallState) => [state.workspaces.grading.currentQuestion, state.session.courseId!]\n    );\n\n    /**\n     * Move to next question for grading: this only works because the\n     * SUBMIT_GRADING_AND_CONTINUE Redux action is currently only\n     * used in the Grading Workspace\n     *\n     * If the questionId is out of bounds, the componentDidUpdate callback of\n     * GradingWorkspace will cause a redirect back to '/academy/grading'\n     */\n    yield history.push(\n      `/courses/${courseId}/grading/${submissionId}/${(currentQuestion || 0) + 1}`\n    );\n  };\n\n  yield takeEvery(SUBMIT_GRADING, sendGrade);\n\n  yield takeEvery(SUBMIT_GRADING_AND_CONTINUE, sendGradeAndContinue);\n\n  yield takeEvery(\n    REAUTOGRADE_SUBMISSION,\n    function* (action: ReturnType<typeof actions.reautogradeSubmission>) {\n      const submissionId = action.payload;\n      const tokens: Tokens = yield selectTokens();\n      const resp: Response | null = yield call(postReautogradeSubmission, submissionId, tokens);\n\n      yield call(handleReautogradeResponse, resp);\n    }\n  );\n\n  yield takeEvery(\n    REAUTOGRADE_ANSWER,\n    function* (action: ReturnType<typeof actions.reautogradeAnswer>) {\n      const { submissionId, questionId } = action.payload;\n      const tokens: Tokens = yield selectTokens();\n      const resp: Response | null = yield call(\n        postReautogradeAnswer,\n        submissionId,\n        questionId,\n        tokens\n      );\n\n      yield call(handleReautogradeResponse, resp);\n    }\n  );\n\n  yield takeEvery(\n    FETCH_NOTIFICATIONS,\n    function* (action: ReturnType<typeof actions.fetchNotifications>) {\n      const tokens: Tokens = yield selectTokens();\n      const notifications: Notification[] = yield call(getNotifications, tokens);\n\n      yield put(actions.updateNotifications(notifications));\n    }\n  );\n\n  yield takeEvery(\n    ACKNOWLEDGE_NOTIFICATIONS,\n    function* (action: ReturnType<typeof actions.acknowledgeNotifications>): any {\n      const tokens: Tokens = yield selectTokens();\n      const notificationFilter: NotificationFilterFunction | undefined = action.payload.withFilter;\n      const notifications: Notification[] = yield select(\n        (state: OverallState) => state.session.notifications\n      );\n\n      let notificationsToAcknowledge = notifications;\n\n      if (notificationFilter) {\n        notificationsToAcknowledge = notificationFilter(notifications);\n      }\n\n      if (notificationsToAcknowledge.length === 0) {\n        return;\n      }\n\n      const ids = notificationsToAcknowledge.map(n => n.id);\n      const newNotifications: Notification[] = notifications.filter(\n        notification => !ids.includes(notification.id)\n      );\n\n      yield put(actions.updateNotifications(newNotifications));\n\n      const resp: Response | null = yield call(postAcknowledgeNotifications, tokens, ids);\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n    }\n  );\n\n  yield takeEvery(\n    DELETE_SOURCECAST_ENTRY,\n    function* (action: ReturnType<typeof actions.deleteSourcecastEntry>): any {\n      const role: Role = yield select((state: OverallState) => state.session.role!);\n      if (role === Role.Student) {\n        return yield call(showWarningMessage, 'Only staff can delete sourcecasts.');\n      }\n\n      const tokens: Tokens = yield selectTokens();\n      const { id } = action.payload;\n\n      const resp: Response | null = yield deleteSourcecastEntry(id, tokens);\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      const sourcecastIndex: SourcecastData[] | null = yield call(getSourcecastIndex, tokens);\n      if (sourcecastIndex) {\n        yield put(actions.updateSourcecastIndex(sourcecastIndex, action.payload.workspaceLocation));\n      }\n\n      yield call(showSuccessMessage, 'Deleted successfully!', 1000);\n    }\n  );\n\n  yield takeEvery(\n    FETCH_SOURCECAST_INDEX,\n    function* (action: ReturnType<typeof actions.fetchSourcecastIndex>) {\n      const tokens: Tokens = yield selectTokens();\n\n      const sourcecastIndex: SourcecastData[] | null = yield call(getSourcecastIndex, tokens);\n      if (sourcecastIndex) {\n        yield put(actions.updateSourcecastIndex(sourcecastIndex, action.payload.workspaceLocation));\n      }\n    }\n  );\n\n  yield takeEvery(\n    SAVE_SOURCECAST_DATA,\n    function* (action: ReturnType<typeof actions.saveSourcecastData>): any {\n      const [role, courseId]: [Role, number | undefined] = yield select((state: OverallState) => [\n        state.session.role!,\n        state.session.courseId\n      ]);\n      if (role === Role.Student) {\n        return yield call(showWarningMessage, 'Only staff can save sourcecasts.');\n      }\n\n      const { title, description, uid, audio, playbackData } = action.payload;\n      const tokens: Tokens = yield selectTokens();\n\n      const resp: Response | null = yield postSourcecast(\n        title,\n        description,\n        uid,\n        audio,\n        playbackData,\n        tokens\n      );\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      yield call(showSuccessMessage, 'Saved successfully!', 1000);\n      yield history.push(`/courses/${courseId}/sourcecast`);\n    }\n  );\n\n  yield takeEvery(\n    CHANGE_SUBLANGUAGE,\n    function* (action: ReturnType<typeof actions.changeSublanguage>): any {\n      const tokens: Tokens = yield selectTokens();\n      const { sublang } = action.payload;\n\n      const resp: Response | null = yield call(putCourseConfig, tokens, {\n        sourceChapter: sublang.chapter,\n        sourceVariant: sublang.variant\n      });\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      yield put(\n        actions.setCourseConfiguration({\n          sourceChapter: sublang.chapter,\n          sourceVariant: sublang.variant\n        })\n      );\n      yield call(showSuccessMessage, 'Updated successfully!', 1000);\n    }\n  );\n\n  yield takeEvery(\n    UPDATE_LATEST_VIEWED_COURSE,\n    function* (action: ReturnType<typeof actions.updateLatestViewedCourse>): any {\n      const tokens: Tokens = yield selectTokens();\n      const { courseId } = action.payload;\n\n      const resp: Response | null = yield call(putLatestViewedCourse, tokens, courseId);\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      const {\n        courseRegistration,\n        courseConfiguration,\n        assessmentConfigurations\n      }: {\n        courseRegistration: CourseRegistration | null;\n        courseConfiguration: CourseConfiguration | null;\n        assessmentConfigurations: AssessmentConfiguration[] | null;\n      } = yield call(getLatestCourseRegistrationAndConfiguration, tokens);\n\n      if (!courseRegistration || !courseConfiguration || !assessmentConfigurations) {\n        yield call(showWarningMessage, `Failed to load course!`);\n        return yield history.push('/welcome');\n      }\n\n      yield put(actions.setCourseConfiguration(courseConfiguration));\n      yield put(actions.setAssessmentConfigurations(assessmentConfigurations));\n      yield put(actions.setCourseRegistration(courseRegistration));\n      yield call(showSuccessMessage, `Switched to ${courseConfiguration.courseName}!`, 5000);\n    }\n  );\n\n  yield takeEvery(\n    UPDATE_COURSE_CONFIG,\n    function* (action: ReturnType<typeof actions.updateCourseConfig>): any {\n      const tokens: Tokens = yield selectTokens();\n      const courseConfig: UpdateCourseConfiguration = action.payload;\n\n      const resp: Response | null = yield call(putCourseConfig, tokens, courseConfig);\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      yield put(actions.setCourseConfiguration(courseConfig));\n      yield call(showSuccessMessage, 'Updated successfully!', 1000);\n    }\n  );\n\n  yield takeEvery(FETCH_ASSESSMENT_CONFIGS, function* (): any {\n    const tokens: Tokens = yield selectTokens();\n\n    const assessmentConfigs: AssessmentConfiguration[] | null = yield call(\n      getAssessmentConfigs,\n      tokens\n    );\n\n    if (assessmentConfigs) {\n      yield put(actions.setAssessmentConfigurations(assessmentConfigs));\n    }\n  });\n\n  yield takeEvery(\n    UPDATE_ASSESSMENT_CONFIGS,\n    function* (action: ReturnType<typeof actions.updateAssessmentConfigs>): any {\n      const tokens: Tokens = yield selectTokens();\n      const assessmentConfigs: AssessmentConfiguration[] = action.payload;\n\n      const resp: Response | null = yield call(putAssessmentConfigs, tokens, assessmentConfigs);\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      const updatedAssessmentConfigs: AssessmentConfiguration[] | null = yield call(\n        getAssessmentConfigs,\n        tokens\n      );\n\n      if (updatedAssessmentConfigs) {\n        yield put(actions.setAssessmentConfigurations(updatedAssessmentConfigs));\n      }\n      yield call(showSuccessMessage, 'Updated successfully!', 1000);\n    }\n  );\n\n  yield takeEvery(\n    DELETE_ASSESSMENT_CONFIG,\n    function* (action: ReturnType<typeof actions.deleteAssessmentConfig>): any {\n      const tokens: Tokens = yield selectTokens();\n      const assessmentConfig: AssessmentConfiguration = action.payload;\n\n      const resp: Response | null = yield call(removeAssessmentConfig, tokens, assessmentConfig);\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n    }\n  );\n\n  yield takeEvery(\n    FETCH_ADMIN_PANEL_COURSE_REGISTRATIONS,\n    function* (action: ReturnType<typeof actions.fetchAdminPanelCourseRegistrations>) {\n      const tokens: Tokens = yield selectTokens();\n\n      const courseRegistrations: AdminPanelCourseRegistration[] | null = yield call(\n        getUserCourseRegistrations,\n        tokens\n      );\n      if (courseRegistrations) {\n        yield put(actions.setAdminPanelCourseRegistrations(courseRegistrations));\n      }\n    }\n  );\n\n  yield takeEvery(CREATE_COURSE, function* (action: ReturnType<typeof actions.createCourse>): any {\n    const tokens: Tokens = yield selectTokens();\n    const courseConfig: UpdateCourseConfiguration = action.payload;\n\n    const resp: Response | null = yield call(postCreateCourse, tokens, courseConfig);\n    if (!resp || !resp.ok) {\n      return yield handleResponseError(resp);\n    }\n\n    const {\n      user,\n      courseRegistration,\n      courseConfiguration\n    }: {\n      user: User | null;\n      courseRegistration: CourseRegistration | null;\n      courseConfiguration: CourseConfiguration | null;\n      assessmentConfigurations: AssessmentConfiguration[] | null;\n    } = yield call(getUser, tokens);\n\n    if (!user || !courseRegistration || !courseConfiguration) {\n      return yield showWarningMessage('An error occurred. Please try again.');\n    }\n\n    /**\n     * setUser updates the Dropdown course selection menu with the updated courses\n     *\n     * Setting the role here handles an edge case where a user creates his first ever course.\n     * Without it, the history.push below would not work as the /courses routes will not be rendered\n     * (see Application.tsx)\n     */\n    yield put(actions.setUser(user));\n    yield put(actions.setCourseRegistration({ role: Role.Student }));\n\n    const placeholderAssessmentConfig = [\n      {\n        type: 'Missions',\n        assessmentConfigId: -1,\n        isManuallyGraded: true,\n        displayInDashboard: true,\n        hoursBeforeEarlyXpDecay: 0,\n        earlySubmissionXp: 0\n      }\n    ];\n\n    const resp1: Response | null = yield call(\n      putAssessmentConfigs,\n      tokens,\n      placeholderAssessmentConfig,\n      courseRegistration.courseId\n    );\n    if (!resp1 || !resp1.ok) {\n      return yield handleResponseError(resp);\n    }\n\n    yield call(showSuccessMessage, 'Successfully created your new course!');\n    yield call([history, 'push'], `/courses/${courseRegistration.courseId}`);\n  });\n\n  yield takeEvery(\n    ADD_NEW_USERS_TO_COURSE,\n    function* (action: ReturnType<typeof actions.addNewUsersToCourse>): any {\n      const tokens: Tokens = yield selectTokens();\n      const { users, provider }: { users: UsernameRoleGroup[]; provider: string } = action.payload;\n\n      const resp: Response | null = yield call(putNewUsers, tokens, users, provider);\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      yield put(actions.fetchAdminPanelCourseRegistrations());\n      yield call(showSuccessMessage, 'Users added!');\n    }\n  );\n\n  yield takeEvery(\n    UPDATE_USER_ROLE,\n    function* (action: ReturnType<typeof actions.updateUserRole>): any {\n      const tokens: Tokens = yield selectTokens();\n      const { courseRegId, role }: { courseRegId: number; role: Role } = action.payload;\n\n      const resp: Response | null = yield call(putUserRole, tokens, courseRegId, role);\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      yield put(actions.fetchAdminPanelCourseRegistrations());\n      yield call(showSuccessMessage, 'Role updated!');\n    }\n  );\n\n  yield takeEvery(\n    UPDATE_COURSE_RESEARCH_AGREEMENT,\n    function* (action: ReturnType<typeof actions.updateCourseResearchAgreement>): any {\n      const tokens: Tokens = yield selectTokens();\n      const { agreedToResearch } = action.payload;\n\n      const resp: Response | null = yield call(\n        putCourseResearchAgreement,\n        tokens,\n        agreedToResearch\n      );\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      yield put(actions.setCourseRegistration({ agreedToResearch }));\n      yield call(showSuccessMessage, 'Research preference saved!');\n    }\n  );\n\n  yield takeEvery(\n    DELETE_USER_COURSE_REGISTRATION,\n    function* (action: ReturnType<typeof actions.deleteUserCourseRegistration>): any {\n      const tokens: Tokens = yield selectTokens();\n      const { courseRegId }: { courseRegId: number } = action.payload;\n\n      const resp: Response | null = yield call(removeUserCourseRegistration, tokens, courseRegId);\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      yield put(actions.fetchAdminPanelCourseRegistrations());\n      yield call(showSuccessMessage, 'User deleted!');\n    }\n  );\n\n  yield takeEvery(\n    FETCH_GROUP_GRADING_SUMMARY,\n    function* (action: ReturnType<typeof actions.fetchGroupGradingSummary>) {\n      const tokens: Tokens = yield selectTokens();\n\n      const groupOverviews: GradingSummary | null = yield call(getGradingSummary, tokens);\n      if (groupOverviews) {\n        yield put(actions.updateGroupGradingSummary(groupOverviews));\n      }\n    }\n  );\n\n  yield takeEvery(\n    CHANGE_DATE_ASSESSMENT,\n    function* (action: ReturnType<typeof actions.changeDateAssessment>): any {\n      const tokens: Tokens = yield selectTokens();\n      const id = action.payload.id;\n      const closeAt = action.payload.closeAt;\n      const openAt = action.payload.openAt;\n\n      const resp: Response | null = yield updateAssessment(id, { openAt, closeAt }, tokens);\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      yield put(actions.fetchAssessmentOverviews());\n      yield call(showSuccessMessage, 'Updated successfully!', 1000);\n    }\n  );\n\n  yield takeEvery(\n    DELETE_ASSESSMENT,\n    function* (action: ReturnType<typeof actions.deleteAssessment>): any {\n      const tokens: Tokens = yield selectTokens();\n      const id = action.payload;\n\n      const resp: Response | null = yield deleteAssessment(id, tokens);\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      yield put(actions.fetchAssessmentOverviews());\n      yield call(showSuccessMessage, 'Deleted successfully!', 1000);\n    }\n  );\n\n  yield takeEvery(\n    PUBLISH_ASSESSMENT,\n    function* (action: ReturnType<typeof actions.publishAssessment>): any {\n      const tokens: Tokens = yield selectTokens();\n      const id = action.payload.id;\n      const togglePublishTo = action.payload.togglePublishTo;\n\n      const resp: Response | null = yield updateAssessment(\n        id,\n        { isPublished: togglePublishTo },\n        tokens\n      );\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      yield put(actions.fetchAssessmentOverviews());\n\n      if (togglePublishTo) {\n        yield call(showSuccessMessage, 'Published successfully!', 1000);\n      } else {\n        yield call(showSuccessMessage, 'Unpublished successfully!', 1000);\n      }\n    }\n  );\n\n  yield takeEvery(\n    UPLOAD_ASSESSMENT,\n    function* (action: ReturnType<typeof actions.uploadAssessment>): any {\n      const tokens: Tokens = yield selectTokens();\n      const { file, forceUpdate, assessmentConfigId } = action.payload;\n\n      const resp: Response | null = yield uploadAssessment(\n        file,\n        tokens,\n        forceUpdate,\n        assessmentConfigId\n      );\n      if (!resp || !resp.ok) {\n        return yield handleResponseError(resp);\n      }\n\n      const respText: string = yield resp.text();\n      if (respText === 'OK') {\n        yield call(showSuccessMessage, 'Uploaded successfully!', 2000);\n      } else if (respText === 'Force Update OK') {\n        yield call(showSuccessMessage, 'Assessment force updated successfully!', 2000);\n      }\n\n      yield put(actions.fetchAssessmentOverviews());\n    }\n  );\n}\n\nfunction* handleReautogradeResponse(resp: Response | null): any {\n  if (resp && resp.ok) {\n    return yield call(showSuccessMessage, 'Autograde job queued successfully.');\n  }\n\n  if (resp && resp.status === 400) {\n    return yield call(showWarningMessage, 'Cannot reautograde non-submitted submission.');\n  }\n\n  return yield call(showWarningMessage, 'Failed to queue autograde job.');\n}\n\nexport default BackendSaga;\n","export class GitHubFileNodeData {\n  childrenRetrieved: boolean = false;\n  filePath: string = 'dummy_path';\n  fileType: string = 'unset';\n\n  constructor(path: string, type: string) {\n    this.filePath = path;\n    this.fileType = type;\n  }\n}\n","import { TreeNodeInfo } from '@blueprintjs/core';\nimport { GetResponseTypeFromEndpointMethod } from '@octokit/types';\n\nimport * as GitHubUtils from '../../features/github/GitHubUtils';\nimport { GitHubFileNodeData } from './GitHubFileNodeData';\n\n/**\n * A utility class for the GitHub overlay file explorer that handles the creation of TreeNodeInfos\n */\nexport class GitHubTreeNodeCreator {\n  static fileIndex: number = 0;\n  static currentRepoName: string = '';\n\n  /**\n   * Generates an array of TreeNodeInfos corresponding to the first level of a given repository.\n   *\n   * When loading a new repository, this function should always be called first as node creation is stateful.\n   *\n   * @param repoName The name of the repository where the file exists\n   */\n  public static async getFirstLayerRepoFileNodes(repoName: string) {\n    if (repoName === '') {\n      return [];\n    }\n\n    // Only allow mutations if the repoName is correct\n    GitHubTreeNodeCreator.fileIndex = 0;\n    GitHubTreeNodeCreator.currentRepoName = repoName;\n\n    return await GitHubTreeNodeCreator.getChildNodes(repoName, '');\n  }\n\n  /**\n   * Generates an array of TreeNodeInfo corresponding to the children of a given folder\n   *\n   * @param repoName The name of the repository where the folder exists\n   * @param filePath The filePath of the folder\n   */\n  public static async getChildNodes(repoName: string, filePath: string) {\n    const childNodes: TreeNodeInfo<GitHubFileNodeData>[] = [];\n\n    // Ensures that we will only generate children if the repoNames match\n    if (repoName !== GitHubTreeNodeCreator.currentRepoName) {\n      return childNodes;\n    }\n\n    const octokit = GitHubUtils.getGitHubOctokitInstance();\n\n    if (octokit === undefined) {\n      return childNodes;\n    }\n\n    try {\n      type GetAuthenticatedResponse = GetResponseTypeFromEndpointMethod<\n        typeof octokit.users.getAuthenticated\n      >;\n      const authUser: GetAuthenticatedResponse = await octokit.users.getAuthenticated();\n      const githubLoginID = authUser.data.login;\n\n      type GetContentResponse = GetResponseTypeFromEndpointMethod<typeof octokit.repos.getContent>;\n      const results: GetContentResponse = await octokit.repos.getContent({\n        owner: githubLoginID,\n        repo: repoName,\n        path: filePath\n      });\n\n      const childFiles = results.data;\n\n      if (Array.isArray(childFiles)) {\n        childFiles.forEach(childFile => {\n          childNodes.push(this.createNode(childFile));\n        });\n      }\n    } catch (err) {\n      console.error(err);\n    }\n\n    return childNodes;\n  }\n\n  /**\n   * Generates a single TreeNodeInfo corresponding to a single file or folder.\n   *\n   * @param octokitFileData File data as described by Octokit's REST API\n   */\n  private static createNode(octokitFileData: any) {\n    const index = GitHubTreeNodeCreator.fileIndex;\n\n    let node: TreeNodeInfo<GitHubFileNodeData> = {\n      id: index,\n      label: 'dummy file'\n    };\n\n    if (octokitFileData.type === 'file') {\n      node = {\n        id: index,\n        nodeData: new GitHubFileNodeData(octokitFileData.path, 'file'),\n        icon: 'document',\n        label: octokitFileData.name\n      };\n    }\n\n    if (octokitFileData.type === 'dir') {\n      node = {\n        id: index,\n        nodeData: new GitHubFileNodeData(octokitFileData.path, 'dir'),\n        icon: 'folder-close',\n        label: octokitFileData.name,\n        childNodes: [] // Child nodes are initially empty\n      };\n    }\n\n    GitHubTreeNodeCreator.fileIndex++;\n\n    return node;\n  }\n}\n","import {\n  AnchorButton,\n  Button,\n  Classes,\n  Dialog,\n  InputGroup,\n  Intent,\n  Tree,\n  TreeNodeInfo\n} from '@blueprintjs/core';\nimport { Octokit } from '@octokit/rest';\nimport { GetResponseTypeFromEndpointMethod } from '@octokit/types';\nimport classNames from 'classnames';\nimport React, { useEffect, useState } from 'react';\n\nimport {\n  checkIfFileCanBeOpened,\n  checkIfFileCanBeSavedAndGetSaveType,\n  checkIfUserAgreesToOverwriteEditorData,\n  checkIfUserAgreesToPerformOverwritingSave,\n  openFileInEditor,\n  performCreatingSave,\n  performOverwritingSave\n} from '../../features/github/GitHubUtils';\nimport { GitHubFileNodeData } from './GitHubFileNodeData';\nimport { GitHubTreeNodeCreator } from './GitHubTreeNodeCreator';\n\nexport type FileExplorerDialogProps = {\n  repoName: string;\n  pickerType: string;\n  octokit: Octokit;\n  editorContent: string;\n  onSubmit: (submitContent: string) => void;\n};\n\nconst FileExplorerDialog: React.FC<FileExplorerDialogProps> = props => {\n  const [repoFiles, setRepoFiles] = useState<TreeNodeInfo<GitHubFileNodeData>[]>([]);\n  const [filePath, setFilePath] = useState('');\n  const [commitMessage, setCommitMessage] = useState('');\n\n  useEffect(() => {\n    setFirstLayerRepoFiles(props.repoName, setRepoFiles);\n  }, [props.repoName]);\n\n  return (\n    <Dialog className=\"githubDialog\" isOpen={true} onClose={handleClose}>\n      <div className={classNames('githubDialogHeader', Classes.DIALOG_HEADER)}>\n        <h3>Select a File</h3>\n      </div>\n      <div className={Classes.DIALOG_BODY}>\n        <Tree\n          contents={repoFiles}\n          onNodeClick={handleNodeClick}\n          onNodeCollapse={handleNodeCollapse}\n          onNodeExpand={handleNodeExpand}\n          className={classNames('FileTree', Classes.ELEVATION_0)}\n        />\n        {props.pickerType === 'Save' && (\n          <div>\n            <InputGroup\n              id=\"FileNameTextBox\"\n              onChange={handleFileNameChange}\n              onClick={handleClickFileNameBox}\n              placeholder={'Enter File Name'}\n              value={filePath}\n            />\n            <InputGroup\n              onChange={handleCommitMessageChange}\n              placeholder={'Enter Commit Message'}\n              value={commitMessage}\n            />\n          </div>\n        )}\n      </div>\n      <div className={Classes.DIALOG_FOOTER}>\n        <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n          <Button onClick={handleClose}>Close</Button>\n          <AnchorButton onClick={handleSubmit} intent={Intent.PRIMARY} text={props.pickerType} />\n        </div>\n      </div>\n    </Dialog>\n  );\n\n  async function setFirstLayerRepoFiles(repoName: string, setRepoFiles: any) {\n    try {\n      const initialRepoFiles = await GitHubTreeNodeCreator.getFirstLayerRepoFileNodes(repoName);\n      setRepoFiles(initialRepoFiles);\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  function handleClose() {\n    props.onSubmit('');\n  }\n\n  async function handleSubmit() {\n    type GetAuthenticatedResponse = GetResponseTypeFromEndpointMethod<\n      typeof props.octokit.users.getAuthenticated\n    >;\n    const authUser: GetAuthenticatedResponse = await props.octokit.users.getAuthenticated();\n    const githubLoginID = authUser.data.login;\n    const githubName = authUser.data.name;\n    const githubEmail = authUser.data.email;\n\n    if (props.pickerType === 'Open') {\n      if (await checkIfFileCanBeOpened(props.octokit, githubLoginID, props.repoName, filePath)) {\n        if (await checkIfUserAgreesToOverwriteEditorData()) {\n          openFileInEditor(props.octokit, githubLoginID, props.repoName, filePath);\n        }\n      }\n    }\n\n    if (props.pickerType === 'Save') {\n      const { canBeSaved, saveType } = await checkIfFileCanBeSavedAndGetSaveType(\n        props.octokit,\n        githubLoginID,\n        props.repoName,\n        filePath\n      );\n\n      if (canBeSaved) {\n        if (saveType === 'Overwrite' && (await checkIfUserAgreesToPerformOverwritingSave())) {\n          performOverwritingSave(\n            props.octokit,\n            githubLoginID,\n            props.repoName,\n            filePath,\n            githubName,\n            githubEmail,\n            commitMessage,\n            props.editorContent\n          );\n        }\n\n        if (saveType === 'Create') {\n          performCreatingSave(\n            props.octokit,\n            githubLoginID,\n            props.repoName,\n            filePath,\n            githubName,\n            githubEmail,\n            commitMessage,\n            props.editorContent\n          );\n        }\n      }\n    }\n    props.onSubmit('');\n  }\n\n  async function handleNodeClick(\n    treeNode: TreeNodeInfo<GitHubFileNodeData>,\n    _nodePath: number[],\n    e: React.MouseEvent<HTMLElement>\n  ) {\n    const originallySelected = treeNode.isSelected;\n\n    const allNodesCallback = (node: TreeNodeInfo<GitHubFileNodeData>) => (node.isSelected = false);\n    const specificNodeCallback = (node: TreeNodeInfo<GitHubFileNodeData>) => {\n      // if originally selected is null, set to true\n      // else, toggle the selection\n      node.isSelected = originallySelected === null ? true : !originallySelected;\n      const newFilePath =\n        node.nodeData !== undefined && node.isSelected ? node.nodeData.filePath : '';\n      setFilePath(newFilePath);\n    };\n\n    const newRepoFiles = await cloneWithCallbacks(\n      repoFiles,\n      treeNode,\n      allNodesCallback,\n      specificNodeCallback\n    );\n\n    if (newRepoFiles !== null) {\n      setRepoFiles(newRepoFiles);\n    }\n  }\n\n  async function handleNodeCollapse(treeNode: TreeNodeInfo<GitHubFileNodeData>) {\n    const newRepoFiles = await cloneWithCallbacks(\n      repoFiles,\n      treeNode,\n      (node: TreeNodeInfo<GitHubFileNodeData>) => {},\n      (node: TreeNodeInfo<GitHubFileNodeData>) => (node.isExpanded = false)\n    );\n\n    if (newRepoFiles !== null) {\n      setRepoFiles(newRepoFiles);\n    }\n  }\n\n  async function handleNodeExpand(treeNode: TreeNodeInfo<GitHubFileNodeData>) {\n    const newRepoFiles = await cloneWithCallbacks(\n      repoFiles,\n      treeNode,\n      (node: TreeNodeInfo<GitHubFileNodeData>) => {},\n      async (node: TreeNodeInfo<GitHubFileNodeData>) => {\n        node.isExpanded = true;\n\n        if (node.nodeData !== undefined && !node.nodeData.childrenRetrieved) {\n          node.childNodes = await GitHubTreeNodeCreator.getChildNodes(\n            props.repoName,\n            node.nodeData.filePath\n          );\n          node.nodeData.childrenRetrieved = true;\n        }\n      }\n    );\n\n    if (newRepoFiles !== null) {\n      setRepoFiles(newRepoFiles);\n    }\n  }\n\n  async function cloneWithCallbacks(\n    treeNodes: TreeNodeInfo<GitHubFileNodeData>[],\n    treeNodeToEdit: TreeNodeInfo<GitHubFileNodeData>,\n    allNodesCallback: (node: TreeNodeInfo<GitHubFileNodeData>) => void,\n    specificNodeCallback: (node: TreeNodeInfo<GitHubFileNodeData>) => void\n  ) {\n    if (treeNodes === null) {\n      return null;\n    }\n\n    const newTreeNodes = [];\n\n    for (let i = 0; i < treeNodes.length; i++) {\n      const node = treeNodes[i];\n      const clonedNode = Object.assign({}, node);\n      await allNodesCallback(clonedNode);\n\n      if (treeNodeToEdit === node) {\n        await specificNodeCallback(clonedNode);\n      }\n\n      if (clonedNode.childNodes !== undefined) {\n        const newChildNodes = await cloneWithCallbacks(\n          clonedNode.childNodes,\n          treeNodeToEdit,\n          allNodesCallback,\n          specificNodeCallback\n        );\n\n        if (newChildNodes !== null) {\n          clonedNode.childNodes = newChildNodes;\n        }\n      }\n\n      newTreeNodes.push(clonedNode);\n    }\n\n    return newTreeNodes;\n  }\n\n  function handleFileNameChange(e: any) {\n    setFilePath(e.target.value);\n  }\n\n  function handleCommitMessageChange(e: any) {\n    setCommitMessage(e.target.value);\n  }\n\n  function handleClickFileNameBox(e: any) {\n    if (filePath === '') {\n      setFilePath('.js');\n    }\n  }\n};\n\nexport default FileExplorerDialog;\n","import {\n  AnchorButton,\n  Button,\n  Classes,\n  Dialog,\n  Intent,\n  Radio,\n  RadioGroup\n} from '@blueprintjs/core';\nimport classNames from 'classnames';\nimport React, { useState } from 'react';\n\nimport { showWarningMessage } from '../utils/NotificationsHelper';\n\nexport type RepositoryDialogProps = {\n  userRepos: any[];\n  onSubmit: (repoName: string) => void;\n};\n\nconst RepositoryDialog: React.FC<RepositoryDialogProps> = props => {\n  const [repoName, setRepoName] = useState('');\n\n  return (\n    <Dialog className=\"githubDialog\" isOpen={true} onClose={handleClose}>\n      <div className={classNames('githubDialogHeader', Classes.DIALOG_HEADER)}>\n        <h3>Select a Repository</h3>\n      </div>\n      <div className={Classes.DIALOG_BODY}>\n        <RadioGroup\n          className=\"RepositoryRadioGroup\"\n          onChange={handleSelect}\n          selectedValue={repoName}\n        >\n          {props.userRepos.map((repo: any) => (\n            <Radio label={repo.name} key={repo.id} value={repo.name} />\n          ))}\n        </RadioGroup>\n      </div>\n      <div className={classNames(Classes.DIALOG_FOOTER)}>\n        <div className={classNames(Classes.DIALOG_FOOTER_ACTIONS)}>\n          <Button onClick={handleClose}>Close</Button>\n          <AnchorButton onClick={handleSubmit} intent={Intent.PRIMARY}>\n            Select\n          </AnchorButton>\n        </div>\n      </div>\n    </Dialog>\n  );\n\n  function handleSelect(e: any) {\n    setRepoName(e.target.value);\n  }\n\n  function handleClose() {\n    props.onSubmit('');\n  }\n\n  function handleSubmit() {\n    if (repoName === '') {\n      showWarningMessage('No repository selected!', 1000);\n    } else {\n      props.onSubmit(repoName);\n    }\n  }\n};\n\nexport default RepositoryDialog;\n","import {\n  GetResponseDataTypeFromEndpointMethod,\n  GetResponseTypeFromEndpointMethod\n} from '@octokit/types';\nimport { SagaIterator } from 'redux-saga';\nimport { call, put, takeLatest } from 'redux-saga/effects';\n\nimport {\n  GITHUB_OPEN_FILE,\n  GITHUB_SAVE_FILE,\n  GITHUB_SAVE_FILE_AS\n} from '../../features/github/GitHubTypes';\nimport * as GitHubUtils from '../../features/github/GitHubUtils';\nimport { getGitHubOctokitInstance } from '../../features/github/GitHubUtils';\nimport { store } from '../../pages/createStore';\nimport { LOGIN_GITHUB, LOGOUT_GITHUB } from '../application/types/SessionTypes';\nimport FileExplorerDialog, { FileExplorerDialogProps } from '../gitHubOverlay/FileExplorerDialog';\nimport RepositoryDialog, { RepositoryDialogProps } from '../gitHubOverlay/RepositoryDialog';\nimport { actions } from '../utils/ActionsHelper';\nimport Constants from '../utils/Constants';\nimport { promisifyDialog } from '../utils/DialogHelper';\nimport { showSuccessMessage, showWarningMessage } from '../utils/NotificationsHelper';\n\nexport function* GitHubPersistenceSaga(): SagaIterator {\n  yield takeLatest(LOGIN_GITHUB, githubLoginSaga);\n  yield takeLatest(LOGOUT_GITHUB, githubLogoutSaga);\n\n  yield takeLatest(GITHUB_OPEN_FILE, githubOpenFile);\n  yield takeLatest(GITHUB_SAVE_FILE, githubSaveFile);\n  yield takeLatest(GITHUB_SAVE_FILE_AS, githubSaveFileAs);\n}\n\nfunction* githubLoginSaga() {\n  const githubOauthLoginLink = `https://github.com/login/oauth/authorize?client_id=${Constants.githubClientId}&scope=repo`;\n  const windowName = 'Connect With OAuth';\n  const windowSpecs = 'height=600,width=400';\n\n  // Create the broadcast channel\n  const broadcastChannel = new BroadcastChannel('GitHubOAuthAccessToken');\n\n  broadcastChannel.onmessage = receivedMessage => {\n    store.dispatch(actions.setGitHubOctokitObject(receivedMessage.data));\n    store.dispatch(actions.setGitHubAccessToken(receivedMessage.data));\n    showSuccessMessage('Logged in to GitHub', 1000);\n  };\n\n  if (!Constants.githubClientId) {\n    // Direct to the callback page to show the error messages\n    yield call(window.open, `/callback/github`, windowName, windowSpecs);\n  } else {\n    // Creates a window directed towards the GitHub oauth link for this app\n    // After the app has been approved by the user, it will be redirected to our GitHub callback page\n    // We receive the auth token through our broadcast channel\n    yield call(window.open, githubOauthLoginLink, windowName, windowSpecs);\n  }\n}\n\nfunction* githubLogoutSaga() {\n  if (store.getState() && store.getState().workspaces.githubAssessment.hasUnsavedChanges) {\n    yield call(showWarningMessage, 'You have unsaved changes!', 2000);\n    return;\n  }\n\n  yield put(actions.removeGitHubOctokitObjectAndAccessToken());\n  yield call(showSuccessMessage, `Logged out from GitHub`, 1000);\n}\n\nfunction* githubOpenFile(): any {\n  const octokit = GitHubUtils.getGitHubOctokitInstance();\n  if (octokit === undefined) {\n    return;\n  }\n\n  type ListForAuthenticatedUserData = GetResponseDataTypeFromEndpointMethod<\n    typeof octokit.repos.listForAuthenticatedUser\n  >;\n  const userRepos: ListForAuthenticatedUserData = yield call(\n    async () =>\n      await octokit.paginate(octokit.repos.listForAuthenticatedUser, {\n        // 100 is the maximum number of results that can be retrieved per page.\n        per_page: 100\n      })\n  );\n\n  const getRepoName = async () =>\n    await promisifyDialog<RepositoryDialogProps, string>(RepositoryDialog, resolve => ({\n      userRepos: userRepos,\n      onSubmit: resolve\n    }));\n  const repoName = yield call(getRepoName);\n\n  const editorContent = '';\n\n  if (repoName !== '') {\n    const pickerType = 'Open';\n    const promisifiedDialog = async () =>\n      await promisifyDialog<FileExplorerDialogProps, string>(FileExplorerDialog, resolve => ({\n        repoName: repoName,\n        pickerType: pickerType,\n        octokit: octokit,\n        editorContent: editorContent,\n        onSubmit: resolve\n      }));\n\n    yield call(promisifiedDialog);\n  }\n}\n\nfunction* githubSaveFile(): any {\n  const octokit = getGitHubOctokitInstance();\n  if (octokit === undefined) return;\n\n  type GetAuthenticatedResponse = GetResponseTypeFromEndpointMethod<\n    typeof octokit.users.getAuthenticated\n  >;\n  const authUser: GetAuthenticatedResponse = yield call(octokit.users.getAuthenticated);\n\n  const githubLoginId = authUser.data.login;\n  const repoName = store.getState().playground.githubSaveInfo.repoName;\n  const filePath = store.getState().playground.githubSaveInfo.filePath;\n  const githubEmail = authUser.data.email;\n  const githubName = authUser.data.name;\n  const commitMessage = 'Changes made from Source Academy';\n  // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n  const content = store.getState().workspaces.playground.editorTabs[0].value;\n\n  GitHubUtils.performOverwritingSave(\n    octokit,\n    githubLoginId,\n    repoName,\n    filePath,\n    githubEmail,\n    githubName,\n    commitMessage,\n    content\n  );\n}\n\nfunction* githubSaveFileAs(): any {\n  const octokit = GitHubUtils.getGitHubOctokitInstance();\n  if (octokit === undefined) {\n    return;\n  }\n\n  type ListForAuthenticatedUserData = GetResponseDataTypeFromEndpointMethod<\n    typeof octokit.repos.listForAuthenticatedUser\n  >;\n  const userRepos: ListForAuthenticatedUserData = yield call(\n    async () =>\n      await octokit.paginate(octokit.repos.listForAuthenticatedUser, {\n        // 100 is the maximum number of results that can be retrieved per page.\n        per_page: 100\n      })\n  );\n\n  const getRepoName = async () =>\n    await promisifyDialog<RepositoryDialogProps, string>(RepositoryDialog, resolve => ({\n      userRepos: userRepos,\n      onSubmit: resolve\n    }));\n  const repoName = yield call(getRepoName);\n\n  // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n  const editorContent = store.getState().workspaces.playground.editorTabs[0].value;\n\n  if (repoName !== '') {\n    const pickerType = 'Save';\n\n    const promisifiedFileExplorer = async () =>\n      await promisifyDialog<FileExplorerDialogProps, string>(FileExplorerDialog, resolve => ({\n        repoName: repoName,\n        pickerType: pickerType,\n        octokit: octokit,\n        editorContent: editorContent,\n        onSubmit: resolve\n      }));\n\n    yield call(promisifiedFileExplorer);\n  }\n}\n\nexport default GitHubPersistenceSaga;\n","export const GITHUB_OPEN_FILE = 'GITHUB_OPEN_FILE';\nexport const GITHUB_SAVE_FILE = 'GITHUB_SAVE_FILE';\nexport const GITHUB_SAVE_FILE_AS = 'GITHUB_SAVE_FILE_AS';\n\nexport type GitHubSaveInfo = {\n  repoName: string;\n  filePath: string;\n  lastSaved?: Date;\n};\n","import * as Sentry from '@sentry/browser';\nimport { SagaIterator } from 'redux-saga';\nimport { call } from 'redux-saga/effects';\n\nimport { LOG_OUT } from '../application/types/CommonsTypes';\nimport { LOGIN, SET_USER } from '../application/types/SessionTypes';\nimport { actions } from '../utils/ActionsHelper';\nimport { computeEndpointUrl } from '../utils/AuthHelper';\nimport { showWarningMessage } from '../utils/NotificationsHelper';\nimport { safeTakeEvery as takeEvery } from './SafeEffects';\n\nexport default function* LoginSaga(): SagaIterator {\n  yield takeEvery(LOGIN, updateLoginHref);\n\n  yield takeEvery(SET_USER, (action: ReturnType<typeof actions.setUser>) => {\n    Sentry.setUser({ id: action.payload.userId.toString() });\n  });\n\n  yield takeEvery(LOG_OUT, () => {\n    Sentry.setUser(null);\n  });\n}\n\nfunction* updateLoginHref({ payload: providerId }: ReturnType<typeof actions.login>) {\n  const epUrl = computeEndpointUrl(providerId);\n  if (!epUrl) {\n    yield call(showWarningMessage, 'Could not log in; invalid provider name provided.');\n    return undefined;\n  }\n  window.location.href = epUrl;\n  return undefined;\n}\n","import { Intent } from '@blueprintjs/core';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport { SagaIterator } from 'redux-saga';\nimport { call, put, select } from 'redux-saga/effects';\n\nimport {\n  PERSISTENCE_INITIALISE,\n  PERSISTENCE_OPEN_PICKER,\n  PERSISTENCE_SAVE_FILE,\n  PERSISTENCE_SAVE_FILE_AS,\n  PersistenceFile\n} from '../../features/persistence/PersistenceTypes';\nimport { store } from '../../pages/createStore';\nimport { OverallState } from '../application/ApplicationTypes';\nimport { ExternalLibraryName } from '../application/types/ExternalTypes';\nimport { LOGOUT_GOOGLE } from '../application/types/SessionTypes';\nimport { actions } from '../utils/ActionsHelper';\nimport Constants from '../utils/Constants';\nimport { showSimpleConfirmDialog, showSimplePromptDialog } from '../utils/DialogHelper';\nimport {\n  dismiss,\n  showMessage,\n  showSuccessMessage,\n  showWarningMessage\n} from '../utils/NotificationsHelper';\nimport { AsyncReturnType } from '../utils/TypeHelper';\nimport { safeTakeEvery as takeEvery, safeTakeLatest as takeLatest } from './SafeEffects';\n\nconst DISCOVERY_DOCS = ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'];\nconst SCOPES = 'profile https://www.googleapis.com/auth/drive.file';\nconst UPLOAD_PATH = 'https://www.googleapis.com/upload/drive/v3/files';\n\n// Special ID value for the Google Drive API.\nconst ROOT_ID = 'root';\n\nconst MIME_SOURCE = 'text/plain';\n// const MIME_FOLDER = 'application/vnd.google-apps.folder';\n\nexport function* persistenceSaga(): SagaIterator {\n  yield takeLatest(LOGOUT_GOOGLE, function* () {\n    yield put(actions.playgroundUpdatePersistenceFile(undefined));\n    yield call(ensureInitialised);\n    yield call([gapi.auth2.getAuthInstance(), 'signOut']);\n  });\n\n  yield takeLatest(PERSISTENCE_OPEN_PICKER, function* (): any {\n    let toastKey: string | undefined;\n    try {\n      yield call(ensureInitialisedAndAuthorised);\n\n      const { id, name, picked } = yield call(pickFile, 'Pick a file to open');\n      if (!picked) {\n        return;\n      }\n      const confirmOpen: boolean = yield call(showSimpleConfirmDialog, {\n        title: 'Opening from Google Drive',\n        contents: (\n          <p>\n            Opening <strong>{name}</strong> will overwrite the current contents of your workspace.\n            Are you sure?\n          </p>\n        ),\n        positiveLabel: 'Open',\n        negativeLabel: 'Cancel'\n      });\n      if (!confirmOpen) {\n        return;\n      }\n\n      toastKey = yield call(showMessage, {\n        message: 'Opening file...',\n        timeout: 0,\n        intent: Intent.PRIMARY\n      });\n\n      const { result: meta } = yield call([gapi.client.drive.files, 'get'], {\n        fileId: id,\n        fields: 'appProperties'\n      });\n      const contents = yield call([gapi.client.drive.files, 'get'], { fileId: id, alt: 'media' });\n      yield put(actions.updateEditorValue(contents.body, 'playground'));\n      yield put(actions.playgroundUpdatePersistenceFile({ id, name, lastSaved: new Date() }));\n      if (meta && meta.appProperties) {\n        yield put(\n          actions.chapterSelect(\n            parseInt(meta.appProperties.chapter || '4', 10) as Chapter,\n            meta.appProperties.variant || Variant.DEFAULT,\n            'playground'\n          )\n        );\n        yield put(\n          actions.externalLibrarySelect(\n            Object.values(ExternalLibraryName).find(v => v === meta.appProperties.external) ||\n              ExternalLibraryName.NONE,\n            'playground'\n          )\n        );\n      }\n\n      yield call(showSuccessMessage, `Loaded ${name}.`, 1000);\n    } catch (ex) {\n      console.error(ex);\n      yield call(showWarningMessage, `Error while opening file.`, 1000);\n    } finally {\n      if (toastKey) {\n        dismiss(toastKey);\n      }\n    }\n  });\n\n  yield takeLatest(PERSISTENCE_SAVE_FILE_AS, function* (): any {\n    let toastKey: string | undefined;\n    try {\n      yield call(ensureInitialisedAndAuthorised);\n\n      const [code, variant, external] = yield select((state: OverallState) => [\n        // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n        state.workspaces.playground.editorTabs[0].value,\n        state.workspaces.playground.context.variant,\n        state.workspaces.playground.externalLibrary\n      ]);\n\n      const pickedDir: PickFileResult = yield call(\n        pickFile,\n        'Pick a folder, or cancel to pick the root folder',\n        {\n          pickFolders: true,\n          showFolders: true,\n          showFiles: false\n        }\n      );\n\n      const saveToDir: PersistenceFile = pickedDir.picked\n        ? pickedDir\n        : { id: ROOT_ID, name: 'My Drive' };\n\n      const pickedFile: PickFileResult = yield call(\n        pickFile,\n        `Saving to ${saveToDir.name}; pick a file to overwrite, or cancel to save as a new file`,\n        {\n          pickFolders: false,\n          showFolders: false,\n          showFiles: true,\n          rootFolder: saveToDir.id\n        }\n      );\n\n      if (pickedFile.picked) {\n        const reallyOverwrite: boolean = yield call(showSimpleConfirmDialog, {\n          title: 'Saving to Google Drive',\n          contents: (\n            <span>\n              Really overwrite <strong>{pickedFile.name}</strong>?\n            </span>\n          )\n        });\n        if (!reallyOverwrite) {\n          return;\n        }\n        yield put(actions.playgroundUpdatePersistenceFile(pickedFile));\n        yield put(actions.persistenceSaveFile(pickedFile));\n      } else {\n        const response: AsyncReturnType<typeof showSimplePromptDialog> = yield call(\n          showSimplePromptDialog,\n          {\n            title: 'Saving to Google Drive',\n            contents: (\n              <>\n                <p>\n                  Saving to folder <strong>{saveToDir.name}</strong>.\n                </p>\n                <p>Save as name?</p>\n              </>\n            ),\n            positiveLabel: 'Save as new file',\n            negativeLabel: 'Cancel',\n            props: {\n              validationFunction: value => !!value\n            }\n          }\n        );\n\n        if (!response.buttonResponse) {\n          return;\n        }\n\n        const config: IPlaygroundConfig = {\n          variant,\n          external\n        };\n\n        toastKey = yield call(showMessage, {\n          message: `Saving as ${response.value}...`,\n          timeout: 0,\n          intent: Intent.PRIMARY\n        });\n\n        const newFile = yield call(\n          createFile,\n          response.value,\n          saveToDir.id,\n          MIME_SOURCE,\n          code,\n          config\n        );\n\n        yield put(actions.playgroundUpdatePersistenceFile({ ...newFile, lastSaved: new Date() }));\n        yield call(\n          showSuccessMessage,\n          `${response.value} successfully saved to Google Drive.`,\n          1000\n        );\n      }\n    } catch (ex) {\n      console.error(ex);\n      yield call(showWarningMessage, `Error while saving file.`, 1000);\n    } finally {\n      if (toastKey) {\n        dismiss(toastKey);\n      }\n    }\n  });\n\n  yield takeEvery(\n    PERSISTENCE_SAVE_FILE,\n    function* ({ payload: { id, name } }: ReturnType<typeof actions.persistenceSaveFile>) {\n      let toastKey: string | undefined;\n      try {\n        toastKey = yield call(showMessage, {\n          message: `Saving as ${name}...`,\n          timeout: 0,\n          intent: Intent.PRIMARY\n        });\n\n        yield call(ensureInitialisedAndAuthorised);\n\n        const [code, variant, external] = yield select((state: OverallState) => [\n          // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n          state.workspaces.playground.editorTabs[0].value,\n          state.workspaces.playground.context.variant,\n          state.workspaces.playground.externalLibrary\n        ]);\n\n        const config: IPlaygroundConfig = {\n          variant,\n          external\n        };\n        yield call(updateFile, id, name, MIME_SOURCE, code, config);\n        yield put(actions.playgroundUpdatePersistenceFile({ id, name, lastSaved: new Date() }));\n        yield call(showSuccessMessage, `${name} successfully saved to Google Drive.`, 1000);\n      } catch (ex) {\n        console.error(ex);\n        yield call(showWarningMessage, `Error while saving file.`, 1000);\n      } finally {\n        if (toastKey) {\n          dismiss(toastKey);\n        }\n      }\n    }\n  );\n\n  yield takeEvery(PERSISTENCE_INITIALISE, ensureInitialised);\n}\n\ninterface IPlaygroundConfig {\n  variant: string;\n  external: string;\n}\n\n// Reason for this: we don't want to initialise and load the gapi JS until\n// it is actually needed\n// Note the following properties of Promises:\n// - It is okay to call .then() multiple times on the same promise\n// - It is okay to call resolve() multiple times (the subsequent resolves have\n//   no effect\n// See ECMA 262: https://www.ecma-international.org/ecma-262/6.0/#sec-promise-resolve-functions\n// These two properties make a Promise a good way to have a lazy singleton\n// (in this case, the singleton is not an object but the initialisation of the\n// gapi library)\nlet startInitialisation: (_: void) => void;\nconst initialisationPromise: Promise<void> = new Promise(res => {\n  startInitialisation = res;\n}).then(initialise);\n\nfunction handleUserChanged(user: gapi.auth2.GoogleUser) {\n  store.dispatch(\n    actions.setGoogleUser(user.isSignedIn() ? user.getBasicProfile().getEmail() : undefined)\n  );\n}\n\nasync function initialise() {\n  await new Promise((resolve, reject) =>\n    gapi.load('client:auth2', { callback: resolve, onerror: reject })\n  );\n  await gapi.client.init({\n    apiKey: Constants.googleApiKey,\n    clientId: Constants.googleClientId,\n    discoveryDocs: DISCOVERY_DOCS,\n    scope: SCOPES\n  });\n  gapi.auth2.getAuthInstance().currentUser.listen(handleUserChanged);\n  handleUserChanged(gapi.auth2.getAuthInstance().currentUser.get());\n}\n\nfunction* ensureInitialised() {\n  startInitialisation();\n  yield initialisationPromise;\n}\n\nfunction* ensureInitialisedAndAuthorised() {\n  yield call(ensureInitialised);\n  if (!gapi.auth2.getAuthInstance().isSignedIn.get()) {\n    yield gapi.auth2.getAuthInstance().signIn();\n  }\n}\n\ntype PickFileResult =\n  | { id: string; name: string; mimeType: string; parentId: string; picked: true }\n  | { picked: false };\n\nfunction pickFile(\n  title: string,\n  options?: {\n    pickFolders?: boolean;\n    showFolders?: boolean;\n    showFiles?: boolean;\n    rootFolder?: string;\n  }\n): Promise<PickFileResult> {\n  const pickFolders = typeof options?.pickFolders === 'undefined' ? false : options?.pickFolders;\n  const showFolders = typeof options?.showFolders === 'undefined' ? true : options?.showFolders;\n  const showFiles = typeof options?.showFiles === 'undefined' ? true : options?.showFiles;\n  return new Promise(res => {\n    gapi.load('picker', () => {\n      const view = new google.picker.DocsView(\n        showFiles ? google.picker.ViewId.DOCS : google.picker.ViewId.FOLDERS\n      );\n      if (options?.rootFolder) {\n        view.setParent(options.rootFolder);\n      }\n      view.setOwnedByMe(true);\n      view.setIncludeFolders(showFolders);\n      view.setSelectFolderEnabled(pickFolders);\n      view.setMode(google.picker.DocsViewMode.LIST);\n\n      const picker = new google.picker.PickerBuilder()\n        .setTitle(title)\n        .enableFeature(google.picker.Feature.NAV_HIDDEN)\n        .addView(view)\n        .setOAuthToken(\n          gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token\n        )\n        .setAppId(Constants.googleAppId!)\n        .setDeveloperKey(Constants.googleApiKey!)\n        .setCallback((data: any) => {\n          switch (data[google.picker.Response.ACTION]) {\n            case google.picker.Action.PICKED: {\n              const { id, name, mimeType, parentId } = data.docs[0];\n              res({ id, name, mimeType, parentId, picked: true });\n              break;\n            }\n            case google.picker.Action.CANCEL: {\n              res({ picked: false });\n              break;\n            }\n          }\n        })\n        .build();\n      picker.setVisible(true);\n    });\n  });\n}\n\nfunction createFile(\n  filename: string,\n  parent: string,\n  mimeType: string,\n  contents: string = '',\n  config: IPlaygroundConfig | {}\n): Promise<PersistenceFile> {\n  const name = filename;\n  const meta = {\n    name,\n    mimeType,\n    parents: [parent],\n    appProperties: {\n      source: true,\n      ...config\n    }\n  };\n\n  const { body, headers } = createMultipartBody(meta, contents, mimeType);\n\n  return gapi.client\n    .request({\n      path: UPLOAD_PATH,\n      method: 'POST',\n      params: {\n        uploadType: 'multipart'\n      },\n      headers,\n      body\n    })\n    .then(({ result }) => ({ id: result.id, name: result.name }));\n}\n\nfunction updateFile(\n  id: string,\n  name: string,\n  mimeType: string,\n  contents: string = '',\n  config: IPlaygroundConfig | {}\n): Promise<any> {\n  const meta = {\n    name,\n    mimeType,\n    appProperties: {\n      source: true,\n      ...config\n    }\n  };\n\n  const { body, headers } = createMultipartBody(meta, contents, mimeType);\n\n  return gapi.client.request({\n    path: UPLOAD_PATH + '/' + id,\n    method: 'PATCH',\n    params: {\n      uploadType: 'multipart'\n    },\n    headers,\n    body\n  });\n}\n\nfunction createMultipartBody(\n  meta: any,\n  contents: string,\n  contentsMime: string\n): { body: string; boundary: string; headers: { [name: string]: string } } {\n  const metaJson = JSON.stringify(meta);\n  let boundary: string;\n  do {\n    boundary = generateBoundary();\n  } while (metaJson.includes(boundary) || contents.includes(boundary));\n\n  const body = `--${boundary}\nContent-Type: application/json; charset=utf-8\n\n${JSON.stringify(meta)}\n--${boundary}\nContent-Type: ${contentsMime}\n\n${contents}\n--${boundary}--\n`;\n\n  return { body, boundary, headers: { 'Content-Type': `multipart/related; boundary=${boundary}` } };\n}\n\n// Adapted from\n// https://github.com/form-data/form-data/blob/master/lib/form_data.js\n\n// Copyright (c) 2012 Felix Geisendrfer (felix@debuggable.com) and contributors\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nfunction generateBoundary(): string {\n  // This generates a 50 character boundary similar to those used by Firefox.\n  // They are optimized for boyer-moore parsing.\n  let boundary = '--------------------------';\n  for (let i = 0; i < 24; i++) {\n    boundary += Math.floor(Math.random() * 10).toString(16);\n  }\n\n  return boundary;\n}\n\n// End adapted part\n\nexport default persistenceSaga;\n","import { Variant } from 'c-slang/dist/types';\nimport { compressToEncodedURIComponent } from 'lz-string';\nimport * as qs from 'query-string';\nimport { SagaIterator } from 'redux-saga';\nimport { call, delay, put, race, select } from 'redux-saga/effects';\n\nimport {\n  changeQueryString,\n  shortenURL,\n  updateShortURL\n} from '../../features/playground/PlaygroundActions';\nimport { GENERATE_LZ_STRING, SHORTEN_URL } from '../../features/playground/PlaygroundTypes';\nimport { defaultEditorValue, OverallState } from '../application/ApplicationTypes';\nimport { ExternalLibraryName } from '../application/types/ExternalTypes';\nimport Constants from '../utils/Constants';\nimport { showSuccessMessage, showWarningMessage } from '../utils/NotificationsHelper';\nimport { safeTakeEvery as takeEvery } from './SafeEffects';\n\nexport default function* PlaygroundSaga(): SagaIterator {\n  yield takeEvery(GENERATE_LZ_STRING, updateQueryString);\n\n  yield takeEvery(SHORTEN_URL, function* (action: ReturnType<typeof shortenURL>): any {\n    const queryString = yield select((state: OverallState) => state.playground.queryString);\n    const keyword = action.payload;\n    const errorMsg = 'ERROR';\n\n    let resp, timeout;\n\n    //we catch and move on if there are errors (plus have a timeout in case)\n    try {\n      const { result, hasTimedOut } = yield race({\n        result: call(shortenURLRequest, queryString, keyword),\n        hasTimedOut: delay(10000)\n      });\n\n      resp = result;\n      timeout = hasTimedOut;\n    } catch (_) {}\n\n    if (!resp || timeout) {\n      yield put(updateShortURL(errorMsg));\n      return yield call(showWarningMessage, 'Something went wrong trying to create the link.');\n    }\n\n    if (resp.status !== 'success' && !resp.shorturl) {\n      yield put(updateShortURL(errorMsg));\n      return yield call(showWarningMessage, resp.message);\n    }\n\n    if (resp.status !== 'success') {\n      yield call(showSuccessMessage, resp.message);\n    }\n    yield put(updateShortURL(Constants.urlShortenerBase + resp.url.keyword));\n  });\n}\n\nfunction* updateQueryString() {\n  const code: string = yield select(\n    // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n    (state: OverallState) => state.workspaces.playground.editorTabs[0].value\n  );\n  if (!code || code === defaultEditorValue) {\n    yield put(changeQueryString(''));\n    return;\n  }\n  const variant: Variant = yield select(\n    (state: OverallState) => state.workspaces.playground.context.variant\n  );\n  const external: ExternalLibraryName = yield select(\n    (state: OverallState) => state.workspaces.playground.externalLibrary\n  );\n  const execTime: number = yield select(\n    (state: OverallState) => state.workspaces.playground.execTime\n  );\n  const newQueryString: string = qs.stringify({\n    prgrm: compressToEncodedURIComponent(code),\n    variant,\n    ext: external,\n    exec: execTime\n  });\n  yield put(changeQueryString(newQueryString));\n}\n\n/**\n * Gets short url from microservice\n * @returns {(Response|null)} Response if successful, otherwise null.\n */\nexport async function shortenURLRequest(\n  queryString: string,\n  keyword: string\n): Promise<Response | null> {\n  const url = `${window.location.protocol}//${window.location.host}/playground#${queryString}`;\n\n  const params = {\n    signature: Constants.urlShortenerSignature,\n    action: 'shorturl',\n    format: 'json',\n    keyword,\n    url\n  };\n  const fetchOpts: RequestInit = {\n    method: 'POST',\n    body: Object.entries(params).reduce((formData, [k, v]) => {\n      formData.append(k, v!);\n      return formData;\n    }, new FormData())\n  };\n\n  const resp = await fetch(`${Constants.urlShortenerBase}yourls-api.php`, fetchOpts);\n  if (!resp || !resp.ok) {\n    return null;\n  }\n\n  const res = await resp.json();\n  return res;\n}\n","import { SlingClient } from '@sourceacademy/sling-client';\nimport { ExceptionError } from 'c-slang/dist/errors/errors';\nimport { Variant } from 'c-slang/dist/types';\nimport _ from 'lodash';\nimport { SagaIterator } from 'redux-saga';\nimport { call, put, race, select, take } from 'redux-saga/effects';\nimport {\n  Ev3DevicePeripherals,\n  Ev3MotorData,\n  Ev3MotorTypes,\n  Ev3SensorData,\n  Ev3SensorTypes\n} from 'src/features/remoteExecution/RemoteExecutionEv3Types';\nimport {\n  Device,\n  DeviceSession,\n  deviceTypesById,\n  REMOTE_EXEC_CONNECT,\n  REMOTE_EXEC_DISCONNECT,\n  REMOTE_EXEC_FETCH_DEVICES,\n  WebSocketEndpointInformation\n} from 'src/features/remoteExecution/RemoteExecutionTypes';\nimport { store } from 'src/pages/createStore';\n\nimport { OverallState } from '../application/ApplicationTypes';\nimport { ExternalLibraryName } from '../application/types/ExternalTypes';\nimport { BEGIN_INTERRUPT_EXECUTION } from '../application/types/InterpreterTypes';\nimport { actions } from '../utils/ActionsHelper';\nimport { fetchDevices, getDeviceWSEndpoint } from './RequestsSaga';\nimport { safeTakeEvery as takeEvery, safeTakeLatest as takeLatest } from './SafeEffects';\n\nconst dummyLocation = {\n  start: { line: 0, column: 0 },\n  end: { line: 0, column: 0 }\n};\n\nexport function* remoteExecutionSaga(): SagaIterator {\n  yield takeLatest(REMOTE_EXEC_FETCH_DEVICES, function* () {\n    const [tokens, session]: [any, DeviceSession | undefined] = yield select(\n      (state: OverallState) => [\n        {\n          accessToken: state.session.accessToken,\n          refreshToken: state.session.refreshToken\n        },\n        state.session.remoteExecutionSession\n      ]\n    );\n    const devices: Device[] = yield call(fetchDevices, tokens);\n\n    yield put(actions.remoteExecUpdateDevices(devices));\n\n    if (!session) {\n      return;\n    }\n    const updatedDevice = devices.find(({ id }) => id === session.device.id);\n    if (updatedDevice) {\n      yield put(\n        actions.remoteExecUpdateSession({\n          ...session,\n          device: updatedDevice\n        })\n      );\n    }\n  });\n\n  yield takeEvery(\n    REMOTE_EXEC_CONNECT,\n    function* (action: ReturnType<typeof actions.remoteExecConnect>) {\n      const [tokens, session]: [any, DeviceSession | undefined] = yield select(\n        (state: OverallState) => [\n          {\n            accessToken: state.session.accessToken,\n            refreshToken: state.session.refreshToken\n          },\n          state.session.remoteExecutionSession\n        ]\n      );\n      const { device, workspace } = action.payload;\n      yield put(\n        actions.remoteExecUpdateSession({\n          device,\n          workspace,\n          connection: { status: 'CONNECTING' }\n        })\n      );\n      const endpoint: WebSocketEndpointInformation | null = yield call(\n        getDeviceWSEndpoint,\n        device,\n        tokens\n      );\n      if (!endpoint) {\n        yield put(\n          actions.remoteExecUpdateSession({\n            ...action.payload,\n            connection: { status: 'FAILED', error: 'Could not retrieve MQTT endpoint' }\n          })\n        );\n        return;\n      }\n\n      const oldClient = session?.connection.client;\n      if (oldClient) {\n        try {\n          oldClient.disconnect();\n        } catch {}\n      }\n      const client: SlingClient = new SlingClient({\n        clientId: `${endpoint.clientNamePrefix}${generateClientNonce()}`,\n        deviceId: endpoint.thingName,\n        websocketEndpoint: endpoint.endpoint\n      });\n      client.on('statusChange', isRunning => {\n        store.dispatch(\n          actions.updateWorkspace(workspace, {\n            isRunning\n          })\n        );\n      });\n      client.on('monitor', message => {\n        const port = message[0].split(':')[1];\n        const key = `port${port.substring(port.length - 1)}` as keyof Ev3DevicePeripherals;\n        const currentSession = store.getState().session.remoteExecutionSession!; // Guaranteed valid session\n\n        const dispatchAction = (peripheralData: Ev3MotorData | Ev3SensorData) =>\n          store.dispatch(\n            actions.remoteExecUpdateSession({\n              ...currentSession,\n              device: {\n                ...currentSession.device,\n                peripherals: {\n                  ..._.pickBy(\n                    currentSession.device.peripherals,\n                    p => Date.now() - p.lastUpdated < 3000\n                  ),\n                  [key]: { ...peripheralData, lastUpdated: Date.now() }\n                }\n              }\n            })\n          );\n\n        if (message[1].endsWith('motor')) {\n          const type = message[1] as Ev3MotorTypes;\n          const position = parseInt(message[2]);\n          const speed = parseInt(message[3]);\n          const peripheralData: Ev3MotorData = { type, position, speed };\n          dispatchAction(peripheralData);\n        } else {\n          const type = message[1] as Ev3SensorTypes;\n          const mode = message[2] as any;\n          const value = parseInt(message[3]);\n          const peripheralData: Ev3SensorData = { type, mode, value };\n          dispatchAction(peripheralData);\n        }\n      });\n\n      client.on('display', (message, type) => {\n        switch (type) {\n          case 'output':\n            store.dispatch(actions.handleConsoleLog(workspace, `${message}`));\n            break;\n          case 'error': {\n            const error = new ExceptionError(new Error(`${message}`), dummyLocation);\n            store.dispatch(actions.evalInterpreterError([error], workspace));\n            break;\n          }\n          case 'result':\n            store.dispatch(actions.evalInterpreterSuccess(message, workspace));\n            break;\n        }\n      });\n      const deviceType = deviceTypesById.get(device.type);\n\n      yield put(\n        actions.remoteExecUpdateSession({\n          device,\n          workspace,\n          connection: { status: 'CONNECTING', client, endpoint }\n        })\n      );\n      yield put(\n        actions.updateWorkspace(workspace, {\n          isRunning: false,\n          isEditorAutorun: false,\n          isDebugging: false,\n          externalLibrary: deviceType?.deviceLibraryName,\n          output: []\n        })\n      );\n      yield put(\n        actions.beginClearContext(\n          workspace,\n          {\n            variant: Variant.DEFAULT,\n            external: {\n              name: deviceType?.deviceLibraryName || ExternalLibraryName.NONE,\n              symbols: deviceType?.internalFunctions || []\n            },\n            globals: []\n          },\n          false\n        )\n      );\n      try {\n        const connectPromise = new Promise((resolve, reject) => {\n          try {\n            client.once('connect', () => resolve(true));\n            client.once('error', reject);\n            client.connect();\n          } catch {\n            reject();\n          }\n        });\n        const connectOrCancel: {\n          connect?: boolean;\n        } = yield race({\n          connect: connectPromise,\n          reconnect: take(REMOTE_EXEC_CONNECT),\n          disconnect: take(REMOTE_EXEC_DISCONNECT)\n        });\n        if (connectOrCancel.connect) {\n          yield put(\n            actions.remoteExecUpdateSession({\n              ...action.payload,\n              connection: { status: 'CONNECTED', client, endpoint }\n            })\n          );\n        } else {\n          client.disconnect();\n        }\n      } catch (err) {\n        client.disconnect();\n        yield put(\n          actions.remoteExecUpdateSession({\n            ...action.payload,\n            connection: { status: 'FAILED', client, error: err.toString() }\n          })\n        );\n      }\n    }\n  );\n\n  yield takeLatest(\n    REMOTE_EXEC_DISCONNECT,\n    function* (action: ReturnType<typeof actions.remoteExecDisconnect>) {\n      const session: DeviceSession | undefined = yield select(\n        (state: OverallState) => state.session.remoteExecutionSession\n      );\n      if (!session) {\n        return;\n      }\n      const oldClient = session.connection.client;\n      if (oldClient) {\n        oldClient.disconnect();\n      }\n      yield put(actions.remoteExecUpdateSession(undefined));\n      yield put(actions.externalLibrarySelect(ExternalLibraryName.NONE, session.workspace, true));\n    }\n  );\n\n  yield takeEvery(BEGIN_INTERRUPT_EXECUTION, function* () {\n    const session: DeviceSession | undefined = yield select(\n      (state: OverallState) => state.session.remoteExecutionSession\n    );\n    if (!session || session.connection.status !== 'CONNECTED') {\n      return;\n    }\n\n    session.connection.client.sendStop();\n  });\n}\n\nconst ALPHANUMERIC = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\nconst generateClientNonce = () =>\n  new Array(16)\n    .fill(undefined)\n    .map(_ => ALPHANUMERIC[Math.floor(Math.random() * ALPHANUMERIC.length)])\n    .join('');\n\nexport default remoteExecutionSaga;\n","import {\n  Context,\n  // findDeclaration,\n  interrupt,\n  runInContext\n} from 'c-slang';\nimport { InterruptedError } from 'c-slang/dist/errors/errors';\nimport { parse } from 'c-slang/dist/parser/parser';\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport { random } from 'lodash';\nimport Phaser from 'phaser';\nimport { SagaIterator } from 'redux-saga';\nimport { call, put, race, select, StrictEffect, take } from 'redux-saga/effects';\nimport EnvVisualizer from 'src/features/envVisualizer/EnvVisualizer';\n\nimport { EventType } from '../../features/achievement/AchievementTypes';\nimport DataVisualizer from '../../features/dataVisualizer/dataVisualizer';\nimport { DeviceSession } from '../../features/remoteExecution/RemoteExecutionTypes';\nimport {\n  isSourceLanguage,\n  OverallState,\n  styliseSublanguage\n} from '../application/ApplicationTypes';\nimport { externalLibraries, ExternalLibraryName } from '../application/types/ExternalTypes';\nimport {\n  BEGIN_DEBUG_PAUSE,\n  BEGIN_INTERRUPT_EXECUTION,\n  DEBUG_RESET,\n  DEBUG_RESUME,\n  HIGHLIGHT_LINE\n} from '../application/types/InterpreterTypes';\nimport { Library, Testcase, TestcaseType, TestcaseTypes } from '../assessment/AssessmentTypes';\nimport { actions } from '../utils/ActionsHelper';\nimport DisplayBufferService from '../utils/DisplayBufferService';\nimport {\n  getBlockExtraMethodsString,\n  getDifferenceInMethods,\n  getRestoreExtraMethodsString,\n  getStoreExtraMethodsString,\n  // highlightClean,\n  // highlightLine,\n  makeElevatedContext,\n  visualizeEnv\n} from '../utils/JsSlangHelper';\nimport { showSuccessMessage, showWarningMessage } from '../utils/NotificationsHelper';\nimport { notifyProgramEvaluated } from '../workspace/WorkspaceActions';\nimport {\n  ADD_HTML_CONSOLE_ERROR,\n  BEGIN_CLEAR_CONTEXT,\n  CHAPTER_SELECT,\n  CHECK_EDITOR,\n  END_CLEAR_CONTEXT,\n  EVAL_EDITOR,\n  EVAL_EDITOR_AND_TESTCASES,\n  EVAL_REPL,\n  EVAL_SILENT,\n  EVAL_TESTCASE,\n  NAV_DECLARATION,\n  PLAYGROUND_EXTERNAL_SELECT,\n  TOGGLE_EDITOR_AUTORUN,\n  WorkspaceLocation\n} from '../workspace/WorkspaceTypes';\nimport { safeTakeEvery as takeEvery, safeTakeLeading as takeLeading } from './SafeEffects';\n\nexport default function* WorkspaceSaga(): SagaIterator {\n  let context: Context;\n\n  yield takeEvery(\n    ADD_HTML_CONSOLE_ERROR,\n    function* (action: ReturnType<typeof actions.addHtmlConsoleError>) {\n      yield put(\n        actions.handleConsoleLog(action.payload.workspaceLocation, action.payload.errorMsg)\n      );\n    }\n  );\n\n  yield takeEvery(CHECK_EDITOR, function* (action: ReturnType<typeof actions.checkEditor>) {\n    const workspaceLocation = action.payload.workspaceLocation;\n    yield* checkEditor(workspaceLocation);\n  });\n\n  yield takeEvery(EVAL_EDITOR, function* (action: ReturnType<typeof actions.evalEditor>) {\n    const workspaceLocation = action.payload.workspaceLocation;\n    yield* evalEditor(workspaceLocation);\n  });\n\n\n  yield takeEvery(\n    TOGGLE_EDITOR_AUTORUN,\n    function* (action: ReturnType<typeof actions.toggleEditorAutorun>): any {\n      const workspaceLocation = action.payload.workspaceLocation;\n      const isEditorAutorun = yield select(\n        (state: OverallState) => state.workspaces[workspaceLocation].isEditorAutorun\n      );\n      yield call(showWarningMessage, 'Autorun ' + (isEditorAutorun ? 'Started' : 'Stopped'), 750);\n    }\n  );\n\n  yield takeEvery(EVAL_REPL, function* (action: ReturnType<typeof actions.evalRepl>) {\n    const workspaceLocation = action.payload.workspaceLocation;\n    const code: string = yield select(\n      (state: OverallState) => state.workspaces[workspaceLocation].replValue\n    );\n    const execTime: number = yield select(\n      (state: OverallState) => state.workspaces[workspaceLocation].execTime\n    );\n    yield put(actions.beginInterruptExecution(workspaceLocation));\n    yield put(actions.clearReplInput(workspaceLocation));\n    yield put(actions.sendReplInputToOutput(code, workspaceLocation));\n    context = yield select((state: OverallState) => state.workspaces[workspaceLocation].context);\n    yield call(evalCode, code, context, execTime, workspaceLocation, EVAL_REPL);\n  });\n\n  yield takeEvery(DEBUG_RESUME, function* (action: ReturnType<typeof actions.debuggerResume>) {\n    const workspaceLocation = action.payload.workspaceLocation;\n    const code: string = yield select(\n      // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n      (state: OverallState) => state.workspaces[workspaceLocation].editorTabs[0].value\n    );\n    const execTime: number = yield select(\n      (state: OverallState) => state.workspaces[workspaceLocation].execTime\n    );\n    yield put(actions.beginInterruptExecution(workspaceLocation));\n    /** Clear the context, with the same chapter and externalSymbols as before. */\n    yield put(actions.clearReplOutput(workspaceLocation));\n    context = yield select((state: OverallState) => state.workspaces[workspaceLocation].context);\n    yield put(actions.highlightEditorLine([], workspaceLocation));\n    yield call(evalCode, code, context, execTime, workspaceLocation, DEBUG_RESUME);\n  });\n\n  yield takeEvery(DEBUG_RESET, function* (action: ReturnType<typeof actions.debuggerReset>) {\n    const workspaceLocation = action.payload.workspaceLocation;\n    context = yield select((state: OverallState) => state.workspaces[workspaceLocation].context);\n    yield put(actions.clearReplOutput(workspaceLocation));\n    yield put(actions.highlightEditorLine([], workspaceLocation));\n    context.runtime.break = false;\n    lastDebuggerResult = undefined;\n  });\n\n  yield takeEvery(\n    HIGHLIGHT_LINE,\n    function* (action: ReturnType<typeof actions.highlightEditorLine>) {\n      const highlightedLines = action.payload.highlightedLines;\n      if (highlightedLines.length === 0) {\n        // highlightClean();\n      } else {\n        // highlightLine(highlightedLines[0]);\n      }\n      yield;\n    }\n  );\n\n  yield takeEvery(EVAL_TESTCASE, function* (action: ReturnType<typeof actions.evalTestcase>) {\n    yield put(actions.addEvent([EventType.RUN_TESTCASE]));\n    const workspaceLocation = action.payload.workspaceLocation;\n    const index = action.payload.testcaseId;\n    yield* runTestCase(workspaceLocation, index);\n  });\n\n  yield takeEvery(CHAPTER_SELECT, function* (action: ReturnType<typeof actions.chapterSelect>) {\n    const { workspaceLocation, chapter: newChapter, variant: newVariant } = action.payload;\n    const [oldVariant, oldChapter, symbols, globals, externalLibraryName]: [\n      Variant,\n      Chapter,\n      string[],\n      Array<[string, any]>,\n      ExternalLibraryName\n    ] = yield select((state: OverallState) => [\n      state.workspaces[workspaceLocation].context.variant,\n      state.workspaces[workspaceLocation].context.externalSymbols,\n      state.workspaces[workspaceLocation].globals,\n      state.workspaces[workspaceLocation].externalLibrary\n    ]);\n\n    const chapterChanged: boolean = newChapter !== oldChapter || newVariant !== oldVariant;\n    const toChangeChapter: boolean =\n      chapterChanged;\n\n    if (toChangeChapter) {\n      const library: Library = {\n        variant: newVariant,\n        external: {\n          name: externalLibraryName,\n          symbols\n        },\n        globals\n      };\n      yield put(actions.beginClearContext(workspaceLocation, library, false));\n      yield put(actions.clearReplOutput(workspaceLocation));\n      yield put(actions.debuggerReset(workspaceLocation));\n      yield call(\n        showSuccessMessage,\n        `Switched to ${styliseSublanguage(newChapter, newVariant)}`,\n        1000\n      );\n    }\n  });\n\n  /**\n   * Note that the PLAYGROUND_EXTERNAL_SELECT action is made to\n   * select the library for playground.\n   * This is because assessments do not have a chapter & library select, the question\n   * specifies the chapter and library to be used.\n   *\n   * To abstract this to assessments, the state structure must be manipulated to store\n   * the external library name in a WorkspaceState (as compared to IWorkspaceManagerState).\n   *\n   * @see IWorkspaceManagerState @see WorkspaceState\n   */\n  yield takeEvery(\n    PLAYGROUND_EXTERNAL_SELECT,\n    function* (action: ReturnType<typeof actions.externalLibrarySelect>) {\n      const { workspaceLocation, externalLibraryName: newExternalLibraryName } = action.payload;\n      const [globals, oldExternalLibraryName]: [\n        Array<[string, any]>,\n        ExternalLibraryName\n      ] = yield select((state: OverallState) => [\n        state.workspaces[workspaceLocation].globals,\n        state.workspaces[workspaceLocation].externalLibrary\n      ]);\n      const symbols = externalLibraries.get(newExternalLibraryName)!;\n      const library: Library = {\n        external: {\n          name: newExternalLibraryName,\n          symbols\n        },\n        globals\n      };\n      if (newExternalLibraryName !== oldExternalLibraryName || action.payload.initialise) {\n        yield put(actions.changeExternalLibrary(newExternalLibraryName, workspaceLocation));\n        yield put(actions.beginClearContext(workspaceLocation, library, true));\n        yield put(actions.clearReplOutput(workspaceLocation));\n        if (!action.payload.initialise) {\n          yield call(showSuccessMessage, `Switched to ${newExternalLibraryName} library`, 1000);\n        }\n      }\n    }\n  );\n\n  /**\n   * Handles the side effect of resetting the WebGL context when context is reset.\n   *\n   * @see webGLgraphics.js under 'public/externalLibs/graphics' for information on\n   * the function.\n   */\n  yield takeEvery(\n    BEGIN_CLEAR_CONTEXT,\n    function* (action: ReturnType<typeof actions.beginClearContext>) {\n      DataVisualizer.clear();\n      EnvVisualizer.clear();\n      const globals: Array<[string, any]> = action.payload.library.globals as Array<[string, any]>;\n      for (const [key, value] of globals) {\n        window[key] = value;\n      }\n      yield put(\n        actions.endClearContext(\n          {\n            ...action.payload.library,\n            moduleParams: {\n              runes: {},\n              phaser: Phaser\n            }\n          },\n          action.payload.workspaceLocation\n        )\n      );\n      yield undefined;\n    }\n  );\n\n  yield takeEvery(\n    NAV_DECLARATION,\n    function* (action: ReturnType<typeof actions.navigateToDeclaration>) {\n      const workspaceLocation = action.payload.workspaceLocation;\n      // const code: string = yield select(\n      //   // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n      //   (state: OverallState) => state.workspaces[workspaceLocation].editorTabs[0].value\n      // );\n      context = yield select((state: OverallState) => state.workspaces[workspaceLocation].context);\n\n      // const result = findDeclaration(code, context, {\n      //   line: action.payload.cursorPosition.row + 1,\n      //   column: action.payload.cursorPosition.column\n      // });\n      // if (result) {\n      //   yield put(\n      //     actions.moveCursor(action.payload.workspaceLocation, {\n      //       row: result.start.line - 1,\n      //       column: result.start.column\n      //     })\n      //   );\n      // }\n    }\n  );\n\n  yield takeLeading(\n    EVAL_EDITOR_AND_TESTCASES,\n    function* (action: ReturnType<typeof actions.runAllTestcases>) {\n      const { workspaceLocation } = action.payload;\n\n      yield call(evalEditor, workspaceLocation);\n\n      const testcases: Testcase[] = yield select(\n        (state: OverallState) => state.workspaces[workspaceLocation].editorTestcases\n      );\n      // Avoid displaying message if there are no testcases\n      if (testcases.length > 0) {\n        // Display a message to the user\n        yield call(showSuccessMessage, `Running all testcases!`, 2000);\n        for (const idx of testcases.keys()) {\n          // break each testcase up into separate event loop iterations\n          // so that the UI updates\n          yield new Promise(resolve => setTimeout(resolve, 0));\n\n          const programSucceeded: boolean = yield call(runTestCase, workspaceLocation, idx);\n          // Prematurely terminate if execution of the program failed (not the testcase)\n          if (!programSucceeded) {\n            return;\n          }\n        }\n      }\n    }\n  );\n}\n\nlet lastDebuggerResult: any;\nfunction* updateInspector(workspaceLocation: WorkspaceLocation): SagaIterator {\n  try {\n    const start = lastDebuggerResult.context.runtime.nodes[0].loc.start.line - 1;\n    const end = lastDebuggerResult.context.runtime.nodes[0].loc.end.line - 1;\n    yield put(actions.highlightEditorLine([start, end], workspaceLocation));\n    visualizeEnv(lastDebuggerResult);\n  } catch (e) {\n    yield put(actions.highlightEditorLine([], workspaceLocation));\n    // most likely harmless, we can pretty much ignore this.\n    // half of the time this comes from execution ending or a stack overflow and\n    // the context goes missing.\n  }\n}\n\nfunction* clearContext(workspaceLocation: WorkspaceLocation, program: string) {\n  const [symbols, externalLibraryName, globals, variant]: [\n    string[],\n    ExternalLibraryName,\n    Array<[string, any]>,\n    Variant\n  ] = yield select((state: OverallState) => [\n    state.workspaces[workspaceLocation].context.externalSymbols,\n    state.workspaces[workspaceLocation].externalLibrary,\n    state.workspaces[workspaceLocation].globals,\n    state.workspaces[workspaceLocation].context.variant\n  ]);\n\n  const library = {\n    variant,\n    external: {\n      name: externalLibraryName,\n      symbols\n    },\n    globals\n  };\n\n  // Clear the context, with the same chapter and externalSymbols as before.\n  yield put(actions.beginClearContext(workspaceLocation, library, false));\n  // Wait for the clearing to be done.\n  yield take(END_CLEAR_CONTEXT);\n}\n\nexport function* dumpDisplayBuffer(\n  workspaceLocation: WorkspaceLocation\n): Generator<StrictEffect, void, any> {\n  yield put(actions.handleConsoleLog(workspaceLocation, ...DisplayBufferService.dump()));\n}\n\nexport function* checkEditor(\n  workspaceLocation: WorkspaceLocation\n): Generator<StrictEffect, void, any> {\n  const [editorCode]: [\n    string,\n  ] = yield select((state: OverallState) => [\n    // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n    state.workspaces[workspaceLocation].editorTabs[0].value,\n  ]);\n\n  // End any code that is running right now.\n  yield put(actions.beginInterruptExecution(workspaceLocation));\n  yield* clearContext(workspaceLocation, editorCode);\n  yield put(actions.clearReplOutput(workspaceLocation));\n  const context = yield select(\n    (state: OverallState) => state.workspaces[workspaceLocation].context\n  );\n  // Check for initial syntax errors. If there are errors, we will print the error messages.\n  parse(editorCode, context)\n  if (context.errors.length > 0) {\n    yield* dumpDisplayBuffer(workspaceLocation);\n    yield put(actions.evalInterpreterError(context.errors, workspaceLocation));\n    // for achievement event tracking\n    const events =[EventType.ERROR];\n    yield put(actions.addEvent(events));\n  } else {\n    yield* dumpDisplayBuffer(workspaceLocation);\n    yield put(actions.evalInterpreterSuccess('Ready to run!', workspaceLocation));\n  }\n}\n\nexport function* evalEditor(\n  workspaceLocation: WorkspaceLocation\n): Generator<StrictEffect, void, any> {\n  const [prepend, editorCode, execTime, remoteExecutionSession]: [\n    string,\n    string,\n    number,\n    DeviceSession | undefined\n  ] = yield select((state: OverallState) => [\n    // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n    state.workspaces[workspaceLocation].editorTabs[0].prependValue,\n    state.workspaces[workspaceLocation].editorTabs[0].value,\n    state.workspaces[workspaceLocation].execTime,\n    state.session.remoteExecutionSession\n  ]);\n\n  yield put(actions.addEvent([EventType.RUN_CODE]));\n\n  if (remoteExecutionSession && remoteExecutionSession.workspace === workspaceLocation) {\n    yield put(actions.remoteExecRun(editorCode));\n  } else {\n    // End any code that is running right now.\n    yield put(actions.beginInterruptExecution(workspaceLocation));\n    yield* clearContext(workspaceLocation, editorCode);\n    yield put(actions.clearReplOutput(workspaceLocation));\n    const context = yield select(\n      (state: OverallState) => state.workspaces[workspaceLocation].context\n    );\n    let value = editorCode;\n    // Check for initial syntax errors. If there are errors, we continue with\n    // eval and let it print the error messages.\n    if (isSourceLanguage(context.chapter)) {\n      parse(value, context);\n    }\n    if (!context.errors.length) {\n      // Otherwise we step through the breakpoints one by one and check them.\n      const exploded = editorCode.split('\\n');\n      const breakpoints: string[] = yield select(\n        // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n        (state: OverallState) => state.workspaces[workspaceLocation].editorTabs[0].breakpoints\n      );\n      for (const b in breakpoints) {\n        if (typeof b !== 'string') {\n          continue;\n        }\n\n        const index: number = +b;\n        context.errors = [];\n        exploded[index] = 'debugger;' + exploded[index];\n        value = exploded.join('\\n');\n        if (isSourceLanguage(context.chapter)) {\n          parse(value, context);\n        }\n        if (context.errors.length) {\n          const msg = 'Hint: Misplaced breakpoint at line ' + (index + 1) + '.';\n          yield put(actions.sendReplInputToOutput(msg, workspaceLocation));\n        }\n      }\n    }\n    // Clear the errors on the context before any further evaluation.\n    context.errors = [];\n\n    // Evaluate the prepend silently with a privileged context, if it exists\n    if (prepend.length) {\n      const elevatedContext = makeElevatedContext(context);\n      yield call(evalCode, prepend, elevatedContext, execTime, workspaceLocation, EVAL_SILENT);\n      // Block use of methods from privileged context\n      yield* blockExtraMethods(elevatedContext, context, execTime, workspaceLocation);\n    }\n\n    yield call(evalCode, value, context, execTime, workspaceLocation, EVAL_EDITOR);\n  }\n}\n\nexport function* runTestCase(\n  workspaceLocation: WorkspaceLocation,\n  index: number\n): Generator<StrictEffect, boolean, any> {\n  const [prepend, value, postpend, testcase]: [string, string, string, string] = yield select(\n    (state: OverallState) => {\n      // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n      const prepend = state.workspaces[workspaceLocation].editorTabs[0].prependValue;\n      const value = state.workspaces[workspaceLocation].editorTabs[0].value;\n      const postpend = state.workspaces[workspaceLocation].editorTabs[0].postpendValue;\n      const testcase = state.workspaces[workspaceLocation].editorTestcases[index].program;\n      return [prepend, value, postpend, testcase] as [string, string, string, string];\n    }\n  );\n  const type: TestcaseType = yield select(\n    (state: OverallState) => state.workspaces[workspaceLocation].editorTestcases[index].type\n  );\n  const execTime: number = yield select(\n    (state: OverallState) => state.workspaces[workspaceLocation].execTime\n  );\n\n  yield* clearContext(workspaceLocation, value);\n\n  // Do NOT clear the REPL output!\n\n  /**\n   *  Shard a new privileged context elevated to use Source chapter 4 for testcases - enables\n   *  grader programs in postpend to run as expected without raising interpreter errors\n   *  But, do not persist this context to the workspace state - this prevent students from using\n   *  this elevated context to run dis-allowed code beyond the current chapter from the REPL\n   */\n  const context: Context<any> = yield select(\n    (state: OverallState) => state.workspaces[workspaceLocation].context\n  );\n\n  // Execute prepend silently in privileged context\n  const elevatedContext = makeElevatedContext(context);\n  yield call(evalCode, prepend, elevatedContext, execTime, workspaceLocation, EVAL_SILENT);\n\n  // Block use of methods from privileged context using a randomly generated blocking key\n  // Then execute student program silently in the original workspace context\n  const blockKey = String(random(1048576, 68719476736));\n  yield* blockExtraMethods(elevatedContext, context, execTime, workspaceLocation, blockKey);\n  yield call(evalCode, value, context, execTime, workspaceLocation, EVAL_SILENT);\n\n  // Halt execution if the student's code in the editor results in an error\n  if (context.errors.length) {\n    yield put(actions.evalTestcaseFailure(context.errors, workspaceLocation, index));\n    return false;\n  }\n\n  // Execute postpend silently back in privileged context, if it exists\n  if (postpend) {\n    // TODO: consider doing a swap. If the user has modified any of the variables,\n    // i.e. reusing any of the \"reserved\" names, prevent it from being accessed in the REPL.\n    yield* restoreExtraMethods(elevatedContext, context, execTime, workspaceLocation, blockKey);\n    yield call(evalCode, postpend, elevatedContext, execTime, workspaceLocation, EVAL_SILENT);\n    yield* blockExtraMethods(elevatedContext, context, execTime, workspaceLocation, blockKey);\n  }\n  // Finally execute the testcase function call in the privileged context\n  yield* evalTestCode(testcase, elevatedContext, execTime, workspaceLocation, index, type);\n  return true;\n}\n\nexport function* blockExtraMethods(\n  elevatedContext: Context,\n  context: Context,\n  execTime: number,\n  workspaceLocation: WorkspaceLocation,\n  unblockKey?: string\n) {\n  // Extract additional methods available in the elevated context relative to the context\n  const toBeBlocked = getDifferenceInMethods(elevatedContext, context);\n  if (unblockKey) {\n    const storeValues = getStoreExtraMethodsString(toBeBlocked, unblockKey);\n    yield call(evalCode, storeValues, elevatedContext, execTime, workspaceLocation, EVAL_SILENT);\n  }\n\n  const nullifier = getBlockExtraMethodsString(toBeBlocked);\n  yield call(evalCode, nullifier, elevatedContext, execTime, workspaceLocation, EVAL_SILENT);\n}\n\nexport function* restoreExtraMethods(\n  elevatedContext: Context,\n  context: Context,\n  execTime: number,\n  workspaceLocation: WorkspaceLocation,\n  unblockKey: string\n) {\n  const toUnblock = getDifferenceInMethods(elevatedContext, context);\n  const restorer = getRestoreExtraMethodsString(toUnblock, unblockKey);\n  yield call(evalCode, restorer, elevatedContext, execTime, workspaceLocation, EVAL_SILENT);\n}\n\nexport function* evalCode(\n  code: string,\n  context: Context,\n  execTime: number,\n  workspaceLocation: WorkspaceLocation,\n  actionType: string\n): SagaIterator {\n  const stepLimit: number = yield select(\n    (state: OverallState) => state.workspaces[workspaceLocation].stepLimit\n  );\n\n  const { result, interrupted, paused } = yield race({\n    result:\n      call(runInContext, code, context, {\n            scheduler: 'preemptive',\n            executionMethod: 'interpreter',\n            originalMaxExecTime: execTime,\n            stepLimit: stepLimit,\n            variant: Variant.DEFAULT,\n            useSubst: false\n          }),\n\n    /**\n     * A BEGIN_INTERRUPT_EXECUTION signals the beginning of an interruption,\n     * i.e the trigger for the interpreter to interrupt execution.\n     */\n    interrupted: take(BEGIN_INTERRUPT_EXECUTION),\n    paused: take(BEGIN_DEBUG_PAUSE)\n  });\n  console.log('result:', result)\n  if (interrupted) {\n    interrupt(context);\n    /* Redundancy, added ensure that interruption results in an error. */\n    context.errors.push(new InterruptedError(context.runtime.nodes[0]));\n    yield put(actions.debuggerReset(workspaceLocation));\n    yield put(actions.endInterruptExecution(workspaceLocation));\n    yield call(showWarningMessage, 'Execution aborted', 750);\n    return;\n  }\n\n  if (paused) {\n    yield put(actions.endDebuggerPause(workspaceLocation));\n    yield call(updateInspector, workspaceLocation);\n    yield call(showWarningMessage, 'Execution paused', 750);\n    return;\n  }\n\n  if (actionType === EVAL_EDITOR) {\n    lastDebuggerResult = result;\n  }\n  yield call(updateInspector, workspaceLocation);\n\n  if (\n    result.status !== 'suspended' &&\n    result.status !== 'finished' &&\n    result.status !== 'suspended-non-det'\n  ) {\n    yield* dumpDisplayBuffer(workspaceLocation);\n    yield put(actions.evalInterpreterError(context.errors, workspaceLocation, context['stdout']));\n\n    // we need to parse again, but preserve the errors in context\n    const oldErrors = context.errors;\n    context.errors = [];\n    context.errors = oldErrors;\n    // for achievement event tracking\n    const events = context.errors.length > 0 ? [EventType.ERROR] : [];\n    yield put(actions.addEvent(events));\n    return;\n  } else if (result.status === 'suspended') {\n    yield put(actions.endDebuggerPause(workspaceLocation));\n    yield put(actions.evalInterpreterSuccess('Breakpoint hit!', workspaceLocation));\n    return;\n  } \n  yield* dumpDisplayBuffer(workspaceLocation);\n  // Do not write interpreter output to REPL, if executing chunks (e.g. prepend/postpend blocks)\n  if (actionType !== EVAL_SILENT) {\n    yield put(actions.evalInterpreterSuccess(result.value, workspaceLocation));\n  }\n\n  // For EVAL_EDITOR and EVAL_REPL, we send notification to workspace that a program has been evaluated\n  if (actionType === EVAL_EDITOR || actionType === EVAL_REPL) {\n    if (context.errors.length > 0) {\n      yield put(actions.addEvent([EventType.ERROR]));\n    }\n    yield put(notifyProgramEvaluated(result, lastDebuggerResult, code, context, workspaceLocation));\n  }\n}\n\nexport function* evalTestCode(\n  code: string,\n  context: Context,\n  execTime: number,\n  workspaceLocation: WorkspaceLocation,\n  index: number,\n  type: TestcaseType\n) {\n  yield put(actions.resetTestcase(workspaceLocation, index));\n  const { result, interrupted } = yield race({\n    result: call(runInContext, code, context, {\n      scheduler: 'preemptive',\n      originalMaxExecTime: execTime,\n      throwInfiniteLoops: true\n    }),\n    /**\n     * A BEGIN_INTERRUPT_EXECUTION signals the beginning of an interruption,\n     * i.e the trigger for the interpreter to interrupt execution.\n     */\n    interrupted: take(BEGIN_INTERRUPT_EXECUTION)\n  });\n\n  if (interrupted) {\n    interrupt(context);\n    yield* dumpDisplayBuffer(workspaceLocation);\n    // Redundancy, added ensure that interruption results in an error.\n    context.errors.push(new InterruptedError(context.runtime.nodes[0]));\n    yield put(actions.endInterruptExecution(workspaceLocation));\n    yield call(showWarningMessage, `Execution of testcase ${index} aborted`, 750);\n    return;\n  }\n\n  yield* dumpDisplayBuffer(workspaceLocation);\n  /** result.status here is either 'error' or 'finished'; 'suspended' is not possible\n   *  since debugger is presently disabled in assessment and grading environments\n   */\n  if (result.status === 'error') {\n    yield put(actions.evalInterpreterError(context.errors, workspaceLocation));\n    yield put(actions.evalTestcaseFailure(context.errors, workspaceLocation, index));\n  } else if (result.status === 'finished') {\n    // Execution of the testcase is successful, i.e. no errors were raised\n    yield put(actions.evalInterpreterSuccess(result.value, workspaceLocation));\n    yield put(actions.evalTestcaseSuccess(result.value, workspaceLocation, index));\n  }\n\n  // If a opaque testcase was executed, remove its output from the REPL\n  if (type === TestcaseTypes.opaque) {\n    yield put(actions.clearReplOutputLast(workspaceLocation));\n  }\n}\n","import { SagaIterator } from 'redux-saga';\nimport { fork } from 'redux-saga/effects';\n\nimport { mockBackendSaga } from '../mocks/BackendMocks';\nimport Constants from '../utils/Constants';\nimport AchievementSaga from './AchievementSaga';\nimport BackendSaga from './BackendSaga';\nimport GitHubPersistenceSaga from './GitHubPersistenceSaga';\nimport LoginSaga from './LoginSaga';\nimport PersistenceSaga from './PersistenceSaga';\nimport PlaygroundSaga from './PlaygroundSaga';\nimport RemoteExecutionSaga from './RemoteExecutionSaga';\nimport WorkspaceSaga from './WorkspaceSaga';\n\nexport default function* MainSaga(): SagaIterator {\n  yield fork(Constants.useBackend ? BackendSaga : mockBackendSaga);\n  yield fork(WorkspaceSaga);\n  yield fork(LoginSaga);\n  yield fork(PlaygroundSaga);\n  yield fork(AchievementSaga);\n  yield fork(PersistenceSaga);\n  yield fork(GitHubPersistenceSaga);\n  yield fork(RemoteExecutionSaga);\n}\n","import { Chapter, Variant } from 'c-slang/dist/types';\nimport { compressToUTF16, decompressFromUTF16 } from 'lz-string';\n\nimport { OverallState } from '../commons/application/ApplicationTypes';\nimport { ExternalLibraryName } from '../commons/application/types/ExternalTypes';\nimport { SessionState } from '../commons/application/types/SessionTypes';\nimport { showWarningMessage } from '../commons/utils/NotificationsHelper';\nimport { AchievementItem } from '../features/achievement/AchievementTypes';\n\nexport type SavedState = {\n  session: Partial<SessionState>;\n  achievements: AchievementItem[];\n  playgroundEditorValue: string;\n  playgroundIsEditorAutorun: boolean;\n  playgroundSourceChapter: number;\n  playgroundSourceVariant: Variant;\n  playgroundExternalLibrary: ExternalLibraryName;\n};\n\nexport const loadStoredState = (): SavedState | undefined => {\n  try {\n    const serializedState = localStorage.getItem('storedState');\n    if (!serializedState) {\n      return undefined;\n    }\n    const decompressed = decompressFromUTF16(serializedState);\n    if (!decompressed) {\n      return undefined;\n    }\n    return JSON.parse(decompressed) as SavedState;\n  } catch (err) {\n    showWarningMessage('Error loading from local storage');\n    return undefined;\n  }\n};\n\nexport const saveState = (state: OverallState) => {\n  try {\n    const stateToBeSaved: SavedState = {\n      session: {\n        accessToken: state.session.accessToken,\n        refreshToken: state.session.refreshToken,\n        courseRegId: state.session.courseRegId,\n        role: state.session.role,\n        name: state.session.name,\n        userId: state.session.userId,\n        courses: state.session.courses,\n        courseId: state.session.courseId,\n        courseName: state.session.courseName,\n        courseShortName: state.session.courseShortName,\n        viewable: state.session.viewable,\n        enableGame: state.session.enableGame,\n        enableAchievements: state.session.enableAchievements,\n        enableSourcecast: state.session.enableSourcecast,\n        moduleHelpText: state.session.moduleHelpText,\n        assetsPrefix: state.session.assetsPrefix,\n        assessmentConfigurations: state.session.assessmentConfigurations,\n        githubAccessToken: state.session.githubAccessToken\n      },\n      achievements: state.achievement.achievements,\n      // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n      playgroundEditorValue: state.workspaces.playground.editorTabs[0].value,\n      playgroundIsEditorAutorun: state.workspaces.playground.isEditorAutorun,\n      playgroundSourceChapter: Chapter.CALC,\n      playgroundSourceVariant: state.workspaces.playground.context.variant,\n      playgroundExternalLibrary: state.workspaces.playground.externalLibrary\n    };\n    const serialized = compressToUTF16(JSON.stringify(stateToBeSaved));\n    localStorage.setItem('storedState', serialized);\n  } catch (err) {\n    showWarningMessage('Error saving to local storage');\n  }\n};\n","import { Chapter } from 'c-slang/dist/types';\nimport { throttle } from 'lodash';\nimport { applyMiddleware, compose, createStore as _createStore } from 'redux';\nimport createSagaMiddleware from 'redux-saga';\n\nimport { defaultState } from '../commons/application/ApplicationTypes';\nimport createRootReducer from '../commons/application/reducers/RootReducer';\nimport MainSaga from '../commons/sagas/MainSaga';\nimport { generateOctokitInstance } from '../commons/utils/GitHubPersistenceHelper';\nimport { loadStoredState, SavedState, saveState } from './localStorage';\n\nexport const store = createStore();\n\nexport function createStore() {\n  const sagaMiddleware = createSagaMiddleware();\n  const middleware = [sagaMiddleware];\n\n  const composeEnhancers = (window as any).__REDUX_DEVTOOLS_EXTENSION_COMPOSE__\n    ? (window as any).__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({\n        serialize: true,\n        maxAge: 300\n      }) || compose\n    : compose;\n\n  const initialStore = loadStore(loadStoredState()) || defaultState;\n\n  const enhancers = composeEnhancers(applyMiddleware(...middleware));\n\n  const createdStore = _createStore(createRootReducer(), initialStore as any, enhancers);\n  sagaMiddleware.run(MainSaga);\n\n  createdStore.subscribe(\n    throttle(() => {\n      saveState(createdStore.getState());\n    }, 1000)\n  );\n\n  return createdStore;\n}\n\nfunction loadStore(loadedStore: SavedState | undefined) {\n  if (!loadedStore) {\n    return undefined;\n  }\n  return {\n    ...defaultState,\n    session: {\n      ...defaultState.session,\n      ...(loadedStore.session ? loadedStore.session : {}),\n      githubOctokitObject: {\n        octokit: loadedStore.session.githubAccessToken\n          ? generateOctokitInstance(loadedStore.session.githubAccessToken)\n          : undefined\n      }\n    },\n    workspaces: {\n      ...defaultState.workspaces,\n      playground: {\n        ...defaultState.workspaces.playground,\n        editorTabs: loadedStore.playgroundEditorValue\n          ? // TODO: Hardcoded to make use of the first editor tab. Rewrite after editor tabs are added.\n            [\n              {\n                value: loadedStore.playgroundEditorValue,\n                prependValue: '',\n                postpendValue: '',\n                highlightedLines: [],\n                breakpoints: []\n              }\n            ]\n          : defaultState.workspaces.playground.editorTabs,\n        isEditorAutorun: loadedStore.playgroundIsEditorAutorun\n          ? loadedStore.playgroundIsEditorAutorun\n          : defaultState.workspaces.playground.isEditorAutorun,\n        externalLibrary: loadedStore.playgroundExternalLibrary\n          ? loadedStore.playgroundExternalLibrary\n          : defaultState.workspaces.playground.externalLibrary,\n        context: {\n          ...defaultState.workspaces.playground.context,\n          chapter: loadedStore.playgroundSourceChapter\n            ? loadedStore.playgroundSourceChapter\n            : Chapter.CALC,\n          variant: loadedStore.playgroundSourceVariant\n            ? loadedStore.playgroundSourceVariant\n            : defaultState.workspaces.playground.context.variant\n        }\n      }\n    }\n  };\n}\n","import { SlingClient } from '@sourceacademy/sling-client';\nimport { Chapter } from 'c-slang/dist/types';\nimport { ExternalLibraryName } from 'src/commons/application/types/ExternalTypes';\nimport { WorkspaceLocation } from 'src/commons/workspace/WorkspaceTypes';\n\nimport { Ev3DevicePeripherals } from './RemoteExecutionEv3Types';\n\nexport const REMOTE_EXEC_FETCH_DEVICES = 'REMOTE_EXEC_FETCH_DEVICES';\nexport const REMOTE_EXEC_UPDATE_DEVICES = 'REMOTE_EXEC_UPDATE_DEVICES';\nexport const REMOTE_EXEC_UPDATE_SESSION = 'REMOTE_EXEC_UPDATE_SESSION';\n\nexport const REMOTE_EXEC_CONNECT = 'REMOTE_EXEC_CONNECT';\nexport const REMOTE_EXEC_DISCONNECT = 'REMOTE_EXEC_DISCONNECT';\n\nexport const REMOTE_EXEC_RUN = 'REMOTE_EXEC_RUN';\nexport const REMOTE_EXEC_REPL_INPUT = 'REMOTE_EXEC_REPL_INPUT';\n\nexport interface Device {\n  id: number;\n  title: string;\n  secret: string;\n  type: string;\n  peripherals?: Ev3DevicePeripherals;\n}\n\nexport interface WebSocketEndpointInformation {\n  endpoint: string;\n  clientNamePrefix: string;\n  thingName: string;\n}\n\nexport type DeviceConnection =\n  | { status: 'CONNECTING'; client?: SlingClient; endpoint?: WebSocketEndpointInformation }\n  | { status: 'CONNECTED'; client: SlingClient; endpoint: WebSocketEndpointInformation }\n  | { status: 'FAILED'; error?: string; client?: SlingClient };\n\nexport interface DeviceSession {\n  workspace: WorkspaceLocation;\n  device: Device;\n  connection: DeviceConnection;\n}\n\nexport interface DeviceType {\n  id: string;\n  name: string;\n  internalFunctions: string[];\n  languageChapter: Chapter;\n  deviceLibraryName: ExternalLibraryName;\n}\n\nexport const deviceTypes: DeviceType[] = [\n  {\n    id: 'EV3',\n    name: 'Lego Mindstorms EV3',\n    // This list must be in the same order as the list here:\n    // https://github.com/source-academy/sinter/blob/ev3/devices/ev3/src/ev3_functions.c#L652\n    internalFunctions: [\n      'ev3_pause',\n      'ev3_connected',\n      'ev3_motorA',\n      'ev3_motorB',\n      'ev3_motorC',\n      'ev3_motorD',\n      'ev3_motorGetSpeed',\n      'ev3_motorSetSpeed',\n      'ev3_motorStart',\n      'ev3_motorStop',\n      'ev3_motorSetStopAction',\n      'ev3_motorGetPosition',\n      'ev3_runForTime',\n      'ev3_runToAbsolutePosition',\n      'ev3_runToRelativePosition',\n      'ev3_colorSensor',\n      'ev3_colorSensorRed',\n      'ev3_colorSensorGreen',\n      'ev3_colorSensorBlue',\n      'ev3_reflectedLightIntensity',\n      'ev3_ambientLightIntensity',\n      'ev3_colorSensorGetColor',\n      'ev3_ultrasonicSensor',\n      'ev3_ultrasonicSensorDistance',\n      'ev3_gyroSensor',\n      'ev3_gyroSensorAngle',\n      'ev3_gyroSensorRate',\n      'ev3_touchSensor1',\n      'ev3_touchSensor2',\n      'ev3_touchSensor3',\n      'ev3_touchSensor4',\n      'ev3_touchSensorPressed',\n      'ev3_hello',\n      'ev3_waitForButtonPress',\n      'ev3_speak',\n      'ev3_playSequence',\n      'ev3_ledLeftGreen',\n      'ev3_ledLeftRed',\n      'ev3_ledRightGreen',\n      'ev3_ledRightRed',\n      'ev3_ledGetBrightness',\n      'ev3_ledSetBrightness'\n    ],\n    languageChapter: Chapter.CALC,\n    deviceLibraryName: ExternalLibraryName.EV3\n  }\n];\n\nexport const deviceTypesById: Map<string, DeviceType> = new Map(\n  deviceTypes.map(type => [type.id, type])\n);\n","import { Card, Elevation } from '@blueprintjs/core';\nimport React, { useEffect } from 'react';\n\nexport type ContentDisplayProps = {\n  fullWidth?: boolean;\n  display: JSX.Element;\n  loadContentDispatch: () => void;\n};\n\nconst ContentDisplay: React.FC<ContentDisplayProps> = props => {\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  useEffect(() => props.loadContentDispatch(), []);\n\n  return (\n    <div className=\"ContentDisplay row center-xs\">\n      <div\n        className={`${\n          props.fullWidth ? 'col-md-12' : 'col-md-10 col-xs-11'\n        } contentdisplay-content-parent`}\n      >\n        <Card className=\"contentdisplay-content\" elevation={Elevation.THREE}>\n          {props.display}\n        </Card>\n      </div>\n    </div>\n  );\n};\n\nexport default ContentDisplay;\n","import { action } from 'typesafe-actions';\n\nimport { WorkspaceLocation } from '../../commons/workspace/WorkspaceTypes';\nimport {\n  CodeDelta,\n  Input,\n  PlaybackData,\n  PlaybackStatus,\n  SAVE_SOURCECAST_DATA,\n  SET_CODE_DELTAS_TO_APPLY,\n  SET_CURRENT_PLAYER_TIME,\n  SET_INPUT_TO_APPLY,\n  SET_SOURCECAST_DATA,\n  SET_SOURCECAST_PLAYBACK_DURATION,\n  SET_SOURCECAST_PLAYBACK_STATUS\n} from './SourceRecorderTypes';\n\nexport const saveSourcecastData = (\n  title: string,\n  description: string,\n  uid: string,\n  audio: Blob,\n  playbackData: PlaybackData,\n  workspaceLocation: WorkspaceLocation\n) =>\n  action(SAVE_SOURCECAST_DATA, {\n    title,\n    description,\n    uid,\n    audio,\n    audioUrl: window.URL.createObjectURL(audio),\n    playbackData,\n    workspaceLocation\n  });\n\nexport const setCurrentPlayerTime = (playerTime: number, workspaceLocation: WorkspaceLocation) =>\n  action(SET_CURRENT_PLAYER_TIME, {\n    playerTime,\n    workspaceLocation\n  });\n\nexport const setCodeDeltasToApply = (deltas: CodeDelta[], workspaceLocation: WorkspaceLocation) =>\n  action(SET_CODE_DELTAS_TO_APPLY, {\n    deltas,\n    workspaceLocation\n  });\n\nexport const setInputToApply = (inputToApply: Input, workspaceLocation: WorkspaceLocation) =>\n  action(SET_INPUT_TO_APPLY, {\n    inputToApply,\n    workspaceLocation\n  });\n\nexport const setSourcecastData = (\n  title: string,\n  description: string,\n  uid: string,\n  audioUrl: string,\n  playbackData: PlaybackData,\n  workspaceLocation: WorkspaceLocation\n) =>\n  action(SET_SOURCECAST_DATA, {\n    title,\n    description,\n    uid,\n    audioUrl,\n    playbackData,\n    workspaceLocation\n  });\n\nexport const setSourcecastDuration = (duration: number, workspaceLocation: WorkspaceLocation) =>\n  action(SET_SOURCECAST_PLAYBACK_DURATION, {\n    duration,\n    workspaceLocation\n  });\n\nexport const setSourcecastStatus = (\n  playbackStatus: PlaybackStatus,\n  workspaceLocation: WorkspaceLocation\n) =>\n  action(SET_SOURCECAST_PLAYBACK_STATUS, {\n    playbackStatus,\n    workspaceLocation\n  });\n","import { AssessmentOverview } from 'src/commons/assessment/AssessmentTypes';\nimport { action } from 'typesafe-actions';\n\nimport {\n  AchievementGoal,\n  AchievementItem,\n  AchievementUser,\n  ADD_EVENT,\n  BULK_UPDATE_ACHIEVEMENTS,\n  BULK_UPDATE_GOALS,\n  EventType,\n  GET_ACHIEVEMENTS,\n  GET_GOALS,\n  GET_OWN_GOALS,\n  GET_USER_ASSESSMENT_OVERVIEWS,\n  GET_USERS,\n  GoalDefinition,\n  GoalProgress,\n  HANDLE_EVENT,\n  REMOVE_ACHIEVEMENT,\n  REMOVE_GOAL,\n  SAVE_ACHIEVEMENTS,\n  SAVE_GOALS,\n  SAVE_USER_ASSESSMENT_OVERVIEWS,\n  SAVE_USERS,\n  UPDATE_GOAL_PROGRESS,\n  UPDATE_OWN_GOAL_PROGRESS\n} from './AchievementTypes';\n\nexport const bulkUpdateAchievements = (achievements: AchievementItem[]) =>\n  action(BULK_UPDATE_ACHIEVEMENTS, achievements);\n\nexport const bulkUpdateGoals = (goals: GoalDefinition[]) => action(BULK_UPDATE_GOALS, goals);\n\nexport const getAchievements = () => action(GET_ACHIEVEMENTS);\n\nexport const getGoals = (studentCourseRegId: number) => action(GET_GOALS, studentCourseRegId);\n\nexport const getOwnGoals = () => action(GET_OWN_GOALS);\n\nexport const getUserAssessmentOverviews = (studentCourseRegId: number) =>\n  action(GET_USER_ASSESSMENT_OVERVIEWS, studentCourseRegId);\n\nexport const getUsers = () => action(GET_USERS);\n\nexport const removeAchievement = (uuid: string) => action(REMOVE_ACHIEVEMENT, uuid);\n\nexport const removeGoal = (uuid: string) => action(REMOVE_GOAL, uuid);\n\nexport const updateOwnGoalProgress = (progress: GoalProgress) =>\n  action(UPDATE_OWN_GOAL_PROGRESS, progress);\n\nexport const addEvent = (eventNames: EventType[]) => action(ADD_EVENT, eventNames);\n\nexport const handleEvent = (loggedEvents: EventType[][]) => action(HANDLE_EVENT, loggedEvents);\n\nexport const updateGoalProgress = (studentCourseRegId: number, progress: GoalProgress) =>\n  action(UPDATE_GOAL_PROGRESS, { studentCourseRegId, progress });\n\n/*\n  Note: This updates the frontend Achievement Redux store.\n  Please refer to AchievementReducer to find out more. \n*/\nexport const saveAchievements = (achievements: AchievementItem[]) =>\n  action(SAVE_ACHIEVEMENTS, achievements);\n\n/*\n  Note: This updates the frontend Achievement Redux store.\n  Please refer to AchievementReducer to find out more. \n*/\nexport const saveGoals = (goals: AchievementGoal[]) => action(SAVE_GOALS, goals);\n\n/*\n  Note: This updates the frontend Achievement Redux store.\n  Please refer to AchievementReducer to find out more. \n*/\nexport const saveUsers = (users: AchievementUser[]) => action(SAVE_USERS, users);\n\n/*\n  Note: This updates the frontend Achievement Redux store.\n  Please refer to AchievementReducer to find out more. \n*/\nexport const saveUserAssessmentOverviews = (assessmentOverviews: AssessmentOverview[]) =>\n  action(SAVE_USER_ASSESSMENT_OVERVIEWS, assessmentOverviews);\n","import 'ace-builds/src-noconflict/ext-searchbox';\nimport 'ace-builds/src-noconflict/mode-javascript';\nimport 'c-slang/dist/editors/ace/theme/source';\n\nimport { Ace } from 'ace-builds';\nimport { isEqual } from 'lodash';\nimport * as React from 'react';\nimport AceEditor, { IAceEditorProps } from 'react-ace';\nimport { HotKeys } from 'react-hotkeys';\n\nimport {\n  CodeDelta,\n  Input,\n  KeyboardCommand,\n  SelectionRange\n} from '../../features/sourceRecorder/SourceRecorderTypes';\nimport { EditorTabStateProps } from '../editor/Editor';\nimport { Position } from '../editor/EditorTypes';\n\n/**\n * @property editorValue - The string content of the react-ace editor\n * @property handleEditorChange  - A callback function\n *           for the react-ace editor's `onChange`\n * @property handleEvalEditor  - A callback function for evaluation\n *           of the editor's content, using `slang`\n * @property isEditorReadonly - Used for sourcecast only\n */\nexport type SourceRecorderEditorProps = DispatchProps &\n  EditorStateProps &\n  EditorTabStateProps &\n  OwnProps;\n\ntype DispatchProps = {\n  getTimerDuration?: () => number;\n  handleDeclarationNavigate: (cursorPosition: Position) => void;\n  handleEditorEval: () => void;\n  handleEditorValueChange: (newCode: string) => void;\n  handleEditorUpdateBreakpoints: (breakpoints: string[]) => void;\n  handleRecordInput?: (input: Input) => void;\n  handleUpdateHasUnsavedChanges?: (hasUnsavedChanges: boolean) => void;\n  onFocus?: (event: any, editor?: Ace.Editor) => void;\n  onBlur?: (event: any, editor?: Ace.Editor) => void;\n};\n\ntype EditorStateProps = {\n  codeDeltasToApply?: CodeDelta[] | null;\n  editorSessionId: string;\n  isEditorAutorun: boolean;\n  isEditorReadonly: boolean;\n  inputToApply?: Input | null;\n  isPlaying?: boolean;\n  isRecording?: boolean;\n};\n\ntype OwnProps = {\n  setDraggableReplPosition?: () => void; // for the mobile Sourcecast Workspace\n};\n\nclass SourcecastEditor extends React.PureComponent<SourceRecorderEditorProps, {}> {\n  public ShareAce: any;\n  public AceEditor: React.RefObject<AceEditor>;\n  private onChangeMethod: (newCode: string, delta: CodeDelta) => void;\n  private onCursorChange: (selecction: any) => void;\n  private onSelectionChange: (selection: any) => void;\n\n  constructor(props: SourceRecorderEditorProps) {\n    super(props);\n    this.AceEditor = React.createRef();\n    this.ShareAce = null;\n    this.onChangeMethod = (newCode: string, delta: CodeDelta) => {\n      if (this.props.handleUpdateHasUnsavedChanges) {\n        this.props.handleUpdateHasUnsavedChanges(true);\n      }\n      this.props.handleEditorValueChange(newCode);\n      if (this.props.isRecording) {\n        this.props.handleRecordInput!({\n          type: 'codeDelta',\n          time: this.props.getTimerDuration!(),\n          data: delta\n        });\n      }\n      const annotations = this.AceEditor.current!.editor.getSession().getAnnotations();\n      if (this.props.isEditorAutorun && annotations.length === 0) {\n        this.props.handleEditorEval();\n      }\n    };\n    this.onCursorChange = (selection: any) => {\n      if (!this.props.isRecording) {\n        return;\n      }\n      const editorCursorPositionToBeApplied: Position = selection.getCursor();\n      this.props.handleRecordInput!({\n        type: 'cursorPositionChange',\n        time: this.props.getTimerDuration!(),\n        data: editorCursorPositionToBeApplied\n      });\n    };\n    this.onSelectionChange = (selection: any) => {\n      if (!this.props.isRecording) {\n        return;\n      }\n      const range: SelectionRange = selection.getRange();\n      const isBackwards: boolean = selection.isBackwards();\n      if (!isEqual(range.start, range.end)) {\n        this.props.handleRecordInput!({\n          type: 'selectionRangeData',\n          time: this.props.getTimerDuration!(),\n          data: { range, isBackwards }\n        });\n      }\n    };\n  }\n\n  public componentDidUpdate(prevProps: SourceRecorderEditorProps) {\n    const { codeDeltasToApply, inputToApply, newCursorPosition } = this.props;\n\n    if (codeDeltasToApply && codeDeltasToApply !== prevProps.codeDeltasToApply) {\n      this.AceEditor.current!.editor.session.getDocument().applyDeltas(codeDeltasToApply);\n      this.AceEditor.current!.editor.selection.clearSelection();\n    }\n\n    if (newCursorPosition && newCursorPosition !== prevProps.newCursorPosition) {\n      this.moveCursor(newCursorPosition);\n    }\n\n    if (!inputToApply || inputToApply === prevProps.inputToApply) {\n      return;\n    }\n\n    switch (inputToApply.type) {\n      case 'codeDelta':\n        this.AceEditor.current!.editor.session.getDocument().applyDelta(inputToApply.data);\n        this.AceEditor.current!.editor.selection.clearSelection();\n        break;\n      case 'cursorPositionChange':\n        this.moveCursor(inputToApply.data);\n        break;\n      case 'selectionRangeData':\n        const { range, isBackwards } = inputToApply.data;\n        this.AceEditor.current!.editor.selection.setRange(range, isBackwards);\n        break;\n      case 'keyboardCommand':\n        const keyboardCommand = inputToApply.data;\n        switch (keyboardCommand) {\n          case 'run':\n            this.props.handleEditorEval();\n            // Popup mobile draggable repl when there is a recorded 'run' evaluation\n            if (this.props.setDraggableReplPosition) {\n              this.props.setDraggableReplPosition();\n            }\n            break;\n        }\n        break;\n    }\n  }\n\n  public getBreakpoints() {\n    return this.AceEditor.current!.editor.session.getBreakpoints().filter(x => x != null);\n  }\n\n  public componentDidMount() {\n    if (!this.AceEditor || !this.AceEditor.current || !this.AceEditor.current.editor) {\n      return;\n    }\n    const editor = this.AceEditor.current!.editor;\n    const session = editor.getSession();\n\n    editor.on('gutterclick' as any, this.handleGutterClick);\n\n    // Change all info annotations to error annotations\n    session.on('changeAnnotation' as any, this.handleAnnotationChange(session));\n\n    const { onFocus, onBlur } = this.props;\n    if (onFocus) {\n      editor.on('focus', (event: Event) => onFocus(event, editor));\n    }\n    if (onBlur) {\n      editor.on('blur', (event: Event) => onBlur(event, editor));\n    }\n  }\n\n  public componentWillUnmount() {\n    if (this.ShareAce !== null) {\n      // Umounting... Closing websocket\n      this.ShareAce.WS.close();\n    }\n    this.ShareAce = null;\n  }\n\n  public getMarkers = () => {\n    const markerProps: IAceEditorProps['markers'] = [];\n    for (const lineNum of this.props.highlightedLines) {\n      markerProps.push({\n        startRow: lineNum[0],\n        startCol: 0,\n        endRow: lineNum[1],\n        endCol: 1,\n        className: 'myMarker',\n        type: 'fullLine'\n      });\n    }\n    return markerProps;\n  };\n\n  public render() {\n    return (\n      <HotKeys className=\"Editor bp4-card bp4-elevation-0\" handlers={handlers}>\n        <div className=\"row editor-react-ace\">\n          <AceEditor\n            className=\"react-ace\"\n            commands={[\n              {\n                name: 'evaluate',\n                bindKey: {\n                  win: 'Shift-Enter',\n                  mac: 'Shift-Enter'\n                },\n                exec: this.handleEvaluate\n              },\n              {\n                name: 'navigate',\n                bindKey: {\n                  win: 'Ctrl-B',\n                  mac: 'Command-B'\n                },\n                exec: this.handleDeclarationNavigate\n              }\n            ]}\n            editorProps={{\n              $blockScrolling: Infinity\n            }}\n            ref={this.AceEditor}\n            markers={this.getMarkers()}\n            fontSize={17}\n            height=\"100%\"\n            highlightActiveLine={false}\n            mode=\"javascript\"\n            onChange={this.onChangeMethod}\n            onCursorChange={this.onCursorChange}\n            onSelectionChange={this.onSelectionChange}\n            readOnly={this.props.isEditorReadonly}\n            theme=\"source\"\n            value={this.props.editorValue}\n            width=\"100%\"\n            setOptions={{\n              fontFamily: \"'Inconsolata', 'Consolas', monospace\"\n            }}\n          />\n        </div>\n      </HotKeys>\n    );\n  }\n\n  private handleGutterClick = (e: any) => {\n    const target = e.domEvent.target;\n    if (\n      target.className.indexOf('ace_gutter-cell') === -1 ||\n      !e.editor.isFocused() ||\n      e.clientX > 35 + target.getBoundingClientRect().left\n    ) {\n      return;\n    }\n\n    const row = e.getDocumentPosition().row;\n    const content = e.editor.session.getLine(row);\n    const breakpoints = e.editor.session.getBreakpoints(row, 0);\n    if (\n      breakpoints[row] === undefined &&\n      content.length !== 0 &&\n      !content.includes('//') &&\n      !content.includes('debugger;')\n    ) {\n      e.editor.session.setBreakpoint(row);\n    } else {\n      e.editor.session.clearBreakpoint(row);\n    }\n    e.stop();\n    this.props.handleEditorUpdateBreakpoints(e.editor.session.$breakpoints);\n  };\n\n  private handleAnnotationChange = (session: any) => () => {\n    const annotations = session.getAnnotations();\n    let count = 0;\n    for (const anno of annotations) {\n      if (anno.type === 'info') {\n        anno.type = 'error';\n        anno.className = 'ace_error';\n        count++;\n      }\n    }\n    if (count !== 0) {\n      session.setAnnotations(annotations);\n    }\n  };\n\n  private handleEvaluate = () => {\n    this.props.handleEditorEval();\n    if (!this.props.isRecording) {\n      return;\n    }\n    this.props.handleRecordInput!({\n      type: 'keyboardCommand',\n      time: this.props.getTimerDuration!(),\n      data: KeyboardCommand.run\n    });\n  };\n\n  // Used in navigating from occurence to navigation\n  private moveCursor = (position: Position) => {\n    this.AceEditor.current!.editor.selection.clearSelection();\n    this.AceEditor.current!.editor.moveCursorToPosition(position);\n    this.AceEditor.current!.editor.renderer.showCursor();\n    this.AceEditor.current!.editor.renderer.scrollCursorIntoView(position, 0.5);\n  };\n\n  private handleDeclarationNavigate = () => {\n    this.props.handleDeclarationNavigate(this.AceEditor.current!.editor.getCursorPosition());\n  };\n}\n\n/* Override handler, so does not trigger when focus is in editor */\nconst handlers = {\n  goGreen: () => {}\n};\n\nexport default SourcecastEditor;\n","export const keyBindings = {\n  evaluate: {\n    win: 'Shift-Enter',\n    mac: 'Shift-Enter'\n  },\n  navigate: {\n    win: 'Ctrl-B',\n    mac: 'Command-B'\n  },\n  refactor: {\n    win: 'Ctrl-M',\n    mac: 'Command-M'\n  },\n  highlightScope: {\n    win: 'Ctrl-Shift-H',\n    mac: 'Command-Shift-H'\n  },\n  typeInferenceDisplay: {\n    win: 'Ctrl-Shift-M',\n    mac: 'Command-Shift-M'\n  }\n};\n\nexport type KeyFunction = keyof typeof keyBindings;\n","import * as Sentry from '@sentry/browser';\nimport sharedbAce from '@sourceacademy/sharedb-ace';\nimport * as React from 'react';\n\nimport { checkSessionIdExists, getSessionUrl } from '../collabEditing/CollabEditingHelper';\nimport { EditorHook } from './Editor';\n\n// EditorHook structure:\n// EditorHooks grant access to 4 things:\n// inProps are provided by the parent component\n// outProps go into the underlying React-Ace\n// keyBindings allow exporting new hotkeys\n// reactAceRef is the underlying reactAce instance for hooking.\n\nconst useShareAce: EditorHook = (inProps, outProps, keyBindings, reactAceRef) => {\n  // use a ref to refer to any other props so that we run the effect below\n  // *only* when the editorSessionId changes\n  const propsRef = React.useRef(inProps);\n  propsRef.current = inProps;\n\n  const { editorSessionId } = inProps;\n\n  React.useEffect(() => {\n    if (!editorSessionId) {\n      return;\n    }\n\n    const editor = reactAceRef.current!.editor;\n    const ShareAce = new sharedbAce(editorSessionId, {\n      WsUrl: getSessionUrl(editorSessionId, true),\n      pluginWsUrl: null,\n      namespace: 'sa'\n    });\n    ShareAce.on('ready', () => {\n      ShareAce.add(editor, [], []);\n      propsRef.current.handleSetSharedbConnected!(true);\n    });\n    ShareAce.on('error', (path: string, error: any) => {\n      console.error('ShareAce error', error);\n      Sentry.captureException(error);\n    });\n\n    // WebSocket connection status detection logic\n    const WS = ShareAce.WS;\n    // Since interval is used as a closure.\n    // eslint-disable-next-line prefer-const\n    let interval: any;\n    const checkStatus = async () => {\n      if (ShareAce === null) {\n        return;\n      }\n      try {\n        const exists = await checkSessionIdExists(editorSessionId);\n        if (!exists) {\n          clearInterval(interval);\n          WS.close();\n        }\n      } catch {\n        WS.reconnect();\n      }\n    };\n    // Checks connection status every 5sec\n    interval = setInterval(checkStatus, 5000);\n\n    WS.addEventListener('open', () => {\n      propsRef.current.handleSetSharedbConnected!(true);\n    });\n    WS.addEventListener('close', () => {\n      propsRef.current.handleSetSharedbConnected!(false);\n    });\n\n    return () => {\n      clearInterval(interval);\n      for (const connection of Object.values<any>(ShareAce.connections)) {\n        connection.unlisten();\n      }\n      ShareAce.WS.close();\n    };\n  }, [editorSessionId, reactAceRef]);\n};\n\nexport default useShareAce;\n","/* eslint-disable */\nimport * as ace from 'ace-builds/src-noconflict/ace';\nimport { Variant } from 'c-slang/dist/types';\n\nexport function HighlightRulesSelector_native(\n  id,\n  variant = Variant.DEFAULT,\n  external = 'NONE',\n  externalLibraries = []\n) {\n  // @ts-ignore\n  function _SourceHighlightRules(acequire, exports, module) {\n    const oop = acequire('../lib/oop');\n    const DocCommentHighlightRules = acequire(\n      './doc_comment_highlight_rules'\n    ).DocCommentHighlightRules;\n    const TextHighlightRules = acequire('./text_highlight_rules').TextHighlightRules;\n    const identifierRegex = '[a-zA-Z\\\\$_\\u00a1-\\uffff][a-zA-Z\\\\d\\\\$_\\u00a1-\\uffff]*';\n    const chapter = variant === Variant.DEFAULT ? id.toString() : id.toString() + '_' + variant;\n\n    // Currently there are no builtin libraries for NativeJS\n    // const builtin_lib = SourceDocumentation.builtins[chapter];\n    const builtin_lib = null;\n\n    function addFromBuiltinLibrary(meta) {\n      if (builtin_lib === null) {\n        return '';\n      }\n      let func = '';\n      for (const name in builtin_lib) {\n        if (builtin_lib[name]['meta'] === meta) {\n          func += '|' + name;\n        }\n      }\n      return func;\n    }\n    function addFromExternalLibrary(meta) {\n      if (externalLibraries === null) {\n        return '';\n      }\n      let func = '';\n      externalLibraries.forEach(node => {\n        if (node.meta === meta) {\n          func += '|' + node.caption;\n        }\n      });\n      return func;\n    }\n    function getAllNames(meta) {\n      const concat = addFromBuiltinLibrary(meta) + addFromExternalLibrary(meta);\n      return concat.substr(1);\n    }\n    const ChapterKeywordSelector = () => {\n      let output = '';\n      return output;\n    };\n    const ChapterForbbidenWordSelector = () => {\n      return 'window|document';\n    };\n    // @ts-ignore\n    const SourceHighlightRules = function (options) {\n      // @ts-ignore\n\n      // Copied from https://github.com/ajaxorg/ace-builds/blob/master/src/mode-javascript.js\n      const keywordMapper = this.createKeywordMapper(\n        {\n          'variable.language':\n            // Purple: for disallowed words\n            'implements|interface|package|private|protected|public|static' +\n            ChapterForbbidenWordSelector(), // Pseudo\n          keyword:\n            // Orange: for normal keywords\n            'Array|Boolean|Date|Function|Iterator|Number|Object|RegExp|String|Proxy|' + // Constructors\n            'Namespace|QName|XML|XMLList|' + // E4X\n            'ArrayBuffer|Float32Array|Float64Array|Int16Array|Int32Array|Int8Array|' +\n            'Uint16Array|Uint32Array|Uint8Array|Uint8ClampedArray|' +\n            'Error|EvalError|InternalError|RangeError|ReferenceError|StopIteration|' + // Errors\n            'SyntaxError|TypeError|URIError|' +\n            'decodeURI|decodeURIComponent|encodeURI|encodeURIComponent|isFinite|' + // Non-constructor functions\n            'isNaN|parseFloat|parseInt|' +\n            'Math|' +\n            'this|arguments|prototype' +\n            'yield|get|set|async|await|' +\n            'enum|eval|' +\n            'true|false|' +\n            'null|Infinity|NaN|undefined|' +\n            'break|case|continue|default|delete|do|else|finally|for|' +\n            'if|else|in|of|instanceof|new|return|switch|case|throw|try|sizeof|do|while|for|break|continue|' +\n            'escape|with|' +\n            'extends|super|export',\n          'storage.type':\n            // Yellow: for declarations\n            'int|float|void|char|double',\n          'support.function': 'alert'\n          // \"constant.language.boolean\": \"true|false\"\n        },\n        'identifier'\n      );\n      const keywordBeforeRegex =\n        'printf|scanf|rand|time|sqrt|abs|strlen|malloc|free|printHeap|printEnv|sizeof';\n      const escapedRegex =\n        '\\\\\\\\(?:x[0-9a-fA-F]{2}|' + // hex\n        'u[0-9a-fA-F]{4}|' + // unicode\n        'u{[0-9a-fA-F]{1,6}}|' + // es6 unicode\n        '[0-2][0-7]{0,2}|' + // oct\n        '3[0-7][0-7]?|' + // oct\n        '[4-7][0-7]?|' + //oct\n        '.)';\n      // @ts-ignore\n      this.$rules = {\n        no_regex: [\n          DocCommentHighlightRules.getStartRule('doc-start'),\n          comments('no_regex'),\n          {\n            token: 'string',\n            regex: \"'(?=.)\",\n            next: 'qstring'\n          },\n          {\n            token: 'string',\n            regex: '\"(?=.)',\n            next: 'qqstring'\n          },\n          {\n            token: 'constant.numeric',\n            regex: /0(?:[xX][0-9a-fA-F]+|[oO][0-7]+|[bB][01]+)\\b/\n          },\n          {\n            token: 'constant.numeric',\n            regex: /(?:\\d\\d*(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+\\b)?/\n          },\n          {\n            token: [\n              'storage.type',\n              'punctuation.operator',\n              'support.function',\n              'punctuation.operator',\n              'entity.name.function',\n              'text',\n              'keyword.operator'\n            ],\n            regex:\n              '(' + identifierRegex + ')(\\\\.)(prototype)(\\\\.)(' + identifierRegex + ')(\\\\s*)(=)',\n            next: 'function_arguments'\n          },\n          {\n            token: [\n              'storage.type',\n              'punctuation.operator',\n              'entity.name.function',\n              'text',\n              'keyword.operator',\n              'text',\n              'storage.type',\n              'text',\n              'paren.lparen'\n            ],\n            regex:\n              '(' +\n              identifierRegex +\n              ')(\\\\.)(' +\n              identifierRegex +\n              ')(\\\\s*)(=)(\\\\s*)(function)(\\\\s*)(\\\\()',\n            next: 'function_arguments'\n          },\n          {\n            token: [\n              'entity.name.function',\n              'text',\n              'keyword.operator',\n              'text',\n              'storage.type',\n              'text',\n              'paren.lparen'\n            ],\n            regex: '(' + identifierRegex + ')(\\\\s*)(=)(\\\\s*)(function)(\\\\s*)(\\\\()',\n            next: 'function_arguments'\n          },\n          {\n            token: [\n              'storage.type',\n              'punctuation.operator',\n              'entity.name.function',\n              'text',\n              'keyword.operator',\n              'text',\n              'storage.type',\n              'text',\n              'entity.name.function',\n              'text',\n              'paren.lparen'\n            ],\n            regex:\n              '(' +\n              identifierRegex +\n              ')(\\\\.)(' +\n              identifierRegex +\n              ')(\\\\s*)(=)(\\\\s*)(function)(\\\\s+)(\\\\w+)(\\\\s*)(\\\\()',\n            next: 'function_arguments'\n          },\n          {\n            token: ['storage.type', 'text', 'entity.name.function', 'text', 'paren.lparen'],\n            regex: '(function)(\\\\s+)(' + identifierRegex + ')(\\\\s*)(\\\\()',\n            next: 'function_arguments'\n          },\n          {\n            token: [\n              'entity.name.function',\n              'text',\n              'punctuation.operator',\n              'text',\n              'storage.type',\n              'text',\n              'paren.lparen'\n            ],\n            regex: '(' + identifierRegex + ')(\\\\s*)(:)(\\\\s*)(function)(\\\\s*)(\\\\()',\n            next: 'function_arguments'\n          },\n          {\n            token: ['text', 'text', 'storage.type', 'text', 'paren.lparen'],\n            regex: '(:)(\\\\s*)(function)(\\\\s*)(\\\\()',\n            next: 'function_arguments'\n          },\n          {\n            token: 'keyword',\n            regex: 'from(?=\\\\s*(\\'|\"))'\n          },\n          {\n            token: 'keyword',\n            regex: '(?:' + keywordBeforeRegex + ')\\\\b',\n            next: 'start'\n          },\n          {\n            token: ['support.constant'],\n            regex: /that\\b/\n          },\n          {\n            token: keywordMapper,\n            regex: identifierRegex\n          },\n          {\n            token: 'variable.language',\n            regex: /[.](?![.])/,\n            next: 'property'\n          },\n          {\n            token: 'storage.type',\n            regex: /=>/\n          },\n          {\n            token: 'keyword.operator',\n            regex: /--|\\+\\+|\\.{3}|===|==|=|!=|!==|<+=?|>+=?|!|&&|\\|\\||\\?:|[!$%&*+\\-~\\/^]=?/,\n            next: 'start'\n          },\n          {\n            token: 'punctuation.operator',\n            regex: /[?:,;.]/,\n            next: 'start'\n          },\n          {\n            token: 'paren.lparen',\n            regex: /[\\[({]/,\n            next: 'start'\n          },\n          {\n            token: 'paren.rparen',\n            regex: /[\\])}]/\n          },\n          {\n            token: 'comment',\n            regex: /^#!.*$/\n          }\n        ],\n        property: [\n          {\n            token: 'text',\n            regex: '\\\\s+'\n          },\n          {\n            token: [\n              'storage.type',\n              'punctuation.operator',\n              'entity.name.function',\n              'text',\n              'keyword.operator',\n              'text',\n              'storage.type',\n              'text',\n              'entity.name.function',\n              'text',\n              'paren.lparen'\n            ],\n            regex:\n              '(' +\n              identifierRegex +\n              ')(\\\\.)(' +\n              identifierRegex +\n              ')(\\\\s*)(=)(\\\\s*)(function)(?:(\\\\s+)(\\\\w+))?(\\\\s*)(\\\\()',\n            next: 'function_arguments'\n          },\n          {\n            token: 'punctuation.operator',\n            regex: /[.](?![.])/\n          },\n          {\n            token: 'variable.language',\n            regex:\n              /(s(?:h(?:ift|ow(?:Mod(?:elessDialog|alDialog)|Help))|croll(?:X|By(?:Pages|Lines)?|Y|To)?|t(?:op|rike)|i(?:n|zeToContent|debar|gnText)|ort|u(?:p|b(?:str(?:ing)?)?)|pli(?:ce|t)|e(?:nd|t(?:Re(?:sizable|questHeader)|M(?:i(?:nutes|lliseconds)|onth)|Seconds|Ho(?:tKeys|urs)|Year|Cursor|Time(?:out)?|Interval|ZOptions|Date|UTC(?:M(?:i(?:nutes|lliseconds)|onth)|Seconds|Hours|Date|FullYear)|FullYear|Active)|arch)|qrt|lice|avePreferences|mall)|h(?:ome|andleEvent)|navigate|c(?:har(?:CodeAt|At)|o(?:s|n(?:cat|textual|firm)|mpile)|eil|lear(?:Timeout|Interval)?|a(?:ptureEvents|ll)|reate(?:StyleSheet|Popup|EventObject))|t(?:o(?:GMTString|S(?:tring|ource)|U(?:TCString|pperCase)|Lo(?:caleString|werCase))|est|a(?:n|int(?:Enabled)?))|i(?:s(?:NaN|Finite)|ndexOf|talics)|d(?:isableExternalCapture|ump|etachEvent)|u(?:n(?:shift|taint|escape|watch)|pdateCommands)|j(?:oin|avaEnabled)|p(?:o(?:p|w)|ush|lugins.refresh|a(?:ddings|rse(?:Int|Float)?)|r(?:int|ompt|eference))|e(?:scape|nableExternalCapture|val|lementFromPoint|x(?:p|ec(?:Script|Command)?))|valueOf|UTC|queryCommand(?:State|Indeterm|Enabled|Value)|f(?:i(?:nd|le(?:ModifiedDate|Size|CreatedDate|UpdatedDate)|xed)|o(?:nt(?:size|color)|rward)|loor|romCharCode)|watch|l(?:ink|o(?:ad|g)|astIndexOf)|a(?:sin|nchor|cos|t(?:tachEvent|ob|an(?:2)?)|pply|lert|b(?:s|ort))|r(?:ou(?:nd|teEvents)|e(?:size(?:By|To)|calc|turnValue|place|verse|l(?:oad|ease(?:Capture|Events)))|andom)|g(?:o|et(?:ResponseHeader|M(?:i(?:nutes|lliseconds)|onth)|Se(?:conds|lection)|Hours|Year|Time(?:zoneOffset)?|Da(?:y|te)|UTC(?:M(?:i(?:nutes|lliseconds)|onth)|Seconds|Hours|Da(?:y|te)|FullYear)|FullYear|A(?:ttention|llResponseHeaders)))|m(?:in|ove(?:B(?:y|elow)|To(?:Absolute)?|Above)|ergeAttributes|a(?:tch|rgins|x))|b(?:toa|ig|o(?:ld|rderWidths)|link|ack))\\b(?=\\()/\n          },\n          {\n            token: 'variable.language.dom',\n            regex:\n              /(s(?:ub(?:stringData|mit)|plitText|e(?:t(?:NamedItem|Attribute(?:Node)?)|lect))|has(?:ChildNodes|Feature)|namedItem|c(?:l(?:ick|o(?:se|neNode))|reate(?:C(?:omment|DATASection|aption)|T(?:Head|extNode|Foot)|DocumentFragment|ProcessingInstruction|E(?:ntityReference|lement)|Attribute))|tabIndex|i(?:nsert(?:Row|Before|Cell|Data)|tem)|open|delete(?:Row|C(?:ell|aption)|T(?:Head|Foot)|Data)|focus|write(?:ln)?|a(?:dd|ppend(?:Child|Data))|re(?:set|place(?:Child|Data)|move(?:NamedItem|Child|Attribute(?:Node)?)?)|get(?:NamedItem|Element(?:sBy(?:Name|TagName|ClassName)|ById)|Attribute(?:Node)?)|blur)\\b(?=\\()/\n          },\n          {\n            token: 'support.constant',\n            regex:\n              /(s(?:ystemLanguage|cr(?:ipts|ollbars|een(?:X|Y|Top|Left))|t(?:yle(?:Sheets)?|atus(?:Text|bar)?)|ibling(?:Below|Above)|ource|uffixes|e(?:curity(?:Policy)?|l(?:ection|f)))|h(?:istory|ost(?:name)?|as(?:h|Focus))|y|X(?:MLDocument|SLDocument)|n(?:ext|ame(?:space(?:s|URI)|Prop))|M(?:IN_VALUE|AX_VALUE)|c(?:haracterSet|o(?:n(?:structor|trollers)|okieEnabled|lorDepth|mp(?:onents|lete))|urrent|puClass|l(?:i(?:p(?:boardData)?|entInformation)|osed|asses)|alle(?:e|r)|rypto)|t(?:o(?:olbar|p)|ext(?:Transform|Indent|Decoration|Align)|ags)|SQRT(?:1_2|2)|i(?:n(?:ner(?:Height|Width)|put)|ds|gnoreCase)|zIndex|o(?:scpu|n(?:readystatechange|Line)|uter(?:Height|Width)|p(?:sProfile|ener)|ffscreenBuffering)|NEGATIVE_INFINITY|d(?:i(?:splay|alog(?:Height|Top|Width|Left|Arguments)|rectories)|e(?:scription|fault(?:Status|Ch(?:ecked|arset)|View)))|u(?:ser(?:Profile|Language|Agent)|n(?:iqueID|defined)|pdateInterval)|_content|p(?:ixelDepth|ort|ersonalbar|kcs11|l(?:ugins|atform)|a(?:thname|dding(?:Right|Bottom|Top|Left)|rent(?:Window|Layer)?|ge(?:X(?:Offset)?|Y(?:Offset)?))|r(?:o(?:to(?:col|type)|duct(?:Sub)?|mpter)|e(?:vious|fix)))|e(?:n(?:coding|abledPlugin)|x(?:ternal|pando)|mbeds)|v(?:isibility|endor(?:Sub)?|Linkcolor)|URLUnencoded|P(?:I|OSITIVE_INFINITY)|f(?:ilename|o(?:nt(?:Size|Family|Weight)|rmName)|rame(?:s|Element)|gColor)|E|whiteSpace|l(?:i(?:stStyleType|n(?:eHeight|kColor))|o(?:ca(?:tion(?:bar)?|lName)|wsrc)|e(?:ngth|ft(?:Context)?)|a(?:st(?:M(?:odified|atch)|Index|Paren)|yer(?:s|X)|nguage))|a(?:pp(?:MinorVersion|Name|Co(?:deName|re)|Version)|vail(?:Height|Top|Width|Left)|ll|r(?:ity|guments)|Linkcolor|bove)|r(?:ight(?:Context)?|e(?:sponse(?:XML|Text)|adyState))|global|x|m(?:imeTypes|ultiline|enubar|argin(?:Right|Bottom|Top|Left))|L(?:N(?:10|2)|OG(?:10E|2E))|b(?:o(?:ttom|rder(?:Width|RightWidth|BottomWidth|Style|Color|TopWidth|LeftWidth))|ufferDepth|elow|ackground(?:Color|Image)))\\b/\n          },\n          {\n            token: 'identifier',\n            regex: identifierRegex\n          },\n          {\n            regex: '',\n            token: 'empty',\n            next: 'no_regex'\n          }\n        ],\n        start: [\n          DocCommentHighlightRules.getStartRule('doc-start'),\n          comments('start'),\n          {\n            token: 'string.regexp',\n            regex: '\\\\/',\n            next: 'regex'\n          },\n          {\n            token: 'text',\n            regex: '\\\\s+|^$',\n            next: 'start'\n          },\n          {\n            token: 'empty',\n            regex: '',\n            next: 'no_regex'\n          }\n        ],\n        regex: [\n          {\n            token: 'regexp.keyword.operator',\n            regex: '\\\\\\\\(?:u[\\\\da-fA-F]{4}|x[\\\\da-fA-F]{2}|.)'\n          },\n          {\n            token: 'string.regexp',\n            regex: '/[sxngimy]*',\n            next: 'no_regex'\n          },\n          {\n            token: 'invalid',\n            regex: /\\{\\d+\\b,?\\d*\\}[+*]|[+*$^?][+*]|[$^][?]|\\?{3,}/\n          },\n          {\n            token: 'constant.language.escape',\n            regex: /\\(\\?[:=!]|\\)|\\{\\d+\\b,?\\d*\\}|[+*]\\?|[()$^+*?.]/\n          },\n          {\n            token: 'constant.language.delimiter',\n            regex: /\\|/\n          },\n          {\n            token: 'constant.language.escape',\n            regex: /\\[\\^?/,\n            next: 'regex_character_class'\n          },\n          {\n            token: 'empty',\n            regex: '$',\n            next: 'no_regex'\n          },\n          {\n            defaultToken: 'string.regexp'\n          }\n        ],\n        regex_character_class: [\n          {\n            token: 'regexp.charclass.keyword.operator',\n            regex: '\\\\\\\\(?:u[\\\\da-fA-F]{4}|x[\\\\da-fA-F]{2}|.)'\n          },\n          {\n            token: 'constant.language.escape',\n            regex: ']',\n            next: 'regex'\n          },\n          {\n            token: 'constant.language.escape',\n            regex: '-'\n          },\n          {\n            token: 'empty',\n            regex: '$',\n            next: 'no_regex'\n          },\n          {\n            defaultToken: 'string.regexp.charachterclass'\n          }\n        ],\n        function_arguments: [\n          {\n            token: 'variable.parameter',\n            regex: identifierRegex\n          },\n          {\n            token: 'punctuation.operator',\n            regex: '[, ]+'\n          },\n          {\n            token: 'punctuation.operator',\n            regex: '$'\n          },\n          {\n            token: 'empty',\n            regex: '',\n            next: 'no_regex'\n          }\n        ],\n        qqstring: [\n          {\n            token: 'constant.language.escape',\n            regex: escapedRegex\n          },\n          {\n            token: 'string',\n            regex: '\\\\\\\\$',\n            consumeLineEnd: true\n          },\n          {\n            token: 'string',\n            regex: '\"|$',\n            next: 'no_regex'\n          },\n          {\n            defaultToken: 'string'\n          }\n        ],\n        qstring: [\n          {\n            token: 'constant.language.escape',\n            regex: escapedRegex\n          },\n          {\n            token: 'string',\n            regex: '\\\\\\\\$',\n            consumeLineEnd: true\n          },\n          {\n            token: 'string',\n            regex: \"'|$\",\n            next: 'no_regex'\n          },\n          {\n            defaultToken: 'string'\n          }\n        ]\n      };\n      if (!options || !options.noES6) {\n        // @ts-ignore\n        this.$rules.no_regex.unshift(\n          {\n            regex: '[{}]',\n            // @ts-ignore\n            onMatch: function (val, state, stack) {\n              this.next = val == '{' ? this.nextState : '';\n              if (val == '{' && stack.length) {\n                stack.unshift('start', state);\n              } else if (val == '}' && stack.length) {\n                stack.shift();\n                this.next = stack.shift();\n                if (this.next.indexOf('string') != -1 || this.next.indexOf('jsx') != -1)\n                  return 'paren.quasi.end';\n              }\n              return val == '{' ? 'paren.lparen' : 'paren.rparen';\n            },\n            nextState: 'start'\n          },\n          {\n            token: 'string.quasi.start',\n            regex: /`/,\n            push: [\n              {\n                token: 'constant.language.escape',\n                regex: escapedRegex\n              },\n              {\n                token: 'paren.quasi.start',\n                regex: /\\${/,\n                push: 'start'\n              },\n              {\n                token: 'string.quasi.end',\n                regex: /`/,\n                next: 'pop'\n              },\n              {\n                defaultToken: 'string.quasi'\n              }\n            ]\n          }\n        );\n        if (!options || options.jsx != false)\n          // @ts-ignore\n          JSX.call(this);\n      }\n      // @ts-ignore\n      this.embedRules(DocCommentHighlightRules, 'doc-', [\n        DocCommentHighlightRules.getEndRule('no_regex')\n      ]);\n      // @ts-ignore\n      this.normalizeRules();\n    };\n    oop.inherits(SourceHighlightRules, TextHighlightRules);\n    function JSX() {\n      const tagRegex = identifierRegex.replace('\\\\d', '\\\\d\\\\-');\n      const jsxTag = {\n        // @ts-ignore\n        onMatch: function (val, state, stack) {\n          const offset = val.charAt(1) == '/' ? 2 : 1;\n          if (offset == 1) {\n            if (state != this.nextState) stack.unshift(this.next, this.nextState, 0);\n            else stack.unshift(this.next);\n            stack[2]++;\n          } else if (offset == 2) {\n            if (state == this.nextState) {\n              stack[1]--;\n              if (!stack[1] || stack[1] < 0) {\n                stack.shift();\n                stack.shift();\n              }\n            }\n          }\n          return [\n            {\n              type: 'meta.tag.punctuation.' + (offset == 1 ? '' : 'end-') + 'tag-open.xml',\n              value: val.slice(0, offset)\n            },\n            {\n              type: 'meta.tag.tag-name.xml',\n              value: val.substr(offset)\n            }\n          ];\n        },\n        regex: '</?' + tagRegex + '',\n        next: 'jsxAttributes',\n        nextState: 'jsx'\n      };\n      // @ts-ignore\n      this.$rules.start.unshift(jsxTag);\n      const jsxJsRule = {\n        regex: '{',\n        token: 'paren.quasi.start',\n        push: 'start'\n      };\n      // @ts-ignore\n      this.$rules.jsx = [jsxJsRule, jsxTag, { include: 'reference' }, { defaultToken: 'string' }];\n      // @ts-ignore\n      this.$rules.jsxAttributes = [\n        {\n          token: 'meta.tag.punctuation.tag-close.xml',\n          regex: '/?>',\n          // @ts-ignore\n          onMatch: function (value, currentState, stack) {\n            if (currentState == stack[0]) stack.shift();\n            if (value.length == 2) {\n              if (stack[0] == this.nextState) stack[1]--;\n              if (!stack[1] || stack[1] < 0) {\n                stack.splice(0, 2);\n              }\n            }\n            // @ts-ignore\n            this.next = stack[0] || 'start';\n            return [{ type: this.token, value: value }];\n          },\n          nextState: 'jsx'\n        },\n        jsxJsRule,\n        comments('jsxAttributes'),\n        {\n          token: 'entity.other.attribute-name.xml',\n          regex: tagRegex\n        },\n        {\n          token: 'keyword.operator.attribute-equals.xml',\n          regex: '='\n        },\n        {\n          token: 'text.tag-whitespace.xml',\n          regex: '\\\\s+'\n        },\n        {\n          token: 'string.attribute-value.xml',\n          regex: \"'\",\n          stateName: 'jsx_attr_q',\n          push: [\n            { token: 'string.attribute-value.xml', regex: \"'\", next: 'pop' },\n            { include: 'reference' },\n            { defaultToken: 'string.attribute-value.xml' }\n          ]\n        },\n        {\n          token: 'string.attribute-value.xml',\n          regex: '\"',\n          stateName: 'jsx_attr_qq',\n          push: [\n            { token: 'string.attribute-value.xml', regex: '\"', next: 'pop' },\n            { include: 'reference' },\n            { defaultToken: 'string.attribute-value.xml' }\n          ]\n        },\n        jsxTag\n      ];\n      // @ts-ignore\n      this.$rules.reference = [\n        {\n          token: 'constant.language.escape.reference.xml',\n          regex: '(?:&#[0-9]+;)|(?:&#x[0-9a-fA-F]+;)|(?:&[a-zA-Z0-9_:\\\\.-]+;)'\n        }\n      ];\n    }\n    // @ts-ignore\n    function comments(next) {\n      return [\n        {\n          token: 'comment',\n          regex: /\\/\\*/,\n          next: [\n            DocCommentHighlightRules.getTagRule(),\n            { token: 'comment', regex: '\\\\*\\\\/', next: next || 'pop' },\n            { defaultToken: 'comment', caseInsensitive: true }\n          ]\n        },\n        {\n          token: 'comment',\n          regex: '\\\\/\\\\/',\n          next: [\n            DocCommentHighlightRules.getTagRule(),\n            { token: 'comment', regex: '$|^', next: next || 'pop' },\n            { defaultToken: 'comment', caseInsensitive: true }\n          ]\n        }\n      ];\n    }\n    exports.SourceHighlightRules = SourceHighlightRules;\n  }\n  const name = id.toString() + variant + external;\n  // @ts-ignore\n  ace.define(\n    'ace/mode/source_highlight_rules' + name,\n    [\n      'require',\n      'exports',\n      'module',\n      'ace/lib/oop',\n      'ace/mode/doc_comment_highlight_rules',\n      'ace/mode/text_highlight_rules'\n    ],\n    _SourceHighlightRules\n  );\n}\n","import { SourceDocumentation } from 'c-slang';\nimport { deviceTypes } from 'src/features/remoteExecution/RemoteExecutionTypes';\n\nimport { externalLibraries } from '../application/types/ExternalTypes';\n\nconst externalLibrariesDocumentation = {};\n\nconst MAX_CAPTION_LENGTH = 27;\n\nfunction shortenCaption(name: string): string {\n  if (name.length <= MAX_CAPTION_LENGTH) {\n    return name;\n  }\n\n  return (name = name.substring(0, MAX_CAPTION_LENGTH - 3) + '...');\n}\n\nfunction mapExternalLibraryName(name: string) {\n  if (name in SourceDocumentation.ext_lib) {\n    return {\n      caption: shortenCaption(name),\n      value: name,\n      meta: SourceDocumentation.ext_lib[name].meta,\n      docHTML: SourceDocumentation.ext_lib[name].description\n    };\n  } else {\n    return {\n      caption: shortenCaption(name),\n      value: name,\n      meta: 'const'\n    };\n  }\n}\n\nfor (const [lib, names] of externalLibraries) {\n  externalLibrariesDocumentation[lib] = names.map(mapExternalLibraryName);\n}\n\n// Add remote device libraries\nfor (const deviceType of deviceTypes) {\n  externalLibrariesDocumentation[deviceType.deviceLibraryName] =\n    deviceType.internalFunctions.map(mapExternalLibraryName);\n}\n\nconst builtinDocumentation = {};\n\nObject.entries(SourceDocumentation.builtins).forEach((chapterDoc: any) => {\n  const [chapter, docs] = chapterDoc;\n  builtinDocumentation[chapter] = Object.entries(docs).map((entry: any) => {\n    const [name, info] = entry;\n    return {\n      caption: shortenCaption(name),\n      value: name,\n      meta: info.meta,\n      docHTML: info.description\n    };\n  });\n});\n\nexport const Documentation = {\n  builtins: builtinDocumentation,\n  externalLibraries: externalLibrariesDocumentation\n};\n","import { ModeSelector } from 'c-slang/dist/editors/ace/modes/source';\nimport { Chapter, Variant } from 'c-slang/dist/types';\n\nimport { HighlightRulesSelector_native } from '../../features/fullJS/fullJSHighlight';\nimport { Documentation } from '../documentation/Documentation';\n/**\n * This _modifies global state_ and defines a new Ace mode globally, if it does not already exist.\n *\n * You can call this directly in render functions.\n */\nexport const selectMode = (chapter: Chapter, variant: Variant, library: string) => {\n  if (\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    typeof ace.define.modules[`ace/mode/${getModeString(chapter, variant, library)}`]?.Mode ===\n    'function'\n  ) {\n    return;\n  }\n\n  HighlightRulesSelector_native(\n    chapter,\n    variant,\n    library,\n    Documentation.externalLibraries[library]\n  );\n  ModeSelector(chapter, variant, library);\n};\n\nexport const getModeString = (chapter: Chapter, variant: Variant, library: string) => {\n  return `source${chapter}${variant}${library}`;\n};\n","/* eslint-disable simple-import-sort/imports */\nimport { Ace, require as acequire } from 'ace-builds';\nimport 'ace-builds/src-noconflict/ext-language_tools';\nimport 'ace-builds/src-noconflict/ext-searchbox';\nimport 'c-slang/dist/editors/ace/theme/source';\n\nimport { Chapter, Variant } from 'c-slang/dist/types';\nimport * as React from 'react';\nimport AceEditor, { IAceEditorProps, IEditorProps } from 'react-ace';\nimport * as AceBuilds from 'ace-builds';\nimport { HotKeys } from 'react-hotkeys';\n\nimport { keyBindings, KeyFunction } from './EditorHotkeys';\nimport { AceMouseEvent, HighlightedLines, Position } from './EditorTypes';\n\n// =============== Hooks ===============\n// TODO: Should further refactor into EditorBase + different variants.\n// Ideally, hooks should be specified by the parent component instead.\nimport useShareAce from './UseShareAce';\nimport { getModeString, selectMode } from '../utils/AceHelper';\nimport { EditorBinding, WorkspaceSettingsContext } from '../WorkspaceSettingsContext';\n\nexport type EditorKeyBindingHandlers = { [name in KeyFunction]?: () => void };\nexport type EditorHook = (\n  inProps: Readonly<EditorProps>,\n  outProps: IAceEditorProps,\n  keyBindings: EditorKeyBindingHandlers,\n  reactAceRef: React.MutableRefObject<AceEditor | null>\n) => void;\n\nexport type EditorProps = DispatchProps & EditorStateProps & EditorTabStateProps & OnEvent;\n\ntype DispatchProps = {\n  handleDeclarationNavigate: (cursorPosition: Position) => void;\n  handleEditorEval: () => void;\n  handleEditorCheck: () => void;\n  handleEditorValueChange: (newCode: string) => void;\n  handleEditorUpdateBreakpoints: (breakpoints: string[]) => void;\n  handlePromptAutocomplete: (row: number, col: number, callback: any) => void;\n  handleSendReplInputToOutput?: (newOutput: string) => void;\n  handleSetSharedbConnected?: (connected: boolean) => void;\n  handleUpdateHasUnsavedChanges?: (hasUnsavedChanges: boolean) => void;\n};\n\ntype EditorStateProps = {\n  editorSessionId: string;\n  isEditorAutorun: boolean;\n  sourceChapter?: Chapter;\n  externalLibraryName?: string;\n  sourceVariant?: Variant;\n  hooks?: EditorHook[];\n};\n\nexport type EditorTabStateProps = {\n  editorValue: string;\n  highlightedLines: HighlightedLines[];\n  breakpoints: string[];\n  newCursorPosition?: Position;\n};\n\ntype LocalStateProps = {\n  editorBinding: EditorBinding;\n};\n\ntype OnEvent = {\n  onSelectionChange?: (value: any, event?: any) => void;\n  onCursorChange?: (value: any, event?: any) => void;\n  onInput?: (event?: any) => void;\n  onLoad?: (editor: Ace.Editor) => void;\n  onValidate?: (annotations: Ace.Annotation[]) => void;\n  onBeforeLoad?: (ace: typeof AceBuilds) => void;\n  onChange?: (value: string, event?: any) => void;\n  onSelection?: (selectedText: string, event?: any) => void;\n  onCopy?: (value: string) => void;\n  onPaste?: (value: string) => void;\n  onFocus?: (event: any, editor?: Ace.Editor) => void;\n  onBlur?: (event: any, editor?: Ace.Editor) => void;\n  onScroll?: (editor: IEditorProps) => void;\n};\n\nconst EventT: Array<keyof OnEvent> = [\n  'onSelectionChange',\n  'onCursorChange',\n  'onInput',\n  'onLoad',\n  'onValidate',\n  'onBeforeLoad',\n  'onChange',\n  'onSelection',\n  'onCopy',\n  'onPaste',\n  'onFocus',\n  'onBlur',\n  'onScroll'\n];\n\nconst getMarkers = (\n  highlightedLines: EditorTabStateProps['highlightedLines']\n): IAceEditorProps['markers'] => {\n  return highlightedLines.map(lineNums => ({\n    startRow: lineNums[0],\n    startCol: 0,\n    endRow: lineNums[1],\n    endCol: 1,\n    className: 'myMarker',\n    type: 'fullLine'\n  }));\n};\n\nconst makeHandleGutterClick =\n  (handleEditorUpdateBreakpoints: DispatchProps['handleEditorUpdateBreakpoints']) =>\n  (e: AceMouseEvent) => {\n    const target = e.domEvent.target! as HTMLDivElement;\n    if (\n      target.className.indexOf('ace_gutter-cell') === -1 ||\n      !e.editor.isFocused() ||\n      e.clientX > 35 + target.getBoundingClientRect().left\n    ) {\n      return;\n    }\n\n    // Breakpoint related.\n    const row = e.getDocumentPosition().row;\n    const content = e.editor.session.getLine(row);\n    const breakpoints = e.editor.session.getBreakpoints();\n    if (\n      breakpoints[row] === undefined &&\n      content.length !== 0 &&\n      !content.includes('//') &&\n      !content.includes('debugger;')\n    ) {\n      e.editor.session.setBreakpoint(row, undefined!);\n    } else {\n      e.editor.session.clearBreakpoint(row);\n    }\n    e.stop();\n    handleEditorUpdateBreakpoints(e.editor.session.getBreakpoints());\n  };\n\n// Note: This is untestable/unused because JS-hint has been removed.\nconst makeHandleAnnotationChange = (session: Ace.EditSession) => () => {\n  const annotations = session.getAnnotations();\n  let count = 0;\n  for (const anno of annotations) {\n    if (anno.type === 'info') {\n      anno.type = 'error';\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore // Probably some undocumented type\n      anno.className = 'ace_error';\n      count++;\n    }\n  }\n  if (count !== 0) {\n    session.setAnnotations(annotations);\n  }\n};\n\nconst makeCompleter = (handlePromptAutocomplete: DispatchProps['handlePromptAutocomplete']) => ({\n  getCompletions: (\n    editor: Ace.Editor,\n    session: Ace.EditSession,\n    pos: Ace.Point,\n    prefix: string,\n    callback: () => void\n  ) => {\n    // Don't prompt if prefix starts with number\n    if (prefix && /\\d/.test(prefix.charAt(0))) {\n      callback();\n      return;\n    }\n\n    // Cursor col is insertion location i.e. last char col + 1\n    handlePromptAutocomplete(pos.row + 1, pos.column, callback);\n  }\n});\n\nconst moveCursor = (editor: AceEditor['editor'], position: Position) => {\n  editor.selection.clearSelection();\n  editor.moveCursorToPosition(position);\n  editor.renderer.showCursor();\n  editor.renderer.scrollCursorIntoView(position, 0.5);\n};\n\n/* Override handler, so does not trigger when focus is in editor */\nconst handlers = {\n  goGreen: () => {}\n};\n\nconst EditorBase = React.memo((props: EditorProps & LocalStateProps) => {\n  const reactAceRef: React.MutableRefObject<AceEditor | null> = React.useRef(null);\n\n  // Refs for things that technically shouldn't change... but just in case.\n  const handleEditorUpdateBreakpointsRef = React.useRef(props.handleEditorUpdateBreakpoints);\n  const handlePromptAutocompleteRef = React.useRef(props.handlePromptAutocomplete);\n\n  React.useEffect(() => {\n    handleEditorUpdateBreakpointsRef.current = props.handleEditorUpdateBreakpoints;\n    handlePromptAutocompleteRef.current = props.handlePromptAutocomplete;\n  }, [props.handleEditorUpdateBreakpoints, props.handlePromptAutocomplete]);\n\n  // Handles input into AceEditor causing app to scroll to the top on iOS Safari\n  React.useEffect(() => {\n    const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);\n    if (isIOS) {\n      document.body.style.position = 'fixed';\n      document.body.style.width = '100%';\n    }\n\n    return () => {\n      document.body.style.position = '';\n      document.body.style.width = '';\n    };\n  }, []);\n\n  const [sourceChapter, sourceVariant, externalLibraryName] = [\n    props.sourceChapter || Chapter.CALC,\n    props.sourceVariant || Variant.DEFAULT,\n    props.externalLibraryName || 'NONE'\n  ];\n\n  // this function defines the Ace language and highlighting mode for the\n  // given combination of chapter, variant and external library. it CANNOT be\n  // put in useEffect as it MUST be called before the mode is set on the Ace\n  // editor, and use(Layout)Effect runs after that happens.\n  //\n  // this used to be in useMemo, but selectMode now checks if the mode is\n  // already defined and doesn't do it, so it is now OK to keep calling this\n  // unconditionally.\n  selectMode(sourceChapter, sourceVariant, externalLibraryName);\n\n  React.useLayoutEffect(() => {\n    if (!reactAceRef.current) {\n      return;\n    }\n    const editor = reactAceRef.current.editor;\n    const session = editor.getSession();\n    // NOTE: Everything in this function is designed to run exactly ONCE per instance of react-ace.\n    // The () => ref.current() are designed to use the latest instance only.\n\n    // NOTE: the two `any`s below are because the Ace editor typedefs are\n    // hopelessly incomplete\n    editor.on(\n      'gutterclick' as any,\n      makeHandleGutterClick((...args) => handleEditorUpdateBreakpointsRef.current(...args)) as any\n    );\n\n    // Change all info annotations to error annotations\n    session.on('changeAnnotation' as any, makeHandleAnnotationChange(session));\n\n    // Start autocompletion\n    acequire('ace/ext/language_tools').setCompleters([\n      makeCompleter((...args) => handlePromptAutocompleteRef.current(...args))\n    ]);\n    // This should run exactly once.\n  }, []);\n\n  React.useLayoutEffect(() => {\n    if (!reactAceRef.current) {\n      return;\n    }\n    const newCursorPosition = props.newCursorPosition;\n    if (newCursorPosition) {\n      moveCursor(reactAceRef.current.editor, newCursorPosition);\n    }\n  }, [props.newCursorPosition]);\n\n  const {\n    handleUpdateHasUnsavedChanges,\n    handleEditorValueChange,\n    isEditorAutorun,\n    handleEditorEval,\n    handleEditorCheck\n  } = props;\n  const keyHandlers: EditorKeyBindingHandlers = {\n    evaluate: handleEditorEval\n  };\n\n  const aceEditorProps: IAceEditorProps = {\n    className: 'react-ace',\n    editorProps: {\n      $blockScrolling: Infinity\n    },\n    markers: React.useMemo(() => getMarkers(props.highlightedLines), [props.highlightedLines]),\n    fontSize: 17,\n    height: '100%',\n    highlightActiveLine: false,\n    mode: getModeString(sourceChapter, sourceVariant, externalLibraryName),\n    theme: 'source',\n    value: props.editorValue,\n    width: '100%',\n    setOptions: {\n      enableBasicAutocompletion: true,\n      enableLiveAutocompletion: true,\n      fontFamily: \"'Inconsolata', 'Consolas', monospace\"\n    },\n    keyboardHandler: props.editorBinding\n  };\n\n  // Hooks must not change after an editor is instantiated, so to prevent that\n  // we store the original value and always use that only\n  const [hooks] = React.useState(props.hooks);\n  if (hooks) {\n    // Note: the following is extremely non-standard use of hooks\n    // DO NOT refactor this into any form where the hook is called from a lambda\n    for (const hook of hooks) {\n      hook(props, aceEditorProps, keyHandlers, reactAceRef);\n    }\n  }\n\n  const hooksOnChange = aceEditorProps.onChange;\n\n  aceEditorProps.onChange = React.useCallback(\n    (newCode: string, delta: Ace.Delta) => {\n      if (!reactAceRef.current) {\n        return;\n      }\n      handleEditorValueChange(newCode);\n      if (handleUpdateHasUnsavedChanges) {\n        handleUpdateHasUnsavedChanges(true);\n      }\n      const annotations = reactAceRef.current.editor.getSession().getAnnotations();\n      if (isEditorAutorun && annotations.length === 0) {\n        handleEditorEval();\n      } else {\n        handleEditorCheck();\n      }\n      hooksOnChange && hooksOnChange(newCode, delta);\n    },\n    [\n      handleEditorValueChange,\n      handleUpdateHasUnsavedChanges,\n      isEditorAutorun,\n      hooksOnChange,\n      handleEditorEval,\n      handleEditorCheck\n    ]\n  );\n\n  aceEditorProps.commands = Object.entries(keyHandlers)\n    .filter(([_, exec]) => exec)\n    .map(([name, exec]) => ({ name, bindKey: keyBindings[name], exec: exec! }));\n\n  // Merge in .onEvent ace editor props\n  // This prevents user errors such as\n  // TRYING TO ADD AN ONCHANGE PROP WHICH KILLS THE ABOVE ONCHANGE.\n  // **triggered**\n  EventT.forEach(eventT => {\n    const propFn = props[eventT];\n    if (propFn) {\n      /* eslint-disable */\n\n      const currFn = aceEditorProps[eventT];\n      if (!currFn) {\n        // Typescript isn't smart enough to know that the types of both LHS/RHS are the same.\n        // @ts-ignore\n        aceEditorProps[eventT] = propFn;\n      } else {\n        aceEditorProps[eventT] = function (...args: any[]) {\n          // Impossible to define a function which takes in the arbitrary number of correct arguments...\n          // @ts-ignore\n          currFn(...args);\n          // @ts-ignore\n          propFn(...args);\n        };\n      }\n      /* eslint-enable */\n    }\n  });\n\n  return (\n    <HotKeys className=\"Editor bp4-card bp4-elevation-0\" handlers={handlers}>\n      <div className=\"row editor-react-ace\">\n        <AceEditor {...aceEditorProps} ref={reactAceRef} />\n      </div>\n    </HotKeys>\n  );\n});\n\n// don't create a new list every render.\nconst hooks = [useShareAce];\n\nconst Editor: React.FC<EditorProps> = (props: EditorProps) => {\n  const [workspaceSettings] = React.useContext(WorkspaceSettingsContext)!;\n\n  return <EditorBase {...props} editorBinding={workspaceSettings.editorBinding} hooks={hooks} />;\n};\n\nexport default Editor;\n","// Necessary to prevent \"ReferenceError: ace is not defined\" error.\n// See https://github.com/securingsincity/react-ace/issues/1233 (although there is no explanation).\nimport 'ace-builds/src-noconflict/ace';\n\nimport _ from 'lodash';\nimport React from 'react';\n\nimport SourcecastEditor, {\n  SourceRecorderEditorProps\n} from '../sourceRecorder/SourceRecorderEditor';\nimport { EditorTabState } from '../workspace/WorkspaceTypes';\nimport Editor, { EditorProps, EditorTabStateProps } from './Editor';\n\nexport type NormalEditorContainerProps = Omit<EditorProps, keyof EditorTabStateProps> & {\n  editorVariant: 'normal';\n  editorTabs: EditorTabStateProps[];\n};\n\nexport type SourcecastEditorContainerProps = Omit<\n  SourceRecorderEditorProps,\n  keyof EditorTabStateProps\n> & {\n  editorVariant: 'sourcecast';\n  editorTabs: EditorTabStateProps[];\n};\n\nexport type EditorContainerProps = NormalEditorContainerProps | SourcecastEditorContainerProps;\n\nexport const convertEditorTabStateToProps = (editorTab: EditorTabState): EditorTabStateProps => {\n  return {\n    editorValue: editorTab.value,\n    ..._.pick(editorTab, 'highlightedLines', 'breakpoints', 'newCursorPosition')\n  };\n};\n\nconst createNormalEditorTab =\n  (editorProps: Omit<EditorProps, keyof EditorTabStateProps>) =>\n  (editorTabStateProps: EditorTabStateProps) => {\n    return <Editor {...editorProps} {...editorTabStateProps} />;\n  };\n\nconst createSourcecastEditorTab =\n  (editorProps: Omit<SourceRecorderEditorProps, keyof EditorTabStateProps>) =>\n  (editorTabStateProps: EditorTabStateProps) => {\n    return <SourcecastEditor {...editorProps} {...editorTabStateProps} />;\n  };\n\nconst EditorContainer: React.FC<EditorContainerProps> = (props: EditorContainerProps) => {\n  let createEditorTab;\n  if (props.editorVariant === 'sourcecast') {\n    const { editorVariant, editorTabs, ...editorProps } = props;\n    createEditorTab = createSourcecastEditorTab(editorProps);\n  } else {\n    const { editorVariant, editorTabs, ...editorProps } = props;\n    createEditorTab = createNormalEditorTab(editorProps);\n  }\n  // TODO: Implement editor tabs.\n  return createEditorTab(props.editorTabs[0]);\n};\n\nexport default EditorContainer;\n","export type Notification = {\n  assessment_id?: number;\n  assessment_type?: string;\n  assessment_title?: string;\n  id: number;\n  submission_id?: number;\n  type: NotificationType;\n};\n\nexport enum NotificationTypes {\n  new = 'new',\n  deadline = 'deadline',\n  autograded = 'autograded',\n  graded = 'graded',\n  submitted = 'submitted',\n  unsubmitted = 'unsubmitted',\n  new_message = 'new_message'\n}\n\nexport type NotificationType = keyof typeof NotificationTypes;\n\nexport type NotificationFilterFunction = (notifications: Notification[]) => Notification[];\n"],"sourceRoot":""}